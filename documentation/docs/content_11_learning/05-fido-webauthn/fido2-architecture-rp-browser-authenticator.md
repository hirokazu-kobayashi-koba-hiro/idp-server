---
sidebar_position: 2
---

# FIDO2ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - RPãƒ»Webãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ãƒ»èªè¨¼å™¨ã®é–¢ä¿‚

---

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€**W3C WebAuthn Level 2ä»•æ§˜**ã«åŸºã¥ã„ã¦ã€FIDO2/WebAuthnã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®4ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆUserã€User Agentã€Authenticatorã€Relying Partyï¼‰ã¨ãã®é–¢ä¿‚ã‚’è§£èª¬ã—ã¾ã™ã€‚

**æƒ…å ±æº**:
- [W3C WebAuthn Level 2 - Section 4. Terminology (Relying Party)](https://www.w3.org/TR/webauthn-2/#webauthn-relying-party)
- [W3C WebAuthn Level 2 - Section 5. Web Authentication API](https://www.w3.org/TR/webauthn-2/#sctn-api)

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ä»¥ä¸‹ã‚’è§£èª¬ã—ã¾ã™ï¼š

- **W3Cä»•æ§˜ã«ãŠã‘ã‚‹4ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ï¼ˆUser, User Agent, Authenticator, RPï¼‰
- **Relying Party (RP) ã®å®šç¾©ã¨è²¬ä»»**ï¼ˆW3Cä»•æ§˜æº–æ‹ ï¼‰
- **WebAuthn API**ï¼ˆ`create()`ã¨`get()`ï¼‰
- **ç™»éŒ²ãƒ»èªè¨¼ã®åŸºæœ¬ãƒ•ãƒ­ãƒ¼**

**æ³¨æ„**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯æ¦‚å¿µã®ç†è§£ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

---

## ç”¨èªã®é‡è¦ãªæ³¨æ„äº‹é …

**W3C WebAuthnä»•æ§˜ã§ã¯ã€ŒFIDOã‚µãƒ¼ãƒãƒ¼ã€ã¨ã„ã†ç”¨èªã¯å®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚** æ­£å¼ãªç”¨èªã¯ **Relying Party (RP)** ã§ã™ã€‚

| æ–‡è„ˆ | ç”¨èª | èª¬æ˜ |
|------|------|------|
| **W3C WebAuthnä»•æ§˜** | RP (Relying Party) | å…¬å¼ç”¨èª |
| **å•†ç”¨è£½å“** | FIDOã‚µãƒ¼ãƒãƒ¼ | LINE FIDO2 Serverã€Yubico FIDO2 Serverç­‰ã®**è£½å“å** |
| **å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³1** | FIDO2ã‚µãƒ¼ãƒãƒ¼è£½å“ã‚’åˆ©ç”¨ | å•†ç”¨è£½å“ã‚’å°å…¥ã—ã¦RPæ©Ÿèƒ½ã‚’å®Ÿç¾ |
| **å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³2** | è‡ªå‰ã§RPå®Ÿè£… | WebAuthn4jç­‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªå®Ÿè£… |

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€W3Cä»•æ§˜ã®æ­£å¼ç”¨èªã€ŒRP (Relying Party)ã€ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚**

---

## W3C WebAuthnä»•æ§˜ã«ãŠã‘ã‚‹4ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```mermaid
graph TB
    subgraph Client["ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹ï¼‰"]
        Browser["Webãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼<br/>(User Agent)<br/>Chrome, Safari, Edgeç­‰"]
        Authenticator["èªè¨¼å™¨<br/>(Authenticator)<br/>Touch ID, YubiKeyç­‰"]
    end

    subgraph Server["ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆã‚µãƒ¼ãƒ“ã‚¹æä¾›è€…ï¼‰"]
        RP["RP<br/>(Relying Party)<br/>Webã‚µãƒ¼ãƒ“ã‚¹<br/>ä¾‹: Google, GitHub"]
    end

    User["ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼"] -->|1. æ“ä½œ| Browser
    Browser -->|2. WebAuthn API| Authenticator
    Authenticator -->|3. ç”Ÿä½“èªè¨¼/PIN| User
    Authenticator -->|4. å…¬é–‹éµãƒ»ç½²å| Browser
    Browser -->|5. HTTPé€šä¿¡| RP
    RP -->|6. æ¤œè¨¼çµæœ| Browser
    Browser -->|7. çµæœè¡¨ç¤º| User

    style RP fill:#e1f5e1
    style Browser fill:#e1f0ff
    style Authenticator fill:#fff3e1
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®šç¾©ï¼ˆW3Cä»•æ§˜æº–æ‹ ï¼‰

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | W3Cä»•æ§˜ç”¨èª | å®šç¾© | å®Ÿè£…ä¾‹ |
|-------------|-----------|------|--------|
| **1. ãƒ¦ãƒ¼ã‚¶ãƒ¼** | User | å®Ÿéš›ã®äººé–“ | ã‚ãªãŸ |
| **2. Webãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼** | User Agent | WebAuthn APIã‚’å®Ÿè£…ã—ã€RPã¨èªè¨¼å™¨ã‚’ä»²ä»‹ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ | Chrome, Safari, Edge |
| **3. èªè¨¼å™¨** | Authenticator | ç§˜å¯†éµã‚’ä¿æŒã—ã€å…¬é–‹éµã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ç”Ÿæˆãƒ»ç½²åã™ã‚‹æš—å·åŒ–ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ | Touch IDï¼ˆPlatformï¼‰, YubiKeyï¼ˆCross-platformï¼‰ |
| **4. RP** | Relying Party | Web Authentication APIã‚’åˆ©ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç™»éŒ²ãƒ»èªè¨¼ã™ã‚‹Webã‚µãƒ¼ãƒ“ã‚¹ | Google, GitHub, idp-server |

### W3Cä»•æ§˜ã«ãŠã‘ã‚‹å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å½¹å‰²

#### 1. Userï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
å®Ÿéš›ã®äººé–“ã§ã€èªè¨¼å™¨ã«å¯¾ã—ã¦ç”Ÿä½“èªè¨¼ï¼ˆæŒ‡ç´‹ã€é¡”èªè¨¼ï¼‰ã‚„PINå…¥åŠ›ã‚’æä¾›ã—ã¾ã™ã€‚

#### 2. User Agentï¼ˆWebãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ï¼‰
**å®šç¾©**ï¼ˆW3Cä»•æ§˜ï¼‰:
> "User Agentã¯ã€Relying Partyã¨èªè¨¼å™¨ã®é–“ã®é€šä¿¡ã‚’ä»²ä»‹ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã‚ã‚‹ã€‚"

**å½¹å‰²**:
- WebAuthn APIï¼ˆ`navigator.credentials.create()`ã€`navigator.credentials.get()`ï¼‰ã‚’å®Ÿè£…
- RPã‹ã‚‰å—ã‘å–ã£ãŸæƒ…å ±ã‚’èªè¨¼å™¨ã«ä¼é”
- èªè¨¼å™¨ã‹ã‚‰ã®å¿œç­”ã‚’RPã«è¿”å´
- **é‡è¦**: User Agentã¯RPã¨èªè¨¼å™¨ã‚’ä»²ä»‹ã™ã‚‹ã®ã¿ã§ã€èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã¯æŒãŸãªã„

#### 3. Authenticatorï¼ˆèªè¨¼å™¨ï¼‰
**å®šç¾©**ï¼ˆW3Cä»•æ§˜ï¼‰:
> "èªè¨¼å™¨ã¯ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¾ãŸã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«å­˜åœ¨ã™ã‚‹æš—å·åŒ–ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã‚ã‚Šã€ç‰¹å®šã®Relying Partyã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç™»éŒ²ã—ã€å¾Œã§ç™»éŒ²ã•ã‚ŒãŸå…¬é–‹éµã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®æ‰€æœ‰ã‚’è¨¼æ˜ã—ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œè¨¼ã§ãã‚‹ã€‚"

**å½¹å‰²**:
- å…¬é–‹éµãƒ»ç§˜å¯†éµãƒšã‚¢ã®ç”Ÿæˆ
- ç§˜å¯†éµã®å®‰å…¨ãªä¿ç®¡
- èªè¨¼æ™‚ã®ç½²åç”Ÿæˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œè¨¼ï¼ˆç”Ÿä½“èªè¨¼ã€PINå…¥åŠ›ï¼‰

**ç¨®é¡**:
- **Platform Authenticator**: ãƒ‡ãƒã‚¤ã‚¹çµ„ã¿è¾¼ã¿å‹ï¼ˆTouch IDã€Face IDã€Windows Helloï¼‰
- **Cross-platform Authenticator**: å¤–éƒ¨ãƒ‡ãƒã‚¤ã‚¹å‹ï¼ˆYubiKeyã€Google Titan Keyï¼‰

#### 4. Relying Party (RP)
**å®šç¾©**ï¼ˆW3Cä»•æ§˜ï¼‰:
> "Relying Partyã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²ã¨èªè¨¼ã«Web Authentication APIã‚’åˆ©ç”¨ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã‚ã‚‹ã€‚"

**å½¹å‰²**:
- ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆãƒ©ãƒ³ãƒ€ãƒ å€¤ï¼‰ã®ç”Ÿæˆ
- RPæƒ…å ±ï¼ˆrpIdã€rpNameï¼‰ã®æä¾›
- Attestation Statementï¼ˆç™»éŒ²æ™‚ï¼‰ã®æ¤œè¨¼
- Authentication Assertionï¼ˆèªè¨¼æ™‚ï¼‰ã®æ¤œè¨¼
- å…¬é–‹éµã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®ä¿å­˜ãƒ»ç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®é–¢é€£ä»˜ã‘

**æ§‹æˆè¦ç´ **ï¼ˆW3Cä»•æ§˜ã®èª¬æ˜ã‚ˆã‚Šï¼‰:
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼**: å…¬é–‹éµã®ä¿å­˜ã€æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œ
- **Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: WebAuthn APIã‚’å‘¼ã³å‡ºã™JavaScriptã®æä¾›
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã€RP IDã®é–¢é€£ä»˜ã‘ã‚’ä¿å­˜

---

## Relying Party (RP) ã®è²¬ä»»ï¼ˆW3Cä»•æ§˜æº–æ‹ ï¼‰

W3C WebAuthnä»•æ§˜ã§ã¯ã€RPã¯ä»¥ä¸‹ã®è²¬ä»»ã‚’æŒã¡ã¾ã™ï¼š

### 1. ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ç®¡ç†

**ç™»éŒ²æ™‚**:
- ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆãƒ©ãƒ³ãƒ€ãƒ å€¤ï¼‰ã®ç”Ÿæˆã¨ä¸€æ™‚ä¿å­˜
- RPæƒ…å ±ï¼ˆrpIdã€rpNameï¼‰ã®æä¾›
- Attestation Statementã®æ¤œè¨¼
- **å…¬é–‹éµã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®æ°¸ç¶šåŒ–**

**èªè¨¼æ™‚**:
- ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®ç”Ÿæˆã¨ä¸€æ™‚ä¿å­˜
- **ä¿å­˜æ¸ˆã¿å…¬é–‹éµã®å–å¾—**
- Authentication Assertionã®æ¤œè¨¼
- ç½²åã®æ¤œè¨¼

> **W3Cä»•æ§˜ã‚ˆã‚Š**: "RPã¯ã€ç™»éŒ²ã•ã‚ŒãŸå…¬é–‹éµã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®ã‚³ãƒ”ãƒ¼ã‚’ä¿å­˜ã—ã€ãã‚Œã‚’ä½¿ç”¨ã—ã¦èªè¨¼ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¤œè¨¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚"

### 2. ã‚µãƒ¼ãƒãƒ¼å´æ¤œè¨¼

RPã¯ä»¥ä¸‹ã®æ¤œè¨¼ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

| æ¤œè¨¼é …ç›® | ç›®çš„ | ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|---------|------|----------|
| **Originæ¤œè¨¼** | ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ”»æ’ƒé˜²æ­¢ | ç™»éŒ²ãƒ»èªè¨¼ |
| **Challengeæ¤œè¨¼** | å†åˆ©ç”¨æ”»æ’ƒé˜²æ­¢ | ç™»éŒ²ãƒ»èªè¨¼ |
| **ç½²åæ¤œè¨¼** | èªè¨¼å™¨ã®æ­£å½“æ€§ç¢ºèª | ç™»éŒ²ãƒ»èªè¨¼ |
| **Attestationæ¤œè¨¼** | èªè¨¼å™¨ã®ä¿¡é ¼æ€§ç¢ºèª | ç™»éŒ²ã®ã¿ |
| **signCountæ¤œè¨¼** | ã‚¯ãƒ­ãƒ¼ãƒ³æ¤œå‡º | èªè¨¼ã®ã¿ |

> **W3Cä»•æ§˜ã‚ˆã‚Š**: "RPã¯ã€Attestation Statementã¨Authentication Assertionã‚’æ¤œè¨¼ã—ã€é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚"

### 3. ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹ 

W3Cä»•æ§˜ã§ã¯ã€RPãŒä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã†ã“ã¨ã‚’ç¾©å‹™ä»˜ã‘ã¦ã„ã¾ã™ï¼š

- **[Section 7.1 Registering a New Credential](https://www.w3.org/TR/webauthn-2/#sctn-registering-a-new-credential)**: ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã®è©³ç´°æ‰‹é †
- **[Section 7.2 Verifying an Authentication Assertion](https://www.w3.org/TR/webauthn-2/#sctn-verifying-assertion)**: èªè¨¼ãƒ•ãƒ­ãƒ¼ã®æ¤œè¨¼æ‰‹é †

> **W3Cä»•æ§˜ã‚ˆã‚Š**: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®åˆ©ç‚¹ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€RPã¯ã“ã‚Œã‚‰ã®æ‰‹é †ã«å¾“ã†å¿…è¦ãŒã‚ã‚‹ã€‚"

### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®è€ƒæ…®

W3Cä»•æ§˜ã§ã¯ã€RPã®å®Ÿè£…è€…ã«å¯¾ã—ã¦ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ³¨æ„æ·±ãèª­ã‚€ã‚ˆã†è¦æ±‚ã—ã¦ã„ã¾ã™ï¼š

- **[Section 13.4 Security considerations for Relying Parties](https://www.w3.org/TR/webauthn-2/#sctn-security-considerations-rp)**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
- **[Section 14.6 Privacy considerations for Relying Parties](https://www.w3.org/TR/webauthn-2/#sctn-privacy-considerations-rp)**: ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è€ƒæ…®äº‹é …

### RPå®Ÿè£…ã®2ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

RPã®å®Ÿè£…ã«ã¯ã€å¤§ãã2ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚Šã¾ã™ï¼š

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | èª¬æ˜ | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|---------|------|---------|----------|
| **FIDO2ã‚µãƒ¼ãƒãƒ¼è£½å“** | LINE FIDO2 Serverã€Yubico FIDO2 Serverç­‰ã®å•†ç”¨è£½å“ã‚’åˆ©ç”¨ | å®Ÿè£…å·¥æ•°å‰Šæ¸›ã€ã‚µãƒãƒ¼ãƒˆå……å®Ÿ | ã‚³ã‚¹ãƒˆã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºåˆ¶é™ |
| **è‡ªå‰å®Ÿè£…** | WebAuthn4jç­‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªå®Ÿè£… | æŸ”è»Ÿæ€§ã€ã‚³ã‚¹ãƒˆå‰Šæ¸› | å®Ÿè£…å·¥æ•°ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è²¬ä»» |

idp-serverã¯ã€**è‡ªå‰å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

---

## WebAuthn APIï¼ˆW3Cä»•æ§˜æº–æ‹ ï¼‰

W3C WebAuthnä»•æ§˜ã¯ã€**PublicKeyCredential**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä¸­å¿ƒã¨ã—ãŸ**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´API**ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

> **W3Cä»•æ§˜ã‚ˆã‚Š**: "ã“ã®ä»•æ§˜ã¯ã€å¼·åŠ›ã§ã€è¨¼æ˜ã•ã‚Œã€ã‚¹ã‚³ãƒ¼ãƒ—åŒ–ã•ã‚Œã€å…¬é–‹éµãƒ™ãƒ¼ã‚¹ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½œæˆãƒ»ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚"

### ä¸»è¦API

| ãƒ¡ã‚½ãƒƒãƒ‰ | ç”¨é€” | å‘¼ã³å‡ºã—å…ƒ | èª¬æ˜ |
|---------|------|----------|------|
| `navigator.credentials.create()` | ç™»éŒ² | Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆRPï¼‰ | æ–°ã—ã„å…¬é–‹éµã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ç”Ÿæˆ |
| `navigator.credentials.get()` | èªè¨¼ | Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆRPï¼‰ | æ—¢å­˜ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’å–å¾—ã—ã¦ç½²åç”Ÿæˆ |
| `isUserVerifyingPlatformAuthenticatorAvailable()` | æ©Ÿèƒ½ç¢ºèª | Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆRPï¼‰ | Platform Authenticatorã®åˆ©ç”¨å¯èƒ½æ€§ã‚’ç¢ºèª |

### APIã®å½¹å‰²åˆ†æ‹…

| å½¹å‰² | å®Ÿè¡Œä¸»ä½“ | èª¬æ˜ |
|------|---------|------|
| **APIå‘¼ã³å‡ºã—** | Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆRPï¼‰ | JavaScriptã‹ã‚‰`create()`ã‚„`get()`ã‚’å‘¼ã³å‡ºã™ |
| **ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®Ÿè£…** | User Agent | WebAuthnä»•æ§˜ã«å¾“ã£ãŸå‡¦ç†ã‚’å®Ÿè¡Œ |
| **æš—å·åŒ–æ“ä½œ** | Authenticator | éµãƒšã‚¢ç”Ÿæˆã€ç½²åç”Ÿæˆã€ç§˜å¯†éµä¿ç®¡ |

### é‡è¦ãªä»•æ§˜ä¸Šã®æ³¨æ„ç‚¹

> **W3Cä»•æ§˜ã‚ˆã‚Š**: "ã“ã®ä»•æ§˜ã¯ã€ã‚µãƒ¼ãƒãƒ¼å´APIã‚’å®šç¾©ã—ã¦ã„ãªã„ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´APIã®ã¿ã‚’å®šç¾©ã™ã‚‹ã€‚"

ã¤ã¾ã‚Šã€**RPã®å®Ÿè£…æ–¹æ³•ã¯å„ã‚µãƒ¼ãƒ“ã‚¹ã®è‡ªç”±**ã§ã™ã€‚W3Cä»•æ§˜ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ï¼‰å´ã®å‹•ä½œã®ã¿ã‚’æ¨™æº–åŒ–ã—ã¦ã„ã¾ã™ã€‚

### WebAuthn APIã®é€šä¿¡ç¯„å›²

**é‡è¦ãªèª¤è§£ã®é˜²æ­¢**:
- `navigator.credentials.create()`ã¨`get()`ã¯ã€**User Agentã¨èªè¨¼å™¨ã®é–“ã§ã®ã¿é€šä¿¡**ã—ã¾ã™
- **ã“ã‚Œã‚‰ã®APIã¯RPã¨ç›´æ¥é€šä¿¡ã—ã¾ã›ã‚“**ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ã¯ç™ºç”Ÿã—ãªã„ï¼‰
- RPã¨ã®é€šä¿¡ã¯ã€åˆ¥é€”`fetch()`ç­‰ã®HTTPé€šä¿¡ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™

```
ã€æ­£ã—ã„é€šä¿¡ãƒ•ãƒ­ãƒ¼ã€‘
Webã‚¢ãƒ—ãƒª â†’ fetch() â†’ RP â†’ ãƒãƒ£ãƒ¬ãƒ³ã‚¸è¿”å´
         â†“
Webã‚¢ãƒ—ãƒª â†’ navigator.credentials.create() â†’ èªè¨¼å™¨ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é€šä¿¡ï¼‰
         â†“
èªè¨¼å™¨ â†’ å…¬é–‹éµè¿”å´ â†’ Webã‚¢ãƒ—ãƒª
                    â†“
Webã‚¢ãƒ—ãƒª â†’ fetch() â†’ RP â†’ æ¤œè¨¼ãƒ»ä¿å­˜
```

---

## ç™»éŒ²ãƒ»èªè¨¼ã®åŸºæœ¬ãƒ•ãƒ­ãƒ¼

### ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã®æ¦‚è¦

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant Browser as Webãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼<br/>(User Agent)
    participant RP as RP<br/>(Webã‚µãƒ¼ãƒãƒ¼)
    participant Auth as èªè¨¼å™¨<br/>(Authenticator)

    User->>Browser: 1. "ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²"ã‚¯ãƒªãƒƒã‚¯
    Browser->>RP: 2. ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    RP->>RP: 3. ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç”Ÿæˆï¼ˆ32ãƒã‚¤ãƒˆï¼‰
    RP-->>Browser: 4. ãƒãƒ£ãƒ¬ãƒ³ã‚¸ + RPæƒ…å ±è¿”å´
    Browser->>Auth: 5. éµãƒšã‚¢ç”Ÿæˆè¦æ±‚
    Auth->>User: 6. ç”Ÿä½“èªè¨¼è¦æ±‚
    User->>Auth: 7. ç”Ÿä½“èªè¨¼å®Ÿè¡Œ
    Auth->>Auth: 8. éµãƒšã‚¢ç”Ÿæˆ
    Auth-->>Browser: 9. å…¬é–‹éµãƒ»Attestationè¿”å´
    Browser->>RP: 10. å…¬é–‹éµé€ä¿¡
    RP->>RP: 11. Origin/Challenge/ç½²åæ¤œè¨¼
    RP->>RP: 12. å…¬é–‹éµã‚’DBä¿å­˜
    RP-->>Browser: 13. ç™»éŒ²æˆåŠŸ
    Browser-->>User: 14. "ç™»éŒ²å®Œäº†"è¡¨ç¤º
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ**:
1. **ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†**: WebAuthn APIï¼ˆã‚¹ãƒ†ãƒƒãƒ—5-9ï¼‰ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ãªã—
2. **HTTPé€šä¿¡**: ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ â†” RPã®é€šä¿¡ï¼ˆã‚¹ãƒ†ãƒƒãƒ—2, 10ï¼‰
3. **æ¤œè¨¼**: RPãŒOriginã€Challengeã€ç½²åã‚’æ¤œè¨¼ï¼ˆã‚¹ãƒ†ãƒƒãƒ—11ï¼‰

### èªè¨¼ãƒ•ãƒ­ãƒ¼ã®æ¦‚è¦

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant Browser as Webãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼<br/>(User Agent)
    participant RP as RP<br/>(Webã‚µãƒ¼ãƒãƒ¼)
    participant Auth as èªè¨¼å™¨<br/>(Authenticator)

    User->>Browser: 1. "ãƒ­ã‚°ã‚¤ãƒ³"ã‚¯ãƒªãƒƒã‚¯
    Browser->>RP: 2. ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    RP->>RP: 3. ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç”Ÿæˆ
    RP->>RP: 4. Credential IDå–å¾—ï¼ˆDBï¼‰
    RP-->>Browser: 5. ãƒãƒ£ãƒ¬ãƒ³ã‚¸ + Credential IDè¿”å´
    Browser->>Auth: 6. èªè¨¼è¦æ±‚
    Auth->>User: 7. ç”Ÿä½“èªè¨¼è¦æ±‚
    User->>Auth: 8. ç”Ÿä½“èªè¨¼å®Ÿè¡Œ
    Auth->>Auth: 9. ç§˜å¯†éµã§ç½²åç”Ÿæˆ
    Auth-->>Browser: 10. ç½²åãƒ‡ãƒ¼ã‚¿è¿”å´
    Browser->>RP: 11. ç½²åé€ä¿¡
    RP->>RP: 12. å…¬é–‹éµå–å¾—ï¼ˆDBï¼‰
    RP->>RP: 13. Origin/Challenge/ç½²åæ¤œè¨¼
    RP->>RP: 14. signCountæ¤œè¨¼ï¼ˆã‚¯ãƒ­ãƒ¼ãƒ³æ¤œå‡ºï¼‰
    RP-->>Browser: 15. èªè¨¼æˆåŠŸ
    Browser-->>User: 16. ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†
```

**èªè¨¼ã®2ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³**:

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | allowCredentials | ãƒ¦ãƒ¼ã‚¶ãƒ¼åå…¥åŠ› | ç”¨é€” |
|---------|-----------------|--------------|------|
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼åå…¥åŠ›ã‚ã‚Š** | RPãŒæŒ‡å®šï¼ˆDBå–å¾—ï¼‰ | å¿…è¦ | 2è¦ç´ èªè¨¼ |
| **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹** | ç©ºé…åˆ—ï¼ˆDiscoverableæ¤œç´¢ï¼‰ | ä¸è¦ | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹ãƒ­ã‚°ã‚¤ãƒ³ |

**è©³ç´°**: [basic-17: FIDO2ãƒ»ãƒ‘ã‚¹ã‚­ãƒ¼ãƒ»Discoverable Credential](basic-17-fido2-passkey-discoverable-credential.md)

---

## ã¾ã¨ã‚

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **W3Cä»•æ§˜ã§ã¯4ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®šç¾©**
   - **User**: å®Ÿéš›ã®äººé–“ï¼ˆç”Ÿä½“èªè¨¼ãƒ»PINå…¥åŠ›ï¼‰
   - **User Agent**: Webãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ï¼ˆWebAuthn APIå®Ÿè£…ã€RPã¨èªè¨¼å™¨ã®ä»²ä»‹ï¼‰
   - **Authenticator**: èªè¨¼å™¨ï¼ˆéµãƒšã‚¢ç”Ÿæˆãƒ»ç½²åç”Ÿæˆãƒ»ç§˜å¯†éµä¿ç®¡ï¼‰
   - **Relying Party (RP)**: Webã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸ç”Ÿæˆãƒ»æ¤œè¨¼ãƒ»å…¬é–‹éµä¿å­˜ï¼‰

2. **æ­£ã—ã„ç”¨èªã¯ RP (Relying Party)**
   - W3C WebAuthnä»•æ§˜ã®å…¬å¼ç”¨èª
   - ã€ŒFIDOã‚µãƒ¼ãƒãƒ¼ã€ã¯å•†ç”¨è£½å“ã®åç§°ï¼ˆLINE FIDO2 Serverã€Yubico FIDO2 Serverç­‰ï¼‰
   - RPã¯Webã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã‚’æŒ‡ã™ï¼ˆæ¤œè¨¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ãªã„ï¼‰

3. **RPã®ä¸»è¦ãªè²¬ä»»**
   - ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ç®¡ç†ï¼ˆå…¬é–‹éµã®ä¿å­˜ãƒ»ç®¡ç†ï¼‰
   - ã‚µãƒ¼ãƒãƒ¼å´æ¤œè¨¼ï¼ˆOriginã€Challengeã€ç½²åã€signCountï¼‰
   - ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹ ï¼ˆW3Cä»•æ§˜ã®ç™»éŒ²ãƒ»èªè¨¼ãƒ•ãƒ­ãƒ¼ã«å¾“ã†ï¼‰
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®è€ƒæ…®

4. **WebAuthn APIã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã¿**
   - `navigator.credentials.create()`ã¨`get()`ã¯èªè¨¼å™¨ã¨ã®ã¿é€šä¿¡ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ï¼‰
   - RPã¨ã®é€šä¿¡ã¯åˆ¥é€”HTTPé€šä¿¡ï¼ˆ`fetch()`ç­‰ï¼‰ã§è¡Œã†
   - W3Cä»•æ§˜ã¯ã‚µãƒ¼ãƒãƒ¼å´APIã‚’å®šç¾©ã—ã¦ã„ãªã„ï¼ˆRPå®Ÿè£…ã¯è‡ªç”±ï¼‰

5. **RPå®Ÿè£…ã®2ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³**
   - **FIDO2ã‚µãƒ¼ãƒãƒ¼è£½å“**: LINE FIDO2 Serverã€Yubico FIDO2 Serverç­‰ã‚’åˆ©ç”¨
   - **è‡ªå‰å®Ÿè£…**: WebAuthn4jç­‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼ˆidp-serverã¯ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

### W3C WebAuthn Level 2ä»•æ§˜
- **[Section 4. Terminology (Relying Party)](https://www.w3.org/TR/webauthn-2/#webauthn-relying-party)**: RPå®šç¾©ã¨è²¬ä»»
- **[Section 5. Web Authentication API](https://www.w3.org/TR/webauthn-2/#sctn-api)**: PublicKeyCredentialã€create()ã€get()
- **[Section 7.1 Registering a New Credential](https://www.w3.org/TR/webauthn-2/#sctn-registering-a-new-credential)**: ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã®è©³ç´°æ‰‹é †
- **[Section 7.2 Verifying an Authentication Assertion](https://www.w3.org/TR/webauthn-2/#sctn-verifying-assertion)**: èªè¨¼æ¤œè¨¼æ‰‹é †
- **[Section 13.4 Security considerations for Relying Parties](https://www.w3.org/TR/webauthn-2/#sctn-security-considerations-rp)**: RPã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
- **[Section 14.6 Privacy considerations for Relying Parties](https://www.w3.org/TR/webauthn-2/#sctn-privacy-considerations-rp)**: RPã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è€ƒæ…®äº‹é …

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **[basic-16: FIDO2ãƒ»WebAuthn ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼](basic-16-fido2-webauthn-passwordless.md)**: FIDO2/WebAuthnã®åŸºç¤æ¦‚å¿µ
- **[basic-17: FIDO2ãƒ»ãƒ‘ã‚¹ã‚­ãƒ¼ãƒ»Discoverable Credential](basic-17-fido2-passkey-discoverable-credential.md)**: Discoverable Credentialã¨Conditional UI
- **[basic-19: FIDO2 ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è©³ç´°](basic-19-fido2-registration-flow-interface.md)**: ç™»éŒ²ãƒ•ãƒ­ãƒ¼è©³ç´°
- **[basic-20: FIDO2 èªè¨¼ãƒ•ãƒ­ãƒ¼ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è©³ç´°](basic-20-fido2-authentication-flow-interface.md)**: èªè¨¼ãƒ•ãƒ­ãƒ¼è©³ç´°
- **[basic-21: FIDO2ãƒ»WebAuthnä»•æ§˜ã®å¤‰é·](basic-21-fido2-webauthn-level-specification-evolution.md)**: Level 1 â†’ 2 â†’ 3ã®å¤‰é·

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€W3C WebAuthn Level 2ä»•æ§˜ã«åŸºã¥ã„ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚**
