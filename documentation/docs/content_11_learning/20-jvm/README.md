# JVM 学習ガイド

Java Virtual Machine（JVM）の仕組みと最適化に関する包括的な学習ドキュメントです。

---

## 学習の目的

- JVMの内部構造を理解し、アプリケーションの動作原理を把握する
- メモリ管理とガベージコレクションを理解し、適切なチューニングができる
- パフォーマンス問題のトラブルシューティング能力を身につける
- Java 21の新機能（Virtual Threads等）を活用できる

---

## 学習ロードマップ

```
┌─────────────────────────────────────────────────────────────┐
│                    学習の流れ                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  基礎 (JVMを理解する)                                       │
│  ├── JVM概要                                                │
│  │   └── アーキテクチャ、JDK選択、実行モデル               │
│  ├── クラスローディング                                     │
│  │   └── クラスローダー階層、動的ロード                    │
│  └── メモリ管理                                             │
│      └── ヒープ、スタック、メタスペース                    │
│                                                              │
│  GC (ガベージコレクション)                                  │
│  ├── GC基礎                                                 │
│  │   └── GCの種類、動作原理、世代別GC                      │
│  └── GCチューニング                                         │
│      └── パラメータ設定、モニタリング、選択指針            │
│                                                              │
│  応用 (パフォーマンスと問題解決)                            │
│  ├── パフォーマンス                                         │
│  │   └── JIT、プロファイリング、最適化                     │
│  └── トラブルシューティング                                 │
│      └── ヒープダンプ、スレッドダンプ、分析ツール          │
│                                                              │
│  最新機能 (Java 21+)                                        │
│  ├── Java 21新機能                                          │
│  │   └── Virtual Threads、Record、Pattern Matching          │
│  └── Native Image                                           │
│      └── GraalVM、AOTコンパイル、コンテナ最適化             │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## ドキュメント一覧

### 基礎

| # | ドキュメント | 説明 | 所要時間 |
|---|-------------|------|---------|
| 01 | [JVM概要](jvm-01-overview.md) | アーキテクチャ、JDK選択、実行モデル | 45分 |
| 02 | [クラスローディング](jvm-02-classloading.md) | クラスローダー階層、動的ロード | 45分 |
| 03 | [メモリ管理](jvm-03-memory.md) | ヒープ、スタック、メタスペース | 60分 |

### ガベージコレクション

| # | ドキュメント | 説明 | 所要時間 |
|---|-------------|------|---------|
| 04 | [ガベージコレクション](jvm-04-gc.md) | GCの種類、動作原理、世代別GC | 60分 |
| 05 | [GCチューニング](jvm-05-gc-tuning.md) | パラメータ設定、モニタリング、選択指針 | 60分 |

### 応用

| # | ドキュメント | 説明 | 所要時間 |
|---|-------------|------|---------|
| 06 | [パフォーマンス](jvm-06-performance.md) | JIT、プロファイリング、最適化 | 60分 |
| 07 | [トラブルシューティング](jvm-07-troubleshooting.md) | ヒープダンプ、スレッドダンプ、分析ツール | 60分 |

### 最新機能

| # | ドキュメント | 説明 | 所要時間 |
|---|-------------|------|---------|
| 08 | [Java 21新機能](jvm-08-java21.md) | Virtual Threads、Record、Pattern Matching | 60分 |
| 09 | [Native Image](jvm-09-native-image.md) | GraalVM、AOTコンパイル、コンテナ最適化 | 60分 |

### コンパイル

| # | ドキュメント | 説明 | 所要時間 |
|---|-------------|------|---------|
| 10 | [Javaコンパイル](jvm-10-compilation.md) | javac、バイトコード、アノテーションプロセッサ | 45分 |

---

## 推奨学習パス

### パス1: JVMの基礎を固めたい方

```
1. JVM概要
2. クラスローディング
3. メモリ管理
4. ガベージコレクション
```

### パス2: パフォーマンス問題を解決したい方

```
1. メモリ管理
2. ガベージコレクション
3. GCチューニング
4. パフォーマンス
5. トラブルシューティング
```

### パス3: 最新のJavaを活用したい方

```
1. JVM概要
2. Java 21新機能 ★
3. パフォーマンス
```

★ Virtual Threads は本プロジェクトで活用

### パス4: コンテナ/サーバーレス最適化

```
1. JVM概要
2. メモリ管理
3. GCチューニング
4. Native Image ★
```

★ 起動時間・メモリ効率の大幅改善

---

## 学べること

### idp-server開発に必要な知識

| JVMの概念 | idp-serverでの活用 |
|----------|-------------------|
| Virtual Threads | 高スループット・リクエスト処理 |
| メモリ管理 | 大量セッション・トークン管理 |
| GCチューニング | レスポンスタイム安定化 |
| クラスローディング | Spring Boot DIの理解 |
| JITコンパイル | ウォームアップ戦略 |
| Native Image | コンテナ起動時間短縮、メモリ効率化 |

### 運用に必要な知識

| JVMの概念 | 運用での活用 |
|----------|-------------|
| ヒープダンプ | OutOfMemoryError調査 |
| スレッドダンプ | デッドロック・ハング調査 |
| GCログ | パフォーマンス分析 |
| JMX | 監視・メトリクス収集 |

---

## 実践環境の準備

### JDKのインストール

```bash
# macOS (Homebrew)
brew install openjdk@21

# Ubuntu/Debian
sudo apt install openjdk-21-jdk

# バージョン確認
java -version
```

### 推奨JDKディストリビューション

| ディストリビューション | 特徴 | 推奨用途 |
|---------------------|------|---------|
| Eclipse Temurin | OpenJDK準拠、無償、長期サポート | 一般開発・本番 |
| Amazon Corretto | AWS最適化、無償、長期サポート | AWS環境 |
| Oracle GraalVM | 高性能、Native Image対応 | 高パフォーマンス要件 |
| Azul Zulu | 幅広いプラットフォーム対応 | エンタープライズ |

---

## 関連リソース

### 公式ドキュメント

- [Java SE Documentation](https://docs.oracle.com/en/java/javase/21/)
- [JVM Specification](https://docs.oracle.com/javase/specs/jvms/se21/html/)
- [GC Tuning Guide](https://docs.oracle.com/en/java/javase/21/gctuning/)

### 書籍

- 「Javaパフォーマンス」Scott Oaks著 - JVMチューニングの定番
- 「Optimizing Java」Benjamin J. Evans著 - 実践的な最適化手法

### ツール

- [VisualVM](https://visualvm.github.io/) - JVMモニタリング・プロファイリング
- [Eclipse MAT](https://eclipse.dev/mat/) - ヒープダンプ分析
- [async-profiler](https://github.com/jvm-profiling-tools/async-profiler) - 低オーバーヘッドプロファイラ

---

## 次のステップ

JVMの基礎を学んだ後は、以下のドキュメントに進みましょう：

- [PostgreSQL 学習ガイド](../11-postgresql/README.md) - JDBC・コネクションプーリングの理解に
- [Kubernetes 学習ガイド](../13-kubernetes/README.md) - コンテナ化されたJavaアプリの運用に
