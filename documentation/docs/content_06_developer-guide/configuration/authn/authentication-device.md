# 認証デバイス通知

このドキュメントは、ユーザーが登録済みの認証デバイスに対して認証リクエストを送信する `authentication-device-notification`
方式の `概要`・`設定`・`利用方法` について説明します。

---

## 概要

`authentication-device-notification`
は、Push型の認証確認処理を実現するためのインタラクション方式です。ユーザーに紐づいたデバイス情報（例：モバイルアプリやFIDO認証器など）に対して、リクエストを送信し、ユーザー側での認可操作をトリガーする役割を持ちます。

このインタラクションの主な用途は、以下の通り：

* 多要素認証（MFA）の一部として、事前に登録された認証デバイスへの通知
* ユーザー確認（confirmation）やトランザクション認証のトリガー

この方式単体では検証処理（ユーザー応答）は行わず、別途 `fido-uaf`など 他のデバイス認証と組み合わせて使います。

---

## 設定

通知チャネルの設定はテナント単位で定義されます。

以下はFCM（Firebase Cloud Messaging）を利用する場合の構成例です。

### FCM設定項目

| 項目           | 内容                                                                  |
|--------------|---------------------------------------------------------------------|
| `type`       | 通知チャネル種別（`fcm` 固定）                                                  |
| `templates`  | 通知に利用されるテンプレート群。`transaction`, `authentication`, `default` などのキーに対応 |
| `credential` | FCMサービスへの認証のクレデンシャル情報（JSON形式）                                       |

#### templates 内部構造

| 項目        | 内容                     |
|-----------|------------------------|
| `subject` | 通知メッセージの件名（ユーザーに表示される） |
| `body`    | 通知メッセージの本文（ユーザーに表示される） |

テンプレートの例：

```json
{
  "templates": {
    "transaction": {
      "subject": "ログイン要求",
      "body": "あなたのアカウントに対する認証要求があります。承認しますか？"
    },
    "default": {
      "subject": "通知",
      "body": "アカウントに関する通知があります。"
    }
  },
  "credential": "{\"type\":\"service_account\",...}"
}
```

---

## 利用方法

この方式は通常、認可フロー中に `acr_values` や `prompt` 指定によって呼び出されます。以下のように
`/v1/authorizations/{id}/authentication-device-notification` にリクエストすることで発火します。

### リクエスト例

```http
POST /v1/authorizations/{id}/authentication-device-notification
```


---

## 備考

* 通知処理自体には認証結果の判定ロジックは含まれません。
* 通知先のデバイスは、ユーザー情報に登録された主デバイスとして取得されます。
* この処理の次に `authentication-device` インタラクションでユーザーの認可アクションを検証します。
