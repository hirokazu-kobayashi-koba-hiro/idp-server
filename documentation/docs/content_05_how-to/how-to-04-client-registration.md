# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²ã‚¬ã‚¤ãƒ‰

## ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç›®çš„

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’ç™»éŒ²ã—ã€èªå¯ãƒ•ãƒ­ãƒ¼ãŒå‹•ä½œã™ã‚‹ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹**ã“ã¨ãŒç›®æ¨™ã§ã™ã€‚

å…·ä½“çš„ã«ã¯ã€**3ã¤ã®ä»£è¡¨çš„ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¿ã‚¤ãƒ—**ï¼ˆWebã‚¢ãƒ—ãƒªã€ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã€M2Mï¼‰ã‚’ç™»éŒ²ã—ã€ãã‚Œãã‚Œã®èªè¨¼æ–¹å¼ã‚’ç†è§£ã—ã¾ã™ã€‚

### å­¦ã¹ã‚‹ã“ã¨

âœ… **OAuth/OIDCã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²ã®åŸºç¤**
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã¯ä½•ã‹ï¼ˆConfidential vs Publicï¼‰
- 3ã¤ã®ä»£è¡¨çš„ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆWeb/Mobile/M2Mï¼‰
- å¿…é ˆè¨­å®šé …ç›®ï¼ˆclient_id, redirect_uris, grant_typesç­‰ï¼‰

âœ… **å®Ÿè·µçš„ãªçŸ¥è­˜**
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²ã®å®Ÿè¡Œæ‰‹é †
- ç™»éŒ²ç¢ºèªæ–¹æ³•
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### æ‰€è¦æ™‚é–“
â±ï¸ **ç´„15åˆ†**

### ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½ç½®ã¥ã‘

**Phase 1**: æœ€å°æ§‹æˆã§å‹•ä½œç¢ºèªï¼ˆStep 3/5ï¼‰

**å‰æãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [how-to-01: çµ„ç¹”åˆæœŸåŒ–](./how-to-02-organization-initialization.md) - çµ„ç¹”ä½œæˆæ¸ˆã¿
- [how-to-02: ãƒ†ãƒŠãƒ³ãƒˆä½œæˆ](./how-to-03-tenant-setup.md) - ãƒ†ãƒŠãƒ³ãƒˆä½œæˆæ¸ˆã¿

**æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [how-to-04: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²](./how-to-05-user-registration.md) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã¨èªè¨¼

### å‰ææ¡ä»¶
- [how-to-02](./how-to-03-tenant-setup.md)ã§ãƒ†ãƒŠãƒ³ãƒˆä½œæˆå®Œäº†
- çµ„ç¹”ç®¡ç†è€…ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—æ¸ˆã¿
- çµ„ç¹”IDãƒ»ãƒ†ãƒŠãƒ³ãƒˆIDã‚’ç¢ºèªæ¸ˆã¿

---

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã¯

**Clientï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰**ã¯ã€OAuth 2.0/OIDCãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã§ã™ã€‚

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã¯ä»¥ä¸‹ã®2ç¨®é¡ãŒã‚ã‚Šã¾ã™ï¼š
- **Confidential Clientï¼ˆæ©Ÿå¯†ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰**: `client_secret`ã‚’å®‰å…¨ã«ä¿ç®¡ã§ãã‚‹ï¼ˆä¾‹ï¼šã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰Webã‚¢ãƒ—ãƒªï¼‰
- **Public Clientï¼ˆå…¬é–‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰**: `client_secret`ã‚’ä¿ç®¡ã§ããªã„ï¼ˆä¾‹ï¼šSPAã€ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªï¼‰

**è©³ç´°**: [ğŸ“– Concept 19: Client](../content_03_concepts/01-foundation/concept-03-client.md) - Clientç¨®åˆ¥ã€èªè¨¼æ–¹æ³•ã€Tenant-Client-Useré–¢ä¿‚ã®è©³ç´°è§£èª¬

---

## ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§è¡Œã†ã“ã¨

3ã¤ã®ä»£è¡¨çš„ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚’ç™»éŒ²ã—ã¾ã™ï¼š

### 1. çµ„ç¹”ç®¡ç†è€…ãƒˆãƒ¼ã‚¯ãƒ³ã®æº–å‚™

**å‰æ**: [how-to-02](./how-to-03-tenant-setup.md)ã§è¨­å®šã—ãŸç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```bash
# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
echo "Organization ID: $ORGANIZATION_ID"
echo "Public Tenant ID: $PUBLIC_TENANT_ID"
echo "Admin Token: ${ORG_ADMIN_TOKEN:0:50}..."
```

ã¾ã è¨­å®šã—ã¦ã„ãªã„å ´åˆã¯ã€how-to-02ã‚’å‚ç…§ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚

---

## å‹•ä½œç¢ºèªï¼š3ã¤ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚’ç™»éŒ²ã™ã‚‹

### 1. Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆConfidential Clientï¼‰

**ç‰¹å¾´**: ã‚µãƒ¼ãƒãƒ¼å´ã§client_secretã‚’å®‰å…¨ã«ä¿ç®¡ã§ãã‚‹

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®æº–å‚™

```bash
# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDè¨­å®šï¼ˆUUIDå¿…é ˆï¼‰
export WEB_CLIENT_ID=$(uuidgen | tr '[:upper:]' '[:lower:]')
export WEB_CLIENT_SECRET="$(openssl rand -base64 32)"

# ç¢ºèª
echo "Web Client ID: $WEB_CLIENT_ID"
echo "Web Client Secret: $WEB_CLIENT_SECRET"
```

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²

```bash
curl -X POST "http://localhost:8080/v1/management/organizations/${ORGANIZATION_ID}/tenants/${PUBLIC_TENANT_ID}/clients" \
  -H 'Content-Type: application/json' \
  -H "Authorization: Bearer ${ORG_ADMIN_TOKEN}" \
  -d "{
  \"client_id\": \"${WEB_CLIENT_ID}\",
  \"client_secret\": \"${WEB_CLIENT_SECRET}\",
  \"client_name\": \"My Web Application\",
  \"redirect_uris\": [
    \"https://app.example.com/callback\",
    \"http://localhost:3000/callback\"
  ],
  \"response_types\": [\"code\"],
  \"grant_types\": [\"authorization_code\", \"refresh_token\"],
  \"scope\": \"openid profile email\",
  \"token_endpoint_auth_method\": \"client_secret_basic\",
  \"application_type\": \"web\"
}" | jq .
```

**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "dry_run": false,
  "result": {
    "client_id": "web-app-client",
    "client_name": "My Web Application",
    "redirect_uris": [
      "https://app.example.com/callback",
      "http://localhost:3000/callback"
    ],
    "response_types": ["code"],
    "grant_types": ["authorization_code", "refresh_token"],
    "token_endpoint_auth_method": "client_secret_basic",
    "application_type": "web"
  }
}
```

#### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- âœ… `client_id`ãŒæ­£ã—ãç™»éŒ²ã•ã‚Œã¦ã„ã‚‹
- âœ… `redirect_uris`ã«2ã¤ã®URIãŒå«ã¾ã‚Œã¦ã„ã‚‹
- âœ… `token_endpoint_auth_method`ãŒ`client_secret_basic`
- âœ… `grant_types`ã«`authorization_code`ã¨`refresh_token`ãŒå«ã¾ã‚Œã¦ã„ã‚‹

---

### 2. ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªï¼ˆPublic Client + PKCEï¼‰

**ç‰¹å¾´**: client_secretä¸è¦ã€PKCEå¿…é ˆ

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®æº–å‚™

```bash
# ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDï¼ˆUUIDå¿…é ˆï¼‰
export MOBILE_CLIENT_ID=$(uuidgen | tr '[:upper:]' '[:lower:]')

# ç¢ºèª
echo "Mobile Client ID: $MOBILE_CLIENT_ID"
```

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²

```bash
curl -X POST "http://localhost:8080/v1/management/organizations/${ORGANIZATION_ID}/tenants/${PUBLIC_TENANT_ID}/clients" \
  -H 'Content-Type: application/json' \
  -H "Authorization: Bearer ${ORG_ADMIN_TOKEN}" \
  -d "{
  \"client_id\": \"${MOBILE_CLIENT_ID}\",
  \"client_name\": \"My Mobile App\",
  \"redirect_uris\": [
    \"com.example.myapp://callback\"
  ],
  \"response_types\": [\"code\"],
  \"grant_types\": [\"authorization_code\", \"refresh_token\"],
  \"scope\": \"openid profile email\",
  \"token_endpoint_auth_method\": \"none\",
  \"application_type\": \"native\"
}" | jq .
```

**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "dry_run": false,
  "result": {
    "client_id": "mobile-app-client",
    "client_name": "My Mobile App",
    "redirect_uris": [
      "com.example.myapp://callback"
    ],
    "response_types": ["code"],
    "grant_types": ["authorization_code", "refresh_token"],
    "token_endpoint_auth_method": "none",
    "application_type": "native"
  }
}
```

#### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- âœ… `token_endpoint_auth_method`ãŒ`none`ï¼ˆclient_secretãªã—ï¼‰
- âœ… `application_type`ãŒ`native`
- âœ… `redirect_uris`ã«ã‚«ã‚¹ã‚¿ãƒ URLã‚¹ã‚­ãƒ¼ãƒ ï¼ˆ`com.example.myapp://`ï¼‰
- âš ï¸ **PKCEå¿…é ˆ**: å®Ÿéš›ã®èªè¨¼æ™‚ã«code_challenge/code_verifierã‚’ä½¿ç”¨

---

### 3. ã‚µãƒ¼ãƒãƒ¼é–“é€šä¿¡ï¼ˆM2M: Machine-to-Machineï¼‰

**ç‰¹å¾´**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ä¸è¦ã€Client Credentials Flowã®ã¿

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®æº–å‚™

```bash
# M2Mç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDï¼ˆUUIDå¿…é ˆï¼‰
export M2M_CLIENT_ID=$(uuidgen | tr '[:upper:]' '[:lower:]')
export M2M_CLIENT_SECRET="$(openssl rand -base64 32)"

# ç¢ºèª
echo "M2M Client ID: $M2M_CLIENT_ID"
echo "M2M Client Secret: $M2M_CLIENT_SECRET"
```

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²

```bash
curl -X POST "http://localhost:8080/v1/management/organizations/${ORGANIZATION_ID}/tenants/${PUBLIC_TENANT_ID}/clients" \
  -H 'Content-Type: application/json' \
  -H "Authorization: Bearer ${ORG_ADMIN_TOKEN}" \
  -d "{
  \"client_id\": \"${M2M_CLIENT_ID}\",
  \"client_secret\": \"${M2M_CLIENT_SECRET}\",
  \"client_name\": \"Backend Service\",
  \"redirect_uris\": [],
  \"response_types\": [],
  \"grant_types\": [\"client_credentials\"],
  \"scope\": \"api:read api:write\",
  \"token_endpoint_auth_method\": \"client_secret_basic\",
  \"application_type\": \"web\"
}" | jq .
```

**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "dry_run": false,
  "result": {
    "client_id": "backend-service",
    "client_name": "Backend Service",
    "redirect_uris": [],
    "response_types": [],
    "grant_types": ["client_credentials"],
    "token_endpoint_auth_method": "client_secret_basic",
    "application_type": "web"
  }
}
```

#### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- âœ… `grant_types`ãŒ`client_credentials`ã®ã¿
- âœ… `redirect_uris`ãŒç©ºé…åˆ—ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä¸è¦ï¼‰
- âœ… `response_types`ãŒç©ºé…åˆ—ï¼ˆèªå¯ã‚³ãƒ¼ãƒ‰ä¸è¦ï¼‰
- âœ… `scope`ãŒã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆ`api:read`, `api:write`ï¼‰

---

### ç™»éŒ²ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç¢ºèª

```bash
# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§å–å¾—
curl -X GET "http://localhost:8080/v1/management/organizations/${ORGANIZATION_ID}/tenants/${PUBLIC_TENANT_ID}/clients" \
  -H "Authorization: Bearer ${ORG_ADMIN_TOKEN}" | jq .
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**: 3ã¤ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆweb-app-client, mobile-app-client, backend-serviceï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### âŒ ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œ

**ç—‡çŠ¶**: `{"error": "invalid_token"}` ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**: ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†å–å¾—ã—ã¦ãã ã•ã„

```bash
export ORG_ADMIN_TOKEN=$(curl -sS -X POST "http://localhost:8080/${TENANT_ID}/v1/tokens" \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -d 'grant_type=password' \
  -d "username=${ADMIN_EMAIL}" \
  -d "password=${ADMIN_PASSWORD}" \
  -d "client_id=${CLIENT_ID}" \
  -d "client_secret=${CLIENT_SECRET}" \
  -d 'scope=management' | jq -r '.access_token')
```

#### âŒ client_idé‡è¤‡ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `{"error": "invalid_request", "error_description": "client_id already exists"}`

**åŸå› **: åŒã˜ãƒ†ãƒŠãƒ³ãƒˆå†…ã§åŒã˜client_idãŒæ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºç­–**: åˆ¥ã®client_idã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€æ—¢å­˜ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å‰Šé™¤

```bash
# æ—¢å­˜ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å‰Šé™¤
curl -X DELETE "http://localhost:8080/v1/management/organizations/${ORGANIZATION_ID}/tenants/${PUBLIC_TENANT_ID}/clients/${CLIENT_ID}" \
  -H "Authorization: Bearer ${ORG_ADMIN_TOKEN}"
```
---

# API Reference

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²APIã®è©³ç´°ä»•æ§˜ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²API

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```http
POST /v1/management/organizations/{organization-id}/tenants/{tenant-id}/clients
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "client_id": "my-app",
  "client_secret": "secret-xxx",
  "client_name": "My Application",
  "redirect_uris": ["https://app.example.com/callback"],
  "response_types": ["code"],
  "grant_types": ["authorization_code", "refresh_token"],
  "scope": "openid profile email",
  "token_endpoint_auth_method": "client_secret_basic",
  "application_type": "web"
}
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜

#### åŸºæœ¬æƒ…å ±

| é …ç›® | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|---|------|------|
| `client_id` | string (UUID) | âœ… | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä¸€æ„è­˜åˆ¥å­ï¼ˆUUIDå½¢å¼å¿…é ˆï¼‰ |
| `client_secret` | string | æ¡ä»¶ä»˜ã | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆConfidential Clientã®å ´åˆå¿…é ˆï¼‰ |
| `client_name` | string | âŒ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåï¼ˆè¡¨ç¤ºç”¨ï¼‰ |
| `application_type` | string | âœ… | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ï¼ˆ`web` / `native`ï¼‰ |

**client_secretå¿…é ˆæ¡ä»¶**:
- `token_endpoint_auth_method`ãŒ`client_secret_basic`ã¾ãŸã¯`client_secret_post`ã®å ´åˆ
- Confidential Clientï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¢ãƒ—ãƒªï¼‰ã®å ´åˆ

#### ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI

| é …ç›® | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|---|------|------|
| `redirect_uris` | array | âœ… | ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIé…åˆ—ï¼ˆå®Œå…¨ä¸€è‡´å¿…é ˆï¼‰ |

**é‡è¦**:
- å®Œå…¨ä¸€è‡´ãŒå¿…é ˆï¼ˆãƒ‘ã‚¹ã€ãƒãƒ¼ãƒˆã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰
- è¤‡æ•°ç™»éŒ²å¯èƒ½
- ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`#`ï¼‰ã¯ç¦æ­¢

#### OAuth/OIDCè¨­å®š

| é …ç›® | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----|---|------|------|
| `response_types` | array | âœ… | ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ï¼ˆä¾‹: `["code"]`ï¼‰ |
| `grant_types` | array | âœ… | ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚°ãƒ©ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆä¾‹: `["authorization_code", "refresh_token"]`ï¼‰ |
| `scope` | string | âŒ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šï¼‰ |
| `token_endpoint_auth_method` | string | âŒ | ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆèªè¨¼æ–¹å¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `client_secret_basic`ï¼‰ |

**ä¸»è¦ãªgrant_type**:
- `authorization_code` - Authorization Code Flow
- `refresh_token` - Refresh Tokenä½¿ç”¨
- `client_credentials` - Client Credentials Flowï¼ˆM2Mï¼‰
- `urn:openid:params:grant-type:ciba` - CIBA Flow

**ä¸»è¦ãªtoken_endpoint_auth_method**:
- `client_secret_basic` - Basicèªè¨¼ï¼ˆConfidential Clientï¼‰
- `client_secret_post` - POSTãƒœãƒ‡ã‚£ï¼ˆConfidential Clientï¼‰
- `none` - Public Clientï¼ˆPKCEå¿…é ˆï¼‰
- `private_key_jwt` - JWTç½²åï¼ˆç§˜å¯†éµï¼‰
- `tls_client_auth` - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ï¼ˆmTLSï¼‰

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```http
HTTP/1.1 201 Created
Content-Type: application/json

{
  "dry_run": false,
  "result": {
    "client_id": "my-app",
    "client_name": "My Application",
    "redirect_uris": ["https://app.example.com/callback"],
    "response_types": ["code"],
    "grant_types": ["authorization_code", "refresh_token"],
    "scope": "openid profile email",
    "token_endpoint_auth_method": "client_secret_basic",
    "application_type": "web"
  }
}
```

**æ³¨æ„**: `client_secret`ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã¾ã›ã‚“ã€‚ç™»éŒ²æ™‚ã®å€¤ã‚’å®‰å…¨ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚

---

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå–å¾—API

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```http
GET /v1/management/organizations/{organization-id}/tenants/{tenant-id}/clients/{client-id}
Authorization: Bearer {access_token}
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```json
{
  "client_id": "my-app",
  "client_name": "My Application",
  "redirect_uris": ["https://app.example.com/callback"],
  "response_types": ["code"],
  "grant_types": ["authorization_code", "refresh_token"],
  "scope": "openid profile email",
  "token_endpoint_auth_method": "client_secret_basic",
  "application_type": "web",
  "extension": {
    "access_token_duration": 3600,
    "refresh_token_duration": 86400
  }
}
```

---

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ›´æ–°API

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```http
PUT /v1/management/organizations/{organization-id}/tenants/{tenant-id}/clients/{client-id}
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "client_name": "My Updated Application",
  "redirect_uris": [
    "https://app.example.com/callback",
    "https://app.example.com/silent-renew"
  ],
  "scope": "openid profile email address"
}
```

### Dry Runï¼ˆæ¤œè¨¼ã®ã¿ã€æ›´æ–°ãªã—ï¼‰

```http
PUT /v1/management/organizations/{organization-id}/tenants/{tenant-id}/clients/{client-id}?dry_run=true
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "redirect_uris": [
    "https://app.example.com/callback",
    "http://localhost:3000/callback"
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "dry_run": true,
  "validation_result": {
    "valid": true,
    "warnings": []
  }
}
```

---

## ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºç­–

### ã‚¨ãƒ©ãƒ¼1: redirect_uriä¸ä¸€è‡´

**ã‚¨ãƒ©ãƒ¼**:
```json
{
  "error": "invalid_request",
  "error_description": "redirect_uri does not match registered URIs"
}
```

**åŸå› **: Authorization Requestã®`redirect_uri`ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²æ™‚ã®`redirect_uris`ã«å«ã¾ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šã‚’ç¢ºèªãƒ»æ›´æ–°

```bash
# redirect_urisã«è¿½åŠ 
curl -X PUT "http://localhost:8080/v1/management/organizations/${ORGANIZATION_ID}/tenants/${PUBLIC_TENANT_ID}/clients/${CLIENT_ID}" \
  -H 'Content-Type: application/json' \
  -H "Authorization: Bearer ${ORG_ADMIN_TOKEN}" \
  -d '{
    "redirect_uris": [
      "https://app.example.com/callback",
      "http://localhost:3000/callback"
    ]
  }'
```

### ã‚¨ãƒ©ãƒ¼2: unsupported_grant_type

**ã‚¨ãƒ©ãƒ¼**:
```json
{
  "error": "unsupported_grant_type",
  "error_description": "grant_type 'refresh_token' is not allowed for this client"
}
```

**åŸå› **: Token Requestã§ä½¿ç”¨ã—ãŸ`grant_type`ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®`grant_types`ã«å«ã¾ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**: `grant_types`ã«è¿½åŠ 

```bash
curl -X PUT "http://localhost:8080/v1/management/organizations/${ORGANIZATION_ID}/tenants/${PUBLIC_TENANT_ID}/clients/${CLIENT_ID}" \
  -H 'Content-Type: application/json' \
  -H "Authorization: Bearer ${ORG_ADMIN_TOKEN}" \
  -d '{
    "grant_types": ["authorization_code", "refresh_token"]
  }'
```

### ã‚¨ãƒ©ãƒ¼3: invalid_scope

**ã‚¨ãƒ©ãƒ¼**:
```json
{
  "error": "invalid_scope",
  "error_description": "Requested scope 'admin' is not allowed"
}
```

**åŸå› **: Authorization Requestã§è¦æ±‚ã—ãŸã‚¹ã‚³ãƒ¼ãƒ—ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®`scope`ã¾ãŸã¯ãƒ†ãƒŠãƒ³ãƒˆã®`scopes_supported`ã«å«ã¾ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ›´æ–°
2. ãƒ†ãƒŠãƒ³ãƒˆã®`scopes_supported`ã«è¿½åŠ 

```bash
# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ›´æ–°
curl -X PUT "http://localhost:8080/v1/management/organizations/${ORGANIZATION_ID}/tenants/${PUBLIC_TENANT_ID}/clients/${CLIENT_ID}" \
  -H 'Content-Type: application/json' \
  -H "Authorization: Bearer ${ORG_ADMIN_TOKEN}" \
  -d '{
    "scope": "openid profile email admin"
  }'
```

---

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### âœ… æ¨å¥¨

1. **æœ€å°æ¨©é™ã®åŸå‰‡**
   ```json
   // âœ… å¿…è¦ãªã‚¹ã‚³ãƒ¼ãƒ—ã®ã¿
   "scope": "openid profile email"

   // âŒ å…¨éƒ¨è¨±å¯ï¼ˆå±é™ºï¼‰
   "scope": "openid profile email phone address update delete admin"
   ```

2. **response_types ã¯ code ã®ã¿**
   ```json
   "response_types": ["code"]
   ```

3. **grant_types ã¯æœ€å°é™**
   ```json
   // âœ… æ¨™æº–çš„
   "grant_types": ["authorization_code", "refresh_token"]

   // âŒ å…¨éƒ¨è¨±å¯ï¼ˆä¸è¦ãªã‚‚ã®ã‚’æœ‰åŠ¹åŒ–ï¼‰
   "grant_types": ["authorization_code", "refresh_token", "password", "client_credentials"]
   ```

4. **redirect_uris ã¯å³å¯†ã«**
   ```json
   // âœ… å¿…è¦ãªURIã®ã¿
   "redirect_uris": ["https://app.example.com/callback"]

   // âŒ é–‹ç™ºç”¨URLã‚’æœ¬ç•ªã«æ®‹ã™ï¼ˆå±é™ºï¼‰
   "redirect_uris": [
     "https://app.example.com/callback",
     "http://localhost:3000/callback"  // æœ¬ç•ªç’°å¢ƒã§ã¯å‰Šé™¤
   ]
   ```

5. **client_secretã®å®‰å…¨ãªç®¡ç†** (RFC 6749 Section 2.3.1, 10.1)
   - ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ï¼ˆã‚³ãƒ¼ãƒ‰ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ãªã„ï¼‰
   - HTTPSã§é€ä¿¡ï¼ˆå¹³æ–‡é€ä¿¡ç¦æ­¢ï¼‰
   - æ¼æ´©ãŒç–‘ã‚ã‚Œã‚‹å ´åˆã¯å³åº§ã«ç„¡åŠ¹åŒ–

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²ãŒã§ãã¾ã—ãŸï¼

### èªè¨¼ã‚’å®Ÿè¡Œ
- [How-to: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã¨èªè¨¼](./how-to-05-user-registration.md) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã¨åˆå›ãƒ­ã‚°ã‚¤ãƒ³

### é«˜åº¦ãªè¨­å®š
- [Developer Guide: Clientè¨­å®š](../content_06_developer-guide/05-configuration/client.md) - è©³ç´°ãªè¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³
- [How-to: CIBA Flow](./how-to-12-ciba-flow-fido-uaf.md) - ãƒãƒƒã‚¯ãƒãƒ£ãƒãƒ«èªè¨¼

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Concept: OAuth 2.0ã¨OpenID Connect](../content_03_concepts/basic/basic-11-oauth-oidc-basics.md) - ãƒ—ãƒ­ãƒˆã‚³ãƒ«æ¦‚è¦
- [Developer Guide: Client Authentication](../content_06_developer-guide/03-application-plane/10-client-authentication.md) - 7ã¤ã®èªè¨¼æ–¹å¼è©³ç´°
- [API Reference](../content_07_reference/api-reference.md) - Management APIä»•æ§˜

---

**æœ€çµ‚æ›´æ–°**: 2025-10-14
