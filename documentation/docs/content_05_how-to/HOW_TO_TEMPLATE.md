# How-toドキュメント 標準構造テンプレート

このテンプレートは、content_05_how-to配下の全ドキュメントで統一すべき構造を定義します。

---

## 標準構造（必須セクション）

```markdown
# {機能名}ガイド

## このドキュメントの目的

**{何ができるようになるか}**を1-2文で明確に記述

### 所要時間
⏱️ **約{X}分**

### このドキュメントの位置づけ

**Phase {N}**: {Phase名}

**前提ドキュメント**:
- [how-to-XX](./how-to-XX.md) - {前提1}
- [how-to-YY](./how-to-YY.md) - {前提2}

### 前提条件
- {条件1}
- {条件2}
- {条件3}

---

## {機能名}とは

**概念説明**:
- なぜこの機能が必要か
- どのような問題を解決するか
- 簡単な動作フロー図

```
{簡単なフロー図}
```

---

## Step 1: {最初のステップ}

### {サブステップ1-1}

```bash
# 実行可能なコマンド例
curl ...
```

**レスポンス**:
```json
{期待されるレスポンス}
```

**ポイント**:
- ✅ {重要ポイント1}
- ✅ {重要ポイント2}

---

## Step 2: {次のステップ}

（Step 1と同じ構造）

---

## 動作確認

### テスト手順

```bash
# 設定が正しく動作することを確認
```

### チェックリスト

- [ ] {確認項目1}
- [ ] {確認項目2}
- [ ] {確認項目3}

---

## よくあるエラー

### エラー1: {エラー名}

**エラーメッセージ**:
```
{実際のエラー}
```

**原因**: {原因説明}

**解決策**:
```bash
{解決コマンド}
```

---

## 次のステップ

✅ {この機能}を設定できました！

### 推奨される次のステップ

**同じPhase**:
- [how-to-XX](./how-to-XX.md) - {関連機能}

**次のPhase**:
- [how-to-YY](./how-to-YY.md) - {次の機能}

### 関連ドキュメント
- [Concept](../content_03_concepts/...) - 概念理解
- [Configuration](../content_06_developer-guide/05-configuration/...) - 設定詳細
- [Implementation](../content_06_developer-guide/04-implementation-guides/...) - 実装詳細

---

**最終更新**: YYYY-MM-DD
**難易度**: ⭐⭐⭐☆☆
**対象**: {対象ユーザー}
**習得スキル**: {習得できるスキル}
```

---

## Phase別の必須要素

### Phase 1（最小構成）の追加要素

```markdown
## Phase 1での位置づけ

この設定は**最小構成で動作させるために必須**です。

**Phase 1完了時の状態**:
- ✅ {できること1}
- ✅ {できること2}
- ❌ {まだできないこと}
```

### Phase 2-4（拡張機能）の追加要素

```markdown
## なぜこの機能が必要か

**Phase 1の最小構成では**:
- ❌ {できないこと}
- ❌ {制限事項}

**この機能を追加すると**:
- ✅ {新しくできること}
- ✅ {改善されること}

### いつ追加すべきか

- ✅ {推奨タイミング}
- △ {オプショナル}
- ❌ {不要なケース}
```

---

## セクション別ガイドライン

### 1. 目的セクション

**良い例**:
```markdown
## このドキュメントの目的

**MFA（多要素認証）**を設定し、パスワード+OTPの2段階認証を実現することが目標です。
```

**悪い例**:
```markdown
## このドキュメントの目的

MFAについて説明します。
```

### 2. 前提条件セクション

**必須記載**:
- 前のPhaseで完了すべきこと
- 必要な管理者権限
- 必要なトークン・ID
- 前提知識（OAuth等）

**良い例**:
```markdown
### 前提条件
- [how-to-03 クライアント登録](./how-to-03.md)完了
- [how-to-04 パスワード認証](./how-to-04.md)完了
- 管理者トークン取得済み
- OAuth 2.0基礎知識（オプション）
```

### 3. 概念説明セクション

**必須要素**:
- なぜ必要か（Why）
- 何をするものか（What）
- どう動作するか（How）
- 簡単なフロー図

**良い例**:
```markdown
## MFAとは

**多要素認証（MFA）**は、パスワードだけでなく追加の認証要素を要求することで、セキュリティを強化します。

**なぜ必要か**:
- パスワード漏洩への対策
- フィッシング攻撃への耐性
- コンプライアンス要件（金融・医療等）

**動作フロー**:
\```
ユーザー → パスワード入力 → OTP送信 → OTP入力 → 認証完了
\```
```

### 4. 実装手順（Step-by-Step）

**原則**:
- Stepは順番に実行可能
- 各Stepでコピペ可能なコマンド
- 期待されるレスポンスを明示
- 重要ポイントを箇条書き

**良い例**:
```markdown
## Step 1: 認証設定を作成

\```bash
curl -X POST "http://localhost:8080/..." \
  -H "Content-Type: application/json" \
  -d '{...}'
\```

**レスポンス**:
\```json
{"result": {...}}
\```

**ポイント**:
- ✅ enabled: trueで有効化
- ✅ typeは一意である必要がある
```

### 5. 動作確認セクション

**必須要素**:
- テストコマンド
- 期待される結果
- チェックリスト

**良い例**:
```markdown
## 動作確認

### テスト手順

\```bash
# 設定が正しく登録されているか確認
curl -X GET "http://localhost:8080/..."
\```

### チェックリスト

- [ ] 設定がManagement APIで取得できる
- [ ] enabled: trueになっている
- [ ] 認証フローで使用できる
```

### 6. よくあるエラーセクション

**必須要素**:
- 実際のエラーメッセージ
- 原因の明確な説明
- 具体的な解決策（コマンド付き）

**最低3つのエラーを記載**

### 7. 次のステップセクション

**必須要素**:
- 同じPhaseの関連ドキュメント
- 次のPhaseへの誘導
- 関連する詳細ドキュメント（Concept/Configuration/Implementation）

**良い例**:
```markdown
## 次のステップ

✅ パスワード認証を設定できました！

### Phase 1を完了しよう

- [how-to-05 認証ポリシー](./how-to-05.md) - Phase 1の最終ステップ

### セキュリティを強化（Phase 2）

- [how-to-06 MFA設定](./how-to-06.md) - 多要素認証でセキュリティ向上

### さらに詳しく

- [Configuration: Password](../content_06_developer-guide/05-configuration/authentication-policy.md)
- [Concept: 認証ポリシー](../content_03_concepts/concept-05-authentication-policy.md)
```

---

## フェーズ間の連携

### Phase 1 → Phase 2 の橋渡し

**Phase 1最後のドキュメント（how-to-05）の「次のステップ」**:
```markdown
## 次のステップ

✅ **Phase 1完了**: 最小構成で動作確認できました！

### Phase 2でセキュリティを強化しよう

現在の設定では:
- ❌ パスワードのみ（漏洩リスク）
- ❌ トークン有効期限がデフォルト
- ❌ アカウントロック機能なし

**Phase 2を完了すると**:
- ✅ 2要素認証（MFA）
- ✅ 最適化されたトークン戦略
- ✅ 不正アクセス対策

**次に進む**:
- [how-to-06 MFA設定](./how-to-06.md)
```

---

## スタイルガイド

### ✅ 推奨

1. **実行可能なコマンド**: コピペで動作するcurl例
2. **環境変数使用**: `${TENANT_ID}`等で汎用化
3. **段階的な説明**: Level 1, Level 2... または Step 1, Step 2...
4. **視覚的な要素**: ✅❌△等の記号、簡単なフロー図
5. **実例の充実**: 最小構成 → 実用例 の順序
6. **エラー対処**: 最低3つのよくあるエラーを記載

### ❌ 避けるべき

1. **抽象的な説明のみ**: 具体例なし
2. **動作しない例**: 古いAPI、誤った設定
3. **専門用語の乱用**: 説明なしでACR, PKCE等を使用
4. **特定企業・サービス名**: Google, Slack等（一般化する）
5. **内部リポジトリ参照**: `sbishinsei-idp-config`等

---

## チェックリスト

新しいhow-toドキュメントを作成する際のチェックリスト：

### 必須セクション
- [ ] タイトル（# {機能名}ガイド）
- [ ] このドキュメントの目的
- [ ] 所要時間
- [ ] Phase位置づけ
- [ ] 前提条件
- [ ] 概念説明（{機能名}とは）
- [ ] Step-by-Step手順（最低2ステップ）
- [ ] 動作確認
- [ ] よくあるエラー（最低3つ）
- [ ] 次のステップ
- [ ] メタデータ（最終更新日、難易度、対象、習得スキル）

### コンテンツ品質
- [ ] コピペ可能なコマンド例
- [ ] 期待されるレスポンス
- [ ] 重要ポイントの箇条書き
- [ ] チェックリスト
- [ ] フロー図（簡単なもの）
- [ ] 段階的な説明（最小構成 → 高度）
- [ ] エラー対処（実際のエラーメッセージ）

### リンク
- [ ] 前のドキュメントへのリンク
- [ ] 次のドキュメントへのリンク
- [ ] 関連Conceptドキュメント
- [ ] 関連Configurationドキュメント
- [ ] 関連Implementationドキュメント

### OSS配慮
- [ ] 特定企業名なし
- [ ] 実在サービス名は一般化
- [ ] 例示ドメインは`example.com`使用
- [ ] 内部リポジトリ参照なし

---

## 実例: 良い構造の例

### how-to-03-client-registration.md

✅ **良い点**:
- Phase位置づけ明記
- Level 1-8の段階的説明
- 3種類のクライアント例（Mobile/Web/M2M）
- 実行可能なcurl例
- よくあるエラー3つ
- 次のステップが明確

### how-to-04-password-authentication.md

✅ **良い点**:
- Step-by-Step（1-5）
- 各Stepで確認方法
- 最小構成の例
- エラー対処が具体的

---

## Phase別の特別要件

### Phase 1ドキュメント（how-to-01〜05）

**追加要素**:
```markdown
## Phase 1完了時の状態

この設定まで完了すると:
- ✅ {できること1}
- ✅ {できること2}
- ⚠️ {制限事項}

**Phase 2に進むと**:
- さらに{改善内容}
```

### Phase 2-4ドキュメント（how-to-06〜16）

**追加要素**:
```markdown
## なぜこの機能が必要か

**Phase 1の最小構成では**:
- ❌ {できないこと}
- ❌ {セキュリティリスク}

**この機能を追加すると**:
- ✅ {解決すること}
- ✅ {向上すること}

### いつ追加すべきか

- ✅ {必須のケース}
- △ {推奨のケース}
- ❌ {不要なケース}
```

---

## 相互リンク戦略

### 前方リンク（Forward Reference）

各ドキュメントの「次のステップ」で:
1. 同じPhaseの次のドキュメント
2. 次のPhaseの最初のドキュメント

### 後方リンク（Backward Reference）

各ドキュメントの「前提ドキュメント」で:
1. 直前のドキュメント
2. 前提となる設定のドキュメント

### 例

**how-to-05（Phase 1最後）**:
```markdown
## 次のステップ

✅ **Phase 1完了！**

### Phase 2でセキュリティを強化
- [how-to-06 MFA設定](./how-to-06.md) ← 次のPhaseへ誘導
```

**how-to-06（Phase 2最初）**:
```markdown
### 前提ドキュメント
- [how-to-05 認証ポリシー](./how-to-05.md) - Phase 1完了
- [how-to-04 パスワード認証](./how-to-04.md) - 基本認証設定
```

---

## 品質基準

### 最低品質基準

- **理解しやすさ**: ⭐⭐⭐☆☆ (3/5)以上
- **実用性**: ⭐⭐⭐⭐☆ (4/5)以上
- **完全性**: ⭐⭐⭐☆☆ (3/5)以上
- **初学者適合度**: ⭐⭐⭐☆☆ (3/5)以上

### 目標品質

- **Phase 1ドキュメント**: 全て⭐⭐⭐⭐☆ (4/5)以上
- **Phase 2-4ドキュメント**: ⭐⭐⭐⭐☆ (4/5)以上推奨

---

## メタデータ標準

```markdown
**最終更新**: YYYY-MM-DD
**難易度**: ⭐⭐⭐☆☆（1-5段階）
**対象**: {初心者/中級者/上級者/管理者}
**習得スキル**: {具体的なスキル}
```

**難易度ガイドライン**:
- ⭐☆☆☆☆: 知識不要、コピペで完了
- ⭐⭐☆☆☆: OAuth基礎知識推奨
- ⭐⭐⭐☆☆: OAuth理解必須
- ⭐⭐⭐⭐☆: JSONPath/高度な設定
- ⭐⭐⭐⭐⭐: 実装レベルの理解必要

---

**作成日**: 2025-01-15
**用途**: How-toドキュメント作成・レビューの基準
