# ログイン

[← ユースケース一覧に戻る](./quickstart-03-common-use-cases.md)

---

## できること

ユーザーがアプリケーションにログインする基本的な機能を提供します。

- **パスワードでログイン**: メールアドレス・ユーザー名とパスワード
- **Socialログイン**: SNS、メールサービス等のアカウントを利用
- **新規ユーザー登録**: 初めて利用するユーザーの登録
- **パスワードリセット**: パスワードを忘れた場合の再設定

---

## 導入時に決めること

### 1. どの方法でログインさせるか

| 選択肢 | 説明                      | 向いているケース |
|-------|-------------------------|----------------|
| **パスワード認証のみ** | メールアドレス/ユーザー名 + パスワード   | 社内システム、独自サービス |
| **外部サービスログイン** | SNS、エンタープライズのアカウントでログイン | 一般消費者向けサービス |
| **両方を併用** | ユーザーが選択可能               | 幅広いユーザー層のサービス |

**idp-serverでの設定**:
- 認証ポリシーで利用可能な認証方式を定義
- 外部サービスログイン用の外部IdP連携設定を追加

### 2. パスワードの強度をどうするか

| 決めること | 選択肢の例 |
|-----------|-----------|
| **最小文字数** | 8文字以上、12文字以上 |
| **必須文字種** | 英数字必須、記号必須 |
| **パスワード有効期限** | なし、90日、180日 |
| **過去パスワードの再利用** | 禁止しない、直近3回禁止、直近5回禁止 |

**idp-serverでの設定**:
- パスワードポリシーで文字数、複雑さの要件を設定
- 有効期限、履歴管理のルールを設定

### 3. ログイン失敗時の挙動

| 決めること | 選択肢の例 |
|-----------|-----------|
| **アカウントロック条件** | 5回失敗でロック、10回失敗でロック |
| **ロック期間** | 30分、1時間、管理者が解除するまで |
| **失敗回数のリセット** | 成功したらリセット、24時間後にリセット |

**idp-serverでの設定**:
- 認証ポリシーでロック条件（失敗回数、期間）を設定
- リセット条件を設定

### 4. ユーザー登録時に何を入力させるか

| 決めること | 選択肢の例 |
|-----------|-----------|
| **必須項目** | メールアドレスのみ、氏名も必須、電話番号も必須 |
| **メール確認** | する、しない |
| **利用規約への同意** | 必須、任意 |

**idp-serverでの設定**:
- ユーザースキーマで必須項目を定義
- メール確認フローの有効化/無効化
- 同意管理の設定

### 5. 外部サービスログイン

#### 5-1. どの種類の外部サービスログインを使うか

| 選択肢 | 説明 | 向いているケース |
|-------|------|----------------|
| **SNSアカウント** | 高普及率、ユーザーが使い慣れている | 一般消費者向けサービス |
| **エンタープライズアカウント** | 法人利用に強い | 企業向けサービス |
| **複数併用** | ユーザーが選択可能 | 幅広いユーザー層 |

**idp-serverでの設定**:
- 各サービスのClient ID/Secretを登録
- 認証ポリシーで利用可能なサービスを定義

#### 5-2. ログイン時のユーザー情報の取得範囲

| 決めること | 選択肢の例 |
|-----------|-----------|
| **基本情報** | 氏名・メールアドレス必須、プロフィール画像任意 |
| **追加情報** | 誕生日、性別、電話番号等 |
| **権限スコープ** | 最小限のみ、必要な情報全て |

**idp-serverでの設定**:
- ログイン時に要求する情報の範囲を設定
- 取得した情報のマッピングルールを定義

#### 5-3. 既存アカウントとの紐付け

外部サービスログインでは、常に新規アカウントとして作成されます。

**動作**:
- 外部サービスごとに別々のアカウントとして扱われる
- 既存のパスワード認証アカウントとの自動紐付けは行われない

---

## 関連ドキュメント

- [How-to: ユーザー登録・パスワード認証](../content_05_how-to/phase-1-foundation/05-user-registration.md)
- [How-to: 認証ポリシー設定](../content_05_how-to/phase-1-foundation/07-authentication-policy.md)
- [How-to: 外部IdP連携](../content_05_how-to/phase-3-advanced/01-federation-setup.md)

---

**最終更新**: 2026-01-27
