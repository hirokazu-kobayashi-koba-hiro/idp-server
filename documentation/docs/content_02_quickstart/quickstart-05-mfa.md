# MFA（多要素認証）

[← ユースケース一覧に戻る](./quickstart-03-common-use-cases.md)

---

## できること

ログイン時にパスワード以外の認証要素を組み合わせて、セキュリティを強化します。

- **SMS認証**: 電話番号に送られたコードを入力
- **メール認証**: メールアドレスに送られたコードを入力

---

## 導入時に決めること

### 1. どの認証要素を組み合わせるか

| 選択肢 | 説明 | 向いているケース |
|-------|------|----------------|
| **パスワード + SMS** | 最も一般的、ユーザーが慣れている | 金融サービス、決済アプリ |
| **パスワード + メール** | 追加コストなし | 業務システム、SaaS |
| **選択式** | ユーザーがSMS/メールから選ぶ | 幅広いユーザー層 |

**idp-serverでの設定**:
- 認証ポリシーで必要な認証要素の組み合わせを定義
- SMS/メール送信サービスとの連携設定

### 2. MFAを誰に適用するか

| 選択肢 | 説明 |
|-------|------|
| **全ユーザー必須** | 全員がMFAを使う |
| **管理者のみ必須** | 一般ユーザーは任意、管理者は必須 |
| **ユーザーが選択** | MFAを使うかどうかユーザーが決める |
| **特定操作のみ必須** | 送金等の重要操作時のみMFA要求 |

**idp-serverでの設定**:
- 認証ポリシーの適用条件（クライアントID、ユーザー属性等）を設定
- 操作別の認証要件を定義

### 3. 第2要素の登録をいつさせるか

| 選択肢 | 説明 |
|-------|------|
| **初回ログイン時** | アカウント作成直後に登録 |
| **任意のタイミング** | ユーザーが好きな時に登録 |
| **必要になった時** | MFA必要な操作時に促す |

**idp-serverでの設定**:
- 登録フローのタイミングを設定
- 未登録時の挙動を定義

### 4. 認証コードの有効期限

| 決めること | 選択肢の例 |
|-----------|-----------|
| **コード有効期限** | 3分、5分、10分 |
| **認証試行回数** | 3回まで、5回まで |

**idp-serverでの設定**:
- SMS/メール認証設定で有効期限、リトライ回数を設定

---

## 関連ドキュメント

- [How-to: MFA設定](../content_05_how-to/phase-2-security/01-mfa-setup.md)
- [How-to: 認証ポリシー設定](../content_05_how-to/phase-1-foundation/07-authentication-policy.md)

---

**最終更新**: 2026-01-27
