# OWASP Top 10 2025 セキュリティ診断 - Sub-Issue 分割

**診断対象**: idp-server (OAuth 2.0/OIDC/CIBA/FAPI準拠IDプラットフォーム)  
**診断実施日**: 2025-10-09  
**診断基準**: OWASP Top 10 2025  
**総合セキュリティスコア**: 73.5/100 (良好、要改善点あり)  
**元Issue**: #[メインIssue番号を記載]

---

## 📋 Sub-Issue 分類一覧

### 🔴 Phase 1: Critical Issues (即時対応必須 - 1週間以内)

#### Issue #1: [A03] TransactionManager SQLインジェクション脆弱性修正
**優先度**: 🔴 Critical  
**CVSS**: 9.8  
**工数**: 2日  
**担当**: Senior Security Engineer

**問題の詳細**:
- **ファイル**: `libs/idp-server-platform/src/main/java/org/idp/server/platform/datasource/TransactionManager.java:132`
- **脆弱性**: PostgreSQL RLS設定で文字列連結を使用
- **影響**: テナント分離機構の突破、データ削除/改ざんのリスク

**現在のコード**:
```java
stmt.execute("SET app.tenant_id = '" + tenantIdentifier.value() + "'");  // ← 脆弱
```

**修正内容**:
```java
private static void setTenantId(Connection conn, TenantIdentifier tenantIdentifier) {
  log.debug("[RLS] SET app.tenant_id: tenant={}", tenantIdentifier.value());
  
  try {
    UUID tenantUuid = tenantIdentifier.valueAsUuid();  // UUID検証
    try (var stmt = conn.prepareStatement("SELECT set_config('app.tenant_id', ?::text, false)")) {
      stmt.setString(1, tenantUuid.toString());
      stmt.execute();
    }
  } catch (SQLException e) {
    throw new SqlRuntimeException("Failed to set tenant_id", e);
  }
}
```

**検証項目**:
- [ ] UUID検証が正しく動作することを確認
- [ ] PreparedStatement使用によりSQLインジェクションが不可能であることを確認
- [ ] 全E2Eテスト実行（特にマルチテナント関連）
- [ ] 手動SQLインジェクション攻撃試行でブロックされることを確認
- [ ] パフォーマンスへの影響を確認

**関連ファイル**:
- `libs/idp-server-platform/src/main/java/org/idp/server/platform/multi_tenancy/tenant/TenantIdentifier.java`
- テストファイル: `libs/idp-server-platform/src/test/java/org/idp/server/platform/datasource/TransactionManagerTest.java`（作成が必要な場合）

---

#### Issue #2: [A06] Nimbus JOSE + JWT ライブラリ更新
**優先度**: 🔴 Critical  
**CVSS**: 7.5  
**工数**: 1日 + 検証2日  
**担当**: Backend Developer + QA Engineer

**問題の詳細**:
- **現在のバージョン**: 9.30.2
- **修正版**: 10.5以降
- **CVE**:
  - CVE-2025-53864 (CVSS 5.8): 深いネストJSONによるDoS
  - CVE-2024-31214 (CVSS 7.5): JWE p2c大値によるDoS
- **影響**: JWT処理はOIDC/OAuth 2.0の中核機能

**修正内容**:
```gradle
// File: libs/idp-server-platform/build.gradle
-implementation 'com.nimbusds:nimbus-jose-jwt:9.30.2'
+implementation 'com.nimbusds:nimbus-jose-jwt:10.5'
```

**検証項目**:
- [ ] Gradleビルド成功を確認
- [ ] 全ユニットテスト実行（JWT関連）
- [ ] 全E2Eテスト実行（OIDC認証フロー）
- [ ] JWT署名検証が正常動作することを確認
- [ ] Authorization Code Flow、CIBA Flow、FAPI Flowの動作確認
- [ ] 既存のJWT生成・検証ロジックとの互換性確認
- [ ] パフォーマンステスト実行

**関連ファイル**:
- `libs/idp-server-platform/build.gradle`
- `libs/idp-server-platform/src/main/java/org/idp/server/platform/jose/*`
- E2Eテスト: `e2e/spec/oauth2/authorization-code-flow.spec.js`

---

#### Issue #3: [A06] Docker Base Image 更新とセキュリティ強化
**優先度**: 🔴 Critical  
**CVSS**: 7.5  
**工数**: 1日  
**担当**: DevOps Engineer

**問題の詳細**:
- **現在のイメージ**: `openjdk:21-slim`
- **CVE**:
  - CVE-2025-32988, CVE-2025-32989: GnuTLS脆弱性
  - CVE-2025-6020: Linux PAM権限昇格
- **対策**: より安全な`eclipse-temurin:21-jre-alpine`への移行

**修正内容**:
```dockerfile
# File: Dockerfile
-FROM gradle:8.5-jdk21 AS builder
+FROM gradle:8.14-jdk21-alpine AS builder

-FROM openjdk:21-slim AS runtime
+FROM eclipse-temurin:21-jre-alpine AS runtime

+# 非rootユーザーで実行
+RUN addgroup -S idpserver && \
+    adduser -S idpserver -G idpserver && \
+    chown -R idpserver:idpserver /app
+USER idpserver
```

**検証項目**:
- [ ] Docker build成功を確認
- [ ] コンテナ起動を確認
- [ ] 非rootユーザーで動作していることを確認（`docker exec ... whoami`）
- [ ] アプリケーションが正常動作することを確認
- [ ] イメージサイズの比較（最適化確認）
- [ ] Trivyスキャンで脆弱性がないことを確認

**関連ファイル**:
- `Dockerfile`
- `docker-compose.yaml`
- `.github/workflows/*` (CI/CDパイプライン)

---

#### Issue #4: [A05] デフォルト認証情報の削除
**優先度**: 🔴 Critical  
**CVSS**: 9.8  
**工数**: 1日  
**担当**: DevOps Engineer

**問題の詳細**:
- **ファイル**: 
  - `app/src/main/resources/application.yaml:17-18, 25-26`
  - `libs/idp-server-database/postgresql/operation/01-create-users.sh:9-10`
  - `.env.local:4-5, 13, 17`
- **脆弱性**: `idpserver/idpserver` がデフォルトパスワードとしてハードコード
- **影響**: 本番環境での誤使用リスク

**修正内容**:
```yaml
# File: app/src/main/resources/application.yaml
# デフォルト値を削除し、環境変数必須化
-username: "${CONTROL_PLANE_DB_WRITER_USER_NAME:idpserver}"
-password: "${CONTROL_PLANE_DB_WRITER_PASSWORD:idpserver}"
+username: "${CONTROL_PLANE_DB_WRITER_USER_NAME}"
+password: "${CONTROL_PLANE_DB_WRITER_PASSWORD}"
```

```bash
# File: libs/idp-server-database/postgresql/operation/01-create-users.sh
# デフォルトパスワード削除、環境変数必須化
-: "${IDP_DB_ADMIN_PASSWORD:=idp_admin_user}"
+: "${IDP_DB_ADMIN_PASSWORD:?IDP_DB_ADMIN_PASSWORD is required}"
```

```gitignore
# File: .gitignore に追加
.env.local
.env
```

**検証項目**:
- [ ] 環境変数未設定時にアプリケーション起動が失敗することを確認
- [ ] 環境変数設定時に正常起動することを確認
- [ ] `.env.local`がGit管理から除外されていることを確認
- [ ] ドキュメント更新（環境変数設定方法）
- [ ] CI/CDパイプラインでの環境変数設定を確認

**関連ファイル**:
- `app/src/main/resources/application.yaml`
- `libs/idp-server-database/postgresql/operation/01-create-users.sh`
- `.gitignore`
- `documentation/docs/content_05_how-to/deployment.md`

---

### 🟠 Phase 2: High Priority Issues (2週間以内)

#### Issue #5: [A10] HttpRequestExecutor SSRF対策実装
**優先度**: 🟠 High  
**CVSS**: 7.5  
**工数**: 3日  
**担当**: Security Engineer

**問題の詳細**:
- **ファイル**: `libs/idp-server-platform/src/main/java/org/idp/server/platform/http/HttpRequestExecutor.java`
- **脆弱性**: プライベートIP検証の欠如
- **影響**: 
  - Webhook送信時の内部ネットワークアクセス
  - Identity Verification外部APIコールのSSRF
  - OIDC Federation well-known URLフェッチの攻撃面

**実装内容**:
新規クラス `HttpUrlValidator` を作成:
```java
// File: libs/idp-server-platform/src/main/java/org/idp/server/platform/http/HttpUrlValidator.java
package org.idp.server.platform.http;

import java.net.InetAddress;
import java.net.URI;
import java.net.UnknownHostException;
import java.util.List;

public class HttpUrlValidator {
    private static final List<String> PRIVATE_IP_RANGES = List.of(
        "127.0.0.0/8",    // Loopback
        "10.0.0.0/8",     // Private Class A
        "172.16.0.0/12",  // Private Class B
        "192.168.0.0/16", // Private Class C
        "169.254.0.0/16", // Link-local
        "::1/128",        // IPv6 Loopback
        "fc00::/7",       // IPv6 Unique Local
        "fe80::/10"       // IPv6 Link-local
    );

    public void validateUrl(URI uri) throws SsrfException {
        try {
            InetAddress address = InetAddress.getByName(uri.getHost());
            if (isPrivateNetwork(address) || address.isLoopbackAddress()) {
                throw new SsrfException(
                    "Access to private network is forbidden: " + uri.getHost()
                );
            }
        } catch (UnknownHostException e) {
            throw new SsrfException("Invalid hostname: " + uri.getHost(), e);
        }
    }

    private boolean isPrivateNetwork(InetAddress address) {
        // RFC 1918, RFC 4193 実装
        byte[] addr = address.getAddress();
        // 実装詳細...
    }
}
```

`HttpRequestExecutor` に統合:
```java
public HttpRequestResult execute(HttpRequest httpRequest) {
    // URL検証を追加
    httpUrlValidator.validateUrl(httpRequest.uri());
    // 既存の実行ロジック
}
```

**検証項目**:
- [ ] プライベートIPアドレスへのアクセスがブロックされることを確認
- [ ] ループバックアドレスへのアクセスがブロックされることを確認
- [ ] IPv6プライベートアドレスへのアクセスがブロックされることを確認
- [ ] 正当な外部URLが正常に動作することを確認
- [ ] DNS rebinding攻撃への対策を確認
- [ ] ユニットテスト作成（正常系・異常系）
- [ ] E2Eテスト実行（Webhook, Identity Verification）

**関連ファイル**:
- `libs/idp-server-platform/src/main/java/org/idp/server/platform/http/HttpUrlValidator.java`（新規）
- `libs/idp-server-platform/src/main/java/org/idp/server/platform/http/HttpRequestExecutor.java`
- `libs/idp-server-platform/src/main/java/org/idp/server/platform/http/SsrfException.java`（新規）

---

#### Issue #6: [A01] CORS Origin検証の修正
**優先度**: 🟠 High  
**CVSS**: 6.5  
**工数**: 1日  
**担当**: Backend Developer

**問題の詳細**:
- **ファイル**: `libs/idp-server-springboot-adapter/src/main/java/org/idp/server/adapters/springboot/DynamicCorsFilter.java:61-64`
- **脆弱性**: `contains()` による部分一致検証
- **影響**: Origin Validation Bypass、サブドメイン乗っ取り攻撃のリスク

**現在のコード**:
```java
String allowOrigin = allowOrigins.stream()
    .filter(allow -> allow.contains(origin))  // ← 危険
    .findFirst()
    .orElse(tenant.domain().value());
```

**修正内容**:
```java
String allowOrigin = allowOrigins.stream()
    .filter(allow -> allow.equals(origin))  // 完全一致に変更
    .findFirst()
    .orElse("null");  // デフォルトを "null" に変更
```

**検証項目**:
- [ ] 正当なOriginが許可されることを確認
- [ ] 部分一致のOriginが拒否されることを確認
- [ ] サブドメイン乗っ取り攻撃が防げることを確認
- [ ] E2Eテスト実行（CORS関連）
- [ ] ユニットテスト作成

**関連ファイル**:
- `libs/idp-server-springboot-adapter/src/main/java/org/idp/server/adapters/springboot/DynamicCorsFilter.java`

---

#### Issue #7: [A04] レート制限機構の実装
**優先度**: 🟠 High  
**CVSS**: 6.5  
**工数**: 5日  
**担当**: Backend Developer + DevOps Engineer

**問題の詳細**:
- **影響範囲**: 
  - Token Endpoint
  - CIBA Backchannel Authentication Endpoint
  - Authorization Endpoint
- **リスク**: ブルートフォース攻撃、DoS攻撃、トークン生成過負荷

**実装内容**:
新規クラス `RedisRateLimiter` を作成:
```java
// File: libs/idp-server-platform/src/main/java/org/idp/server/platform/ratelimit/RedisRateLimiter.java
package org.idp.server.platform.ratelimit;

import java.time.Duration;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Component;

@Component
public class RedisRateLimiter {
    private final RedisTemplate<String, String> redisTemplate;

    public boolean allowRequest(String key, int maxRequests, Duration window) {
        String script =
            "local current = redis.call('incr', KEYS[1]) " +
            "if current == 1 then redis.call('expire', KEYS[1], ARGV[1]) end " +
            "return current <= tonumber(ARGV[2])";
        
        Long result = redisTemplate.execute(
            // Lua script実行
        );
        return result != null && result == 1L;
    }
}
```

Filterへの統合:
```java
// TokenEndpoint, CIBAEndpoint, AuthorizationEndpointに追加
if (!rateLimiter.allowRequest(clientId, 100, Duration.ofMinutes(1))) {
    throw new RateLimitExceededException("Too many requests");
}
```

**検証項目**:
- [ ] レート制限が正しく動作することを確認
- [ ] 制限超過時に適切なエラーが返却されることを確認
- [ ] 異なるクライアントIDで独立してカウントされることを確認
- [ ] ウィンドウ期間経過後にリセットされることを確認
- [ ] パフォーマンスへの影響を確認
- [ ] E2Eテスト作成（レート制限テスト）

**関連ファイル**:
- `libs/idp-server-platform/src/main/java/org/idp/server/platform/ratelimit/RedisRateLimiter.java`（新規）
- `libs/idp-server-platform/src/main/java/org/idp/server/platform/ratelimit/RateLimitExceededException.java`（新規）
- Token/CIBA/Authorization Endpoint実装ファイル

---

#### Issue #8: [A06] Spring Boot バージョン更新
**優先度**: 🟠 High  
**CVSS**: 6.1  
**工数**: 1日 + 検証2日  
**担当**: Backend Developer

**問題の詳細**:
- **現在のバージョン**: 3.4.2
- **修正版**: 3.4.5以降
- **CVE**: CVE-2025-22235 (Actuatorエンドポイント誤matcher)

**修正内容**:
```gradle
// File: app/build.gradle
-id 'org.springframework.boot' version '3.4.2'
+id 'org.springframework.boot' version '3.4.5'
```

**検証項目**:
- [ ] Gradleビルド成功を確認
- [ ] 全ユニットテスト実行
- [ ] 全E2Eテスト実行
- [ ] Spring Boot Actuatorエンドポイントの動作確認
- [ ] 既存機能との互換性確認

**関連ファイル**:
- `app/build.gradle`

---

### 🟡 Phase 3: Medium Priority Issues (1ヶ月以内)

#### Issue #9: [A05] セキュリティヘッダーの実装
**優先度**: 🟡 Medium  
**CVSS**: 5.3  
**工数**: 2日  
**担当**: Backend Developer

**問題の詳細**:
- **欠如しているヘッダー**:
  - `X-Frame-Options`: Clickjacking攻撃リスク
  - `X-Content-Type-Options`: MIME スニッフィング攻撃
  - `Strict-Transport-Security`: HTTPS強制なし
  - `Content-Security-Policy`: XSS攻撃軽減策なし

**実装内容**:
新規Filter作成:
```java
// File: libs/idp-server-springboot-adapter/src/main/java/org/idp/server/adapters/springboot/SecurityHeadersFilter.java
package org.idp.server.adapters.springboot;

import jakarta.servlet.*;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;
import org.springframework.stereotype.Component;

@Component
public class SecurityHeadersFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        httpResponse.setHeader("X-Frame-Options", "DENY");
        httpResponse.setHeader("X-Content-Type-Options", "nosniff");
        httpResponse.setHeader("X-XSS-Protection", "1; mode=block");
        httpResponse.setHeader("Strict-Transport-Security", 
            "max-age=31536000; includeSubDomains");
        httpResponse.setHeader("Content-Security-Policy", 
            "default-src 'self'");
        
        chain.doFilter(request, response);
    }
}
```

**検証項目**:
- [ ] 各ヘッダーがレスポンスに含まれることを確認
- [ ] ブラウザでの動作確認
- [ ] E2Eテスト実行
- [ ] パフォーマンスへの影響確認

**関連ファイル**:
- `libs/idp-server-springboot-adapter/src/main/java/org/idp/server/adapters/springboot/SecurityHeadersFilter.java`（新規）

---

#### Issue #10: [A07] アカウントロックアウト機構の実装
**優先度**: 🟡 Medium  
**CVSS**: 5.3  
**工数**: 3日  
**担当**: Backend Developer

**問題の詳細**:
- **リスク**: ブルートフォース攻撃、パスワードスプレー攻撃に無防備

**実装内容**:
```java
// File: libs/idp-server-core/src/main/java/org/idp/server/core/authentication/AccountLockoutManager.java
package org.idp.server.core.authentication;

import java.time.Duration;
import org.springframework.stereotype.Component;

@Component
public class AccountLockoutManager {
    private static final int MAX_FAILED_ATTEMPTS = 5;
    private static final Duration LOCKOUT_DURATION = Duration.ofMinutes(15);

    public void recordFailedAttempt(User user) {
        // Redis/DBにカウンター記録
        // exponential backoff実装
    }

    public boolean isLocked(User user) {
        // ロック状態確認
    }

    public void reset(User user) {
        // 成功時のリセット
    }
}
```

**検証項目**:
- [ ] 失敗回数が正しくカウントされることを確認
- [ ] ロックアウトが正常に動作することを確認
- [ ] ロックアウト期間経過後に解除されることを確認
- [ ] E2Eテスト作成

**関連ファイル**:
- `libs/idp-server-core/src/main/java/org/idp/server/core/authentication/AccountLockoutManager.java`（新規）
- 認証関連Handler/Serviceファイル

---

#### Issue #11: [A07] パスワードポリシーエンジンの実装
**優先度**: 🟡 Medium  
**CVSS**: 5.3  
**工数**: 2日  
**担当**: Backend Developer

**問題の詳細**:
- **現状**: テストコードのみに検証ロジック存在
- **必要な機能**:
  - 最小長12文字
  - 複雑性要件（大小文字、数字、記号）
  - パスワード履歴管理

**実装内容**:
```java
// File: libs/idp-server-core/src/main/java/org/idp/server/core/password/PasswordPolicy.java
package org.idp.server.core.password;

import java.util.List;

public class PasswordPolicy {
    private static final int MIN_LENGTH = 12;
    
    public ValidationResult validate(String password, List<String> previousHashes) {
        // 最小長チェック
        // 複雑性チェック
        // 履歴チェック
    }
}
```

**検証項目**:
- [ ] 各ポリシールールが正しく動作することを確認
- [ ] ユニットテスト作成
- [ ] E2Eテスト実行

**関連ファイル**:
- `libs/idp-server-core/src/main/java/org/idp/server/core/password/PasswordPolicy.java`（新規）

---

#### Issue #12: [A01] URLパターンマッチングの修正
**優先度**: 🟡 Medium  
**CVSS**: 5.3  
**工数**: 1日  
**担当**: Backend Developer

**問題の詳細**:
- **ファイル**: 
  - `ManagementApiFilter.java:110-113`
  - `DynamicCorsFilter.java:94`
- **脆弱性**: `contains()` によるURL検証、Path Traversal攻撃のリスク

**現在のコード**:
```java
if (request.getRequestURI().contains("/management/organizations/")) {
    return true;  // 攻撃例: /malicious/management/../../admin
}
```

**修正内容**:
```java
if (request.getRequestURI().startsWith("/management/organizations/")) {
    return true;
}
```

**検証項目**:
- [ ] Path Traversal攻撃が防げることを確認
- [ ] 正当なURLパターンが動作することを確認
- [ ] ユニットテスト作成

**関連ファイル**:
- `libs/idp-server-springboot-adapter/src/main/java/org/idp/server/adapters/springboot/ManagementApiFilter.java`
- `libs/idp-server-springboot-adapter/src/main/java/org/idp/server/adapters/springboot/DynamicCorsFilter.java`

---

#### Issue #13: [A01] ControlPlaneAuthorizer の認可実装
**優先度**: 🟡 Medium  
**CVSS**: 7.5  
**工数**: 3日  
**担当**: Security Engineer

**問題の詳細**:
- **ファイル**: `libs/idp-server-control-plane/src/main/java/org/idp/server/control_plane/base/authorizer/ControlPlaneAuthorizer.java:21-23`
- **脆弱性**: `authorize()` メソッドが常に `true` を返す

**現在のコード**:
```java
public boolean authorize(String authorizationHeader) {
    return true;  // ← 認可チェック完全スキップ
}
```

**実装内容**:
- JWT検証実装
- 管理者権限チェック
- テナントアクセス検証

**検証項目**:
- [ ] 認可ロジックが正しく動作することを確認
- [ ] 不正なトークンが拒否されることを確認
- [ ] ユニットテスト作成
- [ ] E2Eテスト実行

**関連ファイル**:
- `libs/idp-server-control-plane/src/main/java/org/idp/server/control_plane/base/authorizer/ControlPlaneAuthorizer.java`

---

### 🔵 Phase 4: Low Priority Issues (3ヶ月以内)

#### Issue #14: [A08] Gradle依存関係検証の統合
**優先度**: 🔵 Low  
**工数**: 2日  
**担当**: DevOps Engineer

**実装内容**:
```bash
./gradlew --write-verification-metadata sha256
```

**検証項目**:
- [ ] 依存関係検証が動作することを確認
- [ ] CI/CDパイプラインに統合

---

#### Issue #15: [A02] SHA-1/MD5の非推奨化
**優先度**: 🔵 Low  
**工数**: 1日  
**担当**: Backend Developer

**実装内容**:
```java
// File: libs/idp-server-platform/src/main/java/org/idp/server/platform/hash/HashAlgorithm.java
@Deprecated(since = "2025-10", forRemoval = true)
MD5,
@Deprecated(since = "2025-10", forRemoval = true)
SHA1,
```

**検証項目**:
- [ ] 非推奨警告が表示されることを確認
- [ ] UUID v4への移行計画作成

---

#### Issue #16: [A09] セキュリティログのスクラビング明示化
**優先度**: 🔵 Low  
**工数**: 1日  
**担当**: Backend Developer

**実装内容**:
機密情報フィルタリングの明示的実装

**検証項目**:
- [ ] 機密情報がログに出力されないことを確認

---

#### Issue #17: [A10] Webhook URLホワイトリスト機構
**優先度**: 🔵 Low  
**工数**: 2日  
**担当**: Backend Developer

**実装内容**:
ドメインホワイトリスト機構の実装

**検証項目**:
- [ ] ホワイトリスト検証が動作することを確認

---

#### Issue #18: 継続的セキュリティスキャンの導入
**優先度**: 🔵 Low  
**工数**: 3日  
**担当**: DevOps Engineer

**実装内容**:
- OWASP Dependency-Check統合
- GitHub Actions統合
- Renovate Bot設定
- Trivyコンテナスキャン

**検証項目**:
- [ ] 自動スキャンが動作することを確認
- [ ] 脆弱性検出時の通知設定

**実装例**:
```gradle
// build.gradle (root)
plugins {
    id 'org.owasp.dependencycheck' version '10.0.4'
}

dependencyCheck {
    format = 'ALL'
    failBuildOnCVSS = 7
}
```

```yaml
# .github/workflows/security.yml
name: Security Scan
on: [push, pull_request]
jobs:
  dependency-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run OWASP Dependency Check
        run: ./gradlew dependencyCheckAggregate
```

---

## 📊 実装優先順位サマリー

### 緊急度別分類

| Phase | 優先度 | Issue数 | 推定工数 | 期間 |
|-------|--------|---------|----------|------|
| **Phase 1** | 🔴 Critical | 4 | 5-7営業日 | 1週間 |
| **Phase 2** | 🟠 High | 4 | 8-10営業日 | 2週間 |
| **Phase 3** | 🟡 Medium | 6 | 6-8営業日 | 1ヶ月 |
| **Phase 4** | 🔵 Low | 4 | 5-7営業日 | 3ヶ月 |
| **合計** | | **18** | **24-32営業日** | **3ヶ月** |

---

## 🎯 期待される効果

### セキュリティスコア改善予測

| フェーズ完了後 | スコア | 改善 | 状態 |
|---------------|--------|------|------|
| **現在** | 73.5/100 | - | 良好（要改善） |
| **Phase 1完了** | 85/100 | +11.5 | 優良 |
| **Phase 2完了** | 90/100 | +5 | 卓越 |
| **Phase 3完了** | 93/100 | +3 | 卓越 |
| **Phase 4完了** | 95/100 | +2 | 世界クラス |

---

## 📝 Sub-Issue作成時のテンプレート

各Sub-Issueを作成する際は、以下のテンプレートを使用してください：

```markdown
# [Category] Issue Title

**優先度**: 🔴/🟠/🟡/🔵  
**CVSS**: X.X  
**工数**: X日  
**担当**: Role  
**親Issue**: #[メインIssue番号]

## 問題の詳細

### 影響範囲
- ファイル: `path/to/file.java`
- 機能: 機能名

### 脆弱性内容
[詳細な説明]

### CVE情報（該当する場合）
- CVE-XXXX-XXXXX: 説明

## 修正内容

### 変更するファイル
- [ ] `path/to/file1.java`
- [ ] `path/to/file2.java`

### コード例
```java
// Before
[現在のコード]

// After
[修正後のコード]
```

## 検証項目

- [ ] 機能が正常動作することを確認
- [ ] ユニットテスト作成
- [ ] E2Eテスト実行
- [ ] セキュリティテスト実行
- [ ] パフォーマンスへの影響確認
- [ ] ドキュメント更新

## 関連Issue

- 依存: #XXX
- 関連: #YYY

## 参考資料

- [RFC/CVE/ドキュメントへのリンク]
```

---

## 🔗 関連ドキュメント

- [OWASP Top 10 2025](https://owasp.org/www-project-top-ten/)
- [idp-server セキュリティポリシー](../SECURITY.md)
- [デプロイメントガイド](content_05_how-to/deployment.md)
- [Unit Testing Strategy](content_09_project/unit-testing-strategy-by-module.md)

---

**作成日**: 2025-10-09  
**最終更新**: 2025-10-09  
**承認**: Security Assessment Team
