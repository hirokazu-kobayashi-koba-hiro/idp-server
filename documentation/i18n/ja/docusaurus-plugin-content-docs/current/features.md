# 機能

**idp-server** は、下記機能をサポートしています（一部予定）。

## 機能一覧

* ✅ - 対応済み
* ⚠️ - 実装中

| カテゴリ            | サブカテゴリ                       | 対応状況 | 説明                                                              |
|-----------------|------------------------------|------|-----------------------------------------------------------------|
| **Trusted Web** | 身元確認 / eKYCプロバイダーとの連携        | ✅    | テナントごとのポリシーに応じて身元確認 / eKYCフローを動的に統合する。                          |
|                 | VC申請・発行ワークフロー                | ⚠️   | ユーザーの申請・審査から発行までのVerified Credentials（VC）管理ワークフローを提供。           |
| **認証**          | パスワード認証                      | ✅    | ユーザー名とパスワードによる認証。                                               |
|                 | 多要素認証（MFA）                   | ✅    | SMS、メール、プッシュ通知などによる多要素認証を追加。                                    |
|                 | WebAuthn（Passkey, FIDO2）     | ✅    | FIDO2 または Passkey によるパスワードレス認証をサポート。                            |
|                 | FIDO-UAF                     | ✅    | FIDO-UAF による認証をサポート。                                            |
|                 | ソーシャルログイン                    | ✅    | Google や Facebook などの外部アカウントによる認証をサポート。                         |
|                 | エンタープライズフェデレーション             | ⚠️   | SAML、OIDC、LDAP、Azure AD、Google Workspace など外部IdP連携によるログインをサポート。 |
|                 | IdP連携（フェデレーション）              | ✅    | サードパーティIdPとのフェデレーション認証をサポート。                                    |
|                 | MFAルールのカスタマイズ                | ✅    | テナントやユーザー単位で柔軟にMFAルールを定義可能。                                     |
| **認可**          | ロールベースアクセス制御（RBAC）           | ✅    | ユーザーにロールと権限を割り当てて、アクセスを制御。                                      |
|                 | パーミッション管理                    | ✅    | ユーザーごとの詳細なアクセス権限を管理。                                            |
|                 | API認可                        | ✅    | OAuth 2.0 に準拠したアクセストークンを用いたAPIを保護。                              |
|                 | M2M（マシン間）認証                  | ✅    | クライアントクレデンシャルによるサービス間認証をサポート。                                   |
|                 | セッション管理                      | ✅    | トークンの有効期限、リフレッシュ、ログアウト対応。                                       |
|                 | 認可プロバイダーの選択                  | ✅    | カスタム認可プロバイダーを選択して利用可能。                                          |
| **セキュリティ**      | セキュリティイベント（ユーザー操作）ログ         | ✅    | ログイン・認証失敗などのユーザー操作履歴を時系列で参照可能。                                  |
|                 | セキュリティイベントフック対応              | ✅    | テナント設定に応じて、各種セキュリティイベントごとに複数のHookを順次実行可能。                       |
|                 | ユーザー同意とプライバシー対応              | ✅    | FAPIに基づいたgrant管理により、GDPRやCCPA等の規制に準拠。                           |
|                 | セキュアなトークン管理                  | ✅    | アクセストークンの安全な管理と漏洩防止に対応。                                         |
|                 | 金融グレードAPI（FAPI）準拠            | ✅    | 金融機関向けの高セキュリティ要件に準拠。                                            |
|                 | SSF（Shared Signal Framework） | ✅    | セキュリティイベントをRelying Partyへ連携可能。                                  |
| **管理**          | 組織（Organization）機能           | ⚠️   | 複数テナントやメンバー、SSO、課金を一括管理できる組織機能。                                 |
|                 | 組織メンバー管理                     | ✅    | メンバー招待。権限管理を提供。                                                 |
|                 | 組織向けSSO強制                    | ⚠️   | 組織に所属するユーザーに対してSSOを強制。                                          |
|                 | サブスクリプション・課金                 | ⚠️   | 課金・プラン管理機能を提供。                                                  |
|                 | テナント管理                       | ✅    | 複数テナントを一元管理可能。                                                  |
|                 | 認可サーバー管理                     | ✅    | 認可サーバーの編集。                                                      |
|                 | アプリケーション管理                   | ✅    | アプリケーションの作成・編集・削除。                                              |
|                 | ユーザー管理                       | ✅    | ユーザーの作成・編集・削除。                                                  |
|                 | 認証設定の管理                      | ✅    | 認証方式・設定の作成・編集・削除。                                               |
|                 | 身元確認の設定                      | ✅    | 身元確認設定の作成・編集・削除。                                                |
|                 | ロールの設定                       | ✅    | ロールの作成・編集・削除。ユーザーへの割当。                                          |
|                 | パーミッションの設定                   | ✅    | パーミッションの作成・編集・削除。ロール・ユーザーへの割当。                                  |
|                 | トークン管理                       | ⚠️   | ユーザー / デバッグ用のトークン発行・削除。                                         |
|                 | トランザクションデータのクリーンアップ          | ✅    | 認証リクエストやMFA挑戦などの期限切れ・未使用データを定期的に自動削除。                           |
| **モニタリング**      | 監査ログ                         | ✅    | 認証イベントの記録とセキュリティアクティビティの追跡。                                     |
|                 | モニタリングログ連携                   | ✅    | ログ収集サービス（例：Datadog）との統合。                                        |
|                 | セキュリティアラート通知                 | ⚠️   | 異常なログインや侵害検知を管理者へ通知。                                            |
|                 | SIEM連携                       | ⚠️   | セキュリティ監視ツール（SIEM）との統合に対応。                                       |
| **開発者向けツール**    | SDK・ライブラリ提供                  | ⚠️   | React Android iOS などのSDKを提供予定。                                  |
|                 | カスタムHookなどプラグイン実装            | ✅    | 独自のビジネスロジックを実装可能。                                               |
|                 | ログイン画面のカスタマイズ                | ⚠️   | テナントごとにロゴ・配色・文言などを変更可能な認証画面テンプレートを提供。独自のブランド体験を実現。              |
| **インフラ**        | 複数データベースのサポート                | ✅    | テナントごとにデータベース種別（PostgreSQL, MySQL）を切り替え可能。                      |
| **ダッシュボード**     | オンボーディング                     | ⚠️   | 初期セットアップやテナント作成、認証方式選択、初期ユーザー登録などを案内する導入支援UI機能。                 |
|                 | 統計情報                         | ⚠️   | ログイン数、認証失敗数、アクティブユーザー数などの利用状況をリアルタイムで可視化。                       |
|                 | 組織管理                         | ⚠️   | 複数テナントを束ねた「組織」単位での情報閲覧、SSOポリシー、課金管理などを一元管理可能。                   |
|                 | 組織メンバー管理                     | ⚠️   | 組織メンバーの招待・削除、ロール・パーミッションの付与をGUIで管理可能。                           |
|                 | 組織向けSSO強制                    | ⚠️   | 組織に所属するユーザーに対して、指定したSSOプロバイダー経由でのログインを強制。                       |
|                 | テナント管理                       | ⚠️   | テナントの作成・無効化・認証設定・データベース設定などをGUIで一元管理可能。                         |
|                 | 認可サーバー管理                     | ⚠️   | 認可サーバーの設定をGUIで一元管理可能。OAuth /OIDC /CIBA /FAPI etc。               |
|                 | アプリケーション管理                   | ⚠️   | OAuth/OIDCクライアントの登録・設定・削除を視覚的に操作可能。                             |
|                 | ユーザー管理                       | ⚠️   | ユーザーの一覧表示、検索、作成・編集・削除、ロール割り当てなどをGUIで実行。                         |
|                 | 認証設定の管理                      | ⚠️   | パスワードポリシー、MFA有効化、認証手段の選択などをGUI上で設定可能。                           |
|                 | 身元確認の設定                      | ⚠️   | 身元確認フロー、eKYCプロバイダー、審査条件、遷移ルールなどの設定をGUIから操作可能。                   |
|                 | ロールの設定                       | ⚠️   | 新しいロールの作成、編集、削除、ユーザーへの割当をGUIにて管理可能。                             |
|                 | トークン管理                       | ⚠️   | ユーザー / デバッグ用のトークン発行・削除。                                         |
|                 | パーミッションの設定                   | ⚠️   | パーミッション項目ごとにアクセス範囲を定義し、ロールまたはユーザーに割当をGUIから操作可能。                 |
|                 | セキュリティイベント（ユーザー操作）ログ         | ⚠️   | ログイン・認証失敗などのユーザー操作履歴を時系列で、GUIから確認可能。                            |
|                 | 監査ログ                         | ⚠️   | システム設定変更などの監査情報をGUIで確認可能。                                       |
|                 | セキュリティイベントフック                | ⚠️   | 各種セキュリティイベントのHookの実行結果の参照、再実行をGUIから可能。                          |
|                 | サブスクリプション・課金                 | ⚠️   | 課金・プラン管理機能をGUIから可能。                                             |
|                 | モニタリング                       | ⚠️   | アプリケーションログをGUIから参照可能。                                           |

※[Adminダッシュボード](https://github.com/hirokazu-kobayashi-koba-hiro/idp-admin-dashboard)

## 対応プロトコル

- **OAuth 2.0 (RFC 6749)**
    - 認可コード Grant
    - インプリシット Grant
    - クライアントクレデンシャルズ Grant
    - リソースオーナーパスワードクレデンシャルズ Grant

- **OpenID Connect (OIDC)**
    - 認可コードフロー
    - インプリシットフロー
    - ハイブリットフロー
    - リクエストオブジェクト（署名付き／暗号化／平文）
    - UserInfo エンドポイント

- **Financial-grade API (FAPI)**
    - Part 1: Baseline
    - Part 2: Advanced（JARM, PAR）

- **クライアント主導型バックチャネル認証（CIBA）**
    - Poll / Ping / Push モード
    - リクエストオブジェクト対応
    - デバイス通知（例：FCM / APNs）

- **トークン管理**
    - JWT アクセストークン
    - IDトークンのカスタマイズ
    - トークン失効 / インスペクション（RFC 7009 / RFC 7662）

---

## 特徴と強み

**idp-server** は、企業やサービスプロバイダーが **セキュアかつ柔軟に認証・認可・身元確認** を統合管理できるオープンソースの
Identity Provider（IdP）です。以下の特徴により、金融・行政・エンタープライズ用途にも対応可能な設計となっています。

### ✅ 柔軟なテンプレートベース設計

* 各種申込み処理（身元確認、VC発行など）や認証フロー、Hook実行処理などがテンプレート形式で定義可能。
* 新しいユースケースにも設定変更のみで即時対応。

### ✅ マルチテナント設計

* 1インスタンスで複数のテナント（顧客）を同時に管理可能。
* RLSを利用し、テナントごとにデータ領域を分離する。

### ✅ 高度な認証手段とセキュリティ基準対応

* FIDO2 / Passkey / CIBA などのパスワードレス・分離認証にも対応。
* FAPI Baseline / Advanced による金融機関レベルのセキュリティ準拠。
* SSF（Shared Signal Framework） により、セキュリティイベントの即時通知・連携が可能。

### ✅ モダンな拡張性と統合力

* フック・プラグインによるカスタムロジック実装に対応（Javaベース）。
* 認証・認可だけでなく、VCの発行ワークフローや **外部API連携（Webhook / OAuth連携）** も組み込める。
* ログは Datadog などと統合し、監査・可視化も万全。
