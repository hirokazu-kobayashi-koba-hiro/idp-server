# キャッシュ戦略

`idp-server` は、頻繁に参照される設定情報を Redis にキャッシュしてパフォーマンスを最適化しています。

---

## 🔹 現在のキャッシュ対象

| 対象                   | 用途                                | TTL           |
|----------------------|-----------------------------------|---------------|
| **テナント設定（Tenant）**   | 各種認証・認可フローで使用される基本設定を保持           | デフォルト5分（設定可能） |
| **認可サーバー設定**         | 認可エンドポイントやトークン仕様など、プロトコルの挙動に関わる設定 | デフォルト5分（設定可能） |
| **クライアント設定（Client）** | 認証リクエスト時のクライアント検証やスコープ判定などに使用     | デフォルト5分（設定可能） |

---

## 🗃️ 技術構成

- **Redis** をキャッシュストアとして使用
- 各エントリには `tenant_id` を含めてネームスペースを分離
- 取得できなかった場合は **RDB（永続層）からフェッチしてキャッシュに保存**

---

## ♻️ キャッシュの更新タイミング

- DBから取得した時点でキャッシュに格納
- 設定変更系のAPI（例：テナント更新、クライアント更新）実行後に **明示的にキャッシュを削除**

---

## ✋ 注意事項

- セッション、トークン、トランザクションなどは **現時点ではRedisキャッシュ対象外**
- キャッシュが存在しない場合でも、**常にDBから再取得できる設計**

---

## 🧭 今後のキャッシュ対象候補

- トークン情報（`AccessToken` / `RefreshToken`）
