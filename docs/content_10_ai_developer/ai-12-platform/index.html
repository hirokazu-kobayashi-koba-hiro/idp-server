<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_10_ai_developer/ai-12-platform" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">idp-server-platform - プラットフォーム基盤 | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-12-platform"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="idp-server-platform - プラットフォーム基盤 | IdP-Server Documentation"><meta data-rh="true" name="description" content="モジュール概要"><meta data-rh="true" property="og:description" content="モジュール概要"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-12-platform"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-12-platform" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-12-platform" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.6e851c65.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.d0da808f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">📚 ドキュメント索引</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">技術概要</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_01_intro/intro-02-features">機能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_01_intro/intro-03-use-cases">ユースケース一覧</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">Getting-Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_02_quickstart/quickstart-02-setting-templates">初期設定テンプレート（予定）</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_03_concepts/concept-01-multi-tenant">コア概念</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-01-multi-tenant">マ  ルチテナント</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-02-id-management">ID（ユーザー）管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-03-id-verified">身元確認済みID</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-04-enterprise-id">エンタープライズID</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-05-authentication-policy">認証ポリシー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-06-token-management">トークン管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-07-session-management">セッション管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-08-mfa">多要素認証（MFA）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-09-custom-claims">カスタムクレーム・スコープ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-10-control-plane">コントロールプレーン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-11-security-events">セキュリティイベント・フック</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-12-authorization">認可</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-13-audit-compliance">監査ログ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-14-grant-management">認可許諾管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-15-operations">運用・保守</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-16-external-service-integration">外部サービス連携</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-17-application-logging">アプリケーションログ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-18-id-token">IDトークン（ID Token）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-19-client">クライアント（Client）</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-01-identity-management-basics">基礎（読み物）</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認可プロトコル</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認可コードフロー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_04_protocols/protocol-02-ciba-flow">CIBA フロー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_04_protocols/protocol-03-introspection">イントロスペクション</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_05_how-to/index">How-to（設定・運用レシピ）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/index">How-to ガイド - 学習ロードマップ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-01-server-setup">サーバー初期設定ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-02-organization-initialization">組織初期化ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-03-tenant-setup">OIDCの最小設定ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-04-client-registration">クライアント登録ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-05-user-registration">ユーザー登録と初回認証</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-07-authentication-policy-basic">認証ポリシー設定ガイド（基礎編）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-08-mfa-setup">MFA（多要素認証）の設定</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-09-token-strategy">トークン有効期限パターン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-10-authentication-policy-advanced">認証ポリシー設定ガイド（詳細編）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-11-federation-setup">外部IdP連携（Federation）の設定</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-12-ciba-flow-fido-uaf">CIBA + FIDO-UAF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-13-fido-uaf-registration">FIDO-UAF 登録フロー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-14-fido-uaf-deregistration">FIDO-UAF 解除フロー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-15-identity-verification-guide">身元確認申込み 導入ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-16-identity-verification-application">身元確認申込み</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-17-identity-verification-registration">身元確認データ登録</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-18-security-event-hooks">セキュリティイベントフック設定ガイド</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_06_developer-guide/getting-started/service-overview">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/getting-started/service-overview">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/control-plane/resource-overview">Control Plane（管理API）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/application-plane/overview">Application Plane（認証・認可API）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/implementation-guides/overview">Implementation Guides（実装ガイド）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/configuration/CONFIGURATION_COVERAGE">Configuration（設定）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/patterns/common-patterns">Patterns（実装パターン）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/troubleshooting/common-errors">Troubleshooting（トラブルシューティング）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/reference/code-review-checklist">Reference（リファレンス）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/learning-paths/beginner">Learning Paths（学習パス）</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_07_reference/api-reference">API ドキュメント</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">テスト戦略</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_08_ops/ops-02-performance-test">ストレステスト結果</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_08_ops/commercial-deployment/overview">商用デプロイ</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_09_project/project-01-faq">project-01-faq</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_09_project/project-02-roadmap">🗺️ ロードマップ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_09_project/project-03-contributing">コントリビュートガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_09_project/project-04-license">License</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI開発者向けモジュールガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-02-lessons-learned">AI開発者向けドキュメント作成ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-10-use-cases">idp-server-use-cases - ユースケース層（EntryService実装）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-11-core">idp-server-core - OAuth 2.0/OIDC準拠コアエンジン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-12-platform">idp-server-platform - プラットフォーム基盤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-13-control-plane">idp-server-control-plane - 管理API契約定義</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-20-adapters">Adapter層 - Repository実装とインフラ統合</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-21-core-adapter">idp-server-core-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-22-database">idp-server-database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-23-springboot-adapter">idp-server-springboot-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-30-extensions">拡張機能層 - OAuth/OIDC拡張仕様</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-31-extension-ciba">idp-server-core-extension-ciba - CIBA拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-32-extension-fapi">idp-server-core-extension-fapi - FAPI拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-33-extension-ida">idp-server-core-extension-ida - IDA拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-34-extension-pkce">idp-server-core-extension-pkce - PKCE拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-35-extension-vc">idp-server-core-extension-verifiable-credentials - VC拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-40-authentication-federation">認証・連携層 - ユーザー認証とフェデレーション</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-41-authentication">idp-server-authentication-interactors - 認証インタラクター</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-42-webauthn">idp-server-webauthn4j-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-43-federation-oidc">idp-server-federation-oidc</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-50-notification-security-event">通知・イベント層 - 通知配信とセキュリティイベント</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-51-notification-fcm">idp-server-notification-fcm-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-52-notification-apns">idp-server-notification-apns-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-53-email-aws">idp-server-email-aws-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-54-security-event-framework">idp-server-security-event-framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-55-security-event-hooks">idp-server-security-event-hooks</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AI</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">idp-server-platform - プラットフォーム基盤</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>idp-server-platform - プラットフォーム基盤</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="モジュール概要">モジュール概要<a href="#モジュール概要" class="hash-link" aria-label="モジュール概要 への直接リンク" title="モジュール概要 への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/</code>
<strong>確認日</strong>: 2025-10-12</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="責務">責務<a href="#責務" class="hash-link" aria-label="責務 への直接リンク" title="責務 への直接リンク">​</a></h3>
<p>idp-server全体を支える基盤機能群。マルチテナント、セッション管理、ログ、トランザクション、暗号化、JOSE(JWT)等の横断的関心事を提供。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="依存関係">依存関係<a href="#依存関係" class="hash-link" aria-label="依存関係 への直接リンク" title="依存関係 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">idp-server-core → idp-server-platform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">idp-server-use-cases → idp-server-platform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">idp-server-*-adapter → idp-server-platform</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>すべての上位モジュールが依存する基盤レイヤー。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="パッケージ構成">パッケージ構成<a href="#パッケージ構成" class="hash-link" aria-label="パッケージ構成 への直接リンク" title="パッケージ構成 への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <code>find libs/idp-server-platform/src/main/java/org/idp/server/platform -type d -maxdepth 1</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-マルチテナント-multi_tenancy">🔷 マルチテナント (<code>multi_tenancy/</code>)<a href="#-マルチテナント-multi_tenancy" class="hash-link" aria-label="-マルチテナント-multi_tenancy への直接リンク" title="-マルチテナント-multi_tenancy への直接リンク">​</a></h3>
<table><thead><tr><th>サブパッケージ</th><th>責務</th></tr></thead><tbody><tr><td><code>tenant/</code></td><td>テナント管理・識別・属性</td></tr><tr><td><code>organization/</code></td><td>組織管理・メンバー管理</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-セキュリティ暗号化">🔐 セキュリティ・暗号化<a href="#-セキュリティ暗号化" class="hash-link" aria-label="🔐 セキュリティ・暗号化 への直接リンク" title="🔐 セキュリティ・暗号化 への直接リンク">​</a></h3>
<table><thead><tr><th>パッケージ</th><th>責務</th></tr></thead><tbody><tr><td><code>crypto/</code></td><td>暗号化・復号化</td></tr><tr><td><code>hash/</code></td><td>ハッシュ生成（SHA-256等）</td></tr><tr><td><code>jose/</code></td><td>JWT/JWS/JWE/JWK処理</td></tr><tr><td><code>x509/</code></td><td>X.509証明書管理</td></tr><tr><td><code>random/</code></td><td>セキュアランダム生成</td></tr><tr><td><code>uuid/</code></td><td>UUID生成</td></tr><tr><td><code>base64/</code></td><td>Base64エンコード・デコード</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-インフラ統  合">🔌 インフラ統合<a href="#-インフラ統合" class="hash-link" aria-label="🔌 インフラ統合 への直接リンク" title="🔌 インフラ統合 への直接リンク">​</a></h3>
<table><thead><tr><th>パッケージ</th><th>責務</th></tr></thead><tbody><tr><td><code>datasource/</code></td><td>データソース管理・トランザクション</td></tr><tr><td><code>http/</code></td><td>HTTP クライアント</td></tr><tr><td><code>notification/</code></td><td>通知基盤（Email/Push）</td></tr><tr><td><code>proxy/</code></td><td>プロキシ設定</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="️-プラットフォーム機能">🛠️ プラットフォーム機能<a href="#️-プラットフォーム機能" class="hash-link" aria-label="🛠️ プラットフォーム機能 への直接リンク" title="🛠️ プラットフォーム機能 への直接リンク">​</a></h3>
<table><thead><tr><th>パッケージ</th><th>責務</th></tr></thead><tbody><tr><td><code>audit/</code></td><td>監査ログ</td></tr><tr><td><code>log/</code></td><td>ロギング</td></tr><tr><td><code>plugin/</code></td><td>プラグインローダー</td></tr><tr><td><code>dependency/</code></td><td>DI（Dependency Injection）</td></tr><tr><td><code>configuration/</code></td><td>設定管理</td></tr><tr><td><code>condition/</code></td><td>条件評価</td></tr><tr><td><code>exception/</code></td><td>例外ハンドリング</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-ユーティリティ">📦 ユーティリティ<a href="#-ユーティリティ" class="hash-link" aria-label="📦 ユーティリティ への直接リンク" title="📦 ユーティリティ への直接リンク">​</a></h3>
<table><thead><tr><th>パッケージ</th><th>責務</th></tr></thead><tbody><tr><td><code>json/</code></td><td>JSON シリアライズ・デシリアライズ</td></tr><tr><td><code>mapper/</code></td><td>オブジェクトマッピング</td></tr><tr><td><code>type/</code></td><td>型ユーティリティ</td></tr><tr><td><code>date/</code></td><td>日時処理</td></tr><tr><td><code>resource/</code></td><td>リソース管理</td></tr><tr><td><code>oauth/</code></td><td>OAuth共通型</td></tr><tr><td><code>security/</code></td><td>セキュリティユーティリティ</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="マルチテナント実装">マルチテナント実装<a href="#マルチテナント実装" class="hash-link" aria-label="マルチテナント実装 への直接リンク" title="マルチテナント実装 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tenant---テナントドメインモデル">Tenant - テナントドメインモデル<a href="#tenant---テナントドメインモデル" class="hash-link" aria-label="Tenant - テナントドメインモデル への直接リンク" title="Tenant - テナントドメインモデル への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/multi_tenancy/tenant/</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tenantidentifier---テナント識別子">TenantIdentifier - テナント識別子<a href="#tenantidentifier---テナント識別子" class="hash-link" aria-label="TenantIdentifier - テナント識別子 への直接リンク" title="TenantIdentifier - テナント識別子 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 値オブジェクトパターン</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TenantIdentifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public TenantIdentifier(String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.value = value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String value() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // equals/hashCode実装（値による等価性）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要</strong>: <code>String</code>ではなく<code>TenantIdentifier</code>型を使用することで型安全性を担保。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tenantattributes---テナント固有設定">TenantAttributes - テナント固有設定<a href="#tenantattributes---テナント固有設定" class="hash-link" aria-label="TenantAttributes - テナント固有設定 への直接リンク" title="TenantAttributes - テナント固有設定 への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/multi_tenancy/tenant/TenantAttributes.java#L25">TenantAttributes.java:25</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * テナント固有の設定値を格納</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの25-84行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TenantAttributes {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;String, Object&gt; values;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ 推奨パターン: デフォルト値を指定してOptional取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String optValueAsString(String key, String defaultValue) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (containsKey(key)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return (String) values.get(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return defaultValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public boolean optValueAsBoolean(String key, boolean defaultValue) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (values == null || values.isEmpty() || !containsKey(key)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return defaultValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (boolean) values.get(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public List&lt;String&gt; optValueAsStringList(String key, List&lt;String&gt; defaultValue) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (values == null || values.isEmpty() || !containsKey(key)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return defaultValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (List&lt;String&gt;) values.get(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // デフォルト値なしの取得（存在確認済みの場合）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String getValueAsString(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (String) values.get(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public boolean containsKey(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (values == null || values.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return values.containsKey(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>使用例</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Core層での使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TenantAttributes attributes = tenant.attributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// PKCE有効化チェック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boolean enablePKCE = attributes.optValueAsBoolean(&quot;oauth.pkce.enabled&quot;, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// カスタムクレームキー</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String customClaimKey = attributes.optValueAsString(&quot;token.custom_claim_key&quot;, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// リスト取得（許可スコープ等）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;String&gt; allowedScopes = attributes.optValueAsStringList(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;oauth.allowed_scopes&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List.of(&quot;openid&quot;, &quot;profile&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>情報源</strong>: CLAUDE.md「設定: TenantAttributes.optValueAsBoolean(key, default) パターン」</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tenant---テナント集約ルート">Tenant - テナント集約ルート<a href="#tenant---テナント集約ルート" class="hash-link" aria-label="Tenant - テナント集約ルート への直接リンク" title="Tenant - テナント集約ルート への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Tenant {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TenantIdentifier identifier;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TenantName name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TenantType type;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TenantAttributes attributes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TenantFeatures features;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ 値オブジェクトアクセサー</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public TenantIdentifier identifier() { return identifier; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String identifierValue() { return identifier.value(); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ 属性アクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public TenantAttributes attributes() { return attributes; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ ビジネスロジック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public boolean isOrganizer() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return type.isOrganizer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public boolean hasFeature(String featureName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return features.has(featureName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="organization---組織ドメインモデル">Organization - 組織ドメインモデル<a href="#organization---組織ドメインモデル" class="hash-link" aria-label="Organization - 組織ドメインモデル への直接リンク" title="Organization - 組織ドメインモデル への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/multi_tenancy/organization/Organization.java#L22">Organization.java:22</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 組織 = 複数テナントをグループ化する上位概念</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの22-80行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Organization {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OrganizationIdentifier identifier;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OrganizationName name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OrganizationDescription description;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AssignedTenants assignedTenants; // 組織に割り当てられたテナント一覧</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public Organization updateWithTenant(AssignedTenant assignedTenant) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AssignedTenants addedTenants = assignedTenants.add(assignedTenant);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ✅ Immutableパターン: 新しいインスタンスを返す</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new Organization(identifier, name, description, addedTenants);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public boolean hasAssignedTenants() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return assignedTenants != null &amp;&amp; assignedTenants.exists();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ toMap(): スネークケースでシリアライズ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public HashMap&lt;String, Object&gt; toMap() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HashMap&lt;String, Object&gt; result = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.put(&quot;id&quot;, identifier.value());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.put(&quot;name&quot;, name.value());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.put(&quot;description&quot;, description.value());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.put(&quot;assigned_tenants&quot;, assignedTenants.toMapList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要</strong>: 組織レベルAPIでは、<code>OrganizationIdentifier</code> → <code>TenantIdentifier</code>の順で引数を渡す。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="organizationrepository---組織リポジトリ">OrganizationRepository - 組織リポジトリ<a href="#organizationrepository---組織リポジトリ" class="hash-link" aria-label="OrganizationRepository - 組織リポジトリ への直接リンク" title="OrganizationRepository - 組織リポジトリ への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/multi_tenancy/organization/OrganizationRepository.java</code></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface OrganizationRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ 重要: OrganizationRepositoryのみTenant第一引数ではない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void register(Organization organization);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void update(Organization organization);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Organization get(OrganizationIdentifier identifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  List&lt;Organization&gt; findList(OrganizationQueries queries);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>注意</strong>: <code>findMember()</code> や <code>findAssignment()</code> などのメソッドは実装されていません。
組織メンバーや割り当てテナントの検索は、取得した <code>Organization</code> オブジェクトから行います：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 組織の取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Organization org = organizationRepository.get(orgId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 割り当てテナント一覧</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssignedTenants tenants = org.assignedTenants();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;TenantIdentifier&gt; tenantIds = tenants.tenantIdentifiers();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 組織タイプ（ORGANIZER）のテナント検索</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssignedTenant orgTenant = org.findOrgTenant();  // Organization.java:92</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>例外ルール</strong>:</p>
<ul>
<li>❗ <strong>OrganizationRepositoryのみ例外</strong>: 組織はテナントより上位概念のため、Tenant第一引数ルールの対象外</li>
<li>✅ <strong>その他の全Repository</strong>: Tenant第一引数必須</li>
</ul>
<p><strong>情報源</strong>: CLAUDE.md「Repository: 全メソッドで Tenant が第一引数（マルチテナント分離）。OrganizationRepositoryは除く。」</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="repository-パターン詳細">Repository パターン詳細<a href="#repository-パターン詳細" class="hash-link" aria-label="Repository パターン詳細 への直接リンク" title="Repository パターン詳細 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query--command-分離-cqrs">Query / Command 分離 (CQRS)<a href="#query--command-分離-cqrs" class="hash-link" aria-label="Query / Command 分離 (CQRS) への直接リンク" title="Query / Command 分離 (CQRS) への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ Query: 読み取り専用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface TenantQueryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tenant get(TenantIdentifier identifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tenant find(TenantIdentifier identifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  List&lt;Tenant&gt; findList(int limit, int offset);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  long count();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ Command: 書き込み専用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface TenantCommandRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void register(Tenant tenant);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void update(Tenant tenant);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void delete(TenantIdentifier identifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="get-vs-find-命名規則">get() vs find() 命名規則<a href="#get-vs-find-命名規則" class="hash-link" aria-label="get() vs find() 命名規則 への直接リンク" title="get() vs find() 命名規則 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ get(): 必須存在 - データがない場合は例外スロー</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tenant tenant = tenantQueryRepository.get(tenantIdentifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// → データがない → TenantNotFoundException</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ find(): 任意存在 - データがない場合はnull/空を返却</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tenant tenant = tenantQueryRepository.find(tenantIdentifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// → データがない → null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ findList(): リスト取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Tenant&gt; tenants = tenantQueryRepository.findList(10, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ findTotalCount(): カウント</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">long total = tenantQueryRepository.findTotalCount(queries);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>情報源</strong>: CLAUDE.md「命名: get()必須存在, find()任意存在, is/has/can判定メソッド」</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ログ監査ログ">ログ・監査ログ<a href="#ログ監査ログ" class="hash-link" aria-label="ログ・監査ログ への直接リンク" title="ログ・監査ログ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="loggerwrapper---ロギング">LoggerWrapper - ロギング<a href="#loggerwrapper---ロギング" class="hash-link" aria-label="LoggerWrapper - ロギング への直接リンク" title="LoggerWrapper - ロギング への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SomeHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggerWrapper log = LoggerWrapper.getLogger(SomeHandler.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void handle() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.info(&quot;Processing authorization request&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.debug(&quot;Request parameters: {}&quot;, params);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log.error(&quot;Failed to process request&quot;, exception);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="auditlog---監査ログ">AuditLog - 監査ログ<a href="#auditlog---監査ログ" class="hash-link" aria-label="AuditLog - 監査ログ への直接リンク" title="AuditLog - 監査ログ への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 監査ログ記録</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuditLog auditLog = AuditLog.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .tenantIdentifier(tenant.identifier())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .action(&quot;CREATE_CLIENT&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .subject(user.sub())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .resource(&quot;client_configuration&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .resourceId(clientId.value())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .timestamp(Instant.now())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auditLogWriter.write(auditLog);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="jose-jwtjwsjwejwk">JOSE (JWT/JWS/JWE/JWK)<a href="#jose-jwtjwsjwejwk" class="hash-link" aria-label="JOSE (JWT/JWS/JWE/JWK) への直接リンク" title="JOSE (JWT/JWS/JWE/JWK) への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/jose/</code></p>
<p>platformモジュールは、Nimbus JOSE + JWTライブラリのラッパーを提供。JoseHandlerが統合ハンドラーとして機能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="josehandler---統合ハンドラー">JoseHandler - 統合ハンドラー<a href="#josehandler---統合ハンドラー" class="hash-link" aria-label="JoseHandler - 統合ハンドラー への直接リンク" title="JoseHandler - 統合ハンドラー への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/jose/JoseHandler.java#L23-L40">JoseHandler.java:23-40</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Plain JWT / JWS / JWE を自動判定して処理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JoseHandler joseHandler = new JoseHandler();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JoseContext context = joseHandler.handle(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    joseString,    // JWT/JWS/JWE文字列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publicJwks,    // 公開鍵（JWK Set）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    privateJwks,   // 秘密鍵（JWK Set）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secret         // 共通鍵（HMAC用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// コンテキストからトークン情報取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebTokenClaims claims = context.claims();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jsonwebsignature-jws---署名付きjwt">JsonWebSignature (JWS) - 署名付きJWT<a href="#jsonwebsignature-jws---署名付きjwt" class="hash-link" aria-label="JsonWebSignature (JWS) - 署名付きJWT への直接リンク" title="JsonWebSignature (JWS) - 署名付きJWT への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/jose/JsonWebSignature.java#L28-L100">JsonWebSignature.java:28-100</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// JWSのパース</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebSignature jws = JsonWebSignature.parse(jwsString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// クレーム取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebTokenClaims claims = jws.claims();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String subject = claims.subject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String issuer = claims.issuer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ヘッダー情報</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String keyId = jws.keyId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String algorithm = jws.algorithm();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boolean isSymmetric = jws.isSymmetricType(); // HS256/HS384/HS512判定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 署名検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebSignatureVerifier verifier = new JsonWebSignatureVerifier(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jws.header(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publicKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">verifier.verify(jws);  // 検証失敗時は JoseInvalidException</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jsonwebtoken-plain-jwt">JsonWebToken (Plain JWT)<a href="#jsonwebtoken-plain-jwt" class="hash-link" aria-label="JsonWebToken (Plain JWT) への直接リンク" title="JsonWebToken (Plain JWT) への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/jose/JsonWebToken.java#L24-L62">JsonWebToken.java:24-62</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Plain JWT（署名なし）のパース</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebToken jwt = JsonWebToken.parse(jwtString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// クレーム取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebTokenClaims claims = jwt.claims();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// シリアライズ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String serialized = jwt.serialize();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="http-クライアント">HTTP クライアント<a href="#http-クライアント" class="hash-link" aria-label="HTTP クライアント への直接リンク" title="HTTP クライアント への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/http/HttpRequestExecutor.java#L36-L165">HttpRequestExecutor.java:36-165</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="httprequestexecutor---http実行エンジン">HttpRequestExecutor - HTTP実行エンジン<a href="#httprequestexecutor---http実行エンジン" class="hash-link" aria-label="HttpRequestExecutor - HTTP実行エンジン への直接リンク" title="HttpRequestExecutor - HTTP実行エンジン への直接リンク">​</a></h3>
<p>platformモジュールは、Java標準の <code>java.net.http.HttpClient</code> をベースにした高機能HTTP実行エンジンを提供。</p>
<p><strong>主要機能</strong>:</p>
<ul>
<li>OAuth 2.0自動認証</li>
<li>リトライメカニズム（エクスポネンシャルバックオフ）</li>
<li>Idempotencyキー管理</li>
<li>ネットワークエラーのHTTPステータスコードマッピング</li>
<li>設定ベースのリクエスト構築</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本的な使用例">基本的な使用例<a href="#基本的な使用例" class="hash-link" aria-label="基本的な使用例 への直接リンク" title="基本的な使用例 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// HttpClientとOAuthリゾルバーの初期  化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpClient httpClient = HttpClient.newHttpClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OAuthAuthorizationResolvers oauthResolvers = new OAuthAuthorizationResolvers();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// HttpRequestExecutorの作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpRequestExecutor executor = new HttpRequestExecutor(httpClient, oauthResolvers);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 標準のjava.net.http.HttpRequestを使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpRequest request = HttpRequest.newBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .uri(URI.create(&quot;https://api.example.com/data&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .header(&quot;Content-Type&quot;, &quot;application/json&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .POST(HttpRequest.BodyPublishers.ofString(jsonBody))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpRequestResult result = executor.execute(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (result.statusCode() == 200) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String responseBody = result.body();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="リトライ機能付き実行">リトライ機能付き実行<a href="#リトライ機能付き実行" class="hash-link" aria-label="リトライ機能付き実行 への直接リンク" title="リトライ機能付き実行 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// リトライ設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpRetryConfiguration retryConfig = HttpRetryConfiguration.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .maxRetries(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .retryableStatusCodes(List.of(502, 503, 504))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .backoffDelays(List.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Duration.ofSeconds(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Duration.ofSeconds(2),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Duration.ofSeconds(4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .idempotencyRequired(true)  // Idempotency-Keyヘッダー自動付与</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// リトライ実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpRequestResult result = executor.executeWithRetry(request, retryConfig);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oauth認証付き実行">OAuth認証付き実行<a href="#oauth認証付き実行" class="hash-link" aria-label="OAuth認証付き実行 への直接リンク" title="OAuth認証付き実行 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// OAuth設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OAuthAuthorizationConfiguration oauthConfig = // ... OAuth設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// OAuth + リトライ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpRequestResult result = executor.executeWithRetry(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    oauthConfig,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retryConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="設定ベースのリクエスト実行">設定ベースのリクエスト実行<a href="#設定ベースのリクエスト実行" class="hash-link" aria-label="設定ベースのリクエスト実行 への直接リンク" title="設定ベースのリクエスト実行 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// HttpRequestExecutionConfigを使った動的リクエスト構築</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpRequestExecutionConfig config = HttpRequestExecutionConfig.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .url(&quot;https://api.example.com/users/{user_id}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .method(HttpMethod.POST)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .authType(HttpRequestAuthType.OAUTH2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .oauthAuthorization(oauthConfig)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .retryConfiguration(retryConfig)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// リクエストパラメータ（URL埋め込み・ヘッダー・ボディに動的マッピング）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;String, Object&gt; params = Map.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;user_id&quot;, &quot;12345&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;name&quot;, &quot;John Doe&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpRequestResult result = executor.execute(config, params);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="datasourceトランザクションproxy">Datasource・トランザクション・Proxy<a href="#datasourceトランザクションproxy" class="hash-link" aria-label="Datasource・トランザクション・Proxy への直接リンク" title="Datasource・トランザクション・Proxy への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/datasource/</code>, <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/proxy/</code></p>
<p>platformモジュールは、<strong>アノテーション駆動のトランザクション管理</strong>を提供。Dynamic Proxyによる自動トランザクション制御。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="アーキテクチャ概要">アーキテクチャ概要<a href="#アーキテクチャ概要" class="hash-link" aria-label="アーキテクチャ概要 への直接リンク" title="アーキテクチャ概要 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">EntryService (Interface)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TenantAwareEntryServiceProxy (Dynamic Proxy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓ @Transaction アノテーション検出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓ TransactionManager 自動呼び出し</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓ PostgreSQL RLS 自動設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EntryService (実 装)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Repository → SqlExecutor → TransactionManager.getConnection()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-アノテーション">@Transaction アノテーション<a href="#transaction-アノテーション" class="hash-link" aria-label="@Transaction アノテーション への直接リンク" title="@Transaction アノテーション への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/Transaction-9762a14680938bcfe674ece2f7473ee3.java#L24-L28" target="_blank">Transaction.java:24-28</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RetentionPolicy.RUNTIME)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Target({ElementType.METHOD, ElementType.TYPE})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface Transaction {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  boolean readOnly() default false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>使用例</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ クラスレベル: 全メソッドにトランザクション適用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Transaction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UserManagementEntryService implements UserManagementApi {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 全メソッドが自動的にトランザクション管理される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ メソッドレベル: 特定メソッドのみ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TenantManagementEntryService implements TenantManagementApi {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Transaction(readOnly = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public TenantResponse get(TenantIdentifier tenantIdentifier) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 読み取り専用トランザクション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Transaction  // readOnly = false (デフォルト)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public TenantResponse register(TenantRegistrationRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 書き込みトランザクション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tenantawareentryserviceproxy---dynamic-proxy">TenantAwareEntryServiceProxy - Dynamic Proxy<a href="#tenantawareentryserviceproxy---dynamic-proxy" class="hash-link" aria-label="TenantAwareEntryServiceProxy - Dynamic Proxy への直接リンク" title="TenantAwareEntryServiceProxy - Dynamic Proxy への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/proxy/TenantAwareEntryServiceProxy.java#L29-L181">TenantAwareEntryServiceProxy.java:29-181</a></p>
<p>Dynamic Proxyが自動的に以下を実行：</p>
<ol>
<li><strong>アノテーション検出</strong>: <code>@Transaction</code> の有無・readOnly判定</li>
<li><strong>TenantIdentifier解決</strong>: メソッド引数から自動抽出</li>
<li><strong>トランザクション開始</strong>: <code>TransactionManager.beginTransaction()</code> または <code>createConnection()</code></li>
<li><strong>RLS設定</strong>: PostgreSQLの場合、<code>set_config(&#x27;app.tenant_id&#x27;, ?, true)</code> 実行</li>
<li><strong>ログコンテキスト</strong>: <code>TenantLoggingContext</code> 設定</li>
<li><strong>実行</strong>: 実際のメソッド実行</li>
<li><strong>コミット/ロールバック</strong>: 成功時commit、例外時rollback</li>
<li><strong>クリーンアップ</strong>: 接続クローズ、コンテキストクリア</li>
</ol>
<p><strong>Proxy作成</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// EntryServiceをProxyでラップ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserManagementApi userManagementApi = TenantAwareEntryServiceProxy.createProxy(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new UserManagementEntryService(...),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UserManagementApi.class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    applicationDatabaseTypeProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// この後のAPI呼び出しは全て自動的にトランザクション管理される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userManagementApi.register(tenantIdentifier, request);  // 自動トランザクション</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transactionmanager---threadlocal管理">TransactionManager - ThreadLocal管理<a href="#transactionmanager---threadlocal管理" class="hash-link" aria-label="TransactionManager - ThreadLocal管理 への直接リンク" title="TransactionManager - ThreadLocal管理 への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/datasource/TransactionManager.java#L25-L149">TransactionManager.java:25-149</a></p>
<p><strong>重要</strong>: 通常、開発者が直接TransactionManagerを呼び出すことはない。Proxyが自動的に呼び出す。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ Proxyが自動的に実行（開発者は意識不要）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TransactionManager.beginTransaction(DatabaseType.POSTGRESQL, tenantIdentifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// → set_config(&#x27;app.tenant_id&#x27;, ?, true) 自動実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// → メソッド実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// → commit or rollback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// → closeConnection()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ 直接呼び出しは非 推奨（Proxyを使用すべき）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TransactionManager.beginTransaction(...);  // 通常は使わない</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>ThreadLocal管理の仕組み</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private static final ThreadLocal&lt;Connection&gt; connectionHolder = new ThreadLocal&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static Connection getConnection() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Connection conn = connectionHolder.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (conn == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new SqlRuntimeException(&quot;No active transaction&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return conn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sqlexecutor---sql実行ヘルパー">SqlExecutor - SQL実行ヘルパー<a href="#sqlexecutor---sql実行ヘルパー" class="hash-link" aria-label="SqlExecutor - SQL実行ヘルパー への直接リンク" title="SqlExecutor - SQL実行ヘルパー への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/datasource/SqlExecutor.java#L23-L83">SqlExecutor.java:23-83</a></p>
<p>Repository実装で使用するSQL実行ユーティリティ。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class UserRepositoryImpl implements UserQueryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public User get(Tenant tenant, String userSub) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlExecutor executor = new SqlExecutor();  // TransactionManager.getConnection()を内部で使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String sql = &quot;SELECT * FROM idp_user WHERE tenant_id = ? AND sub = ?&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Map&lt;String, String&gt; row = executor.selectOne(sql, List.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tenant.identifierValue(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        userSub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return mapToUser(row);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public List&lt;User&gt; findList(Tenant tenant, int limit, int offset) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlExecutor executor = new SqlExecutor();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String sql = &quot;SELECT * FROM idp_user WHERE tenant_id = ? LIMIT ? OFFSET ?&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;Map&lt;String, String&gt;&gt; rows = executor.selectList(sql, List.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tenant.identifierValue(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        limit,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        offset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return rows.stream().map(this::mapToUser).toList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>自動例外マッピング</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  executor.selectOne(sql, params);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (SQLException exception) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  switch (SqlErrorClassifier.classify(exception)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case UNIQUE_VIOLATION -&gt; throw new SqlDuplicateKeyException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case NOT_NULL_VIOLATION, CHECK_VIOLATION -&gt; throw new SqlBadRequestException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default -&gt; throw new SqlRuntimeException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="row-level-security-rls-の自動設定">Row Level Security (RLS) の自動設定<a href="#row-level-security-rls-の自動設定" class="hash-link" aria-label="Row Level Security (RLS) の自動設定 への直接リンク" title="Row Level Security (RLS) の自動設定 への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/datasource/TransactionManager.java#L128-L167">TransactionManager.java:128-167</a></p>
<p>PostgreSQL使用時、Proxyが自動的にRLSを設定：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Proxyが自動実行（開発者は意識不要）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> set_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;app.tenant_id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ?</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--                                    ↑ is_local=true（トランザクション終了時に自動クリア）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Issue #672対策</strong>: プレースホルダー使用でSQLインジェクション防止</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 安全な実装（Issue #672で修正済み）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private static void setTenantId(Connection conn, TenantIdentifier tenantIdentifier) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  try (PreparedStatement stmt = conn.prepareStatement(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;SELECT set_config(&#x27;app.tenant_id&#x27;, ?, true)&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stmt.setString(1, tenantIdentifier.value());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stmt.execute();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="実装パターンまとめ">実装パターンまとめ<a href="#実装パターンまとめ" class="hash-link" aria-label="実装パターンまとめ への直接リンク" title="実装パターンまとめ への直接リンク">​</a></h3>
<p><strong>開発者がすべきこと</strong>:</p>
<ol>
<li>✅ EntryServiceに <code>@Transaction</code> アノテーション付与</li>
<li>✅ メソッド引数に <code>TenantIdentifier</code> を含める（第一引数推奨）</li>
<li>✅ EntryServiceをProxyでラップして使用</li>
<li>✅ RepositoryでSqlExecutorを使用</li>
</ol>
<p><strong>開発者が意識しなくてよいこと</strong>:</p>
<ol>
<li>❌ TransactionManagerの直接呼び出し（Proxyが自動実行）</li>
<li>❌ Connection管理（ThreadLocalで自動管理）</li>
<li>❌ commit/rollback（Proxyが自動実行）</li>
<li>❌ RLS設定（Proxyが自動実行）</li>
<li>❌ ログコンテキスト設定（Proxyが自動実行）</li>
</ol>
<p><strong>情報源</strong>: Issue #672（SQL Injection対策）</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="json-シリアライズデシリアライズ">JSON シリアライズ・デシリアライズ<a href="#json-シリアライズデシリアライズ" class="hash-link" aria-label="JSON シリアライズ・デシリアライズ への直接リンク" title="JSON シリアライズ・デシリアライズ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jsonconverter---json変換ユーティリティ">JsonConverter - JSON変換ユーティリティ<a href="#jsonconverter---json変換ユーティリティ" class="hash-link" aria-label="JsonConverter - JSON変換ユーティリティ への直接リンク" title="JsonConverter - JSON変換ユーティリティ への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/json/JsonConverter.java#L33">JsonConverter.java:33</a></p>
<p>Jackson ObjectMapperのラッパー。スネークケース/キャメルケース変換をサポート。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="インスタンス取得">インスタンス取得<a href="#インスタンス取得" class="hash-link" aria-label="インスタンス取得 への直接リンク" title="インスタンス取得 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * JsonConverter - 2つのインスタンス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの33-44行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ デフォルトインスタンス（キャメルケース）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonConverter defaultConverter = JsonConverter.defaultInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ スネークケースインスタンス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonConverter snakeCaseConverter = JsonConverter.snakeCaseInstance();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要</strong>:</p>
<ul>
<li><strong>defaultInstance()</strong>: フィールド名をそのまま維持（<code>clientId</code>）</li>
<li><strong>snakeCaseInstance()</strong>: スネークケースに変換（<code>client_id</code>）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="シリアライズjava--json">シリアライズ（Java → JSON）<a href="#シリアライズjava--json" class="hash-link" aria-label="シリアライズ（Java → JSON） への直接リンク" title="シリアライズ（Java → JSON） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// オブジェクトをJSON文字列に変換</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClientConfiguration config = ...;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String json = jsonConverter.write(config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Map → JSON</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;String, Object&gt; map = Map.of(&quot;client_id&quot;, &quot;test-client&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String json = jsonConverter.write(map);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="デシリアライズjson--java">デシリアライズ（JSON → Java）<a href="#デシリアライズjson--java" class="hash-link" aria-label="デシリアライズ（JSON → Java） への直接リンク" title="デシリアライズ（JSON → Java） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// JSON文字列 → オブジェクト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String json = &quot;{\&quot;client_id\&quot;:\&quot;test-client\&quot;,\&quot;client_name\&quot;:\&quot;Test\&quot;}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClientConfiguration config = jsonConverter.read(json, ClientConfiguration.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Map → オブジェクト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;String, Object&gt; map = request.toMap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClientConfiguration config = jsonConverter.read(map, ClientConfiguration.class);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="スネークケース変換の重要性">スネークケース変換の重要性<a href="#スネークケース変換の重要性" class="hash-link" aria-label="スネークケース変換の重要性 への直接リンク" title="スネークケース変換の重要性 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ Context Creatorで使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonConverter jsonConverter = JsonConverter.snakeCaseInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// HTTPリクエスト: snake_case → Javaオブジェクト: camelCase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;String, Object&gt; requestBody = Map.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;client_id&quot;, &quot;test&quot;,        // snake_case</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;client_name&quot;, &quot;Test&quot;,      // snake_case</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;redirect_uris&quot;, List.of()  // snake_case</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClientConfiguration config = jsonConverter.read(requestBody, ClientConfiguration.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// config.clientId() → &quot;test&quot;      // camelCase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// config.clientName() → &quot;Test&quot;    // camelCase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// config.redirectUris() → []      // camelCase</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>使用箇所</strong>:</p>
<ul>
<li><strong>Context Creator</strong>: リクエストDTO → ドメインモデル変換</li>
<li><strong>Repository</strong>: JSON列（JSONB）→ Javaオブジェクト変換</li>
<li><strong>Cache</strong>: Redis保存時のシリアライズ</li>
<li><strong>HTTP</strong>: 外部APIとのJSON通信</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="jackson設定">Jackson設定<a href="#jackson設定" class="hash-link" aria-label="Jackson設定 への直接リンク" title="Jackson設定 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// フィールドアクセス（getterなしでもシリアライズ可能）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectMapper.setVisibility(PropertyAccessor.FIELD, JsonAutoDetect.Visibility.ANY);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// スネークケース変換</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectMapper.setPropertyNamingStrategy(PropertyNamingStrategies.SNAKE_CASE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Java 8 Time API対応</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectMapper.registerModule(new JavaTimeModule());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 空文字列 → null 変換</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectMapper.coercionConfigFor(LogicalType.Collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setCoercion(CoercionInputShape.EmptyString, CoercionAction.AsNull);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/json/JsonConverter.java#L52-L80">JsonConverter.java:52-80</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dependency-injection---diコンテナ">Dependency Injection - DIコンテナ<a href="#dependency-injection---diコンテナ" class="hash-link" aria-label="Dependency Injection - DIコンテナ への直接リンク" title="Dependency Injection - DIコンテナ への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/dependency/</code></p>
<p>platformモジュールは、軽量なDIコンテナ機構を提供。Pluginの依存関係解決に使用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="applicationcomponentcontainer">ApplicationComponentContainer<a href="#applicationcomponentcontainer" class="hash-link" aria-label="ApplicationComponentContainer への直接リンク" title="ApplicationComponentContainer への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/dependency/ApplicationComponentContainer.java#L22">ApplicationComponentContainer.java:22</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * シンプルなDIコンテナ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの22-41行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationComponentContainer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;Class&lt;?&gt;, Object&gt; dependencies;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public ApplicationComponentContainer() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.dependencies = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ コンポーネント登録</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void register(Class&lt;?&gt; type, Object instance) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dependencies.put(type, instance);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ コンポーネント解決</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public &lt;T&gt; T resolve(Class&lt;T&gt; type) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!dependencies.containsKey(type)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      throw new ApplicationComponentMissionException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;Missing datasource for type: &quot; + type.getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return type.cast(dependencies.get(type));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用例-authenticationdependencycontainer">使用例: AuthenticationDependencyContainer<a href="#使用例-authenticationdependencycontainer" class="hash-link" aria-label="使用例: AuthenticationDependencyContainer への直接リンク" title="使用例: AuthenticationDependencyContainer への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// DIコンテナに依存関係を登録</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ApplicationComponentContainer container = new ApplicationComponentContainer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">container.register(UserQueryRepository.class, userQueryRepository);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">container.register(PasswordVerificationDelegation.class, passwordVerificationDelegation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Pluginで依存関係を解決</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PasswordAuthenticationInteractorFactory implements AuthenticationInteractorFactory {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractor create(AuthenticationDependencyContainer container) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ✅ コンテナから依存関係を解決</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PasswordVerificationDelegation delegation =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        container.resolve(PasswordVerificationDelegation.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new PasswordAuthenticationInteractor(delegation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="protocolcontainer">ProtocolContainer<a href="#protocolcontainer" class="hash-link" aria-label="ProtocolContainer への直接リンク" title="ProtocolContainer への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/dependency/protocol/</code></p>
<p>Protocol（OAuth/OIDC）の  依存関係管理。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Protocolの依存関係コンテナ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProtocolContainer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;String, ProtocolProvider&gt; providers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public &lt;T&gt; T resolve(String key, Class&lt;T&gt; type) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProtocolProvider provider = providers.get(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return type.cast(provider.provide());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>用途</strong>:</p>
<ul>
<li>Plugin FactoryでのRepository解決</li>
<li>AuthenticationInteractor組み立て</li>
<li>FederationInteractor組み立て</li>
<li>Protocol実装の依存関係管理</li>
</ul>
<p><strong>重要</strong>: idp-serverのDIは、Spring BootのDIとは<strong>別レイヤー</strong>:</p>
<ul>
<li><strong>Spring Boot</strong>: Controller, Configuration, Bean管理</li>
<li><strong>platform dependency</strong>: Plugin, Interactor, Protocolの依存関係のみ</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-system">Plugin System<a href="#plugin-system" class="hash-link" aria-label="Plugin System への直接リンク" title="Plugin System への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/plugin/PluginLoader.java#L25-L91">PluginLoader.java:25-91</a></p>
<p>platformモジュールは、Java ServiceLoader機構を使用したプラグインシステムを提供。内部モジュール・外部JARの両方をサポート。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pluginloader---静的メソッドapi">PluginLoader - 静的メソッドAPI<a href="#pluginloader---静的メソッドapi" class="hash-link" aria-label="PluginLoader - 静的メソッドAPI への直接リンク" title="PluginLoader - 静的メソッドAPI への直接リンク">​</a></h3>
<p><strong>重要</strong>: PluginLoaderはインスタンス化不要。全て静的メソッドで提供。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 内部モジュールからロード（META-INF/services）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;AccessTokenCustomClaimsCreator&gt; internalCreators =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PluginLoader.loadFromInternalModule(AccessTokenCustomClaimsCreator.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 外部JARからロード（plugins/ディレクトリ）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;AccessTokenCustomClaimsCreator&gt; externalCreators =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PluginLoader.loadFromExternalModule(AccessTokenCustomClaimsCreator.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 両方をマージして使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;AccessTokenCustomClaimsCreator&gt; allCreators = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allCreators.addAll(internalCreators);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allCreators.addAll(externalCreators);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// プラグイン適用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (AccessTokenCustomClaimsCreator creator : allCreators) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;String, Object&gt; claims = creator.create(context);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customClaims.putAll(claims);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="内部モジュールプラグイン">内部モジュールプラグイン<a href="#内部モジュールプラグイン" class="hash-link" aria-label="内部モジュールプラグイン への直接リンク" title="内部モジュールプラグイン への直接リンク">​</a></h3>
<p><strong>idp-server内部での機能拡張</strong></p>
<ol>
<li>プラグインインターフェース実装:</li>
</ol>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example.internal;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyCustomClaimsCreator implements AccessTokenCustomClaimsCreator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public Map&lt;String, Object&gt; create(AccessTokenContext context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Map.of(&quot;custom_claim&quot;, &quot;value&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li><code>resources/META-INF/services/</code> にファイル作成:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ファイル名: org.idp.server.core.openid.token.plugin.AccessTokenCustomClaimsCreator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">内容: com.example.internal.MyCustomClaimsCreator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>ビルド後、自動的にロードされる</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="外部jarプラグイン">外部JARプラグイン<a href="#外部jarプラグイン" class="hash-link" aria-label="外部JARプラグイン への直接リンク" title="外部JARプラグイン への直接リンク">​</a></h3>
<p><strong>外部モジュールによる機能拡張</strong></p>
<ol>
<li>
<p>プラグインインターフェース実装（同上）</p>
</li>
<li>
<p><code>resources/META-INF/services/</code> にファイル作成（同上）</p>
</li>
<li>
<p>JARをビルド:</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li><code>plugins/</code> ディレクトリに配置:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp build/libs/my-custom-claims-1.0.0.jar /path/to/idp-server/plugins/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>idp-server再起動でロード</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="urlclassloader機構">URLClassLoader機構<a href="#urlclassloader機構" class="hash-link" aria-label="URLClassLoader機構 への直接リンク" title="URLClassLoader機構 への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/plugin/PluginLoader.java#L41-L90">PluginLoader.java:41-90</a></p>
<p>外部JARは専用ClassLoaderで分離ロード:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// plugins/ディレクトリ内の全JARを検索</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File dir = new File(&quot;plugins&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File[] jars = dir.listFiles((d, name) -&gt; name.endsWith(&quot;.jar&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// URLClassLoaderで外部JARをロード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">URL[] urls = Arrays.stream(jars).map(f -&gt; f.toURI().toURL()).toArray(URL[]::new);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClassLoader contextClassLoader = PluginLoader.class.getClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">URLClassLoader loader = new URLClassLoader(urls, contextClassLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ServiceLoaderで実装を検索</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServiceLoader&lt;T&gt; serviceLoader = ServiceLoader.load(type, loader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 外部JARからのみロード（内部重複を回避）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (T impl : serviceLoader) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (impl.getClass().getClassLoader() != contextClassLoader) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    extensions.add(impl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="専用pluginloader">専用PluginLoader<a href="#専用pluginloader" class="hash-link" aria-label="専用PluginLoader への直接リンク" title="専用PluginLoader への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/plugin/</code></p>
<p>特定用途向けに専用ローダーを提供:</p>
<ul>
<li><code>AuditLogWriterPluginLoader</code> - 監査ログライター拡張</li>
<li><code>EmailSenderPluginLoader</code> - メール送信プラグイン</li>
<li><code>SmsSenderPluginLoader</code> - SMS送信プラグイン</li>
<li><code>SecurityEventHooksPluginLoader</code> - セキュリティイベントフック</li>
<li><code>AdditionalOAuthAuthorizationResolverPluginLoader</code> - OAuth認可拡張</li>
</ul>
<p><strong>情報源</strong>: <a href="/idp-server/docs/content_01_intro/intro-01-tech-overview#L171-L190">intro-01-tech-overview.md:171-190</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="値オブジェクトパターン-value-object">値オブジェクトパターン (Value Object)<a href="#値オブジェクトパターン-value-object" class="hash-link" aria-label="値オブジェクトパターン (Value Object) への直接リンク" title="値オブジェクトパターン (Value Object) への直接リンク">​</a></h2>
<p>platformモジュールの全識別子・属性は値オブジェクトとして実装。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="実装例">実装例<a href="#実装例" class="hash-link" aria-label="実装例 への直接リンク" title="実装例 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 値オブジェクト: Immutable + 値による等価性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TenantIdentifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private final String value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public TenantIdentifier(String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Objects.requireNonNull(value, &quot;TenantIdentifier cannot be null&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.value = value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String value() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public boolean equals(Object o) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (this == o) return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!(o instanceof TenantIdentifier)) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TenantIdentifier that = (TenantIdentifier) o;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Objects.equals(value, that.value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public int hashCode() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Objects.hash(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="メリット">メリット<a href="#メリット" class="hash-link" aria-label="メリット への直接リンク" title="メリット への直接リンク">​</a></h3>
<ol>
<li><strong>型安全性</strong>: <code>TenantIdentifier</code>と<code>OrganizationIdentifier</code>を間違えるとコンパイルエラー</li>
<li><strong>バリデーション集約</strong>: 値オブジェクトのコンストラクタで検証</li>
<li><strong>意図明確化</strong>: <code>String</code>ではなく<code>TenantIdentifier</code>で意図を表現</li>
<li><strong>リファクタリング容  易</strong>: 型が違うため変更箇所が特定しやすい</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="アンチパターン">アンチパターン<a href="#アンチパターン" class="hash-link" aria-label="アンチパターン への直接リンク" title="アンチパターン への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-1-string濫用">❌ 1. String濫用<a href="#-1-string濫用" class="hash-link" aria-label="❌ 1. String濫用 への直接リンク" title="❌ 1. String濫用 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ 悪い例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Tenant findTenant(String tenantId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return tenantRepository.find(tenantId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 良い例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Tenant findTenant(TenantIdentifier tenantIdentifier) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return tenantRepository.find(tenantIdentifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-2-map濫用">❌ 2. Map濫用<a href="#-2-map濫用" class="hash-link" aria-label="❌ 2. Map濫用 への直接リンク" title="❌ 2. Map濫用 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ 悪い例: 設定をMapで持ち回る</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void configure(Map&lt;String, Object&gt; config) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  boolean enableFeature = (boolean) config.get(&quot;enable_feature&quot;); // 型キャストが必要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 良い例: TenantAttributesで型安全にアクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void configure(TenantAttributes attributes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  boolean enableFeature = attributes.optValueAsBoolean(&quot;enable_feature&quot;, false); // 型安全</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-3-platformモジュールへのドメインロジック混入">❌ 3. Platformモジュールへのドメインロジック混入<a href="#-3-platformモジュールへのドメインロジック混入" class="hash-link" aria-label="❌ 3. Platformモジュールへのドメインロジック混入 への直接リンク" title="❌ 3. Platformモジュールへのドメインロジック混入 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ 悪い例: platformに業務ロジック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TenantAttributes {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public boolean canAccessPremiumFeatures() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ❌ 業務判定ロジックがplatformに</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return optValueAsBoolean(&quot;is_premium&quot;, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 良い例: Core/UseCase層で判定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PremiumFeatureVerifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public boolean canAccess(Tenant tenant) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ✅ 業務ロジックはドメイン層に</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return tenant.attributes().optValueAsBoolean(&quot;is_premium&quot;, false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;&amp; tenant.hasFeature(&quot;premium_access&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>原則</strong>: platformは汎用的な基盤機能のみ、業務ロジックは上位層に配置。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="idp-server-platform-を理解するための5つのポイント">idp-server-platform を理解するための5つのポイント<a href="#idp-server-platform-を理解するための5つのポイント" class="hash-link" aria-label="idp-server-platform を理解するための5つのポイント への直接リンク" title="idp-server-platform を理解するための5つのポイント への直接リンク">​</a></h3>
<ol>
<li><strong>マルチテナント基盤</strong>: TenantIdentifier/OrganizationIdentifier による完全分離</li>
<li><strong>値オブジェクト徹底</strong>: String/Map濫用を避け、型安全な設計</li>
<li><strong>TenantAttributes パターン</strong>: <code>optValueAsBoolean(key, default)</code> で設定取得</li>
<li><strong>Repository命名規則</strong>: <code>get()</code>必須存在、<code>find()</code>任意存在</li>
<li><strong>Tenant第一引数の原則</strong>: OrganizationRepository以外は全てTenant第一引数</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="次のステップ">次のステップ<a href="#次のステップ" class="hash-link" aria-label="次のステップ への直接リンク" title="次のステップ への直接リンク">​</a></h3>
<ul>
<li><a href="/idp-server/docs/content_10_ai_developer/ai-10-use-cases">idp-server-use-cases（ユースケース層）</a> - EntryServiceパターン</li>
<li><a href="/idp-server/docs/content_10_ai_developer/ai-21-core-adapter">idp-server-core-adapter（アダプター層）</a> - Repository実装詳細</li>
<li><a href="/idp-server/docs/content_10_ai_developer/ai-13-control-plane">idp-server-control-plane（管理API契約）</a> - Control Plane設計</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ドキュメント修正履歴">ドキュメント修正履歴<a href="#ドキュメント修正履歴" class="hash-link" aria-label="ドキュメント修正履歴 への直接リンク" title="ドキュメント修正履歴 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2025-10-12-実装検証に基づく大規模修正">2025-10-12: 実装検証に基づく大規模修正<a href="#2025-10-12-実装検証に基づく大規模修正" class="hash-link" aria-label="2025-10-12: 実装検証に基づく大規模修正 への直接リンク" title="2025-10-12: 実装検証に基づく大規模修正 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正1-organizationrepository-の実装に合わせた修正-238-275行目">修正1: OrganizationRepository の実装に合わせた修正 (238-275行目)<a href="#修正1-organizationrepository-の実装に合わせた修正-238-275行目" class="hash-link" aria-label="修正1: OrganizationRepository の実装に合わせた修正 (238-275行目) への直接リンク" title="修正1: OrganizationRepository の実装に合わせた修正 (238-275行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: 存在しないメソッドが記載されていた</p>
<p><strong>修正内容</strong>:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- Organization find(OrganizationIdentifier identifier);     // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- OrganizationMember findMember(...);                       // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- AssignedTenant findAssignment(...);                       // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ void register(Organization organization);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ void update(Organization organization);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ Organization get(OrganizationIdentifier identifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ List&lt;Organization&gt; findList(OrganizationQueries queries);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>追加</strong>: 代替パターンの説明（<code>org.assignedTenants()</code>, <code>org.findOrgTenant()</code> の使用方法）</p>
<p><strong>検証</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/multi_tenancy/organization/OrganizationRepository.java#L21-L29">OrganizationRepository.java:21-29</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正2-tenantattributesoptvalueasint-の削除-153-170行目">修正2: TenantAttributes.optValueAsInt() の削除 (153-170行目)<a href="#修正2-tenantattributesoptvalueasint-の削除-153-170行目" class="hash-link" aria-label="修正2: TenantAttributes.optValueAsInt() の削除 (153-170行目) への直接リンク" title="修正2: TenantAttributes.optValueAsInt() の削除 (153-170行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: 実装に存在しないメソッドを使用例に記載</p>
<p><strong>修正内容</strong>:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- int tokenLifetime = attributes.optValueAsInt(&quot;token.access_token.lifetime_seconds&quot;, 3600);  // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ List&lt;String&gt; allowedScopes = attributes.optValueAsStringList(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     &quot;oauth.allowed_scopes&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+     List.of(&quot;openid&quot;, &quot;profile&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ );  // ✅ 実際に存在するメソッド</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピ ー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>検証</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/multi_tenancy/tenant/TenantAttributes.java#L25-L84">TenantAttributes.java:25-84</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正3-jose-jwtjwsjwejwk-セクション全面改訂-353-417行目">修正3: JOSE (JWT/JWS/JWE/JWK) セクション全面改訂 (353-417行目)<a href="#修正3-jose-jwtjwsjwejwk-セクション全面改訂-353-417行目" class="hash-link" aria-label="修正3: JOSE (JWT/JWS/JWE/JWK) セクション全面改訂 (353-417行目) への直接リンク" title="修正3: JOSE (JWT/JWS/JWE/JWK) セクション全面改訂 (353-417行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: 想像で書かれた存在しないクラス・API</p>
<p><strong>修正前</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">JwtCreator jwtCreator = new JwtCreator();            // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JwtVerifier jwtVerifier = new JwtVerifier(...);      // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jwt jwt = jwtCreator.create(...);                    // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Claims claims = jwt.claims();                        // ❌ 存在しない</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>修正後</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">JoseHandler joseHandler = new JoseHandler();                                    // ✅ 実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebSignature jws = JsonWebSignature.parse(jwsString);                      // ✅ 実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebSignatureVerifier verifier = new JsonWebSignatureVerifier(...);         // ✅ 実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JsonWebTokenClaims claims = jws.claims();                                       // ✅ 実装</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>検証</strong>:</p>
<ul>
<li><a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/jose/JoseHandler.java#L23-L40">JoseHandler.java:23-40</a></li>
<li><a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/jose/JsonWebSignature.java#L28-L100">JsonWebSignature.java:28-100</a></li>
<li><a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/jose/JsonWebToken.java#L24-L62">JsonWebToken.java:24-62</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正4-http-クライアント-セクション全面改訂-419-511行目">修正4: HTTP クライアント セクション全面改訂 (419-511行目)<a href="#修正4-http-クライアント-セクション全面改訂-419-511行目" class="hash-link" aria-label="修正4: HTTP クライアント セクション全面改訂 (419-511行目) への直接リンク" title="修正4: HTTP クライアント セクション全面改訂 (419-511行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: 簡略化された想像API、実装との乖離</p>
<p><strong>修正内容</strong>:</p>
<ul>
<li>Java標準 <code>java.net.http.HttpClient</code> ベースの実装に修正</li>
<li>OAuth 2.0自動認証、リトライメカニズム、Idempotencyキー管理の説明追加</li>
<li>設定ベースのリクエスト構築パターン追加</li>
</ul>
<p><strong> 検証</strong>: <a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/http/HttpRequestExecutor.java#L36-L165">HttpRequestExecutor.java:36-165</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正5-datasourceトランザクション-セクション全面改訂-513-723行目">修正5: Datasource・トランザクション セクション全面改訂 (513-723行目)<a href="#修正5-datasourceトランザクション-セクション全面改訂-513-723行目" class="hash-link" aria-label="修正5: Datasource・トランザクション セクション全面改訂 (513-723行目) への直接リンク" title="修正5: Datasource・トランザクション セクション全面改訂 (513-723行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: 最も重要なDynamic Proxy機構の説明が欠落、TransactionManagerの直接使用を推奨する誤解</p>
<p><strong>修正前</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ 誤り: 開発者が直接TransactionManagerを呼び出す想定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TransactionManager.beginTransaction(DatabaseType.POSTGRESQL, tenantIdentifier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clientRepository.register(tenant, clientConfiguration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TransactionManager.commitTransaction();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TransactionManager.rollbackTransaction();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>修正後</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 正しい: @Transactionアノテーション + Dynamic Proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Transaction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UserManagementEntryService implements UserManagementApi {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Proxyが自動的にトランザクション管理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 開発者はTransactionManagerを意識しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Proxy作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserManagementApi api = TenantAwareEntryServiceProxy.createProxy(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new UserManagementEntryService(...),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UserManagementApi.class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    applicationDatabaseTypeProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>追加内容</strong>:</p>
<ul>
<li><code>@Transaction</code> アノテーションの詳細説明</li>
<li><code>TenantAwareEntryServiceProxy</code> の動作フロー（8ステップ）</li>
<li><code>SqlExecutor</code> の使用方法とRepository実装例</li>
<li>「開発者がすべきこと」「意識しなくてよいこと」の明確な区別</li>
<li>Proxyパッケージの説明（proxy/）</li>
</ul>
<p><strong>検証</strong>:</p>
<ul>
<li><a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/datasource/Transaction.java#L24-L28">Transaction.java:24-28</a></li>
<li><a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/proxy/TenantAwareEntryServiceProxy.java#L29-L181">TenantAwareEntryServiceProxy.java:29-181</a></li>
<li><a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/datasource/SqlExecutor.java#L23-L83">SqlExecutor.java:23-83</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正6-plugin-system-セクション全面改訂-725-839行目">修正6: Plugin System セクション全面改訂 (725-839行目)<a href="#修正6-plugin-system-セクション全面改訂-725-839行目" class="hash-link" aria-label="修正6: Plugin System セクション全面改訂 (725-839行目) への直接リンク" title="修正6: Plugin System セクション全面改訂 (725-839行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: インスタンス化API（存在しない）を記載、静的メソッドAPIの説明欠落</p>
<p><strong>修正前</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ 存在しないAPI: インスタンス化不可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PluginLoader&lt;AccessTokenCustomClaimsCreator&gt; loader =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new PluginLoader&lt;&gt;(AccessTokenCustomClaimsCreator.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;AccessTokenCustomClaimsCreator&gt; creators = loader.load();  // ❌ load() メソッドは存在しない</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>修正後</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ 実際のAPI: 静的メソッド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;AccessTokenCustomClaimsCreator&gt; internalCreators =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PluginLoader.loadFromInternalModule(AccessTokenCustomClaimsCreator.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;AccessTokenCustomClaimsCreator&gt; externalCreators =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PluginLoader.loadFromExternalModule(AccessTokenCustomClaimsCreator.class);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>追加内容</strong>:</p>
<ul>
<li>内部モジュール vs 外部JARの区別と使い分け</li>
<li>URLClassLoader機構の詳細説明</li>
<li>専用PluginLoader一覧（AuditLogWriter, EmailSender, SmsSender等）</li>
<li>META-INF/servicesファイルの具体的な作成手順</li>
</ul>
<p><strong>検証</strong>:</p>
<ul>
<li><a href="/idp-server/libs/idp-server-platform/src/main/java/org/idp/server/platform/plugin/PluginLoader.java#L25-L91">PluginLoader.java:25-91</a></li>
<li>専用ローダー: <code>libs/idp-server-platform/src/main/java/org/idp/server/platform/plugin/</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="修正の原則">修正の原則<a href="#修正の原則" class="hash-link" aria-label="修正の原則 への直接リンク" title="修正の原則 への直接リンク">​</a></h3>
<p><strong>CLAUDE.md「想像ドキュメント作成防止」に基づく修正</strong>:</p>
<ol>
<li><strong>コードファーストの原則</strong>: 必ずソースコードを先に確認</li>
<li><strong>情報源記録</strong>: 参照ファイル・行番号を明記</li>
<li><strong>段階的確認</strong>: クラス名→メソッド名→シグネチャの順で段階的に確認</li>
<li><strong>不明点明示</strong>: 推測・仮定を明確に区別</li>
</ol>
<hr>
<p><strong>情報源</strong>:</p>
<ul>
<li><code>libs/idp-server-platform/src/main/java/</code>配下の実装コード</li>
<li>CLAUDE.md「マルチテナント」「値オブジェクト」「Repository命名規則」「想像ドキュメント作成防止」</li>
<li>Issue #672（SQL Injection修 正）</li>
<li>Issue #676（AI開発者向け知識ベースの作成・改善）</li>
</ul>
<p><strong>最終更新</strong>: 2025-10-12
<strong>確認方法</strong>: <code>find libs/idp-server-platform/src/main/java/org/idp/server/platform -type d -maxdepth 1</code>
<strong>レビュー実施</strong>: 2025-10-12 - AI開発者向けドキュメント品質改善プロジェクト</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_10_ai_developer/ai-12-platform.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_10_ai_developer/ai-11-core"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">idp-server-core - OAuth 2.0/OIDC準拠コアエンジン</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_10_ai_developer/ai-13-control-plane"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">idp-server-control-plane - 管理API契約定義</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#モジュール概要" class="table-of-contents__link toc-highlight">モジュール概要</a><ul><li><a href="#責務" class="table-of-contents__link toc-highlight">責務</a></li><li><a href="#依存関係" class="table-of-contents__link toc-highlight">依存関係</a></li></ul></li><li><a href="#パッケージ構成" class="table-of-contents__link toc-highlight">パッケージ構成</a><ul><li><a href="#-マルチテナント-multi_tenancy" class="table-of-contents__link toc-highlight">🔷 マルチテナント (<code>multi_tenancy/</code>)</a></li><li><a href="#-セキュリティ暗号化" class="table-of-contents__link toc-highlight">🔐 セキュリティ・暗号化</a></li><li><a href="#-インフラ統合" class="table-of-contents__link toc-highlight">🔌 インフラ統合</a></li><li><a href="#️-プラットフォーム機能" class="table-of-contents__link toc-highlight">🛠️ プラットフォーム機能</a></li><li><a href="#-ユーティリティ" class="table-of-contents__link toc-highlight">📦 ユーティリティ</a></li></ul></li><li><a href="#マルチテナント実装" class="table-of-contents__link toc-highlight">マルチテナント実装</a><ul><li><a href="#tenant---テナントドメインモデル" class="table-of-contents__link toc-highlight">Tenant - テナントドメインモデル</a></li><li><a href="#organization---組織ドメインモデル" class="table-of-contents__link toc-highlight">Organization - 組織ドメインモデル</a></li><li><a href="#organizationrepository---組織リポジトリ" class="table-of-contents__link toc-highlight">OrganizationRepository - 組織リポジトリ</a></li></ul></li><li><a href="#repository-パターン詳細" class="table-of-contents__link toc-highlight">Repository パターン詳細</a><ul><li><a href="#query--command-分離-cqrs" class="table-of-contents__link toc-highlight">Query / Command 分離 (CQRS)</a></li><li><a href="#get-vs-find-命名規則" class="table-of-contents__link toc-highlight">get() vs find() 命名規則</a></li></ul></li><li><a href="#ログ監査ログ" class="table-of-contents__link toc-highlight">ログ・監査ログ</a><ul><li><a href="#loggerwrapper---ロギング" class="table-of-contents__link toc-highlight">LoggerWrapper - ロギング</a></li><li><a href="#auditlog---監査ログ" class="table-of-contents__link toc-highlight">AuditLog - 監査ログ</a></li></ul></li><li><a href="#jose-jwtjwsjwejwk" class="table-of-contents__link toc-highlight">JOSE (JWT/JWS/JWE/JWK)</a><ul><li><a href="#josehandler---統合ハンドラー" class="table-of-contents__link toc-highlight">JoseHandler - 統合ハンドラー</a></li><li><a href="#jsonwebsignature-jws---署名付きjwt" class="table-of-contents__link toc-highlight">JsonWebSignature (JWS) - 署名付きJWT</a></li><li><a href="#jsonwebtoken-plain-jwt" class="table-of-contents__link toc-highlight">JsonWebToken (Plain JWT)</a></li></ul></li><li><a href="#http-クライアント" class="table-of-contents__link toc-highlight">HTTP クライアント</a><ul><li><a href="#httprequestexecutor---http実行エンジン" class="table-of-contents__link toc-highlight">HttpRequestExecutor - HTTP実行エンジン</a></li><li><a href="#基本的な使用例" class="table-of-contents__link toc-highlight">基本的な使用例</a></li><li><a href="#リトライ機能付き実行" class="table-of-contents__link toc-highlight">リトライ機能付き実行</a></li><li><a href="#oauth認証付き実行" class="table-of-contents__link toc-highlight">OAuth認証付き実行</a></li><li><a href="#設定ベースのリクエスト実行" class="table-of-contents__link toc-highlight">設定ベースのリクエスト実行</a></li></ul></li><li><a href="#datasourceトランザクションproxy" class="table-of-contents__link toc-highlight">Datasource・トランザクション・Proxy</a><ul><li><a href="#アーキテクチャ概要" class="table-of-contents__link toc-highlight">アーキテクチャ概要</a></li><li><a href="#transaction-アノテーション" class="table-of-contents__link toc-highlight">@Transaction アノテーション</a></li><li><a href="#tenantawareentryserviceproxy---dynamic-proxy" class="table-of-contents__link toc-highlight">TenantAwareEntryServiceProxy - Dynamic Proxy</a></li><li><a href="#transactionmanager---threadlocal管理" class="table-of-contents__link toc-highlight">TransactionManager - ThreadLocal管理</a></li><li><a href="#sqlexecutor---sql実行ヘルパー" class="table-of-contents__link toc-highlight">SqlExecutor - SQL実行ヘルパー</a></li><li><a href="#row-level-security-rls-の自動設定" class="table-of-contents__link toc-highlight">Row Level Security (RLS) の自動設定</a></li><li><a href="#実装パターンまとめ" class="table-of-contents__link toc-highlight">実装パターンまとめ</a></li></ul></li><li><a href="#json-シリアライズデシリアライズ" class="table-of-contents__link toc-highlight">JSON シリアライズ・デシリアライズ</a><ul><li><a href="#jsonconverter---json変換ユーティリティ" class="table-of-contents__link toc-highlight">JsonConverter - JSON変換ユーティリティ</a></li></ul></li><li><a href="#dependency-injection---diコンテナ" class="table-of-contents__link toc-highlight">Dependency Injection - DIコンテナ</a><ul><li><a href="#applicationcomponentcontainer" class="table-of-contents__link toc-highlight">ApplicationComponentContainer</a></li><li><a href="#使用例-authenticationdependencycontainer" class="table-of-contents__link toc-highlight">使用例: AuthenticationDependencyContainer</a></li><li><a href="#protocolcontainer" class="table-of-contents__link toc-highlight">ProtocolContainer</a></li></ul></li><li><a href="#plugin-system" class="table-of-contents__link toc-highlight">Plugin System</a><ul><li><a href="#pluginloader---静的メソッドapi" class="table-of-contents__link toc-highlight">PluginLoader - 静的メソッドAPI</a></li><li><a href="#内部モジュールプラグイン" class="table-of-contents__link toc-highlight">内部モジュールプラグイン</a></li><li><a href="#外部jarプラグイン" class="table-of-contents__link toc-highlight">外部JARプラグイン</a></li><li><a href="#urlclassloader機構" class="table-of-contents__link toc-highlight">URLClassLoader機構</a></li><li><a href="#専用pluginloader" class="table-of-contents__link toc-highlight">専用PluginLoader</a></li></ul></li><li><a href="#値オブジェクトパターン-value-object" class="table-of-contents__link toc-highlight">値オブジェクトパターン (Value Object)</a><ul><li><a href="#実装例" class="table-of-contents__link toc-highlight">実装例</a></li><li><a href="#メリット" class="table-of-contents__link toc-highlight">メリット</a></li></ul></li><li><a href="#アンチパターン" class="table-of-contents__link toc-highlight">アンチパターン</a><ul><li><a href="#-1-string濫用" class="table-of-contents__link toc-highlight">❌ 1. String濫用</a></li><li><a href="#-2-map濫用" class="table-of-contents__link toc-highlight">❌ 2. Map濫用</a></li><li><a href="#-3-platformモジュールへのドメインロジック混入" class="table-of-contents__link toc-highlight">❌ 3. Platformモジュールへのドメインロジック混入</a></li></ul></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a><ul><li><a href="#idp-server-platform-を理解するための5つのポイント" class="table-of-contents__link toc-highlight">idp-server-platform を理解するための5つのポイント</a></li><li><a href="#次のステップ" class="table-of-contents__link toc-highlight">次のステップ</a></li></ul></li><li><a href="#ドキュメント修正履歴" class="table-of-contents__link toc-highlight">ドキュメント修正履歴</a><ul><li><a href="#2025-10-12-実装検証に基づく大規模修正" class="table-of-contents__link toc-highlight">2025-10-12: 実装検証に基づく大規模修正</a></li><li><a href="#修正の原則" class="table-of-contents__link toc-highlight">修正の原則</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>