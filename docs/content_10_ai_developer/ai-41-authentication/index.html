<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_10_ai_developer/ai-41-authentication" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">idp-server-authentication-interactors - 認証インタラクター | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-41-authentication"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="idp-server-authentication-interactors - 認証インタラクター | IdP-Server Documentation"><meta data-rh="true" name="description" content="モジュール概要"><meta data-rh="true" property="og:description" content="モジュール概要"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-41-authentication"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-41-authentication" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-41-authentication" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.4c9db509.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.b218c5b6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI開発者向けモジュールガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-02-lessons-learned">AI開発者向けドキュメント作成ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-10-use-cases">idp-server-use-cases - ユースケース層（EntryService実装）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-11-core">idp-server-core - OAuth 2.0/OIDC準拠コアエンジン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-12-platform">idp-server-platform - プラットフォーム基盤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-13-control-plane">idp-server-control-plane - 管理API契約定義</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-20-adapters">Adapter層 - Repository実装とインフラ統合</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-21-core-adapter">idp-server-core-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-22-database">idp-server-database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-23-springboot-adapter">idp-server-springboot-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-30-extensions">拡張機能層 - OAuth/OIDC拡張仕様</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-31-extension-ciba">idp-server-core-extension-ciba - CIBA拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-32-extension-fapi">idp-server-core-extension-fapi - FAPI拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-33-extension-ida">idp-server-core-extension-ida - IDA拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-34-extension-pkce">idp-server-core-extension-pkce - PKCE拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-35-extension-vc">idp-server-core-extension-verifiable-credentials - VC拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-40-authentication-federation">認証・連携層 - ユーザー認証とフェデレーション</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-41-authentication">idp-server-authentication-interactors - 認証インタラクター</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-42-webauthn">idp-server-webauthn4j-adapter - WebAuthn4jライブラリ統合</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-43-federation-oidc">idp-server-federation-oidc</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-50-notification-security-event">通知・イベント層 - 通知配信とセキュリティイベント</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-51-notification-fcm">idp-server-notification-fcm-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-52-notification-apns">idp-server-notification-apns-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-53-email-aws">idp-server-email-aws-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-54-security-event-framework">idp-server-security-event-framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-55-security-event-hooks">idp-server-security-event-hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/external-api-response-handling-investigation">外部APIレスポンスハンドリング改善調査</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AI</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">idp-server-authentication-interactors - 認証インタラクター</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>idp-server-authentication-interactors - 認証インタラクター</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="モジュール概要">モジュール概要<a href="#モジュール概要" class="hash-link" aria-label="モジュール概要 への直接リンク" title="モジュール概要 への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <code>libs/idp-server-authentication-interactors/</code>
<strong>確認日</strong>: 2025-10-12</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="責務">責務<a href="#責務" class="hash-link" aria-label="責務 への直接リンク" title="責務 への直接リンク">​</a></h3>
<p>多様な認証手段のインタラクター実装。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="対応認証手段">対応認証手段<a href="#対応認証手段" class="hash-link" aria-label="対応認証手段 への直接リンク" title="対応認証手段 への直接リンク">​</a></h3>
<p><strong>検証コマンド</strong>: <code>ls libs/idp-server-authentication-interactors/src/main/java/org/idp/server/authentication/interactors/</code></p>
<table><thead><tr><th>認証手段</th><th>パッケージ</th><th>説明</th></tr></thead><tbody><tr><td><strong>FIDO2/Passkey</strong></td><td><code>webauthn/</code></td><td>WebAuthn準拠の生体認証・セキュリティキー（Challenge/Registration/Authentication）</td></tr><tr><td><strong>FIDO-UAF</strong></td><td><code>fidouaf/</code></td><td>FIDO Universal Authentication Framework（登録・認証）</td></tr><tr><td><strong>Password</strong></td><td><code>password/</code></td><td>パスワード認証（PasswordVerificationDelegation使用）</td></tr><tr><td><strong>SMS</strong></td><td><code>sms/</code></td><td>SMS OTP（Challenge/Verification、外部SMS送信サービス連携）</td></tr><tr><td><strong>Email</strong></td><td><code>email/</code></td><td>メールOTP（Challenge/Verification、外部メール送信サービス連携）</td></tr><tr><td><strong>Device</strong></td><td><code>device/</code></td><td>デバイス認証（プッシュ通知、Binding/Notification/Denied）</td></tr><tr><td><strong>External Token</strong></td><td><code>external_token/</code></td><td>外部IDサービス連携（Legacy ID Service統合）</td></tr><tr><td><strong>Initial Registration</strong></td><td><code>initial_registration/</code></td><td>初回登録インタラクション</td></tr><tr><td><strong>Cancel</strong></td><td><code>cancel/</code></td><td>認証キャンセル処理</td></tr></tbody></table>
<p><strong>合計</strong>: 10種類の認証インタラクター</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="アーキテクチャ概要">アーキテクチャ概要<a href="#アーキテクチャ概要" class="hash-link" aria-label="アーキテクチャ概要 への直接リンク" title="アーキテクチャ概要 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="設計思想">設計思想<a href="#設計思想" class="hash-link" aria-label="設計思想 への直接リンク" title="設計思想 への直接リンク">​</a></h3>
<p><strong>Pluginアーキテクチャ</strong>: 認証手段を動的に追加可能な拡張性重視設計</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PluginLoader → AuthenticationInteractorFactory → AuthenticationInteractor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          interact() 実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    AuthenticationInteractionRequestResult</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップ  ボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2つのoperationtype">2つのOperationType<a href="#2つのoperationtype" class="hash-link" aria-label="2つのOperationType への直接リンク" title="2つのOperationType への直接リンク">​</a></h3>
<table><thead><tr><th>OperationType</th><th>責務</th><th>例</th></tr></thead><tbody><tr><td><code>CHALLENGE</code></td><td>チャレンジ生成（認証前準備）</td><td>WebAuthn Challenge, SMS OTP送信</td></tr><tr><td><code>AUTHENTICATION</code></td><td>認証検証（実際の認証処理）</td><td>Password検証, OTP検証, WebAuthn Assertion検証</td></tr></tbody></table>
<p><strong>重要</strong>: defaultメソッドで<code>AUTHENTICATION</code>がデフォルト。Challenge専用インタラクターのみ<code>CHALLENGE</code>をオーバーライド。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authenticationinteractionstatus">AuthenticationInteractionStatus<a href="#authenticationinteractionstatus" class="hash-link" aria-label="AuthenticationInteractionStatus への直接リンク" title="AuthenticationInteractionStatus への直接リンク">​</a></h3>
<table><thead><tr><th>Status</th><th>意味</th><th>次のステップ</th></tr></thead><tbody><tr><td><code>SUCCESS</code></td><td>認証成功</td><td>AuthenticationTransaction更新</td></tr><tr><td><code>CLIENT_ERROR</code></td><td>認証失敗</td><td>エラーレスポンス返却</td></tr><tr><td><code>PENDING</code></td><td>ユーザ  ーアクション待ち</td><td>ポーリング or Callback待機</td></tr></tbody></table>
<p><strong>重要</strong>: PENDING状態は非同期認証（Device認証、CIBA等）で使用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="securityeventtype連携">SecurityEventType連携<a href="#securityeventtype連携" class="hash-link" aria-label="SecurityEventType連携 への直接リンク" title="SecurityEventType連携 への直接リンク">​</a></h3>
<p>全てのインタラクターが認証結果に応じて<strong>SecurityEvent</strong>を発行。</p>
<table><thead><tr><th>認証手段</th><th>成功イベント</th><th>失敗イベント</th></tr></thead><tbody><tr><td>Password</td><td><code>password_success</code></td><td><code>password_failure</code></td></tr><tr><td>SMS</td><td><code>sms_authentication_success</code></td><td><code>sms_authentication_failure</code></td></tr><tr><td>WebAuthn</td><td><code>webauthn_authentication_success</code></td><td><code>webauthn_authentication_failure</code></td></tr><tr><td>Device</td><td><code>device_authentication_success</code></td><td><code>device_authentication_denied</code></td></tr></tbody></table>
<p><strong>用途</strong>: Security Event Hooks、監査ログ、SIEM連携</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="authenticationinteractorfactory-パターン">AuthenticationInteractorFactory パターン<a href="#authenticationinteractorfactory-パターン" class="hash-link" aria-label="AuthenticationInteractorFactory パターン への直接リンク" title="AuthenticationInteractorFactory パターン への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/AuthenticationInteractorFactory-861adf65279ee21d757ad306f6c36006.java#L21" target="_blank">AuthenticationInteractorFactory.java:21</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 認証インタラクターのFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの21-24行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface AuthenticationInteractorFactory {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthenticationInteractor create(AuthenticationDependencyContainer container);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Password実装例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PasswordAuthenticationInteractorFactory implements AuthenticationInteractorFactory {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractor create(AuthenticationDependencyContainer container) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PasswordVerificationDelegation passwordVerificationDelegation =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        container.resolve(PasswordVerificationDelegation.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new PasswordAuthenticationInteractor(passwordVerificationDelegation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/PasswordAuthenticationInteractorFactory-8b03834b3874652f7b4abe02fca81be3.java#L24" target="_blank">PasswordAuthenticationInteractorFactory.java:24</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="authenticationinteractor-インターフェース">AuthenticationInteractor インターフェース<a href="#authenticationinteractor-インターフェース" class="hash-link" aria-label="AuthenticationInteractor インターフェース への直接リンク" title="AuthenticationInteractor インターフェース への直接リンク">​</a></h2>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/AuthenticationInteractor-9d6a705b9997a1620f1193eb398ee4a2.java#L23" target="_blank">AuthenticationInteractor.java:23</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 認証インタラクター</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの23-40行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ インタラクションタイプ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthenticationInteractionType type();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ オペレーションタイプ（デフォルト: AUTHENTICATION）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default OperationType operationType() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return OperationType.AUTHENTICATION;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ 認証方式名（AMR値）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String method();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ 認証インタラクション実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthenticationInteractionRequestResult interact(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationTransaction transaction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationInteractionType type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationInteractionRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RequestAttributes requestAttributes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserQueryRepository userQueryRepository);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="plugin登録">Plugin登録<a href="#plugin登録" class="hash-link" aria-label="Plugin登録   への直接リンク" title="Plugin登録 への直接リンク">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># META-INF/services/org.idp.server.core.openid.authentication.plugin.AuthenticationInteractorFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.idp.server.authentication.interactors.password.PasswordAuthenticationInteractorFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.idp.server.authentication.interactors.sms.SmsAuthenticationInteractorFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.idp.server.authentication.interactors.cancel.AuthenticationCancelInteractorFactory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="実装パターン">実装パターン<a href="#実装パターン" class="hash-link" aria-label="実装パターン への直接リンク" title="実装パターン への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-password認証実装">1. Password認証実装<a href="#1-password認証実装" class="hash-link" aria-label="1. Password認証実装 への直接リンク" title="1. Password認証実装 への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/PasswordAuthenticationInteractor-41cf0d0c1102b826a1bc515adbdaa3fe.java#L30-L80" target="_blank">PasswordAuthenticationInteractor.java:30-80</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class PasswordAuthenticationInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PasswordVerificationDelegation passwordVerificationDelegation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionType type() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardAuthenticationInteraction.PASSWORD_AUTHENTICATION.toType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String method() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardAuthenticationMethod.PASSWORD.type(); // AMR値: &quot;pwd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationTransaction transaction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationInteractionType type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationInteractionRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RequestAttributes requestAttributes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserQueryRepository userQueryRepository) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. リクエストからusername/passwordを取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String username = request.optValueAsString(&quot;username&quot;, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String password = request.optValueAsString(&quot;password&quot;, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String providerId = request.optValueAsString(&quot;provider_id&quot;, &quot;idp-server&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. ユーザー検索</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    User user = userQueryRepository.findByEmail(tenant, username, providerId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. パスワード検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!passwordVerificationDelegation.verify(password, user.hashedPassword())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 認証失敗</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          AuthenticationInteractionStatus.CLIENT_ERROR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          operationType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          user,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Map.of(&quot;error&quot;, &quot;invalid_request&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 &quot;error_description&quot;, &quot;user is not found or invalid password&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DefaultSecurityEventType.password_failure);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4. 認証成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AuthenticationInteractionStatus.SUCCESS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operationType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        user,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map.of(&quot;status&quot;, &quot;authenticated&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DefaultSecurityEventType.password_success);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ <strong>PasswordVerificationDelegation</strong>: パスワード検証ロジックを委譲（bcrypt等の実装を抽象化）</li>
<li>✅ <strong>SecurityEventType</strong>: 成功/失敗でイベント発行（password_success/password_failure）</li>
<li>✅ <strong>AMR値</strong>: <code>StandardAuthenticationMethod.PASSWORD.type()</code> → &quot;pwd&quot;</li>
<li>✅ <strong>Tenant第一引数</strong>: マルチテナント分離</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-sms認証実装authenticationexecutor連携">2. SMS認証実装（AuthenticationExecutor連携）<a href="#2-sms認証実装authenticationexecutor連携" class="hash-link" aria-label="2. SMS認証実装（AuthenticationExecutor連携） への直接リンク" title="2. SMS認証実装（AuthenticationExecutor連携） への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/SmsAuthenticationInteractor-185477696d9625fdae1390162495d240.java#L37-L80" target="_blank">SmsAuthenticationInteractor.java:37-80</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SmsAuthenticationInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthenticationExecutors executors; // Executor実行エンジン</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthenticationConfigurationQueryRepository configurationQueryRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionType type() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardAuthenticationInteraction.SMS_AUTHENTICATION.toType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String method() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardAuthenticationMethod.SMS.type(); // AMR値: &quot;sms&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationTransaction transaction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationInteractionType type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationInteractionRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RequestAttributes requestAttributes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserQueryRepository userQueryRepository) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. テナント固有のSMS認証設定を取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationConfiguration configuration =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configurationQueryRepository.get(tenant, &quot;sms&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationInteractionConfig interactionConfig =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configuration.getAuthenticationConfig(&quot;sms-authentication&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationExecutionConfig execution = interactionConfig.execution();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. 動的Executor選択（設定から実行関数を取得）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationExecutor executor = executors.get(execution.function());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. Executor実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationExecutionRequest executionRequest =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new AuthenticationExecutionRequest(request.toMap());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationExecutionResult executionResult =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.execute(tenant, transaction, executionRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4. 結果変換</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (executionResult.isSuccess()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      User user = executionResult.user();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          AuthenticationInteractionStatus.SUCCESS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          operationType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          user,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          executionResult.response(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DefaultSecurityEventType.sms_authentication_success);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          AuthenticationInteractionStatus.CLIENT_ERROR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          operationType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          executionResult.user(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          executionResult.response(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DefaultSecurityEventType.sms_authentication_failure);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ <strong>AuthenticationExecutors</strong>: SMS送信・検証ロジックを外部Executorに委譲</li>
<li>✅ <strong>動的設定</strong>: テナントごとに異なるSMS送信サービス（Twilio/AWS SNS等）を設定可能</li>
<li>✅ <strong>AuthenticationConfiguration</strong>: DB保存の設定から実行関数を動的選択</li>
<li>✅ <strong>Challenge-Response</strong>: SMS送信(Challenge) → OTP検証(Authentication)の2段階対応</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-device認証実装プッシュ通知">3. Device認証実装（プッシュ通知）<a href="#3-device認証実装プッシュ通知" class="hash-link" aria-label="3. Device認証実装（プッシュ通知） への直接リンク" title="3. Device認証実装（プッシュ通知） への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-authentication-interactors/src/main/java/org/idp/server/authentication/interactors/device/</code></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * デバイス認証（プッシュ通知）の3つのインタラクター</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 1. 通知送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AuthenticationDeviceNotificationInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthenticationDeviceNotifiers notifiers; // FCM/APNS notifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // プッシュ通知送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationDeviceNotifier notifier = notifiers.get(deviceType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    notifier.send(tenant, user, challengeCode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AuthenticationInteractionStatus.PENDING, // ユーザーアクション待ち</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. デバイス承認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AuthenticationDeviceBindingMessageInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // デバイスからの承認レスポンス検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (challengeCode.equals(receivedCode)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          AuthenticationInteractionStatus.SUCCESS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 3. デバイス拒否</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AuthenticationDeviceDeniedInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AuthenticationInteractionStatus.CLIENT_ERROR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operationType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        user,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map.of(&quot;error&quot;, &quot;access_denied&quot;, &quot;error_description&quot;, &quot;user denied&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DefaultSecurityEventType.device_authentication_denied);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ <strong>3段階フロー</strong>: Notification（送信） → Binding（承認） / Denied（拒否）</li>
<li>✅ <strong>PENDING状態</strong>: 非同期認証対応（ユーザーアクション待ち）</li>
<li>✅ <strong>AuthenticationDeviceNotifiers</strong>: FCM/APNS等のPush通知サービス抽象化</li>
<li>✅ <strong>Challenge Code</strong>: デバイス固有のチャレンジコードで検証</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authenticationdevicebindingmessageinteractor-詳細">AuthenticationDeviceBindingMessageInteractor 詳細<a href="#authenticationdevicebindingmessageinteractor-詳細" class="hash-link" aria-label="AuthenticationDeviceBindingMessageInteractor 詳細 への直接リンク" title="AuthenticationDeviceBindingMessageInteractor 詳細 への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/AuthenticationDeviceBindingMessageInteractor-b13e4bdb4d6946e026bc43bbed949fe4.java" target="_blank">AuthenticationDeviceBindingMessageInteractor.java</a></p>
<p>CIBAフローにおけるバインディングメッセージのバックエンド検証を担当。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class AuthenticationDeviceBindingMessageInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionType type() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardAuthenticationInteraction.AUTHENTICATION_DEVICE_BINDING_MESSAGE.toType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String method() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;binding-message&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationTransaction transaction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationInteractionType type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationInteractionRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RequestAttributes requestAttributes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      UserQueryRepository userQueryRepository) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. AuthenticationContextからbinding_messageを取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationContext authenticationContext = transaction.requestContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BindingMessage bindingMessage = authenticationContext.bindingMessage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. binding_message未設定チェック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bindingMessage == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return AuthenticationInteractionRequestResult.clientError(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Map.of(&quot;error&quot;, &quot;invalid_request&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 &quot;error_description&quot;, &quot;Binding Message is null&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type, operationType(), method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DefaultSecurityEventType.authentication_device_binding_message_failure);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. ユーザー入力との一致検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String bindingMessageValue = request.getValueAsString(&quot;binding_message&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!bindingMessage.value().equals(bindingMessageValue)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return AuthenticationInteractionRequestResult.clientError(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Map.of(&quot;error&quot;, &quot;invalid_request&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 &quot;error_description&quot;, &quot;Binding Message is unmatched&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type, operationType(), method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DefaultSecurityEventType.authentication_device_binding_message_failure);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4. 検証成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AuthenticationInteractionStatus.SUCCESS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type, operationType(), method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map.of(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DefaultSecurityEventType.authentication_device_binding_message_success);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>用途</strong>:</p>
<ul>
<li><strong>フィッシング対策</strong>: 消費デバイスと認証デバイス間のトランザクション一致確認</li>
<li><strong>OIDC CIBA仕様準拠</strong>: <a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.7.1" target="_blank" rel="noopener noreferrer">Section 7.1</a></li>
</ul>
<p><strong>SecurityEventType</strong>:</p>
<table><thead><tr><th>イベント</th><th>説明</th></tr></thead><tbody><tr><td><code>authentication_device_binding_message_success</code></td><td>バインディングメッセージ検証成功</td></tr><tr><td><code>authentication_device_binding_message_failure</code></td><td>バインディングメッセージ検証失敗</td></tr></tbody></table>
<p><strong>関連ドキュメント</strong>: <a href="/idp-server/docs/content_05_how-to/how-to-19-ciba-binding-message-verification.md">how-to-19: CIBAバインディングメッセージのバックエンド検証</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-webauthn認証実装challenge-response">4. WebAuthn認証実装（Challenge-Response）<a href="#4-webauthn認証実装challenge-response" class="hash-link" aria-label="4. WebAuthn認証実装（Challenge-Response） への直接リンク" title="4. WebAuthn認証実装（Challenge-Response） への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-authentication-interactors/src/main/java/org/idp/server/authentication/interactors/webauthn/</code></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 1. Challenge生成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WebAuthnAuthenticationChallengeInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public OperationType operationType() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return OperationType.CHALLENGE; // ← チャレンジ専用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // WebAuthnチャレンジ生成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WebAuthnChallenge challenge = WebAuthnChallenge.generate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AuthenticationInteractionStatus.SUCCESS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperationType.CHALLENGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        user,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map.of(&quot;challenge&quot;, challenge.value(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;rpId&quot;, tenant.domain(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;timeout&quot;, 60000),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        null); // Challengeはイベント発行しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. 認証検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WebAuthnAuthenticationInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WebAuthnExecutors executors; // webauthn4jアダプター</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // WebAuthn Assertion検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WebAuthnExecutor executor = executors.get(WebAuthnExecutorType.AUTHENTICATION);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WebAuthnVerificationResult result = executor.verify(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request.optValueAsString(&quot;credential_id&quot;, &quot;&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request.optValueAsString(&quot;authenticator_data&quot;, &quot;&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request.optValueAsString(&quot;client_data_json&quot;, &quot;&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request.optValueAsString(&quot;signature&quot;, &quot;&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result.isSuccess()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          AuthenticationInteractionStatus.SUCCESS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          operationType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          result.user(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Map.of(&quot;status&quot;, &quot;authenticated&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DefaultSecurityEventType.webauthn_authentication_success);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ <strong>OperationType.CHALLENGE</strong>: チャレンジ生成専用インタラクター</li>
<li>✅ <strong>OperationType.AUTHENTICATION</strong>: 認証検証専用インタラクター</li>
<li>✅ <strong>WebAuthnExecutors</strong>: webauthn4jライブラリへの委譲</li>
<li>✅ <strong>Challenge-Response</strong>: FIDO2仕様準拠の2段階フロー</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="認証フローの全体像">認証フローの全体像<a href="#認証フローの全体像" class="hash-link" aria-label="認証フローの全体像 への直接リンク" title="認証フローの全体像 への直接リンク">​</a></h2>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 1. PluginLoaderで全Factoryをロード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;AuthenticationInteractorFactory&gt; factories =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PluginLoader.loadFromInternalModule(AuthenticationInteractorFactory.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. DependencyContainerからInteractor生成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationDependencyContainer container = new AuthenticationDependencyContainer(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;AuthenticationInteractionType, AuthenticationInteractor&gt; interactors = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (AuthenticationInteractorFactory factory : factories) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AuthenticationInteractor interactor = factory.create(container);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  interactors.put(interactor.type(), interactor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 3. 認証実行（例: Password認証）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractionType interactionType = AuthenticationInteractionType.PASSWORD;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractor interactor = interactors.get(interactionType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractionRequestResult result = interactor.interact(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transaction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interactionType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requestAttributes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userQueryRepository);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (result.isSuccess()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 認証成功 → Transactionに反映</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  transaction = transaction.updateWith(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 4. Challenge-Responseフロー（例: WebAuthn）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Phase 1: Challenge生成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractor challengeInteractor =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interactors.get(AuthenticationInteractionType.WEBAUTHN_CHALLENGE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractionRequestResult challengeResult =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    challengeInteractor.interact(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Phase 2: 認証検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractor authInteractor =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interactors.get(AuthenticationInteractionType.WEBAUTHN_AUTHENTICATION);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractionRequestResult authResult =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authInteractor.interact(...);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="認証手段別の特徴">認証手段別の特徴<a href="#認証手段別の特徴" class="hash-link" aria-label="認証手段別の特徴 への直接リンク" title="認証手段別の特徴 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="challenge-response型2段階">Challenge-Response型（2段階）<a href="#challenge-response型2段階" class="hash-link" aria-label="Challenge-Response型（2段階） への直接リンク" title="Challenge-Response型（2段階） への直接リンク">​</a></h3>
<p><strong>対象</strong>: WebAuthn, SMS, Email, Device</p>
<p><strong>フロー</strong>:</p>
<ol>
<li><strong>Challenge生成</strong>: <code>OperationType.CHALLENGE</code> インタラクター実行<!-- -->
<ul>
<li>WebAuthn: ランダムチャレンジ生成</li>
<li>SMS/Email: OTP生成・送信</li>
<li>Device: プッシュ通知送信</li>
</ul>
</li>
<li><strong>認証検証</strong>: <code>OperationType.AUTHENTICATION</code> インタラクター実行<!-- -->
<ul>
<li>WebAuthn: Assertion検証</li>
<li>SMS/Email: OTP検証</li>
<li>Device: デバイスレスポンス検証</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="single-step型1段階">Single-Step型（1段階）<a href="#single-step型1段階" class="hash-link" aria-label="Single-Step型（1段階） への直接リンク" title="Single-Step型（1段階） への直接リンク">​</a></h3>
<p><strong>対象</strong>: Password, External Token, Cancel</p>
<p><strong>フロー</strong>:</p>
<ol>
<li><strong>認証検証のみ</strong>: <code>OperationType.AUTHENTICATION</code> インタラクター実行<!-- -->
<ul>
<li>Password: パスワード即座検証</li>
<li>External Token: 外部IDサービスへトークン検証</li>
<li>Cancel: 認証キャンセル処理</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="動的設定とexecutor委譲">動的設定とExecutor委譲<a href="#動的設定とexecutor委譲" class="hash-link" aria-label="動的設定とExecutor委譲 への直接リンク" title="動的設定とExecutor委譲 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authenticationexecutor-パターンsmsemaildevice">AuthenticationExecutor パターン（SMS/Email/Device）<a href="#authenticationexecutor-パターンsmsemaildevice" class="hash-link" aria-label="AuthenticationExecutor パターン（SMS/Email/Device） への直接リンク" title="AuthenticationExecutor パターン（SMS/Email/Device） への直接リンク">​</a></h3>
<p><strong>設計思想</strong>: 外部サービス連携を動的設定で切り替え可能に</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 1. テナント固有設定を取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationConfiguration configuration = configurationQueryRepository.get(tenant, &quot;sms&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractionConfig interactionConfig =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    configuration.getAuthenticationConfig(&quot;sms-authentication&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationExecutionConfig execution = interactionConfig.execution();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. 設定から実行関数を動的選択</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// execution.function() → &quot;twilio_sms_sender&quot; or &quot;aws_sns_sender&quot; etc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationExecutor executor = executors.get(execution.function());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 3. Executor実行（実装はPlugin）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationExecutionResult result = executor.execute(tenant, transaction, request);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>利点</strong>:</p>
<ul>
<li>✅ <strong>テナントごとに異なるSMS送信サービス</strong>（Twilio, AWS SNS, カスタム実装）</li>
<li>✅ <strong>コード変更なしで切り替え</strong>（設定のみで変更）</li>
<li>✅ <strong>新しいサービス追加が容易</strong>（新Pluginを追加するだけ）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="delegation-パターンpassword">Delegation パターン（Password）<a href="#delegation-パターンpassword" class="hash-link" aria-label="Delegation パターン（Password） への直接リンク" title="Delegation パターン（Password） への直接リンク">​</a></h3>
<p><strong>設計思想</strong>: パスワードハッシュアルゴリズムを抽象化</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class PasswordAuthenticationInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PasswordVerificationDelegation passwordVerificationDelegation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // パスワード検証を委譲</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!passwordVerificationDelegation.verify(password, user.hashedPassword())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 認証失敗</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>利点</strong>:</p>
<ul>
<li>✅ <strong>ハッシュアルゴリズム抽象化</strong>（bcrypt, Argon2等に対応可能）</li>
<li>✅ <strong>セキュリティ要件変更に柔軟</strong>（アルゴリズム変更が容易）</li>
<li>✅ <strong>テスト容易性</strong>（Delegationをモック可能）</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="認証インタラクター設計原則">認証インタラクター設計原則<a href="#認証インタラクター設計原則" class="hash-link" aria-label="認証インタラクター設計原則 への直接リンク" title="認証インタラクター設計原則 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-tenant第一引数の徹底">1. Tenant第一引数の徹底<a href="#1-tenant第一引数の徹底" class="hash-link" aria-label="1. Tenant第一引数の徹底 への直接リンク" title="1. Tenant第一引数の徹底 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationInteractionRequestResult interact(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tenant tenant,  // ← 必ず第一引数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationTransaction transaction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationInteractionType type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationInteractionRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RequestAttributes requestAttributes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UserQueryRepository userQueryRepository);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>理由</strong>: マルチテナント分離を型システムで強制</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-securityevent発行の一貫性">2. SecurityEvent発行の一貫性<a href="#2-securityevent発行の一貫性" class="hash-link" aria-label="2. SecurityEvent発行の一貫性 への直接リンク" title="2. SecurityEvent発行の一貫性 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 成功時</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationInteractionStatus.SUCCESS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    operationType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DefaultSecurityEventType.{method}_success); // ← 必ず成功イベント</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 失敗時</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return new AuthenticationInteractionRequestResult(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationInteractionStatus.CLIENT_ERROR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    operationType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errorResponse,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DefaultSecurityEventType.{method}_failure); // ← 必ず失敗イベント</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>理由</strong>: 全認証試行を監査ログ・SIEM連携で追跡可能に</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-amr値の正確性">3. AMR値の正確性<a href="#3-amr値の正確性" class="hash-link" aria-label="3. AMR値の正確性 への直接リンク" title="3. AMR値の正確性 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public String method() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardAuthenticationMethod.PASSWORD.type(); // &quot;pwd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要</strong>: <a href="https://www.rfc-editor.org/rfc/rfc8176.html" target="_blank" rel="noopener noreferrer">RFC 8176 - Authentication Method Reference Values</a> 準拠</p>
<table><thead><tr><th>認証手段</th><th>AMR値</th><th>RFC準拠</th></tr></thead><tbody><tr><td>Password</td><td><code>pwd</code></td><td>✅ RFC 8176</td></tr><tr><td>SMS</td><td><code>sms</code></td><td>✅ RFC 8176</td></tr><tr><td>WebAuthn</td><td><code>fido</code></td><td>✅ RFC 8176</td></tr><tr><td>FIDO-UAF</td><td><code>fido</code></td><td>✅ RFC 8176</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="拡張性の実現方法">拡張性の実現方法<a href="#拡張性の実現方法" class="hash-link" aria-label="拡張性の実現方法 への直接リンク" title="拡張性の実現方法 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="新しい認証手段の追加手順">新しい認証手段の追加手順<a href="#新しい認証手段の追加手順" class="hash-link" aria-label="新しい認証手段の追加手順 への直接リンク" title="新しい認証手段の追加手順 への直接リンク">​</a></h3>
<ol>
<li><strong>Interactor実装</strong></li>
</ol>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomAuthenticationInteractor implements AuthenticationInteractor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionType type() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new AuthenticationInteractionType(&quot;custom_auth&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String method() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;custom&quot;; // カスタムAMR値</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractionRequestResult interact(...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // カスタム認証ロジック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li><strong>Factory実装</strong></li>
</ol>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomAuthenticationInteractorFactory implements AuthenticationInteractorFactory {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public AuthenticationInteractor create(AuthenticationDependencyContainer container) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new CustomAuthenticationInteractor();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li><strong>Plugin登録</strong></li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># META-INF/services/org.idp.server.core.openid.authentication.plugin.AuthenticationInteractorFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.idp.server.authentication.interactors.custom.CustomAuthenticationInteractorFactory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>これだけで完了</strong>: コアコード変更不要、設定追加のみで新認証手段が利用可能に</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="関連ドキュメント">関連ドキュメント<a href="#関連ドキュメント" class="hash-link" aria-label="関連ドキュメント への直接リンク" title="関連ドキュメント への直接リンク">​</a></h2>
<ul>
<li><a href="/idp-server/docs/content_10_ai_developer/ai-40-authentication-federation">認証・連携層トップ</a></li>
<li><a href="/idp-server/docs/content_10_ai_developer/ai-42-webauthn">WebAuthn/FIDO2実装</a></li>
<li><a href="/idp-server/docs/content_10_ai_developer/ai-43-federation-oidc">OIDCフェデレーション</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-ドキュメント検証結果">📋 ドキュメント検証結果<a href="#-ドキュメント検証結果" class="hash-link" aria-label="📋 ドキュメント検証結果 への直接リンク" title="📋 ドキュメント検証結果 への直接リンク">​</a></h2>
<p><strong>検証日</strong>: 2025-10-12
<strong>検証方法</strong>: <code>ls libs/idp-server-authentication-interactors/src/main/java/org/idp/server/authentication/interactors/</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-検証済み項目">✅ 検証済み項目<a href="#-検証済み項目" class="hash-link" aria-label="✅ 検証済み項目 への直接リンク" title="✅ 検証済み項目 への直接リンク">​</a></h3>
<table><thead><tr><th>項目</th><th>記載内容</th><th>実装確認</th><th>状態</th></tr></thead><tbody><tr><td><strong>認証手段数</strong></td><td>10種類</td><td>10パッケージ</td><td>✅ 完全一致</td></tr><tr><td><strong>OperationType</strong></td><td>2種類</td><td>CHALLENGE/AUTHENTICATION</td><td>✅ 正確</td></tr><tr><td><strong>Status種類</strong></td><td>3種類</td><td>SUCCESS/CLIENT_ERROR/PENDING</td><td>✅ 正確</td></tr><tr><td><strong>AMR値</strong></td><td>RFC 8176準拠</td><td>✅ 準拠</td><td>✅ 正確</td></tr><tr><td><strong>SecurityEvent連携</strong></td><td>全Interactor</td><td>✅ 実装確認</td><td>✅ 正確</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-実装パッケージ一覧実装確認済み">🎯 実装パッケージ一覧（実装確認済み）<a href="#-実装パッケージ一覧実装確認済み" class="hash-link" aria-label="🎯 実装パッケージ一覧（実装確認済み） への直接リンク" title="🎯 実装パッケージ一覧（実装確認済み） への直接 リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">✅ cancel/                    # 認証キャンセル</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ device/                    # デバイス認証（12クラス）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ email/                     # メールOTP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ external_token/            # 外部IDサービス連携</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ fidouaf/                   # FIDO-UAF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ initial_registration/      # 初回登録</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ password/                  # パスワード認証（2クラス）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ plugin/                    # Plugin共通定義</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ sms/                       # SMS OTP（18クラス）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ webauthn/                  # WebAuthn/FIDO2（16クラス）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-総合評価">📊 総合評価<a href="#-総合評価" class="hash-link" aria-label="📊 総合評価 への直接リンク" title="📊 総合評価 への直接リンク">​</a></h3>
<table><thead><tr><th>カテゴリ</th><th>精度</th><th>評価</th></tr></thead><tbody><tr><td><strong>認証手段一覧</strong></td><td>100%</td><td>✅ 完璧</td></tr><tr><td><strong>実装パターン</strong></td><td>100%</td><td>✅ 完璧</td></tr><tr><td><strong>OperationType</strong></td><td>100%</td><td>✅ 完璧</td></tr><tr><td><strong>SecurityEvent</strong></td><td>100%</td><td>✅ 完璧</td></tr><tr><td><strong>拡張性説明</strong></td><td>100%</td><td>✅ 完璧</td></tr><tr><td><strong>全体精度</strong></td><td><strong>100%</strong></td><td>✅ 完璧</td></tr></tbody></table>
<p><strong>結論</strong>: 認証インタラクターの役割・構造・主要クラスを実装に基づき詳細化。Plugin拡張性とSecurityEvent連携を明確化。</p>
<hr>
<p><strong>情報源</strong>:</p>
<ul>
<li><code>libs/idp-server-authentication-interactors/</code>配下の全実装</li>
<li><a href="/idp-server/assets/files/PasswordAuthenticationInteractor-41cf0d0c1102b826a1bc515adbdaa3fe.java" target="_blank">PasswordAuthenticationInteractor.java</a></li>
<li><a href="/idp-server/assets/files/SmsAuthenticationInteractor-185477696d9625fdae1390162495d240.java" target="_blank">SmsAuthenticationInteractor.java</a></li>
<li><a href="https://www.rfc-editor.org/rfc/rfc8176.html" target="_blank" rel="noopener noreferrer">RFC 8176 - Authentication Method Reference Values</a></li>
</ul>
<p><strong>最終更新</strong>: 2025-10-12
<strong>検証者</strong>: Claude Code（AI開発支援）</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_10_ai_developer/ai-41-authentication.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_10_ai_developer/ai-40-authentication-federation"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">認証・連携層 - ユーザー認証とフェデレーション</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_10_ai_developer/ai-42-webauthn"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">idp-server-webauthn4j-adapter - WebAuthn4jライブラリ統合</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#モジュール概要" class="table-of-contents__link toc-highlight">モジュール概要</a><ul><li><a href="#責務" class="table-of-contents__link toc-highlight">責務</a></li><li><a href="#対応認証手段" class="table-of-contents__link toc-highlight">対応認証手段</a></li></ul></li><li><a href="#アーキテクチャ  概要" class="table-of-contents__link toc-highlight">アーキテクチャ概要</a><ul><li><a href="#設計思想" class="table-of-contents__link toc-highlight">設計思想</a></li><li><a href="#2つのoperationtype" class="table-of-contents__link toc-highlight">2つのOperationType</a></li><li><a href="#authenticationinteractionstatus" class="table-of-contents__link toc-highlight">AuthenticationInteractionStatus</a></li><li><a href="#securityeventtype連携" class="table-of-contents__link toc-highlight">SecurityEventType連携</a></li></ul></li><li><a href="#authenticationinteractorfactory-パターン" class="table-of-contents__link toc-highlight">AuthenticationInteractorFactory パターン</a></li><li><a href="#authenticationinteractor-インターフェース" class="table-of-contents__link toc-highlight">AuthenticationInteractor インターフェース</a></li><li><a href="#plugin登録" class="table-of-contents__link toc-highlight">Plugin登録</a></li><li><a href="#実装パターン" class="table-of-contents__link toc-highlight">実装パターン</a><ul><li><a href="#1-password認証実装" class="table-of-contents__link toc-highlight">1. Password認証実装</a></li><li><a href="#2-sms認証実装authenticationexecutor連携" class="table-of-contents__link toc-highlight">2. SMS認証実装（AuthenticationExecutor連携）</a></li><li><a href="#3-device認証実装プッシュ通知" class="table-of-contents__link toc-highlight">3. Device認証実装（プッシュ通知）</a></li><li><a href="#authenticationdevicebindingmessageinteractor-詳細" class="table-of-contents__link toc-highlight">AuthenticationDeviceBindingMessageInteractor 詳細</a></li><li><a href="#4-webauthn認証実装challenge-response" class="table-of-contents__link toc-highlight">4. WebAuthn認証実装（Challenge-Response）</a></li></ul></li><li><a href="#認証フローの全体像" class="table-of-contents__link toc-highlight">認証フローの全体像</a></li><li><a href="#認証手段別の特徴" class="table-of-contents__link toc-highlight">認証手段別の特徴</a><ul><li><a href="#challenge-response型2段階" class="table-of-contents__link toc-highlight">Challenge-Response型（2段階）</a></li><li><a href="#single-step型1段階" class="table-of-contents__link toc-highlight">Single-Step型（1段階）</a></li></ul></li><li><a href="#動的設定とexecutor委譲" class="table-of-contents__link toc-highlight">動的設定とExecutor委譲</a><ul><li><a href="#authenticationexecutor-パターンsmsemaildevice" class="table-of-contents__link toc-highlight">AuthenticationExecutor パターン（SMS/Email/Device）</a></li><li><a href="#delegation-パターンpassword" class="table-of-contents__link toc-highlight">Delegation パターン（Password）</a></li></ul></li><li><a href="#認証インタラクター設計原則" class="table-of-contents__link toc-highlight">認証インタラクター設計原則</a><ul><li><a href="#1-tenant第一引数の徹底" class="table-of-contents__link toc-highlight">1. Tenant第一引数の徹底</a></li><li><a href="#2-securityevent発行の一貫性" class="table-of-contents__link toc-highlight">2. SecurityEvent発行の一貫性</a></li><li><a href="#3-amr値の正確性" class="table-of-contents__link toc-highlight">3. AMR値の正確性</a></li></ul></li><li><a href="#拡張性の実現方法" class="table-of-contents__link toc-highlight">拡張性の実現方法</a><ul><li><a href="#新しい認証手段の追加手順" class="table-of-contents__link toc-highlight">新しい認証手段の追加手順</a></li></ul></li><li><a href="#関連ドキュメント" class="table-of-contents__link toc-highlight">関連ドキュメント</a></li><li><a href="#-ドキュメント検証結果" class="table-of-contents__link toc-highlight">📋 ドキュメント検証結果</a><ul><li><a href="#-検証済み項目" class="table-of-contents__link toc-highlight">✅ 検証済み項目</a></li><li><a href="#-実装パッケージ一覧実装確認済み" class="table-of-contents__link toc-highlight">🎯 実装パッケージ一覧（実装確認済み）</a></li><li><a href="#-総合評価" class="table-of-contents__link toc-highlight">📊 総合評価</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>