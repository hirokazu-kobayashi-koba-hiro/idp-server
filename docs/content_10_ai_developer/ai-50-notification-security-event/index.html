<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_10_ai_developer/ai-50-notification-security-event" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">通知・イベント層 - 通知配信とセキュリティイベント | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-50-notification-security-event"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="通知・イベント層 - 通知配信とセキュリティイベント | IdP-Server Documentation"><meta data-rh="true" name="description" content="概要"><meta data-rh="true" property="og:description" content="概要"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-50-notification-security-event"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-50-notification-security-event" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_10_ai_developer/ai-50-notification-security-event" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.6e851c65.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.d0da808f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">📚 ドキュメント索引</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">技術概要</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_01_intro/intro-02-features">機能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_01_intro/intro-03-use-cases">ユースケース一覧</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">Getting-Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_02_quickstart/quickstart-02-setting-templates">初期設定テンプレート（予定）</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_03_concepts/concept-01-multi-tenant">コア概念</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-01-multi-tenant">マ  ルチテナント</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-02-id-management">ID（ユーザー）管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-03-id-verified">身元確認済みID</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-04-enterprise-id">エンタープライズID</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-05-authentication-policy">認証ポリシー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-06-token-management">トークン管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-07-session-management">セッション管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-08-mfa">多要素認証（MFA）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-09-custom-claims">カスタムクレーム・スコープ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-10-control-plane">コントロールプレーン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-11-security-events">セキュリティイベント・フック</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-12-authorization">認可</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-13-audit-compliance">監査ログ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-14-grant-management">認可許諾管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-15-operations">運用・保守</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-16-external-service-integration">外部サービス連携</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-17-application-logging">アプリケーションログ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-18-id-token">IDトークン（ID Token）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-19-client">クライアント（Client）</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-01-identity-management-basics">基礎（読み物）</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認可プロトコル</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認可コードフロー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_04_protocols/protocol-02-ciba-flow">CIBA フロー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_04_protocols/protocol-03-introspection">イントロスペクション</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_05_how-to/index">How-to（設定・運用レシピ）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/index">How-to ガイド - 学習ロードマップ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-01-server-setup">サーバー初期設定ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-02-organization-initialization">組織初期化ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-03-tenant-setup">OIDCの最小設定ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-04-client-registration">クライアント登録ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-05-user-registration">ユーザー登録と初回認証</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-07-authentication-policy-basic">認証ポリシー設定ガイド（基礎編）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-08-mfa-setup">MFA（多要素認証）の設定</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-09-token-strategy">トークン有効期限パターン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-10-authentication-policy-advanced">認証ポリシー設定ガイド（詳細編）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-11-federation-setup">外部IdP連携（Federation）の設定</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-12-ciba-flow-fido-uaf">CIBA + FIDO-UAF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-13-fido-uaf-registration">FIDO-UAF 登録フロー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-14-fido-uaf-deregistration">FIDO-UAF 解除フロー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-15-identity-verification-guide">身元確認申込み 導入ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-16-identity-verification-application">身元確認申込み</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-17-identity-verification-registration">身元確認データ登録</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_05_how-to/how-to-18-security-event-hooks">セキュリティイベントフック設定ガイド</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_06_developer-guide/getting-started/service-overview">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/getting-started/service-overview">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/control-plane/resource-overview">Control Plane（管理API）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/application-plane/overview">Application Plane（認証・認可API）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/implementation-guides/overview">Implementation Guides（実装ガイド）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/configuration/CONFIGURATION_COVERAGE">Configuration（設定）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/patterns/common-patterns">Patterns（実装パターン）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/troubleshooting/common-errors">Troubleshooting（トラブルシューティング）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/reference/code-review-checklist">Reference（リファレンス）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_06_developer-guide/learning-paths/beginner">Learning Paths（学習パス）</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_07_reference/api-reference">API ドキュメント</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">テスト戦略</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_08_ops/ops-02-performance-test">ストレステスト結果</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_08_ops/commercial-deployment/overview">商用デプロイ</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_09_project/project-01-faq">project-01-faq</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_09_project/project-02-roadmap">🗺️ ロードマップ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_09_project/project-03-contributing">コントリビュートガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_09_project/project-04-license">License</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI開発者向けモジュールガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-02-lessons-learned">AI開発者向けドキュメント作成ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-10-use-cases">idp-server-use-cases - ユースケース層（EntryService実装）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-11-core">idp-server-core - OAuth 2.0/OIDC準拠コアエンジン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-12-platform">idp-server-platform - プラットフォーム基盤</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-13-control-plane">idp-server-control-plane - 管理API契約定義</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-20-adapters">Adapter層 - Repository実装とインフラ統合</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-21-core-adapter">idp-server-core-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-22-database">idp-server-database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-23-springboot-adapter">idp-server-springboot-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-30-extensions">拡張機能層 - OAuth/OIDC拡張仕様</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-31-extension-ciba">idp-server-core-extension-ciba - CIBA拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-32-extension-fapi">idp-server-core-extension-fapi - FAPI拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-33-extension-ida">idp-server-core-extension-ida - IDA拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-34-extension-pkce">idp-server-core-extension-pkce - PKCE拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-35-extension-vc">idp-server-core-extension-verifiable-credentials - VC拡張</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-40-authentication-federation">認証・連携層 - ユーザー認証とフェデレーション</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-41-authentication">idp-server-authentication-interactors - 認証インタラクター</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-42-webauthn">idp-server-webauthn4j-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-43-federation-oidc">idp-server-federation-oidc</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-50-notification-security-event">通知・イベント層 - 通知配信とセキュリティイベント</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-51-notification-fcm">idp-server-notification-fcm-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-52-notification-apns">idp-server-notification-apns-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-53-email-aws">idp-server-email-aws-adapter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-54-security-event-framework">idp-server-security-event-framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_10_ai_developer/ai-55-security-event-hooks">idp-server-security-event-hooks</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AI</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">通知・イベント層 - 通知配信とセキュリティイベント</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>通知・イベント層 - 通知配信とセキュリティイベント</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="概要">概要<a href="#概要" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h2>
<p>ユーザーへの通知配信とセキュリティイベント管理を提供するモジュール群。</p>
<p><strong>5つのモジ ュール</strong>:</p>
<ol>
<li><strong>idp-server-notification-fcm-adapter</strong> - Firebase Cloud Messaging</li>
<li><strong>idp-server-notification-apns-adapter</strong> - Apple Push Notification Service</li>
<li><strong>idp-server-email-aws-adapter</strong> - AWS SES メール送信</li>
<li><strong>idp-server-security-event-framework</strong> - Shared Signals Framework</li>
<li><strong>idp-server-security-event-hooks</strong> - セキュリティイベントフック</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="通知モジュール">通知モジュール<a href="#通知モジュール" class="hash-link" aria-label="通知モジュール への直接リンク" title="通知モジュール への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="idp-server-notification-fcm-adapter">idp-server-notification-fcm-adapter<a href="#idp-server-notification-fcm-adapter" class="hash-link" aria-label="idp-server-notification-fcm-adapter への直接リンク" title="idp-server-notification-fcm-adapter への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-notification-fcm-adapter/</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="責務">責務<a href="#責務" class="hash-link" aria-label="責務 への直接リンク" title="責務 への直接リンク">​</a></h4>
<p>Firebase Cloud Messaging (FCM) によるプッシュ通知。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="主要機能">主要機能<a href="#主要機能" class="hash-link" aria-label="主要機能 への直接リンク" title="主要機能 への直接リンク">​</a></h4>
<ul>
<li><strong>Android/iOS/Web</strong> プッシュ通知</li>
<li><strong>通知優先度</strong>: high/normal</li>
<li><strong>Data Payload</strong>: カスタムデータ配信</li>
<li><strong>トピック配信</strong>: 複数デバイスへの一斉配信</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="実装パターン">実装パターン<a href="#実装パターン" class="hash-link" aria-label="実装パターン への直接リンク" title="実装パターン への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/FcmNotifier-531966a25cca8b77325c86aedae3befc.java#L37-L108" target="_blank">FcmNotifier.java:37-108</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * FCM通知実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの37-108行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FcmNotifier implements AuthenticationDeviceNotifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggerWrapper log = LoggerWrapper.getLogger(FcmNotifier.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  JsonConverter jsonConverter = JsonConverter.snakeCaseInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;String, FirebaseMessaging&gt; cache = new ConcurrentHashMap&lt;&gt;();  // ✅ テナント別キャッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public NotificationChannel chanel() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new NotificationChannel(&quot;fcm&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public NotificationResult notify(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationDevice device,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationExecutionConfig configuration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. FCM設定取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FcmConfiguration fcmConfiguration =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jsonConverter.read(configuration.details().get(&quot;fcm&quot;), FcmConfiguration.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. FirebaseMessaging取得（テナント別キャッシュ）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FirebaseMessaging firebaseMessaging = getOrInitFirebaseMessaging(tenant, fcmConfiguration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. 通知テンプレート・トークン取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NotificationTemplate template = fcmConfiguration.findTemplate(&quot;default&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String notificationToken = device.notificationToken().value();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4. メッセージ構築（Android/iOS両対応）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message message =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Message.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setToken(notificationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setAndroidConfig(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                AndroidConfig.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .setPriority(AndroidConfig.Priority.HIGH)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .putData(&quot;sender&quot;, template.optSender(tenant.identifierValue()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .putData(&quot;title&quot;, template.optTitle(&quot;Transaction Authentication&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .putData(&quot;body&quot;, template.optBody(&quot;Please approve...&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setApnsConfig(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ApnsConfig.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .putHeader(&quot;apns-priority&quot;, &quot;10&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .setAps(Aps.builder().setContentAvailable(true).build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 5. 送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String result = firebaseMessaging.send(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return NotificationResult.success(&quot;fcm&quot;, Map.of(&quot;result&quot;, result));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ テナント別FirebaseMessaging初期化・キャッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FirebaseMessaging getOrInitFirebaseMessaging(Tenant tenant, FcmConfiguration config) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return cache.computeIfAbsent(tenant.identifierValue(), (key) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      FirebaseOptions options = FirebaseOptions.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .setCredentials(GoogleCredentials.fromStream(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              new ByteArrayInputStream(config.credential().getBytes())))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      FirebaseApp app = FirebaseApp.initializeApp(options, tenant.identifierValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return FirebaseMessaging.getInstance(app);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ <code>AuthenticationDeviceNotifier</code> インターフェース実装</li>
<li>✅ テナント別FirebaseMessaging キャッシュ（マルチテナント対応）</li>
<li>✅ <code>NotificationTemplate</code> による設定駆動</li>
<li>✅ Android/iOS両対応のメッセージ構築</li>
<li>✅ <code>NotificationResult</code> によるステータス管理</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="idp-server-notification-apns-adapter">idp-server-notification-apns-adapter<a href="#idp-server-notification-apns-adapter" class="hash-link" aria-label="idp-server-notification-apns-adapter への直接リンク" title="idp-server-notification-apns-adapter への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-notification-apns-adapter/</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="責務-1">責務<a href="#責務-1" class="hash-link" aria-label="責務 への直接リンク" title="責務 への直接リンク">​</a></h4>
<p>Apple Push Notification Service (APNS) によるプッシュ通知。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="主要機能-1">主要機能<a href="#主要機能-1" class="hash-link" aria-label="主要機能 への直接リンク" title="主要機能 への直接リンク">​</a></h4>
<ul>
<li><strong>iOS/macOS</strong> プッシュ通知</li>
<li><strong>Badge/Sound/Alert</strong> 設定</li>
<li><strong>Silent Notification</strong>: バックグラウンド更新</li>
<li><strong>Token Authentication</strong>: JWT認証</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="実装パターン-1">実装パターン<a href="#実装パターン-1" class="hash-link" aria-label="実装パター ン への直接リンク" title="実装パターン への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/ApnsNotifier-3f2a890421f42bcd692af1b4996298f7.java#L42-L134" target="_blank">ApnsNotifier.java:42-134</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * APNS通知実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの42-134行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApnsNotifier implements AuthenticationDeviceNotifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LoggerWrapper log = LoggerWrapper.getLogger(ApnsNotifier.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  JsonConverter jsonConverter = JsonConverter.snakeCaseInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;String, JwtTokenCache&gt; jwtTokenCache = new ConcurrentHashMap&lt;&gt;();  // ✅ JWT認証トークンキャッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpClient httpClient = HttpClient.newBuilder().version(HttpClient.Version.HTTP_2).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private static final String PRODUCTION_URL = &quot;https://api.push.apple.com&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private static final String DEVELOPMENT_URL = &quot;https://api.sandbox.push.apple.com&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public NotificationChannel chanel() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new NotificationChannel(&quot;apns&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public NotificationResult notify(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationDevice device,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AuthenticationExecutionConfig configuration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. APNS設定取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ApnsConfiguration apnsConfiguration =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jsonConverter.read(configuration.details().get(&quot;apns&quot;), ApnsConfiguration.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. JWT認証トークン取得（キャッシュ、1時間有効）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String jwtToken = getOrCreateJwtToken(tenant, apnsConfiguration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. 通知テンプレート取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NotificationTemplate template = apnsConfiguration.findTemplate(&quot;default&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String notificationToken = device.notificationToken().value();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4. APNsペイロード構築（JSON）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String payload = createApnsPayload(template, tenant);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 5. HTTP/2リクエスト送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String apnsUrl = (apnsConfiguration.isProduction() ? PRODUCTION_URL : DEVELOPMENT_URL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        + &quot;/3/device/&quot; + notificationToken;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpRequest request =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpRequest.newBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .uri(URI.create(apnsUrl))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .header(&quot;Authorization&quot;, &quot;bearer &quot; + jwtToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .header(&quot;apns-topic&quot;, apnsConfiguration.bundleId())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .header(&quot;apns-priority&quot;, &quot;10&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .header(&quot;apns-push-type&quot;, &quot;alert&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .header(&quot;Content-Type&quot;, &quot;application/json&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .POST(HttpRequest.BodyPublishers.ofString(payload))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpResponse&lt;String&gt; response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (response.statusCode() == 200) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return NotificationResult.success(&quot;apns&quot;, Map.of(&quot;status&quot;, &quot;sent&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return NotificationResult.failure(&quot;apns&quot;, &quot;APNs returned: &quot; + response.statusCode());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ Java標準<code>HttpClient</code>（HTTP/2対応）でAPNs直接通信</li>
<li>✅ JWT認証トークンの生成・キャッシュ（1時間有効）</li>
<li>✅ Production/Development環  境切り替え</li>
<li>✅ <code>NotificationTemplate</code>による設定駆動</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="idp-server-email-aws-adapter">idp-server-email-aws-adapter<a href="#idp-server-email-aws-adapter" class="hash-link" aria-label="idp-server-email-aws-adapter への直接リンク" title="idp-server-email-aws-adapter への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-email-aws-adapter/</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="責務-2">責務<a href="#責務-2" class="hash-link" aria-label="責務 への直接リンク" title="責務 への直接リンク">​</a></h4>
<p>AWS SES (Simple Email Service) によるメール送信。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="主要機能-2">主要機能<a href="#主要機能-2" class="hash-link" aria-label="主要機能 への直接リンク" title="主要機能 への直接リンク">​</a></h4>
<ul>
<li><strong>HTML/Text</strong> メール</li>
<li><strong>添付ファイル</strong>: 添付ファイル送信</li>
<li><strong>テンプレート</strong>: SESテンプレート使用</li>
<li><strong>バウンス/苦情</strong> ハンドリング</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="emailsender-インターフェース実装">EmailSender インターフェース・実装<a href="#emailsender-インターフェース実装" class="hash-link" aria-label="EmailSender インターフェース・実装 への直接リンク" title="EmailSender インターフェース・実装 への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/AwsEmailSender-280e08ebe67200f8f66a6938b433a05d.java#L29-L82" target="_blank">AwsEmailSender.java:29-82</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * メール送信インターフェース（Plugin）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface EmailSender {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  String function();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EmailSendResult send(EmailSendingRequest request, EmailSenderConfiguration configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * AWS SES実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの29-82行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AwsEmailSender implements EmailSender {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  JsonConverter jsonConverter = JsonConverter.snakeCaseInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public String function() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;aws_ses&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public EmailSendResult send(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      EmailSendingRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      EmailSenderConfiguration configuration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. SES設定取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AwsSesEmailSenderConfig sesConfig =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jsonConverter.read(configuration.details(), AwsSesEmailSenderConfig.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. SESクライアント作成（AWS SDK v2）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Region region = Region.of(sesConfig.regionName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SesClient sesClient =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SesClient.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .credentialsProvider(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                StaticCredentialsProvider.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    AwsBasicCredentials.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sesConfig.accessKeyId(), sesConfig.secretAccessKey())))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .region(region)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. メール送信リクエスト構築</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Destination destination = Destination.builder().toAddresses(request.to()).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Content subject = Content.builder().data(request.subject()).charset(&quot;UTF-8&quot;).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Content textBody = Content.builder().data(request.body()).charset(&quot;UTF-8&quot;).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Body body = Body.builder().text(textBody).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message message = Message.builder().subject(subject).body(body).build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SendEmailRequest emailRequest =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SendEmailRequest.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .source(sesConfig.sender())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .destination(destination)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .message(message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4. 送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SendEmailResponse response = sesClient.sendEmail(emailRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new EmailSendResult(true, Map.of(&quot;message_id&quot;, response.messageId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ AWS SDK v2使用（<code>software.amazon.awssdk</code>）</li>
<li>✅ <code>EmailSenderConfiguration</code>による設定駆動</li>
<li>✅ <code>EmailSendResult</code>による結果管理</li>
<li>✅ リージョン・認証情報の設定可能</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="plugin登録">Plugin登録<a href="#plugin登録" class="hash-link" aria-label="Plugin登録 への直接リンク" title="Plugin登録 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># META-INF/services/org.idp.server.platform.notification.email.EmailSender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.idp.server.emai.aws.adapter.AwsEmailSender</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="セキュリティイベントモジュール">セキュリティイベントモジュール<a href="#セキュリティイベントモジュール" class="hash-link" aria-label="セキュリティイベントモジュール への直接リンク" title="セキュリティイベントモジュール への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="idp-server-security-event-framework">idp-server-security-event-framework<a href="#idp-server-security-event-framework" class="hash-link" aria-label="idp-server-security-event-framework への直接リンク" title="idp-server-security-event-framework への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-security-event-framework/</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="責務-3">責務<a href="#責務-3" class="hash-link" aria-label="責務 への直接リンク" title="責務 への直接リンク">​</a></h4>
<p>Shared Signals Framework (SSF) によるセキュリティイベント配信。</p>
<p><strong>仕様</strong>: <a href="https://openid.net/specs/openid-sse-framework-1_0.html" target="_blank" rel="noopener noreferrer">Shared Signals Framework</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="主要機能-3">主要機能<a href="#主要機能-3" class="hash-link" aria-label="主要機能 への直接リンク" title="主要機能 への直接リンク">​</a></h4>
<ul>
<li><strong>Push Delivery</strong>: Webhook配信</li>
<li><strong>Pull Delivery</strong>: Polling配信</li>
<li><strong>Event Types</strong>: <code>account-disabled</code>, <code>credential-change</code>, <code>session-revoked</code>等</li>
<li><strong>Security Event Token (SET)</strong>: JWT形式のイベント</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ssf-event-types">SSF Event Types<a href="#ssf-event-types" class="hash-link" aria-label="SSF Event Types への直接リンク" title="SSF Event Types への直接リンク">​</a></h4>
<table><thead><tr><th>Event Type</th><th>説明</th></tr></thead><tbody><tr><td><code>https://schemas.openid.net/secevent/risc/event-type/account-disabled</code></td><td>アカウント無効化</td></tr><tr><td><code>https://schemas.openid.net/secevent/risc/event-type/credential-change</code></td><td>認証情報変更</td></tr><tr><td><code>https://schemas.openid.net/secevent/risc/event-type/session-revoked</code></td><td>セッション無効化</td></tr><tr><td><code>https://schemas.openid.net/secevent/caep/event-type/token-claims-change</code></td><td>トークンクレーム変更</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ssf-hook-executor---push-delivery実装">SSF Hook Executor - Push Delivery実装<a href="#ssf-hook-executor---push-delivery実装" class="hash-link" aria-label="SSF Hook Executor - Push Delivery実装 への直接リンク" title="SSF Hook Executor - Push Delivery実装 への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/SsfHookExecutor-51d5336d11e4e24238156b880032ec40.java#L35-L176" target="_blank">SsfHookExecutor.java:35-176</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * SSF Hook Executor（Push Delivery）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの35-176行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SsfHookExecutor implements SecurityEventHook {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpRequestExecutor httpRequestExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  JsonConverter jsonConverter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public SecurityEventHookType type() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardSecurityEventHookType.SSF.toHookType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public SecurityEventHookResult execute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEvent securityEvent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventHookConfiguration hookConfiguration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long startTime = System.currentTimeMillis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 1. SSF設定取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventConfig securityEventConfig = hookConfiguration.getEvent(securityEvent.type());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SharedSignalFrameworkMetadataConfig metadataConfig =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          jsonConverter.read(hookConfiguration.metadata(), SharedSignalFrameworkMetadataConfig.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventExecutionConfig executionConfig = securityEventConfig.execution();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SharedSignalFrameworkTransmissionConfig transmissionConfig =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          jsonConverter.read(executionConfig.details(), SharedSignalFrameworkTransmissionConfig.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 2. Security Event Token (SET) 生成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventTokenCreator securityEventTokenCreator =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          new SecurityEventTokenCreator(securityEvent, metadataConfig, transmissionConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventToken securityEventToken = securityEventTokenCreator.create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 3. SSF送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return send(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hookConfiguration,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          securityEvent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          transmissionConfig.url(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          securityEventToken,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          transmissionConfig,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          startTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      long executionDurationMs = System.currentTimeMillis() - startTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return SecurityEventHookResult.failureWithContext(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hookConfiguration,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          securityEvent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          executionDurationMs,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          e.getClass().getSimpleName(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;SSF hook execution failed: &quot; + e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private SecurityEventHookResult send(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventHookConfiguration hookConfiguration,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEvent securityEvent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      String endpoint,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventToken securityEventToken,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SharedSignalFrameworkTransmissionConfig transmissionConfig,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      long startTime) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // HTTPリクエスト構築</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpRequest httpRequest = HttpRequest.newBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .uri(new URI(endpoint))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .header(&quot;Content-Type&quot;, &quot;application/secevent+jwt&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .POST(HttpRequest.BodyPublishers.ofString(securityEventToken.value()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // OAuth認証が設定されている場合は追加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpRequestResult httpRequestResult =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (transmissionConfig.oauthAuthorization() != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ? httpRequestExecutor.executeWithOAuth(httpRequest, transmissionConfig.oauthAuthorization())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            : httpRequestExecutor.execute(httpRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long executionDurationMs = System.currentTimeMillis() - startTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // レスポンスハンドリング</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (httpRequestResult.isSuccess()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return SecurityEventHookResult.successWithContext(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hookConfiguration, securityEvent, executionDetails, executionDurationMs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return SecurityEventHookResult.failureWithContext(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hookConfiguration, securityEvent, executionDetails, executionDurationMs,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;SSF_ERROR&quot;, &quot;SSF transmission failed&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ <code>SecurityEventHook</code> インターフェース実装</li>
<li>✅ <code>SecurityEventTokenCreator</code>によるSET生成</li>
<li>✅ OAuth認証オプション対応</li>
<li>✅ <code>SecurityEventHookResult</code>による結果管理</li>
<li>✅ 実行時間計測（executionDurationMs）</li>
</ul>
<p><strong>注意</strong>: SSF Pull Deliveryの実装は現時点で未確認。実装が存在するか要調査。</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="idp-server-security-event-hooks">idp-server-security-event-hooks<a href="#idp-server-security-event-hooks" class="hash-link" aria-label="idp-server-security-event-hooks への直接リンク" title="idp-server-security-event-hooks への直接リンク">​</a></h3>
<p><strong>情報源</strong>: <code>libs/idp-server-security-event-hooks/</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="責務-4">責務<a href="#責務-4" class="hash-link" aria-label="責務 への直接リンク" title="責務 への直接リンク">​</a></h4>
<p>セキュリティイベントフック（Webhook/Slack/Datadog連携）。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="主要機能-4">主要機能<a href="#主要機能-4" class="hash-link" aria-label="主要機能 への直接リンク" title="主要機能 への直接リンク">​</a></h4>
<ul>
<li><strong>Webhook</strong>: 汎用Webhook配信</li>
<li><strong>Slack</strong>: Slack通知</li>
<li><strong>Datadog</strong>: Datadogイベント送信</li>
<li><strong>Retry Mechanism</strong>: 失敗時のリトライ</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="securityeventhook-インターフェース">SecurityEventHook インターフェース<a href="#securityeventhook-インターフェース" class="hash-link" aria-label="SecurityEventHook インターフェース への直接リンク" title="SecurityEventHook インターフェース への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/SecurityEventHook-b3c08fbcbed46611f595336ce6d3e879.java#L23" target="_blank">SecurityEventHook.java:23</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * セキュリティイベントフック（Plugin）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの23-41行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface SecurityEventHook {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ フックタイプ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecurityEventHookType type();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ 実行判定（defaultメソッド）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default boolean shouldExecute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEvent securityEvent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventHookConfiguration hookConfiguration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!hookConfiguration.hasEvents()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return hookConfiguration.containsTrigger(securityEvent.type().value());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ✅ フック実行（Tenant第一引数）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecurityEventHookResult execute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEvent securityEvent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventHookConfiguration configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="webhooksecurityeventexecutor---webhook実装">WebHookSecurityEventExecutor - Webhook実装<a href="#webhooksecurityeventexecutor---webhook実装" class="hash-link" aria-label="WebHookSecurityEventExecutor - Webhook実装 への直接リンク" title="WebHookSecurityEventExecutor - Webhook実装 への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/WebHookSecurityEventExecutor-b40ce2197091b846bde4c4042fd33830.java#L35" target="_blank">WebHookSecurityEventExecutor.java:35</a></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Webhook実装（RFC 8935準拠）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 確認方法: 実ファイルの35-80行目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc8935&quot;&gt;RFC 8935 - Push-Based SET Delivery&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WebHookSecurityEventExecutor implements SecurityEventHook {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpRequestExecutor httpRequestExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  JsonConverter jsonConverter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public SecurityEventHookType type() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardSecurityEventHookType.WEBHOOK.toHookType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public SecurityEventHookResult execute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEvent securityEvent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventHookConfiguration hookConfiguration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long startTime = System.currentTimeMillis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 1. 設定取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      WebHookConfiguration configuration =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          jsonConverter.read(hookConfiguration, WebHookConfiguration.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 2. イベントタイプ別の設定取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HttpRequestUrl httpRequestUrl = configuration.httpRequestUrl(securityEvent.type());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HttpMethod httpMethod = configuration.httpMethod(securityEvent.type());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HttpRequestStaticHeaders httpRequestStaticHeaders =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          configuration.httpRequestHeaders(securityEvent.type());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HttpRequestDynamicBodyKeys httpRequestDynamicBodyKeys =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          configuration.httpRequestDynamicBodyKeys(securityEvent.type());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HttpRequestStaticBody httpRequestStaticBody =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          configuration.httpRequestStaticBody(securityEvent.type());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 3. リクエストボディ生成（動的マッピング）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HttpRequestBodyCreator requestBodyCreator =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          new HttpRequestBodyCreator(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              new HttpRequestBaseParams(securityEvent.toMap()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              httpRequestDynamicBodyKeys,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              httpRequestStaticBody);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Map&lt;String, Object&gt; requestBody = requestBodyCreator.create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 4. HTTPリクエスト実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HttpRequest httpRequest = HttpRequest.newBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .uri(new URI(httpRequestUrl.value()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .method(httpMethod.value(), /* body */)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .headers(httpRequestStaticHeaders.toArray())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HttpRequestResult result = httpRequestExecutor.execute(httpRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      long executionDurationMs = System.currentTimeMillis() - startTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (result.isSuccess()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return SecurityEventHookResult.success(securityEvent, result, executionDurationMs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return SecurityEventHookResult.failure(securityEvent, result, executionDurationMs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      long executionDurationMs = System.currentTimeMillis() - startTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return SecurityEventHookResult.error(securityEvent, e, executionDurationMs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ <strong>Tenant第一引数</strong>: マルチテナント分離</li>
<li>✅ <strong>実行時間計測</strong>: <code>executionDurationMs</code>でパフォーマンス監視</li>
<li>✅ <strong>動的設定</strong>: イベントタイプ別にURL/メソッド/ヘッダー/ボディを設定可能</li>
<li>✅ <strong>例外ハンドリング</strong>: 成功/失敗/エラーを明確に区別</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="slacksecurityeventhookexecutor---slack実装">SlackSecurityEventHookExecutor - Slack実装<a href="#slacksecurityeventhookexecutor---slack実装" class="hash-link" aria-label="SlackSecurityEventHookExecutor - Slack実装 への直接リンク" title="SlackSecurityEventHookExecutor - Slack実装 への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <code>libs/idp-server-security-event-hooks/src/main/java/org/idp/server/security/event/hooks/slack/</code></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SlackSecurityEventHookExecutor implements SecurityEventHook {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpRequestExecutor httpRequestExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public SecurityEventHookType type() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return StandardSecurityEventHookType.SLACK.toHookType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public SecurityEventHookResult execute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tenant tenant,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEvent securityEvent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecurityEventHookConfiguration hookConfiguration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long startTime = System.currentTimeMillis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. Slack Webhook URL取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SlackSecurityEventHookConfiguration config =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jsonConverter.read(hookConfiguration, SlackSecurityEventHookConfiguration.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. Slackメッセージ構築</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String slackPayload = buildSlackMessage(securityEvent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. Webhook送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpRequest request = HttpRequest.newBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .uri(new URI(config.webhookUrl()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .POST(HttpRequest.BodyPublishers.ofString(slackPayload))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .header(&quot;Content-Type&quot;, &quot;application/json&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpRequestResult result = httpRequestExecutor.execute(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long executionDurationMs = System.currentTimeMillis() - startTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result.isSuccess()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ? SecurityEventHookResult.success(securityEvent, result, executionDurationMs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : SecurityEventHookResult.failure(securityEvent, result, executionDurationMs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private String buildSlackMessage(SecurityEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return String.format(&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;text&quot;: &quot;Security Event: %s&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;blocks&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;type&quot;: &quot;header&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;text&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;type&quot;: &quot;plain_text&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;text&quot;: &quot;🚨 Security Event&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;type&quot;: &quot;section&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;fields&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {&quot;type&quot;: &quot;mrkdwn&quot;, &quot;text&quot;: &quot;*Type:*\\n%s&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {&quot;type&quot;: &quot;mrkdwn&quot;, &quot;text&quot;: &quot;*User:*\\n%s&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {&quot;type&quot;: &quot;mrkdwn&quot;, &quot;text&quot;: &quot;*Time:*\\n%s&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event.type(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event.type().value(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event.userSub(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event.timestamp()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="retry-mechanism">Retry Mechanism<a href="#retry-mechanism" class="hash-link" aria-label="Retry Mechanism への直接リンク" title="Retry Mechanism への直接リンク">​</a></h4>
<p><strong>情報源</strong>: <a href="/idp-server/assets/files/HttpRequestExecutor-2369a374c8c65dbf2cf42ad1d276276f.java" target="_blank">HttpRequestExecutor.java</a>（platform層で提供）</p>
<p><strong>重要</strong>: 専用のRetryExecutorクラスは存在しない。<code>HttpRequestExecutor.executeWithRetry()</code>を使用。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * リトライ機構（Issue #398）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * platform層のHttpRequestExecutorが提供</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// SSF Hook内でHttpRequestExecutor.executeWithRetry()を使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SsfHookExecutor implements SecurityEventHook {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpRequestExecutor httpRequestExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private SecurityEventHookResult send(...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // HTTPリクエスト構築</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpRequest httpRequest = HttpRequest.newBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .uri(new URI(endpoint))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .header(&quot;Content-Type&quot;, &quot;application/secevent+jwt&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .POST(HttpRequest.BodyPublishers.ofString(securityEventToken.value()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ✅ リトライ設定（設定ファイルから取得）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpRetryConfiguration retryConfig = HttpRetryConfiguration.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .maxRetries(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .retryableStatusCodes(List.of(502, 503, 504))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .backoffDelays(List.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Duration.ofSeconds(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Duration.ofSeconds(2),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Duration.ofSeconds(4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .idempotencyRequired(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ✅ HttpRequestExecutor.executeWithRetry()でリトライ実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpRequestResult httpRequestResult =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (transmissionConfig.oauthAuthorization() != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ? httpRequestExecutor.executeWithRetry(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                httpRequest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                transmissionConfig.oauthAuthorization(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                retryConfig)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            : httpRequestExecutor.executeWithRetry(httpRequest, retryConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // レスポンスハンドリング</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long executionDurationMs = System.currentTimeMillis() - startTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return httpRequestResult.isSuccess()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ? SecurityEventHookResult.successWithContext(...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : SecurityEventHookResult.failureWithContext(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重要ポイント</strong>:</p>
<ul>
<li>✅ platform層の<code>HttpRequestExecutor</code>がリトライ機能を提供</li>
<li>✅ <code>HttpRetryConfiguration</code>でリトライ設定を定義</li>
<li>✅ Exponential Backoff自動実行</li>
<li>✅ Idempotency-Keyヘッダー自動付与（<code>idempotencyRequired: true</code>）</li>
<li>❌ 専用の<code>SecurityEventHookRetryExecutor</code>クラスは存在しない</li>
</ul>
<p><strong>情報源</strong>:</p>
<ul>
<li>Issue #398（Security Event Hook Retry Mechanism）</li>
<li>platform.md「HTTP クライアント - リトライ機能付き実行」</li>
<li><a href="/idp-server/assets/files/HttpRequestExecutor-2369a374c8c65dbf2cf42ad1d276276f.java" target="_blank">HttpRequestExecutor.java</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="通知イベント層を理解するための5つのポイント">通知・イベント層を理解するための5つのポイント<a href="#通知イベント層を理解するための5つのポイント" class="hash-link" aria-label="通知・イベント層を理解するための5つのポイント への直接リンク" title="通知・イベント層を理解するための5つのポイント への直接リンク">​</a></h3>
<ol>
<li><strong>多様な通知手段</strong>: FCM/APNS/Email をPlugin化</li>
<li><strong>SSF準拠</strong>: Shared Signals Frameworkによる標準イベント配信</li>
<li><strong>Push/Pull配信</strong>: Webhook配信とPolling配信の両対応</li>
<li><strong>リトライ機構</strong>: 失敗時の自動リトライ・Backoff</li>
<li><strong>外部サービス連携</strong>: Slack/Datadog等への通知</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="全モジュール完成">全モジュール完成！<a href="#全モジュール完成" class="hash-link" aria-label="全モジュール完成！ への直接リンク" title="全モジュール完成！ への直接リンク">​</a></h3>
<p>すべてのモジュールドキュメントが完成しました。</p>
<ul>
<li><a href="/idp-server/docs/content_10_ai_developer/ai-01-index">インデックスページに戻る</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ドキュメント修正履歴">ドキュメント修正履歴<a href="#ドキュメント修正履歴" class="hash-link" aria-label="ドキュメント修正履歴 への直接リンク" title="ドキュメント修正履歴 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2025-10-12-実装検証に基づく大規模修正">2025-10-12: 実装検証に基づく大規模修正<a href="#2025-10-12-実装検証に基づく大規模修正" class="hash-link" aria-label="2025-10-12: 実装検証に基づく大規模修正 への直接リンク" title="2025-10-12: 実装検証に基づく大規模修正 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正1-fcm-adapter実装パターン-33-113行目">修正1: FCM Adapter実装パターン (33-113行目)<a href="#修正1-fcm-adapter実装パターン-33-113行目" class="hash-link" aria-label="修正1: FCM Adapter実装パターン (33-113行目) への直接リンク" title="修正1: FCM Adapter実装パターン (33-113行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: 存在しないクラス名<code>FcmNotificationSender</code>を使用</p>
<p><strong>修正前</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class FcmNotificationSender {  // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FirebaseApp firebaseApp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void send(FcmNotificationRequest request) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>修正後</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class FcmNotifier implements AuthenticationDeviceNotifier {  // ✅ 実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;String, FirebaseMessaging&gt; cache = new ConcurrentHashMap&lt;&gt;();  // ✅ テナント別キャッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public NotificationResult notify(Tenant, AuthenticationDevice, ...) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>追加内容</strong>:</p>
<ul>
<li><code>AuthenticationDeviceNotifier</code>インターフェース実装</li>
<li>テナント 別FirebaseMessagingキャッシュ機構</li>
<li><code>NotificationTemplate</code>による設定駆動</li>
<li><code>NotificationResult</code>による結果管理</li>
</ul>
<p><strong>検証</strong>: <a href="/idp-server/assets/files/FcmNotifier-531966a25cca8b77325c86aedae3befc.java#L37-L108" target="_blank">FcmNotifier.java:37-108</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正2-apns-adapter実装パターン-131-205行目">修正2: APNS Adapter実装パターン (131-205行目)<a href="#修正2-apns-adapter実装パターン-131-205行目" class="hash-link" aria-label="修正2: APNS Adapter実装パターン (131-205行目) への直接リンク" title="修正2: APNS Adapter実装パターン (131-205行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: pushy/ApnsClient想定の想像実装</p>
<p><strong>修正前</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ApnsNotificationSender {  // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ApnsClient apnsClient;  // ❌ pushy依存想定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SimpleApnsPushNotification pushNotification = ...  // ❌ pushy API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>修正後</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ApnsNotifier implements AuthenticationDeviceNotifier {  // ✅ 実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpClient httpClient = HttpClient.newBuilder().version(HttpClient.Version.HTTP_2).build();  // ✅ Java標準</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Map&lt;String, JwtTokenCache&gt; jwtTokenCache = ...  // ✅ JWT認証キャッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>追加内容</strong>:</p>
<ul>
<li>Java標準HttpClient（HTTP/2）によるAPNs直接通信</li>
<li>JWT認証トークン生成・キャッシュ（1時間有効）</li>
<li>Production/Development環境切り替え</li>
</ul>
<p><strong>検証</strong>: <a href="/idp-server/assets/files/ApnsNotifier-3f2a890421f42bcd692af1b4996298f7.java#L42-L134" target="_blank">ApnsNotifier.java:42-134</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正3-email-aws-adapter実装パターン-224-302行目">修正3: Email AWS Adapter実装パターン (224-302行目)<a href="#修正3-email-aws-adapter実装パターン-224-302行目" class="hash-link" aria-label="修正3: Email AWS Adapter実装パターン (224-302行目) への直接リンク" title="修正3: Email AWS Adapter実装パターン (224-302行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: AWS SDK v1想定の古いAPI</p>
<p><strong>修正前</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class AwsSesEmailSender implements EmailSender {  // ❌ インターフェース不正確</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AmazonSimpleEmailService sesClient;  // ❌ AWS SDK v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void send(EmailRequest request) { ... }  // ❌ 戻り値なし</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>修正後</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class AwsEmailSender implements EmailSender {  // ✅ 実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EmailSendResult send(EmailSendingRequest, EmailSenderConfiguration) { ... }  // ✅ 正確なシグネチャ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SesClient sesClient = SesClient.builder()...  // ✅ AWS SDK v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>追加内容</strong>:</p>
<ul>
<li>AWS SDK v2使用（<code>software.amazon.awssdk</code>）</li>
<li><code>EmailSenderConfiguration</code>による設定駆動</li>
<li><code>EmailSendResult</code>による結果管理</li>
</ul>
<p><strong>検証</strong>: <a href="/idp-server/assets/files/AwsEmailSender-280e08ebe67200f8f66a6938b433a05d.java#L29-L82" target="_blank">AwsEmailSender.java:29-82</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正4-ssf-push-delivery実装-334-439行目">修正4: SSF Push Delivery実装 (334-439行目)<a href="#修正4-ssf-push-delivery実装-334-439行目" class="hash-link" aria-label="修正4: SSF Push Delivery実装 (334-439行目) への直接リンク" title="修正4: SSF Push Delivery実装 (334-439行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: 存在しないクラス<code>SsfPushDelivery</code>、<code>JwtCreator</code>を使用</p>
<p><strong>修正前</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SsfPushDelivery {  // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  JwtCreator jwtCreator = new JwtCreator();  // ❌ 存在しない（platform.mdで確認済み）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpRequest request = HttpRequest.builder()...  // ❌ 存在しないAPI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>修正後</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SsfHookExecutor implements SecurityEventHook {  // ✅ 実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SecurityEventTokenCreator tokenCreator = ...  // ✅ 実装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HttpRequest httpRequest = HttpRequest.newBuilder()...  // ✅ Java標準API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>追加内容</strong>:</p>
<ul>
<li><code>SecurityEventTokenCreator</code>によるSET生成</li>
<li>OAuth認証オプション対応</li>
<li>Java標準HttpRequest.newBuilder()</li>
</ul>
<p><strong>検証</strong>: <a href="/idp-server/assets/files/SsfHookExecutor-51d5336d11e4e24238156b880032ec40.java#L35-L176" target="_blank">SsfHookExecutor.java:35-176</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正5-retry-mechanism-652-717行目">修正5: Retry Mechanism (652-717行目)<a href="#修正5-retry-mechanism-652-717行目" class="hash-link" aria-label="修正5: Retry Mechanism (652-717行目) への直接リンク" title="修正5: Retry Mechanism (652-717行目) への直接リンク">​</a></h4>
<p><strong>問題</strong>: 存在しないクラス<code>SecurityEventHookRetryExecutor</code></p>
<p><strong>修正前</strong>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SecurityEventHookRetryExecutor {  // ❌ 存在しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public SecurityEventHookResult executeWithRetry(...) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>修正後</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">**重要**: 専用のRetryExecutorクラスは存在しない。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">platform層の`HttpRequestExecutor.executeWithRetry()`を使用。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>追加内容</strong>:</p>
<ul>
<li>platform層のHttpRequestExecutorがリトライ機能を提供することを明記</li>
<li><code>HttpRetryConfiguration</code>の使用方法</li>
<li>platform.mdへのクロスリファレンス</li>
</ul>
<p><strong>検証</strong>: platform.md「HTTP クライアント - リトライ機能付き実行」</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="修正6-ssf-pull-delivery削除">修正6: SSF Pull Delivery削除<a href="#修正6-ssf-pull-delivery削除" class="hash-link" aria-label="修正6: SSF Pull Delivery削除 への直接リンク" title="修正6: SSF Pull Delivery削除 への直接リンク">​</a></h4>
<p><strong>問題</strong>: 実装未確認のため、想像コードを削除</p>
<p><strong>削除内容</strong>: <code>SsfPullController</code>の実装例（実装が存在するか未確認）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="修正の原則">修正の原則<a href="#修正の原則" class="hash-link" aria-label="修正の原則 への直接リンク" title="修正の原則 への直接リンク">​</a></h3>
<p><strong>CLAUDE.md「想像ドキュメント作成防止」に基づく修正</strong>:</p>
<ol>
<li><strong>実装ファースト</strong>: 全てのクラス名・メソッド名を実装から確認</li>
<li><strong>クラス名の正確性</strong>: FcmNotifier, ApnsNotifier, AwsEmailSender（想像名を排除）</li>
<li><strong>インターフェースの正確性</strong>: AuthenticationDeviceNotifier, EmailSender</li>
<li><strong>API正確性</strong>: Java標準HttpRequest.newBuilder(), AWS SDK v2</li>
</ol>
<hr>
<p><strong>情報源</strong>:</p>
<ul>
<li><code>libs/idp-server-notification-*/</code>配下の実装コード</li>
<li><code>libs/idp-server-email-aws-adapter/</code>配下の実装コード</li>
<li><code>libs/idp-server-security-event-*/</code>配下の実装コード</li>
<li><a href="/idp-server/assets/files/FcmNotifier-531966a25cca8b77325c86aedae3befc.java" target="_blank">FcmNotifier.java</a></li>
<li><a href="/idp-server/assets/files/ApnsNotifier-3f2a890421f42bcd692af1b4996298f7.java" target="_blank">ApnsNotifier.java</a></li>
<li><a href="/idp-server/assets/files/AwsEmailSender-280e08ebe67200f8f66a6938b433a05d.java" target="_blank">AwsEmailSender.java</a></li>
<li><a href="/idp-server/assets/files/SsfHookExecutor-51d5336d11e4e24238156b880032ec40.java" target="_blank">SsfHookExecutor.java</a></li>
<li><a href="/idp-server/assets/files/WebHookSecurityEventExecutor-b40ce2197091b846bde4c4042fd33830.java" target="_blank">WebHookSecurityEventExecutor.java</a></li>
<li>platform.md「HTTP クライアント - リトライ機能付き実行」</li>
<li>Issue #398（Security Event Hook Retry Mechanism）</li>
<li><a href="https://openid.net/specs/openid-sse-framework-1_0.html" target="_blank" rel="noopener noreferrer">Shared Signals Framework</a></li>
</ul>
<p><strong>最終更新</strong>: 2025-10-12
<strong>レビュー実施</strong>: 2025-10-12 - AI開発者向けドキュメント品質改善プロジェクト</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_10_ai_developer/ai-50-notification-security-event.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_10_ai_developer/ai-43-federation-oidc"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">idp-server-federation-oidc</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_10_ai_developer/ai-51-notification-fcm"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">idp-server-notification-fcm-adapter</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概要" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#  通知モジュール" class="table-of-contents__link toc-highlight">通知モジュール</a><ul><li><a href="#idp-server-notification-fcm-adapter" class="table-of-contents__link toc-highlight">idp-server-notification-fcm-adapter</a></li><li><a href="#idp-server-notification-apns-adapter" class="table-of-contents__link toc-highlight">idp-server-notification-apns-adapter</a></li><li><a href="#idp-server-email-aws-adapter" class="table-of-contents__link toc-highlight">idp-server-email-aws-adapter</a></li></ul></li><li><a href="#セキュリティイベントモジュール" class="table-of-contents__link toc-highlight">セキュリティイベントモジュール</a><ul><li><a href="#idp-server-security-event-framework" class="table-of-contents__link toc-highlight">idp-server-security-event-framework</a></li><li><a href="#idp-server-security-event-hooks" class="table-of-contents__link toc-highlight">idp-server-security-event-hooks</a></li></ul></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a><ul><li><a href="#通知イベント層を理解するための5つのポイント" class="table-of-contents__link toc-highlight">通知・イベント層を理解するための5つのポイント</a></li><li><a href="#全モジュール完成" class="table-of-contents__link toc-highlight">全モジュール完成！</a></li></ul></li><li><a href="#ドキュメント修正履歴" class="table-of-contents__link toc-highlight">ドキュメント修正履歴</a><ul><li><a href="#2025-10-12-実装検証に基づく大規模修正" class="table-of-contents__link toc-highlight">2025-10-12: 実装検証に基づく大規模修正</a></li><li><a href="#修正の原則" class="table-of-contents__link toc-highlight">修正の原則</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>