<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_03_concepts/basic/basic-17-fido2-passkey-discoverable-credential" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">FIDO2・パスキー・Discoverable Credentialの基本 | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_03_concepts/basic/basic-17-fido2-passkey-discoverable-credential"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="FIDO2・パスキー・Discoverable Credentialの基本 | IdP-Server Documentation"><meta data-rh="true" name="description" content="---"><meta data-rh="true" property="og:description" content="---"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_03_concepts/basic/basic-17-fido2-passkey-discoverable-credential"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_03_concepts/basic/basic-17-fido2-passkey-discoverable-credential" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_03_concepts/basic/basic-17-fido2-passkey-discoverable-credential" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.68459e96.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.cd2e71d7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">📚 ドキュメント索引</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_03_concepts/concept-01-multi-tenant">コア概念</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-01-multi-tenant">マルチテナント</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-02-id-management">ID（ユーザー）管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-03-id-verified">身元確認済みID</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-04-enterprise-id">エンタープライズID</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-05-authentication-policy">認証ポリシー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-06-token-management">トークン管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-07-session-management">セッション管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-08-mfa">多要素認証（MFA）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-09-custom-claims">カスタムクレーム・スコープ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-10-control-plane">コントロールプレーン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-11-security-events">セキュリティイベント・フック</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-12-authorization">認可</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-13-audit-compliance">監査ログ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-14-grant-management">認可許諾管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-15-operations">運用・保守</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-16-external-service-integration">外部サービス連携</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-17-application-logging">アプリケーションログ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-18-id-token">IDトークン（ID Token）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-19-client">クライアント（Client）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-20-password-policy">パスワードポリシー</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/concept-21-schema-validation">スキーマバリデーション（JSON Schema）</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-01-identity-management-basics">基礎（読み物）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-01-identity-management-basics">アイデンティティ管理の基礎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-02-identity-management-examples">身近な実例で学ぶID管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-03-identity-trends">eKYC・FIDO・多要素認証の最新トレンド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-04-modern-web-authz-authn">現代Webに求められる認証・認可</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-05-oauth-oidc-why-needed">なぜOAuth 2.0 / OpenID Connectが必要か</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-06-oauth2-authorization">OAuth 2.0の「認可」の仕組み</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-07-oauth2-roles">OAuth 2.0の詳細</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-08-oauth2-authorization-code-flow">基本フロー：Authorization Code Flow（認可コードグラント）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-09-oauth2-other-flows">その他のOAuth 2.0フロータイプ（PKCE, Client Credentials, Implicit など）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-10-oauth2-token-types">OAuth 2.0のトークンの種類と用途</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-11-oauth-oidc-basics">OAuth 2.0 / OpenID Connectの基礎知識</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-12-openid-connect-detail">OpenID Connectの詳細</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-13-id-token-jwt">IDトークンとJWT（JSON Web Token）について</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-14-oidc-claim-design">OIDCユーザー属性（クレーム）設計</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-15-oidc-discovery-dynamic-registration-standard">OIDC Discovery &amp; Dynamic Registration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-16-fido2-webauthn-passwordless">FIDO2・WebAuthn パスワードレス認証</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-17-fido2-passkey-discoverable-credential">FIDO2・パスキー・Discoverable Credentialの基本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-18-fido2-architecture-rp-browser-authenticator">FIDO2アーキテクチャ - RP・Webブラウザー・認証器の関係</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-19-fido2-registration-flow-interface">FIDO2 登録フローとインターフェース詳細</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-20-fido2-authentication-flow-interface">FIDO2 認証フローとインターフェース詳細</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_03_concepts/basic/basic-21-fido2-webauthn-level-specification-evolution">FIDO2・WebAuthn仕様の変遷（Level 1 → 2 → 3）</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/index">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/getting-started/service-overview">Developer Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">コア概念</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">基礎（読み物）</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">FIDO2・パスキー・Discoverable Credentialの基本</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>FIDO2・パスキー・Discoverable Credentialの基本</h1></header>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="概要">概要<a href="#概要" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h2>
<p>FIDO2におけるパスキーとDiscoverable Credentialは、しばしば混同されがちですが、技術的には異なる概念です。</p>
<p>このドキュメントでは、<strong>パスキーとDiscoverable Credentialの正確な定義</strong>、<strong>認証フローの違い</strong>、<strong>実装時のパラメータ選択</strong>について詳細に解説します。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fido2とは">FIDO2とは<a href="#fido2とは" class="hash-link" aria-label="FIDO2とは への直接リンク" title="FIDO2とは への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fido2の構成要素">FIDO2の構成要素<a href="#fido2の構成要素" class="hash-link" aria-label="FIDO2の構成要素 への直接リンク" title="FIDO2の構成要素 への直接リンク">​</a></h3>
<p>FIDO2は以下の2つの標準で構成されています：</p>
<ul>
<li><strong>WebAuthn (Web Authentication API)</strong>: Webブラウザ向けのAPI仕様</li>
<li><strong>CTAP (Client to Authenticator Protocol)</strong>: 認証器とクライアント間の通信プロトコル</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="パスワードレス認証の実現">パスワードレス認証の実現<a href="#パスワードレス認証の実現" class="hash-link" aria-label="パスワードレス認証の実現 への直接リンク" title="パスワードレス認証の実現 への直接リンク">​</a></h3>
<p>FIDO2により、従来のパスワード認証を以下の方式で置き換えることができます：</p>
<ul>
<li><strong>公開鍵暗号方式</strong>: サーバーに秘密情報を保存しない</li>
<li><strong>生体認証</strong>: 指紋認証、顔認証、PIN等による本人確認</li>
<li><strong>フィッシング耐性</strong>: Origin Bindingによる偽サイト対策</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="パスキーとは">パスキーとは<a href="#パスキーとは" class="hash-link" aria-label="パスキーとは への直接リンク" title="パスキーとは への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="技術的定義">技術的 定義<a href="#技術的定義" class="hash-link" aria-label="技術的定義 への直接リンク" title="技術的定義 への直接リンク">​</a></h3>
<p>パスキーは、<strong>FIDO2/WebAuthn技術を使用した認証資格情報の総称</strong>です。</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="パスキーの共通特徴">パスキーの共通特徴<a href="#パスキーの共通特徴" class="hash-link" aria-label="パスキーの共通特徴 への直接リンク" title="パスキーの共通特徴 への直接リンク">​</a></h3>
<ul>
<li><strong>公開鍵暗号方式</strong>: サイトごとに異なるキーペアを生成</li>
<li><strong>フィッシング耐性</strong>: 登録したOriginでのみ動作</li>
<li><strong>生体認証対応</strong>: Touch ID、Face ID、Windows Hello等</li>
<li><strong>デバイス間同期</strong>: プラットフォーム提供者による同期機能（Apple ID、Googleアカウント等）</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="discoverable-credentialとは">Discoverable Credentialとは<a href="#discoverable-credentialとは" class="hash-link" aria-label="Discoverable Credentialとは への直接リンク" title="Discoverable Credentialとは への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="技術的定義-1">技術的定義<a href="#技術的定義-1" class="hash-link" aria-label="技術的定義 への直接リンク" title="技術的定義 への直接リンク">​</a></h3>
<p>Discoverable Credential（<strong>Resident Key</strong>とも呼ばれる）は、<strong>認証器内にユーザー情報も含めて保存される特別なパスキー</strong>です。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主な特徴">主な特徴<a href="#主な特徴" class="hash-link" aria-label="主な特徴 への直接リンク" title="主な特徴 への直接リンク">​</a></h3>
<ul>
<li><strong>認証器内保存</strong>: ユーザーID、表示名、アカウント情報を認証器に保存</li>
<li><strong>ユーザーID入力不要</strong>: 生体認証のみでログイン可能</li>
<li><strong>アカウント選択</strong>: 複数アカウントがある場合はユーザーが選択</li>
<li><strong>容量制限</strong>: 認証器の保存容量に制限あり</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="webauthn仕様におけるパラメータ">WebAuthn仕様におけるパラメータ<a href="#webauthn仕様におけるパラメータ" class="hash-link" aria-label="WebAuthn仕様におけるパラメータ への直接リンク" title="WebAuthn仕様におけるパラメータ への直接リンク">​</a></h3>
<p>WebAuthn仕様では、Discoverable Credentialの制御に以下のパラメータが定義されています：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="標準仕様webauthn-level-2以降">標準仕様（WebAuthn Level 2以降）<a href="#標準仕様webauthn-level-2以降" class="hash-link" aria-label="標準仕様（WebAuthn Level 2以降） への直接リンク" title="標準仕様（WebAuthn Level 2以降） への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 標準的なresidentKeyパラメータ（WebAuthn Level 2以降）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> publicKeyCredentialCreationOptions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">authenticatorSelection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">residentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 標準パラメータ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="residentkeyパラメータの値webauthn標準"><code>residentKey</code>パラメータの値（WebAuthn標準）<a href="#residentkeyパラメータの値webauthn標準" class="hash-link" aria-label="residentkeyパラメータの値webauthn標準 への直接リンク" title="residentkeyパラメータの値webauthn標準 への直接リンク">​</a></h4>
<table><thead><tr><th>値</th><th>意味</th><th>動作</th></tr></thead><tbody><tr><td><code>&quot;required&quot;</code></td><td>Discoverable Credential必須</td><td>作成できない場合は<code>NotAllowedError</code>で失敗</td></tr><tr><td><code>&quot;preferred&quot;</code></td><td>Discoverable Credential強く推奨</td><td>可能ならDiscoverable、不可能ならNon-Discoverable作成</td></tr><tr><td><code>&quot;discouraged&quot;</code></td><td>Non-Discoverable推奨</td><td>可能ならNon-Discoverable、Discoverableも許容</td></tr></tbody></table>
<p><strong>注意</strong>: <code>&quot;discouraged&quot;</code>でもDiscoverable Credentialが作成される可能性があります（認証器の実装依存）。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="レガシーパラメータwebauthn-level-1">レガシーパラメータ（WebAuthn Level 1）<a href="#レガシーパラメータwebauthn-level-1" class="hash-link" aria-label="レガシーパラメータ（WebAuthn Level 1） への直接リンク" title="レガシーパラメータ（WebAuthn Level 1） への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 後方互換性のためのレガシーパラメータ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> publicKeyCredentialCreationOptions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">authenticatorSelection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">requireResidentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// レガシーパラメータ（boolean型）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="通常のパスキーとdiscoverable-credentialの違い">通常のパスキーとDiscoverable Credentialの違い<a href="#通常のパスキーとdiscoverable-credentialの違い" class="hash-link" aria-label="通常のパスキーとDiscoverable Credentialの違い への直接リンク" title="通常のパスキーとDiscoverable Credentialの違い への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="認証フロー比較">認証フロー比較<a href="#認証フロー比較" class="hash-link" aria-label="認証フロー比較 への直接リンク" title="認証フロー比較 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="サイドバイサイド比較">サイドバイサイド比較<a href="#サイドバイサイド比較" class="hash-link" aria-label="サイドバイサイド比較 への直接リンク" title="サイドバイサイド比較 への直接リンク">​</a></h4>
<!-- -->
<p><strong>注意</strong>:</p>
<ul>
<li><strong>Conditional UI</strong>: 最新の推奨方式（idp-server実装済み）</li>
<li><strong>Modal</strong>: 従来型、複数アカウント時に選択UI表示</li>
<li><strong>アカウント選択</strong>: 単一アカウントの場合はスキップ</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="詳細シーケンス図">詳細シーケンス図<a href="#詳細シーケンス図" class="hash-link" aria-label="詳細シーケンス図 への直接リンク" title="詳細シーケンス図 への直接リンク">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="通常のパスキーnon-discoverable-credential">通常のパスキー（Non-Discoverable Credential）<a href="#通常のパスキーnon-discoverable-credential" class="hash-link" aria-label="通常のパスキー（Non-Discoverable Credential） への直接リンク" title="通常のパスキー（Non-Discoverable Credential） への直接リンク">​</a></h5>
<!-- -->
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="discoverable-credentialconditional-ui-モード">Discoverable Credential（Conditional UI モード）<a href="#discoverable-credentialconditional-ui-モード" class="hash-link" aria-label="Discoverable Credential（Conditional UI モード） への直接リンク" title="Discoverable Credential（Conditional UI モード） への直接リンク">​</a></h5>
<!-- -->
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="discoverable-credentialmodal-モード">Discoverable Credential（Modal モード）<a href="#discoverable-credentialmodal-モード" class="hash-link" aria-label="Discoverable Credential（Modal モード） への直接リンク" title="Discoverable Credential（Modal モード） への直接リンク">​</a></h5>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ユースケース比較表">ユースケース比較表<a href="#ユースケース比較表" class="hash-link" aria-label="ユースケース比較表 への直接リンク" title="ユースケース比較表 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="non-discoverable-vs-discoverable">Non-Discoverable vs Discoverable<a href="#non-discoverable-vs-discoverable" class="hash-link" aria-label="Non-Discoverable vs Discoverable への直接リンク" title="Non-Discoverable vs Discoverable への直接リンク">​</a></h4>
<table><thead><tr><th>特徴</th><th>通常のパスキー<br>(Non-Discoverable)</th><th>Discoverable Credential</th></tr></thead><tbody><tr><td><strong>ユーザーID入力</strong></td><td>必要</td><td>不要（Conditional UI）<br>または最小限（Modal）</td></tr><tr><td><strong>UX</strong></td><td>ユーザーID + 生体認証</td><td>生体認証のみ</td></tr><tr><td><strong>認証器の容量</strong></td><td>影響なし</td><td>保存数に制限あり</td></tr><tr><td><strong>適用シーン</strong></td><td>2要素認証の2要素目</td><td>パスワードレスログイン</td></tr><tr><td><strong>実装複雑度</strong></td><td>標準的</td><td>やや複雑（アカウント管理）</td></tr><tr><td><strong>セキュリティ</strong></td><td>高い</td><td>高い</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="conditional-ui-vs-modal両方discoverable-credential">Conditional UI vs Modal（両方Discoverable Credential）<a href="#conditional-ui-vs-modal両方discoverable-credential" class="hash-link" aria-label="Conditional UI vs Modal（両方Discoverable Credential） への直接リンク" title="Conditional UI vs Modal（両方Discoverable Credential） への直接リンク">​</a></h4>
<table><thead><tr><th>特徴</th><th>Conditional UI</th><th>Modal</th></tr></thead><tbody><tr><td><strong>起動方法</strong></td><td>入力フィールドクリック</td><td>ログインボタンクリック</td></tr><tr><td><strong>UI表示</strong></td><td>オートフィルドロップダウン</td><td>モーダルダイアログ</td></tr><tr><td><strong>ユーザー体験</strong></td><td>非常にスムーズ</td><td>やや侵入的</td></tr><tr><td><strong>ブラウザ対応</strong></td><td>Chrome 108+, Safari 16+</td><td>全対応ブラウザ</td></tr><tr><td><strong>実装</strong></td><td><code>mediation: &#x27;conditional&#x27;</code></td><td><code>mediation: &#x27;optional&#x27;</code></td></tr><tr><td><strong>推奨度</strong></td><td>⭐⭐⭐⭐⭐ 最新推奨</td><td>⭐⭐⭐ 従来型</td></tr><tr><td><strong>idp-server</strong></td><td>✅ 実装済み</td><td>✅ 対応可能</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conditional-uiオートフィルの標準化状況">Conditional UI（オートフィル）の標準化状況<a href="#conditional-uiオートフィルの標準化状況" class="hash-link" aria-label="Conditional UI（オートフィル）の標準化状況 への直接リンク" title="Conditional UI（オートフィル）の標準化状況 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="w3c公式仕様">W3C公式仕様<a href="#w3c公式仕様" class="hash-link" aria-label="W3C公式仕様 への直接リンク" title="W3C公式仕様 への直接リンク">​</a></h4>
<p>Conditional UIは<strong>WebAuthn Level 3</strong>の公式仕様に含まれています：</p>
<ul>
<li><strong>公式仕様</strong>: <a href="https://www.w3.org/TR/webauthn-3/" target="_blank" rel="noopener noreferrer">W3C WebAuthn Level 3</a></li>
<li><strong>Explainer</strong>: <a href="https://github.com/w3c/webauthn/wiki/Explainer:-WebAuthn-Conditional-UI" target="_blank" rel="noopener noreferrer">W3C WebAuthn Conditional UI Explainer</a></li>
<li><strong>Status</strong>: W3C Working Draft（現行標準）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="公式定義">公式定義<a href="#公式定義" class="hash-link" aria-label="公式定義 への直接リンク" title="公式定義 への直接リンク">​</a></h4>
<blockquote>
<p>&quot;A new mode for WebAuthn that displays a credential selection UI only if the user has a discoverable credential registered with the Relying Party on their authenticator, with the credential displayed alongside autofilled passwords.&quot;</p>
<p>— W3C WebAuthn Conditional UI Explainer</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="公式用語">公式用語<a href="#公式用語" class="hash-link" aria-label="公式用語 への直接リンク" title="公式用語 への直接リンク">​</a></h4>
<p>以下の用語はすべてW3C/標準仕様で使用されています：</p>
<table><thead><tr><th>用語</th><th>使用箇所</th><th>意味</th></tr></thead><tbody><tr><td><strong>Conditional UI</strong></td><td>W3C仕様</td><td>公式機能名称</td></tr><tr><td><strong>Conditional Mediation</strong></td><td>API仕様</td><td><code>mediation: &#x27;conditional&#x27;</code> パラメータ</td></tr><tr><td><strong>Autofill</strong></td><td>ユーザー向け説明</td><td>オートフィル統合の表現</td></tr><tr><td><strong>Passkey Autofill</strong></td><td>マーケティング</td><td>一般向け説明</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ブラウザサポート状況">ブラウザサポート状況<a href="#ブラウザサポート状況" class="hash-link" aria-label="ブラウザサポート状況 への直接リンク" title="ブラウザサポート状況 への直接リンク">​</a></h4>
<table><thead><tr><th>ブラウザ</th><th>サポート開始</th><th>状況</th><th>備考</th></tr></thead><tbody><tr><td><strong>Chrome</strong></td><td>108+ (2022年10月)</td><td>✅ フルサポート</td><td><a href="https://developer.chrome.com/docs/identity/webauthn-conditional-ui" target="_blank" rel="noopener noreferrer">公式ガイド</a></td></tr><tr><td><strong>Safari</strong></td><td>16+ (2022年9月)</td><td>✅ フルサポート</td><td>iOS/macOS両対応</td></tr><tr><td><strong>Edge</strong></td><td>Chromiumベース</td><td>✅ フルサポート</td><td>Chrome同等</td></tr><tr><td><strong>Firefox</strong></td><td>-</td><td>❌ 未サポート</td><td>2024年時点</td></tr></tbody></table>
<p><strong>MDN Baseline</strong>: 2023年10月から「<a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential/isConditionalMediationAvailable_static" target="_blank" rel="noopener noreferrer">Baseline 2023</a>」認定（主要ブラウザで利用可能）</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="実装リファレンス">実装リファレンス<a href="#実装リファレンス" class="hash-link" aria-label="実装リファレンス への直接リンク" title="実装リファレンス への直接リンク">​</a></h4>
<ul>
<li><strong>MDN</strong>: <a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential/isConditionalMediationAvailable_static" target="_blank" rel="noopener noreferrer">PublicKeyCredential.isConditionalMediationAvailable()</a></li>
<li><strong>Chrome</strong>: <a href="https://developer.chrome.com/docs/identity/webauthn-conditional-ui" target="_blank" rel="noopener noreferrer">Passwordless sign-in with WebAuthn passkey autofill</a></li>
<li><strong>Yubico</strong>: <a href="https://developers.yubico.com/WebAuthn/Concepts/Passkey_Autofill/" target="_blank" rel="noopener noreferrer">Passkey Autofill Implementation Guidance</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="discoverable-credentialとconditional-uiの関係">Discoverable CredentialとConditional UIの関係<a href="#discoverable-credentialとconditional-uiの関係" class="hash-link" aria-label="Discoverable CredentialとConditional UIの関係 への直接リンク" title="Discoverable CredentialとConditional UIの関係 への直接  リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重要な概念の違い">重要な概念の違い<a href="#重要な概念の違い" class="hash-link" aria-label="重要な概念の違い への直接リンク" title="重要な概念の違い への直接リンク">​</a></h3>
<p>この2つは<strong>異なる概念</strong>であり、混同しやすいため明確に区別する必要があります：</p>
<table><thead><tr><th>概念</th><th>分類</th><th>決定タイミング</th><th>制御パラメータ</th><th>説明</th></tr></thead><tbody><tr><td><strong>Discoverable Credential</strong></td><td>保存形式</td><td><strong>登録時</strong></td><td><code>residentKey: &quot;required&quot;</code></td><td>認証器に何を保存するか</td></tr><tr><td><strong>Conditional UI</strong></td><td>使用方法</td><td><strong>認証時</strong></td><td><code>mediation: &#x27;conditional&#x27;</code></td><td>どうやってパスキーを選択するか</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-discoverable-credential--パスキーの保存形式">1. Discoverable Credential = パスキーの「保存形式」<a href="#1-discoverable-credential--パスキーの保存形式" class="hash-link" aria-label="1. Discoverable Credential = パスキーの「保存形式」 への直接リンク" title="1. Discoverable Credential = パスキーの「保存形式」 への直接リンク">​</a></h3>
<p>認証器（Touch ID等）に<strong>何を保存するか</strong>の違い：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="discoverable-credential登録時">Discoverable Credential（登録時）<a href="#discoverable-credential登録時" class="hash-link" aria-label="Discoverable Credential（登録時） への直接リンク" title="Discoverable Credential（登録時） への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 登録時の設定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">authenticatorSelection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">residentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Discoverable作成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ✅ 認証器内に保存される情報</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// - 秘密鍵（Private Key）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// - ユーザーID（user.id）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// - 表示名（user.displayName）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// - RP ID（example.com）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="non-discoverable-credential登録時">Non-Discoverable Credential（登録時）<a href="#non-discoverable-credential登録時" class="hash-link" aria-label="Non-Discoverable Credential（登録時） への直接リンク" title="Non-Discoverable Credential（登録時） への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 登録時の設定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">authenticatorSelection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">residentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;discouraged&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// Non-Discoverable作成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ⚠️ 認証器内に保存される情報</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// - 秘密鍵（Private Key）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// - RP ID（example.com）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ❌ ユーザーID（保存されない）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ❌ 表示名（保存されない）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-conditional-ui--パスキーの使用方法">2. Conditional UI = パスキーの「使用方法」<a href="#2-conditional-ui--パスキーの使用方法" class="hash-link" aria-label="2. Conditional UI = パスキーの「使用方法」 への直接リンク" title="2. Conditional UI = パスキーの「使用方法」 への直接リンク">​</a></h3>
<p>認証時に<strong>どうやってパスキーを選択するか</strong>の違い：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="conditional-ui認証時">Conditional UI（認証時）<a href="#conditional-ui認証時" class="hash-link" aria-label="Conditional UI（認証時） への直接リンク" title="Conditional UI（認証時） への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 認証時の設定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">credentials</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">publicKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">challenge</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">allowCredentials</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 空 = Discoverable検索</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">mediation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;conditional&#x27;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// オートフィルで表示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ✅ ユーザー体験</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 1. 入力フィールドをクリック</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 2. オートフィルドロップダウンでパスキー表示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 3. パスキー選択</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 4. 生体認証</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="modal-ui認証時">Modal UI（認証時）<a href="#modal-ui認証時" class="hash-link" aria-label="Modal UI（認証時） への直接リンク" title="Modal UI（認証時） への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 認証時の設定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">credentials</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">publicKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">challenge</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">allowCredentials</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 空 = Discoverable検索</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">mediation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;optional&#x27;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// モーダルで表示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ✅ ユーザー体験</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 1. ログインボタンをクリック</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 2. モーダルダイアログでパスキー表示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 3. パスキー選択</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 4. 生体認証</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-関係性の図解">3. 関係性の図解<a href="#3-関係性の図解" class="hash-link" aria-label="3. 関係性の図解 への直接リンク" title="3. 関係性の図解 への直接リンク">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-組み合わせ可否表">4. 組み合わせ  可否表<a href="#4-組み合わせ可否表" class="hash-link" aria-label="4. 組み合わせ可否表 への直接リンク" title="4. 組み合わせ可否表 への直接リンク">​</a></h3>
<table><thead><tr><th>登録時（保存形式）</th><th>認証時（使用方法）</th><th>組み合わせ</th><th>説明</th></tr></thead><tbody><tr><td><strong>Discoverable</strong></td><td>Conditional UI</td><td>✅ <strong>推奨</strong></td><td>最新のベストプラクティス（idp-server実装）</td></tr><tr><td><strong>Discoverable</strong></td><td>Modal UI</td><td>✅ 可能</td><td>従来型の方式</td></tr><tr><td><strong>Discoverable</strong></td><td>ユーザーID入力</td><td>✅ 可能</td><td>Discoverableでも可能だが非推奨</td></tr><tr><td><strong>Non-Discoverable</strong></td><td>Conditional UI</td><td>❌ <strong>不可</strong></td><td>ユーザー情報がないためオートフィル不可</td></tr><tr><td><strong>Non-Discoverable</strong></td><td>Modal UI</td><td>❌ <strong>不可</strong></td><td>ユーザー情報がないため選択UI不可</td></tr><tr><td><strong>Non-Discoverable</strong></td><td>ユーザーID入力</td><td>✅ 唯一の方法</td><td>2要素認証の2要素目向け</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-なぜconditional-uiにはdiscoverable-credentialが必須なのか">5. なぜConditional UIにはDiscoverable Credentialが必須なのか？<a href="#5-なぜconditional-uiにはdiscoverable-credentialが必須なのか" class="hash-link" aria-label="5. なぜConditional UIにはDiscoverable Credentialが必須なのか？ への直接リンク" title="5. なぜConditional UIにはDiscoverable Credentialが必須なのか？ への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="理由オートフィルには表示する情報が必要">理由：オートフィルには「表示する情報」が必要<a href="#理由オートフィルには表示する情報が必要" class="hash-link" aria-label="理由：オートフィルには「表示する情報」が必要 への直接リンク" title="理由：オートフィルには「表示する情報」が必要 への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ❌ Non-Discoverable + Conditional UIは不可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 問題：認証器に表示名がないため、オートフィルに何を表示すればいいか分からない</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">credentials</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">publicKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    challenge</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">allowCredentials</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 空 = 認証器内を検索</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">mediation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;conditional&#x27;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ← 何を表示する？情報がない！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ✅ Discoverable + Conditional UIは可能</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 認証器に保存されたユーザー情報をオートフィルで表示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">【認証器内の情報】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> displayName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;伊藤一朗&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;itou@example.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">【オートフィルに表示される内容】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">🔐 </span><span class="token function" style="color:#d73a49">伊藤一朗</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">itou@example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └ </span><span class="token maybe-class-name">Touch</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ID</span><span class="token plain">で認証</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-実際のフロー例idp-server実装">6. 実際のフロー例（idp-server実装）<a href="#6-実際のフロー例idp-server実装" class="hash-link" aria-label="6. 実際のフロー例（idp-server実装） への直接リンク" title="6. 実際のフロー例（idp-server実装） への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="登録フローdiscoverable-credential作成">登録フロー（Discoverable Credential作成）<a href="#登録フローdiscoverable-credential作成" class="hash-link" aria-label="登録フロー（Discoverable Credential作成） への直接リンク" title="登録フロー（Discoverable Credential作成） への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// app-view/src/pages/signup/fido2/index.tsx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> publicKeyOptions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">challenge</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">base64UrlToBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">challenge</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">rp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;IdP Server&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">base64UrlToBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ← 認証器に保存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">displayName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ユーザー名&quot;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">// ← 認証器に保存（オートフィルで表示される）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">authenticatorSelection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">authenticatorAttachment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;platform&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">requireResidentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ← Discoverable作成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">pubKeyCredParams</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;public-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">alg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// ES256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;public-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">alg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">257</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// RS256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> credential </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">credentials</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">publicKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> publicKeyOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="認証フローconditional-ui使用">認証フロー（Conditional UI使用）<a href="#認証フローconditional-ui使用" class="hash-link" aria-label="認証フロー（Conditional UI使用） への直接リンク" title="認証フロー（Conditional UI使用） への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// app-view/src/pages/signin/fido2/index.tsx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ページロード時にConditional UI起動</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">session_enabled</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">authChallenge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// isConditional = true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">authChallenge</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">isConditional</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// チャレンジ取得</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">backendUrl</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/.../fido2-authentication-challenge</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;POST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> challengeResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> publicKeyOptions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">challenge</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">base64UrlToBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">challengeResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">challenge</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">timeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// allowCredentialsを空にする = Discoverable検索</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Conditional UI起動</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> credential </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">credentials</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">publicKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> publicKeyOptions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">mediation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;conditional&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ← オートフィル起動</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 入力フィールドにautocomplete属性を追加 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;TextField</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fullWidth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label=&quot;Username or Email&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value={username}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  onChange={(e) =&gt; setUsername(e.target.value)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  autoComplete=&quot;username webauthn&quot;  </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- ← 重要！ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inputProps={{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    autoComplete: &quot;username webauthn&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-まとめ">7. まとめ<a href="#7-まとめ" class="hash-link" aria-label="7. まとめ への直接リンク" title="7. まとめ への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="重要ポイント">重要ポイント<a href="#重要ポイント" class="hash-link" aria-label="重要ポイント への直接リンク" title="重要ポイント への直接リンク">​</a></h4>
<ol>
<li>
<p><strong>Discoverable Credential = 登録時の保存形式</strong></p>
<ul>
<li><code>residentKey: &quot;required&quot;</code> で作成</li>
<li>ユーザー情報を認証器に保存</li>
<li>認証時にユーザーID入力が不要になる</li>
</ul>
</li>
<li>
<p><strong>Conditional UI = 認証時の使用方法</strong></p>
<ul>
<li><code>mediation: &#x27;conditional&#x27;</code> で起動</li>
<li>オートフィルでパスキーを表示</li>
<li>最新のベストプラクティス</li>
</ul>
</li>
<li>
<p><strong>関係性</strong></p>
<ul>
<li>Conditional UIを使うには<strong>Discoverableが必須</strong></li>
<li>Discoverableを使うのに<strong>Conditional UIは必須ではない</strong>（Modalでも可）</li>
<li><strong>推奨組み合わせ</strong>: Discoverable + Conditional UI ← idp-server実装済み</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="実装チェックリスト">実装チェックリスト<a href="#実装チェックリスト" class="hash-link" aria-label="実装チェックリスト への直接リンク" title="実装チェックリスト への直接リンク">​</a></h4>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->登録時: <code>requireResidentKey: true</code> または <code>residentKey: &quot;required&quot;</code> を設定</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->登録時: <code>user.displayName</code> に適切な表示名を設定</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->認証時: <code>mediation: &#x27;conditional&#x27;</code> を指定</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->認証時: <code>allowCredentials</code> を空にする（または省略）</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->HTML: 入力フィールドに <code>autoComplete=&quot;username webauthn&quot;</code> を追加</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->機能検出: <code>PublicKeyCredential.isConditionalMediationAvailable()</code> で確認</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="実装における注意点">実装における注意点<a href="#実装における注意点" class="hash-link" aria-label="実装における注意点 への直接リンク" title="実装における注意点 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-requireresidentkeyとresidentkeyの関係">1. <code>requireResidentKey</code>と<code>residentKey</code>の関係<a href="#1-requireresidentkeyとresidentkeyの関係" class="hash-link" aria-label="1-requireresidentkeyとresidentkeyの関係 への直接リンク" title="1-requireresidentkeyとresidentkeyの関係 への直接リンク">​</a></h3>
<p>WebAuthn仕様における新旧パラメータの関係：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="webauthn標準における推奨パラメータ">WebAuthn標準における推奨パラメータ<a href="#webauthn標準における推奨パラメータ" class="hash-link" aria-label="WebAuthn標準における推奨パラメータ への直接リンク" title="WebAuthn標準における推奨パラメータ への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ✅ WebAuthn Level 2以降の標準パラメータ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">authenticatorSelection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">residentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="実装における現実的な選択">実装における現実的な選択<a href="#実装における現実的な選択" class="hash-link" aria-label="実装における現実的な選択 への直接リンク" title="実装における現実的な選択 への直接リンク">​</a></h4>
<p>多くの実装（idp-serverを含む）では、まだレガシーパラメータが使用されています：</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 現在多くの実装で使用されているレガシーパラメータ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">authenticatorSelection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">requireResidentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// boolean型で制御</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>注意</strong>: 実装環境に応じて適切なパラメータを選択してください。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-ユーザー検証user-verification">2. ユーザー検証（User Verification）<a href="#2-ユーザー検証user-verification" class="hash-link" aria-label="2. ユーザー検証（User Verification） への直接リンク" title="2. ユーザー検証（User Verification） への直接リンク">​</a></h3>
<p>Discoverable Credentialでは<strong>ユーザー検証が必須</strong>となることが多い：</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">authenticatorSelection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">residentKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">userVerification</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 必須に設定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-認証器の容量制限">3. 認証器の容量制限<a href="#3-認証器の容量制限" class="hash-link" aria-label="3. 認証器の容量制限 への直接リンク" title="3. 認証器の容量制限 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="セキュリティキー">セキュリティキー<a href="#セキュリティキー" class="hash-link" aria-label="セキュリティキー への直接リンク" title="セキュリティキー への直接リンク">​</a></h4>
<ul>
<li><strong>容量</strong>: 通常25〜100個程度のDiscoverable Credentialを保存可能</li>
<li><strong>対策</strong>: 企業環境では容量管理が重要</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="プラットフォーム認証器">プラットフォーム認証器<a href="#プラットフォーム認証器" class="hash-link" aria-label="プラットフォーム認証器 への直接リンク" title="プラットフォーム認証器 への直接リンク">​</a></h4>
<ul>
<li><strong>容量</strong>: クラウド同期により実質無制限</li>
<li><strong>例</strong>: iCloudキーチェーン、Google Password Manager</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-ユーザー情報の設定">4. ユーザー情報の設定<a href="#4-ユーザー情報の設定" class="hash-link" aria-label="4. ユーザー情報の設定 への直接リンク" title="4. ユーザー情報の設定 への直接リンク">​</a></h3>
<p>Discoverable Credentialでは、認証器に保存するユーザー情報を適切に設定：</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TextEncoder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;user123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// ユーザーの一意ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;itou@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// ユーザー名（メールアドレス等）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">displayName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;伊藤一朗&quot;</span><span class="token plain">                      </span><span class="token comment" style="color:#999988;font-style:italic">// 表示名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>プライバシー考慮事項</strong>:</p>
<ul>
<li><code>displayName</code>には個人を特定できる情報を含めない（推奨）</li>
<li>必要最小限の情報のみ保存</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="セキュリティ考慮事項">セキュリティ考慮事項<a href="#セキュリティ考慮事項" class="hash-link" aria-label="セキュリティ考慮事項 への直接リンク" title="セキュリティ考慮事項 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="よくある誤解と正しい理解">よくある誤解と正しい理解<a href="#よくある誤解と正しい理解" class="hash-link" aria-label="よくある誤解と正しい理解 への直接リンク" title="よくある誤解と正しい理解 への直接リンク">​</a></h3>
<p>Discoverable Credentialのセキュリティについて、よくある誤解と正しい理解を整理します。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="誤解1-displaynameに実名を使うとプライバシーリスクがある">誤解1: 「displayNameに実名を使うとプライバシーリスクがある」<a href="#誤解1-displaynameに実名を使うとプライバシーリスクがある" class="hash-link" aria-label="誤解1: 「displayNameに実名を使うとプライバシーリスクがある」 への直接リンク" title="誤解1: 「displayNameに実名を使うとプライバシーリスクがある」 への直接リンク">​</a></h4>
<p>❌ <strong>誤解</strong>:</p>
<ul>
<li>表示名に個人識別情報（実名）を含めてはいけない</li>
<li>displayNameは匿名化すべき</li>
</ul>
<p>✅ <strong>正しい理解</strong>:</p>
<ul>
<li><strong>displayNameは実名使用が推奨</strong>される</li>
<li>プライバシー保護が必要なのは<code>user.id</code>（user handle）</li>
<li>displayNameはユーザーが選択できるべき</li>
</ul>
<p><strong>W3C WebAuthn仕様</strong>:</p>
<blockquote>
<p>&quot;The displayName is a human-palatable name for the user account, intended only for display. For example, &#x27;Alex Müller&#x27; or &#x27;田中倫&#x27;. The Relying Party SHOULD let the user choose this, and SHOULD NOT restrict the choice more than necessary.&quot;</p>
</blockquote>
<p><strong>正しい実装</strong>:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> crypto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">randomUUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// ✅ ランダムUUID（PII禁止）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;itou@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">// ✅ メールアドレス可（識別用）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">displayName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;伊藤一朗&quot;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// ✅ 実名推奨（ユーザーフレンドリー）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="誤解2-discoverable-credentialはユーザー列挙攻撃に脆弱">誤解2: 「Discoverable Credentialはユーザー列挙攻撃に脆弱」<a href="#誤解2-discoverable-credentialはユーザー列挙攻撃に脆弱" class="hash-link" aria-label="誤解2: 「Discoverable Credentialはユーザー列挙攻撃に脆弱」 への直接リンク" title="誤解2: 「Discoverable Credentialはユーザー列挙攻撃に脆弱」 への直接リンク">​</a></h4>
<p>❌ <strong>誤解</strong>:</p>
<ul>
<li>デバイスに保存されたアカウント一覧から簡単にユーザー情報が漏洩する</li>
<li>サーバー側でユーザー 列挙攻撃のリスクが増える</li>
</ul>
<p>✅ <strong>正しい理解</strong>:</p>
<ul>
<li>Discoverable Credentialを使うことで、むしろ<strong>サーバー側でのユーザー列挙攻撃を防げる</strong></li>
<li>デバイス内の情報にアクセスするには「物理アクセス + デバイスロック突破 + 生体認証突破」が必要</li>
<li>適切なデバイスロック設定で十分なセキュリティを確保できる</li>
</ul>
<p><strong>W3C WebAuthn Working Group の見解（Issue #578）</strong>:</p>
<ul>
<li>生体認証やPINで保護された認証器では、displayName等の情報を保存しても問題ない</li>
<li>本当のリスクは「認証機能のない認証器」での使用</li>
</ul>
<p><strong>推奨対策</strong>:</p>
<ul>
<li>Platform Authenticator（Touch ID, Face ID, Windows Hello）の使用</li>
<li>デバイスロック（パスコード/パスワード）の必須化</li>
<li>セキュリティキー使用時はPIN設定を推奨</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="誤解3-パスキーは定期的に更新すべき">誤解3: 「パスキーは定期的に更新すべき」<a href="#誤解3-パスキーは定期的に更新すべき" class="hash-link" aria-label="誤解3: 「パスキーは定期的に更新すべき」 への直接リンク" title="誤解3: 「パスキーは定期的に更新すべき」 への直接リンク">​</a></h4>
<p>❌ <strong>誤解</strong>:</p>
<ul>
<li>パスワードのように定期的にクレデンシャルを更新すべき</li>
<li>アクセス頻度によって自動削除すべき</li>
</ul>
<p>✅ <strong>正しい理解</strong>:</p>
<ul>
<li>パスキーは<strong>永続的に使用する</strong>ことが想定されている</li>
<li>公開鍵暗号方式のため、サーバー側に秘密情報は保存されない</li>
<li>定期更新は不要であり、ユーザー体験を損なう</li>
</ul>
<p><strong>実際のリスクと対策</strong>:</p>
<ul>
<li><strong>リスク</strong>: デバイス紛失時のアクセス不能</li>
<li><strong>対策</strong>: 複数デバイスへの登録、バックアップ認証手段の用意</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="実際のセキュリティリスクと対策">実際のセキュリティリスクと対策<a href="#実際のセキュリティリスクと対策" class="hash-link" aria-label="実際のセキュリティリスクと対策 への直接リンク" title="実際のセキュリティリスクと対策 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-物理デバイス紛失盗難">1. 物理デバイス紛失・盗難<a href="#1-物理デバイス紛失盗難" class="hash-link" aria-label="1. 物理デバイス紛失・盗難 への直接リンク" title="1. 物理デバイス紛失・盗難 への直接リンク">​</a></h4>
<p><strong>リスクシナリオ</strong>:</p>
<ul>
<li>デバイス紛失 + デバイスロック未設定 → パスキー不正使用の可能性</li>
</ul>
<p><strong>推奨対策</strong>:</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->デバイスロック（パスコード/パスワード）必須化</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->生体認証の有効化（Touch ID, Face ID等）</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->複数デバイスへのパスキー登録</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->リモートワイプ機能の有効化（企業環境）</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->バックアップ認証手段の用意</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-認証器容量制限セキュリティキー">2. 認証器容量制限（セキュリティキー）<a href="#2-認証器容量制限セキュリティキー" class="hash-link" aria-label="2. 認証器容量制限（セキュリティキー） への直接リンク" title="2. 認証器容量制限（セキュリティキー） への直接リンク">​</a></h4>
<p><strong>リスクシナリオ</strong>:</p>
<ul>
<li>セキュリティキーの容量（25〜100個程度）超過 → 新規登録不可</li>
</ul>
<p><strong>推奨対策</strong>:</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->企業環境での容量管理ポリシー策定</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->不要なクレデンシャルの定期削除フロー</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->容量監視とアラート機能（可能であれば）</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Platform Authenticatorの併用推奨（実質無制限）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-デバイス紛失時の復旧">3. デバイス紛失時の復旧<a href="#3-デバイス紛失時の復旧" class="hash-link" aria-label="3. デバイス紛失時の復旧 への直接リンク" title="3. デバイス紛失時の復旧 への直接リンク">​</a></h4>
<p><strong>クラウド同期有効時（Platform Authenticator）</strong>:</p>
<ul>
<li><strong>復旧</strong>: 新デバイスでクラウドアカウント設定後、自動的にパスキー復元</li>
<li><strong>対象</strong>: iOS（iCloud Keychain）、Android（Google Password Manager）、1Password等</li>
<li><strong>メリット</strong>: デバイス紛失時も別デバイスで継続使用可能</li>
<li><strong>デメリット</strong>: クラウドアカウント侵害時の影響範囲が大きい</li>
</ul>
<p><strong>クラウド同期無効時（セキュリティキー等）</strong>:</p>
<ul>
<li><strong>復旧</strong>: 不可能（デバイス紛失 = パスキー喪失）</li>
<li><strong>対策</strong>: 複数デバイスへの事前登録必須</li>
<li><strong>推奨</strong>: バックアップ認証手段（パスワード、SMS等）を併用</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="プライバシー保護の正しい理解">プライバシー保護の正しい理解<a href="#プライバシー保護の正しい理解" class="hash-link" aria-label="プライバシー保護の正しい理解 への直接リンク" title="プライバシー保護の正しい理解 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="認証器に保存される情報">認証器に保存される情報<a href="#認証器に保存される情報" class="hash-link" aria-label="認証器に保存される情報 への直接リンク" title="認証器に保存される情報 への直接リンク">​</a></h4>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Discoverable Credentialで認証器に保存される情報</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ランダムUUID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;itou@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// ユーザー名（識別用）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">displayName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;伊藤一朗&quot;</span><span class="token plain">                      </span><span class="token comment" style="color:#999988;font-style:italic">// 表示名（UI表示用）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">rpId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">// サイト情報</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">credentialId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token plain">                           </span><span class="token comment" style="color:#999988;font-style:italic">// 資格情報ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="各フィールドのプライバシー考慮事項">各フィールドのプライバシー考慮事項<a href="#各フィールドのプライバシー考慮事項" class="hash-link" aria-label="各フィールドのプライバシー考慮事項 への直接リンク" title="各フィールドのプライバシー考慮事項 への直接リンク">​</a></h4>
<table><thead><tr><th>フィールド</th><th>プライバシー要件</th><th>推奨値</th><th>理由</th></tr></thead><tbody><tr><td><strong>user.id</strong></td><td>❗ PII禁止</td><td>ランダムUUID</td><td>仕様で明示的に禁止</td></tr><tr><td><strong>user.name</strong></td><td>⚠️ 変更可能性考慮</td><td>メールアドレス可</td><td>識別用途、変更時は新規登録必要</td></tr><tr><td><strong>user.displayName</strong></td><td>✅ ユーザーフレンドリー</td><td>実名推奨</td><td>ユーザーが選択、オートフィルで表示</td></tr></tbody></table>
<p><strong>W3C WebAuthn仕様（user.id）</strong>:</p>
<blockquote>
<p>&quot;The user handle MUST NOT contain personally identifying information about the user, such as a username or e-mail address.&quot;</p>
</blockquote>
<p><strong>重要なポイント</strong>:</p>
<ul>
<li>✅ <strong>displayNameは実名使用が推奨</strong>（ユーザー体験向上のため）</li>
<li>✅ Platform Authenticatorは生体認証で保護されている</li>
<li>✅ デバイスロック設定でさらに保護層を追加</li>
<li>❌ user.idにPIIを含めてはいけない（唯一の絶対要件）</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="仕様参照">仕様参照<a href="#仕様参照" class="hash-link" aria-label="仕様参照 への直接リンク" title="仕様参照 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="w3cfido仕様">W3C・FIDO仕様<a href="#w3cfido仕様" class="hash-link" aria-label="W3C・FIDO仕様 への直接リンク" title="W3C・FIDO仕様 への直接リンク">​</a></h3>
<ul>
<li><strong><a href="https://www.w3.org/TR/webauthn-3/" target="_blank" rel="noopener noreferrer">WebAuthn Level 3</a></strong> - W3C WebAuthn最新仕様</li>
<li><strong><a href="https://www.w3.org/TR/webauthn-3/#dom-authenticatorselectioncriteria-residentkey" target="_blank" rel="noopener noreferrer">WebAuthn Level 3 - Resident Key</a></strong> - residentKeyパラメータ詳細</li>
<li><strong><a href="https://fidoalliance.org/specs/fido-v2.1-ps-20210615/fido-client-to-authenticator-protocol-v2.1-ps-errata-20220621.html" target="_blank" rel="noopener noreferrer">FIDO2 Client to Authenticator Protocol</a></strong> - CTAP仕様</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="関連ドキュメント">関連ドキュメント<a href="#関連ドキュメント" class="hash-link" aria-label="関連ドキュメント への直接リンク" title="関連ドキュメント への直接リンク">​</a></h3>
<ul>
<li><strong><a href="/idp-server/docs/content_03_concepts/basic/basic-16-fido2-webauthn-passwordless">FIDO2・WebAuthn パスワードレス認証</a></strong> - FIDO2/WebAuthnの基礎概念</li>
<li><strong><a href="/idp-server/docs/content_06_developer-guide/05-configuration/authn/webauthn.md">WebAuthn設定</a></strong> - idp-serverでのWebAuthn設定方法</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重要なポイント">重要なポイント<a href="#重要なポイント" class="hash-link" aria-label="重要なポイント への直接リンク" title="重要なポイント への直接リンク">​</a></h3>
<ol>
<li>
<p><strong>Discoverable Credential = 保存形式（登録時）</strong></p>
<ul>
<li><code>residentKey: &quot;required&quot;</code> でユーザー情報を認証器に保存</li>
<li>ユーザーID入力が不要になる</li>
<li>認証器に保存される情報: 秘密鍵、user.id、user.name、user.displayName</li>
</ul>
</li>
<li>
<p><strong>Conditional UI = 使用方法（認証時）</strong></p>
<ul>
<li><code>mediation: &#x27;conditional&#x27;</code> でオートフィル起動</li>
<li>W3C WebAuthn Level 3の公式機能</li>
<li>Chrome 108+, Safari 16+で対応（MDN Baseline 2023）</li>
<li>idp-server実装済み（推奨）</li>
</ul>
</li>
<li>
<p><strong>関係性</strong></p>
<ul>
<li>Conditional UIを使うには<strong>Discoverableが必須</strong></li>
<li>Discoverableを使うのに<strong>Conditional UIは必須ではない</strong>（Modalでも可）</li>
<li><strong>推奨組み合わせ</strong>: Discoverable + Conditional UI</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="よくある誤解">よくある誤解<a href="#よくある誤解" class="hash-link" aria-label="よくある誤解 への直接リンク" title="よくある誤解 への直接リンク">​</a></h3>
<table><thead><tr><th>誤解</th><th>正しい理解</th></tr></thead><tbody><tr><td>displayNameは匿名化すべき</td><td>✅ <strong>実名使用が推奨</strong>（user.idのみPII禁止）</td></tr><tr><td>ユーザー列挙攻撃に脆弱</td><td>✅ むしろサーバー側の列挙攻撃を<strong>防げる</strong></td></tr><tr><td>定期的に更新すべき</td><td>✅ <strong>永続的使用が想定</strong>、更新不要</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="実装チェックリスト-1">実装チェックリスト<a href="#実装チェックリスト-1" class="hash-link" aria-label="実装チェックリスト への直接リンク" title="実装チェックリスト への直接リンク">​</a></h3>
<p><strong>登録時（Discoverable Credential作成）</strong>:</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>residentKey: &quot;required&quot;</code> または <code>requireResidentKey: true</code> を設定</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>user.id</code> はランダムUUID（PII禁止、仕様で明示）</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>user.name</code> にメールアドレス等の識別子</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>user.displayName</code> に実名設定（ユーザーが選択、オートフィルで表示）</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>authenticatorAttachment: &quot;platform&quot;</code> 推奨（Touch ID等）</li>
</ul>
<p><strong>認証時（Conditional UI使用）</strong>:</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>mediation: &#x27;conditional&#x27;</code> を指定</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>allowCredentials</code> を空にする（または省略）</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->HTML入力フィールドに <code>autoComplete=&quot;username webauthn&quot;</code> を追加</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->ページロード時に <code>credentials.get()</code> を起動</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->機能検出: <code>PublicKeyCredential.isConditionalMediationAvailable()</code> で確認</li>
</ul>
<p><strong>セキュリティ対策</strong>:</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->デバイスロック（パスコード/パスワード）必須化</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->生体認証の有効化</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->複数デバイスへのパスキー登録推奨</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->バックアップ認証手段の用意</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参考リソース">参考リソース<a href="#参考リソース" class="hash-link" aria-label="参考リ ソース への直接リンク" title="参考リソース への直接リンク">​</a></h3>
<ul>
<li><strong>W3C仕様</strong>: <a href="https://www.w3.org/TR/webauthn-3/" target="_blank" rel="noopener noreferrer">WebAuthn Level 3</a></li>
<li><strong>Conditional UI</strong>: <a href="https://github.com/w3c/webauthn/wiki/Explainer:-WebAuthn-Conditional-UI" target="_blank" rel="noopener noreferrer">W3C Explainer</a></li>
<li><strong>実装ガイド</strong>: <a href="https://developer.chrome.com/docs/identity/webauthn-conditional-ui" target="_blank" rel="noopener noreferrer">Chrome Developers</a></li>
<li><strong>idp-server実装</strong>: <a href="/idp-server/docs/content_06_developer-guide/05-configuration/authn/webauthn.md">WebAuthn設定ガイド</a></li>
</ul>
<hr>
<blockquote>
<p>Discoverable CredentialとConditional UIの違いを理解し、適切な実装により、
セキュアで使いやすいパスワードレス認証システムを構築しましょう！</p>
</blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_03_concepts/basic/basic-17-fido2-passkey-discoverable-credential.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_03_concepts/basic/basic-16-fido2-webauthn-passwordless"><div class="pagination-nav__sublabel"> 前へ</div><div class="pagination-nav__label">FIDO2・WebAuthn パスワードレス認証</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_03_concepts/basic/basic-18-fido2-architecture-rp-browser-authenticator"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">FIDO2アーキテクチャ - RP・Webブラウザー・認証器の関係</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概要" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#fido2とは" class="table-of-contents__link toc-highlight">FIDO2とは</a><ul><li><a href="#fido2の構成要素" class="table-of-contents__link toc-highlight">FIDO2の構成要素</a></li><li><a href="#パスワードレス認証の実現" class="table-of-contents__link toc-highlight">パスワードレス認証の実現</a></li></ul></li><li><a href="#パスキーとは" class="table-of-contents__link toc-highlight">パスキーとは</a><ul><li><a href="#技術的定義" class="table-of-contents__link toc-highlight">技術的定義</a></li><li><a href="#パスキーの共通特徴" class="table-of-contents__link toc-highlight">パスキーの共通特徴</a></li></ul></li><li><a href="#discoverable-credentialとは" class="table-of-contents__link toc-highlight">Discoverable Credentialとは</a><ul><li><a href="#技術的定義-1" class="table-of-contents__link toc-highlight">技術的定義</a></li><li><a href="#主な特徴" class="table-of-contents__link toc-highlight">主な特徴</a></li><li><a href="#webauthn仕様におけるパラメータ" class="table-of-contents__link toc-highlight">WebAuthn仕様におけるパラメータ</a></li></ul></li><li><a href="#通常のパスキーとdiscoverable-credentialの違い" class="table-of-contents__link toc-highlight">通常のパスキーとDiscoverable Credentialの違  い</a><ul><li><a href="#認証フロー比較" class="table-of-contents__link toc-highlight">認証フロー比較</a></li><li><a href="#ユースケース比較表" class="table-of-contents__link toc-highlight">ユースケース比較表</a></li><li><a href="#conditional-uiオートフィルの標準化状況" class="table-of-contents__link toc-highlight">Conditional UI（オートフィル）の標準化状況</a></li></ul></li><li><a href="#discoverable-credentialとconditional-uiの関係" class="table-of-contents__link toc-highlight">Discoverable CredentialとConditional UIの関係</a><ul><li><a href="#重要な概念の違い" class="table-of-contents__link toc-highlight">重要な概念の違い</a></li><li><a href="#1-discoverable-credential--パスキーの保存形式" class="table-of-contents__link toc-highlight">1. Discoverable Credential = パスキーの「保存形式」</a></li><li><a href="#2-conditional-ui--パスキーの使用方法" class="table-of-contents__link toc-highlight">2. Conditional UI = パスキーの「使用方法」</a></li><li><a href="#3-関係性の図解" class="table-of-contents__link toc-highlight">3. 関係性の図解</a></li><li><a href="#4-組み合わせ可否表" class="table-of-contents__link toc-highlight">4. 組み合わせ可否表</a></li><li><a href="#5-なぜconditional-uiにはdiscoverable-credentialが必須なのか" class="table-of-contents__link toc-highlight">5. なぜConditional UIにはDiscoverable Credentialが必須なのか？</a></li><li><a href="#6-実際のフロー例idp-server実装" class="table-of-contents__link toc-highlight">6. 実際のフロー例（idp-server実装）</a></li><li><a href="#7-まとめ" class="table-of-contents__link toc-highlight">7. まとめ</a></li></ul></li><li><a href="#実装における注意点" class="table-of-contents__link toc-highlight">実装における注意点</a><ul><li><a href="#1-requireresidentkeyとresidentkeyの関係" class="table-of-contents__link toc-highlight">1. <code>requireResidentKey</code>と<code>residentKey</code>の関係</a></li><li><a href="#2-ユーザー検証user-verification" class="table-of-contents__link toc-highlight">2. ユーザー検証（User Verification）</a></li><li><a href="#3-認証器の容量制限" class="table-of-contents__link toc-highlight">3. 認証器の容量制限</a></li><li><a href="#4-ユーザー情報の設定" class="table-of-contents__link toc-highlight">4. ユーザー情報の設定</a></li></ul></li><li><a href="#セキュリティ考慮事項" class="table-of-contents__link toc-highlight">セキュリティ考慮事項</a><ul><li><a href="#よくある誤解と正しい理解" class="table-of-contents__link toc-highlight">よくある誤解と正しい理解</a></li><li><a href="#実際のセキュリティリスクと対策" class="table-of-contents__link toc-highlight">実際のセキュリティリスクと対策</a></li><li><a href="#プライバシー保護の正しい理解" class="table-of-contents__link toc-highlight">プライバシー保護の正しい理解</a></li></ul></li><li><a href="#仕様参照" class="table-of-contents__link toc-highlight">仕様参照</a><ul><li><a href="#w3cfido仕様" class="table-of-contents__link toc-highlight">W3C・FIDO仕様</a></li><li><a href="#関連ドキュメント" class="table-of-contents__link toc-highlight">関連ドキュメント</a></li></ul></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a><ul><li><a href="#重要なポイント" class="table-of-contents__link toc-highlight">重要なポイント</a></li><li><a href="#よくある誤解" class="table-of-contents__link toc-highlight">よくある誤解</a></li><li><a href="#実装チェックリスト-1" class="table-of-contents__link toc-highlight">実装チェックリスト</a></li><li><a href="#参考リソース" class="table-of-contents__link toc-highlight">参考リソース</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>