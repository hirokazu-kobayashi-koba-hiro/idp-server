<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_11_learning/postgresql/dba-01-installation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">PostgreSQL インストールと初期設定ガイド | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/postgresql/dba-01-installation"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="PostgreSQL インストールと初期設定ガイド | IdP-Server Documentation"><meta data-rh="true" name="description" content="このドキュメントでは、PostgreSQLのインストールから本番環境向けの初期設定までを解説します。"><meta data-rh="true" property="og:description" content="このドキュメントでは、PostgreSQLのインストールから本番環境向けの初期設定までを解説します。"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/postgresql/dba-01-installation"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/postgresql/dba-01-installation" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/postgresql/dba-01-installation" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.5bdbf449.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.4b374a20.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">アイデンティティ管理の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-fundamentals/modern-web-authz-authn">OAuth 2.0の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-tokens/id-token-jwt">OAuth 2.0トークン</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/openid-connect/oauth-oidc-basics">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-architecture-rp-browser-authenticator">FIDO2/WebAuthn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/security/glossary">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/multi-tenancy/multi-tenancy-basics">マルチテナント</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/advanced-protocols/ciba-basics">高度なプロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/http-rest/http-basics">HTTP/REST</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jwt-jose/jwt-introduction">JWT/JOSE</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth/OIDC RFC学習</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/verifiable-credentials/">Verifiable Credentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/data-formats/">データフォーマット</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/web-session-basics">セッション管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL 学習ガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/overview">概要</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-00-managed-vs-self-hosted">DBA向け</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-00-managed-vs-self-hosted">PostgreSQL: マネージドサービス vs セルフホスト比較ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-01-installation">PostgreSQL インストールと初期設定ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-02-backup-recovery">PostgreSQL バックアップとリカバリガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-03-replication-ha">PostgreSQL レプリケーションとHA構成ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-04-security">PostgreSQL セキュリティガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-05-monitoring">PostgreSQL 監視ガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-06-maintenance">PostgreSQL メンテナンスガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-07-partitioning">PostgreSQL パーティショニングガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-08-planner">PostgreSQL プランナー深掘りガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dba-09-extensions">PostgreSQL 拡張機能（Extensions）ガイド</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/dev-01-sql-basics">開発者向け</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/crypto/">暗号化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/kubernetes/">コンテナ/Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/linux/">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/networking/">ネットワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/">JVM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/os-fundamentals/">OS基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/frameworks/">フレームワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/sdk/">SDK</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/clean-architecture/">クリーンアーキテクチャ</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">学習（Learning）</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">PostgreSQL</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">DBA向け</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PostgreSQL インストールと初期設定ガイド</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>PostgreSQL インストールと初期設定ガイド</h1></header>
<p>このドキュメントでは、PostgreSQLのインストールから本番環境向けの初期設定までを解説します。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="目次">目次<a href="#目次" class="hash-link" aria-label="目次 への直接リンク" title="目次 への直接リンク">​</a></h2>
<ol>
<li><a href="#1-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95">インストール方法</a></li>
<li><a href="#2-%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%BF%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96">データベースクラスタの初期化</a></li>
<li><a href="#3-postgresqlconf-%E3%81%AE%E8%A8%AD%E5%AE%9A">postgresql.conf の設定</a></li>
<li><a href="#4-pg_hbaconf-%E3%81%AE%E8%A8%AD%E5%AE%9A">pg_hba.conf の設定</a></li>
<li><a href="#5-%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E8%B5%B7%E5%8B%95%E3%81%A8%E7%AE%A1%E7%90%86">サービスの起動と管理</a></li>
<li><a href="#6-%E5%88%9D%E6%9C%9F%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E4%BD%9C%E6%A5%AD">初期セットアップ作業</a></li>
<li><a href="#7-%E6%9C%AC%E7%95%AA%E7%92%B0%E5%A2%83%E5%90%91%E3%81%91%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%83%AA%E3%82%B9%E3%83%88">本番環境向けチェックリスト</a></li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-インストール方法">1. インストール方法<a href="#1-インストール方法" class="hash-link" aria-label="1. インストール方法 への直接リンク" title="1. インストール方法 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-インストール方法の比較">1.1   インストール方法の比較<a href="#11-インストール方法の比較" class="hash-link" aria-label="1.1 インストール方法の比較 への直接リンク" title="1.1 インストール方法の比較 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  インストール方法の選択                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ① パッケージマネージャー (推奨)                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - OS標準またはPGDGリポジトリ                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 自動更新、依存関係管理が容易                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 本番環境向け                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ② ソースからビルド                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 最新バージョン、カスタムビルド                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 開発・検証環境向け                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ③ Docker                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 環境の再現性                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 開発・CI/CD向け                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ④ クラウドマネージドサービス                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - RDS, Cloud SQL, Azure Database等                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 運用負荷軽減                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-linux-rhelcentosrocky-linux">1.2 Linux (RHEL/CentOS/Rocky Linux)<a href="#12-linux-rhelcentosrocky-linux" class="hash-link" aria-label="1.2 Linux (RHEL/CentOS/Rocky Linux) への直接リンク" title="1.2 Linux (RHEL/CentOS/Rocky Linux) への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># PGDG (PostgreSQL Global Development Group) リポジトリの追加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># デフォルトのPostgreSQLモジュールを無効化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf -qy module disable postgresql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># PostgreSQL 16 のインストール</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf install -y postgresql16-server postgresql16-contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># バージョン確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/pgsql-16/bin/postgres --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-linux-ubuntudebian">1.3 Linux (Ubuntu/Debian)<a href="#13-linux-ubuntudebian" class="hash-link" aria-label="1.3 Linux (Ubuntu/Debian) への直接リンク" title="1.3 Linux (Ubuntu/Debian) への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># PGDGリポジトリの追加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sh -c &#x27;echo &quot;deb https://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># リポジトリの署名キーをインポート</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># パッケージリストの更新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># PostgreSQL 16 のインストール</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install -y postgresql-16 postgresql-contrib-16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># バージョン確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">psql --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-macos">1.4 macOS<a href="#14-macos" class="hash-link" aria-label="1.4 macOS への直接リンク" title="1.4 macOS への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Homebrewでインストール</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install postgresql@16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># パスを通す</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;export PATH=&quot;/opt/homebrew/opt/postgresql@16/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># サービスの開始</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew services start postgresql@16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-docker">1.5 Docker<a href="#15-docker" class="hash-link" aria-label="1.5 Docker への直接リンク" title="1.5 Docker への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 基本的な起動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name postgres \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e POSTGRES_PASSWORD=mysecretpassword \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 5432:5432 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v pgdata:/var/lib/postgresql/data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  postgres:16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># カスタム設定付き</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name postgres \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e POSTGRES_PASSWORD=mysecretpassword \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e POSTGRES_USER=myuser \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e POSTGRES_DB=mydb \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 5432:5432 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v pgdata:/var/lib/postgresql/data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v ./postgresql.conf:/etc/postgresql/postgresql.conf \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  postgres:16 -c &#x27;config_file=/etc/postgresql/postgresql.conf&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-データベースクラスタの初期化">2. データベースクラスタの初期化<a href="#2-データベースクラスタの初期化" class="hash-link" aria-label="2. データベースクラスタの初期化 への直接リンク" title="2. データベースクラスタの初期化 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-initdb-の実行">2.1 initdb の実行<a href="#21-initdb-の実行" class="hash-link" aria-label="2.1 initdb の実行 への直接リンク" title="2.1 initdb の実行 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># RHEL系の場合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo /usr/pgsql-16/bin/postgresql-16-setup initdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># または手動で実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/initdb -D /var/lib/pgsql/16/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Ubuntu/Debianの場合（自動で実行される）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 手動で行う場合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/lib/postgresql/16/bin/initdb -D /var/lib/postgresql/16/main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-initdb-のオプション">2.2 initdb のオプション<a href="#22-initdb-のオプション" class="hash-link" aria-label="2.2 initdb のオプション への直接リンク" title="2.2 initdb のオプション への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌───────────────────────────────────────────────────  ───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    initdb の主要オプション                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  -D, --pgdata=DIRECTORY                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      データディレクトリを指定                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  -E, --encoding=ENCODING                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      デフォルトのエンコーディング (推奨: UTF8)               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  --locale=LOCALE                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      ロケール設定 (推奨: C.UTF-8 または en_US.UTF-8)         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  --lc-collate=LOCALE                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      照合順序のロケール                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  --data-checksums                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      データページのチェックサムを有効化 (推奨)               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  -k, --data-encryption                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      TDE (Transparent Data Encryption) - PostgreSQL 16+     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  --wal-segsize=SIZE                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      WALセグメントサイズ (デフォルト: 16MB)                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-本番環境向け-initdb-例">2.3 本番環境向け initdb 例<a href="#23-本番環境向け-initdb-例" class="hash-link" aria-label="2.3 本番環境向け initdb 例 への直接リンク" title="2.3 本番環境向け initdb 例 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/initdb \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -D /var/lib/pgsql/16/data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -E UTF8 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --locale=C.UTF-8 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --data-checksums \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --wal-segsize=64</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-データディレクトリの構造">2.4 データディレクトリの構造<a href="#24-データディレクトリの構造" class="hash-link" aria-label="2.4 データディレクトリの構造 への直接リンク" title="2.4 データディレクトリの構造 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/var/lib/pgsql/16/data/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── base/                    # データベースファイル</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 1/                   # template1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 4/                   # template0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── 5/                   # postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── global/                  # クラスタ全体の共有テーブル</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_commit_ts/            # トランザクションコミットタイムスタンプ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_dynshmem/             # 動的共有メモリ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_logical/              # 論理レプリケーション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_multixact/            # マルチトランザクション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_notify/               # LISTEN/NOTIFY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_replslot/             # レプリケーションスロット</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_serial/               # シリアライザブルトランザクション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_snapshots/            # エクスポートされたスナップショット</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_stat/                 # 統計情報（永続）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_stat_tmp/             # 統計情報（一時）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_subtrans/             # サブトランザクション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_tblspc/               # テーブルスペースへのシンボリックリンク</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_twophase/             # 2フェーズコミット</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_wal/                  # WALファイル</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_xact/                 # トランザクションコミット状態</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── postgresql.auto.conf     # ALTER SYSTEMによる設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── postgresql.conf          # メイン設定ファイル</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_hba.conf              # クライアント認証設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pg_ident.conf            # ユーザーマッピング</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── PG_VERSION               # PostgreSQLバージョン</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── postmaster.opts          # 最後の起動オプション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── postmaster.pid           # プロセスID（起動中のみ）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-postgresqlconf-の設定">3. postgresql.conf の設定<a href="#3-postgresqlconf-の設定" class="hash-link" aria-label="3. postgresql.conf の設定 への直接リンク" title="3. postgresql.conf の設定 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-設定ファイルの概要">3.1 設定ファイルの概要<a href="#31-設定ファイルの概要" class="hash-link" aria-label="3.1 設定ファイルの概要 への直接リンク" title="3.1 設定ファイルの概要 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    設定ファイルの優先順位                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├───────────────────────────────────────────────────────  ───────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  優先度: 低 ────────────────────────────────────────→ 高    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  postgresql.conf                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ↓ 上書き                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  postgresql.auto.conf (ALTER SYSTEM)                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ↓ 上書き                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  起動時オプション (-c parameter=value)                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ↓ 上書き                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  セッション単位 (SET parameter = value)                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────  ─────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-接続設定">3.2 接続設定<a href="#32-接続設定" class="hash-link" aria-label="3.2 接続設定 への直接リンク" title="3.2 接続設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 接続設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># リッスンするIPアドレス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &#x27;*&#x27; = 全てのインターフェース、&#x27;localhost&#x27; = ローカルのみ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listen_addresses = &#x27;*&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ポート番号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port = 5432</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 最大同時接続数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 注意: 各接続はメモリを消費する (work_mem × 接続数)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_connections = 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># スーパーユーザー用の予約接続数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">superuser_reserved_connections = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Unix ソケットディレクトリ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unix_socket_directories = &#x27;/var/run/postgresql&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 認証タイムアウト (秒)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">authentication_timeout = 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># TCP keepalive設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp_keepalives_idle = 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp_keepalives_interval = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp_keepalives_count = 6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-メモリ設定">3.3 メモリ設定<a href="#33-メモリ設定" class="hash-link" aria-label="3.3 メモリ設定 への直接リンク" title="3.3 メモリ設定 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    メモリ設定の考え方                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【サーバー総メモリ: 64GB の場合の目安】                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  shared_buffers: 16GB (25%)                          │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - データベースキャッシュ                            │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 総メモリの 25% が目安                             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  effective_cache_size: 48GB (75%)                    │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - OSキャッシュを含めた見積もり                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - プランナーの判断に使用                            │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 実際にはメモリ確保しない                          │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  work_mem: 64MB                                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - ソート/ハッシュ用 (接続ごと・操作ごと)            │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - max_connections × 並列度 を考慮                   │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 大きすぎるとメモリ不足の原因に                    │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  maintenance_work_mem: 2GB                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - VACUUM, CREATE INDEX用                            │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 大きいほどメンテナンスが高速                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────────────────  ──────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># メモリ設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 共有バッファ - 総メモリの25%程度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shared_buffers = 16GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OSキャッシュを含めたキャッシュ見積もり - 総メモリの75%程度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective_cache_size = 48GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ソート/ハッシュ用メモリ (接続ごと)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">work_mem = 64MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># メンテナンス用メモリ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maintenance_work_mem = 2GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 一時バッファ (一時テーブル用)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">temp_buffers = 32MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Huge Pages (Linux)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 事前にOSで設定が必要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">huge_pages = try</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 動的共有メモリ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dynamic_shared_memory_type = posix</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-wal設定">3.4 WAL設定<a href="#34-wal設定" class="hash-link" aria-label="3.4 WAL設定 への直接リンク" title="3.4 WAL設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># WAL設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># WALレベル</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># minimal: 最小限 (レプリケーション不可)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># replica: レプリケーション対応 (デフォルト)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># logical: 論理レプリケーション対応</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wal_level = replica</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 同期コミット</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># on: 完全同期 (データ損失なし、遅い)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># off: 非同期 (高速だがクラッシュ時に最大3×wal_writer_delayのデータ損失)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># local: ローカルのみ同期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># remote_write: スタンバイの書き込みまで待機</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># remote_apply: スタンバイの適用まで待機</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">synchronous_commit = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># WALバッファサイズ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wal_buffers = 64MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># チェックポイント関連</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">checkpoint_timeout = 15min           # チェックポイント間隔</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">checkpoint_completion_target = 0.9   # 完了目標 (0.9 = 次のCPまでの90%の時間で完了)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_wal_size = 4GB                   # WALの最大サイズ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_wal_size = 1GB                   # WALの最小サイズ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># WAL圧縮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wal_compression = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># フルページ書き込み (データ保護のため基本的にon)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">full_page_writes = on</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-レプリケーション設定">3.5 レプリケーション設定<a href="#35-レプリケーション設定" class="hash-link" aria-label="3.5 レプリケーション設定 への直接リンク" title="3.5 レプリケーション設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># レプリケーション設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># WAL送信プロセス数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_wal_senders = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># レプリケーションスロット数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_replication_slots = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># スタンバイでの問い合わせ中のWAL保持</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hot_standby_feedback = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># アーカイブモード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">archive_mode = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">archive_command = &#x27;cp %p /var/lib/pgsql/archive/%f&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># WAL保持 (レプリケーションスロット未使用時)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wal_keep_size = 1GB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="36-並列クエリ設定">3.6 並列クエリ設定<a href="#36-並列クエリ設定" class="hash-link" aria-label="3.6 並列クエリ設定 への直接リンク" title="3.6 並列クエリ設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 並列クエリ設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 並列ワーカーの最大数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_parallel_workers = 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1クエリあたりの最大並列ワーカー数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_parallel_workers_per_gather = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 並列メンテナンスワーカー数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_parallel_maintenance_workers = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 並列処理のコスト設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parallel_tuple_cost = 0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parallel_setup_cost = 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 並列処理を開始するテーブルサイズ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_parallel_table_scan_size = 8MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_parallel_index_scan_size = 512kB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="37-vacuum--autovacuum設定">3.7 VACUUM / Autovacuum設定<a href="#37-vacuum--autovacuum設定" class="hash-link" aria-label="3.7 VACUUM / Autovacuum設定 への直接リンク" title="3.7 VACUUM / Autovacuum設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Autovacuum設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Autovacuumの有効化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Autovacuumワーカー数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_max_workers = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># チェック間隔 (秒)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_naptime = 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># VACUUM起動閾値</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_vacuum_threshold = 50           # 最小行数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_vacuum_scale_factor = 0.1       # テーブルサイズの割合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ANALYZE起動閾値</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_analyze_threshold = 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_analyze_scale_factor = 0.05</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># コスト制限 (I/O負荷制御)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_vacuum_cost_delay = 2ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_vacuum_cost_limit = 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Freeze設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_freeze_max_age = 200000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autovacuum_multixact_freeze_max_age = 400000000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="38-ログ設定">3.8 ログ設定<a href="#38-ログ設定" class="hash-link" aria-label="3.8 ログ設定 への直接リンク" title="3.8 ログ設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ログ設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ログ出力先</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging_collector = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_directory = &#x27;log&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_filename = &#x27;postgresql-%Y-%m-%d.log&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_rotation_age = 1d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_rotation_size = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ログレベル</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_min_messages = warning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_min_error_statement = error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># スロークエリログ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_min_duration_statement = 1000    # 1秒以上のクエリをログ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ログ内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_checkpoints = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_connections = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_disconnections = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_lock_waits = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_temp_files = 0                   # 一時ファイルを全てログ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_autovacuum_min_duration = 0      # Autovacuumを全てログ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ログフォーマット</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_line_prefix = &#x27;%t [%p]: user=%u,db=%d,app=%a,client=%h &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_statement = &#x27;ddl&#x27;                # none, ddl, mod, all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="39-統計情報設定">3.9 統計情報設定<a href="#39-統計情報設定" class="hash-link" aria-label="3.9 統計情報設定 への直接リンク" title="3.9 統計情報設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 統計情報設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 統計情報コレクター</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">track_activities = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">track_counts = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">track_io_timing = on                 # I/O時間の計測 (若干のオーバーヘッド)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">track_wal_io_timing = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">track_functions = all                # 関数の統計</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 統計情報の詳細度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_statistics_target = 100      # ヒストグラムのサンプル数</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="310-ssd向け設定">3.10 SSD向け設定<a href="#310-ssd向け設定" class="hash-link" aria-label="3.10 SSD向け設定 への直接リンク" title="3.10 SSD向け設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SSD向け設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ランダムアクセスのコストを下げる</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">random_page_cost = 1.1               # HDD: 4.0, SSD: 1.1-1.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># シーケンシャルアクセスとの差を小さく</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seq_page_cost = 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 実効I/O並列度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective_io_concurrency = 200       # HDD: 2, SSD: 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maintenance_io_concurrency = 200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-pg_hbaconf-の設定">4. pg_hba.conf の設定<a href="#4-pg_hbaconf-の設定" class="hash-link" aria-label="4. pg_hba.conf の設定 への直接リンク" title="4. pg_hba.conf の設定 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-pg_hbaconf-の構造">4.1 pg_hba.conf の構造<a href="#41-pg_hbaconf-の構造" class="hash-link" aria-label="4.1 pg_hba.conf の構造 への直接リンク" title="4.1 pg_hba.conf の構造 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    pg_hba.conf の形式                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TYPE    DATABASE    USER    ADDRESS         METHOD          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ────    ────────    ────    ───────         ──────          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  local   all         all                     peer            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  host    all         all     127.0.0.1/32    scram-sha-256   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  host    all         all     ::1/128         scram-sha-256   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  host    mydb        myuser  192.168.1.0/24  scram-sha-256   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【TYPE】                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  local  : Unixドメインソケット接続                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  host   : TCP/IP接続 (SSL/非SSL両方)                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  hostssl: SSL接続のみ                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  hostnossl: 非SSL接続のみ                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【METHOD】                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  trust       : 無条件で許可 (危険)                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  reject      : 無条件で拒否                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  scram-sha-256: パスワード認証 (推奨)                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  md5         : MD5パスワード認証 (非推奨)                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  peer        : OSユーザー名で認証 (local接続用)              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ident       : Identサーバーで認証                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  cert        : SSL証明書認証                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ldap        : LDAP認証                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  gss         : GSSAPI認証                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-本番環境向け-pg_hbaconf-例">4.2 本番環境向け pg_hba.conf 例<a href="#42-本番環境向け-pg_hbaconf-例" class="hash-link" aria-label="4.2 本番環境向け pg_hba.conf 例 への直接リンク" title="4.2 本番環境向け pg_hba.conf 例 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ローカル接続 (postgres ユーザー)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local   all             postgres                                peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ローカル接続 (一般ユーザー)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local   all             all                                     scram-sha-256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ローカルホストからのTCP/IP接続</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host    all             all             127.0.0.1/32            scram-sha-256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host    all             all             ::1/128                 scram-sha-256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># アプリケーションサーバーからの接続 (SSL必須)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hostssl myapp_prod      myapp_user      10.0.1.0/24             scram-sha-256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># レプリケーション用接続</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hostssl replication     repl_user       10.0.2.0/24             scram-sha-256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 監視サーバーからの接続</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hostssl all             monitor_user    10.0.3.10/32            scram-sha-256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 管理者からの接続 (特定IP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hostssl all             admin_user      192.168.100.0/24        scram-sha-256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># その他は全て拒否 (明示  的に記載)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host    all             all             0.0.0.0/0               reject</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-設定変更の反映">4.3 設定変更の反映<a href="#43-設定変更の反映" class="hash-link" aria-label="4.3 設定変更の反映 への直接リンク" title="4.3 設定変更の反映 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 設定をリロード (再起動不要)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres psql -c &quot;SELECT pg_reload_conf();&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># または</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl reload postgresql-16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 現在の設定を確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres psql -c &quot;SELECT * FROM pg_hba_file_rules;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-サービスの起動と管理">5. サービスの起動と管理<a href="#5-サービスの起動と管理" class="hash-link" aria-label="5. サービスの起動と管理 への直接リンク" title="5. サービスの起動と管理 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-systemd-での管理">5.1 systemd での管理<a href="#51-systemd-での管理" class="hash-link" aria-label="5.1 systemd での管理 への直接リンク" title="5.1 systemd での管理 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># サービスの起動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start postgresql-16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># サービスの停止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl stop postgresql-16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># サービスの再起動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart postgresql-16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 設定リロード (接続を切断しない)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl reload postgresql-16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 自動起動の有効化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable postgresql-16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ステータス確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status postgresql-16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-pg_ctl-での管理">5.2 pg_ctl での管理<a href="#52-pg_ctl-での管理" class="hash-link" aria-label="5.2 pg_ctl での管理 への直接リンク" title="5.2 pg_ctl での管理 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 起動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/pg_ctl start -D /var/lib/pgsql/16/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 停止モード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/pg_ctl stop -D /var/lib/pgsql/16/data -m smart   # 全接続終了待ち</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/pg_ctl stop -D /var/lib/pgsql/16/data -m fast    # 即座に切断</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/pg_ctl stop -D /var/lib/pgsql/16/data -m immediate # 強制終了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 再起動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/pg_ctl restart -D /var/lib/pgsql/16/data -m fast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># リロード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/pg_ctl reload -D /var/lib/pgsql/16/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ステータス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u postgres /usr/pgsql-16/bin/pg_ctl status -D /var/lib/pgsql/16/data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-停止モードの違い">5.3 停止モードの違い<a href="#53-停止モードの違い" class="hash-link" aria-label="5.3 停止モードの違い への直接リンク" title="5.3 停止モードの違い への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      停止モードの比較                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【smart】                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 新規接続を拒否                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 既存接続の終了を待機                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 全セッション終了後に停止                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 時間がかかる可能性あり                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【fast】(推奨)                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 新規接続を拒否                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 既存接続を切断                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - トランザクションをロールバック                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 正常なシャットダウン                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【immediate】                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 即座にプロセスを終了                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 次回起動時にリカバリが必要                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 緊急時のみ使用                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-初期セットアップ作業">6. 初期セットアップ作業<a href="#6-初期セットアップ作業" class="hash-link" aria-label="6. 初期セットアップ作業 への直接リンク" title="6. 初期セットアップ作業 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-初期ユーザーとデータベースの作成">6.1 初期ユーザーとデータベースの作成<a href="#61-初期ユーザーとデータベースの作成" class="hash-link" aria-label="6.1 初期ユーザーとデータベースの作成 への直接リンク" title="6.1 初期ユーザーとデータベースの作成 への直接リンク">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- スーパーユーザー(postgres)でログイン</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u postgres psql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 管理者ユーザーの作成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> ROLE admin_user </span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PASSWORD </span><span class="token string" style="color:#e3116c">&#x27;secure_password_here&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CREATEDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CREATEROLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">REPLICATION</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- アプリケーションユーザーの作成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> ROLE myapp_user </span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PASSWORD </span><span class="token string" style="color:#e3116c">&#x27;app_password_here&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 読み取り専用ユーザーの作成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> ROLE readonly_user </span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PASSWORD </span><span class="token string" style="color:#e3116c">&#x27;readonly_password_here&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- データベースの作成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> myapp_prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OWNER myapp_user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ENCODING </span><span class="token string" style="color:#e3116c">&#x27;UTF8&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LC_COLLATE </span><span class="token string" style="color:#e3116c">&#x27;C.UTF-8&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LC_CTYPE </span><span class="token string" style="color:#e3116c">&#x27;C.UTF-8&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TEMPLATE template0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- データベースへの接続権限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CONNECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> myapp_prod </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> readonly_user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- スキーマの作成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\c myapp_prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SCHEMA</span><span class="token plain"> app </span><span class="token keyword" style="color:#00009f">AUTHORIZATION</span><span class="token plain"> myapp_user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 読み取り専用ユーザーへの権限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">USAGE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SCHEMA</span><span class="token plain"> app </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> readonly_user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIVILEGES</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">IN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SCHEMA</span><span class="token plain"> app </span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLES</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> readonly_user</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-拡張機能のインストール">6.2 拡張機能のインストール<a href="#62-拡張機能のインストール" class="hash-link" aria-label="6.2 拡張機能のインストール への直接リンク" title="6.2 拡張機能のインストール への直接リンク">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- よく使う拡張機能</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\c myapp_prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- UUID生成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> EXTENSION </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;uuid-ossp&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 暗号化関数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> EXTENSION </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> pgcrypto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 統計情報</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> EXTENSION </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> pg_stat_statements</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- トリグラム (あいまい検索)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> EXTENSION </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> pg_trgm</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- テーブル肥大化確認</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> EXTENSION </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> pgstattuple</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- インストール済み拡張の確認</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\dx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-pg_stat_statements-の設定">6.3 pg_stat_statements の設定<a href="#63-pg_stat_statements-の設定" class="hash-link" aria-label="6.3 pg_stat_statements の設定 への直接リンク" title="6.3 pg_stat_statements の設定 への直接リンク">​</a></h3>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># postgresql.conf に追加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shared_preload_libraries = &#x27;pg_stat_statements&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># pg_stat_statements の設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pg_stat_statements.max = 10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pg_stat_statements.track = all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pg_stat_statements.track_utility = on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pg_stat_statements.track_planning = on</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 設定変更後は再起動が必要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart postgresql-16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-本番環境向けチェックリスト">7. 本番環境向けチェックリスト<a href="#7-本番環境向けチェックリスト" class="hash-link" aria-label="7. 本番環境向けチェックリスト への直接リンク" title="7. 本番環境向けチェックリスト への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-セキュリティチェック">7.1 セキュリティチェック<a href="#71-セキュリティチェック" class="hash-link" aria-label="7.1 セキュリティチェック への直接リンク" title="7.1 セキュリティチェック への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  セキュリティチェックリスト                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────  ────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ postgres ユーザーのパスワード設定                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ trust 認証を使用していない                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ listen_addresses を必要最小限に制限                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ pg_hba.conf で接続元を制限                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ SSL/TLS を有効化                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ scram-sha-256 認証を使用                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ アプリケーションユーザーに最小権限                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ デフォルトの public スキーマ権限を制限                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ ログに接続情報を記録                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ ファイアウォールでポートを制限                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-パフォーマンスチェック">7.2 パフォーマンスチェック<a href="#72-パフォーマンスチェック" class="hash-link" aria-label="7.2 パフォーマンスチェック への直接リンク" title="7.2 パフォーマンスチェック への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                パフォーマンスチェックリスト                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ shared_buffers を適切に設定 (総メモリの25%)               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ effective_cache_size を設定 (総メモリの75%)               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ work_mem を設定 (負荷テストで調整)                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ maintenance_work_mem を設定                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ SSDの場合 random_page_cost を調整                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ checkpoint_timeout, max_wal_size を調整                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ 並列クエリを有効化                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ pg_stat_statements を有効化                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ スロークエリログを有効化                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ Autovacuum が有効                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="73-可用性チェック">7.3 可用性チェック<a href="#73-可用性チェック" class="hash-link" aria-label="7.3 可用性チェック への直接リンク" title="7.3 可用性チェック への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌───────────────────────────────────  ───────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  可用性チェックリスト                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ data_checksums が有効                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ アーカイブモードが有効                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ レプリケーションが設定済み                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ バックアップスクリプトが設定済み                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ バックアップのリストアテスト実施                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ 監視が設定済み                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ アラートが設定済み                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ 障害時の手順書作成                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  □ 自動起動が有効 (systemctl enable)                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="74-現在の設定確認クエリ">7.4 現在の設定確認クエリ<a href="#74-現在の設定確認クエリ" class="hash-link" aria-label="7.4 現在の設定確認クエリ への直接リンク" title="7.4 現在の設定確認クエリ への直接リンク">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 主要な設定値の確認</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setting</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> short_desc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> pg_settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;max_connections&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;shared_buffers&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;effective_cache_size&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;work_mem&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;maintenance_work_mem&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;wal_level&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;max_wal_senders&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;max_replication_slots&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;checkpoint_timeout&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;max_wal_size&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;random_page_cost&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;effective_io_concurrency&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;autovacuum&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;log_min_duration_statement&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- data_checksums の確認</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SHOW</span><span class="token plain"> data_checksums</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 現在の接続数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> pg_stat_activity</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- データベースサイズ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> pg_database</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pg_size_pretty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pg_database_size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pg_database</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> pg_database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> pg_database_size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pg_database</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DESC</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考リンク">参考リンク<a href="#参考リンク" class="hash-link" aria-label="参  考リンク への直接リンク" title="参考リンク への直接リンク">​</a></h2>
<ul>
<li><a href="https://www.postgresql.org/docs/current/runtime-config.html" target="_blank" rel="noopener noreferrer">PostgreSQL公式ドキュメント - サーバー設定</a></li>
<li><a href="https://www.postgresql.org/docs/current/client-authentication.html" target="_blank" rel="noopener noreferrer">PostgreSQL公式ドキュメント - クライアント認証</a></li>
<li><a href="https://pgtune.leopard.in.ua/" target="_blank" rel="noopener noreferrer">PGTune - 設定値計算ツール</a></li>
<li><a href="https://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server" target="_blank" rel="noopener noreferrer">PostgreSQL Wiki - Tuning Your PostgreSQL Server</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/11-postgresql/dba-01-installation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_11_learning/postgresql/dba-00-managed-vs-self-hosted"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">PostgreSQL: マネージドサービス vs セルフホスト比較ガイド</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_11_learning/postgresql/dba-02-backup-recovery"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">PostgreSQL バックアップとリカバリガイド</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目次" class="table-of-contents__link toc-highlight">目次</a></li><li><a href="#1-インストール方法" class="table-of-contents__link toc-highlight">1. インストール方法</a><ul><li><a href="#11-インストール方法の比較" class="table-of-contents__link toc-highlight">1.1 インストール方法の比較</a></li><li><a href="#12-linux-rhelcentosrocky-linux" class="table-of-contents__link toc-highlight">1.2 Linux (RHEL/CentOS/Rocky Linux)</a></li><li><a href="#13-linux-ubuntudebian" class="table-of-contents__link toc-highlight">1.3 Linux (Ubuntu/Debian)</a></li><li><a href="#14-macos" class="table-of-contents__link toc-highlight">1.4 macOS</a></li><li><a href="#15-docker" class="table-of-contents__link toc-highlight">1.5 Docker</a></li></ul></li><li><a href="#2-データベースクラスタの初期化" class="table-of-contents__link toc-highlight">2. データベースクラスタの初期化</a><ul><li><a href="#21-initdb-の実行" class="table-of-contents__link toc-highlight">2.1 initdb の実行</a></li><li><a href="#22-initdb-のオプション" class="table-of-contents__link toc-highlight">2.2 initdb のオプション</a></li><li><a href="#23-本番環境向け-initdb-例" class="table-of-contents__link toc-highlight">2.3 本番環境向け initdb 例</a></li><li><a href="#24-データディレクトリの構造" class="table-of-contents__link toc-highlight">2.4 データディレクトリの構造</a></li></ul></li><li><a href="#3-postgresqlconf-の設定" class="table-of-contents__link toc-highlight">3. postgresql.conf の設定</a><ul><li><a href="#31-設定ファイルの概要" class="table-of-contents__link toc-highlight">3.1 設定ファイルの概要</a></li><li><a href="#32-接続設定" class="table-of-contents__link toc-highlight">3.2 接続設定</a></li><li><a href="#33-メモリ設定" class="table-of-contents__link toc-highlight">3.3 メモリ設定</a></li><li><a href="#34-wal設定" class="table-of-contents__link toc-highlight">3.4 WAL設定</a></li><li><a href="#35-レプリケーション設定" class="table-of-contents__link toc-highlight">3.5 レプリケーション設定</a></li><li><a href="#36-並列クエリ設定" class="table-of-contents__link toc-highlight">3.6 並列クエリ設定</a></li><li><a href="#37-vacuum--autovacuum設定" class="table-of-contents__link toc-highlight">3.7 VACUUM / Autovacuum設定</a></li><li><a href="#38-ログ設定" class="table-of-contents__link toc-highlight">3.8 ログ設定</a></li><li><a href="#39-統計情報設定" class="table-of-contents__link toc-highlight">3.9 統計情報設定</a></li><li><a href="#310-ssd向け設定" class="table-of-contents__link toc-highlight">3.10 SSD向け設定</a></li></ul></li><li><a href="#4-pg_hbaconf-の設定" class="table-of-contents__link toc-highlight">4. pg_hba.conf の設定</a><ul><li><a href="#41-pg_hbaconf-の構造" class="table-of-contents__link toc-highlight">4.1 pg_hba.conf の構造</a></li><li><a href="#42-本番環境向け-pg_hbaconf-例" class="table-of-contents__link toc-highlight">4.2 本番環境向け pg_hba.conf 例</a></li><li><a href="#43-設定変更の反映" class="table-of-contents__link toc-highlight">4.3 設定変更の反映</a></li></ul></li><li><a href="#5-サービスの起動と管理" class="table-of-contents__link toc-highlight">5. サービスの起動と管理</a><ul><li><a href="#51-systemd-での管理" class="table-of-contents__link toc-highlight">5.1 systemd での管理</a></li><li><a href="#52-pg_ctl-での管理" class="table-of-contents__link toc-highlight">5.2 pg_ctl での管理</a></li><li><a href="#53-停止モードの違い" class="table-of-contents__link toc-highlight">5.3 停止モードの違い</a></li></ul></li><li><a href="#6-初期セットアップ作業" class="table-of-contents__link toc-highlight">6. 初期セットアップ作業</a><ul><li><a href="#61-初期ユーザーとデータベースの作成" class="table-of-contents__link toc-highlight">6.1 初期ユーザーとデータベースの作成</a></li><li><a href="#62-拡張機能のインストール" class="table-of-contents__link toc-highlight">6.2 拡張機能のインストール</a></li><li><a href="#63-pg_stat_statements-の設定" class="table-of-contents__link toc-highlight">6.3 pg_stat_statements の設定</a></li></ul></li><li><a href="#7-本番環境向けチェックリスト" class="table-of-contents__link toc-highlight">7. 本番環境向けチェックリスト</a><ul><li><a href="#71-セキュリティチェック" class="table-of-contents__link toc-highlight">7.1 セキュリティチェック</a></li><li><a href="#72-パフォーマンスチェック" class="table-of-contents__link toc-highlight">7.2 パフォーマンスチェック</a></li><li><a href="#73-可用性チェック" class="table-of-contents__link toc-highlight">7.3 可用性チェック</a></li><li><a href="#74-現在の設定確認クエリ" class="table-of-contents__link toc-highlight">7.4 現在の設定確認クエリ</a></li></ul></li><li><a href="#参考リンク" class="table-of-contents__link toc-highlight">参考リンク</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>