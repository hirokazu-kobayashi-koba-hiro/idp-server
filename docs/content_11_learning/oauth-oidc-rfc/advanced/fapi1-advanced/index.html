<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">FAPI 1.0 Advanced Profile | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="FAPI 1.0 Advanced Profile | IdP-Server Documentation"><meta data-rh="true" name="description" content="FAPI 1.0 Advanced Profile は、決済や高額取引など高リスクな金融 API 向けのセキュリティプロファイルです。"><meta data-rh="true" property="og:description" content="FAPI 1.0 Advanced Profile は、決済や高額取引など高リスクな金融 API 向けのセキュリティプロファイルです。"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.0c7304c1.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.d15b92d2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">アイデンティティ管理の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-fundamentals/modern-web-authz-authn">OAuth 2.0の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-tokens/id-token-jwt">OAuth 2.0トークン</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/openid-connect/oauth-oidc-basics">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-architecture-rp-browser-authenticator">FIDO2/WebAuthn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/security/glossary">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/multi-tenancy/multi-tenancy-basics">マルチテナント</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/advanced-protocols/ciba-basics">高度なプロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/http-rest/http-basics">HTTP/REST</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jwt-jose/jwt-introduction">JWT/JOSE</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth/OIDC RFC学習</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth 2.0 / OpenID Connect RFC 学習ガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/core/rfc6749-oauth2-core">基礎（OAuth 2.0 Core）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/jose/rfc7515-jws">JWT/JOSE（署名・暗号化）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/client-auth/rfc7521-assertion-framework">クライアント認証</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/extensions/rfc7009-revocation">OAuth 2.0 拡張</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/oidc/back-channel-logout">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/security/attack-patterns">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced">高度なプロトコル</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced">FAPI 1.0 Advanced Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-baseline">FAPI 1.0 Baseline Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi2-security">FAPI 2.0 Security Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/grant-management">OAuth 2.0 Grant Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/oidc-ciba">OpenID Connect CIBA（Client-Initiated Backchannel Authentication）</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced-identity/oid4vci">Advanced Identity</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/verifiable-credentials/">Verifiable Credentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/data-formats/">データフォーマット</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/web-session-basics">セッション管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/crypto/">暗号化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/kubernetes/">コンテナ/Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/linux/">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/networking/">ネットワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/">JVM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/java/">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/os-fundamentals/">OS基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/frameworks/">フレームワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/sdk/">SDK</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/clean-architecture/">クリーンアーキテクチャ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/">パフォーマンス・チューニング</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">学習（Learning）</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">OAuth/OIDC RFC学習</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">高度なプロトコル</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">FAPI 1.0 Advanced Profile</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>FAPI 1.0 Advanced Profile</h1></header>
<p>FAPI 1.0 Advanced Profile は、決済や高額取引など高リスクな金融 API 向けのセキュリティプロファイルです。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="目次">目次<a href="#目次" class="hash-link" aria-label="目次 への直接リンク" title="目次 への直接リンク">​</a></h2>
<ol>
<li><a href="#%E7%AC%AC1%E9%83%A8-%E6%A6%82%E8%A6%81%E7%B7%A8">第1部: 概要編</a></li>
<li><a href="#%E7%AC%AC2%E9%83%A8-%E8%A9%B3%E7%B4%B0%E7%B7%A8">第2部: 詳細編</a></li>
<li><a href="#%E7%AC%AC3%E9%83%A8-%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3">第3部: セキュリティ</a></li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第1部-概要編">第1部: 概要編<a href="#第1部-概要編" class="hash-link" aria-label="第1部: 概要編 への直接リンク" title="第1部: 概要編 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-profile-とは">Advanced Profile とは？<a href="#advanced-profile-とは" class="hash-link" aria-label="Advanced Profile とは？ への直接リンク" title="Advanced Profile とは？ への直接リンク">​</a></h3>
<p>Advanced Profile は、Baseline Profile の要件に加えて、より強力なセキュリティ対策を要求するプロファイルです。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FAPI 1.0 Advanced の追加要件:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Baseline:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✓ PKCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✓ state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✓ nonce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✓ 機密クライアント推奨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Advanced（追加）:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  + private_key_jwt または mTLS 必須</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  + Request Object 必須</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  + s_hash / c_hash 検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  + JARM または Hybrid Flow + ID Token 検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  + Sender-Constrained Access Tokens</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="なぜ-advanced-profile-が必要なのか">なぜ Advanced Profile が必要なのか？<a href="#なぜ-advanced-profile-が必要なのか" class="hash-link" aria-label="なぜ Advanced Profile が必要なのか？ への直接リンク" title="なぜ Advanced Profile が必要な のか？ への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="背景と歴史">背景と歴史<a href="#背景と歴史" class="hash-link" aria-label="背景と歴史 への直接リンク" title="背景と歴史 への直接リンク">​</a></h4>
<p>2016年頃、オープンバンキング規制が本格化する中で、読み取り専用API（Baseline）だけでなく、**書き込みAPI（決済、送金等）**にも対応する必要が出てきました。しかし、Baselineレベルのセキュリティでは以下のリスクに対処できませんでした：</p>
<table><thead><tr><th>リスク</th><th>Baseline の限界</th><th>Advanced の解決策</th></tr></thead><tbody><tr><td><strong>認可リクエストの改ざん</strong></td><td>URL パラメータは改ざん可能</td><td>Request Object（署名付きJWT）で保護</td></tr><tr><td><strong>認可レスポンスの改ざん</strong></td><td>code と state は保護されない</td><td>JARM で JWT として保護</td></tr><tr><td><strong>トークン盗難</strong></td><td>Bearer トークンは誰でも使用可能</td><td>mTLS でトークンをクライアントにバインド</td></tr><tr><td><strong>Mix-Up 攻撃</strong></td><td>複数ASの環境で混乱の可能性</td><td>iss パラメータと ID Token で検証</td></tr></tbody></table>
<p>FAPI 1.0 Advanced は 2019年に Final 仕様として承認され、現在、世界中の決済APIで採用されています。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="脅威モデル">脅威モデル<a href="#脅威モデル" class="hash-link" aria-label="脅威モデル への直接リンク" title="脅威モデル への直接リンク">​</a></h4>
<p>FAPI Advanced が対処する主な脅威：</p>
<ol>
<li>
<p><strong>認可リクエスト改ざん攻撃</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">攻撃シナリオ:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. クライアントが認可リクエストを送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /authorize?client_id=client1&amp;scope=payment&amp;amount=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 攻撃者が中間でパラメータを改ざん</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /authorize?client_id=client1&amp;scope=payment&amp;amount=10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. ユーザーが改ざんされた内容で認可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. 攻撃者が10000の送金を実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">対策: Request Object（署名付きJWT）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- すべてのパラメータをJWTに含めて署名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ASがJWTの署名を検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 改ざんは検出される</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>認可レスポンス改ざん攻撃</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">攻撃シナリオ:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. ASが認可コードを発行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /callback?code=CODE1&amp;state=STATE1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 攻撃者がcodeを差し替え</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /callback?code=CODE2&amp;state=STATE1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. クライアントが攻撃者のcodeでトークン取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. 攻撃者のアカウントにアクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">対策: JARM または Hybrid Flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 認可レスポンスをJWTで保護</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- クライアントがJWTの署名を検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 改ざんは検出される</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>トークン盗難攻撃</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">攻撃シナリオ:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. 攻撃者がアクセストークンを盗難</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   (ネットワーク盗聴、ログ漏洩等)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 攻撃者が盗んだトークンでAPIにアクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. 成功（Bearer トークンは誰でも使用可能）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">対策: mTLS Certificate-Bound Tokens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- アクセストークンをクライアント証明書にバインド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- APIアクセス時に同じ証明書が必要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 盗んだトークンだけでは使用不可</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Mix-Up 攻撃</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">攻撃シナリオ:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. クライアントが複数のASに対応</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 攻撃者が悪意あるASを用意</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. ユーザーがAS1を選択</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. 攻撃者がAS2のレスポンスに差し替え</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. クライアントがAS2のcodeをAS1に送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. 攻撃成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">対策: iss パラメータ + ID Token検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- レスポンスにissパラメータを含める</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- クライアントがASを検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Mix-Upは検出される</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="用途">用途<a href="#用途" class="hash-link" aria-label="用途 への直接リンク" title="用途 への直接リンク">​</a></h3>
<table><thead><tr><th>用途</th><th>プロファイル</th><th>理由</th></tr></thead><tbody><tr><td>残高照会</td><td>Baseline</td><td>読み取り専用、情報漏洩のリスクのみ</td></tr><tr><td>取引履歴</td><td>Baseline</td><td>読み取り専用、情報漏洩のリスクのみ</td></tr><tr><td><strong>送金・決済</strong></td><td><strong>Advanced</strong></td><td><strong>書き込み、金銭的損失のリスク</strong></td></tr><tr><td><strong>口座開設</strong></td><td><strong>Advanced</strong></td><td><strong>個人情報の変更、なりすましリスク</strong></td></tr><tr><td><strong>個人情報変更</strong></td><td><strong>Advanced</strong></td><td><strong>重要情報の変更、なりすましリスク</strong></td></tr><tr><td><strong>定期支払い設定</strong></td><td><strong>Advanced</strong></td><td><strong>継続的な金銭的影響</strong></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="実際のユースケース">実際のユースケース<a href="#実際のユースケース" class="hash-link" aria-label="実際のユースケース への直接リンク" title="実際のユースケース への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ユースケース1-オープンバンキング決済advanced-適用">ユースケース1: オープンバンキング決済（Advanced 適用）<a href="#ユースケース1-オープンバンキング決済advanced-適用" class="hash-link" aria-label="ユースケース1: オープンバンキング決済（Advanced 適用） への直接リンク" title="ユースケース1: オープンバンキング決済（Advanced 適用） への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">シナリオ:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ユーザーがECサイトで商品を購入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ECサイトが銀行APIで決済を実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - 金額: 50,000円</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - リスクレベル: 高（金銭的損失のリスク）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Advanced が必要な理由:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. Request Object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 金額、送金先を署名付きJWTで保護</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 攻撃者が金額を改ざんできない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. JARM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 認可レスポンスを改ざんから保護</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 攻撃者がcodeを差し替えできない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3. mTLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - アクセストークンをクライアントにバインド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - トークンを盗まれても使用不可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4. private_key_jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - クライアント認証を強化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - なりすましを防止</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ユースケース2-投資取引advanced-適用">ユースケース2: 投資取引（Advanced 適用）<a href="#ユースケース2-投資取引advanced-適用" class="hash-link" aria-label="ユースケース2: 投資取引（Advanced 適用） への直接リンク" title="ユースケース2: 投資取引（Advanced 適用） への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">シ ナリオ:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ユーザーが投資アプリで株式を購入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - アプリが証券会社APIで取引を実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - リスクレベル: 極めて高（金銭的損失 + 法的問題）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Advanced のセキュリティ対策:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. Request Object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 銘柄、株数、価格を改ざん不可に</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 取引内容の完全性を保証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. mTLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - トークンバインディングで盗難対策</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 二次利用を防止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3. 短い有効期限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - アクセストークン: 5分</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 攻撃の時間窓を最小化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4. トランザクション単位の認可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 1取引ごとに認可を取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 不正取引を防止</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fapi-advanced-の規制対応">FAPI Advanced の規制対応<a href="#fapi-advanced-の規制対応" class="hash-link" aria-label="FAPI Advanced の規制対応 への直接リンク" title="FAPI Advanced の規制対応 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="世界各国の規制">世界各国の規制<a href="#世界各国の規制" class="hash-link" aria-label="世界各国の規制 への直接リンク" title="世界各国の規制 への直接リンク">​</a></h4>
<table><thead><tr><th>地域/国</th><th>規制名</th><th>FAPI 採用</th><th>主な要件</th></tr></thead><tbody><tr><td><strong>欧州</strong></td><td>PSD2</td><td>✅</td><td>強い顧客認証（SCA）、API公開義務</td></tr><tr><td><strong>英国</strong></td><td>Open Banking Standard</td><td>✅</td><td>FAPI Advanced 必須（決済）</td></tr><tr><td><strong>オーストラリア</strong></td><td>Consumer Data Right (CDR)</td><td>✅</td><td>FAPI Advanced 準拠</td></tr><tr><td><strong>ブラジル</strong></td><td>Open Banking Brasil</td><td>✅</td><td>FAPI Advanced 必須</td></tr><tr><td><strong>日本</strong></td><td>オープンAPI規制</td><td>推奨</td><td>金融機関のAPI公開推奨</td></tr><tr><td><strong>シンガポール</strong></td><td>MAS API Standards</td><td>推奨</td><td>FAPI準拠を推奨</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="psd2-との関係">PSD2 との関係<a href="#psd2-との関係" class="hash-link" aria-label="PSD2 との関係 への直接リンク" title="PSD2 との関係 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PSD2（決済サービス指令第2版）の要件:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. 強い顧客認証（SCA）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - FAPI Advanced: 署名付きRequest Object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 認証内容の完全性を保証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. API公開義務</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - FAPI Advanced: 標準化されたセキュリティプロファイル</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 異なる銀行間での互換性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. 取引の非否認性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - FAPI Advanced: mTLS + private_key_jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - クライアントの確実な識別</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. データ保護</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - FAPI Advanced: トークンバインディング</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - トークン盗難時の被害最小化</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第2部-詳細編">第2部: 詳細編<a href="#第2部-詳細編" class="hash-link" aria-label="第2部: 詳細編 への直接リンク" title="第2部: 詳細編 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-object必須">Request Object（必須）<a href="#request-object必須" class="hash-link" aria-label="Request Object（必須） への直接リンク" title="Request Object（必須） への直接リンク">​</a></h3>
<p>Request Object は、認可リクエストのパラメータを署名付き JWT で送信する仕組みです。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="request-object-の構造">Request Object の構造<a href="#request-object-の構造" class="hash-link" aria-label="Request Object の構造 への直接リンク" title="Request Object の構造 への直接リンク">​</a></h4>
<table><thead><tr><th>クレーム</th><th>必須</th><th>説明</th></tr></thead><tbody><tr><td><code>iss</code></td><td>✅</td><td>発行者（client_id）</td></tr><tr><td><code>aud</code></td><td>✅</td><td>対象者（AS の URL）</td></tr><tr><td><code>response_type</code></td><td>✅</td><td>レスポンスタイプ</td></tr><tr><td><code>client_id</code></td><td>✅</td><td>クライアント ID</td></tr><tr><td><code>redirect_uri</code></td><td>✅</td><td>リダイレクト URI</td></tr><tr><td><code>scope</code></td><td>✅</td><td>スコープ</td></tr><tr><td><code>state</code></td><td>✅</td><td>CSRF 対策</td></tr><tr><td><code>nonce</code></td><td>✅</td><td>リプレイ防止</td></tr><tr><td><code>exp</code></td><td>✅</td><td>有効期限（通常5分）</td></tr><tr><td><code>iat</code></td><td>✅</td><td>発行時刻</td></tr><tr><td><code>nbf</code></td><td>推奨</td><td>有効開始時刻</td></tr><tr><td><code>jti</code></td><td>推奨</td><td>JWT ID（リプレイ防止）</td></tr><tr><td><code>claims</code></td><td>△</td><td>要求するクレーム</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="request-object-の生成例">Request Object の生  成例<a href="#request-object-の生成例" class="hash-link" aria-label="Request Object の生成例 への直接リンク" title="Request Object の生成例 への直接リンク">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="送信方法">送信方法<a href="#送信方法" class="hash-link" aria-label="送信方法 への直接リンク" title="送信方法 への直接リンク">​</a></h4>
<p><strong>方法 1: request パラメータ</strong></p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /authorize?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_id=s6BhdRkqt3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &amp;request=eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意: Request Object が大きい場合、URL が長くなりすぎる可能性があります。</p>
<p><strong>方法 2: request_uri パラメータ（PAR 推奨）</strong></p>
<p>Pushed Authorization Requests (PAR) を使用します。</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /par HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: auth.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request=eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;client_id=s6BhdRkqt3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;client_assertion=eyJhbGciOiJQUzI1NiIs...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>レスポンス:</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 201 Created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;request_uri&quot;: &quot;urn:ietf:params:oauth:request_uri:6esc_11ACC5bwc014ltc14eY22c&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;expires_in&quot;: 90</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>認可リクエスト:</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /authorize?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_id=s6BhdRkqt3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &amp;request_uri=urn:ietf:params:oauth:request_uri:6esc_11ACC5bwc014ltc14eY22c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>PAR のメリット</strong>:</p>
<ul>
<li>URL の長さ制限を回避</li>
<li>リクエストの機密性（直接ブラウザに渡らない）</li>
<li>クライアント認証が可能</li>
<li>リプレイ攻撃防止（短い有効期限）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="request-object-の検証as側">Request Object の検証（AS側）<a href="#request-object-の検証as側" class="hash-link" aria-label="Request Object の検証（AS側） への直接リンク" title="Request Object の検証（AS側） への直接リンク">​</a></h4>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="認可レスポンスの保護">認可レスポンスの保護<a href="#認可レスポンスの保護" class="hash-link" aria-label="認可レスポンスの保護 への直接リンク" title="認可レスポンスの保護 への直接リンク">​</a></h3>
<p>Advanced Profile では、認可レスポンスを保護する必要があります。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="方法-1-jarmjwt-secured-authorization-response-mode">方法 1: JARM（JWT Secured Authorization Response Mode）<a href="#方法-1-jarmjwt-secured-authorization-response-mode" class="hash-link" aria-label="方法 1: JARM（JWT Secured Authorization Response Mode） への直接リンク" title="方法 1: JARM（JWT Secured Authorization Response Mode） への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">認可レスポンスが JWT として返される:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET https://client.example.com/callback?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  response=eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eyJpc3MiOiJodHRwczovL2F1dGguZXhhbXBsZS5jb20iLCJhdWQiOiJzNkJoZFJrcXQzIiwiZXhwIjoxNzA0MTUzNjAwLCJjb2RlIjoiU3BseGxPQmVaUVFZYllTNld4U2JJQSIsInN0YXRlIjoiYWYwaWZqc2xka2oifQ.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JWT のペイロード:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;iss&quot;: &quot;https://auth.example.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;aud&quot;: &quot;s6BhdRkqt3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;exp&quot;: 1704153600,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;code&quot;: &quot;SplxlOBeZQQYbYS6WxSbIA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;state&quot;: &quot;af0ifjsldkj&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>JARM の response_mode:</p>
<table><thead><tr><th>モード</th><th>説明</th><th>フラグメント/クエリ</th></tr></thead><tbody><tr><td><code>query.jwt</code></td><td>JWT をクエリパラメータで返す</td><td>クエリ</td></tr><tr><td><code>fragment.jwt</code></td><td>JWT をフラグメントで返す</td><td>フラグメント</td></tr><tr><td><code>form_post.jwt</code></td><td>JWT をPOSTで返す</td><td>POST</td></tr><tr><td><code>jwt</code></td><td>デフォルト（response_type による）</td><td>自動</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="jarm-レスポンスの検証クライアント側">JARM レスポンスの検証（クライアント側）<a href="#jarm-レスポンスの検証クライアント側" class="hash-link" aria-label="JARM レスポンスの検証（クライアント側） への直接リンク" title="JARM レスポンスの検証（クライアント側） への直接リンク">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="方法-2-hybrid-flow--id-token-検証">方法 2: Hybrid Flow + ID Token 検証<a href="#方法-2-hybrid-flow--id-token-検証" class="hash-link" aria-label="方法 2: Hybrid Flow + ID Token 検証 への直接リンク" title="方法 2: Hybrid Flow + ID Token 検証 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">response_type=code id_token を使用:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET https://client.example.com/callback#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  code=SplxlOBeZQQYbYS6WxSbIA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &amp;id_token=eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &amp;state=af0ifjsldkj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ID Token で code を検証:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;iss&quot;: &quot;https://auth.example.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sub&quot;: &quot;user-123&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;aud&quot;: &quot;s6BhdRkqt3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;c_hash&quot;: &quot;LDktKdoQak3Pk0cnXxCltA&quot;,  ← code のハッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;s_hash&quot;: &quot;abc123...&quot;,                ← state のハッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;nonce&quot;: &quot;n-0S6_WzA2Mj&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;exp&quot;: 1704153600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c_hash の計算:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. code を ASCII オクテットとして取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. SHA-256 でハッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3. 左半分（128 ビット）を Base64URL エンコード</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="c_hash-と-s_hash-の検証実装">c_hash と s_hash の検証実装<a href="#c_hash-と-s_hash-の検証実装" class="hash-link" aria-label="c_hash と s_hash の検証実装 への直接リンク" title="c_hash と s_hash の検証実装 への直接リンク">​</a></h4>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sender-constrained-access-tokens">Sender-Constrained Access Tokens<a href="#sender-constrained-access-tokens" class="hash-link" aria-label="Sender-Constrained Access Tokens への直接リンク" title="Sender-Constrained Access Tokens への直接リンク">​</a></h3>
<p>アクセストークンをクライアントにバインドすることが必須です。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mtls-certificate-bound-tokens">mTLS Certificate-Bound Tokens<a href="#mtls-certificate-bound-tokens" class="hash-link" aria-label="mTLS Certificate-Bound Tokens への直接リンク" title="mTLS Certificate-Bound Tokens への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">フロー:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. クライアントが mTLS 接続でトークンリクエスト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - クライアント証明書を提示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. AS がアクセストークンを発行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - トークンに証明書のハッシュを含める</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. クライアントが mTLS 接続で API にアクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 同じクライアント証明書を提示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. API がトークンと証明書を検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - トークンの cnf.x5t#S256 と証明書のハッシュを比較</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 一致すればアクセス許可</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>アクセストークン（JWT）:</p>
<p>証明書のハッシュ計算:</p>
<p>リソースサーバーでの検証:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="クライアント認証必須">クライアント認証（必須）<a href="#クライアント認証必須" class="hash-link" aria-label="クライアント認証（必須） への直接リンク" title="クライアント認証（必須） への直接リンク">​</a></h3>
<p>Advanced Profile では、以下のクライアント認証方式のみ許可されます。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">許可される認証方式:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. private_key_jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 非対称鍵 JWT で認証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 秘密鍵はクライアントのみが保持</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. tls_client_auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - CA が発行した証明書で認  証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 証明書のサブジェクト DN で識別</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. self_signed_tls_client_auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 自己署名証明書で認証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 事前に公開鍵を登録</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">禁止される認証方式:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ client_secret_basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ client_secret_post</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ client_secret_jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ none</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="private_key_jwt-の詳 細実装">private_key_jwt の詳細実装<a href="#private_key_jwt-の詳細実装" class="hash-link" aria-label="private_key_jwt の詳細実装 への直接リンク" title="private_key_jwt の詳細実装 への直接リンク">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mtls-クライアント認証の実装">mTLS クライアント認証の実装<a href="#mtls-クライアント認証の実装" class="hash-link" aria-label="mTLS クライアント認証の実装 への直接リンク" title="mTLS クライアント認証の実装 への直接リンク">​</a></h4>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="署名アルゴリズム">署名アルゴリズム<a href="#署名アルゴリズム" class="hash-link" aria-label="署名アルゴリズム への直接リンク" title="署名アルゴリズム への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Advanced Profile で許可されるアルゴリズム:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ID トークン:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ PS256, PS384, PS512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ ES256, ES384, ES512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ RS256, RS384, RS512（禁止）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Request Object:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ PS256, PS384, PS512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ ES256, ES384, ES512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">クライアントアサーション:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ PS256, PS384, PS512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ ES256, ES384, ES512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JARM:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ PS256, PS384, PS512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ ES256, ES384, ES512</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>なぜ RS256 が禁止されるか？</strong></p>
<table><thead><tr><th>リスク</th><th>説明</th></tr></thead><tbody><tr><td>Bleichenbacher 攻撃</td><td>PKCS#1 v1.5 パディングの脆弱性</td></tr><tr><td>セキュリティマージンの低下</td><td>PSS パディングの方が安全</td></tr><tr><td>業界標準</td><td>金融業界では PSS が推奨</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="iss-パラメータmix-up-攻撃対策">iss パラメータ（Mix-Up 攻撃対策）<a href="#iss-パラメータmix-up-攻撃対策" class="hash-link" aria-label="iss パラメータ（Mix-Up 攻撃対策） への直接リンク" title="iss パラメータ（Mix-Up 攻撃対策） への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iss パラメータの目的:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Mix-Up攻撃の防止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - 複数ASに対応するクライアントの保護</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">認可レスポンス（issパラメータ付き）:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GET /callback?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    code=SplxlOBeZQQYbYS6WxSbIA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &amp;state=af0ifjsldkj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &amp;iss=https://auth.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">クライアントの検証:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. state を検証（CSRF防止）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. iss を検証（Mix-Up防止）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - 期待するASのissと一致するか</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3. トークンリクエストを送信</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>実装例:</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第3部-セキュリティ">第3部: セキュリティ<a href="#第3部-セキュリティ" class="hash-link" aria-label="第3部: セキュリティ への直接リンク" title="第3部: セキュリティ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="脅威モデルと攻撃シナリオ">脅威モデルと攻撃シナリオ<a href="#脅威モデルと攻撃シナリオ" class="hash-link" aria-label="脅威モデルと攻撃シナリオ への直接リンク" title="脅威モデルと攻撃シナリオ への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-request-object-の改ざん防止">1. Request Object の改ざん防止<a href="#1-request-object-の改ざん防止" class="hash-link" aria-label="1. Request Object の改ざん防止 への直接リンク" title="1. Request Object の改ざん防止 への直接リンク">​</a></h4>
<p><strong>攻撃シナリオと対策は第1部を参照</strong></p>
<p>実装のポイント:</p>
<ul>
<li>PS256 または ES256 で署名</li>
<li>有効期限を短く（5分）</li>
<li>jti でリプレイ防止</li>
<li>AS 側で署名を必ず検証</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-mtls-によるトークンバインディング">2. mTLS によるトークンバインディング<a href="#2-mtls-によるトークンバインディング" class="hash-link" aria-label="2. mTLS によるトークンバインディング への直接リンク" title="2. mTLS によるトークンバインディング への直接リンク">​</a></h4>
<p><strong>攻撃シナリオと対策は第1部を参照</strong></p>
<p>実装のポイント:</p>
<ul>
<li>証明書のハッシュを正しく計算（DER形式でSHA-256）</li>
<li>cnf クレームを必ず検証</li>
<li>API アクセス時に同じ証明書を使用</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-短い有効期限">3. 短い有効期限<a href="#3-短い有効期限" class="hash-link" aria-label="3. 短い有効期限 への直接リンク" title="3. 短い有効期限 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Advanced Profile の推奨有効期限:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| トークン/コード | 推奨有効期限 | 理由 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|---------------|------------|------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 認可コード | 1分 | 攻撃の時間窓を最小化 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| アクセストークン | 5-15分 | トークン盗難のリスク軽減 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| リフレッシュトークン | 使用後にローテーション | 長期的な盗難リスク軽減 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Request Object | 5分 | リプレイ攻撃防止 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| request_uri (PAR) | 90秒 | 一度のみ使用、短期間 |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-リフレッシュトークンローテーション">4. リフレッシュトークンローテーション<a href="#4-リフレッシュト ークンローテーション" class="hash-link" aria-label="4. リフレッシュトークンローテーション への直接リンク" title="4. リフレッシュトークンローテーション への直接リンク">​</a></h4>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="よくあるfapi-advanced要件違反とエラー">よくあるFAPI Advanced要件違反とエラー<a href="#よくあるfapi-advanced要件違反とエラー" class="hash-link" aria-label="よくあるFAPI Advanced要件違反とエラー への直接リンク" title="よくあるFAPI Advanced要件違反とエラー への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反1-request-object-の署名未検証">違反1: Request Object の署名未検証<a href="#違反1-request-object-の署名未検証" class="hash-link" aria-label="違反1: Request Object の署名未検証 への直接リンク" title="違反1: Request Object の署名未検証 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> <code>invalid_request_object</code>
<strong>セキュリティリスク:</strong> 認可リクエスト改ざん攻撃、パラメータ（金額・送金先等）の不正変更
<strong>FAPI要件:</strong> Request Objectは署名付きJWTで、ASは署名をPS256またはES256アルゴリズムで検証しなければならない
<strong>対策:</strong> クライアントの公開鍵を取得し、Request ObjectのJWT署名を検証する。検証失敗時は認可リクエストを拒否する</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反2-c_hashs_hash-の未検証">違反2: c_hash/s_hash の未検証<a href="#違反2-c_hashs_hash-の未検証" class="hash-link" aria-label="違反2: c_hash/s_hash の未検証 への直接リンク" title="違反2: c_hash/s_hash の未検証 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> なし（セキュリティ脅威のみ）
<strong>セキュリティリスク:</strong> 認可レスポンス改ざん攻撃、codeやstateの差し替え
<strong>FAPI要件:</strong> Hybrid Flow使用時、ID Token内の<code>c_hash</code>（codeのハッシュ）と<code>s_hash</code>（stateのハッシュ）を検証しなければならない
<strong>対策:</strong> ID Token受信時に、<code>c_hash</code>がSHA-256(code)の左半分のBase64URLと一致すること、<code>s_hash</code>がSHA-256(state)の左半分のBase64URLと一致することを確認する</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反3-mtls証明書バインディングの未実装">違反3: mTLS証明書バインディングの未実装<a href="#違反3-mtls証明書バインディングの未実装" class="hash-link" aria-label="違反3: mTLS証明書バインディングの未実装 への直接リンク" title="違反3: mTLS証明書バインディングの未実装 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> なし（セキュリティ脅威のみ）
<strong>セキュリティリスク:</strong> アクセストークン盗難時の不正利用
<strong>FAPI要件:</strong> アクセストークンはmTLS証明書にバインドし、トークンに証明書のハッシュ（<code>cnf.x5t#S256</code>）を含めなければならない
<strong>対策:</strong> トークン発行時にクライアント証明書のDER形式をSHA-256でハッシュ化し、アクセストークンの<code>cnf</code>クレームに含める。APIアクセス時に同じ証明書の提示を要求する</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反4-iss-パラメータの未検証">違反4: iss パラメータの未検証<a href="#違反4-iss-パラメータの未検証" class="hash-link" aria-label="違反4: iss パラメータの未検証 への直接リンク" title="違反4: iss パラメータの未検証 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> なし（セキュリティ脅威のみ）
<strong>セキュリティリスク:</strong> Mix-Up攻撃、複数AS環境での認可サーバー誤認
<strong>FAPI要件:</strong> 認可レスポンスに含まれる<code>iss</code>パラメータを検証し、期待する認可サーバーからのレスポンスであることを確認しなければならない
<strong>対策:</strong> 認可リクエスト時に期待するissuer値を記録し、コールバック時に認可レスポンスの<code>iss</code>パラメータと一致することを確認する</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="セキュリティベストプラクティス">セキュリティベストプラクティス<a href="#セキュリティベストプラクティス" class="hash-link" aria-label="セキュリティベストプラクティス への直接リンク" title="セキュリティベストプラクティス への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-request-object-の適切な実装">1. Request Object の適切な実装<a href="#1-request-object-の適切な実装" class="hash-link" aria-label="1. Request Object の適切な実装 への直接リンク" title="1. Request Object の適切な実装 への直接リンク">​</a></h4>
<p><strong>推奨事項:</strong></p>
<ul>
<li>PS256またはES256で署名</li>
<li>有効期限を短く設定（5分）</li>
<li>jtiでリプレイ防止</li>
<li>PARの使用を推奨</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-mtls-の適切な設定">2. mTLS の適切な設定<a href="#2-mtls-の適切な設定" class="hash-link" aria-label="2. mTLS の適切な設定 への直接リンク" title="2. mTLS の適切な設定 への直接リンク">​</a></h4>
<p><strong>推奨事項:</strong></p>
<ul>
<li>CA発行の証明書を使用</li>
<li>証明書の有効期限を定期的に更新</li>
<li>証明書のハッシュを正しく計算（DER形式）</li>
<li>リソースサーバーでも証明書検証を実施</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-トークン有効期限の最小化">3. トークン有効期限の最  小化<a href="#3-トークン有効期限の最小化" class="hash-link" aria-label="3. トークン有効期限の最小化 への直接リンク" title="3. トークン有効期限の最小化 への直接リンク">​</a></h4>
<p><strong>推奨値:</strong></p>
<table><thead><tr><th>トークン</th><th>推奨有効期限</th><th>理由</th></tr></thead><tbody><tr><td>認可コード</td><td>1分</td><td>攻撃の時間窓を最小化</td></tr><tr><td>アクセストークン</td><td>5-15分</td><td>mTLSバインディングで短くても安全</td></tr><tr><td>リフレッシュトークン</td><td>ローテーション必須</td><td>長期的な盗難リスク軽減</td></tr><tr><td>Request Object</td><td>5分</td><td>リプレイ攻撃防止</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-監査とログ">4. 監査とログ<a href="#4-監査とログ" class="hash-link" aria-label="4. 監査とログ への直接リンク" title="4. 監査とログ への直接リンク">​</a></h4>
<p><strong>記録すべき項目:</strong></p>
<ul>
<li>Request Objectの署名検証結果</li>
<li>mTLS証明書の検証結果</li>
<li>トークン発行・拒否</li>
<li>すべてのセキュリティエラー</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="セキュリティ理解度チェック">セキュリティ理解度チェック<a href="#セキュリティ理解度チェック" class="hash-link" aria-label="セキュリティ理解度チェック への直接リンク" title="セキュリティ理解度チェック への直接リンク">​</a></h3>
<p>この章を学習した後、以下を理解できているか確認してください：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="認可サーバーas">認可サーバー（AS）<a href="#認可サーバーas" class="hash-link" aria-label="認可サーバー（AS） への直接リンク" title="認可サーバー（AS） への直接リンク">​</a></h4>
<p>□ Request Object（署名付きJWT）が 認可リクエスト改ざん攻撃を防ぐ仕組みを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>攻撃シナリオ（Request Objectなし）</strong>:</p><ol>
<li>クライアントが認可リクエストを送信
<code>/authorize?client_id=client1&amp;scope=payment&amp;amount=100</code></li>
<li>攻撃者が中間でパラメータを改ざん
<code>/authorize?client_id=client1&amp;scope=payment&amp;amount=10000</code></li>
<li>ユーザーが改ざんされた内容で認可</li>
<li>攻撃者が10000の送金を実行</li>
</ol><p><strong>対策（Request Objectあり）</strong>:</p><ol>
<li>すべてのパラメータをJWTに含めて署名（PS256/ES256）</li>
<li>ASがJWTの署名を検証</li>
<li>署名が不正な場合は拒否</li>
<li>改ざんは検出される</li>
</ol><p><strong>FAPI Advanced要件</strong>:</p><ul>
<li>Request Object必須</li>
<li>PS256またはES256で署名</li>
<li>有効期限を短く（5分）</li>
<li>jtiでリプレイ防止</li>
</ul></div></div></details>
<p>□ mTLS Certificate-Bound Tokensがトークン盗難攻撃を防ぐ仕組みを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>攻撃シナリオ（通常のBearer Token）</strong>:</p><ol>
<li>攻撃者がアクセストークンを盗難（ネットワーク盗聴、ログ漏洩等）</li>
<li>攻撃者が盗んだトークンでAPIにアクセス</li>
<li>成功（Bearer トークンは誰でも使用可能）</li>
</ol><p><strong>対策（mTLS Certificate-Bound Tokens）</strong>:</p><ol>
<li>クライアントがmTLS接続でトークンリクエスト<!-- -->
<ul>
<li>クライアント証明書を提示</li>
</ul>
</li>
<li>ASがアクセストークンを発行<!-- -->
<ul>
<li>トークンに証明書のハッシュ（cnf.x5t#S256）を含める</li>
</ul>
</li>
<li>クライアントがmTLS接続でAPIにアクセス<!-- -->
<ul>
<li>同じクライアント証明書を提示</li>
</ul>
</li>
<li>APIがトークンと証明書を検証<!-- -->
<ul>
<li>トークンのcnf.x5t#S256と証明書のハッシュを比較</li>
<li>一致すればアクセス許可、不一致なら拒否</li>
</ul>
</li>
</ol><p><strong>効果</strong>:</p><ul>
<li>盗んだトークンだけでは使用不可</li>
<li>秘密鍵を持つクライアント証明書も必要</li>
</ul></div></div></details>
<p>□ c_hashとs_hashの計算方法と、これらが認可レスポンス改ざん攻撃を防ぐ仕組みを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>c_hash（codeのハッシュ）の計算</strong>:</p><ol>
<li>codeをASCIIオクテットとして取得</li>
<li>SHA-256でハッシュ</li>
<li>左半分（128ビット）をBase64URLエンコード</li>
<li>ID Tokenのc_hashクレームに含める</li>
</ol><p><strong>s_hash（stateのハッシュ）の計算</strong>:</p><ol>
<li>stateをASCIIオクテットとして取得</li>
<li>SHA-256でハッシュ</li>
<li>左半分（128ビット）をBase64URLエンコード</li>
<li>ID Tokenのs_hashクレームに含める</li>
</ol><p><strong>防ぐ攻撃（Hybrid Flow）</strong>:</p><ol>
<li>ASが認可レスポンスにcodeとID Tokenを含める</li>
<li>ID Tokenにc_hashとs_hashを含める</li>
<li>クライアントがID Tokenを受信</li>
<li>c_hashを計算して一致を確認<!-- -->
<ul>
<li>不一致ならcodeが改ざんされている</li>
</ul>
</li>
<li>s_hashを計算して一致を確認<!-- -->
<ul>
<li>不一致ならstateが改ざんされている</li>
</ul>
</li>
</ol><p><strong>FAPI Advanced要件</strong>:</p><ul>
<li>Hybrid Flow使用時は必須</li>
<li>JARM使用時も含めることを推奨</li>
</ul></div></div></details>
<p>  □ issパラメータがMix-Up攻撃を防ぐ仕組みを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>Mix-Up攻撃シナリオ（issパラメータなし）</strong>:</p><ol>
<li>クライアントが2つのAS（AS1, AS2）に対応</li>
<li>ユーザーがAS1を選択</li>
<li>攻撃者が悪意あるAS2を用意</li>
<li>認可レスポンスで攻撃者がAS2のcodeに差し替え</li>
<li>クライアントがAS2のcodeをAS1に送信
→ AS1がエラーを返すが、攻撃者が情報を取得</li>
</ol><p><strong>対策（issパラメータあり）</strong>:</p><ol>
<li>クライアントがAS1を選択</li>
<li>AS1が認可レスポンスに<code>iss=https://as1.example.com</code>を含める</li>
<li>クライアントがissを検証<!-- -->
<ul>
<li>期待値: <code>https://as1.example.com</code></li>
<li>実際の値: <code>https://as1.example.com</code></li>
<li>一致 → 検証成功</li>
</ul>
</li>
<li>トークンリクエストをAS1に送信</li>
</ol><p><strong>攻撃を試みた場合</strong>:
3. 攻撃者が<code>iss=https://as2.example.com</code>に差し替え
4. クライアントがissを検証</p><ul>
<li>期待値: <code>https://as1.example.com</code></li>
<li>実際の値: <code>https://as2.example.com</code></li>
<li>不一致 → 検証失敗、攻撃検出</li>
</ul><p><strong>FAPI要件</strong>:</p><ul>
<li>認可レスポンスにissパラメータ必須</li>
<li>クライアント側で必ず検証</li>
</ul></div></div></details>
<p>□ PAR（Pushed Authorization Requests）の利点とセキュリティ上のメリットを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>PARのフロー</strong>:</p><ol>
<li>クライアントがバックチャネルでPARエンドポイントにリクエスト<!-- -->
<ul>
<li>POST /par ですべての認可パラメータを送信</li>
<li>クライアント認証を実施</li>
</ul>
</li>
<li>ASがrequest_uriを返す</li>
<li>ブラウザにはrequest_uriのみを渡す<!-- -->
<ul>
<li>GET /authorize?request_uri=urn:...</li>
</ul>
</li>
<li>ASが保存済みのパラメータを使用</li>
</ol><p><strong>セキュリティ上のメリット</strong>:</p><ol>
<li>
<p><strong>パラメータ改ざん防止</strong></p>
<ul>
<li>バックチャネルで送信されるため、ブラウザでの改ざん不可</li>
</ul>
</li>
<li>
<p><strong>機密情報の保護</strong></p>
<ul>
<li>ブラウザに機密情報（金額、送金先等）が渡らない</li>
<li>URL履歴やリファラーヘッダーで漏洩しない</li>
</ul>
</li>
<li>
<p><strong>リプレイ攻撃防止</strong></p>
<ul>
<li>request_uriの有効期限が短い（90秒）</li>
<li>一度のみ使用可能</li>
</ul>
</li>
<li>
<p><strong>クライアント認証</strong></p>
<ul>
<li>PARリクエスト時にクライアント認証を実施</li>
<li>なりすましを防止</li>
</ul>
</li>
</ol><p><strong>FAPI Advanced推奨</strong>:</p><ul>
<li>PARの使用を強く推奨（必須ではない）</li>
<li>Request ObjectとPARの併用が理想</li>
</ul></div></div></details>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="クライアントrp">クライアント（RP）<a href="#クライアントrp" class="hash-link" aria-label="クライアント（RP） への直接リンク" title="クライアント（RP） への直接リンク">​</a></h4>
<p>□ private_key_jwtクライアント認証のJWT構造と署名検証の流れを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>JWTの構造</strong>:</p><p>ヘッダー:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;alg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PS256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;typ&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JWT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;kid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;client-key-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ペイロード:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;iss&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s6BhdRkqt3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sub&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s6BhdRkqt3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;aud&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://auth.example.com/token&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;jti&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;unique-jwt-id-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;exp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1704150300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;iat&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1704150000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>検証の流れ（AS側）</strong>:</p><ol>
<li>
<p><strong>JWTのデコード</strong></p>
<ul>
<li>ヘッダーとペイロードを分離</li>
</ul>
</li>
<li>
<p><strong>クレームの検証</strong></p>
<ul>
<li>iss/sub: client_idと一致するか</li>
<li>aud: トークンエンドポイントのURLと一致するか</li>
<li>exp: 有効期限内か（通常5分以内）</li>
<li>jti: 一意性（リプレイ防止）</li>
</ul>
</li>
<li>
<p><strong>署名の検証</strong></p>
<ul>
<li>クライアントの公開鍵を取得（JWKSエンドポイント）</li>
<li>PS256またはES256で署名を検証</li>
<li>検証成功ならクライアント認証成功</li>
</ul>
</li>
</ol><p><strong>FAPI Advanced要件</strong>:</p><ul>
<li>private_key_jwtまたはmTLS必須</li>
<li>PS256/ES256のみ許可</li>
<li>RS256禁止</li>
</ul></div></div></details>
<p>□ JARMとHybrid Flowの違い、およびそれぞれが適切なケースを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>JARM（JWT Secured Authorization Response Mode）</strong>:</p><p>仕組み:</p><ul>
<li>認可レスポンス全体がJWTとして返される</li>
<li>code、state等がJWT内に含まれる</li>
<li>クライアントがJWTの署名を検証</li>
</ul><p>レスポンス例:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /callback?response=eyJhbGciOiJQUzI1NiIs...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピ ー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>メリット:</p><ul>
<li>認可レスポンス全体を保護</li>
<li>実装がシンプル</li>
<li>フロントチャネルでも安全</li>
</ul><p><strong>Hybrid Flow（code id_token）</strong>:</p><p>仕組み:</p><ul>
<li>認可レスポンスにcodeとID Tokenを含める</li>
<li>ID Token内のc_hash/s_hashでcode/stateを検証</li>
</ul><p>レスポンス例:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /callback#code=CODE&amp;id_token=eyJhbGciOiJQUzI1NiIs...&amp;state=STATE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>メリット:</p><ul>
<li>ID Tokenで即座にユーザー情報取得</li>
<li>c_hash/s_hashでレスポンスの完全性を検証</li>
</ul><p><strong>適切なケース</strong>:</p><ul>
<li>JARM: シンプルな実装、最新の実装</li>
<li>Hybrid Flow: 既存のOIDC実装との互換性重視</li>
</ul><p><strong>FAPI Advanced要件</strong>:</p><ul>
<li>JARMまたはHybrid Flowのいずれか必須</li>
<li>両方の実装も可能</li>
</ul></div></div></details>
<p>□ リフレッシュトークンローテーションの仕組みと、これがトークン盗難リスクを軽減する理由を説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>リフレッシュトークンローテーションの仕組み</strong>:</p><ol>
<li>
<p>初回トークン発行</p>
<ul>
<li>access_token + refresh_token_1を発行</li>
</ul>
</li>
<li>
<p>トークンリフレッシュ（1回目）</p>
<ul>
<li>refresh_token_1を使用</li>
<li>新しいaccess_token + refresh_token_2を発行</li>
<li>refresh_token_1を無効化</li>
</ul>
</li>
<li>
<p>トークンリフレッシュ（2回目）</p>
<ul>
<li>refresh_token_2を使用</li>
<li>新しいaccess_token + refresh_token_3を発行</li>
<li>refresh_token_2を無効化</li>
</ul>
</li>
</ol><p><strong>盗難リスクの軽減</strong>:</p><p><strong>攻撃シナリオ（ローテーションなし）</strong>:</p><ol>
<li>攻撃者がrefresh_tokenを盗難</li>
<li>攻撃者が長期間トークンを更新可能</li>
<li>被害が継続</li>
</ol><p><strong>対策（ローテーションあり）</strong>:</p><ol>
<li>攻撃者がrefresh_token_1を盗難</li>
<li>正規のクライアントがrefresh_token_1を使用<!-- -->
<ul>
<li>refresh_token_1が無効化</li>
</ul>
</li>
<li>攻撃者がrefresh_token_1を使用試行<!-- -->
<ul>
<li>エラー（既に無効化）</li>
<li>ASが異常を検知</li>
<li>すべてのトークンを無効化（オプション）</li>
</ul>
</li>
</ol><p><strong>FAPI Advanced推奨</strong>:</p><ul>
<li>リフレッシュトークンローテーション必須</li>
<li>盗難検知時は全トークン無効化</li>
<li>短い有効期限（5-15分）</li>
</ul></div></div></details>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考リンク">参考リンク<a href="#参考リンク" class="hash-link" aria-label="参考リンク への直接リンク" title="参考リンク への直接リンク">​</a></h2>
<ul>
<li><a href="https://openid.net/specs/openid-financial-api-part-2-1_0.html" target="_blank" rel="noopener noreferrer">FAPI 1.0 Advanced Profile</a></li>
<li><a href="https://openid.net/specs/openid-financial-api-part-1-1_0.html" target="_blank" rel="noopener noreferrer">FAPI 1.0 Baseline Profile</a></li>
<li><a href="https://openid.net/specs/openid-financial-api-jarm-01.html" target="_blank" rel="noopener noreferrer">JWT Secured Authorization Response Mode (JARM)</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc9126" target="_blank" rel="noopener noreferrer">RFC 9126 - Pushed Authorization Requests (PAR)</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8705" target="_blank" rel="noopener noreferrer">RFC 8705 - OAuth 2.0 Mutual-TLS Client Authentication</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc9207" target="_blank" rel="noopener noreferrer">RFC 9207 - OAuth 2.0 Authorization Server Issuer Identification</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<p>FAPI 1.0 Advanced Profile は、決済や高額取引など高リスクな金融 API 向けの最高レベルのセキュリティプロファイルです。以下のポイントを押さえて実装してください：</p>
<ol>
<li><strong>Request Object の必須化</strong> - すべてのパラメータを署名付き JWT で保護</li>
<li><strong>認可レスポンスの保護</strong> - JARM または Hybrid Flow で改ざん検出</li>
<li><strong>トークンバインディング</strong> - mTLS でトークン盗難を防止</li>
<li><strong>クライアント認証の強化</strong> - private_key_jwt または mTLS のみ許可</li>
<li><strong>短い有効期限</strong> - 攻撃の時間窓を最小化</li>
<li><strong>iss パラメータ</strong> - Mix-Up 攻撃を防止</li>
</ol>
<p>FAPI Advanced は実装が複雑ですが、金融グレードのセキュリティを実現するために不可欠です。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/16-oauth-oidc-rfc/advanced/fapi1-advanced.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/security/token-security"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">トークンセキュリティ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-baseline"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">FAPI 1.0 Baseline Profile</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目次" class="table-of-contents__link toc-highlight">目次</a></li><li><a href="#第1部-概要編" class="table-of-contents__link toc-highlight">第1部: 概要編</a><ul><li><a href="#advanced-profile-とは" class="table-of-contents__link toc-highlight">Advanced Profile とは？</a></li><li><a href="#なぜ-advanced-profile-が必要なのか" class="table-of-contents__link toc-highlight">なぜ Advanced Profile が必要なのか？</a></li><li><a href="#用途" class="table-of-contents__link toc-highlight">用途</a></li><li><a href="#実際のユースケース" class="table-of-contents__link toc-highlight">実際のユースケース</a></li><li><a href="#fapi-advanced-の規制対応" class="table-of-contents__link toc-highlight">FAPI Advanced の規制対応</a></li></ul></li><li><a href="#第2部-詳細編" class="table-of-contents__link toc-highlight">第2部: 詳細編</a><ul><li><a href="#request-object必須" class="table-of-contents__link toc-highlight">Request Object（必須）</a></li><li><a href="#認可レスポンスの保護" class="table-of-contents__link toc-highlight">認可レスポンスの保護</a></li><li><a href="#sender-constrained-access-tokens" class="table-of-contents__link toc-highlight">Sender-Constrained Access Tokens</a></li><li><a href="#クライアント認証必須" class="table-of-contents__link toc-highlight">クライアント認証（必須）</a></li><li><a href="#署名アルゴリズム" class="table-of-contents__link toc-highlight">署名アルゴリズム</a></li><li><a href="#iss-パラメータmix-up-攻撃対策" class="table-of-contents__link toc-highlight">iss パラメータ（Mix-Up 攻撃対策）</a></li></ul></li><li><a href="#第3部-セキュリティ" class="table-of-contents__link toc-highlight">第3部: セキュリティ</a><ul><li><a href="#脅威モデルと攻撃シナリオ" class="table-of-contents__link toc-highlight">脅威モデルと攻撃シナリオ</a></li><li><a href="#よくあるfapi-advanced要件違反とエラー" class="table-of-contents__link toc-highlight">よくあるFAPI Advanced要件違反とエラー</a></li><li><a href="#セキュリティベストプラクティス" class="table-of-contents__link toc-highlight">セキュリティベストプラクティス</a></li><li><a href="#セキュリティ理解度チェック" class="table-of-contents__link toc-highlight">セキュリティ理解度チェック</a></li></ul></li><li><a href="#参考リンク" class="table-of-contents__link toc-highlight">参考リンク</a></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>