<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_11_learning/oauth-oidc-rfc/advanced/oidc-ciba" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">OpenID Connect CIBA（Client-Initiated Backchannel Authentication） | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/oidc-ciba"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="OpenID Connect CIBA（Client-Initiated Backchannel Authentication） | IdP-Server Documentation"><meta data-rh="true" name="description" content="CIBA は、ユーザーがクライアントデバイスとは別のデバイス（認証デバイス）で認証を行う「分離型」認証フローを定義した仕様です。"><meta data-rh="true" property="og:description" content="CIBA は、ユーザーがクライアントデバイスとは別のデバイス（認証デバイス）で認証を行う「分離型」認証フローを定義した仕様です。"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/oidc-ciba"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/oidc-ciba" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/oidc-ciba" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.e8840035.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.b70dab8e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">アイデンティティ管理の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-fundamentals/modern-web-authz-authn">OAuth 2.0の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-tokens/id-token-jwt">OAuth 2.0トークン</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/openid-connect/oauth-oidc-basics">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-architecture-rp-browser-authenticator">FIDO2/WebAuthn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/security/glossary">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/multi-tenancy/multi-tenancy-basics">マルチテナント</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/advanced-protocols/ciba-basics">高度なプロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/http-rest/http-basics">HTTP/REST</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jwt-jose/jwt-introduction">JWT/JOSE</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth/OIDC RFC学習</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth 2.0 / OpenID Connect RFC 学習ガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/core/rfc6749-oauth2-core">基礎（OAuth 2.0 Core）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/jose/rfc7515-jws">JWT/JOSE（署名・暗号化）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/client-auth/rfc7521-assertion-framework">クライアント認証</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/extensions/rfc7009-revocation">OAuth 2.0 拡張</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/oidc/back-channel-logout">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/security/attack-patterns">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced">高度なプロトコル</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-advanced">FAPI 1.0 Advanced Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi1-baseline">FAPI 1.0 Baseline Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/fapi2-security">FAPI 2.0 Security Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/grant-management">OAuth 2.0 Grant Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/oidc-ciba">OpenID Connect CIBA（Client-Initiated Backchannel Authentication）</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced-identity/oid4vci">Advanced Identity</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/verifiable-credentials/">Verifiable Credentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/data-formats/">データフォーマット</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/crypto/">暗号化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/kubernetes/">コンテナ/Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/linux/">Linux</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">学習（Learning）</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">OAuth/OIDC RFC学習</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">高度なプロトコル</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">OpenID Connect CIBA（Client-Initiated Backchannel Authentication）</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>OpenID Connect CIBA（Client-Initiated Backchannel Authentication）</h1></header>
<p>CIBA は、ユーザーがクライアントデバイスとは別のデバイス（認証デバイス）で認証を行う「分離型」認証フローを定義した仕様です。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="目次">目次<a href="#目次" class="hash-link" aria-label="目次 への直接リンク" title="目次 への直接リンク">​</a></h2>
<ol>
<li><a href="#%E7%AC%AC1%E9%83%A8-%E6%A6%82%E8%A6%81%E7%B7%A8">第1部: 概要編</a></li>
<li><a href="#%E7%AC%AC2%E9%83%A8-%E8%A9%B3%E7%B4%B0%E7%B7%A8">第2部: 詳細編</a></li>
<li><a href="#%E7%AC%AC3%E9%83%A8-%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3">第3部: セキュリティ</a></li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第1部-概要編">第1部: 概要編<a href="#第1部-概要編" class="hash-link" aria-label="第1部: 概要編 への直接リンク" title="第1部: 概要編 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ciba-とは">CIBA とは？<a href="#ciba-とは" class="hash-link" aria-label="CIBA とは？ への直接リンク" title="CIBA とは？ への直接リンク">​</a></h3>
<p>CIBA（Client-Initiated Backchannel Authentication）は、従来のリダイレクトベースの認証とは異なり、<strong>バックチャネル</strong>を通じて認証を開始するフローです。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">従来の認証フロー（リダイレクト）:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌────────┐     redirect     ┌────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Client │ ───────────────► │   OP   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │        │ ◄─────────────── │        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └────────┘     redirect     └────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └──── 同一デバイス ────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CIBA（分離型）:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌────────────────┐   backchannel   ┌────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Consumption    │ ───────────────► │   OP   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │    Device      │                  │        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └────────────────┘                  └────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          │ push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   ┌────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   │ Authentication │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   │    Device      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   │  （スマホ等）   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   └────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="なぜ-ciba-が必要なのか">なぜ CIBA が必要なのか？<a href="#なぜ-ciba-が必要なのか" class="hash-link" aria-label="なぜ CIBA が必要なのか？ への直接リンク" title="なぜ CIBA が必要なのか？ への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="背景と歴史">背景と歴史<a href="#背景と歴史" class="hash-link" aria-label="背景と歴史 への直接リンク" title="背景と歴史 への直接リンク">​</a></h4>
<p>従来の OAuth 2.0 / OpenID Connect では、認証はリダイレクトベースのフロントチャネルで行われます。この方式には以下の課題がありました：</p>
<table><thead><tr><th>課題</th><th>説明</th></tr></thead><tbody><tr><td>デバイス制約</td><td>画面やブラウザのないデバイス（POS、ATM）での認証が困難</td></tr><tr><td>ユーザビリティ</td><td>複数デバイスを持つユーザーが、常に同じデバイスで認証する必要がある</td></tr><tr><td>セキュリティ</td><td>共有端末での認証時にセッション情報が残る可能性</td></tr><tr><td>企業向けユースケース</td><td>コールセンターオペレーターが顧客を認証できない</td></tr></tbody></table>
<p>CIBA は 2019 年に OpenID Foundation によって策定され、これらの課題を解決するために<strong>認証デバイスと消費デバイスを分離</strong>する設計思想を導入しました。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="脅威モデル">脅威モデル<a href="#脅威モデル" class="hash-link" aria-label="脅威モデル への直接リンク" title="脅威モデル への直接リンク">​</a></h4>
<p>CIBA が対処する主な脅威：</p>
<ol>
<li>
<p><strong>共有デバイスのセッションハイジャック</strong></p>
<ul>
<li>従来: 認証後のブラウザセッションが残る</li>
<li>CIBA: 消費デバイスに認証情報が残らない</li>
</ul>
</li>
<li>
<p><strong>フィッシング攻撃</strong></p>
<ul>
<li>binding_message で取引内容を認証デバイスに表示</li>
<li>ユーザーが正当な取引であることを確認できる</li>
</ul>
</li>
<li>
<p><strong>中間者攻撃</strong></p>
<ul>
<li>バックチャネル通信は TLS で保護</li>
<li>クライアント認証が必須</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ユースケース">ユースケース<a href="#ユースケース" class="hash-link" aria-label="ユースケース への直接リンク" title="ユースケース への直接リンク">​</a></h3>
<table><thead><tr><th>ユースケース</th><th>説明</th><th>具体例</th></tr></thead><tbody><tr><td>コールセンター</td><td>オペレーターが顧客を認証</td><td>銀行のコールセンターで本人確認後、顧客のスマホに認証通知を送信</td></tr><tr><td>POS 端末</td><td>店舗端末での決済認証</td><td>レジ端末で決済時、顧客のスマホアプリで認証</td></tr><tr><td>ATM</td><td>銀行 ATM での本人確認</td><td>ATM で取引開始後、スマホアプリで承認</td></tr><tr><td>IoT デバイス</td><td>画面のないデバイスでの認証</td><td>スマートロックをスマホで認証して開錠</td></tr><tr><td>スマートスピーカー</td><td>音声デバイスでの認証</td><td>Alexa で買い物時、スマホで承認</td></tr><tr><td>カスタマーサポート</td><td>サポート担当が顧客を認証</td><td>ヘルプデスクで顧客情報にアクセスする前に顧客のスマホで本人確認</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="実際のユースケースシナリオ">実際のユースケースシナリオ<a href="#実際のユースケースシナリオ" class="hash-link" aria-label="実際のユースケースシナリオ への直接リンク" title="実際のユースケースシナリオ への直接リンク">​</a></h4>
<p><strong>シナリオ1: オープンバンキングでの決済承認</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. ユーザーが EC サイトで商品を購入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. EC サイト（RP）が銀行の決済 API を呼び出し</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. 銀行（AS）がユーザーのスマホアプリに push 通知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. ユーザーがスマホで取引内容を確認し、承認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. EC サイトが決済を完了</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>シナリオ2: コールセンターでの本人確認</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. 顧客が銀行のコールセンターに電話</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. オペレーターが CRM システムで顧客情報を入力</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. CRM システム（RP）が銀行の認証サーバー（AS）に CIBA リクエスト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. 顧客のスマホに「オペレーター山田太郎が情報にアクセスします」と通知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. 顧客がスマホで承認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. オペレーターが顧客情報にアクセス可能に</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ciba-と他の仕様との違い">CIBA と他の仕様との違い<a href="#ciba-と他の仕様との違い" class="hash-link" aria-label="CIBA と他の仕様との違い への直接リンク" title="CIBA と他の仕様との違い への直接リンク">​</a></h3>
<table><thead><tr><th>仕様</th><th>フロー</th><th>デバイス</th><th>主な用途</th></tr></thead><tbody><tr><td><strong>標準 Authorization Code Flow</strong></td><td>リダイレクト</td><td>同一</td><td>Web アプリ、モバイルアプリ</td></tr><tr><td><strong>CIBA</strong></td><td>バックチャネル</td><td>分離</td><td>POS、ATM、IoT、コールセンター</td></tr><tr><td><strong>Device Flow (RFC 8628)</strong></td><td>ポーリング</td><td>分離</td><td>スマートTV、CLI ツール</td></tr></tbody></table>
<p>CIBA と Device Flow の違い：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Device Flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. デバイスがコードを表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. ユーザーが別デバイスでコードを入力</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3. ユーザーが認証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → ユーザーアクションが必要（コード入力）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CIBA:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. クライアントが login_hint でユーザーを指定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. AS が直接ユーザーの認証デバイスに通知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3. ユーザーが認証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → ユーザーアクションが少ない（通知を承認するだけ）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3つのモード">3つのモード<a href="#3つのモード" class="hash-link" aria-label="3つのモード への直接リンク" title="3つのモード への直接リンク">​</a></h3>
<p>CIBA は3つの異なる配信モードをサポートします：</p>
<table><thead><tr><th>モード</th><th>待ち時間（目安）</th><th>クライアント要件</th><th>本当に必要なケース</th></tr></thead><tbody><tr><td><strong>Poll</strong></td><td>平均30秒<br>（interval × 試行回数）</td><td>公開エンドポイント<strong>不要</strong></td><td>・ファイアウォール内のシステム<br>・NAT配下のIoTデバイス<br>・モバイルアプリ（直接クライアント）<br>・インバウンド接続不可の環境</td></tr><tr><td><strong>Ping</strong></td><td>数秒以内</td><td>公開HTTPSエンドポイント<strong>必須</strong></td><td>・Webアプリのバックエンドサーバー<br>・APIサーバー<br>・常時稼働するサービス</td></tr><tr><td><strong>Push</strong></td><td>即座</td><td>公開HTTPSエンドポイント<strong>必須</strong></td><td>・セキュアな内部ネットワーク（VPN等）<br>・信頼された環境のみ<br>（実際にはPingで十分なケースが多い）</td></tr></tbody></table>
<p><strong>重要な考慮事項</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【クライアント要件の違い】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Poll:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - クライアントは公開エンドポイント不要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - インバウンド接続を受け付けなくてOK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ファイアウォール内、NAT配下でも動作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → モバイルアプリ、IoTデバイスに最適</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ping/Push:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - クライアントが公開HTTPSエンドポイント必須</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - OPからのインバウンド接続を受け付ける</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Webサーバー機能が必要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → バックエンドサーバー専用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">【セキュリティの違い】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Poll/Ping:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - トークンはクライアントがToken Endpointから取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - トークンがネットワークを流れるのは1回のみ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → セキュア</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Push:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - トークンがOPからクライアントにプッシュされる</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - 通知エンドポイントの保護が重要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - TLS、通知トークン検証が必須</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → セキュリティリスク高</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">【モバイルアプリの実装パターン】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">モバイルアプリ自体は公開HTTPSエンドポイントを持てない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">→ 直接CIBAクライアントにはなれない（Ping/Push不可）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">パターン1: モバイルアプリが直接クライアント（Poll）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌──────────────┐   Poll        ┌────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ モバイルアプリ │ ───────────► │   OP   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └──────────────┘              └────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">パターン2: バックエンド経由（Ping/Push）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌──────────────┐               ┌────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ モバイルアプリ │               │   OP   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └──────┬───────┘               └────┬───┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │ FCM/APNs                   │ Ping/Push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ▼                            ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌──────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │     バックエンドサーバー              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │     （CIBAクライアント）              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └──────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  実装:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1. バックエンドがCIBAクライアント（Ping/Poll）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2. バック  エンドがFCM/APNsでモバイルに通知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3. モバイルがバックエンドからトークン取得</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Poll モード:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Client        OP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├──auth req─►</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄─auth_req_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├──poll────►│ ← ユーザー認証中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄─pending──┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├──poll────►│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄─pending──┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├──poll────►│ ← 認証完了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄─tokens───┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ping モード:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Client        OP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├──auth req─►</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄─auth_req_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │ ← ユーザー認証中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄──ping─ ───┤ ← 認証完了を通知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─get token►</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄─tokens───┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Push モード:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Client        OP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├──auth req─►</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄─auth_req_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │ ← ユーザー認証中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ◄──tokens──┤ ← トークンを直接プッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │           │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第2部-詳細編">第2部: 詳細編<a href="#第2部-詳細編" class="hash-link" aria-label="第2部: 詳細編 への直接リンク" title="第2部: 詳細編 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="エンドポイント">エンドポイント<a href="#エンドポイント" class="hash-link" aria-label="エンドポイント への直接リンク" title="エンドポイント への直接リンク">​</a></h3>
<p>CIBA では、通常の OIDC エンドポイントに加えて、新しいエンドポイントが導入されます。</p>
<table><thead><tr><th>エンドポイント</th><th>URL 例</th><th>目的</th></tr></thead><tbody><tr><td>Backchannel Authentication Endpoint</td><td><code>https://auth.example.com/bc-authorize</code></td><td>認証リクエストを受け付ける</td></tr><tr><td>Token Endpoint</td><td><code>https://auth.example.com/token</code></td><td>トークンを発行（既存）</td></tr><tr><td>Client Notification Endpoint</td><td><code>https://client.example.com/ciba/callback</code></td><td>RP が実装（Ping/Push）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="認証リクエスト">認証リクエスト<a href="#認証リクエスト" class="hash-link" aria-label="認証リクエスト への直接リンク" title="認証リクエスト への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="リクエストの構造">リクエストの構造<a href="#リクエストの構造" class="hash-link" aria-label="リクエストの構造 への直接リンク" title="リクエストの構造 への直接リンク">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /bc-authorize HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: auth.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scope=openid profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;client_notification_token=8d67dc78-7faa-4d41-aabd-67707b374255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;login_hint=user@example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;binding_message=Transaction: 100 EUR to DE89...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;requested_expiry=120</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="パラメータの詳細">パラメータの詳細<a href="#パラメータの詳細" class="hash-link" aria-label="パラメータの詳細 への直接リンク" title="パラメータの詳細 への直接リンク">​</a></h4>
<table><thead><tr><th>パラメータ</th><th>必須</th><th>説明</th><th>推奨値</th></tr></thead><tbody><tr><td><code>scope</code></td><td>✅</td><td>要求するスコープ（openid 必須）</td><td><code>openid profile email</code></td></tr><tr><td><code>client_notification_token</code></td><td>△</td><td>Ping/Push モードで必須。クライアント通知エンドポイントへの認証に使用</td><td>UUID v4 等のランダム値</td></tr><tr><td><code>login_hint</code></td><td>△</td><td>ユーザーのヒント（メール、電話番号等）</td><td><code>user@example.com</code></td></tr><tr><td><code>id_token_hint</code></td><td>△</td><td>既知の ID トークン。ユーザーを特定</td><td>以前に発行された ID Token</td></tr><tr><td><code>login_hint_token</code></td><td>△</td><td>署名付きヒントトークン</td><td>JWT 形式</td></tr><tr><td><code>binding_message</code></td><td>△</td><td>認証デバイスに表示するメッセージ（最大20文字推奨）</td><td><code>Pay 100 EUR</code></td></tr><tr><td><code>user_code</code></td><td>△</td><td>ユーザーが入力するコード（追加の確認）</td><td><code>123456</code></td></tr><tr><td><code>requested_expiry</code></td><td>△</td><td>認証リクエストの有効期限（秒）</td><td>120-300</td></tr><tr><td><code>acr_values</code></td><td>△</td><td>要求する認証レベル</td><td><code>urn:example:acr:loa2</code></td></tr><tr><td><code>request</code></td><td>△</td><td>署名付き Request Object（JWT）</td><td>FAPI-CIBA では必須</td></tr></tbody></table>
<p><strong>重要な制約</strong>:</p>
<ul>
<li><code>login_hint</code>、<code>id_token_hint</code>、<code>login_hint_token</code> のいずれか 1 つは必須</li>
<li><code>binding_message</code> は人間が読める平文。取引内容を明示してフィッシング対策</li>
<li><code>client_notification_token</code> は十分にランダムで推測不可能な値（128ビット以上推奨）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="login_hint-の詳細">login_hint の詳細<a href="#login_hint-の詳細" class="hash-link" aria-label="login_hint の詳細 への直接リンク" title="login_hint の詳細 への直接リンク">​</a></h4>
<p><code>login_hint</code> は、ユーザーを識別するためのヒントです。AS は、このヒントを使ってユーザーの認証デバイスに通知を送ります。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">login_hint の形式例:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. メールアドレス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   login_hint=user@example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 電話番号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   login_hint=tel:+81-90-1234-5678</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. ユーザーID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   login_hint=user_id:12345</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. カスタム形式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   login_hint=custom:iban:DE89370400440532013000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>AS は、<code>login_hint</code> の形式をサポートする必要があります。サポートする形式はディスカバリーメタデータで公開すべきです。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="id_token_hint-の詳細">id_token_hint の詳細<a href="#id_token_hint-の詳細" class="hash-link" aria-label="id_token_hint の詳細 への直接リンク" title="id_token_hint の詳細 への直接リンク">​</a></h4>
<p>既に取得済みの ID Token を使ってユーザーを識別します。</p>
<p>メリッ ト：</p>
<ul>
<li>確実にユーザーを識別できる（sub クレーム）</li>
<li>AS が署名を検証できる</li>
<li>セキュリティが高い</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="login_hint_token-の詳細">login_hint_token の詳細<a href="#login_hint_token-の詳細" class="hash-link" aria-label="login_hint_token の詳細 への直接リンク" title="login_hint_token の詳細 への直接リンク">​</a></h4>
<p>署名付きの JWT でユーザーヒントを提供します。</p>
<p>用途：</p>
<ul>
<li>第三者（信頼できる RP）がユーザーヒントを提供</li>
<li>ヒントの改ざん防止</li>
<li>エンタープライズシナリオ（社内システム間連携）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="binding_message-の詳細">binding_message の詳細<a href="#binding_message-の詳細" class="hash-link" aria-label="binding_message の詳細 への直接リンク" title="binding_message の詳細 への直接リンク">​</a></h4>
<p><code>binding_message</code> は、フィッシング攻撃を防ぐための重要なパラメータです。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">良い binding_message:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ &quot;Pay 100 EUR to Alice&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ &quot;Transfer 50000 JPY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ &quot;Approve loan #12345&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">悪い binding_message:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ &quot;Please authenticate&quot;  （具体性がない）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ &quot;&quot;  （空）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ &quot;Click here to continue&quot;  （フィッシング的）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>文字数の考慮</strong>:</p>
<p>OpenID Connect CIBA Core 1.0仕様では、具体的な文字数制限は規定されていません。
ただし、認証デバイスでの表示を考慮した実装上の推奨があります：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">デバイスごとの表示可能文字数（目安）:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────┬──────────────┬─────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ デバイス         │ 1行表示      │ 複数行表示          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────┼──────────────┼─────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ iOS通知          │ 約20-30文字  │ 約110文字（2行）    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Android通知      │ 約20-30文字  │ 約45-60文字（2行）  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ スマートウォッチ │ 約10-15文字  │ 約30文字（2行）     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ SMS              │ 約30-40文字  │ 約160文字（1通）    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────┴──────────────┴─────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">実装上の推奨:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - 確実に1行で表示: 20文字以内</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - 2行表示を許容: 50文字程度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - 詳細情報が必要: 100文字程度（ただし改行を考慮）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>ベストプラクティス</strong>:</p>
<ul>
<li>最も重要な情報を最初の20文字に収める</li>
<li>金額、通貨、操作種別を優先</li>
<li>送金先等の詳細は後半に配置</li>
<li>取引の具体的内容を含める</li>
<li>人間が読める形式（平文）</li>
<li>特殊文字・絵文字は避ける</li>
</ul>
<p><strong>例</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">良い例（優先度順）:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ &quot;Pay 100 EUR&quot;                    # 16文字（最小限）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ &quot;Pay 100 EUR to Alice&quot;           # 20文字（理想的）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✅ &quot;Transfer 50000 JPY to Account 123&quot; # 36文字（2行表示）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">悪い例:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ &quot;Please authenticate for transaction&quot; # 曖昧</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ❌ &quot;重要な取引の承認をお願いします&quot; # 具体性がない</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>セキュリティ上の理由</strong>:</p>
<ol>
<li>ユーザーが「何を承認しているか」を明確に理解</li>
<li>攻撃者が別の取引に差し替えることを防止</li>
<li>RP と認証デバイスで同じ内容を表示して整合性を確保</li>
<li>フィッシング攻撃の検出（不審な取引内容がすぐ分かる）</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="user_code-の詳細">user_code の詳細<a href="#user_code-の詳細" class="hash-link" aria-label="user_code の詳細 への直接リンク" title="user_code の詳細 への直接リンク">​</a></h4>
<p>高リスク操作では、<code>user_code</code> を使っ て追加の確認を行います。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">user_code の使用例:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. RP が user_code を生成してユーザーに表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   「コード 123456 を入力してください」</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. CIBA リクエストに user_code を含める</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   user_code=123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. AS が認証デバイスで user_code の入力を要求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   「端末に表示されているコードを入力してください」</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. ユーザーが 123456 を入力</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. AS が一致を確認して認証完了</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>メリット：</p>
<ul>
<li><strong>中間者攻撃の防止</strong>（攻撃者が user_code を知らない）</li>
<li><strong>フィッシング防止</strong>（ユーザーが取引を確認）</li>
<li>高額決済や重要操作に推奨</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="クライアント認証">クライアント認証<a href="#クライアント認証" class="hash-link" aria-label="クライアント認証 への直接リンク" title="クライアント認証 への直接リンク">​</a></h4>
<p>CIBA では、Backchannel Authentication Endpoint へのリクエスト時にクライアント認証が<strong>必須</strong>です。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">許可される認証方式:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ client_secret_basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ client_secret_post</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   client_id=s6BhdRkqt3&amp;client_secret=7Fjfp0ZBr1KtDRbnfVdmIw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ client_secret_jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   client_assertion=eyJhbGciOiJIUzI1NiIs...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ private_key_jwt（推奨）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   client_assertion=eyJhbGciOiJQUzI1NiIs...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ tls_client_auth / self_signed_tls_client_auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   mTLS で認証</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>FAPI-CIBA では、<code>private_key_jwt</code> または <code>tls_client_auth</code> のみ許可されます。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="認証レスポンス">認証レスポンス<a href="#認証レスポンス" class="hash-link" aria-label="認証レスポンス への直接リンク" title="認証レスポンス への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="成功レスポンス">成功レスポンス<a href="#成功レスポンス" class="hash-link" aria-label="成功レスポンス への直接リンク" title="成功レスポンス への直接リンク">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control: no-store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;auth_req_id&quot;: &quot;1c266114-a1be-4252-8ad1-04986c5b9ac1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;expires_in&quot;: 120,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;interval&quot;: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>フィールド</th><th>説明</th><th>推奨値</th></tr></thead><tbody><tr><td><code>auth_req_id</code></td><td>認証リクエスト ID。トークンリクエスト時に使用</td><td>UUID v4</td></tr><tr><td><code>expires_in</code></td><td>有効期限（秒）</td><td>120-300</td></tr><tr><td><code>interval</code></td><td>ポーリング間隔（Poll モードのみ）</td><td>5</td></tr></tbody></table>
<p><code>auth_req_id</code> の要件：</p>
<ul>
<li>ユニークであること</li>
<li>推測不可能であること（128ビット以上のエントロピー）</li>
<li>一度のみ使用可能</li>
<li>有効期限後は無効</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="エラーレスポンス"> エラーレスポンス<a href="#エラーレスポンス" class="hash-link" aria-label="エラーレスポンス への直接リンク" title="エラーレスポンス への直接リンク">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 400 Bad Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;error&quot;: &quot;invalid_request&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;error_description&quot;: &quot;The login_hint parameter is missing&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>主なエラーコード  ：</p>
<table><thead><tr><th>エラー</th><th>HTTP ステータス</th><th>説明</th><th>対処法</th></tr></thead><tbody><tr><td><code>invalid_request</code></td><td>400</td><td>リクエストパラメータが不正</td><td>パラメータを確認</td></tr><tr><td><code>invalid_scope</code></td><td>400</td><td>スコープが不正</td><td>サポートされるスコープを確認</td></tr><tr><td><code>expired_login_hint_token</code></td><td>400</td><td>login_hint_token が期限切れ</td><td>新しいトークンを取得</td></tr><tr><td><code>unknown_user_id</code></td><td>400</td><td>ユーザーが見つからない</td><td>login_hint を確認</td></tr><tr><td><code>unauthorized_client</code></td><td>401</td><td>クライアント認証が失敗</td><td>クライアント認証情報を確認</td></tr><tr><td><code>access_denied</code></td><td>403</td><td>AS がリクエストを拒否</td><td>AS のポリシーを確認</td></tr><tr><td><code>missing_user_code</code></td><td>400</td><td>user_code が必須だが提供されていない</td><td>user_code を追加</td></tr><tr><td><code>invalid_user_code</code></td><td>400</td><td>user_code が不正</td><td>user_code を確認</td></tr><tr><td><code>invalid_binding_message</code></td><td>400</td><td>binding_message が不正</td><td>文字数制限等を確認</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="poll-モード">Poll モード<a href="#poll-モード" class="hash-link" aria-label="Poll モード への直接リンク" title="Poll モード への直接リンク">​</a></h3>
<p>Poll モードでは、クライアントが定期的にトークンエンドポイントをポーリングして、認証の完了を確認します。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="フロー詳細">フロー詳細<a href="#フロー詳細" class="hash-link" aria-label="フロー詳細 への直接リンク" title="フロー詳細 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Poll モードのフロー:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌────────┐                    ┌────────┐                 ┌──────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Client │                    │   OP   │                 │   User   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └───┬────┘                    └───┬────┘                 └────┬─────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  1. POST /bc-authorize      │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├────────────────────────────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  2. auth_req_id, interval   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │  3. Push notification     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             ├──────────────────────────►│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  4. Poll (GET /token)       │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├────────────────────────────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  5. authorization_pending   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  (interval 秒待機)          │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │       4. User approves    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │◄──────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  6. Poll (GET /token)       │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├────────────────────────────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  7. authorization_pending   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  (interval 秒待機)          │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  8. Poll (GET /token)       │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├────────────────────────────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  9. access_token, id_token  │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="トークンリクエスト">トークンリクエスト<a href="#トークンリクエスト" class="hash-link" aria-label="トークンリクエスト への直接リンク" title="トークンリクエスト への直接リンク">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /token HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: auth.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grant_type=urn:openid:params:grant-type:ciba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;auth_req_id=1c266114-a1be-4252-8ad1-04986c5b9ac1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>パラメータ：</p>
<table><thead><tr><th>パラメータ</th><th>必須</th><th>説明</th></tr></thead><tbody><tr><td><code>grant_type</code></td><td>✅</td><td><code>urn:openid:params:grant-type:ciba</code> 固定</td></tr><tr><td><code>auth_req_id</code></td><td>✅</td><td>Backchannel Authentication Endpoint から取得した ID</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="認証待ちレスポンス">認証待ちレスポンス<a href="#認証待ちレスポンス" class="hash-link" aria-label="認証待ちレスポンス への直接リンク" title="認証待ちレスポンス への直接リンク">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 400 Bad Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;error&quot;: &quot;authorization_pending&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;error_description&quot;: &quot;The authorization request is still pending&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>クライアントは、<code>interval</code> 秒待ってから再度ポーリングする必要があります。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ポーリング過多レスポンス">ポーリング過多レスポンス<a href="#ポーリング過多レスポンス" class="hash-link" aria-label="ポーリング過多レスポンス への直接リンク" title="ポーリング過多レスポンス への直接リンク">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 400 Bad Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;error&quot;: &quot;slow_down&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;error_description&quot;: &quot;You are polling too quickly&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;interval&quot;: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>slow_down</code> エラーが返された場合：</p>
<ul>
<li>クライアントはポーリング間隔を増やす必要があります</li>
<li>新しい <code>interval</code> が提供されている場合はそれを使用</li>
<li>提供されていない場合は、現在の間隔に 5 秒追加</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="成功レスポンス-1">成功レスポンス<a href="#成功レスポンス-1" class="hash-link" aria-label="成功レスポンス への直接リンク" title="成功レスポンス への直接リンク">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control: no-store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;access_token&quot;: &quot;eyJhbGciOiJSUzI1NiIs...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;token_type&quot;: &quot;Bearer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;expires_in&quot;: 3600,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;refresh_token&quot;: &quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;id_token&quot;: &quot;eyJhbGciOiJSUzI1NiIs...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ポーリングのベストプラクティス">ポーリングのベストプラクティス<a href="#ポーリングのベストプラクティス" class="hash-link" aria-label="ポーリングのベストプラクティス への直接リンク" title="ポーリングのベストプラクティス への直接リンク">​</a></h4>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ping-モード">Ping モード<a href="#ping-モード" class="hash-link" aria-label="Ping モード への直接リンク" title="Ping モード へ の直接リンク">​</a></h3>
<p>Ping モードでは、OP がクライアントに通知し、クライアントがトークンを取得します。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="フロー詳細-1">フロー詳細<a href="#フロー詳細-1" class="hash-link" aria-label="フロー詳細 への直接リンク" title="フロー詳細 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ping モードのフロー:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌────────┐                    ┌────────┐                 ┌──────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Client │                    │   OP   │                 │   User   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └───┬────┘                    └───┬────┘                 └────┬─────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  1. POST /bc-authorize      │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │     (client_notification_   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │      token included)        │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├────────────────────────────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  2. auth_req_id             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │  3. Push notification     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             ├──────────────────────────►│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │       4. User approves    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │◄──────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  5. POST /callback (ping)   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │     Authorization: Bearer   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │     {client_notification_   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │      token}                 │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  6. 200 OK                  │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├────────────────────────────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  7. POST /token             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├───────────────────────  ─────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  8. access_token, id_token  │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="クライアント通知エンドポイント">クライアント通知エンドポイント<a href="#クライアント通知エンドポイント" class="hash-link" aria-label="クライアント通知エンドポイント への直接リンク" title="クライアント通知エンドポイント への直接リンク">​</a></h4>
<p>Ping モードを使用する場合、クライアントは<strong>クライアント通知エンドポイント</strong>を実装する必要があります。</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /ciba/callback HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: client.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Bearer 8d67dc78-7faa-4d41-aabd-67707b374255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;auth_req_id&quot;: &quot;1c266114-a1be-4252-8ad1-04986c5b9ac1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>リクエストボディ：</p>
<table><thead><tr><th>フィールド</th><th>説明</th></tr></thead><tbody><tr><td><code>auth_req_id</code></td><td>認証リクエスト ID</td></tr></tbody></table>
<p>Authorization ヘッダー：</p>
<ul>
<li>Bearer トークンとして <code>client_notification_token</code> を使用</li>
<li>クライアントは、この値を検証して正当な通知であることを確認</li>
</ul>
<p>クライアント側の実装例：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="トークン取得">トークン取得<a href="#トークン取得" class="hash-link" aria-label="トークン取得 への直接リンク" title="トークン取得 への直接リンク">​</a></h4>
<p>通知を受け取った後、クライアントはトークンエンドポイントに通常のトークンリクエストを送信します。</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /token HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: auth.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grant_type=urn:openid:params:grant-type:ciba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;auth_req_id=1c266114-a1be-4252-8ad1-04986c5b9ac1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Poll モードと同じリクエストですが、<strong>Ping を受け取った直後に送信するため、すぐに成功レスポンスが返ります</strong>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="push-モード">Push モード<a href="#push-モード" class="hash-link" aria-label="Push モード への直接リンク" title="Push モード への直接リンク">​</a></h3>
<p>Push モードでは、OP がトークンを直接クライアントにプッシュします。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="フロー詳細-2">フロー詳細<a href="#フロー詳細-2" class="hash-link" aria-label="フロー詳細 への直接リンク" title="フロー詳細 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Push モードのフロー:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌────────┐                    ┌────────┐                 ┌──────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Client │                    │   OP   │                 │   User   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └───┬────┘                    └───┬────┘                 └────┬─────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  1. POST /bc-authorize      │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │     (client_notification_   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │      token included)        │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├────────────────────────────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  2. auth_req_id             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │  3. Push notification     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             ├──────────────────────────►│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │       4. User approves    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │◄──────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  5. POST /callback (tokens) │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │     Authorization: Bearer   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │     {client_notification_   │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │      token}                 │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ◄────────────────────────────┤                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │  6. 204 No Content          │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├────────────────────────────►│                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │                             │                           │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="トークンプッシュ">トークンプッシュ<a href="#トークンプッシュ" class="hash-link" aria-label="トークンプッシュ への直接リンク" title="トークンプッシュ への直接リンク">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /ciba/callback HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: client.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Bearer 8d67dc78-7faa-4d41-aabd-67707b374255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;auth_req_id&quot;: &quot;1c266114-a1be-4252-8ad1-04986c5b9ac1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;access_token&quot;: &quot;eyJhbGciOiJSUzI1NiIs...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;token_type&quot;: &quot;Bearer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;expires_in&quot;: 3600,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;refresh_token&quot;: &quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;id_token&quot;: &quot;eyJhbGciOiJSUzI1NiIs...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>クライアント側の実装例：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ディスカバリーメタデータ">ディスカバリーメタデータ<a href="#ディスカバリーメタデータ" class="hash-link" aria-label="ディスカバリーメタデータ への直接リンク" title="ディスカバリーメタデータ への直接リンク">​</a></h3>
<p>CIBA をサポートする OP は、以下のメタデータを公開する必要があります。</p>
<p>主要なメタデータ：</p>
<table><thead><tr><th>フィールド</th><th>説明</th></tr></thead><tbody><tr><td><code>backchannel_authentication_endpoint</code></td><td>Backchannel Authentication Endpoint の URL</td></tr><tr><td><code>backchannel_token_delivery_modes_supported</code></td><td>サポートする配信モード（poll, ping, push）</td></tr><tr><td><code>backchannel_authentication_request_signing_alg_values_supported</code></td><td>Request Object の署名アルゴリズム</td></tr><tr><td><code>backchannel_user_code_parameter_supported</code></td><td>user_code パラメータをサポートするか</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="クライアント登録">クライアント登録<a href="#クライアント登録" class="hash-link" aria-label="クライアント登録 への直接リンク" title="クライアント登録 への直接リンク">​</a></h3>
<p>CIBA を使用するクライアントは、以下の情報を登録する必要があります。</p>
<p>主要なフィールド：</p>
<table><thead><tr><th>フィールド</th><th>必須</th><th>説明</th></tr></thead><tbody><tr><td><code>backchannel_token_delivery_mode</code></td><td>✅</td><td>配信モード（poll, ping, push）</td></tr><tr><td><code>backchannel_client_notification_endpoint</code></td><td>△</td><td>Ping/Push モードで必須</td></tr><tr><td><code>backchannel_authentication_request_signing_alg</code></td><td>△</td><td>Request Object の署名アルゴリズム（使用する場合）</td></tr><tr><td><code>backchannel_user_code_parameter</code></td><td>△</td><td>user_code を使用するか</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第3部-セキュリティ">第3部: セキュリティ<a href="#第3部-セキュリティ" class="hash-link" aria-label="第3部: セキュリティ への直接リンク" title="第3部: セキュリティ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="セキュリティ考慮事項">セキュリティ考慮事項<a href="#セキュリティ考慮事項" class="hash-link" aria-label="セキュリティ考慮事項 への直接リンク" title="セキュリティ考慮事項 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-backchannel-authentication-endpoint-の保護">1. Backchannel Authentication Endpoint の保護<a href="#1-backchannel-authentication-endpoint-の保護" class="hash-link" aria-label="1. Backchannel Authentication Endpoint の保護 への直接リンク" title="1. Backchannel Authentication Endpoint の保護 への直接リンク">​</a></h4>
<p><strong>必須の検証項目:</strong></p>
<ul>
<li>クライアント認証を必須化（private_key_jwt または mTLS）</li>
<li>scope パラメータに openid が含まれることを確認</li>
<li>login_hint、id_token_hint、login_hint_token のいずれかが必須</li>
<li>配信モード（poll/ping/push）に応じた適切な検証</li>
<li>auth_req_id は推測不可能な値（UUID v4 等）を使用</li>
<li>有効期限を適切に設定（推奨: 120-300秒）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-ユーザー認証通知のセキュリティ">2. ユーザー認証通知のセキュリティ<a href="#2-ユーザー認証通知のセキュリティ" class="hash-link" aria-label="2. ユーザー認証通知のセキュリティ への直接リンク" title="2. ユーザー認証通知のセキュリティ への直接リンク">​</a></h4>
<p><strong>プッシュ通知の保護:</strong></p>
<ul>
<li>プッシュ通知サービス（FCM, APNs）との通信を暗号化</li>
<li>デバイストークンを安全に管理</li>
<li>binding_message を通知に含めてフィッシング対策</li>
<li>user_code が設定されている場合は入力を要求</li>
</ul>
<p><strong>通知内容の考慮事項:</strong></p>
<ul>
<li>機密情報を通知に含めない</li>
<li>binding_message は平文で表示（取引内容を明示）</li>
<li>認証デバイスでの表示可能文字数を考慮</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-ユーザー承認処理のセキュリティ">3. ユーザー承認処理のセキュリティ<a href="#3-ユーザー承認処理のセキュリティ" class="hash-link" aria-label="3. ユーザー承認処理のセキュリティ への直接リンク" title="3. ユーザー承認処理のセキュリティ への直接リンク">​</a></h4>
<p><strong>検証すべき項目:</strong></p>
<ul>
<li>ユーザー認証を必須化</li>
<li>auth_req_id の有効性確認</li>
<li>有効期限の確認</li>
<li>ユーザーIDの一致確認</li>
<li>user_code の検証（設定されている場合）</li>
<li>配信モードに応じた適切な処理</li>
</ul>
<p><strong>配信モード別の処理:</strong></p>
<ul>
<li>Poll モード: 何もしない（クライアントがポーリング）</li>
<li>Ping モード: 通知エンドポイントにauth_req_idを送信</li>
<li>Push モード: トークンを直接プッシュ</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-トークンエンドポイントの拡張">4. トークンエンドポイントの拡張<a href="#4-トークンエンドポイントの拡張" class="hash-link" aria-label="4. トークンエンドポイントの拡張 への直接リンク" title="4. トークンエンドポイントの拡張 への直接リンク">​</a></h4>
<p><strong>CIBA Grant の検証:</strong></p>
<ul>
<li>grant_type が <code>urn:openid:params:grant-type:ciba</code> であることを確認</li>
<li>クライアント認証を必須化</li>
<li>auth_req_id の有効性確認</li>
<li>クライアントIDの一致確認</li>
<li>有効期限の確認</li>
<li>ステータスの確認（approved のみトークン発行）</li>
<li>auth_req_id は一度のみ使用可能（使用後に削除）</li>
</ul>
<p><strong>レスポンスのステータス:</strong></p>
<ul>
<li><code>authorization_pending</code>: 認証待ち</li>
<li><code>access_denied</code>: ユーザーが拒否</li>
<li><code>expired_token</code>: 有効期限切れ</li>
<li>成功: トークンを発行</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="クライアントrpのセキュリティ考慮事項">クライアント（RP）のセキュリティ考慮事項<a href="#クライアントrpのセキュリティ考慮事項" class="hash-link" aria-label="クライアント（RP）のセキュリティ考慮事項 への直接リンク" title="クライアント（RP）のセキュリティ考慮事項 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="poll-モードのセキュリティ">Poll モードのセキュリティ<a href="#poll-モードのセキュリティ" class="hash-link" aria-label="Poll モードのセキュリティ への直接リンク" title="Poll モードのセキュリティ への直接リンク">​</a></h4>
<p><strong>ポーリングのベストプラクティス:</strong></p>
<ul>
<li>interval パラメータを遵守する</li>
<li>slow_down エラーに対応して間隔を延長</li>
<li>タイムアウトを設定（expires_in を超えたら終了）</li>
<li>認証待ちとエラーを適切に処理</li>
</ul>
<p><strong>interval の動的調整:</strong></p>
<ul>
<li>初期値: AS から返された interval（通常5秒）</li>
<li>slow_down エラー時: 新しい interval または +5秒</li>
<li>最大間隔: 実装依存（例: 30秒）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ping-モードのセキュリティ">Ping モードのセキュリティ<a href="#ping-モードのセキュリティ" class="hash-link" aria-label="Ping モードのセキュリティ への直接リンク" title="Ping モードのセキュリティ への直接リンク">​</a></h4>
<p><strong>通知エンドポイントの保護:</strong></p>
<ul>
<li>HTTPS必須</li>
<li>client_notification_token の検証必須</li>
<li>リプレイ攻撃防止（jti等）</li>
<li>レート制限の実装</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="push-モードのセキュリティ">Push モードのセキュリティ<a href="#push-モードのセキュリティ" class="hash-link" aria-label="Push モードのセキュリティ への直接リンク" title="Push モードのセキュリティ への直接リンク">​</a></h4>
<p><strong>トークン受信の保護:</strong></p>
<ul>
<li>HTTPS必須</li>
<li>client_notification_token の検証必須</li>
<li>トークンの即座の保存</li>
<li>TLS証明書の検証</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="脅威モデルと攻撃シナリオ">脅威モデルと攻撃シナリオ<a href="#脅威モデルと攻撃シナリオ" class="hash-link" aria-label="脅威モデルと攻撃シナリオ への直接リンク" title="脅威モデルと攻撃シナリオ への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-クライアント認証の重要性">1. クライアント認証の重要性<a href="#1-クライアント認証の重要性" class="hash-link" aria-label="1. クライアント認証の重要性 への直接リンク" title="1. クライアント認証の重要性 への直接リンク">​</a></h4>
<table><thead><tr><th>リスク</th><th>対策</th></tr></thead><tbody><tr><td>クライアント認証情報の漏洩</td><td>private_key_jwt または mTLS を使用（FAPI-CIBA では必須）</td></tr><tr><td>中間者攻撃</td><td>TLS 1.2 以上を使用、証明書を検証</td></tr><tr><td>リプレイ攻撃</td><td>client_assertion に jti を含め、AS 側で使用済み jti を記録</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-binding_message-の重要性">2. binding_message の重要性<a href="#2-binding_message-の重要性" class="hash-link" aria-label="2. binding_message の重要性 への直接リンク" title="2. binding_message の重要性 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">なぜ binding_message が重要か:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">攻撃シナリオ（binding_message なし）:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. 攻撃者が RP を作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. 攻撃者が被害者の login_hint で CIBA リクエスト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3. 被害者のスマホに通知が届く</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4. 被害者が「認証リクエスト」と思って承認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5. 攻撃者がアクセストークンを取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  6. 攻撃者が被害者のアカウントにアクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">対策（binding_message あり）:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. 攻撃者が RP を作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. 攻撃者が被害者の login_hint で CIBA リクエスト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     binding_message=&quot;攻撃者の取引内容&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3. 被害者のスマホに「攻撃者の取引内容」が表示される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4. 被害者が怪しいと気づいて拒否</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5. 攻撃失敗</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>ベストプラクティス</strong>:</p>
<ul>
<li>binding_message に取引の具体的内容を含める</li>
<li>金額、送金先、操作内容を明示</li>
<li>ユーザーが理解しやすい言語で記述</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-user_code-の使 用">3. user_code の使用<a href="#3-user_code-の使用" class="hash-link" aria-label="3. user_code の使用 への直接リンク" title="3. user_code の使用 への直接リンク">​</a></h4>
<p>高リスク操作では、<code>user_code</code> を使って追加の確認を行います。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">user_code の使用例:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">シナリオ: 100万円の送金</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. RP が 6桁のコードを生成: 123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. RP がユーザーに表示:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   「スマホアプリに表示されるコードを確認してください: 123456」</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. CIBA リクエストに user_code=123456 を含める</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. AS が認証デバイスで user_code の入力を要求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. ユーザーが 123456 を入力</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. AS が 一致を確認して認証完了</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>攻撃の防止</strong>:</p>
<ul>
<li>中間者攻撃: 攻撃者が user_code を知らないため、認証できない</li>
<li>フィッシング: ユーザーが取引内容と user_code の両方を確認</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-有効期限の設定">4. 有効期限の設定<a href="#4-有効期限の設定" class="hash-link" aria-label="4. 有効期限の設定 への直接リンク" title="4. 有効期限の設定 への直接リンク">​</a></h4>
<table><thead><tr><th>パラメータ</th><th>推奨値</th><th>理由</th></tr></thead><tbody><tr><td><code>requested_expiry</code></td><td>120-300 秒</td><td>ユーザーが認証する時間を考慮しつつ、リスクを最小化</td></tr><tr><td><code>auth_req_id</code> の有効期限</td><td><code>requested_expiry</code> と同じ</td><td>期限切れのリクエストは無効化</td></tr><tr><td>アクセストークンの有効期限</td><td>3600 秒（1時間）</td><td>短めに設定してリフレッシュトークンを使用</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-client_notification_token-のセキュリティ">5. client_notification_token のセキュリティ<a href="#5-client_notification_token-のセキュリティ" class="hash-link" aria-label="5. client_notification_token のセ キュリティ への直接リンク" title="5. client_notification_token のセキュリティ への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client_notification_token の要件:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. ランダム性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 128ビット以上のエントロピー</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - UUID v4 や暗号学的に安全な乱数生成器を使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 一度のみ使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - auth_req_id ごとに新しいトークンを生成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 再利用禁止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. 検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - クライアント側で受信した通知のトークンを検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 一致しない場合は拒否</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>実装例:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-tls-の使用">6. TLS の使用<a href="#6-tls-の使用" class="hash-link" aria-label="6. TLS の使用 への直接リンク" title="6. TLS の使用 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TLS 要件:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ TLS 1.2 以上を使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ 強力な暗号スイートのみ許可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ 証明書の検証を必ず行う</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ 自己署名証明書は本番環境で使用しない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ TLS 1.0/1.1 は使用しない</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="よくあるciba要件違反とエラー">よくあるCIBA要件違反とエラー<a href="#よくあるciba要件違反とエラー" class="hash-link" aria-label="よくあるCIBA要件違反とエラー への直接リンク" title="よくあるCIBA要件違反とエラー への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反1-ポーリング間隔の未遵守">違反1: ポーリング間隔の未遵守<a href="#違反1-ポーリング間隔の未遵守" class="hash-link" aria-label="違反1: ポーリング間隔の未遵守 への直接リンク" title="違反1: ポーリング間隔の未遵守 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> <code>slow_down</code>
<strong>セキュリティリスク:</strong> DoS攻撃、サーバー負荷増大による可用性低下
<strong>CIBA要件:</strong> クライアントはASから返された<code>interval</code>パラメータを遵守し、最小間隔を下回るポーリングを行ってはならない
<strong>対策:</strong> ASから返された<code>interval</code>秒を待機してからポーリング。<code>slow_down</code>エラー受信時は間隔を延長する</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反2-client_notification_token-の未検証">違反2: client_notification_token の未検証<a href="#違反2-client_notification_token-の未検証" class="hash-link" aria-label="違反2: client_notification_token の未検証 への直接リンク" title="違反2: client_notification_token の未検証 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> <code>unauthorized_client</code> または不正な通知の受理
<strong>セキュリティリスク:</strong> なりすまし攻撃、偽の通知による不正なトークン発行
<strong>CIBA要件:</strong> Ping/Pushモードでは、クライアント通知エンドポイントで<code>client_notification_token</code>を検証しなければならない
<strong>対策:</strong> クライアント側で通知受信時にAuthorizationヘッダーの値を元のリクエストで送信した<code>client_notification_token</code>と照合する</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反3-binding_message-の省略">違反3: binding_message の省略<a href="#違反3-binding_message-の省略" class="hash-link" aria-label="違反3: binding_message の省略 への直接リンク" title="違反3: binding_message の省略 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> なし（セキュリティ脅威のみ）
<strong>セキュリティリスク:</strong> フィッシング攻撃、ユーザーが不正な認証リクエストを承認する可能性
<strong>CIBA要件:</strong> 取引内容を明示的にユーザーに提示するため、<code>binding_message</code>パラメータを使用することが推奨される
<strong>対策:</strong> 取引の具体的内容（金額、送金先、操作内容）を20文字以内で<code>binding_message</code>に含める</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反4-id-token-の未検証">違反4: ID Token の未検証<a href="#違反4-id-token-の未検証" class="hash-link" aria-label="違反4: ID Token の未検証 への直接リンク" title="違反4: ID Token の未検証 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> なし（セキュリティ脅威のみ）
<strong>セキュリティリスク:</strong> トークン偽造、なりすまし、リプレイ攻撃
<strong>CIBA要件:</strong> OpenID Connect仕様に従い、ID Tokenの署名、<code>iss</code>, <code>aud</code>, <code>exp</code>, <code>nonce</code>を検証しなければならない
<strong>対策:</strong> ID Token受信時に署名検証、発行者検証、有効期限検証、<code>nonce</code>照合を実施する</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="違反5-auth_req_id-の再利用">違反5: auth_req_id の再利用<a href="#違反5-auth_req_id-の再利用" class="hash-link" aria-label="違反5: auth_req_id の再利用 への直接リンク" title="違反5: auth_req_id の再利用 への直接リンク">​</a></h4>
<p><strong>エラー:</strong> <code>invalid_grant</code>
<strong>セキュリティリスク:</strong> リプレイ攻撃、トークンの不正取得
<strong>CIBA要件:</strong> <code>auth_req_id</code>は一度のみ使用可能で、トークン取得後は無効化されなければならない
<strong>対策:</strong> トークン取得後は<code>auth_req_id</code>を破棄し、再度必要な場合は新しい認証リクエストを開始する</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="セキュリティベストプラクティス">セキュリティベストプラクティス<a href="#セキュリティベストプラクティス" class="hash-link" aria-label="セキュリティベストプラクティス への直接リンク" title="セキュリティベストプラクティス への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-binding_message-の活用">1. binding_message の活用<a href="#1-binding_message-の活用" class="hash-link" aria-label="1. binding_message の活用 への直接リンク" title="1. binding_message の活用 への直接リンク">​</a></h4>
<p><strong>推奨事項:</strong></p>
<ul>
<li>常に具体的な取引内容を含める</li>
<li>金額、送金先、操作内容を明示</li>
<li>20文字以内に最重要情報を配置</li>
<li>特殊文字・絵文字は避ける</li>
</ul>
<p><strong>良い例:</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Pay 100 EUR to Alice&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Transfer 50000 JPY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Approve loan #12345&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>悪い例:</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Please authenticate&quot;  # 曖昧</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;  # 空</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Click here&quot;  # フィッシング的</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-user_code-の適切な使用">2. user_code の適切な使用<a href="#2-user_code-の適切な使用" class="hash-link" aria-label="2. user_code の適切な使用 への直接リンク" title="2. user_code の適切な使用 への直接リンク">​</a></h4>
<p><strong>推奨シナリオ:</strong></p>
<ul>
<li>高額決済（例: 100万円以上）</li>
<li>重要な個人情報変更</li>
<li>管理者権限の付与</li>
</ul>
<p><strong>実装のポイント:</strong></p>
<ul>
<li>6桁の数字（000000-999999）</li>
<li>ランダム生成</li>
<li>一度のみ使用</li>
<li>有効期限を設定（例: 5分）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-有効期限の適切な設定">3. 有効期限の適切な設定<a href="#3-有効期限の適切な設定" class="hash-link" aria-label="3. 有効期限の適切な設定 への直接リンク" title="3. 有効期限の適切な設定 への直接リンク">​</a></h4>
<p><strong>推奨値:</strong></p>
<table><thead><tr><th>パラメータ</th><th>推奨値</th><th>理由</th></tr></thead><tbody><tr><td><code>requested_expiry</code></td><td>120-300秒</td><td>ユーザーが認証する時間を考慮しつつリスク最小化</td></tr><tr><td><code>auth_req_id</code> の有効期限</td><td><code>requested_expiry</code> と同じ</td><td>期限切れリクエストは無効化</td></tr><tr><td>アクセストークン</td><td>3600秒（1時間）</td><td>リフレッシュトークンで更新</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-tls-の適切な使用">4. TLS の適切な使用<a href="#4-tls-の適切な使用" class="hash-link" aria-label="4. TLS の適切な使用 への直接リンク" title="4. TLS の適切な使用 への直接リンク">​</a></h4>
<p><strong>要件:</strong></p>
<ul>
<li>TLS 1.2以上を使用</li>
<li>強力な暗号スイートのみ許可</li>
<li>証明書の検証を必ず行う</li>
<li>自己署名証明書は本番環境で使用しない</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-監査とログ">5. 監査とログ<a href="#5-監査とログ" class="hash-link" aria-label="5. 監査とログ への直接リンク" title="5. 監査とログ への直接リンク">​</a></h4>
<p><strong>記録すべき項目:</strong></p>
<ul>
<li>すべての認証リクエスト（成功・失敗）</li>
<li>ユーザーの承認・拒否</li>
<li>トークン発行</li>
<li>エラー発生</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="セキュリティ理解度チェック">セキュリティ理解度チェック<a href="#セキュリティ理解度チェック" class="hash-link" aria-label="セキュリティ理解度チェック への直接リンク" title="セキュリティ理解度チェック への直接リンク">​</a></h3>
<p>この章を学習した後、以下を理解できているか確認してください：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="認可サーバーop">認可サーバー（OP）<a href="#認可サーバーop" class="hash-link" aria-label="認可サーバー（OP） への直接リンク" title="認可サーバー（OP） への直接リンク">​</a></h4>
<p>□ PKCE S256が認可コードインターセプション攻撃を防ぐ仕組みを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>仕組み</strong>:</p><ol>
<li>クライアントがcode_verifier（ランダム値）を生成</li>
<li>code_challengeをSHA-256でハッシュ化して認可リクエストに含める</li>
<li>認可コードを取得</li>
<li>トークンリクエストで元のcode_verifierを送信</li>
<li>ASがcode_verifierをSHA-256ハッシュしてcode_challengeと一致するか検証</li>
</ol><p><strong>防ぐ脅威</strong>:
攻撃者が認可コードを傍受しても、code_verifierを持っていないためトークンを取得できない。</p></div></div></details>
<p>□ binding_messageがフィッシング攻撃を防ぐ理由を説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>目的</strong>:
取引内容を認証デバイスに明示的に表示し、ユーザーが「何を承認しているか」を明確に理解させる。</p><p><strong>防ぐ脅威</strong>:</p><ul>
<li>攻撃者が偽の認証リクエストを送信しても、binding_messageで不審な内容（異なる金額・送金先）を検出できる</li>
<li>RP側と認証デバイス側で同じbinding_messageを表示することで、中間者攻撃を検出</li>
</ul><p><strong>ベストプラクティス</strong>:</p><ul>
<li>最初の20文字に最重要情報（金額・操作種別）を含める</li>
<li>例: &quot;Pay 100 EUR to Alice&quot;</li>
</ul></div></div></details>
<p>□ auth_req_idに必要なセキュリティ要件（エントロピー、有効期限、使用回数）を説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>必要な要件</strong>:</p><ol>
<li>
<p><strong>推測不可能性（128ビット以上のエントロピー）</strong></p>
<ul>
<li>UUID v4等の暗号学的に安全な乱数生成器を使用</li>
<li>理由: 攻撃者がauth_req_idを推測してトークンを不正取得することを防ぐ</li>
</ul>
</li>
<li>
<p><strong>短い有効期限（120-300秒推奨）</strong></p>
<ul>
<li>理由: 攻撃の時間窓を最小化し、期限切れリクエストの悪用を防止</li>
</ul>
</li>
<li>
<p><strong>一度のみ使用可能</strong></p>
<ul>
<li>理由: リプレイ攻撃を防止し、トークン取得後は無効化</li>
</ul>
</li>
</ol></div></div></details>
<p>□ Ping/Pushモードでclient_notification_tokenの検証が必須な理由を説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>目的</strong>:
クライアント通知エンドポイントへの不正なリクエストを防止</p><p><strong>攻撃シナリオ（検証なし）</strong>:</p><ol>
<li>攻撃者がクライアントの通知エンドポイントを発見</li>
<li>偽のauth_req_idで通知を送信</li>
<li>クライアントが偽の通知を受理して誤ったトークンリクエストを送信</li>
</ol><p><strong>対策</strong>:</p><ul>
<li>認可リクエスト時にランダムなclient_notification_tokenを生成</li>
<li>通知受信時にAuthorizationヘッダーで検証</li>
<li>一致しない場合は拒否</li>
</ul><p><strong>要件</strong>:</p><ul>
<li>128ビット以上のエントロピー</li>
<li>一度のみ使用（auth_req_idごとに新規生成）</li>
</ul></div></div></details>
<p>□ CIBAのPoll/Ping/Pushモードの違いと、それぞれが適切なユースケースを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>Pollモード</strong>:</p><ul>
<li><strong>仕組み</strong>: クライアントが定期的にトークンエンドポイントをポーリング</li>
<li><strong>待ち時間</strong>: 平均30秒（interval × 試行回数）</li>
<li><strong>クライアント要件</strong>: 公開エンドポイント不要</li>
<li><strong>適切なケース</strong>: ファイアウォール内のシステム、NAT配下のIoTデバイス、モバイルアプリ</li>
</ul><p><strong>Pingモード</strong>:</p><ul>
<li><strong>仕組み</strong>: ASがクライアントに認証完了を通知、クライアントがトークンを取得</li>
<li><strong>待ち時間</strong>: 数秒以内</li>
<li><strong>クライアント要件</strong>: 公開HTTPSエンドポイント必須</li>
<li><strong>適切なケース</strong>: Webアプリのバックエンドサーバー、常時稼働するAPIサーバー</li>
</ul><p><strong>Pushモード</strong>:</p><ul>
<li><strong>仕組み</strong>: ASがトークンを直接クライアントにプッシュ</li>
<li><strong>待ち時間</strong>: 即座</li>
<li><strong>クライアント要件</strong>: 公開HTTPSエンドポイント必須</li>
<li><strong>適切なケース</strong>: セキュアな内部ネットワーク（実際にはPingで十分なケースが多い）</li>
</ul><p><strong>セキュリティの違い</strong>:</p><ul>
<li>Poll/Ping: トークンはクライアントがToken Endpointから取得（セキュア）</li>
<li>Push: トークンがプッシュされる（通知エンドポイントの保護が重要）</li>
</ul></div></div></details>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="クライアントrp">クライアント（RP）<a href="#クライアントrp" class="hash-link" aria-label="クライアント（RP） への直接リンク" title="クライアント（RP） への直接リンク"> ​</a></h4>
<p>□ user_codeが中間者攻撃とフィッシングを防ぐ仕組みを説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>仕組み</strong>:</p><ol>
<li>RPがランダムなuser_codeを生成（例: 123456）</li>
<li>ユーザーの消費デバイスに表示</li>
<li>CIBAリクエストにuser_codeを含める</li>
<li>ASが認証デバイスでuser_codeの入力を要求</li>
<li>ユーザーが123456を入力</li>
<li>ASが一致を確認</li>
</ol><p><strong>防ぐ脅威</strong>:</p><ul>
<li><strong>中間者攻撃</strong>: 攻撃者が認証リクエストを傍受してもuser_codeを知らないため認証できない</li>
<li><strong>フィッシング</strong>: ユーザーが取引内容とuser_codeの両方を確認することで、不審な操作を検出</li>
</ul><p><strong>推奨シナリオ</strong>:</p><ul>
<li>高額決済（100万円以上）</li>
<li>重要な個人情報変更</li>
<li>管理者権限の付与</li>
</ul></div></div></details>
<p>□ ポーリング間隔（interval）を遵守しなかった場合のリスクと対処を説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>リスク</strong>:</p><ol>
<li><strong>DoS攻撃</strong>: サーバー負荷の増大による可用性低下</li>
<li><strong>slow_downエラー</strong>: ASから間隔延長を要求される</li>
<li><strong>IPブロック</strong>: 悪質なクライアントとして遮断される可能性</li>
</ol><p><strong>正しい実装</strong>:</p><ol>
<li>ASから返されたintervalパラメータ（通常5秒）を遵守</li>
<li>slow_downエラー受信時は新しいintervalを使用、または現在の間隔に5秒追加</li>
<li>タイムアウト設定（expires_inを超えたら終了）</li>
<li>最大間隔の設 定（例: 30秒）</li>
</ol><p><strong>動的調整例</strong>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">初期: interval = 5秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slow_down受信: interval = 10秒（または+5秒）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">次回以降: 新しいintervalで待機</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<p>□ ID Tokenの検証で必須な項目（署名、iss、aud、exp、nonce）とその理由を説明できる</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>解答例</summary><div><div class="collapsibleContent_i85q"><p><strong>必須検証項目</strong>:</p><ol>
<li>
<p><strong>署名検証</strong></p>
<ul>
<li>理由: トークンの完全性を確認、改ざん検出</li>
<li>方法: ASの公開鍵で署名を検証</li>
</ul>
</li>
<li>
<p><strong>iss（発行者）</strong></p>
<ul>
<li>理由: 信頼できるASからのトークンか確認</li>
<li>検 証: 期待するAS URLと一致するか</li>
</ul>
</li>
<li>
<p><strong>aud（対象者）</strong></p>
<ul>
<li>理由: 自分宛てのトークンか確認</li>
<li>検証: client_idが含まれるか</li>
</ul>
</li>
<li>
<p><strong>exp（有効期限）</strong></p>
<ul>
<li>理由: 期限切れトークンの使用を防止</li>
<li>検証: 現在時刻 &lt; exp</li>
</ul>
</li>
<li>
<p><strong>nonce（リプレイ防止）</strong></p>
<ul>
<li>理由: ID Tokenリプレイ攻撃を防止</li>
<li>検証: セッションに保存したnonceと一致するか</li>
</ul>
</li>
</ol><p><strong>違反時のリスク</strong>:</p><ul>
<li>署名未検証: トークン偽造、なりすまし</li>
<li>nonce未検証: リプレイ攻撃、古いトークンの再利用</li>
</ul></div></div></details>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考リンク">参考リンク<a href="#参考リンク" class="hash-link" aria-label="参考リンク への直接リンク" title="参考リンク への直接リンク">​</a></h2>
<ul>
<li><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html" target="_blank" rel="noopener noreferrer">OpenID Connect CIBA Core 1.0</a></li>
<li><a href="https://openid.net/specs/openid-financial-api-ciba-1_0.html" target="_blank" rel="noopener noreferrer">FAPI-CIBA Profile</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc9449" target="_blank" rel="noopener noreferrer">RFC 9449 - DPoP</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8628" target="_blank" rel="noopener noreferrer">RFC 8628 - Device Authorization Grant</a></li>
<li><a href="https://openid.net/specs/openid-connect-core-1_0.html" target="_blank" rel="noopener noreferrer">OpenID Connect Core 1.0</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<p>CIBA は、認  証デバイスと消費デバイスを分離する革新的な認証フローです。以下のポイントを押さえて実装してください：</p>
<ol>
<li>
<p><strong>セキュリティ優先</strong></p>
<ul>
<li>クライアント認証は必須</li>
<li>binding_message で取引内容を明示</li>
<li>高リスク操作では user_code を使用</li>
</ul>
</li>
<li>
<p><strong>適切なモードの選択</strong></p>
<ul>
<li>シンプルな実装: Poll モード</li>
<li>リアルタイム性: Ping モード</li>
<li>最高のUX: Push モード</li>
</ul>
</li>
<li>
<p><strong>ユーザビリティ</strong></p>
<ul>
<li>binding_message を分かりやすく</li>
<li>タイムアウトを適切に設定</li>
<li>エラーメッセージを親切に</li>
</ul>
</li>
<li>
<p><strong>テストの徹底</strong></p>
<ul>
<li>正常フロー、エラーフロー、タイムアウトを全てテスト</li>
<li>セキュリティテストを実施</li>
<li>E2Eテストでユーザー体験を確認</li>
</ul>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/16-oauth-oidc-rfc/advanced/oidc-ciba.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced/grant-management"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">OAuth 2.0 Grant Management</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/advanced-identity/oid4vci"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">OpenID for Verifiable Credential Issuance（OID4VCI）</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目次" class="table-of-contents__link toc-highlight">目次</a></li><li><a href="#第1部-概要編" class="table-of-contents__link toc-highlight">第1部: 概要編</a><ul><li><a href="#ciba-とは" class="table-of-contents__link toc-highlight">CIBA とは？</a></li><li><a href="#なぜ-ciba-が必要なのか" class="table-of-contents__link toc-highlight">なぜ CIBA が必要なのか？</a></li><li><a href="#ユースケース" class="table-of-contents__link toc-highlight">ユースケース</a></li><li><a href="#ciba-と他の仕様との違い" class="table-of-contents__link toc-highlight">CIBA と他の仕様との違い</a></li><li><a href="#3つのモード" class="table-of-contents__link toc-highlight">3つのモード</a></li></ul></li><li><a href="#第2部-詳細編" class="table-of-contents__link toc-highlight">第2部: 詳細編</a><ul><li><a href="#エンドポイント" class="table-of-contents__link toc-highlight">エンドポイント</a></li><li><a href="#認証リクエスト" class="table-of-contents__link toc-highlight">認証リクエスト</a></li><li><a href="#認証レスポンス" class="table-of-contents__link toc-highlight">認証レスポンス</a></li><li><a href="#poll-モード" class="table-of-contents__link toc-highlight">Poll モード</a></li><li><a href="#ping-モード" class="table-of-contents__link toc-highlight">Ping モード</a></li><li><a href="#push-モード" class="table-of-contents__link toc-highlight">Push モード</a></li><li><a href="#ディスカバリーメタデータ" class="table-of-contents__link toc-highlight">ディスカバリーメタデータ</a></li><li><a href="#クライアント登録" class="table-of-contents__link toc-highlight">クライアント登録</a></li></ul></li><li><a href="#第3部-セキュリティ" class="table-of-contents__link toc-highlight">第3部: セキュリティ</a><ul><li><a href="#セキュリティ考慮事項" class="table-of-contents__link toc-highlight">セキュリティ考慮事項</a></li><li><a href="#クライアントrpのセキュリティ考慮事項" class="table-of-contents__link toc-highlight">クライアント（RP）のセキュリティ考慮事項</a></li><li><a href="#脅威モデルと攻撃シナリオ" class="table-of-contents__link toc-highlight">脅威モデルと攻撃シナリオ</a></li><li><a href="#よくあるciba要件違反とエラー" class="table-of-contents__link toc-highlight">よくあるCIBA要件違反とエラー</a></li><li><a href="#セキュリティベストプラクティス" class="table-of-contents__link toc-highlight">セキュリティベストプラクティス</a></li><li><a href="#セキュリティ理解度チェック" class="table-of-contents__link toc-highlight">セキュリティ理解度チェック</a></li></ul></li><li><a href="#参考リンク" class="table-of-contents__link toc-highlight">参考リンク</a></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>