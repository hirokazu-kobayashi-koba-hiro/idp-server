<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_11_learning/performance-tuning/local-vs-cloud" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">ローカル環境 vs クラウド環境 - 性能テストの実践 | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/performance-tuning/local-vs-cloud"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ローカル環境 vs クラウド環境 - 性能テストの実践 | IdP-Server Documentation"><meta data-rh="true" name="description" content="ローカル開発環境と商用環境（AWS等）における性能の違いを理解し、現実的な性能テストを実践するためのガイドです。"><meta data-rh="true" property="og:description" content="ローカル開発環境と商用環境（AWS等）における性能の違いを理解し、現実的な性能テストを実践するためのガイドです。"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/performance-tuning/local-vs-cloud"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/performance-tuning/local-vs-cloud" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/performance-tuning/local-vs-cloud" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.c56bff8e.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.6cae86c5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">アイデンティティ管理の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-fundamentals/modern-web-authz-authn">OAuth 2.0の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-tokens/id-token-jwt">OAuth 2.0トークン</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/openid-connect/oauth-oidc-basics">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-webauthn-passwordless">FIDO2/WebAuthn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/security/glossary">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/multi-tenancy/multi-tenancy-basics">マルチテナント</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/advanced-protocols/ciba-basics">高度なプロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/http-rest/http-basics">HTTP/REST</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jwt-jose/jwt-introduction">JWT/JOSE</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth/OIDC RFC学習</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/verifiable-credentials/">Verifiable Credentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/data-formats/">データフォーマット</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/web-session-basics">セッション管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/crypto/">暗号化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/kubernetes/">コンテナ/Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/linux/">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/networking/">ネットワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/">JVM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/java/">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/os-fundamentals/">OS基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/frameworks/">フレームワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/sdk/">SDK</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/clean-architecture/">クリーンアーキテクチャ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/">パフォーマンス・チューニング</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/">パフォーマンス・チューニング</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/first-step">基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/measurement">計測</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/application-layer">レイヤー別チューニング</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/local-vs-cloud">実践</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/local-vs-cloud">ローカル環境 vs クラウド環境 - 性能テストの実践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/measurement-techniques">性能計測の実践テクニック</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/load-test-simulation">負荷テスト実践シミュレーション</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/column-premature-optimization">コラム</a></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェ  クト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">学習（Learning）</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">パフォーマンス・チューニング</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">実践</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ローカル環境 vs クラウド環境 - 性能テストの実践</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">こ  のページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>ローカル環境 vs クラウド環境 - 性能テストの実践</h1></header>
<p>ローカル開発環境と商用環境（AWS等）における性能の違いを理解し、現実的な性能テストを実践するためのガイドです。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="なぜ環境差を理解すべきか">なぜ環境差を理解すべきか<a href="#なぜ環境差を理解すべきか" class="hash-link" aria-label="なぜ環境差を理解すべきか への直接リンク" title="なぜ環境差を理解すべきか への直接リンク">​</a></h2>
<p>「ローカルで10msだったのに、本番で200msもかかる」「ローカルで100ms改善できたのに、本番では誤差の範囲内だった」——こうした経験はありませんか？</p>
<p>環境差を理解せずにチューニングすると、無意味な最適化に時間を費やすことになります。まずは両環境のシステム構成を見比べて、何が違うのかを把握しましょう。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="システム構成の比較">システム構成の比較<a href="#システム構成の比較" class="hash-link" aria-label="システム構成の比較 への直接リンク" title="システム構成の比較 への直接リンク">​</a></h2>
<p>まず、ローカル環境とAWS本番環境の構成を並べて見てみましょう。</p>
<p>ローカル環境では、全てのコンポーネントが1台のマシン上で動作します。Docker Composeで起動したコンテナ同士は仮想ネットワークで接続され、通信遅延はほぼゼロです。</p>
<p>一方、AWS本番環境では、EKSクラスター、Aurora Global Database、ElastiCacheなどが物理的に分散配置されます。本ドキュメントで紹介する構成は、エンタープライズ向けの本格的な構成例です。</p>
<p><strong>  この構成が必要になる背景:</strong></p>
<table><thead><tr><th>要件</th><th>構成要素</th><th>目的</th></tr></thead><tbody><tr><td>高可用性</td><td>Multi-AZ配置</td><td>1つのAZが障害を起こしてもサービス継続</td></tr><tr><td>災害対策</td><td>Aurora Global Database</td><td>リージョン障害時に別リージョンで復旧（RTO &lt; 1分）</td></tr><tr><td>グローバル展開</td><td>マルチリージョンEKS</td><td>北米・アジアなど地理的に近い場所からの低レイテンシアクセス</td></tr><tr><td>スケーラビリティ</td><td>EKS + HPA</td><td>負荷に応じた自動スケールアウト</td></tr><tr><td>読み取り負荷分散</td><td>Aurora Reader</td><td>読み取りクエリをReaderにオフロード</td></tr></tbody></table>
<p>スタートアップや小規模サービスであれば、シングルリージョン + Multi-AZ で十分なケースも多いです。しかし、SLA 99.99%以上を求められるエンタープライズサービスや、グローバルにユーザーを抱えるサービスでは、このような構成が必要になります。</p>
<p><strong>重要なのは、この分散構成こそが性能特性の差を生み出す根本原因である</strong>ということです。可用性とパフォーマンスはトレードオフの関係にあり、高可用性を実現するための分散配置が、ネットワーク遅延という形でパフォーマンスに影響します。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ローカル環境">ローカル環境<a href="#ローカル環境" class="hash-link" aria-label="ローカル環境 への直接リンク" title="ローカル環境 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                        開発マシン (MacBook等)                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   Browser   │      │  k6 / curl  │      │   IDE       │         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────┬──────┘      └──────┬──────┘      └─────────────┘         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │ localhost:443      │                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         └────────┬───────────┘                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  ▼                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                     Docker Compose                             │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────┐                                               │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │    nginx    │ ← SSL終端、リバースプロキシ                  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │    :443     │   worker_connections: 1024 (デフォルト)      │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └──────┬──────┘                                               │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         │                                                      │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌──────▼──────┐   ┌─────────────┐   ┌─────────────┐          │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  App (JVM)  │   │  PostgreSQL │   │    Redis    │          │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  :8080      │   │  :5432      │   │  :6379      │          │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └──────┬──────┘     └──────┬──────┘   └──────┬──────┘          │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         │                 │                 │                  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         └────── docker network (~0.1ms) ────┘                  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────┐                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │              ローカルSSD (NVMe)              │                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  読み取り: ~50μs  書き込み: ~100μs          │                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────┘                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  特徴:                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・全コンポーネントが同一マシン上                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・ネットワーク遅延 ≈ 0                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・ストレージは超高速NVMe                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・外部APIはモック（即座に応答）                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・リソース競合なし                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・nginxのリソース制限（worker数、接続数）が先に限界に達しやすい   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws本番環境-eks--aurora-global-database">AWS本番環境 (EKS + Aurora Global Database)<a href="#aws本番環境-eks--aurora-global-database" class="hash-link" aria-label="AWS本番環境 (EKS + Aurora Global Database) への直接リンク" title="AWS本番環境 (EKS + Aurora Global Database) への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                     AWS Cloud                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───────────────────────────────────────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                     Primary Region (ap-northeast-1)                            │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                                │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         Internet                                                               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │             │                                                                  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │             ▼                                                                  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌─────────────────┐                                                         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │   API Gateway   │  ← レート制限、認証、スロットリング                    │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │   (HTTP API)    │    10,000 req/sec/region (デフォルト)                   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └────────┬────────┘                                                         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │            │ ~5-10ms                                                           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │            ▼                                                                   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌─────────────────┐                                                         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  ALB (Ingress)  │  ← SSL終端、ヘルスチェック                             │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └────────┬────────┘                                                         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │            │ ~1ms                                                              │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │            ▼                                                                   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌────────────────────────────────────────────────────────────────────────┐  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │                           EKS Cluster                                   │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  ┌──────────────────────────────────────────────────────────────────┐  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │                    Availability Zone A                            │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  ┌──────────────────────────────────────────────────────────┐    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │              Node (m5.large)                              │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │   ┌──────────────┐  ┌──────────────┐                     │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │   │ Pod: idp-app │  │ Pod: idp-app │  ← HPA でスケール  │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │   │ CPU: 500m    │  │ CPU: 500m    │                     │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │   │ Mem: 1Gi     │  │ Mem: 1Gi     │                     │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │   └──────────────┘  └──────────────┘                     │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  └──────────────────────────────────────────────────────────┘    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │     │  └──────────────────────────────────────────────────────────────────┘  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  ┌──────────────────────────────────────────────────────────────────┐  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │                    Availability Zone C                            │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  ┌──────────────────────────────────────────────────────────┐    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │              Node (m5.large)                              │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │   ┌──────────────┐  ┌──────────────┐                     │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │   │ Pod: idp-app │  │ Pod: idp-app │                     │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  │   └──────────────┘  └──────────────┘                     │    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │  └──────────────────────────────────────────────────────────┘    │  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  └──────────────────────────────────────────────────────────────────┘  │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └────────────────────────────────────────────────────────────────────────┘  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │            │                           │                                       │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │            │ 1-3ms                     │ 0.5-1ms                               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │            ▼                           ▼                                       │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌──────────────────────────┐  ┌─────────────────┐                           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ Aurora Global Database   │  │ ElastiCache     │                           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ (Primary Cluster)        │  │ Redis Cluster   │                           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  ┌────────┐ ┌────────┐  │  └─────────────────┘                           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │ Writer │ │ Reader │  │                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │ (AZ-A) │ │ (AZ-C) │  │  ← 同一リージョン内Reader: ~1ms               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  └────────┘ └────────┘  │                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └────────────┬─────────────┘                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                │                                                               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────┼───────────────────────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   │                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   │ レプリケーション (~1秒、ストレージレベル)                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   ▼                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                     Secondary Region (us-west-2)                                │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌──────────────────────────┐                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ Aurora Global Database   │  ← DR用 / 読み取りオフロード                   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ (Secondary Cluster)      │                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  ┌────────┐ ┌────────┐  │                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │ Reader │ │ Reader │  │  フェイルオーバー時にWriterに昇格可能           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  │ (AZ-A) │ │ (AZ-B) │  │  (RTO &lt; 1分)                                    │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  └────────┘ └────────┘  │                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └──────────────────────────┘                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                                 │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌────────────────────────────────────────────────────────────────────────┐   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  EKS Cluster (us-west-2) ← 北米ユーザー向け、低レイテンシ読み取り     │   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │   ┌──────────────┐  ┌──────────────┐                                   │   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │   │ Pod: idp-app │  │ Pod: idp-app │  Reader Endpointに接続           │   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │   └──────────────┘  └──────────────┘                                   │   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └────────────────────────────────────────────────────────────────────────┘   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  外部サービス連携 (NAT Gateway経由):                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 認証サービス │  │ 決済API     │  │ メール送信  │                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 50-200ms    │  │ 500-2000ms  │  │ 100-500ms   │                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────── ────┘  └─────────────┘  └─────────────┘                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  特徴:                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・Pod間通信もネットワーク経由（同一Node内でも~0.1ms）                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・Aurora Reader活用で読み取りスケールアウト可能                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・グローバルDBで別リージョンへの読み取りオフロード                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・クロスリージョン書き込みは Primary Region 経由（レイテンシ大）                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・レプリケーションラグ（~1秒）による読み取り整合性の考慮が必要                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="構成図から見る性能差異">構成図から見る性能差異<a href="#構成図から見る性能差異" class="hash-link" aria-label="構成図から見る性能差異 への直接リンク" title="構成図から見る性能差異 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-エントリーポイントnginx-vs-api-gateway">1. エントリーポイント（nginx vs API Gateway）<a href="#1-エントリーポイントnginx-vs-api-gateway" class="hash-link" aria-label="1. エントリーポイント（nginx vs API Gateway） への直接リンク" title="1. エントリーポイント（nginx vs API Gateway） への直接リンク">​</a></h3>
<p>ローカル環境ではnginx、AWS環境ではAPI Gatewayがエントリーポイントとなります。この違いが負荷テスト時に大きな差として現れます。</p>
<table><thead><tr><th>項目</th><th>ローカル (nginx)</th><th>AWS (API Gateway)</th></tr></thead><tbody><tr><td>同時接続数</td><td>worker_connections × workers (デフォルト1024)</td><td>10,000 req/sec/region</td></tr><tr><td>スケーラビリティ</td><td>Docker内リソース制限</td><td>フルマネージド、自動スケール</td></tr><tr><td>レート制限</td><td>なし（デフォルト）</td><td>バースト制限あり（設定可能）</td></tr><tr><td>レイテンシ</td><td>~0.1ms</td><td>~5-10ms</td></tr><tr><td>SSL終端</td><td>CPUバウンド</td><td>ハ ードウェアアクセラレーション</td></tr></tbody></table>
<p><strong>ローカル環境の制約:</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VUs増加時のボトルネック:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">─────────────────────────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VUs=50:   nginx余裕あり → App/DBがボトルネック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VUs=100:  nginx接続数増加 → まだ余裕</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VUs=150:  nginx worker_connections飽和 → 502 Bad Gateway発生</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">─────────────────────────────────────────────────────────</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>VUsを150程度まで上げると、アプリケーションやDBより先にnginxが限界を迎えることがあります。これはローカル特有の問題で、本番環境では発生しません。</p>
<p><strong>ローカルで高負荷テストを行う場合の対策:</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># nginx.conf でworker_connectionsを増やす</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">events {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker_connections 4096;  # デフォルト1024から増加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># upstreamのkeepalive設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream app {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server app:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keepalive 100;  # 接続を再利用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>本番環境（API Gateway）の特性:</strong></p>
<ul>
<li>自動スケールで接続数上限を気にする必要がほぼない</li>
<li>ただしリージョン単位のレート制限（デフォルト10,000 req/sec）に注意</li>
<li>必要に応じてService Quotasで上限引き上げ可能</li>
<li>レイテンシが5-10ms追加されるため、総レイテンシに影響</li>
</ul>
<p><strong>教訓:</strong></p>
<ul>
<li>ローカルでVUs=150でエラーが出ても、本番では問題ない可能性が高い</li>
<li>ローカルの負荷テストはnginxの制約を考慮して解釈する</li>
<li>本番の限界値を知りたい場合はステージング環境でテストする</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-ネットワークレイテンシ">2. ネットワークレイテンシ<a href="#2-ネットワークレイテンシ" class="hash-link" aria-label="2. ネットワークレイテンシ への直接リンク" title="2. ネットワークレイテンシ への直接リンク">​</a></h3>
<p>構成図を見ると、ローカルでは全てが同一マシン内で完結しているのに対し、AWSでは各コンポーネント間にネットワークが介在しています。</p>
<table><thead><tr><th>通信経路</th><th>ローカル</th><th>AWS (同一AZ)</th><th>AWS (クロスAZ)</th><th>AWS (クロスリージョン)</th></tr></thead><tbody><tr><td>App ↔ DB (Writer)</td><td>~0.1ms</td><td>1-3ms</td><td>2-5ms</td><td>70-150ms</td></tr><tr><td>App ↔ DB (Reader)</td><td>~0.1ms</td><td>1-3ms</td><td>1-3ms</td><td>1-3ms (ローカルReader)</td></tr><tr><td>App ↔ Redis</td><td>~0.1ms</td><td>0.5-1ms</td><td>1-2ms</td><td>-</td></tr><tr><td>App ↔ 外部API</td><td>0ms (モック)</td><td>20-200ms</td><td>20-200ms</td><td>20-200ms</td></tr></tbody></table>
<p><strong>ポイント:</strong></p>
<ul>
<li>ローカルのdocker networkは実質ゼロ遅延</li>
<li>AWSでは同一AZ内でも1-3msの遅延</li>
<li>Aurora Global DBではリージョン内Readerで読み取りスケールアウト</li>
<li>クロスリージョン書き込みはPrimary経由で高レイテンシ</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-ストレージ性能">3. ストレージ性能<a href="#3-ストレージ性能" class="hash-link" aria-label="3. ストレージ性能 への直接リンク" title="3. ストレージ性能 への直接リンク">​</a></h3>
<table><thead><tr><th>要素</th><th>ローカル (NVMe SSD)</th><th>AWS (EBS gp3)</th></tr></thead><tbody><tr><td>読み取りレイテンシ</td><td>~50μs</td><td>~1ms</td></tr><tr><td>書き込みレイテンシ</td><td>~100μs</td><td>~1-2ms</td></tr><tr><td>IOPS</td><td>制限なし</td><td>3000-16000 (設定依存)</td></tr><tr><td>スループット</td><td>~3GB/s</td><td>125-1000 MB/s</td></tr></tbody></table>
<p>ローカルSSDは桁違いに速いため、I/O待ちの問題がローカルでは見えません。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-リソース制限">4. リソース制限<a href="#4-リソース制限" class="hash-link" aria-label="4. リソース制限 への直接リンク" title="4. リソース制限 への直接リンク">​</a></h3>
<table><thead><tr><th>要素</th><th>ローカル</th><th>AWS (EKS)</th></tr></thead><tbody><tr><td>CPU</td><td>常にフル性能</td><td>requests/limitsで制限、スロットリング発生</td></tr><tr><td>メモリ</td><td>十分な容量</td><td>limitsを超えるとOOMKill</td></tr><tr><td>接続数</td><td>制限なし</td><td>RDSはメモリ依存で制限</td></tr><tr><td>帯域</td><td>制限なし</td><td>Nodeのインスタンスタイプで制限</td></tr></tbody></table>
<p><strong>EKS特有の考慮点:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Pod のリソース制限例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;500m&quot;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 0.5 CPU確保</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1000m&quot;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># 最大1 CPU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2Gi&quot;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 超過でOOMKill</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>requests</code>: 最低保証リソース。Nodeへの配置判断に使用</li>
<li><code>limits</code>: 上限。CPU超過→スロットリング、Memory超過→OOMKill</li>
<li>ローカルでは制限なしで動くコードが、本番ではスロットリングで遅延</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-マルチテナント影響">5. マルチテナント影響<a href="#5-マルチテナント影響" class="hash-link" aria-label="5. マルチテナント影響 への直接リンク" title="5. マルチテナント影響 への直接リンク">​</a></h3>
<p>ローカルでは自分だけがリソースを使用しますが、EKSでは：</p>
<ul>
<li>同一Node上の他Podとリソース競合</li>
<li>CPUスロットリングによるレイテンシ増加</li>
<li>RDSのバックアップ実行時に性能低下</li>
<li>HPAスケールアウト時のコールドスタート遅延</li>
<li>結果として性能に変動（ジッター）が発生し、P99が安定しない</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-eksスケーリングの遅延">6. EKSスケーリングの遅延<a href="#6-eksスケーリングの遅延" class="hash-link" aria-label="6. EKSスケーリングの遅延 への直接リンク" title="6. EKSスケーリングの遅延 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">リクエスト急増時:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">─────────────────────────────────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t=0s   負荷増加検知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t=15s  HPA がメトリクス取得（デフォルト15秒間隔）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t=15s  スケールアウト判断</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t=20s  新Pod起動開始</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t=30s  JVMウォームアップ中（まだ本来の性能が出ない）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t=60s  JIT最適化完了、本来の性能に到達</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">─────────────────────────────────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       → 約1分間は既存Podに負荷集中</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ローカルでは単一インスタンスで動かすため、このスケーリング遅延は見えません。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-aurora-global-database-の特性">7. Aurora Global Database の特性<a href="#7-aurora-global-database-の特性" class="hash-link" aria-label="7. Aurora Global Database の特性 への直接リンク" title="7. Aurora Global Database の特性 への直接リンク">​</a></h3>
<p>構成図のPrimary/Secondary Region間のレプリケーションに注目してください。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      Aurora Global Database の読み書き                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  書き込み (Write):                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────┐         ┌─────────────┐                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ App (Tokyo) │ ─1-3ms─→│   Writer    │  ← 常にPrimary Regionのみ       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────┘         │  (Tokyo)    │                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                          └─────────────┘                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────┐         ┌─────────────┐         ┌─────────────┐          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ App (US)    │ ─150ms─→│   Writer    │ ─1-3ms─→│   実際の    │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────┘         │  (Tokyo)    │         │   書き込み  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        ↑                 └─────────────┘         └─────────────┘          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   USからの書き込みは                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   Tokyoまで往復が必要                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  読み取り (Read):                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────┐         ┌─────────────┐                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ App (Tokyo) │ ─1-3ms─→│ Reader      │  ← リージョン内Readerで高速     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────┘         │ (Tokyo)     │                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                          └─────────────┘                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────┐         ┌─────────────┐                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ App (US)    │ ─1-3ms─→│ Reader      │  ← USリージョンのReaderで高速   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────┘         │ (US)        │    ただしレプリケーションラグあり │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                          └─────────────┘                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>レプリケーションラグの影響:</strong></p>
<table><thead><tr><th>シナリオ</th><th>ラグ</th><th>影響</th></tr></thead><tbody><tr><td>同一リージョン内Reader</td><td>~数ms</td><td>ほぼ即座に反映</td></tr><tr><td>クロスリージョンReader</td><td>~1秒</td><td>書き込み直後の読み取りで古いデータ</td></tr></tbody></table>
<p><strong>ローカルでは見えない問題:</strong></p>
<ul>
<li>Write-After-Read整合性の問題（書き込み直後に別リージョンで読むと古い値）</li>
<li>Secondary Regionでの書き込みは常にPrimary経由（高レイテンシ）</li>
<li>フェイルオーバー時の書き込み先切り替え</li>
</ul>
<p><strong>アプリケーション設計での考慮:</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 書き込み直後の読み取りはWriterエンドポイントを使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Transactional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public User createUser(UserCreateRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    User user = userRepository.save(request.toEntity());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ここでReaderから読むとラグで見つからない可能性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return user; // 保存したエンティティをそのまま返す</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="影響の具体例">影響の具体例<a href="#影響の具体例" class="hash-link" aria-label="影響の具体例 への直接リンク" title="影響の具体例 への直接リンク">​</a></h2>
<p>構成図を見ながら、具体的にどのような影響が出るか確認しましょう。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="n1クエリ問題">N+1クエリ問題<a href="#n1クエリ問題" class="hash-link" aria-label="N+1クエリ問題 への直接リンク" title="N+1クエリ問題 への直接リンク">​</a></h3>
<p>構成図の <code>App ↔ DB</code> の通信に注目してください。100件のユーザー一覧取得（関連データ含む）を例に考えます。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ローカル環境:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────┐        ┌───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   App   │ ─0.1ms→│ PostgreSQL│   1回のクエリ: 0.1ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────┘  ×100  └───────────┘   N+1 (100回): 10ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          docker network           → 「許容範囲かな」</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWS環境:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────┐        ┌───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   App   │ ─2ms──→│    RDS    │   1回のクエリ: 2ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────┘  ×100  └───────────┘   N+1 (100回): 200ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          VPC network              → SLO違反の可能性</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>教訓:</strong></p>
<ul>
<li>ローカルで10msの処理は本番で200msになりうる（20倍）</li>
<li>N+1は「クエリ数 × ネットワークレイテンシ」で影響が倍増</li>
<li>ローカルではJOINの効果が見えにくい</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="外部api呼び出し">外部API呼び出し<a href="#外部api呼び出し" class="hash-link" aria-label="外部API呼び出し への直接リンク" title="外部API呼び出し への直接リンク">​</a></h3>
<p>構成図下部の「外部サービス連携」に注目してください。ローカルではモックで即応答ですが、本番ではインターネット越しの通信になります。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ローカル環境:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────┐        ┌───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   App   │ ─0ms──→│   Mock    │   外部依存の影響が</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────┘        └───────────┘   完全に隠蔽される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">本番環境:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────┐        ┌─── Internet ───┐        ┌───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   App   │ ──────→│  20-2000ms     │───────→│ 外部API   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────┘        └────────────────┘        └───────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   タイムアウト、リトライ、レートリミット発生</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>本番で発生する遅延:</strong></p>
<ul>
<li>認証サービス: 50-200ms</li>
<li>決済API: 500-2000ms</li>
<li>メール送信: 100-500ms</li>
</ul>
<p><strong>対策:</strong></p>
<ul>
<li>遅延シミュレーション付きモックを使う</li>
<li>ステージング環境では実APIに接続</li>
<li>タイムアウト、リトライのテストを行う</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="接続プール枯渇">接続プール枯渇<a href="#接続プール枯渇" class="hash-link" aria-label="接続プール枯渇 への直接リンク" title="接続プール枯渇 への直接リンク">​</a></h3>
<p>構成図の <code>Pod ↔ Aurora</code> 間の接続に注目。ローカルでは接続数制限がほぼありませんが、EKS + Auroraでは制限があります。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ローカル環境:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────┐                    ┌───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   App   │ ─ 接続数制限なし ─→│ PostgreSQL│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────┘                    └───────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EKS + Aurora本番環境:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    ┌─────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────┐                        │     Aurora Cluster          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Pod (×4) │──┐                     │  ┌────────┐  ┌────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────┘  │  Writer Pool: 10    │  │ Writer │  │ Reader │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────┐  ├─────────────────────┼─→│ (2000) │  │ (2000) │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Pod (×4) │──┤  Reader Pool: 20    │  └────────┘  └────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────┘  │        ↓            │       ↑           ↑       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────┐  │  Writer: 40接続     │       │           │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Pod (×4) │──┘  Reader: 80接続     │   書き込み    読み取り    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────┘                        └─────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ↑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HPAでPod増加 → 接続数も増加 → 上限に近づく</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Aurora特有の考慮点:</strong></p>
<ul>
<li>Writer/Readerで別々の接続プールを持つ</li>
<li>Readerはオートスケーリングで増やせる（最大15インスタンス）</li>
<li>RDS Proxyで接続プーリングを効率化可能</li>
</ul>
<p><strong>問題が起きるシナリオ:</strong></p>
<ul>
<li>HPA でPod数が増加すると、接続プール × Pod数 で接続数が急増</li>
<li>Writerへの接続集中（読み取りもWriterに向けてしまう設定ミス）</li>
<li>ローカルの単一インスタンスでは発生しない問題</li>
</ul>
<p><strong>対策:</strong></p>
<ul>
<li>RDS Proxyの導入（接続の多重化）</li>
<li>読み取りは明示的にReader Endpointを使用</li>
<li>Pod単位の接続プールサイズを適切に設定</li>
<li><code>@Transactional(readOnly = true)</code> でReaderにルーティング</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="環境差を考慮した計測手法">環境差を考慮した計測手法<a href="#環境差を考慮した計測手法" class="hash-link" aria-label="環境差を考慮した計測手法 への直接リンク" title="環境差を考慮した計測手法 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ローカルで有効な計測">ローカルで有効な計測<a href="#ローカルで有効な計測" class="hash-link" aria-label="ローカルで有効な計測 への直接リンク" title="ローカルで有効な計測 への直接リンク">​</a></h3>
<p>ローカル環境での計測は、絶対値ではなく「相対値」や「回数」に注目します。</p>
<p><strong>有効な計測:</strong></p>
<ul>
<li>アルゴリズムの計算量（O(n) vs O(n²) の差）</li>
<li>メモリ使用量の変化</li>
<li>クエリ発行回数の変化</li>
<li>CPU処理時間の相対的な比較</li>
</ul>
<p><strong>計測ポイント:</strong></p>
<ul>
<li>クエリ数を数える（N+1の検出）</li>
<li>処理時間の「比」を見る（絶対値ではなく）</li>
<li>メモリプロファイリング</li>
<li>GC発生回数</li>
</ul>
<blockquote>
<p><strong>注意:</strong> ローカルの絶対値（ms）は参考程度に。ローカルで10ms → 本番で100msは普通です。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="本番相当環境で必要な計測">本番相当環境で必要な計測<a href="#本番相当環境で必要な計測" class="hash-link" aria-label="本番相当環境で必要な計測 への直接リンク" title="本番相当環境で必要な計測 への直接リンク">​</a></h3>
<p>ステージング環境で計測すべきこと:</p>
<ul>
<li>End-to-Endのレイテンシ</li>
<li>ネットワーク遅延込みのスループット</li>
<li>外部サービス連携の実際の応答時間</li>
<li>高負荷時の振る舞い</li>
<li>P99の値（外れ値の影響）</li>
</ul>
<p><strong>ステージング環境の要件:</strong></p>
<ul>
<li>本番と同じリージョン/AZ構成</li>
<li>本番と同等のインスタンスタイプ（またはスケール係数を把握）</li>
<li>本番相当のデータ量</li>
<li>外部サービスは実接続（またはサンドボックス）</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="実践-計測からチューニングまで">実践: 計測からチューニングまで<a href="#実践-計測からチューニングまで" class="hash-link" aria-label="実践: 計測からチューニングまで への直接リンク" title="実践: 計測からチューニングまで への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-ベースラインの確立">Step 1: ベースラインの確立<a href="#step-1-ベースラインの確立" class="hash-link" aria-label="Step 1: ベースラインの確立 への直接リンク" title="Step 1: ベースラインの確立 への直接リンク">​</a></h3>
<p>現状を正確に把握することから始めます。</p>
<p><strong>ローカルでのベースライン:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># k6でローカルテスト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k6 run --vus 10 --duration 30s test.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>記録する項目: P50, P95, P99、スループット (req/s)、エラーレート、SQLクエリ数</p>
<p><strong>ステージングでのベースライン:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 同じテストをステージングで実行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k6 run --vus 10 --duration 30s \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e BASE_URL=https://staging.example.com test.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>追加で記録: ネットワーク遅延の内訳、外部API呼び出し時間、DBコネクション使用率</p>
<p><strong>比較表を作成:</strong></p>
<table><thead><tr><th>指標</th><th>ローカル</th><th>ステージング</th><th>倍率</th></tr></thead><tbody><tr><td>P50</td><td>15ms</td><td>45ms</td><td>3x</td></tr><tr><td>P99</td><td>50ms</td><td>200ms</td><td>4x</td></tr><tr><td>スループット</td><td>500/s</td><td>200/s</td><td>0.4x</td></tr></tbody></table>
<p>この「倍率」が環境差の目安になります。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-ボトルネックの特定">Step 2: ボトルネックの特定<a href="#step-2-ボトルネックの特定" class="hash-link" aria-label="Step 2: ボトルネックの特定 への直接リンク" title="Step 2: ボトルネックの特定 への直接リンク">​</a></h3>
<p>時間の内訳を可視化して、どこに時間がかかっているかを把握します。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ローカル (50ms):                    ステージング (200ms):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ DB: 10ms (20%)                   ├─ DB: 80ms (40%) ← 支配的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ App処理: 35ms (70%)              ├─ App処理: 40ms (20%)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─ その他: 5ms (10%)                ├─ 外部API: 60ms (30%)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    └─ その他: 20ms (10%)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この例では:</p>
<ul>
<li>本番ではDBアクセスの最適化が効果大</li>
<li>ローカルでApp処理を最適化しても効果小</li>
</ul>
<p><strong>トレーシングツールを活用:</strong></p>
<ul>
<li>OpenTelemetry + Jaeger/Zipkin</li>
<li>AWS X-Ray</li>
<li>Datadog APM</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-環境に適した最適化">Step 3: 環境に適した最適化<a href="#step-3-環境に適した最適化" class="hash-link" aria-label="Step 3: 環境に適した最適化 への直接リンク" title="Step 3: 環境に適した最適化 への直接リンク">​</a></h3>
<p>ボトルネックの種類に応じて、最適化の優先度を決めます。</p>
<p><strong>ネットワーク遅延が支配的な場合（クラウド典型）:</strong></p>
<table><thead><tr><th>効果</th><th>施策</th></tr></thead><tbody><tr><td>高</td><td>N+1クエリの解消（JOIN、バッチ取得）</td></tr><tr><td>高</td><td>キャッシュの導入（Redis、アプリキャッシュ）</td></tr><tr><td>高</td><td>外部API呼び出しの並列化</td></tr><tr><td>高</td><td>DB接続プールの最適化</td></tr><tr><td>低</td><td>アルゴリズムの微最適化</td></tr><tr><td>低</td><td>オブジェクト生成の削減</td></tr></tbody></table>
<p><strong>CPU処理が支配的な場合（計算集約型）:</strong></p>
<table><thead><tr><th>効果</th><th>施策</th></tr></thead><tbody><tr><td>高</td><td>アルゴリズムの改善</td></tr><tr><td>高</td><td>計算結果のキャッシュ</td></tr><tr><td>高</td><td>並列処理の活用</td></tr><tr><td>低</td><td>DB最適化（ボトルネックでないため）</td></tr></tbody></table>
<p><strong>リソース制限が支配的な場合（スケール問題）:</strong></p>
<table><thead><tr><th>効果</th><th>施策</th></tr></thead><tbody><tr><td>高</td><td>スケールアップ/アウト</td></tr><tr><td>高</td><td>IOPSの増加（gp2→gp3、io1）</td></tr><tr><td>高</td><td>接続プールサイズの調整</td></tr><tr><td>低</td><td>コードの最適化だけではリソース不足は解消しない</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-効果検証">Step 4: 効果検証<a href="#step-4-効果検証" class="hash-link" aria-label="Step 4: 効果検証 への直接リンク" title="Step 4: 効果検証 への直接リンク">​</a></h3>
<p><strong>良くない評価方法:</strong></p>
<ul>
<li>ローカルだけで「30%改善！」と判断</li>
<li>1回の計測で判断</li>
<li>平均値だけで判断</li>
</ul>
<p><strong>正しい評価方法:</strong></p>
<ul>
<li>Before/After を同じ条件で比較</li>
<li>ローカルとステージング両方で計測</li>
<li>複数回実行して統計的に評価</li>
<li>P50だけでなくP99も確認</li>
</ul>
<p><strong>評価シートの例:</strong></p>
<p>改善内容: N+1クエリをJOINに変更</p>
<table><thead><tr><th>環境</th><th>指標</th><th>Before</th><th>After</th><th>改善率</th></tr></thead><tbody><tr><td>ローカル</td><td>P50</td><td>15ms</td><td>12ms</td><td>20%</td></tr><tr><td>ローカル</td><td>P99</td><td>50ms</td><td>40ms</td><td>20%</td></tr><tr><td>ステージング</td><td>P50</td><td>180ms</td><td>60ms</td><td><strong>67%</strong></td></tr><tr><td>ステージング</td><td>P99</td><td>400ms</td><td>120ms</td><td><strong>70%</strong></td></tr></tbody></table>
<p>→ ステージング環境での 改善を重視して判断</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ケーススタディ">ケーススタディ<a href="#ケーススタディ" class="hash-link" aria-label="ケーススタディ への直接リンク" title="ケーススタディ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="事例1-マスタデータのキャッシュ導入">事例1: マスタデータのキャッシュ導入<a href="#事例1-マスタデータのキャッシュ導入" class="hash-link" aria-label="事例1: マスタデータのキャッシュ導入 への直接リンク" title="事例1: マスタデータのキャッシュ導入 への直接リンク">​</a></h3>
<p><strong>問題:</strong>
リクエストのたびに設定情報をDBから取得していた。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ローカル:  App ──0.5ms──→ DB (設定取得)  → 気にならない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">本番:      Pod ──2-3ms──→ Aurora          → リクエスト多発時に累積</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>ローカル: 0.5ms/回 → 許容範囲に見える</li>
<li>本番: 2-3ms/回 × 1000リクエスト/秒 = 2-3秒/秒をDB待ちに消費</li>
</ul>
<p><strong>解決:</strong></p>
<ul>
<li>アプリケーション層でキャッシュ導入（TTL 5分）</li>
<li>設定変更時にキャッシュ無効化</li>
</ul>
<p><strong>効果:</strong></p>
<ul>
<li>キャッシュヒット時: ~0ms（メモリアクセスのみ）</li>
<li>設定変更頻度が低いため、99%以上ヒット</li>
</ul>
<p><strong>教訓:</strong></p>
<ul>
<li>ローカルでは問題に見えなくても、本番では影響大</li>
<li>変更頻度の低いマスタデータはキャッシュ効果が高い</li>
<li>「毎回DBから取得しても0.5msだから大丈夫」は本番では通用しない</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="事例2-集計処理のクエリ最適化">事例2: 集計処理のクエリ最適化<a href="#事例2-集計処理のクエリ最適化" class="hash-link" aria-label="事例2: 集計処理のクエリ最適化 への直接リンク" title="事例2: 集計処理のクエリ最適化 への直接リンク">​</a></h3>
<p><strong>Before:</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- JSONBカラムを読み取り、アプリで更新して書き戻し</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> stats </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">statistics</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> tenant_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- アプリ側でJSONを更新</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">statistics</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> stats </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ? </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> tenant_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ?</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>処理時間: 約10ms/回（READ + WRITE + ロック待ち）</li>
</ul>
<p><strong>After:</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 行ベースのupsert（1クエリで完結）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> statistics_events </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tenant_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">date</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ?</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_DATE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> CONFLICT </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tenant_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">date</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> statistics_events</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>処理時間: 約0.5ms/回</li>
</ul>
<p><strong>改善率:</strong> 約20倍（10ms → 0.5ms）</p>
<p><strong>教訓:</strong></p>
<ul>
<li>READ → 加工 → WRITE パターンはネットワーク往復が2回発生</li>
<li>DB側で完結できる処理はDBに任せる</li>
<li>ローカルでは往復2回でも2ms程度だが、本番では20ms以上になりうる</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="事例3-外部api呼び出しの並列化">事例3: 外部API呼び出しの並列化<a href="#事例3-外部api呼び出しの並列化" class="hash-link" aria-label="事例3: 外部API呼び出しの並列化 への直接リンク" title="事例3: 外部API呼び出しの並列化 への直接リンク">​</a></h3>
<p><strong>Before:</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 直列呼び出し</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserInfo user = userService.getUser(id);           // 50ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Order&gt; orders = orderService.getOrders(id);   // 80ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PaymentInfo payment = paymentService.getInfo(id);  // 60ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 合計: 190ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>After:</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 並列呼び出し</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CompletableFuture&lt;UserInfo&gt; userFuture =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CompletableFuture.supplyAsync(() -&gt; userService.getUser(id));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CompletableFuture&lt;List&lt;Order&gt;&gt; ordersFuture =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CompletableFuture.supplyAsync(() -&gt; orderService.getOrders(id));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CompletableFuture&lt;PaymentInfo&gt; paymentFuture =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CompletableFuture.supplyAsync(() -&gt; paymentService.getInfo(id));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CompletableFuture.allOf(userFuture, ordersFuture, paymentFuture).join();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 合計: 80ms（最も遅いAPIの時間）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>改善率:</strong> 2.4倍（190ms → 80ms）</p>
<p><strong>教訓:</strong></p>
<ul>
<li>ローカルのモックでは全て0msなので並列化の効果が見えない</li>
<li>依存関係のない外部呼び出しは並列化で大幅改善</li>
<li>本番環境でのみ効果が発揮される最適化パターン</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="チェックリスト">チェックリスト<a href="#チェックリスト" class="hash-link" aria-label="チェックリスト への直接リンク" title="チェックリスト への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ローカルテスト時">ローカルテスト時<a href="#ローカルテスト時" class="hash-link" aria-label="ローカルテスト時 への直接リンク" title="ローカルテスト時 への直接リンク">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->クエリ発行回数を確認したか（N+1検出）</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->メモリ使用量の増加傾向を確認したか</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->処理時間は「相対値」で評価しているか</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->絶対値を過信していないか</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ステージングテスト時">ステージングテスト時<a href="#ステージングテスト時" class="hash-link" aria-label="ステージングテスト時 への直接リンク" title="ステージングテスト時 への直接リンク">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->本番と同等のネットワーク構成か</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->本番相当のデータ量があるか</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->外部サービスは実接続（またはサンドボックス）か</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->P99まで計測しているか</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->複数回実行して平均を取っているか</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="チューニング判断時">チューニング判断時<a href="#チューニング判断時" class="hash-link" aria-label="チューニング判断時 への直接リンク" title="チューニング判断時 への直接リンク">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->ボトルネックの内訳を把握しているか</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->ネットワーク遅延 vs CPU処理 vs I/O 待ちの比率を知っているか</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->最適化対象が本当にボトルネックか</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->ローカルとステージング両方で効果を検証したか</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<p><strong>ローカル環境の役割:</strong></p>
<ul>
<li>クエリ数、アルゴリズムの問題発見</li>
<li>迅速な試行錯誤</li>
<li>相対的な改善確認</li>
<li>ただし絶対的な性能値は参考程度</li>
</ul>
<p><strong>本番相当環境の役割:</strong></p>
<ul>
<li>実際の性能値の計測</li>
<li>ネットワーク遅延込みの評価</li>
<li>高負荷時の振る舞い確認</li>
<li>SLO達成可否の判断</li>
<li><strong>最終判断は必ずここで行う</strong></li>
</ul>
<p><strong>心構え:</strong></p>
<ul>
<li>「ローカルで速い」は「本番で速い」ではない</li>
<li>環境差の「倍率」を把握しておく</li>
<li>本番でのボトルネックに集中する</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="次のステップ">次のステップ<a href="#次のステップ" class="hash-link" aria-label="次のステップ への直接リンク" title="次のステップ への直接リンク">​</a></h2>
<ul>
<li><a href="/idp-server/docs/content_11_learning/performance-tuning/measurement-techniques">性能計測の実践テクニック</a> - 具体的な計測手法とツールの使い方</li>
<li><a href="/idp-server/docs/content_11_learning/performance-tuning/application-layer">アプリケーション層</a> - アプリレベルのチューニング</li>
<li><a href="/idp-server/docs/content_11_learning/performance-tuning/database-layer">データベース層</a> - DBのチューニング</li>
<li><a href="/idp-server/docs/content_11_learning/performance-tuning/column-premature-optimization">コラム: 早すぎる最適化は諸悪の根源</a> - いつ最適化すべきか</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/26-performance-tuning/09-local-vs-cloud.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_11_learning/performance-tuning/os-layer"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">OS/インフラ層のチューニング</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_11_learning/performance-tuning/measurement-techniques"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">性能計測の実践テクニック</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#なぜ環境差を理解すべきか" class="table-of-contents__link toc-highlight">なぜ環境差を理解すべきか</a></li><li><a href="#システム構成の比較" class="table-of-contents__link toc-highlight">システム構成の比較</a><ul><li><a href="#ローカル環境" class="table-of-contents__link toc-highlight">ローカル環境</a></li><li><a href="#aws本番環境-eks--aurora-global-database" class="table-of-contents__link toc-highlight">AWS本番環境 (EKS + Aurora Global Database)</a></li></ul></li><li><a href="#構成図から見る性能差異" class="table-of-contents__link toc-highlight">構成図から見る性能差異</a><ul><li><a href="#1-エントリーポイントnginx-vs-api-gateway" class="table-of-contents__link toc-highlight">1. エントリーポイント（nginx vs API Gateway）</a></li><li><a href="#2-ネットワークレイテンシ" class="table-of-contents__link toc-highlight">2. ネットワークレイテンシ</a></li><li><a href="#3-ストレージ性能" class="table-of-contents__link toc-highlight">3. ストレージ性能</a></li><li><a href="#4-リソース制限" class="table-of-contents__link toc-highlight">4. リソース制限</a></li><li><a href="#5-マルチテナント影響" class="table-of-contents__link toc-highlight">5. マルチテナント影響</a></li><li><a href="#6-eksスケーリングの遅延" class="table-of-contents__link toc-highlight">6. EKSスケーリングの遅延</a></li><li><a href="#7-aurora-global-database-の特性" class="table-of-contents__link toc-highlight">7. Aurora Global Database の特性</a></li></ul></li><li><a href="#影響の具体例" class="table-of-contents__link toc-highlight">影響の具体例</a><ul><li><a href="#n1クエリ問題" class="table-of-contents__link toc-highlight">N+1クエリ問題</a></li><li><a href="#外部api呼び出し" class="table-of-contents__link toc-highlight">外部API呼び出し</a></li><li><a href="#接続プール枯渇" class="table-of-contents__link toc-highlight">接続プール枯渇</a></li></ul></li><li><a href="#環境差を考慮した計測手法" class="table-of-contents__link toc-highlight">環境差を考慮した計測手法</a><ul><li><a href="#ローカルで有効な計測" class="table-of-contents__link toc-highlight">ローカルで有効な計測</a></li><li><a href="#本番相当環境で必要な計測" class="table-of-contents__link toc-highlight">本番相当環境で必要な計測</a></li></ul></li><li><a href="#実践-計測からチューニングまで" class="table-of-contents__link toc-highlight">実践: 計測からチューニングまで</a><ul><li><a href="#step-1-ベースラインの確立" class="table-of-contents__link toc-highlight">Step 1: ベースラインの確立</a></li><li><a href="#step-2-ボトルネックの特定" class="table-of-contents__link toc-highlight">Step 2: ボトルネックの特定</a></li><li><a href="#step-3-環境に適した最適化" class="table-of-contents__link toc-highlight">Step 3: 環境に適した最適化</a></li><li><a href="#step-4-効果検証" class="table-of-contents__link toc-highlight">Step 4: 効果検証</a></li></ul></li><li><a href="#ケーススタディ" class="table-of-contents__link toc-highlight">ケーススタディ</a><ul><li><a href="#事例1-マスタデータのキャッシュ導入" class="table-of-contents__link toc-highlight">事例1: マスタデータのキャッシュ導入</a></li><li><a href="#事例2-集計処理のクエリ最適化" class="table-of-contents__link toc-highlight">事例2: 集計処理のクエリ最適化</a></li><li><a href="#事例3-外部api呼び出しの並列化" class="table-of-contents__link toc-highlight">事例3: 外部API呼び出しの並列化</a></li></ul></li><li><a href="#チェックリスト" class="table-of-contents__link toc-highlight">チェックリスト</a><ul><li><a href="#ローカルテスト時" class="table-of-contents__link toc-highlight">ローカルテスト時</a></li><li><a href="#ステージングテスト時" class="table-of-contents__link toc-highlight">ステージングテスト時</a></li><li><a href="#チューニング判断時" class="table-of-contents__link toc-highlight">チューニ  ング判断時</a></li></ul></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a></li><li><a href="#次のステップ" class="table-of-contents__link toc-highlight">次のステップ</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>