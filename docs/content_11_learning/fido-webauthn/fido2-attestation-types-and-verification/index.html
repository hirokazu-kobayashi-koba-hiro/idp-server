<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_11_learning/fido-webauthn/fido2-attestation-types-and-verification" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Attestation - 認証器の信頼性証明 | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/fido-webauthn/fido2-attestation-types-and-verification"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Attestation - 認証器の信頼性証明 | IdP-Server Documentation"><meta data-rh="true" name="description" content="---"><meta data-rh="true" property="og:description" content="---"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/fido-webauthn/fido2-attestation-types-and-verification"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/fido-webauthn/fido2-attestation-types-and-verification" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/fido-webauthn/fido2-attestation-types-and-verification" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.b1f8384d.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.49a2be9f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">アイデンティティ管理の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-fundamentals/modern-web-authz-authn">OAuth 2.0の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-tokens/id-token-jwt">OAuth 2.0トークン</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/openid-connect/oauth-oidc-basics">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-webauthn-passwordless">FIDO2/WebAuthn</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-webauthn-passwordless">FIDO2・WebAuthn パスワードレス認証</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-architecture-rp-browser-authenticator">FIDO2アーキテクチャ - RP・Webブラウザー・認証器の関係</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-passkey-discoverable-credential">FIDO2・パスキー・Discoverable Credentialの基本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-registration-flow-interface">FIDO2 登録フローとインターフェース詳細</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-authentication-flow-interface">FIDO2 認証フローとインターフェース詳細</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-webauthn-level-specification-evolution">FIDO2・WebAuthn仕様の変遷（Level 1 → 2 → 3）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-identifiers-idp-integration">FIDO2 識別子とIdP統合 - userId, username, credentialId の関係</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-aaguid-authenticator-identification">AAGUID - 認証器のモデル識別子</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-attestation-types-and-verification">Attestation - 認証器の信頼性証明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-attestation-production-considerations">商用環境でのアテステーション検証</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-metadata-service">FIDO Metadata Service (MDS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-cross-device-authentication">クロスデバイス認証</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-security-considerations">FIDO2 セキュリティ考慮事項</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-key-management-security">パスキーの鍵管理と安全性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-performance-analysis">FIDO2/WebAuthn パフォーマンス分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-faq-troubleshooting">FIDO2/WebAuthn FAQ・トラブルシューティング</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/security/glossary">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/multi-tenancy/multi-tenancy-basics">マルチテナント</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/advanced-protocols/ciba-basics">高度なプロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/http-rest/http-basics">HTTP/REST</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jwt-jose/jwt-introduction">JWT/JOSE</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth/OIDC RFC学習</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/verifiable-credentials/">Verifiable Credentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/data-formats/">データフォーマット</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/web-session-basics">セッション管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/crypto/">暗号化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/kubernetes/">コンテナ/Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/linux/">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/networking/">ネットワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/">JVM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/java/">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/os-fundamentals/">OS基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/frameworks/">フレームワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/sdk/">SDK</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/clean-architecture/">クリーンアーキテクチャ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/">パフォーマンス・チューニング</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">学習（Learning）</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">FIDO2/WebAuthn</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Attestation - 認証器の信頼性証明</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>Attestation - 認証器の信頼性証明</h1></header>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="概要">概要<a href="#概要" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h2>
<p><strong>Attestation（アテステーション）</strong> は、登録時に認証器が「自分が正規の認証器である」ことを証明する仕組みです。</p>
<p><strong>このドキュメントで学べること</strong>:</p>
<ul>
<li>Attestation の目的と必要性</li>
<li>Attestation Conveyance Preference（none, indirect, direct, enterprise）</li>
<li>Attestation Statement Format（packed, tpm, android-key, fido-u2f, apple, none）</li>
<li>各タイプでの attestationObject の構造差異</li>
<li>RP   側での検証処理の違い</li>
<li>証明書チェーン検証の仕組みと TrustStore</li>
<li>エンタープライズでの使い分けとプライバシーの考慮</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="attestation-とは">Attestation とは<a href="#attestation-とは" class="hash-link" aria-label="Attestation とは への直接リンク" title="Attestation とは への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本概念">基本概念<a href="#基本概念" class="hash-link" aria-label="基本概念 への直接リンク" title="基本概念 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         Attestation の役割                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【問題】                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  RP は登録時に受け取った公開鍵が「本当に正規の認証器で生成されたか」を       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  どうやって確認するか？                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【解決策: Attestation】                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  認証器が製造時に埋め込まれた「Attestation 秘密鍵」で署名することで、        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  認証器の正当性を証明する                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                        認証器（製造時）                              │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌──── ─────────────────┐  ┌─────────────────────┐                  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ Attestation 秘密鍵  │  │ Attestation 証明書  │                  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ (製造元が埋め込み)   │  │ (製造元のCA署名)    │                  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────────────┘  └─────────────────────┘                  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                        登録時の流れ                                  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  1. 認証器が新しい鍵ペアを生成                                        │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  2. 公開鍵 + authenticatorData を Attestation 秘密鍵で署名            │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  3. 署名 + Attestation 証明書 を RP に送信                            │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  4. RP は証明書チェーンを検証 → 正規の認証器と確認                    │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="なぜ-attestation-検証が必要か">なぜ Attestation 検証が必要か<a href="#なぜ-attestation-検証が必要か" class="hash-link" aria-label="なぜ Attestation 検証が必要か への直接リンク" title="なぜ Attestation 検証が必要か への直接リンク">​</a></h3>
<p>Attestation 検証の必要性はサービスの性質によって異なります。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    Attestation 検証が不要なケース                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【一般ユーザー向けサービス】（SNS、ECサイト、ブログ等）                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  要件: パスワードより安全な認証手段を提供したい                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → Attestation 検証は不要                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - どんな認証器でも「パスワードよりマシ」                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - ユーザーのプライバシーを優先（認証器の種類を追跡しない）                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 認証器の選択肢を狭めるとユーザー離脱につながる                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    Attestation 検証が必要なケース                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【ケース1: 企業での認証器管理】                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ────────────────────────────────────────────────────────────────────────── │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  要件: 会社が配布した認証器のみを許可したい                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  課題（Attestation 検証なし）:                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - AAGUID は authenticatorData に含まれるので取得は可能                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - しかし、悪意のあるソフトウェア認証器が AAGUID を詐称できる              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 「YubiKey の AAGUID」を名乗る偽認証器を検出できない                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  解決（Attestation 検証あり）:                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 証明書チェーンを検証し、AAGUID が偽装されていないことを確認             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - YubiKey の Attestation 証明書は Yubico の CA でしか発行されない         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 偽の AAGUID を持つ認証器は証明書検証で拒否される                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【ケース2: 金融・医療などの高セキュリティ環境】                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ────────────────────────────────────────────────────────────────────────── │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  要件: 一定のセキュリティ基準を満たした認証器のみを許可したい                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  課題（Attestation 検証なし）:                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - AAGUID から認証器の種類はわかる                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - しかし、その AAGUID が本物かどうかは検証できない                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 監査で「FIDO L2 認定の認証器である」ことを証明できない                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  解決（Attestation 検証あり）:                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 証明書チェーンを検証し、AAGUID の正当性を確認                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - FIDO Metadata Service で認証レベル（L1/L2/L3）を照合                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 「ハードウェア保護（L2以上）の認証器のみ」を確実に強制                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【ケース3: 脆弱性発覚時の対応】                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ────────────────────────────────────────────────────────────────────────── │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  要件: 脆弱性が発見された認証器を使っているユーザーを特定したい               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  補足:                                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - このケースは「登録時に AAGUID を保存していたか」が重要                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Attestation 検証をしていれば、AAGUID は信頼できる値として保存済み       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 検証なしでも AAGUID は取得可能だが、詐称されている可 能性がある           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  解決（Attestation 検証あり）:                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 登録時に検証済みの AAGUID で対象ユーザーを正確に特定                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 対象ユーザーのみに通知・クレデンシャル無効化                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ-attestation-検証の要否判断">まとめ: Attestation 検証の要否判断<a href="#まとめ-attestation-検証の要否判断" class="hash-link" aria-label="まとめ: Attestation 検証の要否判断 への直接リンク" title="まとめ: Attestation 検証の要否判断 への直接リンク">​</a></h3>
<table><thead><tr><th>質問</th><th>Yes →</th><th>No →</th></tr></thead><tbody><tr><td>認証器の種類を制限したいか？</td><td>検証必要</td><td>不要</td></tr><tr><td>FIDO 認定レベルを確認したいか？</td><td>検証必要</td><td>不要</td></tr><tr><td>脆弱性発覚時に影響範囲を特定したいか？</td><td>検証必要</td><td>不要</td></tr><tr><td>ユーザーのプライバシーを最優先するか？</td><td>検証不要</td><td>-</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="attestation-conveyance-preference">Attestation Conveyance Preference<a href="#attestation-conveyance-preference" class="hash-link" aria-label="Attestation Conveyance Preference への直接リンク" title="Attestation Conveyance Preference への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rp-が指定するオプション">RP が指定するオプション<a href="#rp-が指定するオプション" class="hash-link" aria-label="RP が指定するオプション への直接リンク" title="RP が指定するオプション への直接リンク">​</a></h3>
<p>登録リクエスト時に RP が <code>attestation</code> パラメータで指定します。</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">publicKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">challenge</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> challenge</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">rp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Example&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">displayName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> displayName </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">pubKeyCredParams</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;public-key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">alg</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Attestation Conveyance Preference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">attestation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;none&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// &quot;none&quot; | &quot;indirect&quot; | &quot;direct&quot; | &quot;enterprise&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピ ー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4つのオプション">4つのオプション<a href="#4つのオプション" class="hash-link" aria-label="4つのオプション への直接リンク" title="4つのオプション への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    Attestation Conveyance Preference                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  &quot;none&quot; (デフォルト・最も一般的)                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─────────────────────────────────────────────────────────────────────┤   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - RP は Attestation を要求しない                                     │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 認証器は Attestation Statement を省略可能                          │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - AAGUID は 00000000-0000-0000-0000-000000000000 になることがある    │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - プライバシー保護が最優先                                           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 用途: 一般向け Web サービス、パスワードレス認証                    │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────── ───────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  &quot;indirect&quot;                                                           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─────────────────────────────────────────────────────────────────────┤   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - RP は Attestation を希望するが、匿名化を許容                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - クライアント/認証器は Attestation を匿名化してもよい               │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - Anonymization CA による再署名が可能                                │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 用途: セキュリティとプライバシーのバランスが必要な場合             │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────── ─────────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  &quot;direct&quot;                                                             │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─────────────────────────────────────────────────────────────────────┤   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - RP は完全な Attestation Statement を要求                           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 認証器の証明書チェーンがそのまま送信される                         │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - AAGUID が正確に取得可能                                            │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 用途: 認証器の種類を厳密に管理したい企業環境                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  &quot;enterprise&quot; (Level 2 で追加)                                        │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─────────────────────────────────────────────────────────────────────┤   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 企業が管理する認証器向けの特別なモード                             │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 認証器の個体識別情報を含めることが可能                              │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - RP と認証器の事前合意が必要（RP ID の許可リスト）                  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - プライバシー: 企業環境では従業員の同意のもと使用                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  - 用途: 認証器の資産管理、紛失時の特定                               │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="比較表">比較表<a href="#比較表" class="hash-link" aria-label="比較表 への直接リンク" title="比較表 への直接リンク">​</a></h3>
<table><thead><tr><th>オプション</th><th>プライバシー</th><th>認証器特定</th><th>証明書検証</th><th>主な用途</th></tr></thead><tbody><tr><td><code>none</code></td><td>最高</td><td>不可</td><td>不要</td><td>一般向けサービス</td></tr><tr><td><code>indirect</code></td><td>高</td><td>限定的</td><td>オプション</td><td>バランス重視</td></tr><tr><td><code>direct</code></td><td>低</td><td>可能（モデル）</td><td>推奨</td><td>企業環境</td></tr><tr><td><code>enterprise</code></td><td>最低</td><td>可能（個体）</td><td>必須</td><td>資産管理</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="attestation-statement-format">Attestation Statement Format<a href="#attestation-statement-format" class="hash-link" aria-label="Attestation Statement Format への直接リンク" title="Attestation Statement Format への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概要-1">概要<a href="#概要-1" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h3>
<p>認証器が生成する Attestation Statement の形式は、認証器の種類によって異なります。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    Attestation Statement Format                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├───────────────────────────────────────────── ────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attestationObject (CBOR) の構造:                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  {                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;fmt&quot;: &quot;packed&quot;,           // ← Attestation Statement Format             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;authData&quot;: &lt;bytes&gt;,       // authenticatorData                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;attStmt&quot;: {               // ← 形式によって構造が異なる                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      &quot;alg&quot;: -7,                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      &quot;sig&quot;: &lt;bytes&gt;,                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      &quot;x5c&quot;: [&lt;cert&gt;, ...]     // 証明書チェーン（形式による）               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    }                                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="各形式の詳細">各形式の詳細<a href="#各形式の詳細" class="hash-link" aria-label="各形式の詳細 への直接リンク" title="各形式の詳細 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-packed---汎用形式">1. <code>packed</code> - 汎用形式<a href="#1-packed---汎用形式" class="hash-link" aria-label="1-packed---汎用形式 への直接リンク" title="1-packed---汎用形式 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  fmt: &quot;packed&quot;                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  最も一般的な形式。FIDO2 認定認証器の標準。                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【Full Attestation（証明書あり）】                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attStmt: {                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;alg&quot;: -7,                    // ES256 (ECDSA with SHA-256)              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;sig&quot;: &lt;signature&gt;,           // authenticatorData + clientDataHash 署名 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;x5c&quot;: [                      // 証明書チェーン                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      &lt;attestation cert&gt;,         // 認証器の Attestation 証明書            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      &lt;intermediate CA cert&gt;,     // 中間 CA（オプション）                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      ...                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    ]                                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【Self Attestation（証明書なし）】                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attStmt: {                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;alg&quot;: -7,                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;sig&quot;: &lt;signature&gt;            // 生成した秘密鍵自身で署名                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    // x5c なし                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  対応認証器: YubiKey, Feitian, SoloKey 等                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-tpm---tpm-形式">2. <code>tpm</code> - TPM 形式<a href="#2-tpm---tpm-形式" class="hash-link" aria-label="2-tpm---tpm-形式 への直接リンク" title="2-tpm---tpm-形式 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  fmt: &quot;tpm&quot;                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TPM (Trusted Platform Module) を使用する認証器向け。                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  主に Windows Hello で使用。                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attStmt: {                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;ver&quot;: &quot;2.0&quot;,                 // TPM バージョン                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;alg&quot;: -7,                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;sig&quot;: &lt;signature&gt;,                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;x5c&quot;: [&lt;AIK cert&gt;, ...],     // AIK (Attestation Identity Key) 証明書  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;certInfo&quot;: &lt;TPMS_ATTEST&gt;,    // TPM 固有の認証情報                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;pubArea&quot;: &lt;TPMT_PUBLIC&gt;      // TPM 公開鍵情報                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  対応認証器: Windows Hello (TPM搭載PC)                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  検証の特徴:                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - certInfo と pubArea の TPM 固有構造を解析する必要がある                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Microsoft の TPM Root CA との証明書チェーン検証                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-android-key---android-keystore-形式">3. <code>android-key</code> - Android Keystore 形式<a href="#3-android-key---android-keystore-形式" class="hash-link" aria-label="3-android-key---android-keystore-形式 への直接リンク" title="3-android-key---android-keystore-形式 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  fmt: &quot;android-key&quot;                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Android の Hardware Keystore を使用する認証器向け。                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attStmt: {                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;alg&quot;: -7,                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;sig&quot;: &lt;signature&gt;,                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;x5c&quot;: [&lt;key cert&gt;, ...]      // Key Attestation 証明書チェーン         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  対応認証器: Android (API 24+, Hardware Keystore 搭載)                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  検証の特徴:                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 証明書の拡張領域に Android 固有の情報が含まれる                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - securityLevel: Software / TrustedEnvironment / StrongBox                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Google の Root CA との証明書チェーン検証                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-android-safetynet---safetynet-形式非推奨">4. <code>android-safetynet</code> - SafetyNet 形式（非推奨）<a href="#4-android-safetynet---safetynet-形式非推奨" class="hash-link" aria-label="4-android-safetynet---safetynet-形式非推奨 への直接リンク" title="4-android-safetynet---safetynet-形式非推奨 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  fmt: &quot;android-safetynet&quot; (非推奨 - Play Integrity API へ移行)               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Google SafetyNet API を使用した形式。                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attStmt: {                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;ver&quot;: &quot;...&quot;,                 // SafetyNet バージョン                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;response&quot;: &lt;JWS&gt;             // SafetyNet の JWS レスポンス             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  注意: SafetyNet Attestation API は 2024年に廃止。                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  新規実装では android-key を使用すること。                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-fido-u2f---fido-u2f-形式">5. <code>fido-u2f</code> - FIDO U2F 形式<a href="#5-fido-u2f---fido-u2f-形式" class="hash-link" aria-label="5-fido-u2f---fido-u2f-形式 への直接リンク" title="5-fido-u2f---fido-u2f-形式 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  fmt: &quot;fido-u2f&quot;                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  FIDO U2F 認証器との後方互換性のための形式。                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attStmt: {                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;sig&quot;: &lt;signature&gt;,           // U2F 形式の署名                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;x5c&quot;: [&lt;attestation cert&gt;]   // 単一の Attestation 証明書              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  対応認証器: 旧世代の U2F 専用キー（YubiKey NEO 等）                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  特徴:                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - alg フィールドがない（常に ES256）                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 署名対象のデータ形式が FIDO2 と若干異なる                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-apple---apple-形式">6. <code>apple</code> - Apple 形式<a href="#6-apple---apple-形式" class="hash-link" aria-label="6-apple---apple-形式 への直接リンク" title="6-apple---apple-形式 への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  fmt: &quot;apple&quot;                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Apple デバイス（Touch ID, Face ID）向けの形式。                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attStmt: {                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    &quot;x5c&quot;: [&lt;attestation cert&gt;, &lt;Apple WebAuthn Root CA&gt;]                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  対応認証器: macOS Touch ID, iOS Face ID / Touch ID                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  特徴:                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - sig フィールドがない（証明書内に署名情報が含まれる）                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Apple WebAuthn Root CA との証明書チェーン検証                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 証明書の拡張領域に nonce が含まれる                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="7-none---attestation-なし">7. <code>none</code> - Attestation なし<a href="#7-none---attestation-なし" class="hash-link" aria-label="7-none---attestation-なし への直接リンク" title="7-none---attestation-なし への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  fmt: &quot;none&quot;                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Attestation Statement を含まない形式。                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attStmt: {}                     // 空のオブジェクト                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  使用ケース:                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - RP が attestation=&quot;none&quot; を指定した場合                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - プライバシーを優先する場合                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証器が Attestation に対応していない場合                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  注意:                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - AAGUID は 00000000-0000-0000-0000-000000000000 になることがある          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証器の正当性は検証できない                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="format-比較表">Format 比較表<a href="#format-比較表" class="hash-link" aria-label="Format 比較表 への直接リンク" title="Format 比較表 への直接リンク">​</a></h3>
<table><thead><tr><th>Format</th><th>主な認証器</th><th>証明書チェーン</th><th>特殊な検証</th></tr></thead><tbody><tr><td><code>packed</code></td><td>YubiKey, Feitian</td><td>あり/なし</td><td>標準的</td></tr><tr><td><code>tpm</code></td><td>Windows Hello</td><td>あり</td><td>TPM構造解析</td></tr><tr><td><code>android-key</code></td><td>Android</td><td>あり</td><td>拡張領域解析</td></tr><tr><td><code>android-safetynet</code></td><td>Android (旧)</td><td>なし (JWS)</td><td>JWS検証</td></tr><tr><td><code>fido-u2f</code></td><td>U2F キー</td><td>あり</td><td>U2F署名形式</td></tr><tr><td><code>apple</code></td><td>macOS/iOS</td><td>あり</td><td>nonce検証</td></tr><tr><td><code>none</code></td><td>-</td><td>なし</td><td>不要</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="attestationobject-の構造比較">attestationObject の構造比較<a href="#attestationobject-の構造比較" class="hash-link" aria-label="attestationObject の構造比較 への直接リンク" title="attestationObject の構造比較 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="各形式での構造">各形式での構造<a href="#各形式での構造" class="hash-link" aria-label="各形式での構造 への直接リンク" title="各形式での構造 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────── ─────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    attestationObject 構造比較                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【packed (Full Attestation)】                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  {                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    fmt: &quot;packed&quot;,                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    authData: &lt;rpIdHash(32) + flags(1) + signCount(4) + attestedCredData&gt;,  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    attStmt: { alg: -7, sig: &lt;bytes&gt;, x5c: [&lt;cert&gt;] }                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【packed (Self Attestation)】                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  {                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    fmt: &quot;packed&quot;,                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    authData: &lt;rpIdHash(32) + flags(1) + signCount(4) + attestedCredData&gt;,  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    attStmt: { alg: -7, sig: &lt;bytes&gt; }  // x5c なし                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【tpm】                                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  {                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    fmt: &quot;tpm&quot;,                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    authData: &lt;...&gt;,                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    attStmt: {                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      ver: &quot;2.0&quot;, alg: -7, sig: &lt;bytes&gt;,                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      x5c: [&lt;AIK cert&gt;],                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      certInfo: &lt;TPMS_ATTEST&gt;,                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      pubArea: &lt;TPMT_PUBLIC&gt;                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    }                                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【apple】                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  {                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    fmt: &quot;apple&quot;,                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    authData: &lt;...&gt;,                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    attStmt: { x5c: [&lt;attestation cert&gt;, &lt;Apple Root CA&gt;] }  // sig なし    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【none】                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  {                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    fmt: &quot;none&quot;,                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    authData: &lt;...&gt;,                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    attStmt: {}                        // 空                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────── ─────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rp-側での検証処理">RP 側での検証処理<a href="#rp-側での検証処理" class="hash-link" aria-label="RP 側での検証処理 への直接リンク" title="RP 側での検証処理 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="検証フロー概要">検証フロー概要<a href="#検証フロー概要" class="hash-link" aria-label="検証フロー概要 への直接リンク" title="検証フロー概要 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    Attestation 検証フロー                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  attestationObject 受信                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         ▼                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────┐                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 1. CBOR デコード    │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    fmt, authData,   │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    attStmt を抽出   │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬───── ─────┘                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             ▼                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────┐                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 2. authData 検証    │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - rpIdHash       │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - flags (UP, UV) │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - 公開鍵抽出     │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬──────────┘                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             ▼                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌  ─────────────────────┐                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 3. clientDataJSON   │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    検証             │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - type           │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - challenge      │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - origin         │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬──────────┘                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             ▼                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────┐     ┌────────────────────────────────────────────┐│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 4. fmt に応じた     │────&gt;│ fmt=&quot;none&quot;    → 検証スキップ              ││</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    attStmt 検証     │     │ fmt=&quot;packed&quot;  → 署名検証 + 証明書チェーン  ││</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                     │     │ fmt=&quot;tpm&quot;     → TPM構造解析 + 証明書      ││</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                     │     │ fmt=&quot;apple&quot;   → Apple固有検証             ││</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬──────────┘     └────────────────────────────────────────────┘│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             ▼                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────┐                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 5. (オプション)     │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    MDS で AAGUID    │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    のメタデータ確認 │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┬──────────┘                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             ▼                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────┐                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 6. クレデンシャル   │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    保存             │                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────┘                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fmt-別の検証処理">fmt 別の検証処理<a href="#fmt-別の検証処理" class="hash-link" aria-label="fmt 別の検証処理 への直接リンク" title="fmt 別の検証処理 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="none-の検証"><code>none</code> の検証<a href="#none-の検証" class="hash-link" aria-label="none-の検証 への直接リンク" title="none-の検証 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// fmt=&quot;none&quot; の場合、attStmt 検証はスキップ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (&quot;none&quot;.equals(fmt)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // attStmt が空であることを確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!attStmt.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new AttestationException(&quot;attStmt must be empty for fmt=none&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 検証完了（Attestation の信頼性は保証されない）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return AttestationResult.none();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="packed-の検証"><code>packed</code> の検証<a href="#packed-の検証" class="hash-link" aria-label="packed-の検証 への直接リンク" title="packed-の検証 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// fmt=&quot;packed&quot; の場合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (&quot;packed&quot;.equals(fmt)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int alg = attStmt.getInt(&quot;alg&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte[] sig = attStmt.getBytes(&quot;sig&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (attStmt.containsKey(&quot;x5c&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Full Attestation: 証明書チェーン検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;X509Certificate&gt; x5c = attStmt.getCertificates(&quot;x5c&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 1. 署名検証（attestation cert の公開鍵で）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        verifySignature(x5c.get(0).getPublicKey(), sig, signedData, alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 2. 証明書チェーン検証（MDS の Root CA まで）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        verifyCertificateChain(x5c, trustedRootCAs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 3. 証明書の AAGUID が authData の AAGUID と一致することを確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        verifyAaguidMatch(x5c.get(0), authData.getAaguid());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return AttestationResult.basic(x5c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Self Attestation: 生成された公開鍵で署名検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        verifySignature(credentialPublicKey, sig, signedData, alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return AttestationResult.self();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="apple-の検証"><code>apple</code> の検証<a href="#apple-の検証" class="hash-link" aria-label="apple-の検証 への直接リンク" title="apple-の検証 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// fmt=&quot;apple&quot; の場合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (&quot;apple&quot;.equals(fmt)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;X509Certificate&gt; x5c = attStmt.getCertificates(&quot;x5c&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. Apple WebAuthn Root CA との証明書チェーン検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verifyCertificateChain(x5c, appleWebAuthnRootCA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2. 証明書の拡張領域から nonce を抽出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte[] nonce = extractNonceFromCert(x5c.get(0));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3. nonce = SHA256(authData || clientDataHash) を検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte[] expectedNonce = sha256(concat(authData, clientDataHash));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!Arrays.equals(nonce, expectedNonce)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new AttestationException(&quot;Nonce mismatch&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4. 証明書の公開鍵 == credential の公開鍵 を検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!x5c.get(0).getPublicKey().equals(credentialPublicKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new AttestationException(&quot;Public key mismatch&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return AttestationResult.apple(x5c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="証明書チェーン検証">証明書チェーン検証<a href="#証明書チェーン検証" class="hash-link" aria-label="証明書チェーン検証 への直接リンク" title="証明書チェーン検証 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概要-2">概要<a href="#概要-2" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h3>
<p>Attestation Statement に含まれる証明書チェーン（x5c）を検証することで、認証器の正当性を確認できます。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    証明書チェーンの構造                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  認証器から送信される x5c 配列:                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  x5c[0]: Attestation Certificate（認証器の証明書）                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │    - 認証器の Attestation 秘密鍵に対応する公開鍵を含む                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │    - AAGUID が拡張領域に含まれる場合がある                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ▼                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  x5c[1]: Intermediate CA Certificate（中間 CA 証明書）                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │    - オプション。複数の中間 CA がある場合もある                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ▼                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (Root CA Certificate)                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          - 通常は x5c に含まれない                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          - RP 側の TrustStore に事前に登録しておく                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="検証レベル">検証レベル<a href="#検証レベル" class="hash-link" aria-label="検証レベル への直接リンク" title="検証レベル への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────── ─────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    証明書チェーン検証のレベル                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【レベル 1: 検証スキップ】                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ────────────────────────────────────────────────────────────────────────── │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 証明書チェーンの検証を行わない                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 署名検証のみ実施（attStmt.sig を x5c[0] の公開鍵で検証）                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - AAGUID は取得できるが、偽装されている可能性がある                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 用途: 開発環境、プライバシー 優先のサービス                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【レベル 2: 署名検証のみ】                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ────────────────────────────────────────────────────────────────────────── │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - attStmt.sig を x5c[0] の公開鍵で検証                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 証明書チェーンは信頼済みルートまで検証しない                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 証明書の形式・有効期限は確認                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 用途: 中程度のセキュリティ要件                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【レベル 3: 完全な証明書チェーン検証】                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ──────────────────────  ──────────────────────────────────────────────────── │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - x5c[0] → 中間 CA → ルート CA までの完全なチェーンを検証                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - TrustStore に登録されたルート CA との照合                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 証明書の有効期限、失効状態（CRL/OCSP）の確認                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - AAGUID の正当性が保証される                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 用途: 企業環境、高セキュリティ要件                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="truststore-の役割">TrustStore の役割<a href="#truststore-の役割" class="hash-link" aria-label="TrustStore の役割 への直接リンク" title="TrustStore の役割 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    TrustStore とは                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TrustStore は「信頼するルート CA 証明書」を格納したファイル                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    TrustStore (PKCS12/JKS)                          │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────────────────────────────────────────────────────┐   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ Yubico Root CA                                               │   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ - YubiKey シリーズの認証器を信頼                             │   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────────────────────────────────────────────────────┘   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────────────────────────────────────────────────────┐   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ Apple WebAuthn Root CA                                       │   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ - macOS/iOS の Touch ID, Face ID を信頼                      │   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────────────────────────────────────────────────────┘   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────────────────────────────────────────────────────┐   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ Google Hardware Attestation Root                             │   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ - Android の Hardware Keystore を信頼                        │   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────────────────────────────────────────────────────┘   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────────────────────────────────────────────────────┐   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ Microsoft TPM Root CA                                        │   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ - Windows Hello (TPM) を信頼                                 │   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────────────────────────────────────────────────────┘   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TrustStore がない場合:                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 証明書チェーン検証はスキップされる                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 署名検証のみ実施                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TrustStore がある場合:                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証器の証明書が TrustStore 内のルート CA まで辿れるか検証                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 辿れない認証器は拒否される                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="証明書チェーン解決の流れ">証明書チェーン解決の流れ<a href="#証明書チェーン解決の流れ" class="hash-link" aria-label="証明書チェーン解決の流れ への直接リンク" title="証明書チェーン解決の流れ への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    証明書チェーン解決アルゴリズム                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  入力: x5c 配列（認証器から受信）、TrustStore（RP 側で保持）                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Step 1: エンドエンティティ証明書の取得                               │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         cert = x5c[0]  // Attestation Certificate                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────────────┬──────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                         │                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                         ▼                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Step 2: 証明書の基本検証                                             │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         - 有効期限の確認（notBefore ≤ now ≤ notAfter）              │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         - 基本制約の確認（CA フラグ、パス長）                        │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         - キー使用法の確認                                           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────────────┬──────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                         │                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                         ▼                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Step 3: 発行者の特定                                                 │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         issuer = cert.getIssuerDN()                                 │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         発行者証明書を探す:                                           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         1. x5c 配列内を検索（x5c[1], x5c[2], ...）                  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │         2. TrustStore 内を検索                                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────────────┬──────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                         │                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         ┌───────────────┴───────────────┐                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         ▼                               ▼                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────────────┐    ┌──────────────────────────────┐      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 発行者が x5c 内に見つかった  │    │ 発行者が TrustStore 内に     │      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                              │    │ 見つかった（ルート CA）      │      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ → 署名検証                   │    │                              │      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ → cert を発行者証明書に更新  │    │ → 署名検証                   │      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ → Step 2 に戻る              │    │ → チェーン検証成功！         │      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────┘    └──────────────────────────────┘      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  発行者が見つからない場合:                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → チェーン検証失敗（認証器を拒否）                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ルート-ca-証明書の入手先">ルート CA 証明書の入手先<a href="#ルート-ca-証明書の入手先" class="hash-link" aria-label="ルート CA  証明書の入手先 への直接リンク" title="ルート CA 証明書の入手先 への直接リンク">​</a></h3>
<table><thead><tr><th>認証器</th><th>ルート CA</th><th>入手先</th></tr></thead><tbody><tr><td>YubiKey</td><td>Yubico Root CA</td><td><a href="https://developers.yubico.com/U2F/Attestation_Certificates/" target="_blank" rel="noopener noreferrer">Yubico Developers</a></td></tr><tr><td>Windows Hello</td><td>Microsoft TPM Root</td><td>Windows Update / Microsoft</td></tr><tr><td>Android</td><td>Google Hardware Attestation Root</td><td><a href="https://developer.android.com/training/articles/security-key-attestation" target="_blank" rel="noopener noreferrer">Google</a></td></tr><tr><td>Apple</td><td>Apple WebAuthn Root CA</td><td><a href="https://www.apple.com/certificateauthority/" target="_blank" rel="noopener noreferrer">Apple PKI</a></td></tr><tr><td>各種 FIDO 認定認証器</td><td>FIDO MDS</td><td><a href="https://fidoalliance.org/metadata/" target="_blank" rel="noopener noreferrer">FIDO Alliance MDS</a></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fido-metadata-service-mds-の活用">FIDO Metadata Service (MDS) の活用<a href="#fido-metadata-service-mds-の活用" class="hash-link" aria-label="FIDO Metadata Service (MDS) の活用 への直接リンク" title="FIDO Metadata Service (MDS) の活用 への直接リンク">​</a></h3>
<blockquote>
<p>📖 MDS の詳細については <a href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-aaguid-authenticator-identification#fido-metadata-service-mds">AAGUID - 認証器の識別</a> を参照してください。</p>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    FIDO MDS による証明書管理                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  FIDO MDS は認証器のメタデータを一元管理するサービス                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【MDS が提供する情報】                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証器ごとのルート CA 証明書                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - AAGUID とメタデータのマッピング                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証器の FIDO 認定レベル（L1/L2/L3）                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 脆弱性情報（Security Bulletin）                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【MDS を使う利点】                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 個別にルート CA を収集する手間が省ける                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 新しい認証器が追加されても自動的に対応                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 脆弱性が発見された認証器を自動的にブロック可能                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【MDS の使い方】                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. MDS から BLOB（JWT形式）をダウンロード                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. BLOB を検証し、メタデータを抽出                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. AAGUID をキーにしてメタデータを検索                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  4. メタデータ内のルート証明書で証明書チェーンを検証                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="実装時の考慮事項">実装時の考慮事項<a href="#実装時の考慮事項" class="hash-link" aria-label="実装時の考慮事項 への直接リンク" title="実装時の考慮事項 への直接リンク">​</a></h3>
<table><thead><tr><th>項目</th><th>説明</th></tr></thead><tbody><tr><td><strong>TrustStore の更新</strong></td><td>ルート CA 証明書の有効期限切れに注意。定期的に更新が必要</td></tr><tr><td><strong>中間 CA の扱い</strong></td><td>x5c に含まれない中間 CA がある場合、別途取得が必要な場合がある</td></tr><tr><td><strong>失効確認</strong></td><td>本番環境では CRL または OCSP による失効確認を推奨</td></tr><tr><td><strong>Self Attestation</strong></td><td>x5c がない場合は証明書チェーン検証は不可。署名検証のみ</td></tr><tr><td><strong>パフォーマンス</strong></td><td>証明書チェーン検証は CPU 負荷がかかる。キャッシュの活用を検討</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="プライバシーの考慮">プライバシーの考慮<a href="#プライバシーの考慮" class="hash-link" aria-label="プライバシーの考慮 への直接リンク" title="プライバシーの考慮 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="attestation-とプライバシーのトレードオフ">Attestation とプライバシーのトレードオフ<a href="#attestation-とプライバシーのトレードオフ" class="hash-link" aria-label="Attestation とプライバシーのトレードオフ への直接リンク" title="Attestation とプライバシーのトレードオフ への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    プライバシー vs セキュリティ                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  プライバシーリスク                        セキュリティメリット              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────                        ────────────────────              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【AAGUID の露出】                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証器のモデルが特定可能               - 脆弱な認証器を拒否可能          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ユーザーの購買傾向が推測可能           - 認定認証器のみ許可可能          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【証明書チェーンの露出】                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証器の製造バッチが特定可能           - 認証器の正当性を検証可能        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 同一認証器の使い回しが検出可能         - 偽造認証器を検出可能            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【Enterprise Attestation】                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証器の個体が特定可能                 - 資産管理が可能                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ユーザーの行動追跡が可能               - 紛失・盗難時の対応が容易        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="推奨される使い分け">推奨される使い分け<a href="#推奨される使い分け" class="hash-link" aria-label="推奨される使い分け への直接リンク" title="推奨される使い分け への直接リンク">​</a></h3>
<table><thead><tr><th>ユースケース</th><th>推奨 attestation</th><th>理由</th></tr></thead><tbody><tr><td><strong>一般向け Web サービス</strong></td><td><code>none</code></td><td>プライバシー優先、認証器の種類を問わない</td></tr><tr><td><strong>企業の社内システム</strong></td><td><code>direct</code></td><td>許可された認証器のみ使用を強制</td></tr><tr><td><strong>金融・医療</strong></td><td><code>direct</code></td><td>FIDO 認定レベルを確認</td></tr><tr><td><strong>政府・防衛</strong></td><td><code>enterprise</code></td><td>認証器の個体管理が必要</td></tr><tr><td><strong>消費者向け銀行アプリ</strong></td><td><code>none</code> または <code>indirect</code></td><td>UX とセキュリティのバランス</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="エンタープライズでの実装例">エンタープライズでの実装例<a href="#エンタープライズでの実装例" class="hash-link" aria-label="エンタープライズでの実装例 への直接リンク" title="エンタープライズでの実装例 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="認証器ポリシーの設定">認証器ポリシーの設定<a href="#認証器ポリシーの設定" class="hash-link" aria-label="認証器ポリシーの設定 への直接リンク" title="認証器ポリシーの設定 への直接リンク">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># attestation-policy.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">attestation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Attestation Conveyance Preference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">conveyance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;direct&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 許可する Attestation Statement Format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allowed_formats</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;packed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tpm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;apple&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># FIDO MDS 連携</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://mds3.fidoalliance.org/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">min_certification_level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FIDO_CERTIFIED_L1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># AAGUID ベースのポリシー</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">aaguid_policy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;allowlist&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># allowlist | denylist | any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">allowlist</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ee882879-721c-4913-9775-3dfcce97072a&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># YubiKey 5 NFC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;c5ef55ff-ad9a-4b9f-b580-adebafe026d0&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># YubiKey 5Ci</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;08987058-cadc-4b81-b6e1-30de50dcbe96&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Windows Hello</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">denylist</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;00000000-0000-0000-0000-000000000000&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Unknown/None</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="検証実装例">検証実装例<a href="#検証実装例" class="hash-link" aria-label="検証実装例 への直接リンク" title="検証実装例 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class AttestationVerifier {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final AttestationPolicy policy;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final MetadataService mds;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AttestationResult verify(AttestationObject attestationObject) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String fmt = attestationObject.getFormat();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 1. Format チェック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!policy.isFormatAllowed(fmt)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new PolicyViolationException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;Attestation format not allowed: &quot; + fmt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 2. Format 別の検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AttestationResult result = verifyByFormat(attestationObject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 3. AAGUID ポリシーチェック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String aaguid = attestationObject.getAuthData().getAaguid();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!policy.isAaguidAllowed(aaguid)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new PolicyViolationException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;Authenticator not allowed: &quot; + aaguid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 4. MDS でメタデータ確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (policy.isMdsEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MetadataStatement metadata = mds.findByAaguid(aaguid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 認証レベルチェック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (metadata.getCertificationLevel() &lt; policy.getMinLevel()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new PolicyViolationException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;Authenticator certification level too low&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 脆弱性チェック</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (metadata.hasSecurityIssue()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new PolicyViolationException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;Authenticator has known security issues: &quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    metadata.getStatusReports());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="attestation-の要点">Attestation の要点<a href="#attestation-の要点" class="hash-link" aria-label="Attestation の要点 への直接リンク" title="Attestation の要点 への直接リンク">​</a></h3>
<table><thead><tr><th>項目</th><th>内容</th></tr></thead><tbody><tr><td><strong>目的</strong></td><td>認証器の正当性 を証明</td></tr><tr><td><strong>Conveyance</strong></td><td>none, indirect, direct, enterprise</td></tr><tr><td><strong>Format</strong></td><td>packed, tpm, android-key, apple, fido-u2f, none</td></tr><tr><td><strong>検証内容</strong></td><td>署名検証、証明書チェーン、MDS 参照</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="選択の指針">選択の指針<a href="#選択の指針" class="hash-link" aria-label="選択の指針 への直接リンク" title="選択の指針 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">一般向けサービス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─ プライバシー優先 → attestation=&quot;none&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └─ 認証器管理が必要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ├─ モデル単位で管理 → attestation=&quot;direct&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           └─ 個体単位で管理 → attestation=&quot;enterprise&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ベストプラクティス">ベストプラクティス<a href="#ベストプラクティス" class="hash-link" aria-label="ベストプラクティス への直接リンク" title="ベストプラクティス への直接リンク">​</a></h3>
<ol>
<li>
<p><strong>一般向けサービスでは <code>none</code> を使用</strong></p>
<ul>
<li>ユーザー体験を優先、認証器を問わない</li>
</ul>
</li>
<li>
<p><strong>企業環境では <code>direct</code> を検討</strong></p>
<ul>
<li>許可リストで認証器を管理</li>
<li>MDS と連携して脆弱性をモニタリング</li>
</ul>
</li>
<li>
<p><strong>Attestation を保存する場合は AAGUID も保存</strong></p>
<ul>
<li>後からのポリシー変更、脆弱性対応に対応</li>
</ul>
</li>
<li>
<p><strong>Format 別の検証ロジックをライブラリに任せる</strong></p>
<ul>
<li>webauthn4j, py_webauthn 等の実績あるライブラリを使用</li>
</ul>
</li>
</ol>
<blockquote>
<p>📖 商用環境での運用については <a href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-attestation-production-considerations">商用環境でのアテステーション検証</a> を参照してください。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考リンク">参考リンク<a href="#参考リンク" class="hash-link" aria-label="参考リンク への直接リンク" title="参考リンク への直接リンク">​</a></h2>
<ul>
<li><a href="https://www.w3.org/TR/webauthn-2/#sctn-attestation" target="_blank" rel="noopener noreferrer">W3C WebAuthn - Attestation</a></li>
<li><a href="https://www.w3.org/TR/webauthn-2/#sctn-defined-attestation-formats" target="_blank" rel="noopener noreferrer">W3C WebAuthn - Attestation Statement Formats</a></li>
<li><a href="https://fidoalliance.org/metadata/" target="_blank" rel="noopener noreferrer">FIDO Metadata Service</a></li>
<li><a href="https://developer.apple.com/documentation/authenticationservices/public-private_key_authentication/supporting_passkeys" target="_blank" rel="noopener noreferrer">Apple - Supporting Passkeys</a></li>
<li><a href="https://developer.android.com/training/articles/security-key-attestation" target="_blank" rel="noopener noreferrer">Android - Key Attestation</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/05-fido-webauthn/fido2-attestation-types-and-verification.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-aaguid-authenticator-identification"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">AAGUID - 認 証器のモデル識別子</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-attestation-production-considerations"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">商用環境でのアテステーション検証</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概要" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#attestation-とは" class="table-of-contents__link toc-highlight">Attestation とは</a><ul><li><a href="#基本概念" class="table-of-contents__link toc-highlight">基本概念</a></li><li><a href="#なぜ-attestation-検証が必要か" class="table-of-contents__link toc-highlight">なぜ Attestation 検証が必要か</a></li><li><a href="#まとめ-attestation-検証の要否判断" class="table-of-contents__link toc-highlight">まとめ: Attestation 検証の要否判断</a></li></ul></li><li><a href="#attestation-conveyance-preference" class="table-of-contents__link toc-highlight">Attestation Conveyance Preference</a><ul><li><a href="#rp-が指定するオプション" class="table-of-contents__link toc-highlight">RP が指定するオプション</a></li><li><a href="#4つのオプション" class="table-of-contents__link toc-highlight">4つのオプション</a></li><li><a href="#比較表" class="table-of-contents__link toc-highlight">比較表</a></li></ul></li><li><a href="#attestation-statement-format" class="table-of-contents__link toc-highlight">Attestation Statement Format</a><ul><li><a href="#概要-1" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#各形式の詳細" class="table-of-contents__link toc-highlight">各形式の詳細</a></li><li><a href="#format-比較表" class="table-of-contents__link toc-highlight">Format 比較表</a></li></ul></li><li><a href="#attestationobject-の構造比較" class="table-of-contents__link toc-highlight">attestationObject の構造比較</a><ul><li><a href="#各形式での構造" class="table-of-contents__link toc-highlight">各形式での構造</a></li></ul></li><li><a href="#rp-側での検証処理" class="table-of-contents__link toc-highlight">RP 側での検証処理</a><ul><li><a href="#検証フロー概要" class="table-of-contents__link toc-highlight">検証フロー概要</a></li><li><a href="#fmt-別の検証処理" class="table-of-contents__link toc-highlight">fmt 別の検証処理</a></li></ul></li><li><a href="#証明書チェーン検証" class="table-of-contents__link toc-highlight">証明書チェーン検証</a><ul><li><a href="#概要-2" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#検証レベル" class="table-of-contents__link toc-highlight">検証レベル</a></li><li><a href="#truststore-の役割" class="table-of-contents__link toc-highlight">TrustStore の役割</a></li><li><a href="#証明書チェーン解決の流れ" class="table-of-contents__link toc-highlight">証明書チェーン解決の流れ</a></li><li><a href="#ルート-ca-証明書の入手先" class="table-of-contents__link toc-highlight">ルート CA 証明書の入手先</a></li><li><a href="#fido-metadata-service-mds-の活用" class="table-of-contents__link toc-highlight">FIDO Metadata Service (MDS) の活用</a></li><li><a href="#実装時の考慮事項" class="table-of-contents__link toc-highlight">実装時の考慮事項</a></li></ul></li><li><a href="#プライバシーの考慮" class="table-of-contents__link toc-highlight">プライバシーの考慮</a><ul><li><a href="#attestation-とプライバシーのトレードオフ" class="table-of-contents__link toc-highlight">Attestation とプライバシーのトレードオフ</a></li><li><a href="#推奨される使い分け" class="table-of-contents__link toc-highlight">推奨される使い分け</a></li></ul></li><li><a href="#エンタープライズでの実装例" class="table-of-contents__link toc-highlight">エンタープライズでの実装例</a><ul><li><a href="#認証器ポリシーの設定" class="table-of-contents__link toc-highlight">認証器ポリシーの設定</a></li><li><a href="#検証実装例" class="table-of-contents__link toc-highlight">検証実装例</a></li></ul></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a><ul><li><a href="#attestation-の要点" class="table-of-contents__link toc-highlight">Attestation の要点</a></li><li><a href="#選択の指針" class="table-of-contents__link toc-highlight">選択の指針</a></li><li><a href="#ベストプラクティス" class="table-of-contents__link toc-highlight">ベストプラクティス</a></li></ul></li><li><a href="#参考リンク" class="table-of-contents__link toc-highlight">参考リンク</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>