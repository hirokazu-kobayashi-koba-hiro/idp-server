<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_11_learning/session-management/distributed-session" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">分散セッション管理 | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/session-management/distributed-session"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="分散セッション管理 | IdP-Server Documentation"><meta data-rh="true" name="description" content="このドキュメントの目的"><meta data-rh="true" property="og:description" content="このドキュメントの目的"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/session-management/distributed-session"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/session-management/distributed-session" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/session-management/distributed-session" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.0db1aa82.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.991ff287.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">アイデンティティ管理の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-fundamentals/modern-web-authz-authn">OAuth 2.0の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-tokens/id-token-jwt">OAuth 2.0トークン</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/openid-connect/oauth-oidc-basics">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-architecture-rp-browser-authenticator">FIDO2/WebAuthn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/security/glossary">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/multi-tenancy/multi-tenancy-basics">マルチテナント</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/advanced-protocols/ciba-basics">高度なプロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/http-rest/http-basics">HTTP/REST</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jwt-jose/jwt-introduction">JWT/JOSE</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth/OIDC RFC学習</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/verifiable-credentials/">Verifiable Credentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/data-formats/">データフォーマット</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/web-session-basics">セッション管理</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/web-session-basics">Webセッションの基礎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/distributed-session">分散セッション管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/oidc-session-management">OIDC Session Management</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/crypto/">暗号化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/kubernetes/">コンテナ/Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/linux/">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/">JVM</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">学習（Learning）</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">セッション管理</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">分散セッション管理</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>分散セッション管理</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="このドキュメントの目的">このドキュメントの目的<a href="#このドキュメントの目的" class="hash-link" aria-label="このドキュメントの目的 への直接リンク" title="このドキュメントの目的 への直接リンク">​</a></h2>
<p><strong>分散環境</strong>でのセッション管理を理解し、HttpSession経由と直接アクセスの違いを学ぶことが目標です。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="所要時間">所要時間<a href="#所要時間" class="hash-link" aria-label="所要時間 への直接リンク" title="所要時間 への直接リンク">​</a></h3>
<p>約30分</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="学べること">学べること<a href="#学べること" class="hash-link" aria-label="学べること への直接リンク" title="学べること への直接リンク">​</a></h3>
<ul>
<li>なぜ分散セッションが必要か</li>
<li>Spring Session（HttpSession経由Redis）の仕組み</li>
<li>直接Redisアクセスとの違い</li>
<li>それぞれの使い分け</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="なぜ分散セッションが必要か">なぜ分散セッションが必要か<a href="#なぜ分散セッションが必要か" class="hash-link" aria-label="なぜ分散セッションが必要か への直接リンク" title="なぜ分散セッションが必要か への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="単一サーバーの限界">単一サーバーの限界<a href="#単一サーバーの限界" class="hash-link" aria-label="単一サーバーの限界 への直接リンク" title="単一サーバーの限界 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【単一サーバー構成】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ブラウザ ────→ Webサーバー</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ┌─────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │ Session │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │ Storage │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │ (メモリ) │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └─────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">問題なし！セッションはサーバーメモリに保存</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="複数サーバーでの問題">複数サーバーでの問題<a href="#複数サーバーでの問題" class="hash-link" aria-label="複数サーバーでの問題 への直接リンク" title="複数サーバーでの問題 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【複数サーバー構成（ロードバランサー）】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ┌─────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │ Load Balancer   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    └────────┬────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ┌────────┼────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ▼        ▼        ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ┌────────┐ ┌────────┐ ┌────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │Server A│ │Server B│ │Server C│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │        │ │        │ │        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │Session:│ │Session:│ │Session:│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │user123 │ │ (なし) │ │ (なし) │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              └────────┘ └────────┘ └────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">リクエスト1: Server A → ログイン成功、セッション作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">リクエスト2: Server B → セッションがない！ログアウト状態？</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>問題</strong>:</p>
<ul>
<li>各サーバーは自分のメモリにセッションを保持</li>
<li>ロードバランサーが異なるサーバーに振り分けるとセッションが見つからない</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="解決策-セッション共有">解決策: セッション共有<a href="#解決策-セッション共有" class="hash-link" aria-label="解決策: セッション共有 への直接リンク" title="解決策: セッション共有 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【分散セッション構成】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ┌─────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │ Load Balancer   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    └────────┬────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ┌────────┼────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ▼        ▼        ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ┌────────┐ ┌────────┐ ┌────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │Server A│ │Server B│ │Server C│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              └────┬───┘ └────┬───┘ └────┬───┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   │          │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   └──────────┼──────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ┌─────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │      Redis      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │ session:abc123  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │   user: alice   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │   cart: [...]   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    └─────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">どのサーバーでも同じセッションにアクセス可能</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Redisを使う理由</strong>:</p>
<ul>
<li>インメモリで高速</li>
<li>TTL（有効期限）をネイティブサポート</li>
<li>クラスタ構成で高可用性</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="redisへのアクセス方法-2つのパターン">Redisへのアクセス方法: 2つのパターン<a href="#redisへのアクセス方法-2つのパターン" class="hash-link" aria-label="Redisへのアクセス方法: 2つのパターン への直接リンク" title="Redisへのアクセス方法: 2つのパターン への直接リンク">​</a></h2>
<p>Redisにセッションを保存する方法は2つあります。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【2つのアクセスパターン】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  パターン1: HttpSession経由（Spring Session）                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  アプリケーション → HttpSession API → Spring Session → Redis   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・標準APIを使用（コード変更不要）                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・Servletコンテナのセッション管理を「差し替え」                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  パターン2: 直接アクセス（独自実装）                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  アプリケーション → 独自Repository → Redis Client → Redis       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・完全に自由なデータ構造                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・任意のキーで検索可能                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="パターン1-httpsession経由spring-session">パターン1: HttpSession経由（Spring Session）<a href="#パターン1-httpsession経由spring-session" class="hash-link" aria-label="パターン1: HttpSession経由（Spring Session） への直接リンク" title="パターン1: HttpSession経由（Spring Session） への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="spring-sessionとは">Spring Sessionとは<a href="#spring-sessionとは" class="hash-link" aria-label="Spring Sessionとは への直接リンク" title="Spring Sessionとは への直接リンク">​</a></h3>
<p><strong>Spring Session</strong>: HttpSession APIの実装を差し替えるフレームワーク</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【通常のHttpSession】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">アプリケーション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpSession API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Servlet Container（Tomcat等）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">サーバーメモリ（JVM）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">【Spring Session】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">アプリケーション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpSession API  ← 同じAPIを使用（コード変更不要）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spring Session（実装を差し替え）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Redis</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>ポイント</strong>:</p>
<ul>
<li>アプリケーションコードは変更不要</li>
<li>設定のみでRedisにセッションを保存</li>
<li>既存のServlet標準に従う</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="動作の流れ">動作の流れ<a href="#動作の流れ" class="hash-link" aria-label="動作の流れ への直接リンク" title="動作の流れ への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【リクエスト処理】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. リクエスト受信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │ Cookie: SESSION=abc123                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │ Spring Session Filter:                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ① Cookieからセッションキーを取得                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ② Redisからセッションデータを取得                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ③ HttpSessionオブジェクトとしてラップ                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └─────────────────────────── ─────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. アプリケーション処理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │ 通常通りHttpSession APIを使用                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │ session.getAttribute(&quot;user&quot;) → ユーザー情報取得           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │ session.setAttribute(&quot;cart&quot;, items) → カート保存          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. レスポンス送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │ Spring Session Filter:                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ① セッションの変更をRedisに保存                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ② Set-Cookie送信（必要に応じて）                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="redisのデータ構造">Redisのデータ構造<a href="#redisのデータ構造" class="hash-link" aria-label="Redisのデータ構造 への直接リンク" title="Redisのデータ構造 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【Spring SessionのRedisキー】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:session:sessions:abc123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── creationTime: 1704067200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lastAccessedTime: 1704070800000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── maxInactiveInterval: 1800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sessionAttr:user → { id: &quot;001&quot;, name: &quot;alice&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sessionAttr:cart → [&quot;item1&quot;, &quot;item2&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sessionAttr:loginTime → &quot;2024-01-01T10:00:00&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:session:sessions:expires:abc123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── (TTLで自動削除用)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>特徴</strong>:</p>
<ul>
<li>セッションIDがキーの一部</li>
<li>属性は <code>sessionAttr:</code> プレフィックス付き</li>
<li>TTLで自動的に期限切れ</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="パターン2-直接redisアクセス">パターン2: 直接Redisアクセス<a href="#パターン2-直接redisアクセス" class="hash-link" aria-label="パターン2: 直接Redisアクセス への直接リンク" title="パターン2: 直接Redisアクセス への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="直接アクセスとは">直接アクセスとは<a href="#直接アクセスとは" class="hash-link" aria-label="直接アクセスとは への直接リンク" title="直接アクセスとは への直接リンク">​</a></h3>
<p><strong>HttpSession APIを使わず、アプリケーションが直接Redisにアクセス</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【直接Redisアクセス】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">アプリケーション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">独自のSession Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Redis Client（Lettuce, Jedis等）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Redis</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>ポイント</strong>:</p>
<ul>
<li>データ構造を自由に設計</li>
<li>任意のキーでインデックス作成可能</li>
<li>検索条件を柔軟に設定</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="redisのデータ構造-1">Redisのデータ構造<a href="#redisのデータ構造-1" class="hash-link" aria-label="Redisのデータ構造 への直接リンク" title="Redisのデータ構造 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【直接アクセスのRedisキー】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># メインデータ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">op_session:tenant-001:session-abc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── id: &quot;session-abc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sub: &quot;user-123&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── authTime: &quot;2024-01-01T10:00:00Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── acr: &quot;urn:example:acr:mfa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── expiresAt: &quot;2024-01-01T20:00:00Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_session:tenant-001:sid-xyz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sid: &quot;sid-xyz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── opSessionId: &quot;session-abc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── clientId: &quot;web-app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── scopes: [&quot;openid&quot;, &quot;profile&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 検索用インデックス（Set型）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">idx:tenant:tenant-001:sub:user-123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── [&quot;session-abc&quot;, &quot;session-def&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">idx:tenant:tenant-001:op_session:session-abc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── [&quot;sid-xyz&quot;, &quot;sid-uvw&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>特徴</strong>:</p>
<ul>
<li>自由なキー設計</li>
<li>インデックスで複合検索可能</li>
<li>階層的な関連付け</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="比較-httpsession経由-vs-直接アクセス">比較: HttpSession経由 vs 直接アクセス<a href="#比較-httpsession経由-vs-直接アクセス" class="hash-link" aria-label="比較: HttpSession経由 vs 直接アクセス への直接リンク" title="比較: HttpSession経由 vs 直接アクセス への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="機能比較">機能比較<a href="#機能比較" class="hash-link" aria-label="機能比較 への直接リンク" title="機能比較 への直接リンク">​</a></h3>
<table><thead><tr><th style="text-align:left">機能</th><th style="text-align:left">HttpSession経由</th><th style="text-align:left">直接アクセス</th></tr></thead><tbody><tr><td style="text-align:left"><strong>API</strong></td><td style="text-align:left">HttpSession（標準）</td><td style="text-align:left">独自Repository</td></tr><tr><td style="text-align:left"><strong>コード変更</strong></td><td style="text-align:left">不要（設定のみ）</td><td style="text-align:left">Repository実装が必要</td></tr><tr><td style="text-align:left"><strong>データ構造</strong></td><td style="text-align:left">key-value属性</td><td style="text-align:left">自由（Hash, Set等）</td></tr><tr><td style="text-align:left"><strong>TTL管理</strong></td><td style="text-align:left">Spring Session管理</td><td style="text-align:left">アプリで制御</td></tr><tr><td style="text-align:left"><strong>検索</strong></td><td style="text-align:left">セッションIDのみ</td><td style="text-align:left">任意のインデックス</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="アクセスパターンの違い">アクセスパターンの違い<a href="#アクセスパターンの違い" class="hash-link" aria-label="アクセスパターンの違い への直接リンク" title="アクセスパターンの違い への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【HttpSession経由】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">検索: セッションID → セッションデータ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">検索: ユーザーID → そのユーザーの全セッション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ❌ できない！セッションIDを知らないとアクセス不可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">【直接アクセス】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">検索: セッションID → セッションデータ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">検索: ユーザーID → そのユーザーの全セッション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ✅ OK！インデックスで検索可能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      idx:tenant:xxx:sub:user-123 → [&quot;session-a&quot;, &quot;session-b&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="データモデルの違い">データモデルの違い<a href="#データモデルの違い" class="hash-link" aria-label="データモデルの違い への直接リンク" title="データモデルの違い への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【HttpSession（1ブラウザ = 1セッション）】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Browser ──── SESSION=abc123 ────→ セッションデータ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  ├── user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  ├── cart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  └── preferences</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">→ フラットな構造</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">→ クライアント（RP）の概念なし</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">【直接アクセス（1ユーザー = N クライアント）】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Browser ──── IDP_IDENTITY=op-001 ────→ OPSession</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       ├── sub: user-123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       ├── authTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       └── clientSessions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           ├── ClientSession(App A)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           │   ├── sid: sid-001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           │   └── clientId: app-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           └── ClientSession(App B)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               ├── sid: sid-002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               └── clientId: app-b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">→ 階層的な構造</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">→ 複数クライアントのセッションを管理</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使い分け">使い分け<a href="#使い分け" class="hash-link" aria-label="使い分け への直接リンク" title="使い分け への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="httpsession経由が適切な場合">HttpSession経由が適切な場合<a href="#httpsession経由が適切な場合" class="hash-link" aria-label="HttpSession経由が適切な場合 への直接リンク" title="HttpSession経由が適切な場合 への直接リンク">​</a></h3>
<p><strong>一般的なWebアプリケーション（RP側）</strong></p>
<ul>
<li>ログイン状態の管理</li>
<li>ショッピングカート</li>
<li>フォームの一時保存</li>
<li>既存コードの移行（コード変更不要）</li>
</ul>
<p><strong>特徴</strong>:</p>
<ul>
<li>セッションIDでのみアクセス</li>
<li>Spring Securityとの統合が容易</li>
<li>シンプルなセッション管理</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="直接アクセスが適切な場合">直接アクセスが適切な場合<a href="#直接アクセスが適切な場合" class="hash-link" aria-label="直接アクセスが適切な場合 への直接リンク" title="直接アクセスが適切な場合 への直接リンク">​</a></h3>
<p><strong>IdP（Identity Provider）</strong></p>
<ul>
<li>ユーザーIDで全セッション検索（Back-Channel Logout）</li>
<li>クライアントIDでセッション検索</li>
<li>sidクレームでセッション特 定</li>
<li>階層的なセッション構造</li>
</ul>
<p><strong>特徴</strong>:</p>
<ul>
<li>任意のキーでアクセス</li>
<li>インデックスによる複合検索</li>
<li>データ構造の自由度が高い</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="なぜidpには直接アクセスが必要か">なぜIdPには直接アクセスが必要か<a href="#なぜidpには直接アクセスが必要か" class="hash-link" aria-label="なぜIdPには直接アクセスが必要か への直接リンク" title="なぜIdPには直接アクセスが必要か への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oidc-session-managementの要件">OIDC Session Managementの要件<a href="#oidc-session-managementの要件" class="hash-link" aria-label="OIDC Session Managementの要件 への直接リンク" title="OIDC Session Managementの要件 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">【Back-Channel Logout の流れ】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. ユーザーがログアウト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   POST /logout (Cookie: SESSION=abc123)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. IdPはこのユーザーの全クライアントセッションを検索</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   「ユーザー user-123 の全セッションを取得」</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   HttpSession経由: ❌ 不可能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   直接アクセス:    ✅ インデックスで検索可能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. 各クライアントにLogout Tokenを送信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   POST https://client-a.com/backchannel-logout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   POST https://client-b.com/backchannel-logout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   POST https://client-c.com/backchannel-logout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="必要な検索パターン">必要な検索パターン<a href="#必要な検索パターン" class="hash-link" aria-label="必要な検索パターン への直接リンク" title="必要な検索パターン への直接リンク">​</a></h3>
<table><thead><tr><th style="text-align:left">検索条件</th><th style="text-align:left">HttpSession経由</th><th style="text-align:left">直接アクセス</th></tr></thead><tbody><tr><td style="text-align:left">セッションID → データ</td><td style="text-align:left">✅</td><td style="text-align:left">✅</td></tr><tr><td style="text-align:left">ユーザーID → 全セッション</td><td style="text-align:left">❌</td><td style="text-align:left">✅</td></tr><tr><td style="text-align:left">クライアントID → セッション</td><td style="text-align:left">❌</td><td style="text-align:left">✅</td></tr><tr><td style="text-align:left">sid → 特定のClientSession</td><td style="text-align:left">❌</td><td style="text-align:left">✅</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重要ポイント">重要ポイント<a href="#重要ポイント" class="hash-link" aria-label="重要ポイント への直接リンク" title="重要ポイント への直接リンク">​</a></h3>
<table><thead><tr><th style="text-align:left">項目</th><th style="text-align:left">HttpSession経由</th><th style="text-align:left">直接アクセス</th></tr></thead><tbody><tr><td style="text-align:left"><strong>用途</strong></td><td style="text-align:left">一般的なWebアプリ</td><td style="text-align:left">IdP、複雑なセッション管理</td></tr><tr><td style="text-align:left"><strong>検索</strong></td><td style="text-align:left">セッションIDのみ</td><td style="text-align:left">任意のキー</td></tr><tr><td style="text-align:left"><strong>データ構造</strong></td><td style="text-align:left">フラット</td><td style="text-align:left">階層的・自由</td></tr><tr><td style="text-align:left"><strong>コード変更</strong></td><td style="text-align:left">不要</td><td style="text-align:left">Repository実装必要</td></tr><tr><td style="text-align:left"><strong>Spring連携</strong></td><td style="text-align:left">自動</td><td style="text-align:left">手動</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="選択基準">選択基準<a href="#選択基準" class="hash-link" aria-label="選択基準 への直接リンク" title="選択基準 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">セッションIDでのみアクセス？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Yes → HttpSession経由（Spring Session）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         シンプル、既存コード互換</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── No → ユーザーIDやクライアントIDで検索必要？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ├── Yes → 直接アクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │         IdP、複合検索が必要な場合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └── No → 要件を再確認</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="次のステップ">次のステップ<a href="#次のステップ" class="hash-link" aria-label="次のステップ への直接リンク" title="次のステップ への直接リンク">​</a></h3>
<p>次に読むべきドキュメント:</p>
<ul>
<li><a href="/idp-server/docs/content_11_learning/session-management/oidc-session-management">03. OIDC Session Management</a> - IdPのセッション管理仕様</li>
<li><a href="/secret/04-idp-session-patterns.md">04. IdPセッション設計パターン</a> - Keycloak等の設計</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="関連リンク">関連リンク<a href="#関連リンク" class="hash-link" aria-label="関連リンク への直接リンク" title="関連リンク への直接リンク">​</a></h2>
<ul>
<li><a href="https://docs.spring.io/spring-session/reference/" target="_blank" rel="noopener noreferrer">Spring Session Documentation</a></li>
<li><a href="https://redis.io/docs/data-types/" target="_blank" rel="noopener noreferrer">Redis Data Types</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/19-session-management/02-distributed-session.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_11_learning/session-management/web-session-basics"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">Webセッションの基礎</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_11_learning/session-management/oidc-session-management"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">OIDC Session Management</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#このドキュメントの目的" class="table-of-contents__link toc-highlight">このドキュメントの目的</a><ul><li><a href="#所要時間" class="table-of-contents__link toc-highlight">所要時間</a></li><li><a href="#学べること" class="table-of-contents__link toc-highlight">学べること</a></li></ul></li><li><a href="#なぜ分散セッションが必要か" class="table-of-contents__link toc-highlight">なぜ分散セッションが必要か</a><ul><li><a href="#単一サーバーの限界" class="table-of-contents__link toc-highlight">単一サーバーの限界</a></li><li><a href="#複数サーバーでの問題" class="table-of-contents__link toc-highlight">複数サーバーでの問  題</a></li><li><a href="#解決策-セッション共有" class="table-of-contents__link toc-highlight">解決策: セッション共有</a></li></ul></li><li><a href="#redisへのアクセス方法-2つのパターン" class="table-of-contents__link toc-highlight">Redisへのアクセス方法: 2つのパターン</a></li><li><a href="#パターン1-httpsession経由spring-session" class="table-of-contents__link toc-highlight">パターン1: HttpSession経由（Spring Session）</a><ul><li><a href="#spring-sessionとは" class="table-of-contents__link toc-highlight">Spring Sessionとは</a></li><li><a href="#動作の流れ" class="table-of-contents__link toc-highlight">動作の流れ</a></li><li><a href="#redisのデータ構造" class="table-of-contents__link toc-highlight">Redisのデータ構造</a></li></ul></li><li><a href="#パターン2-直接redisアクセス" class="table-of-contents__link toc-highlight">パターン2: 直接Redisアクセス</a><ul><li><a href="#直接アクセスとは" class="table-of-contents__link toc-highlight">直接アクセスとは</a></li><li><a href="#redisのデータ構造-1" class="table-of-contents__link toc-highlight">Redisのデータ構造</a></li></ul></li><li><a href="#比較-httpsession経由-vs-直接アクセス" class="table-of-contents__link toc-highlight">比較: HttpSession経由 vs 直接アクセス</a><ul><li><a href="#機能比較" class="table-of-contents__link toc-highlight">機能比較</a></li><li><a href="#アクセスパターンの違い" class="table-of-contents__link toc-highlight">アクセスパターンの違い</a></li><li><a href="#データモデルの違い" class="table-of-contents__link toc-highlight">データモデルの違い</a></li></ul></li><li><a href="#使い分け" class="table-of-contents__link toc-highlight">使い分け</a><ul><li><a href="#httpsession経由が適切な場合" class="table-of-contents__link toc-highlight">HttpSession経由が適切な場合</a></li><li><a href="#直接アクセスが適切な場合" class="table-of-contents__link toc-highlight">直接アクセスが適切な場合</a></li></ul></li><li><a href="#なぜidpには直接アクセスが必要か" class="table-of-contents__link toc-highlight">なぜIdPには直接アクセスが必要か</a><ul><li><a href="#oidc-session-managementの要件" class="table-of-contents__link toc-highlight">OIDC Session Managementの要件</a></li><li><a href="#必要な検索パターン" class="table-of-contents__link toc-highlight">必要な検索パターン</a></li></ul></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a><ul><li><a href="#重要ポイント" class="table-of-contents__link toc-highlight">重要ポイント</a></li><li><a href="#選択基準" class="table-of-contents__link toc-highlight">選択基準</a></li><li><a href="#次のステップ" class="table-of-contents__link toc-highlight">次のステップ</a></li></ul></li><li><a href="#関連リンク" class="table-of-contents__link toc-highlight">関連リンク</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>