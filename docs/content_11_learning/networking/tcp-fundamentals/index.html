<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_11_learning/networking/tcp-fundamentals" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">TCP基礎 | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/networking/tcp-fundamentals"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="TCP基礎 | IdP-Server Documentation"><meta data-rh="true" name="description" content="所要時間"><meta data-rh="true" property="og:description" content="所要時間"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/networking/tcp-fundamentals"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/networking/tcp-fundamentals" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/networking/tcp-fundamentals" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.f2470d4e.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.f95f19e9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">アイデンティティ管理の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-fundamentals/modern-web-authz-authn">OAuth 2.0の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-tokens/id-token-jwt">OAuth 2.0トークン</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/openid-connect/oauth-oidc-basics">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-webauthn-passwordless">FIDO2/WebAuthn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/security/glossary">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/multi-tenancy/multi-tenancy-basics">マルチテナント</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/advanced-protocols/ciba-basics">高度なプロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/http-rest/http-basics">HTTP/REST</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jwt-jose/jwt-introduction">JWT/JOSE</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth/OIDC RFC学習</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/verifiable-credentials/">Verifiable Credentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/data-formats/">データフォーマット</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/web-session-basics">セッション管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/crypto/">暗号化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/kubernetes/">コンテナ/Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/linux/">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/networking/">ネットワーク</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/networking/">ネットワーク学習ガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/networking/tcp-fundamentals">プロトコル基礎</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_11_learning/networking/tcp-fundamentals">TCP基礎</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/networking/dns-fundamentals">DNS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/networking/load-balancing">インフラストラクチャ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/networking/network-troubleshooting">トラブルシューティング</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/networking/column-speed-of-light">コラム</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/">JVM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/java/">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/os-fundamentals/">OS基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/frameworks/">フレームワーク</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/sdk/">SDK</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/clean-architecture/">クリーンアーキテクチャ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/performance-tuning/">パフォーマンス・チューニング</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">学習（Learning）</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ネットワーク</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">プロトコル基礎</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">TCP基礎</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>TCP基礎</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="所要時間">所要時間<a href="#所要時間" class="hash-link" aria-label="所要時間 への直接リンク" title="所要時間 への直接リンク">​</a></h2>
<p>約40分</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="学べること">学べること<a href="#学べること" class="hash-link" aria-label="学べること への直接リンク" title="学べること への直接リンク">​</a></h2>
<ul>
<li>TCP/IPプロトコルスタックの概要</li>
<li>TCPの特徴と 役割（信頼性、順序保証、フロー制御）</li>
<li>3ウェイハンドシェイクと4ウェイハンドシェイク</li>
<li>TCPの状態遷移（ESTABLISHED、TIME_WAIT等）</li>
<li>ポート番号とソケット</li>
<li>TCPとUDPの違いと使い分け</li>
<li>HTTP、JDBC、Redis等がTCPをどう使っているか</li>
<li>コネクションプールの仕組みと重要性</li>
<li>実運用でのTCPチューニング</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前提知識">前提知識<a href="#前提知識" class="hash-link" aria-label="前提知識 への直接リンク" title="前提知識 への直接リンク">​</a></h2>
<ul>
<li>ネットワークの基本概念（IPアドレス、パケット）</li>
<li>OSI参照モデルまたはTCP/IPモデルの概要</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-tcpipプロトコルスタック">1. TCP/IPプロトコルスタック<a href="#1-tcpipプロトコルスタック" class="hash-link" aria-label="1. TCP/IPプロトコルスタック への直接リンク" title="1. TCP/IPプロトコルスタック への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-レイヤー構造">1.1 レイヤー構造<a href="#11-レイヤー構造" class="hash-link" aria-label="1.1 レイヤー構造 への直接リンク" title="1.1 レイヤー構造 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              TCP/IPプロトコルスタック                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  OSI参照モデル          TCP/IPモデル         プロトコル例    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  7. アプリケーション層 ┐                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  6. プレゼンテーション層├─ アプリケーション層  HTTP, HTTPS,  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  5. セッション層      ┘                      FTP, SSH, DNS  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  4. トランスポート層  ─── トランスポート層    TCP, UDP      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                              ↑ 今回の主役    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. ネットワーク層    ─── インターネット層    IP, ICMP      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. データリンク層    ┐                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. 物理層           ┘── ネットワーク        Ethernet,      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                           インターフェース層  Wi-Fi          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-データのカプセル化">1.2 データのカプセル化<a href="#12-データのカプセル化" class="hash-link" aria-label="1.2 データのカプセル化 への直接リンク" title="1.2 データのカプセル化 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              データのカプセル化                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  アプリケーション層                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────── ─────────────────────────┐              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │              データ (Payload)              │              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────────────────────────────────────┘              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                     ↓                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  トランスポート層 (TCP)                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────┬───────────────────────────────┐              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ TCPヘッダ │           データ              │ = セグメント │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┴───────────────────────────────┘              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                     ↓                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  インターネット層 (IP)                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────┬──────────┬─────────────────────┐              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ IPヘッダ │ TCPヘッダ │       データ        │ = パケット   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────┴──────────┴─────────────────────┘              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                     ↓                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ネットワークインターフェース層 (Ethernet)                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───────────┬─────────┬──────────┬─────────┬─────┐        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │Etherヘッダ│ IPヘッダ │ TCPヘッダ │  データ │ FCS │= フレーム│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────┴─────────┴──────────┴─────────┴─────┘        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリ ップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-tcpの特徴">2. TCPの特徴<a href="#2-tcpの特徴" class="hash-link" aria-label="2. TCPの特徴 への直接リンク" title="2. TCPの特徴 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-tcpが提供する機能">2.1 TCPが提供する機能<a href="#21-tcpが提供する機能" class="hash-link" aria-label="2.1 TCPが提供する機能 への直接リンク" title="2.1 TCPが提供する機能 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              TCPの主要機能                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────  ────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. 信頼性のある通信 (Reliable Delivery)                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - パケットロスの検出と再送                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - チェックサムによるデータ整合性検証                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - ACK（確認応答）による到達確認                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. 順序保証 (Ordered Delivery)                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - シーケンス番号による順序管理                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 到着順序が異なっても正しい順序で再構築                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. コネクション指向 (Connection-Oriented)                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 通信前に接続確立（3ウェ  イハンドシェイク）             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 通信後に接続終了（4ウェイハンドシェイク）             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  4. フロー制御 (Flow Control)                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 受信側のバッファ溢れを防止                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - ウィンドウサイズによる送信量調整                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  5. 輻輳制御 (Congestion Control)                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - ネットワーク混雑時の送信レート調整                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - スロースタート、輻輳回避アルゴリズム                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  6. 全二重通信 (Full Duplex)                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 双方向同時通信が可能                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-tcpヘッダの構造">2.2 TCPヘッダの構造<a href="#22-tcpヘッダの構造" class="hash-link" aria-label="2.2 TCPヘッダの構造 への直接リンク" title="2.2 TCPヘッダの構造 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              TCPヘッダ（20〜60バイト）                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    0                   1                   2                   3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   |          送信元ポート          |          宛先ポート          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   |                    シーケンス番号                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   |                   確認応答番号 (ACK番号)                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   |  データ  |           |U|A|P|R|S|F|                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   | オフセット| 予約      |R|C|S|S|Y|I|      ウィンドウサイズ     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   |          |           |G|K|H|T|N|N|                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   |         チェックサム           |        緊急ポインタ          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   |                    オプション（可変長）                       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  主要フラグ:                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - SYN: 接続開始                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ACK: 確認応答                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - FIN: 接続終了                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - RST: 接続リセット                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - PSH: プッシュ（バッファリングせず即座に転送）            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - URG: 緊急データ                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-tcp接続の確立と終了">3. TCP接続の確立と終了<a href="#3-tcp接続の確立と終了" class="hash-link" aria-label="3. TCP接続の確立と終了 への直接リンク" title="3. TCP接続の確立と終了 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-3ウェイハンドシェイク接続確立">3.1 3ウェイハンドシェイク（接続確立）<a href="#31-3ウェイハンドシェイク接続確立" class="hash-link" aria-label="3.1 3ウェイハンドシェイク（接続確立） への直接リンク" title="3.1 3ウェイハンドシェイク（接続確立） への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              3ウェイハンドシェイク                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    クライアント                        サーバー              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │ [LISTEN]       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Step 1 │ ──────── SYN (seq=x) ─────────► │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ [SYN_SENT]                                 │ [SYN_RECEIVED] │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Step 2 │ ◄─── SYN+ACK (seq=y, ack=x+1) ── │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Step 3 │ ──────── ACK (ack=y+1) ────────► │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ [ESTABLISHED]                              │ [ESTABLISHED]  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │      双方向通信可能              │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │ ◄────────────────────────────► │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  各ステップの意味:                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. SYN: クライアント→サーバー                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     「接続したい。私のシーケンス番号はxから始める」          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. SYN+ACK: サーバー→クライアント                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     「OK。私のシーケンス番号はyから始める。x+1を待っている」 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. ACK: クライアント→サーバー                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     「了解。y+1を待っている」                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-4ウェイハンドシェイク接続終了">3.2 4ウェイハンドシェイク（接続終了）<a href="#32-4ウェイハンドシェイク接続終了" class="hash-link" aria-label="3.2 4ウェイハンドシェイク（接続終了） への直接リンク" title="3.2 4ウェイハンドシ  ェイク（接続終了） への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              4ウェイハンドシェイク                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    クライアント                        サーバー              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ [ESTABLISHED]                              │ [ESTABLISHED]  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Step 1 │ ──────── FIN (seq=x) ─────────► │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ [FIN_WAIT_1]                               │ [CLOSE_WAIT]   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Step 2 │ ◄─────── ACK (ack=x+1) ───────── │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ [FIN_WAIT_2]                               │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │    (サーバーが残りのデータを送信)│                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Step 3 │ ◄─────── FIN (seq=y) ──────────  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ [TIME_WAIT]                                │ [LAST_ACK]     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Step 4 │ ──────── ACK (ack=y+1) ────────► │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │ [CLOSED]       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    (2MSL待機)                              │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         │                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ [CLOSED]│                                  │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  なぜ4ステップ必要なのか:                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - TCP は全二重通信のため、各方向を独立して終了する必要      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - クライアント→サーバー方向の終了 (Step 1-2)              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - サーバー→クライアント方向の終了 (Step 3-4)              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-tcp状態遷移">3.3 TCP状態遷移<a href="#33-tcp状態遷移" class="hash-link" aria-label="3.3 TCP状態遷移 への直接リンク" title="3.3 TCP状態遷移 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              主要なTCP状態                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【接続前】                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  CLOSED     - 初期状態                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  LISTEN     - サーバーが接続待ち                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【接続確立中】                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  SYN_SENT   - クライアントがSYN送信後                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  SYN_RECEIVED - サーバーがSYN受信後                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【接続確立後】                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ESTABLISHED - 接続確立済み、データ送受信可能              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【接続終了中（アクティブクローズ側）】                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  FIN_WAIT_1 - FIN送信後、ACK待ち                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  FIN_WAIT_2 - ACK受信後、相手のFIN待ち                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TIME_WAIT  - 最後のACK送信後、2MSL待機                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【接続終了中（パッシブクローズ側）】                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  CLOSE_WAIT - FIN受信後、アプリ終了待ち                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  LAST_ACK   - FIN送信後、最後のACK待ち                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【同時クローズ】                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  CLOSING    - 両側が同時にFINを送信した場合                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-time_waitの重要性">3.4 TIME_WAITの重要性<a href="#34-time_waitの重要性" class="hash-link" aria-label="3.4 TIME_WAITの重要性 への直接リンク" title="3.4 TIME_WAITの重要性 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              TIME_WAIT状態の役割                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TIME_WAIT: 接続を閉じた後、2×MSL（Maximum Segment Lifetime）│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             の間、その接続の情報を保持する状態               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  MSL: 通常30秒〜2分（Linux デフォルト: 60秒）               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → TIME_WAIT は 2×60秒 = 120秒 = 2分                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【なぜTIME_WAITが必要か】                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. 遅延パケットの処理                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - ネットワーク上に残っている古いパケットが              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       新しい接続に誤って届くことを防ぐ                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. 最後のACKの再送                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - 最後のACKが失われた場合、相手がFINを再送する          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - TIME_WAIT中なら再度ACKを返せる                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【TIME_WAITが問題になるケース】                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  高トラフィックサーバーで大量のTIME_WAIT接続が滞留          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → ポート枯渇、メモリ消費                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  確認コマンド:                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  $ netstat -an | grep TIME_WAIT | wc -l                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  $ ss -s | grep timewait                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-ポート番号とソケット">4. ポート番号とソケット<a href="#4-ポート番号とソケット" class="hash-link" aria-label="4. ポート番号とソケット への直接リンク" title="4. ポート番号とソケット への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-ポート番号の概念">4.1 ポート番号の概念<a href="#41-ポート番号の概念" class="hash-link" aria-label="4.1 ポート番号の概念 への直接リンク" title="4.1 ポート番号の概念 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌────  ─────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              ポート番号                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ポート番号: 0 〜 65535 (16ビット)                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【ポート番号の分類】                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────┬──────────────┬─────────────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    範囲      │     名称      │         用途            │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├──────────────┼──────────────┼─────────────────────────┤  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  0 - 1023    │ Well-known   │ 標準的なサービス        │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │              │ ポート       │ (HTTP:80, HTTPS:443等)  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │              │              │ root権限が必要(Unix)    │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├──────────────┼──────────────┼─────────────────────────┤  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 1024 - 49151 │ Registered   │ IANA登録済みサービス    │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │              │ ポート       │ (MySQL:3306等)          │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├──────────────┼──────────────┼─────────────────────────┤  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 49152 - 65535│ Dynamic/     │ クライアント側の        │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │              │ Ephemeral    │ 動的ポート              │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │              │ ポート       │ (OSが自動割当)          │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────┴──────────────┴─────────────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【主要なWell-knownポート】                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  20/21  FTP (データ/制御)                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  22     SSH                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  23     Telnet                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  25     SMTP                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  53     DNS (TCP/UDP)                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  80     HTTP                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  110    POP3                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  143    IMAP                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  443    HTTPS                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3306   MySQL                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  5432   PostgreSQL                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  6379   Redis                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  8080   HTTP代替（アプリサーバー）                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-ソケット">4.2 ソケット<a href="#42-ソケット" class="hash-link" aria-label="4.2 ソケット   への直接リンク" title="4.2 ソケット への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              ソケットとコネクション                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【ソケットとは】                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ネットワーク通信のエンドポイント                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - IPアドレス + ポート番号 の組み合わせ                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  例: 192.168.1.10:8080 (ソケット)                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【TCP接続の一意性】                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TCP接続は以下の5つ組（5-tuple）で一意に識別される:         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  (送信元IP, 送信元ポート, 宛先IP, 宛先ポート, TCP)  │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  例:                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (192.168.1.10, 52340, 93.184.216.34, 443, TCP)             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (192.168.1.10, 52341, 93.184.216.34, 443, TCP)             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ↑ 送信元ポートが異なるので別の接続                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【サーバー側のソケット】                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  サーバー (0.0.0.0:8080 LISTEN)                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      ├── 接続1: (Client1_IP:52340, Server_IP:8080)          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      ├── 接続2: (Client1_IP:52341, Server_IP:8080)          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      ├── 接続3: (Client2_IP:49200, Server_IP:8080)          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      └── ...                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → 1つのLISTENソケットで複数のクライアント接続を処理       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-tcpとudpの比較">5. TCPとUDPの比較<a href="#5-tcpとudpの比較" class="hash-link" aria-label="5. TCPとUDPの比較 への直接リンク" title="5. TCPとUDPの比較 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-特徴の比較">5.1 特徴の比較<a href="#51-特徴の比較" class="hash-link" aria-label="5.1 特徴の比較 への直接リンク" title="5.1 特徴の比較 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              TCP vs UDP                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────┬────────────────┬────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │       特徴         │      TCP       │      UDP       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├────────────────────┼────────────────┼────────────────┤   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 接続               │ コネクション型  │ コネクションレス │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 信頼性             │ あり（再送）   │ なし           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 順序保証           │ あり           │ なし           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ フロー/輻輳制御    │ あり           │ なし           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ ヘッダサイズ       │ 20-60バイト    │ 8バイト        │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ オーバーヘッド     │ 大きい         │ 小さい         │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 速度               │ 相対的に遅い   │ 相対的に速い   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 通信形態           │ 1対1           │ 1対1, 1対多    │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ ブロードキャスト   │ 不可           │ 可能           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────┴────────────────┴────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-使い分けのガイドライン">5.2 使い分けのガイドライン<a href="#52-使い分けのガイドライン" class="hash-link" aria-label="5.2 使い分けのガイドライン への直接リンク" title="5.2 使い分けのガイドライン への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              TCP/UDP 使い分けガイド                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【TCP を使うべきケース】                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - HTTP/HTTPS（Web通信）                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - SMTP/IMAP/POP3（メール）                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - FTP（ファイル転送）                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - SSH（リモート接続）                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - データベース接続                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - データの完全性が重要な場合                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → 「全てのデータが確実に届く必要がある」場合               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【UDP を使うべきケース】                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - DNS（名前解決）※TCP も使用                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - NTP（時刻同期）                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - DHCP（IPアドレス取得）                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - VoIP/音声通話                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ビデオストリーミング                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - オンラインゲーム                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - IoTセンサーデータ                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → 「多少のロスより速度・リアルタイム性が重要」な場合       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【HTTPに関する補足】                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  HTTP/1.1, HTTP/2: TCP上で動作                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  HTTP/3 (QUIC): UDP上 で動作（TCPの機能をUDP上で実装）       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-アプリケーションプロトコルとtcp">6. アプリケーションプロトコルとTCP<a href="#6-アプリケーションプロトコルとtcp" class="hash-link" aria-label="6. アプリケーションプロトコルとTCP への直接リンク" title="6. アプリケーションプロトコルとTCP への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-tcpが提供するもの-vs-アプリが実装するもの">6.1 TCPが提供するもの vs アプリが実装するもの<a href="#61-tcpが提供するもの-vs-アプリが実装するもの" class="hash-link" aria-label="6.1 TCPが提供するもの vs アプリが実装するもの への直接リンク" title="6.1 TCPが提供するもの vs アプリが実装するもの への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              TCPとアプリケーションの責務分担                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【TCPが提供するもの（全プロトコル共通）】                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ✓ 接続  の確立と終了                                 │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - 3ウェイハンドシェイク / 4ウェイハンドシェイク  │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - 相手が存在することの確認                       │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ✓ 信頼性のあるバイトストリーム配送                 │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - パケットロス時の再送                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - 順序の保証（届いた順に並べ替え）               │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - 重複排除                                       │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ✓ フロー制御・輻輳制御                             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - 受信側のバッファ溢れ防止                       │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - ネットワーク混雑時の送信抑制                   │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TCPは「バイト列を確実に届ける」だけ。                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  そのバイト列の意味はTCPにはわからない。                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【アプリケーションが実装するもの（プロトコルごとに異なる）】│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───────────────────────────────────────────── ────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ✗ メッセージの区切り（フレーミング）               │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - どこからどこまでが1つのメッセージか           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - TCPはバイトストリームなので区切りがない        │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ✗ メッセージの意味（セマンティクス）               │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - リクエスト/レスポンスのパターン                │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - コマンドの種類、エラーの定義                   │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ✗ 認証・セッション管理                             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - ユーザー認証の方式                             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │    - セッション/トランザクションの概念              │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ✗ 接続の使い方（接続戦略）                         │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - 1リクエスト1接続 or 接続を使い回す             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │    - コネクションプールの有無                       │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-プロトコルごとの違い比較表">6.2 プロトコルごとの違い（比較表）<a href="#62-プロトコルごとの違い比較表" class="hash-link" aria-label="6.2 プロトコルごとの違い（比較表） への直接リンク" title="6.2 プロトコルごとの違い（比較表） への直接リンク">​</a></h3>
<table><thead><tr><th></th><th>HTTP/1.1</th><th>PostgreSQL (JDBC)</th><th>Redis</th><th>WebSocket</th></tr></thead><tbody><tr><td><strong>ポート</strong></td><td>80/443</td><td>5432</td><td>6379</td><td>80/443</td></tr><tr><td><strong>メッセージ形式</strong></td><td>テキスト（ヘッダー+ボディ）</td><td>バイナリ（独自形式）</td><td>テキスト（RESP）</td><td>バイナリフレーム</td></tr><tr><td><strong>区切り方</strong></td><td>Content-Length or chunked</td><td>メッセージ長を先頭に付与</td><td><code>\r\n</code> 区切り</td><td>フレームヘッダに長さを含む</td></tr><tr><td><strong>通信パターン</strong></td><td>リクエスト→レスポンス</td><td>リクエスト→レスポンス</td><td>コマンド→レスポンス</td><td>双方向（いつでも送受信）</td></tr><tr><td><strong>状態</strong></td><td>ステートレス（セッションはアプリ層）</td><td>ステートフル（トランザクション）</td><td>ほぼステートレス</td><td>ステートフル（接続=セッション）</td></tr><tr><td><strong>認証</strong></td><td>ヘッダー（Authorization等）</td><td>接続時に認証ハンドシェイク</td><td>AUTHコマンド</td><td>HTTPヘッダー or メッセージ内</td></tr><tr><td><strong>接続戦略</strong></td><td>Keep-Aliveで再利用</td><td>接続プール必須</td><td>接続プール推奨</td><td>長時間維持</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-具体例ワイヤ上で何が違うか">6.3 具体例：ワイヤ上で何が違うか<a href="#63-具体例ワイヤ上で何が違うか" class="hash-link" aria-label="6.3 具体例：ワイヤ上で何が違うか への直接リンク" title="6.3 具体例：ワイヤ上で何が違うか への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              実際にTCP上を流れるデータの違い                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  すべてのプロトコルで共通:                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────────────────────  ───────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  TCP接続確立 (3-way handshake)                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  SYN → SYN+ACK → ACK                                │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ↓ ここから先がプロトコルごとに違う ↓                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【HTTP/1.1】テキストベース、\r\n区切り                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → クライアントが送信:                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ GET /users HTTP/1.1\r\n                             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Host: api.example.com\r\n                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Accept: application/json\r\n                        │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ \r\n                           ← 空行でヘッダー終了 │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ← サーバーが応答:                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ HTTP/1.1 200 OK\r\n                                 │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Content-Type: application/json\r\n                  │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Content-Length: 27\r\n        ← ボディの長さを指定  │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ \r\n                                                │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ {&quot;users&quot;:[{&quot;id&quot;:1}]}         ← ボディ（27バイト）   │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【PostgreSQL】バイナリ、長さプレフィックス                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → 接続時の認証ハンドシェイク:                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ [00 00 00 08]     ← メッセージ長(8バイト)           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ [00 03 00 00]     ← プロトコルバージョン(3.0)       │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ user\0postgres\0  ← パラメータ(ユーザー名)          │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ database\0mydb\0  ← パラメータ(DB名)                │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ \0                ← パラメータ終端                   │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → クエリ実行:                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ [Q]               ← メッセージタイプ(Query)         │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ [00 00 00 1A]     ← メッセージ長                    │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ SELECT * FROM users\0  ← クエリ文字列(null終端)     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【Redis】テキストベース(RESP)、\r\n区切り                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → コマンド送信:                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ *2\r\n            ← 配列、2要素                     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ $3\r\n            ← バルク文字列、3バイト           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ GET\r\n           ← &quot;GET&quot;                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ $4\r\n            ← バルク文字列、4バイト           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ user\r\n          ← &quot;user&quot;                          │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ← サーバー応答:                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ $5\r\n            ← バルク文字列、5バイト           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ alice\r\n         ← &quot;alice&quot;                         │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【WebSocket】バイナリフレーム                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → 最初はHTTPでアップグレード要求:                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ GET /chat HTTP/1.1\r\n                              │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Upgrade: websocket\r\n                              │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Connection: Upgrade\r\n                             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==\r\n    │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ← サーバーが101で応答後、プロトコルが切り替わる:           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ [81]              ← FIN=1, opcode=1(text)           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ [85]              ← MASK=1, length=5                │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ [xx xx xx xx]     ← マスクキー(4バイト)             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ [masked data]     ← XORマスクされた&quot;hello&quot;          │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="64-なぜこの違いが重要か">6.4 なぜこの違いが重要か<a href="#64-なぜこの違いが重要か" class="hash-link" aria-label="6.4 なぜこの違いが重要か への直接リンク" title="6.4 なぜこの違いが重要か への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────────────────────────  ───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              違いを理解することで見えるもの                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. トラブルシューティング                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ─────────────────────                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     tcpdump/Wiresharkでパケットを見たとき:                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - TCPレベルの問題か？（再送、RST等）                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - アプリレベルの問題か？（不正なフォーマット等）        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     を切り分けられる                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. パフォーマンスチューニング                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ─────────────────────────                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - TCPレベル: バッファサイズ、Keep-Alive設定             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - アプリレベル: コネクションプール、パイプライン        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     どちらをチューニングすべきかわかる                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. プロトコル設計の理解                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ─────────────────────                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     なぜHTTP/2は1接続で多重化できるのか？                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     → TCPは順序保証するだけで、HTTP/2がストリーム管理     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     なぜWebSocketはHTTPでハンドシェイクするのか？           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     → ファイアウォール/プロキシを通過するため             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  4. セキュリティの理解                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ─────────────────────                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     TCPレベルで暗号化（TLS）すると:                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - アプリプロトコルの内容は見えなくなる                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - でもTCPヘッダー（ポート、IP）は見える                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     - メタデータの漏洩リスクを理解できる                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="65-例httpとtcpの関係">6.5 例：HTTPとTCPの関係<a href="#65-例httpとtcpの関係" class="hash-link" aria-label="6.5 例：HTTPとTCPの関係 への直接リンク" title="6.5 例：HTTPとTCPの関係 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              HTTPはTCPの上で動く                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【HTTP/1.0 - リクエストごとに接続】                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  クライアント              サーバー                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── TCP 3way handshake ──│  接続確立                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── GET /index.html ────►│  リクエスト                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄── 200 OK + HTML ──────│  レスポンス                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── TCP 4way handshake ──│  接続終了                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── TCP 3way handshake ──│  また接続確立（遅い！）     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── GET /style.css ─────►│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄── 200 OK + CSS ───────│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── TCP 4way handshake ──│  また接続終了               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  問題: 毎回ハンドシェイクのオーバーヘッドが発生             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【HTTP/1.1 - Keep-Alive（持続的接続）】                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  クライアント              サーバー                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── TCP 3way handshake ──│  接続確立（1回だけ）        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── GET /index.html ────►│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄── 200 OK + HTML ──────│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │  ← 接続を維持               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── GET /style.css ─────►│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄── 200 OK + CSS ───────│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │  ← まだ維持                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── GET /script.js ─────►│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄── 200 OK + JS ────────│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │    (タイムアウト後)     │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── TCP 4way handshake ──│  接続終了                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  改善: 1つのTCP接続で複数のリクエストを処理                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        ただしリクエストは順番に処理（Head-of-Line Blocking）│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【HTTP/2 - 多重化】                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  クライアント              サーバー                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── TCP 3way handshake ──│  接続確立（1回だけ）        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │══ Stream 1: GET /a ═══►│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │══ Stream 2: GET /b ═══►│  同時に複数リクエスト       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │══ Stream 3: GET /c ═══►│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄══ Stream 2: /b ═══════│  順不同でレスポンス         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄══ Stream 1: /a ═══════│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄══ Stream 3: /c ═══════│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  改善: 1つのTCP接続で複数のリクエストを並列処理             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────── ───────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="66-例データベース接続jdbcとtcp">6.6 例：データベース接続（JDBC）とTCP<a href="#66-例データベース接続jdbcとtcp" class="hash-link" aria-label="6.6 例：データベース接続（JDBC）とTCP への直接リンク" title="6.6 例：データベース接続（JDBC）とTCP への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              JDBCはTCPコネクションを使う                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【毎回接続する場合（非効率）】                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  アプリ                    PostgreSQL (5432)                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │                           │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │── TCP 3way handshake ────►│  接続確立                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │── 認証（ユーザー/パス）──►│  認証処理                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │◄── 認証OK ────────────────│                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │                           │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │── SELECT * FROM users ───►│  クエリ実行                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │◄── 結果セット ───  ─────────│                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │                           │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │── TCP 4way handshake ────►│  接続終了                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │                           │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │   次のリクエストでまた最初から...                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  問題:                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 毎回ハンドシェイク（1.5 RTT）                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 毎回認証処理                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - DBサーバー側でのプロセス/スレッド生成コスト              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【コネクションプール（効率的）】                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  アプリ        HikariCP等         PostgreSQL                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │          (プール)               │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │── TCP接続 ──────►│ 起動時に接続確立     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │── TCP接続 ──────►│ 複数コネクション     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │── TCP接続 ──────►│ をプールしておく     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │  【接続済みプール】                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │  ┌─────────────┐ │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │  │ Conn1: IDLE │ │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │  │ Conn2: IDLE │ │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │  │ Conn3: IDLE │ │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │  └─────────────┘ │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │─ getConn() ─►│                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │◄─ Conn1 ─────│                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │── SELECT ────────────────────────► クエリ実行          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │◄── 結果 ─────────────────────────│（接続確立不要）     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │─ close() ───►│                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │  Conn1をプールに戻す                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │              │                  │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  利点:                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 接続確立のオーバーヘッドなし                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 認証処理も不要（接続済み）                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - DBサーバーの負荷軽減                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="67-例その他のプロトコルとtcp">6.7 例：その他のプロトコルとTCP<a href="#67-例その他のプロトコルとtcp" class="hash-link" aria-label="6.7 例：その他のプロトコルとTCP への直接リンク" title="6.7 例：その他のプロトコルとTCP への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              様々なプロトコルのTCP利用パターン               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【Redis】                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ポート: 6379                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 持続的接続（コネクションプール推奨）                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - パイプライニング: 複数コマンドを一括送信                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  GET key1                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  GET key2     → 1つのTCPパケットで送信                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  GET key3                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【WebSocket】                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - HTTPでハンドシェイク後、TCPコネクションを維持            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 双方向リアルタイム通信                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  クライアント              サーバー                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │── HTTP Upgrade要求 ───►│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄── 101 Switching ──────│                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄═══ WebSocket通信 ════►│  TCP接続を維持したまま     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │◄═══ 双方向に送受信 ═══►│  HTTPではなくなる          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │                        │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【gRPC】                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - HTTP/2上で動作                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - つまりTCP上でHTTP/2、その上でgRPC                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ストリーミング対応                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────┐                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │               gRPC                       │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─────────────────────────────────────────┤                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │             HTTP/2                       │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─────────────────────────────────────────┤                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │              TCP                         │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────────────────────────┘                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【SSH】                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ポート: 22                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - 1つのTCP接続で複数チャンネルを多重化                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ポートフォワーディング（TCP接続のトンネリング）          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ssh -L 3306:db.internal:3306 bastion                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ↓                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  localhost:3306 → SSHトンネル → db.internal:3306            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  （ローカルのMySQL接続がSSH経由でリモートDBへ）             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="68-コネクションプールの重要性">6.8 コネクションプールの重要性<a href="#68-コネクションプールの重要性" class="hash-link" aria-label="6.8 コネクションプールの重要性 への直接リンク" title="6.8 コネクションプールの重要性 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              TCPコネクション確立のコスト                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【1回の接続確立にかかる時間】                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  例: クライアント ←→ DB サーバー間の RTT = 1ms             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. TCP 3way handshake:  1.5 RTT = 1.5ms                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. DB認証処理:          約 0.5ms                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. 実際のクエリ:        約 0.1ms                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ──────────────────────────────────────                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  合計:                   約 2.1ms                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → クエリ0.1msのために2msのオーバーヘッド                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → 95%が接続確立のコスト                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【コネクションプールを使った場合】                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. プールから取得:      約 0.01ms（メモリ操作のみ）        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. 実際のクエリ:        約 0.1ms                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. プールに返却:        約 0.01ms                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ──────────────────────────────────────                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  合計:                   約 0.12ms                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → 約17倍高速                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【プール設定のポイント】                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  HikariCP (Java) の例:                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  maximumPoolSize: 10      # 最大接続数                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  minimumIdle: 5           # 最小アイドル接続数              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  connectionTimeout: 30000 # 接続取得タイムアウト(ms)        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  idleTimeout: 600000      # アイドル接続のタイムアウト(ms)  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  maxLifetime: 1800000     # 接続の最大生存時間(ms)          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  注意:                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - DBサーバーのmax_connections を超えないように設定         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - アプリサーバーの台数 × プールサイズ ≤ DB max_connections │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-tcpの確認コマンド">7. TCPの確認コマンド<a href="#7-tcpの確認コマンド" class="hash-link" aria-label="7. TCPの確認コマンド への直接リンク" title="7. TCPの確認コマンド への直 接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-接続状態の確認">7.1 接続状態の確認<a href="#71-接続状態の確認" class="hash-link" aria-label="7.1 接続状態の確認 への直接リンク" title="7.1 接続状態の確認 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># netstat（古いがまだ使われている）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netstat -an              # 全接続を数値表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netstat -ant             # TCPのみ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netstat -antp            # TCPとプロセス名（Linux、要root）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netstat -s               # プロトコル統計</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ss（netstatの後継、推奨）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -s                    # 統計サマリー</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -ant                  # TCP接続一覧</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -antp                 # TCP接続とプロセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss state established     # ESTABLISHED状態のみ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss state time-wait       # TIME_WAIT状態のみ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -o state established  # タイマー情報付き</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 出力例:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># State    Recv-Q Send-Q Local Address:Port  Peer Address:Port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ESTAB    0      0      192.168.1.10:22     192.168.1.100:52340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># TIME-WAIT 0     0      192.168.1.10:80     192.168.1.100:52341</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-リスニングポートの確認">7.2 リスニングポートの確認<a href="#72-リスニングポートの確認" class="hash-link" aria-label="7.2 リスニングポートの確認 への直接リンク" title="7.2 リスニングポートの確認 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># リッスン中のポートを確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -tlnp                 # TCPリッスンポート</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -ulnp                 # UDPリッスンポート</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 特定ポートの確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -tlnp | grep 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lsof -i :8080            # macOS/Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ポートを使用しているプロセスを特定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lsof -i TCP:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fuser 8080/tcp           # Linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="73-接続テスト">7.3 接続テスト<a href="#73-接続テスト" class="hash-link" aria-label="7.3 接続テスト への直接リンク" title="7.3 接続テスト への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># telnet（TCPポート接続テスト）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">telnet example.com 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># nc/netcat（より柔軟）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nc -vz example.com 80    # TCP接続テスト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nc -vzu example.com 53   # UDP接続テスト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 接続タイムアウト付き</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nc -w 5 -vz example.com 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># curl（HTTP/HTTPS）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -v https://example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl --connect-timeout 5 https://example.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-tcpチューニング">8. TCPチューニング<a href="#8-tcpチューニング" class="hash-link" aria-label="8. TCPチューニング への直接リンク" title="8. TCPチューニング への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="81-よく調整されるパラメータ">8.1 よく調整されるパラメータ<a href="#81-よく調整されるパラメータ" class="hash-link" aria-label="8.1 よく調整されるパラメータ への直接リンク" title="8.1 よく調整されるパラメータ への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              主要なTCPカーネルパラメータ（Linux）            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【接続関連】                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.core.somaxconn = 4096                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - LISTENソケットのバックログキューサイズ                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 接続要求の待ち行列の最大長                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.ipv4.tcp_max_syn_backlog = 4096                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - SYN_RECEIVED状態の接続の最大数                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - SYN flood攻撃対策にも関連                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【TIME_WAIT関連】                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.ipv4.tcp_tw_reuse = 1                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - TIME_WAIT状態のソケットを新しい接続で再利用           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - クライアント側で有効（アウトバウンド接続）             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.ipv4.tcp_fin_timeout = 30                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - FIN_WAIT_2状態のタイムアウト（秒）                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - デフォルト60秒を短縮                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【バッファ関連】                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.core.rmem_max = 16777216                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 受信バッファの最大サイズ                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.core.wmem_max = 16777216                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 送信バッファ  の最大サイズ                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.ipv4.tcp_rmem = &quot;4096 87380 16777216&quot;                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - TCP受信バッファ（最小/デフォルト/最大）               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.ipv4.tcp_wmem = &quot;4096 65536 16777216&quot;                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - TCP送信バッファ（最小/デフォルト/最大）               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【Keep-Alive関連】                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.ipv4.tcp_keepalive_time = 600                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - アイドル後、最初のKeep-Aliveを送るまでの時間（秒）    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.ipv4.tcp_keepalive_intvl = 60                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Keep-Aliveプローブの間隔（秒）                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  net.ipv4.tcp_keepalive_probes = 5                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 応答なしで接続を切断するまでのプローブ回数            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="82-設定の確認と変更">8.2 設定の確認と変更<a href="#82-設定の確認と変更" class="hash-link" aria-label="8.2 設定の確認と変更 への直接リンク" title="8.2 設定の確認と変更 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 現在の設定確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysctl net.ipv4.tcp_tw_reuse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysctl net.core.somaxconn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 一時的な変更（再起動で元に戻る）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sysctl -w net.core.somaxconn=4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 永続的な変更</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># /etc/sysctl.conf または /etc/sysctl.d/99-tcp-tuning.conf に追記:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># net.core.somaxconn = 4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># net.ipv4.tcp_tw_reuse = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 設定を反映</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sysctl -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="学んだこと">学んだこと<a href="#学んだこと" class="hash-link" aria-label="学んだこと への直接リンク" title="学んだこと への直接リンク">​</a></h3>
<ul>
<li>TCP/IPプロトコルスタックの構造</li>
<li>TCPの主要機能（信頼性、順序保証、フロー制御等）</li>
<li>3ウェイハンドシェイクと4ウェイハンドシェイク</li>
<li>TCP状態遷移とTIME_WAITの意味</li>
<li>ポート番号とソケットの概念</li>
<li>TCPとUDPの違いと使い分け</li>
<li>HTTP、JDBC、Redis等がTCP  をどう使うか</li>
<li>コネクションプールの仕組みと重要性</li>
<li>TCPの確認コマンドとチューニング</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重要なポイント">重要なポイント<a href="#重要なポイント" class="hash-link" aria-label="重要なポイント への直接リンク" title="重要なポイント への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. TCPの信頼性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - ACKによる到達確認と再送制御</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - シーケンス番号による順序保証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - チェックサムによる整合性検証</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 接続管理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 3ウェイハンドシェイク（SYN → SYN+ACK → ACK）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 4ウェイハンドシェイク（FIN → ACK → FIN → ACK）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - TIME_WAIT状態の2MSL待機</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. アプリケーションとTCPの関係</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - HTTP/1.1 Keep-Alive: 1つのTCP接続で複数リクエスト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - HTTP/2: 1つのTCP接続で多重化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - JDBC: コネクションプールでTCP接続を再利用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - 接続確立コストは大きい → プール化が重要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. 運用上の考慮点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - TIME_WAIT滞留の監視</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - コネクションプールサイズの適切な設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Keep-Aliveによるアイドル接続の管理</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="チェックリスト">チェックリスト<a href="#チェックリスト" class="hash-link" aria-label="チェックリスト への直接リンク" title="チェックリスト への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">□ netstat/ss コマンドで接続状態を確認できる</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">□ TIME_WAIT状態の意味と対処法を理解している</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">□ TCPとUDPの使い分けを判断できる</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">□ HTTPがTCPをどう使っているか説明できる</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">□ コネクションプールの必要性を説明できる</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">□ 接続トラブル時の診断手順を理解している</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="次のステップ">次のステップ<a href="#次のステップ" class="hash-link" aria-label="次のステップ への直接リンク" title="次のステップ への直接リンク">​</a></h3>
<ul>
<li><a href="/idp-server/docs/content_11_learning/networking/load-balancing">03-load-balancing.md</a> - ロードバランシング</li>
<li><a href="/idp-server/docs/content_11_learning/networking/https-termination">08-https-termination.md</a> - HTTPS終端</li>
<li><a href="/idp-server/docs/content_11_learning/networking/network-troubleshooting">06-network-troubleshooting.md</a> - ネットワークトラブルシューティング</li>
<li><a href="/idp-server/docs/content_11_learning/linux/networking-basics">../14-linux/networking-basics.md</a> - Linuxネットワーク基礎</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参考リンク">参考リンク<a href="#参考リンク" class="hash-link" aria-label="参考リンク への直接リンク" title="参考リンク への直接リンク">​</a></h3>
<ul>
<li><a href="https://www.rfc-editor.org/rfc/rfc793" target="_blank" rel="noopener noreferrer">RFC 793 - Transmission Control Protocol</a></li>
<li><a href="https://www.rfc-editor.org/rfc/rfc9293" target="_blank" rel="noopener noreferrer">RFC 9293 - Transmission Control Protocol (TCP) - 2022年改訂版</a></li>
<li><a href="https://access.redhat.com/documentation/" target="_blank" rel="noopener noreferrer">Linux TCP Tuning - Red Hat Documentation</a></li>
<li><a href="https://www.oreilly.com/library/view/tcpip-illustrated-volume/9780132808200/" target="_blank" rel="noopener noreferrer">TCP/IP Illustrated, Volume 1</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/15-networking/09-tcp-fundamentals.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_11_learning/networking/"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">ネットワーク学習ガイド</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_11_learning/networking/dns-fundamentals"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">DNS基礎</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#所要時間" class="table-of-contents__link toc-highlight">所要時間</a></li><li><a href="#学べること" class="table-of-contents__link toc-highlight">学べること</a></li><li><a href="#前提知識" class="table-of-contents__link toc-highlight">前提知識</a></li><li><a href="#1-tcpipプロトコルスタック" class="table-of-contents__link toc-highlight">1. TCP/IPプロトコルスタック</a><ul><li><a href="#11-レイヤー構造" class="table-of-contents__link toc-highlight">1.1 レイヤー構造</a></li><li><a href="#12-データのカプセル化" class="table-of-contents__link toc-highlight">1.2 データのカプセル化</a></li></ul></li><li><a href="#2-tcpの特徴" class="table-of-contents__link toc-highlight">2. TCPの特徴</a><ul><li><a href="#21-tcpが提供する機能" class="table-of-contents__link toc-highlight">2.1 TCPが提供する機能</a></li><li><a href="#22-tcpヘッダの構造" class="table-of-contents__link toc-highlight">2.2 TCPヘッダの構造</a></li></ul></li><li><a href="#3-tcp接続の確立と終了" class="table-of-contents__link toc-highlight">3. TCP接続の確立と終了</a><ul><li><a href="#31-3ウェイハンドシェイク接続確立" class="table-of-contents__link toc-highlight">3.1 3ウェイハンドシェイク（接続確立）</a></li><li><a href="#32-4ウェイハンドシェイク接続終了" class="table-of-contents__link toc-highlight">3.2 4ウェイハンドシェイク（接続終了）</a></li><li><a href="#33-tcp状態遷移" class="table-of-contents__link toc-highlight">3.3 TCP状態遷移</a></li><li><a href="#34-time_waitの重要性" class="table-of-contents__link toc-highlight">3.4 TIME_WAITの重要性</a></li></ul></li><li><a href="#4-ポート番号とソケット" class="table-of-contents__link toc-highlight">4. ポート番号とソケット</a><ul><li><a href="#41-ポート番号の概念" class="table-of-contents__link toc-highlight">4.1 ポート番号の概念</a></li><li><a href="#42-ソケット" class="table-of-contents__link toc-highlight">4.2 ソケット</a></li></ul></li><li><a href="#5-tcpとudpの比較" class="table-of-contents__link toc-highlight">5. TCPとUDPの比較</a><ul><li><a href="#51-特徴の比較" class="table-of-contents__link toc-highlight">5.1 特徴の比較</a></li><li><a href="#52-使い分けのガイドライン" class="table-of-contents__link toc-highlight">5.2 使い分けのガイドライン</a></li></ul></li><li><a href="#6-アプリケーションプロトコルとtcp" class="table-of-contents__link toc-highlight">6. アプリケーションプロトコルとTCP</a><ul><li><a href="#61-tcpが提供するもの-vs-アプリが実装するもの" class="table-of-contents__link toc-highlight">6.1 TCPが提供するもの vs アプリが実装するもの</a></li><li><a href="#62-プロトコルごとの違  い比較表" class="table-of-contents__link toc-highlight">6.2 プロトコルごとの違い（比較表）</a></li><li><a href="#63-具体例ワイヤ上で何が違うか" class="table-of-contents__link toc-highlight">6.3 具体例：ワイヤ上で何が違うか</a></li><li><a href="#64-なぜこの違いが重要か" class="table-of-contents__link toc-highlight">6.4 なぜこの違いが重要か</a></li><li><a href="#65-例httpとtcpの関係" class="table-of-contents__link toc-highlight">6.5 例：HTTPとTCPの関係</a></li><li><a href="#66-例データベース接続jdbcとtcp" class="table-of-contents__link toc-highlight">6.6 例：データベース接続（JDBC）とTCP</a></li><li><a href="#67-例その他のプロトコルとtcp" class="table-of-contents__link toc-highlight">6.7 例：その他のプロトコルとTCP</a></li><li><a href="#68-コネクションプールの重要性" class="table-of-contents__link toc-highlight">6.8 コネクションプールの重要性</a></li></ul></li><li><a href="#7-tcpの確認コマンド" class="table-of-contents__link toc-highlight">7. TCPの確認コマンド</a><ul><li><a href="#71-接続状態の確認" class="table-of-contents__link toc-highlight">7.1 接続状態の確認</a></li><li><a href="#72-リスニングポートの確認" class="table-of-contents__link toc-highlight">7.2 リスニングポートの確認</a></li><li><a href="#73-接続テスト" class="table-of-contents__link toc-highlight">7.3 接続テスト</a></li></ul></li><li><a href="#8-tcpチューニング" class="table-of-contents__link toc-highlight">8. TCPチューニング</a><ul><li><a href="#81-よく調整されるパラメータ" class="table-of-contents__link toc-highlight">8.1 よく調整されるパラメータ</a></li><li><a href="#82-設定の確認と変更" class="table-of-contents__link toc-highlight">8.2 設定の確認と変更</a></li></ul></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a><ul><li><a href="#学んだこと" class="table-of-contents__link toc-highlight">学んだこと</a></li><li><a href="#重要なポイント" class="table-of-contents__link toc-highlight">重要なポイント</a></li><li><a href="#チェックリスト" class="table-of-contents__link toc-highlight">チェックリスト</a></li><li><a href="#次のステップ" class="table-of-contents__link toc-highlight">次のステップ</a></li><li><a href="#参考リンク" class="table-of-contents__link toc-highlight">参考リンク</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>