<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content_11_learning/jvm/jvm-03-memory" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">メモリ管理 | IdP-Server Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/jvm/jvm-03-memory"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="メモリ管理 | IdP-Server Documentation"><meta data-rh="true" name="description" content="はじめに"><meta data-rh="true" property="og:description" content="はじめに"><link data-rh="true" rel="icon" href="/idp-server/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/jvm/jvm-03-memory"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/jvm/jvm-03-memory" hreflang="ja"><link data-rh="true" rel="alternate" href="https://hirokazu-kobayashi-koba-hiro.github.io/idp-server/docs/content_11_learning/jvm/jvm-03-memory" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/idp-server/blog/rss.xml" title="IdP-Server Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/idp-server/blog/atom.xml" title="IdP-Server Documentation Atom Feed"><link rel="stylesheet" href="/idp-server/assets/css/styles.f434a3d5.css">
<script src="/idp-server/assets/js/runtime~main.0db1aa82.js" defer="defer"></script>
<script src="/idp-server/assets/js/main.991ff287.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/idp-server/"><div class="navbar__logo"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/idp-server/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IdP-Server</b></a><a class="navbar__item navbar__link" href="/idp-server/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/idp-server/docs/content_07_reference/api-reference">Api Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hirokazu-kobayashi-koba-hiro/idp-server" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/introduction">はじめに</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/idp-server/docs/document-index">ドキュメントガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_01_intro/intro-01-tech-overview">製品紹介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_02_quickstart/quickstart-01-getting-started">クイックスタート</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_03_concepts/foundation/concept-01-multi-tenant">コア概念</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_04_protocols/protocol-01-authorization-code-flow">認証・認可プロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_05_how-to/">How-to（設定・運用レシピ）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_06_developer-guide/">開発者ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_07_reference/api-reference">リファレンス</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">学習（Learning）</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/identity-basics/identity-management-basics">アイデンティティ管理の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-fundamentals/modern-web-authz-authn">OAuth 2.0の基礎</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-tokens/id-token-jwt">OAuth 2.0トークン</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/openid-connect/oauth-oidc-basics">OpenID Connect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/fido-webauthn/fido2-architecture-rp-browser-authenticator">FIDO2/WebAuthn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/security/glossary">セキュリティ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/multi-tenancy/multi-tenancy-basics">マルチテナント</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/advanced-protocols/ciba-basics">高度なプロトコル</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/http-rest/http-basics">HTTP/REST</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jwt-jose/jwt-introduction">JWT/JOSE</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/oauth-oidc-rfc/">OAuth/OIDC RFC学習</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/verifiable-credentials/">Verifiable Credentials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/data-formats/">データフォーマット</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/session-management/web-session-basics">セッション管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/postgresql/">PostgreSQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/crypto/">暗号化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/kubernetes/">コンテナ/Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/linux/">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/">JVM</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/">JVM 学習ガイド</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/jvm-01-overview">基礎</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/jvm-01-overview">JVM概要</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/jvm-02-classloading">クラスローディング</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/jvm-03-memory">メモリ管理</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/jvm-04-gc">ガベージコレクション</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/jvm-06-performance">応用</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/jvm-08-java21">最新機能</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/idp-server/docs/content_11_learning/jvm/jvm-10-compilation">コンパイル</a></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_08_ops/ops-01-test-strategy">運用（Ops）</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_09_project/project-01-faq">プロジェクト</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/idp-server/docs/content_10_ai_developer/ai-01-index">AI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/idp-server/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">学習（Learning）</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">JVM</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">基礎</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">メモリ管理</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>メモリ管理</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="はじめに">はじめに<a href="#はじめに" class="hash-link" aria-label="はじめに への直接リンク" title="はじめに への直接リンク">​</a></h2>
<p>JVMのメモリ管理を理解することは、アプリケーションのパフォーマンス最適化とトラブルシューティングに不可欠です。この章では、JVMの各メモリ領域の役割と特徴を解説します。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="jvmメモリ構造の全体像">JVMメモリ構造の全体像<a href="#jvmメモリ構造の全体像" class="hash-link" aria-label="JVMメモリ構造の全体像 への直接リンク" title="JVMメモリ構造の全体像 への直接リンク">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                           JVM Process                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                         Heap                                    │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────────────────┐  ┌─────────────────────────────┐  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │      Young Generation    │  │       Old Generation        │  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  ┌─────┐ ┌────┐ ┌────┐  │  │                             │  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  │Eden │ │ S0 │ │ S1 │  │  │   Long-lived objects        │  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  └─────┘ └────┘ └────┘  │  │                             │  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────────────────┘  └─────────────────────────────┘  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                      -Xms / -Xmx                                │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                        Metaspace                                │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  クラスメタデータ、定数プール、メソッド情報                     │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                   -XX:MaxMetaspaceSize                          │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───────────────────┐  ┌───────────────────┐  ┌─────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   Thread Stacks   │  │   Code Cache      │  │  Direct Memory  │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   -Xss            │  │   JIT compiled    │  │  NIO buffers    │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────────────┘  └───────────────────┘  └─────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ヒープheap">ヒープ（Heap）<a href="#ヒープheap" class="hash-link" aria-label="ヒープ（Heap） への直接リンク" title="ヒープ（Heap） への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概要">概要<a href="#概要" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h3>
<p>ヒープは、オブジェクトインスタンスと配列が格納される領域です。GC（ガベージコレクション）の対象となります。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="世代別構成">世代別構成<a href="#世代別構成" class="hash-link" aria-label="世代別構成 への直接リンク" title="世代別構成 への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                           Heap                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Young Generation（若い世代）                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                 │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌──────────────────────────────┐                              │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │           Eden               │  新しいオブジェクトはここに   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │                              │  割り当てられる               │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └──────────────────────────────┘                              │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                 │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌────────────────┐  ┌────────────────┐                        │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  Survivor 0    │  │  Survivor 1    │  Eden から生き残った    │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │   (From)       │  │    (To)        │  オブジェクトがコピー   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └────────────────┘  └────────────────┘                        │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                 │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Old Generation（古い世代）                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                 │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  長期間生存したオブジェクト                                     │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  （Survivor を何度か経由したもの）                              │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                 │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="オブジェクトのライフサイクル">オブジェクトのライフサイクル<a href="#オブジェクトのライフサイクル" class="hash-link" aria-label="オブジェクトのライフサイクル への直接リンク" title="オブジェクトのライフサイクル への直接リンク">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. new Object()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Eden に割り当て</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ↓ (Minor GC発生)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ┌───┴───┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 生存    死亡 → 回収</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Survivor へコピー</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   (年齢 +1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ↓ (Minor GC繰り返し)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 年齢が閾値に達する</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   (デフォルト: 15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Old Generation へ昇格</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ↓ (Major GC発生)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ┌─── ┴───┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 生存    死亡 → 回収</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ヒープサイズの設定">ヒープサイズの設定<a href="#ヒープサイズの設定" class="hash-link" aria-label="ヒープサイズの設定 への直接リンク" title="ヒープサイズの設定 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 初期ヒープサイズと最大ヒープサイズ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -Xms512m -Xmx2g -jar app.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 同じ値に設定するのが推奨（動的リサイズのオー バーヘッド回避）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -Xms2g -Xmx2g -jar app.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>オプション</th><th>説明</th><th>推奨設定</th></tr></thead><tbody><tr><td><code>-Xms</code></td><td>初期ヒープサイズ</td><td><code>-Xmx</code>と同じ値</td></tr><tr><td><code>-Xmx</code></td><td>最大ヒープサイズ</td><td>物理メモリの50-70%</td></tr><tr><td><code>-Xmn</code></td><td>Young Generationサイズ</td><td>通常は自動調整に任せる</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="世代別サイズ比率">世代別サイズ比率<a href="#世代別サイズ比率" class="hash-link" aria-label="世代別サイズ比率 への直接リンク" title="世代別サイズ比率 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Young Generation の割合を指定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -XX:NewRatio=2 -jar app.jar  # Old:Young = 2:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Survivor の割合を指定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -XX:SurvivorRatio=8 -jar app.jar  # Eden:S0:S1 = 8:1:1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="スタックstack">スタック（Stack）<a href="#スタックstack" class="hash-link" aria-label="スタック（Stack） への直接リンク" title="スタック（Stack） への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概要-1">概要<a href="#概要-1" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h3>
<p>各スレッドには専用のスタックがあり、メソッド呼び出しごとにスタックフレームが積まれます。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                        Thread Stack                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    Stack Frame (methodC)                        │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────────────┐   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ローカル変数   │ │オペランド    │ │フレームデータ        │   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │テーブル       │ │スタック      │ │(戻りアドレス等)      │   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └──────────────┘ └──────────────┘ └──────────────────────┘   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    Stack Frame (methodB)                        │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────────────┐   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ローカル変数   │ │オペランド    │ │フレームデータ        │   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │テーブル       │ │スタック      │ │                      │   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └──────────────┘ └──────────────┘ └──────────────────────┘   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    Stack Frame (methodA)                        │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────────────┐   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ローカル変数   │ │オペランド    │ │フレームデータ        │   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │テーブル       │ │スタック      │ │                      │   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └──────────────┘ └──────────────┘ └──────────────────────┘   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                              ↓ スタックの成長方向                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="スタックのライフサイクル">スタックのライフサイクル<a href="#スタックのライフサイクル" class="hash-link" aria-label="スタックのライフサイクル への直接リンク" title="スタックのライフサイクル への直接リンク">​</a></h3>
<p>スタックはスレッドと共に生成・破棄されます。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    スタックのライフサイクル                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. スレッド作成時                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     new Thread() / Executors.newThread() / Virtual Thread           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              │                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              ↓                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ┌─────────────────────────────────┐                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │  スタッ  ク領域を確保              │  ← OSからメモリ割り当て    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │  (デフォルト: 1MB)               │    (-Xss で指定)           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     └─────────────────────────────────┘                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. メソッド呼び出し時                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     method() を呼び出すたび                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              │                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              ↓                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ┌─────────────────────────────────┐                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │  スタックフレームをプッシュ      │  ← スタックポインタ移動    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │  (ローカル変数、戻りアドレス等)  │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     └─────────────────────────────────┘                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. メソッド終了時（return / 例外）                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     method() から戻るたび                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              │                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              ↓                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ┌─────────────────────────────────┐                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │  スタックフレームをポップ        │  ← スタックポインタ移動    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │  (メモリは即座に再利用可能)      │    GC不要！                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     └─────────────────────────────────┘                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  4. スレッド終了時                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     run() 完了 / interrupt / 例外                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              │                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              ↓                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ┌─────────────────────────────────┐                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │  スタック領域を解放              │  ← OSにメモリ返却          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     │  (スレッド全体のスタック消滅)    │                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     └─────────────────────────────────┘                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="具体例メソッド呼び出しとスタックフレーム">具体例：メソッド呼び出しとスタックフレーム<a href="#具体例メソッド呼び出しとスタックフレーム" class="hash-link" aria-label="具体例：メソッド呼び出しとスタックフレーム への直接リンク" title="具体例：メソッド呼び出しとスタックフレーム への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class StackLifecycleExample {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {    // ← Frame 1 作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;main start&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        methodA();                               // ← Frame 2 作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;main end&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }                                            // ← Frame 1 破棄</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static void methodA() {                      // Frame 2 の中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int x = 10;                              // x はスタックに格納</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        methodB(x);                              // ← Frame 3 作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }                                            // ← Frame 2 破棄、x は消滅</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static void methodB(int value) {             // Frame 3 の中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int y = value * 2;                       // y はスタックに格納</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }                                            // ← Frame 3 破棄、y は消滅</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              スタックの状態変化                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  main()開始    methodA()呼出   methodB()呼出   methodB()終了        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               ┌──────────┐                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               │ methodB  │                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               ┌──────────┐   │ y = 20   │   ┌──────────┐           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               │ methodA  │   ├──────────┤   │ methodA  │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────┐│ x = 10   │   │ methodA  │   │ x = 10   │ ┌────────┐│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  main    │├──────────┤   │ x = 10   │   ├──────────┤ │  main  ││</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ args=[]  ││  main    │   ├──────────┤   │  main    │ │ args=[]││</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────┘│ args=[]  │   │  main    │   │ args=[]  │ └────────┘│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              └──────────┘   │ args=[]  │   └──────────┘           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                             └──────────┘                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ↓            ↓              ↓              ↓           ↓     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     Frame 1    Frame 1+2     Frame 1+2+3    Frame 1+2     Frame 1  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="スレッドのライフサイクルとスタック">スレッドのライフサイクルとスタック<a href="#スレッドのライフサイクルとスタック" class="hash-link" aria-label="スレッドのライフサイクルとスタック への直接リンク" title="スレッドのライフサイクルとスタック への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Platform Thread の場合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Thread thread = new Thread(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ここでスタックが使用される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    processData();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thread.start();   // スタック作成（1MB確保）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thread.join();    // スレッド終了 → スタック解放</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Virtual Thread の場合（Java 21+）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Thread vThread = Thread.startVirtualThread(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 小さな初期スタック（数KB）、必要に応じて拡張</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    processData();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Virtual Thread 終  了 → スタック解放（ヒープ上のオブジェクトとしてGC対象）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>イベント</th><th>Platform Thread</th><th>Virtual Thread</th></tr></thead><tbody><tr><td>スレッド作成</td><td>OSからスタック確保（1MB固定）</td><td>小さな初期スタック（ヒープ上）</td></tr><tr><td>メソッド呼び出し</td><td>フレームをプッシュ</td><td>同左</td></tr><tr><td>メソッド終了</td><td>フレームをポップ</td><td>同左</td></tr><tr><td>ブロック操作</td><td>OSスレッドがブロック</td><td>スタックをヒープに退避</td></tr><tr><td>スレッド終了</td><td>OSにメモリ返却</td><td>GCで回収</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="スタックとヒープの違い">スタックとヒープの違い<a href="#スタックとヒープの違い" class="hash-link" aria-label="スタックとヒープの違い への直接リンク" title="スタックとヒープの違い への直接リンク">​</a></h3>
<p>スタックとヒープは異なる目的で使用されるメモリ領域です。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    メモリ割り当ての例                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  public void example() {                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      int x = 10;              // x → スタック（プリミティブ値）      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      String s = &quot;hello&quot;;      // s → スタック（参照）                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               // &quot;hello&quot; → ヒープ（文字列プール）    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      User user = new User();  // user → スタック（参照）             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               // User インスタンス → ヒープ          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      int[] arr = new int[5];  // arr → スタック（参照）              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               // 配列本体 → ヒープ                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  }                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>特性</th><th>スタック</th><th>ヒープ</th></tr></thead><tbody><tr><td>格納対象</td><td>プリミティブ値、オブジェクト参照</td><td>オブジェクトインスタンス、配列</td></tr><tr><td>アクセス速度</td><td>非常に高速</td><td>比較的低速</td></tr><tr><td>メモリ管理</td><td>自動（メソッド終了時に解放）</td><td>GCによる管理</td></tr><tr><td>サイズ</td><td>小さい（スレッドごとに1MB程度）</td><td>大きい（GB単位）</td></tr><tr><td>スレッド安全</td><td>スレッドごとに独立</td><td>全スレッドで共有</td></tr><tr><td>割り当てコスト</td><td>低い（ポインタ移動のみ）</td><td>高い（空き領域探索が必要）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="プリミティブ型と参照型の格納">プリミティブ型と参照型の格納<a href="#プリミティブ型と参照型の格納" class="hash-link" aria-label="プリミティブ型と参照型の格納 への直接リンク" title="プリミティブ型と参照型の格納 への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public void memoryAllocation() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // プリミティブ型：値がスタックに直接格納</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int number = 42;           // 4バイト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long bigNumber = 100L;     // 8バイト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    double decimal = 3.14;     // 8バイト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean flag = true;       // 1バイト（実装依存）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 参照型：参照がスタックに、オブジェクトがヒープに格納</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String text = &quot;Hello&quot;;     // 参照(8バイト) + ヒープ上のString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Integer boxed = 42;        // 参照(8バイト) + ヒープ上のInteger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配列：参照がスタックに、配列本体がヒープに格納</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int[] primitiveArray = {1, 2, 3};  // 参照 + ヒープ上の配列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         メモリ配置図                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   スタック                              ヒープ                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ┌─────────────────┐                   ┌───────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │ number: 42      │                   │                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├─────────────────┤                   │  String &quot;Hello&quot;       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │ bigNumber: 100  │                   │  ┌─────────────────┐  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├─────────────────┤          ┌───────→│  │ value: [H,e,l..] │  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │ decimal: 3.14   │          │        │  └─────────────────┘  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├─────────────────┤          │        │                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │ flag: true      │          │        │  Integer              │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├─────────────────┤          │        │  ┌─────────────────┐  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │ text: 0x1234  ──┼──────────┘   ┌───→│  │ value: 42       │  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├─────────────────┤              │    │  └─────────────────┘  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │ boxed: 0x5678 ──┼──────────────┘    │                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├─────────────────┤                   │  int[] array          │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │ primitiveArray: ┼──────────────────→│  ┌─────────────────┐  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   0x9ABC        │                   │  │ [1, 2, 3]       │  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └─────────────────┘                   │  └─────────────────┘  │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                         └───────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="スタックフレームの構成">スタックフレームの構成<a href="#スタックフレームの構成" class="hash-link" aria-label="ス タックフレームの構成 への直接リンク" title="スタックフレームの構成 への直接リンク">​</a></h3>
<table><thead><tr><th>要素</th><th>内容</th></tr></thead><tbody><tr><td>ローカル変数テーブル</td><td>メソッドの引数とローカル変数</td></tr><tr><td>オペランドスタック</td><td>演算の中間結果</td></tr><tr><td>フレームデータ</td><td>戻りアドレス、例外ハンドラ情報</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="オペランドスタックの動作">オペランドスタックの動作<a href="#オペランドスタックの動作" class="hash-link" aria-label="オペランドスタックの動作 への直接リンク" title="オペランドスタックの動作 への直接リンク">​</a></h3>
<p>JVMはスタックベースの仮想マシンです。演算はオペランドスタックを使って行われます。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Javaコード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public int add(int a, int b) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return a + b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// バイトコード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0: iload_1       // ローカル変数1(a)をオペランドスタックにプッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1: iload_2       // ローカル変数2(b)をオペランドスタックにプッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2: iadd          // スタックから2つポップして加算、結果をプッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3: ireturn       // スタックトップの値を返す</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    オペランドスタックの動作                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  add(3, 5) を実行する場合：                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ローカル変数テーブル                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────┬─────┬─────┐                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 0   │ 1   │ 2   │     0: this, 1: a=3, 2: b=5                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │this │ 3   │ 5   │                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────┴─────┴─────┘                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  命令実行とオペランドスタックの変化：                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  iload_1:     iload_2:     iadd:        ireturn:                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────┐     ┌─────┐      ┌─────┐      ┌─────┐                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │     │     │  5  │      │  8  │      │     │ → 8を返す           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─────┤     ├─────┤      └─────┘      └─────┘                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  3  │     │  3  │                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────┘     └─────┘                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>より複雑な例：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Javaコード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int result = (a + b) * c;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// バイトコード</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0: iload_1       // a をプッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1: iload_2       // b をプッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2: iadd          // a + b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3: iload_3       // c をプッシュ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4: imul          // (a + b) * c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5: istore 4      // 結果を result に格納</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (2 + 3) * 4 の計算過程                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  iload_1  →  iload_2  →   iadd    →  iload_3  →   imul             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───┐      ┌───┐        ┌───┐       ┌───┐       ┌────┐            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │      │ 3 │        │   │       │ 4 │       │    │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├───┤      ├───┤        ├───┤       ├───┤       ├────┤            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ 2 │      │ 2 │        │ 5 │       │ 5 │       │ 20 │ → result   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───┘      └───┘        └───┘       └───┘       └────┘            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="スタックサイズの設定">スタックサイズの設定<a href="#スタックサイズの設定" class="hash-link" aria-label="スタックサイズの設定 への直接リンク" title="スタックサイズの設定 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># スレッドスタックサイズ（デフォルト: 1MB on Linux 64-bit）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -Xss512k -jar app.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>設定</th><th>影響</th></tr></thead><tbody><tr><td>小さい（256k-512k）</td><td>多くのスレッドを作成可能、深い再帰で StackOverflowError</td></tr><tr><td>大きい（2MB以上）</td><td>深い再帰に対応、スレッド数が制限される</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stackoverflowerror">StackOverflowError<a href="#stackoverflowerror" class="hash-link" aria-label="StackOverflowError への直接リンク" title="StackOverflowError への直接リンク">​</a></h3>
<p>スタックが溢れると <code>StackOverflowError</code> が発生します。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 無限再帰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void infiniteRecursion() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    infiniteRecursion();  // StackOverflowError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 深い再帰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long factorial(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (n &lt;= 1) return 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return n * factorial(n - 1);  // 大きな n で StackOverflowError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="スタックトレースの読み方">スタック トレースの読み方<a href="#スタックトレースの読み方" class="hash-link" aria-label="スタックトレースの読み方 への直接リンク" title="スタックトレースの読み方 への直接リンク">​</a></h3>
<p>スタックトレースは問題の原因特定に不可欠です。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Exception in thread &quot;main&quot; java.lang.NullPointerException: Cannot invoke method on null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at com.example.service.UserService.validateUser(UserService.java:45)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at com.example.service.UserService.createUser(UserService.java:28)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at com.example.controller.UserController.register(UserController.java:52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:897)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at javax.servlet.http.HttpServlet.service(HttpServlet.java:750)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 20 more</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコード をコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    スタックトレースの構造                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ① 例外の種類とメッセージ                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     java.lang.NullPointerException: Cannot invoke method on null    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ② 呼び出し履歴（上が最新、下が古い）                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     at クラス名.メソッド名(ファイル名:行番号)                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ③ 読み方：                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     1. 最初の &quot;at&quot; 行 = 例外発生箇所（最重要）                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     2. 上から順に読む = 呼び出しの流れを追跡                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     3. 自分のコード（com.example.）に注目                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     4. &quot;... N more&quot; = 省略された共通部分                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>読み方のポイント：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// この例外の場合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">at com.example.service.UserService.validateUser(UserService.java:45)  // ← ここで発生</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">at com.example.service.UserService.createUser(UserService.java:28)    // ← ここから呼ばれた</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">at com.example.controller.UserController.register(UserController.java:52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// UserService.java の45行目を確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// → null チェックが必要な箇所を特定</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Caused by の読み方：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Exception in thread &quot;main&quot; org.springframework.beans.BeanCreationException: ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 15 more</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: java.io.FileNotFoundException: config.properties (No such file)  // ← 根本原因</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.io.FileInputStream.open0(Native Method)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at com.example.config.ConfigLoader.load(ConfigLoader.java:23)           // ← 発生箇所</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 20 more</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="再帰のスタック消費と対策">再帰のスタック消費と対策<a href="#再帰のスタック消費と対策" class="hash-link" aria-label="再帰のスタック消費と対策 への直接リンク" title="再帰のスタック消費と対策 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="スタック消費の問題">スタック消費の問題<a href="#スタック消費の問題" class="hash-link" aria-label="スタック消費の問題 への直接リンク" title="スタック消費の問題 への直接リンク">​</a></h4>
<p>再帰呼び出しは各呼び出しでスタックフレームを消費します。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 再帰版フィボナッチ（スタック消費大）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long fibonacci(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (n &lt;= 1) return n;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return fibonacci(n - 1) + fibonacci(n - 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// fibonacci(40) → 約330万回の再帰呼び出し</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           再帰呼び出しのスタック消費                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  factorial(5) のスタック状態：                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────┐                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ factorial(1)  → 1    │ ← 5つ目のフレーム                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├──────────────────────┤                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ factorial(2)  待機中 │ ← 4つ目のフレーム                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├──────────────────────┤                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ factorial(3)  待機中 │ ← 3つ目のフレーム                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├──────────────────────┤                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ factorial(4)  待機中 │ ← 2つ目のフレーム                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├──────────────────────┤                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ factorial(5)  待機中 │ ← 1つ目のフレーム                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────┘                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  n が大きいと StackOverflowError                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="対策1-反復ループに変換">対策1: 反復（ループ）に変換<a href="#対策1-反復ループに変換" class="hash-link" aria-label="対策1: 反復（ループ）に変換 への直接リンク" title="対策1: 反復（ループ）に変換 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 反復版（スタック消費: 1フレームのみ）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long factorialIterative(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long result = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 2; i &lt;= n; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result *= i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="対策2-末尾再帰の形式に変換">対策2: 末尾再帰の形式に変換<a href="#対策2-末尾再帰の形式に変換" class="hash-link" aria-label="対策2: 末尾再帰の形式に変換 への直接リンク" title="対策2: 末尾再帰の形式に変換 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 末尾再帰版（JVMでは最適化されないが、読みやすい）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long factorialTailRecursive(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return factorialHelper(n, 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private long factorialHelper(int n, long accumulator) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (n &lt;= 1) return accumulator;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return factorialHelper(n - 1, n * accumulator);  // 末尾位置での再帰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p><strong>注意</strong>: JVMは末尾再帰最適化（TCO）をサポートしていません。Scala等の言語では<code>@tailrec</code>アノテーションでコンパイル時に最適化されます。</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="対策3-明示的なスタックを使用">対策3: 明示的なスタックを使用<a href="#対策3-明示的なスタックを使用" class="hash-link" aria-label="対策3: 明示的なスタックを使用 への直接リンク" title="対策3: 明示的なスタックを使用 への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 明示的なスタックを使用（深い再帰をシミュレート）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long factorialWithStack(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Deque&lt;Integer&gt; stack = new ArrayDeque&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 再帰の代わりにスタックに積む</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = n; i &gt;= 1; i--) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stack.push(i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // スタックから取り出して計算</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long result = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (!stack.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result *= stack.pop();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="対策4-メモ化動的計画法">対策4: メモ化（動的計画法）<a href="#対策4-メモ化動的計画法" class="hash-link" aria-label="対策4: メモ化（動的計画法） への直接リンク" title="対策4: メモ化（動的計画法） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// メモ化版フィボナッチ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long fibonacciMemoized(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long[] memo = new long[n + 1];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return fibHelper(n, memo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private long fibHelper(int n, long[] memo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (n &lt;= 1) return n;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (memo[n] != 0) return memo[n];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memo[n] = fibHelper(n - 1, memo) + fibHelper(n - 2, memo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return memo[n];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// または反復版（推奨）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long fibonacciIterative(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (n &lt;= 1) return n;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long prev = 0, curr = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 2; i &lt;= n; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long next = prev + curr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        prev = curr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        curr = next;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return curr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-threads-とスタック">Virtual Threads とスタック<a href="#virtual-threads-とスタック" class="hash-link" aria-label="Virtual Threads とスタック への直接リンク" title="Virtual Threads とスタック への直接リンク">​</a></h3>
<p>Java 21で導入されたVirtual Threadsは、スタック管理に革新をもたらしました。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Platform Threads vs Virtual Threads                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Platform Threads（従来）                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───────────────────────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Thread-1     Thread-2     Thread-3     Thread-4              │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌───────┐   ┌───────┐   ┌───────┐   ┌───────┐               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │Stack  │   │Stack  │   │Stack  │   │Stack  │               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ 1MB   │   │ 1MB   │   │ 1MB   │   │ 1MB   │               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └───────┘   └───────┘   └───────┘   └───────┘               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  → 1000スレッド = 1GB のスタックメモリが必要                   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  → スレッド数に実質的な上限あり                                │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────────────────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Virtual Threads（Java 21+）                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───────────────────────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Carrier Thread（数個）                                        │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────────────────────────────────────────────────┐  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │                      Stack (1MB)                         │  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────────────────────────────────────────────────┘  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Virtual Threads（100万個も可能）                              │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ...      │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ V1 │ │ V2 │ │ V3 │ │ V4 │ │ V5 │ │ V6 │ │ V7 │          │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └────┘ └────┘ └────┘ └────┘ └────┘ └────┘ └────┘            │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ↑                                                            │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   小さな初期スタック、必要に応じて動的に拡張                   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ブロック時にスタックをヒープに退避（継続）                   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────────────────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>特性</th><th>Platform Thread</th><th>Virtual Thread</th></tr></thead><tbody><tr><td>スタックサイズ</td><td>固定（デフォルト1MB）</td><td>動的（数KB〜必要なだけ）</td></tr><tr><td>作成可能数</td><td>数千程度</td><td>数百万可能</td></tr><tr><td>ブロック時</td><td>OSスレッドがブロック</td><td>スタックを退避して他の処理を実行</td></tr><tr><td>メモリ効率</td><td>低い</td><td>非常に高い</td></tr><tr><td>用途</td><td>CPU集約型タスク</td><td>I/O集約型タスク</td></tr></tbody></table>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Virtual Threads の使用例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 100万個のVirtual Threadsを作成してもメモリ問題なし</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IntStream.range(0, 1_000_000).forEach(i -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executor.submit(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // I/O操作（ブロック時にスタックが自動退避）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread.sleep(Duration.ofSeconds(1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>ヒント</div><div class="admonitionContent_BuS1"><p><strong>idp-serverでの活用</strong>: 大量の同時リクエスト処理にVirtual Threadsを活用することで、スレッドプールのサイズを気にせず、シンプルなthread-per-requestモデルを採用できます。</p></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="スレッドセーフとメモリ">スレッドセーフとメモリ<a href="#スレッドセーフとメモリ" class="hash-link" aria-label="スレッドセーフとメモリ への直接リンク" title="スレッドセーフとメモリ への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="スレッドセーフとは">スレッドセーフとは<a href="#スレッドセーフとは" class="hash-link" aria-label="スレッドセーフとは への直接リンク" title="スレッドセーフとは への直接リンク">​</a></h3>
<p>複数のスレッドから同時にアクセスされても、正しく動作することを「スレッドセーフ」と呼びます。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    スレッドセーフの問題                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  スタック（スレッドセーフ）           ヒープ（要注意）               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────┐              ┌─────────────────────┐       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Thread-1 Stack      │              │   共有オブジェクト   │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ ┌─────────────────┐ │              │   ┌─────────────┐    │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ │ localVar = 10   │ │   参照 ─────→│   │ count = ?   │   │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ └─────────────────┘ │              │   └─────────────┘   │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────────┘              │         ↑           │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        │         │           │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────┐              │   参照 ─┘           │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Thread-2 Stack      │              │                     │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ ┌─────────────────┐ │              └─────────────────────┘       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ │ localVar = 20   │ │                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ └─────────────────┘ │   ローカル変数は他スレッドから見えない     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────────  ──────┘   ヒープのオブジェクトは共有される         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="なぜスタックはスレッドセーフか">なぜスタックはスレッドセーフか<a href="#なぜスタックはスレッドセーフか" class="hash-link" aria-label="なぜスタックはスレッドセーフか への直接リンク" title="なぜスタックはスレッドセーフか への直接リンク">​</a></h3>
<p>各スレッドは独自のスタックを持ち、他のスレッドからアクセスできません。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public void processRequest() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ローカル変数はスタックに格納 → スレッドセーフ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int requestId = generateId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String userId = getCurrentUser();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // これらの変数は他のスレッドから見えない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 同時に100リクエストが来ても、各スレッドが独自の変数を持つ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="なぜヒープは危険か">なぜヒープは危険か<a href="#なぜヒープは危険か" class="hash-link" aria-label="なぜヒープは危険か への直接リンク" title="なぜヒープは危険か への直接リンク">​</a></h3>
<p>ヒープ上のオブジェクトは全 スレッドで共有されるため、競合状態（Race Condition）が発生します。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 危険な例：共有されるカウンター</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UnsafeCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int count = 0;  // ヒープ上のフィールド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void increment() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count++;  // スレッドセーフではない！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    競合状態（Race Condition）                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  count++ は実際には3つの操作：                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. count の値を読む                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. 1 を加算する                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. 結果を count に書き戻す                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Thread-1          Thread-2           count の値                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  読む (count=0)                         0                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    読む (count=0)       0                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  加算 (0+1=1)                           0                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    加算 (0+1=1)         0                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  書く (count=1)                         1                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    書く (count=1)       1  ← 期待値は2なのに1！      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="共有オブジェクトになるケース">共有オブジェクトになるケース<a href="#共有オブジェクトになるケース" class="hash-link" aria-label="共有オブジェクトになるケース への直接リンク" title="共有オブジェクトになるケース への直接リンク">​</a></h3>
<p>どのような場合にオブジェクトが複数スレッドから共有されるかを理解することが重要です。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                 共有 vs 非共有 の判断                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────  ───────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  【共有される】                      【共有されない】                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・インスタンスフィールド            ・ローカル変数                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・staticフィールド                  ・メソッド引数（プリミティブ）  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・Singleton                         ・メソッド内で new したオブジェクト│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・Spring Bean（デフォルト）           （参照を外部に渡さない場合）  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・キャッシュ                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・コレクションの要素                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────  ────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ケース1-インスタンスフィールド">ケース1: インスタンスフィールド<a href="#ケース1-インスタンスフィールド" class="hash-link" aria-label="ケース1: インスタンスフィールド への直接リンク" title="ケース1: インスタンスフィールド への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 危険：インスタンスが共有されるとフィールドも共有される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UserService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int requestCount = 0;  // 共有される！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handleRequest() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestCount++;  // 複数スレッドから同時アクセス → 競合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 使用例（この UserService インスタンスが共有される）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserService service = new UserService();  // 1つのインスタンス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Thread-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">executor.submit(() -&gt; service.handleRequest());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Thread-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">executor.submit(() -&gt; service.handleRequest());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// → 同じ service インスタンスの requestCount に同時アクセス</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ケース2-static-フィールド">ケース2: static フィールド<a href="#ケース2-static-フィールド" class="hash-link" aria-label="ケース2: static フィールド への直接リンク" title="ケース2: static フィールド への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 危険：static フィールドは常に共有される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class GlobalCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static int count = 0;  // 全スレッドで共有！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void increment() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count++;  // スレッドセーフではない</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// どこから呼んでも同じ count にアクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Thread-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GlobalCounter.increment();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Thread-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GlobalCounter.increment();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ケース3-spring-beansingleton-スコープ">ケース3: Spring Bean（Singleton スコープ）<a href="#ケース3-spring-beansingleton-スコープ" class="hash-link" aria-label="ケース3: Spring Bean（Singleton スコープ） への直接リンク" title="ケース3: Spring Bean（Singleton スコープ） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Spring Bean はデフォルトで Singleton → 共有される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 危険：状態を持つフィールド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Order currentOrder;  // 共有される！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void processOrder(Order order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.currentOrder = order;  // 他のリクエストに上書きされる可能性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        validate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        save();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 安全：状態を持たない（ステートレス）設計</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final OrderRepository repository;  // 依存性は OK（それ自体がスレッドセーフなら）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void processOrder(Order order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ローカル変数で処理 → スレッドセーフ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ValidationResult result = validate(order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (result.isValid()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            repository.save(order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ケース4-キャッシュ">ケ ース4: キャッシュ<a href="#ケース4-キャッシュ" class="hash-link" aria-label="ケース4: キャッシュ への直接リンク" title="ケース4: キャッシュ への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 危険：通常の HashMap をキャッシュに使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TokenCache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;String, Token&gt; cache = new HashMap&lt;&gt;();  // スレッドセーフではない！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Token get(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return cache.get(key);  // 同時アクセスで ConcurrentModificationException</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void put(String key, Token token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache.put(key, token);  // 同時書き込みでデータ破損</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 安全：ConcurrentHashMap を使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TokenCache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Map&lt;String, Token&gt; cache = new ConcurrentHashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Token get(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return cache.get(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void put(String key, Token token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache.put(key, token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ケース5-コレクションに格納されたオブジェクト">ケース5: コレクションに格納されたオブジェクト<a href="#ケース5-コレクションに格納されたオブジェクト" class="hash-link" aria-label="ケース5: コレクションに格納されたオブジェクト への直接リンク" title="ケース5: コレクションに格納されたオブジェクト への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// コレクションの要素も共有される</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SessionManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final List&lt;Session&gt; sessions = new CopyOnWriteArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addSession(Session session) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sessions.add(session);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void updateSession(String sessionId, Consumer&lt;Session&gt; updater) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sessions.stream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .filter(s -&gt; s.getId().equals(sessionId))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .findFirst()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .ifPresent(session -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // session オブジェクト自体が共有されている</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // updater の中で session を変更すると競合の可能性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                updater.accept(session);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="非共有の例スレッドセーフ">非共有の例（スレッドセーフ）<a href="#非共有の例スレッドセーフ" class="hash-link" aria-label="非共有の例（スレッドセーフ） への直接リンク" title="非共有の例（スレッドセーフ） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SafeProcessor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Result process(Request request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ローカル変数 → スレッドごとに独立</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int count = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;String&gt; items = new ArrayList&lt;&gt;();  // このメソッド内でのみ使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (String item : request.getItems()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            items.add(transform(item));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            count++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // メソッド内で new → 他スレッドからアクセス不可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Result result = new Result(items, count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;  // 返却後も呼び出し元スレッドのみがアクセス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="判断フローチャート">判断フローチャート<a href="#判断フローチャート" class="hash-link" aria-label="判断フローチャート への直接リンク" title="判断フローチャート への直接リンク">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              オブジェクトは共有されるか？                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  オブジェクトの参照はどこにある？                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           ├─→ ローカル変数のみ ─────→ 共有されない ✓                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           ├─→ メソッド引数（参照型）─→ 呼び出し元次第               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │         │                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │         └─→ 呼び出し元で共有されている？                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │                    │                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │              Yes ──┴── No                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │               ↓        ↓                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │            共有される  共有されない                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           ├─→ インスタンスフィールド ─→ インスタンスが共有なら共有  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           ├─→ static フィールド ────→ 常に共有される ⚠️             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           └─→ コレクションの要素 ───→ コレクションが共有なら共有    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-memory-modeljmm">Java Memory Model（JMM）<a href="#java-memory-modeljmm" class="hash-link" aria-label="Java Memory Model（JMM） への直接リンク" title="Java Memory Model（JMM） への直接リンク">​</a></h3>
<p>JMMは、マルチスレッド環境でのメモリの可視性と順序を定義します。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    Java Memory Model                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Thread-1                              Thread-2                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────┐                   ┌─────────────────┐          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  CPU Cache      │                   │  CPU Cache      │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌───────────┐  │                   │  ┌───────────┐  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ flag=false│  │                   │  │ flag=false│  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └───────────┘  │                   │  └───────────┘  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────┬────────┘                   └────────┬────────┘          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           │                                     │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           └──────────────┬──────────────────────┘                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                          ↓                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              ┌───────────────────────┐                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              │     Main Memory       │                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              │    ┌───────────┐      │                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              │    │ flag=true │      │  ← 書き込みがいつ反映される？ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              │    └───────────┘      │                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              └───────────────────────┘                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  問題：Thread-1がflag=trueを書いても、                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        Thread-2のキャッシュには反映されない可能性がある              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="スレッドセーフにする方法">スレッドセーフにする方法<a href="#スレッドセーフにする方法" class="hash-link" aria-label="スレッドセーフにする方法 への直接リンク" title="スレッドセーフにする方法 への直接リンク">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="方法1-synchronized排他制御">方法1: synchronized（排他制御）<a href="#方法1-synchronized排他制御" class="hash-link" aria-label="方法1: synchronized（排他制御） への直接リンク" title="方法1: synchronized（排他制御） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SynchronizedCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int count = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // メソッド全体を同期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public synchronized void increment() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ブロック単位で同期（より細かい制御）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void incrementWithBlock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        synchronized (this) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            count++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    synchronized の動作                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Thread-1                              Thread-2                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────                             ─────────                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ロック取得 ────────┐                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  count を読む      │                   ロック待ち...                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  加算              │                        │                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  count に書く      │                        │                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ロック解放 ────────┘                        │                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        ロック取得 ────────┐          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        count を読む      │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        加算              │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        count に書く      │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        ロック解放 ────────┘          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  → 一度に1スレッドのみがクリティカルセクションを実行                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="方法2-volatile可視性の保証">方法2: volatile（可視性の保証）<a href="#方法2-volatile可視性の保証" class="hash-link" aria-label="方法2: volatile（可視性の保証） への直接リンク" title="方法2: volatile（可視性の保証） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class VolatileExample {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // volatile: 全スレッドに即座に変更が見える</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private volatile boolean running = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void stop() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        running = false;  // 他のスレッドから即座に見える</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (running) {  // 最新の値を常に読む</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 処理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p><strong>注意</strong>: <code>volatile</code> は可視性のみを保証し、原子性は保証しません。<code>count++</code> のような複合操作には使えません。</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="方法3-atomic-クラスcas操作">方法3: Atomic クラス（CAS操作）<a href="#方法3-atomic-クラスcas操作" class="hash-link" aria-label="方法3: Atomic クラス（CAS操作） への直接リンク" title="方法3: Atomic クラス（CAS操作） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.atomic.AtomicInteger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.atomic.AtomicReference;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AtomicCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ロックフリーで原子的な操作を提供</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final AtomicInteger count = new AtomicInteger(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void increment() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count.incrementAndGet();  // 原子的にインクリメント</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int get() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return count.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// CAS（Compare-And-Swap）の仕組み</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void casExample() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AtomicInteger value = new AtomicInteger(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 期待値が一致した場合のみ更新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean success = value.compareAndSet(0, 1);  // 0なら1に更新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // success = true, value = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    success = value.compareAndSet(0, 2);  // 0なら2に更新（現在は1）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // success = false, value = 1（更新されない）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    CAS（Compare-And-Swap）                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  compareAndSet(expected, newValue):                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. 現在の値を読む                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. 現在の値 == expected か確認                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. 一致すれば newValue に更新（これら全てがCPU命令で原子的）        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  4. 不一致なら何もしない                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  利点：ロックを使わないため、高スループット                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  欠点：競合が多いと再試行が増える                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="方法4-不変オブジェクトimmutable">方法4: 不変オブジェクト（Immutable）<a href="#方法4-不変オブジェクトimmutable" class="hash-link" aria-label="方法4: 不変オブジェクト（Immutable） への直接リンク" title="方法4: 不変オブジェクト（Immutable） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 不変オブジェクトは本質的にスレッドセーフ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public final class ImmutableUser {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final int age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ImmutableUser(String name, int age) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.name = name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.age = age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getName() { return name; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getAge() { return age; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 変更が必要な場合は新しいインスタンスを作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ImmutableUser withAge(int newAge) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new ImmutableUser(this.name, newAge);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Java 16+ の Record は自動的に不変</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public record User(String name, int age) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // フィールドは自動的に final</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // getter は自動生成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="方法5-スレッドローカルthreadlocal">方法5: スレッドローカル（ThreadLocal）<a href="#方法5-スレッドローカルthreadlocal" class="hash-link" aria-label="方法5: スレッドローカル（ThreadLocal） への直接リンク" title="方法5: スレッドローカル（ThreadLocal） への直接リンク">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ThreadLocalExample {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 各スレッドが独自のコピーを持つ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final ThreadLocal&lt;SimpleDateFormat&gt; dateFormat =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ThreadLocal.withInitial(() -&gt; new SimpleDateFormat(&quot;yyyy-MM-dd&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String formatDate(Date date) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 各スレッドが独自のSimpleDateFormatを使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return dateFormat.get().format(date);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    ThreadLocal の動作                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Thread-1                              Thread-2                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────┐                   ┌─────────────────┐          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ThreadLocal    │                   │  ThreadLocal    │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌───────────┐  │                   │  ┌───────────┐  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │DateFormat │  │                   │  │DateFormat │  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ instance1 │  │                   │  │ instance2 │  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └───────────┘  │                   │  └───────────┘  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─────────────────┘                   └─────────────────┘          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  各スレッドが独自のインスタンスを持つ → 競合なし                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p><strong>Virtual Threads との注意点</strong>: ThreadLocal は Virtual Threads と組み合わせると、大量のインスタンスが生成される可能性があります。Virtual Threads では <code>ScopedValue</code>（Java 21 Preview）の使用を検討してくださ い。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="スレッドセーフなコレクション">スレッドセーフなコレクション<a href="#スレッドセーフなコレクション" class="hash-link" aria-label="スレッドセーフなコレクション への直接リンク" title="スレッドセーフなコレクション への直接リンク">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ThreadSafeCollections {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ConcurrentHashMap: 高性能な並行Map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final ConcurrentHashMap&lt;String, User&gt; users = new ConcurrentHashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // CopyOnWriteArrayList: 読み取りが多い場合に最適</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final CopyOnWriteArrayList&lt;String&gt; logs = new CopyOnWriteArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // BlockingQueue: プロデューサー・コンシューマーパターン</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final BlockingQueue&lt;Task&gt; taskQueue = new LinkedBlockingQueue&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void example() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ConcurrentHashMap の原子的操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        users.computeIfAbsent(&quot;user1&quot;, key -&gt; new User(key));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        users.compute(&quot;user1&quot;, (key, existing) -&gt; existing.incrementLoginCount());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // BlockingQueue でスレッド間通信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        taskQueue.put(new Task());  // キューが満杯なら待機</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Task task = taskQueue.take();  // キューが空なら待機</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコー ドをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>コレクション</th><th>特徴</th><th>用途</th></tr></thead><tbody><tr><td><code>ConcurrentHashMap</code></td><td>セグメント単位ロック、高スループット</td><td>キャッシュ、共有Map</td></tr><tr><td><code>CopyOnWriteArrayList</code></td><td>書き込み時にコピー、読み取りロックフリー</td><td>イベントリスナー一覧</td></tr><tr><td><code>BlockingQueue</code></td><td>ブロッキング操作をサポート</td><td>タスクキュー</td></tr><tr><td><code>ConcurrentLinkedQueue</code></td><td>ロックフリー、無制限</td><td>高スループットキュー</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="metaspace">Metaspace<a href="#metaspace" class="hash-link" aria-label="Metaspace への直接リンク" title="Metaspace への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概要-2">概要<a href="#概要-2" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h3>
<p>Java 8以降、クラスメタデータはヒープ外の Metaspace に格納されます（Java 7 以前は PermGen）。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         Metaspace                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────────────────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    Class Metadata                               │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ・クラス構造（フィールド、メソッド情報）                       │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ・バイトコード                                                 │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ・定数プール                                                   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ・  アノテーション                                               │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  特徴:                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・ネイティブメモリ（ヒープ外）に配置                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・デフォルトでは無制限（OSのメモリまで使用可能）                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ・クラスローダーがGCされるとアンロード                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="permgen-との違い">PermGen との違い<a href="#permgen-との違い" class="hash-link" aria-label="PermGen との違い への直接リンク" title="PermGen との違い への直接リンク">​</a></h3>
<table><thead><tr><th>項目</th><th>PermGen (Java 7以前)</th><th>Metaspace (Java 8以降)</th></tr></thead><tbody><tr><td>配置場所</td><td>ヒープ内</td><td>ネイティブメモリ</td></tr><tr><td>デフォルトサイズ</td><td>固定（64MB等）</td><td>無制限</td></tr><tr><td>拡張</td><td>固定サイズ</td><td>動的に拡張</td></tr><tr><td>GC</td><td>Full GC時</td><td>ClassLoaderがGC時</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="サイズ設定">サイズ設定<a href="#サイズ設定" class="hash-link" aria-label="サイズ設定 への直接リンク" title="サイズ設定 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 最大Metaspaceサイズを制限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -XX:MaxMetaspaceSize=256m -jar app.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 初期サイズを設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -XX:MetaspaceSize=128m -jar app.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metaspace-監視">Metaspace 監視<a href="#metaspace-監視" class="hash-link" aria-label="Metaspace 監視 への直接リンク" title="Metaspace 監視 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># jstat でMetaspaceを監視</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jstat -gcmetacapacity &lt;pid&gt; 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># jcmd で詳細確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jcmd &lt;pid&gt; VM.metaspace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="code-cache">Code Cache<a href="#code-cache" class="hash-link" aria-label="Code Cache への直接リンク" title="Code Cache への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概要-3">概要<a href="#概要-3" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h3>
<p>JITコンパイラが生成したネイティブコードが格納される領域です。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         Code Cache                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────────  ─────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌───────────────────┐ ┌───────────────────┐ ┌──────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Non-method       │ │  Profiled Code    │ │  Non-profiled    │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Code             │ │  (C1 compiled)    │ │  Code            │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                   │ │                   │ │  (C2 compiled)   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  JVM内部コード    │ │  軽度最適化       │ │  高度最適化      │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────────────────┘ └───────────────────┘ └──────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  デフォルト: 240MB (64-bit JVM)                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="サイズ設定-1">サイズ設定<a href="#サイズ設定-1" class="hash-link" aria-label="サイズ設定 への直接リンク" title="サイズ設定 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Code Cacheサイズ設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -XX:ReservedCodeCacheSize=256m -jar app.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 初期サ イズ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -XX:InitialCodeCacheSize=64m -jar app.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-cache-が満杯になると">Code Cache が満杯になると<a href="#code-cache-が満杯になると" class="hash-link" aria-label="Code Cache が満杯になると への直接リンク" title="Code Cache が満杯になると への直接リンク">​</a></h3>
<p>Code Cacheが満杯になると、JITコンパイルが停止し、パフォーマンスが低下します。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Java HotSpot(TM) 64-Bit Server VM warning: CodeCache is full.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Compiler has been disabled.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="direct-memory">Direct Memory<a href="#direct-memory" class="hash-link" aria-label="Direct Memory への直接リンク" title="Direct Memory への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概要-4">概要<a href="#概要-4" class="hash-link" aria-label="概要 への直接リンク" title="概要 への直接リンク">​</a></h3>
<p>NIO（New I/O）で使用されるオフヒープメモリです。<code>ByteBuffer.allocateDirect()</code> で確保されます。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Direct Bufferの確保</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ByteBuffer buffer = ByteBuffer.allocateDirect(1024 * 1024);  // 1MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="特徴">特徴<a href="#特徴" class="hash-link" aria-label="特徴 への直接リンク" title="特徴 への直接リンク">​</a></h3>
<table><thead><tr><th>項目</th><th>Heap Buffer</th><th>Direct Buffer</th></tr></thead><tbody><tr><td>配置場所</td><td>ヒープ内</td><td>ネイティブメモリ</td></tr><tr><td>GC対象</td><td>はい</td><td>間接的（参照がなくなった時）</td></tr><tr><td>I/O効率</td><td>コピーが必要</td><td>ゼロコピー可能</td></tr><tr><td>確保コスト</td><td>低い</td><td>高い</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="サイズ設定-2">サイズ設定<a href="#サイズ設定-2" class="hash-link" aria-label="サイズ設定 への直接リンク" title="サイズ設定 への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Direct Memoryの最大サイズ（デフォルト: -Xmx と同じ）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -XX:MaxDirectMemorySize=512m -jar app.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="メモリ領域のサマリー">メモリ領域のサマリー<a href="#メモリ領域のサマリー" class="hash-link" aria-label="メモリ領域のサマリー への直接リンク" title="メモリ領域のサマリー への直接リンク">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                        JVMメモリ領域一覧                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  領域              設定オプション              デフォルト            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ─────────────────────────────────────────────────────────────────  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Heap              -Xms, -Xmx                  物理メモリの1/4       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Metaspace         -XX:MaxMetaspaceSize        無制限                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Thread Stack      -Xss                        1MB                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Code Cache        -XX:ReservedCodeCacheSize   240MB                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Direct Memory     -XX:MaxDirectMemorySize     -Xmxと同じ            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="メモリ使用量の確認">メモリ使用量の確認<a href="#メモリ使用量の確認" class="hash-link" aria-label="メモリ使用量の確認 への直接リンク" title="メモリ使用量の確認 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jcmd">jcmd<a href="#jcmd" class="hash-link" aria-label="jcmd への直接リンク" title="jcmd への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ネイティブメモリトラッキング有効化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -XX:NativeMemoryTracking=summary -jar app.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># メモリサマリー表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jcmd &lt;pid&gt; VM.native_memory summary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 詳細表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jcmd &lt;pid&gt; VM.native_memory detail</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>出力例:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Native Memory Tracking:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total: reserved=5GB, committed=1GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-                 Java Heap (reserved=4GB, committed=512MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            (mmap: reserved=4GB, committed=512MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-                     Class (reserved=1GB, committed=50MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            (classes #10000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            (malloc=5MB #50000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            (mmap: reserved=1GB, committed=45MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-                    Thread (reserved=100MB, committed=100MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            (thread #100)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            (stack: reserved=100MB, committed=100MB)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jstat">jstat<a href="#jstat" class="hash-link" aria-label="jstat への直接リンク" title="jstat への直接リンク">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ヒープ使用状況を1秒間隔で表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jstat -gc &lt;pid&gt; 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 出力列の意味</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># S0C   S0U   S1C   S1U   EC     EU     OC      OU      MC     MU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 容量  使用  容量  使用  Eden   Eden   Old     Old     Meta   Meta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#             Survivor     容量   使用   容量    使用    容量   使用</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="visualvm--jconsole">VisualVM / JConsole<a href="#visualvm--jconsole" class="hash-link" aria-label="VisualVM / JConsole への直接リンク" title="VisualVM / JConsole への直接リンク">​</a></h3>
<p>GUIツールでリアルタイムにメモリ使用量を可視化できます。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># JConsole起動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jconsole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># VisualVM起動（別途インストール）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">visualvm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="outofmemoryerror-の種類">OutOfMemoryError の種類<a href="#outofmemoryerror-の種類" class="hash-link" aria-label="OutOfMemoryError の種類 への直接リンク" title="OutOfMemoryError の種類 への直接リンク">​</a></h2>
<table><thead><tr><th>エラーメッセージ</th><th>原因</th><th>対処</th></tr></thead><tbody><tr><td><code>Java heap space</code></td><td>ヒープ不足</td><td><code>-Xmx</code>増加、メモリリーク調査</td></tr><tr><td><code>Metaspace</code></td><td>クラスメタデータ領域不足</td><td><code>-XX:MaxMetaspaceSize</code>増加</td></tr><tr><td><code>GC overhead limit exceeded</code></td><td>GCに時間がかかりすぎ</td><td>ヒープ増加、アプリ改善</td></tr><tr><td><code>unable to create new native thread</code></td><td>スレッド作成不可</td><td><code>-Xss</code>減少、スレッド数削減</td></tr><tr><td><code>Direct buffer memory</code></td><td>Direct Memory不足</td><td><code>-XX:MaxDirectMemorySize</code>増加</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="本番環境の推奨設定">本番環境の推奨設定<a href="#本番環境の推奨設定" class="hash-link" aria-label="本番環境の推奨設定 への直接リンク" title="本番環境の推奨設定 への直接リンク">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # ヒープ（同一サイズで固定）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Xms4g -Xmx4g \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Metaspace（上限設定）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -XX:MaxMetaspaceSize=256m \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # スタック（スレッド 多い場合は小さく）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -Xss512k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Direct Memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -XX:MaxDirectMemorySize=512m \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # OOM時にヒープダンプ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -XX:+HeapDumpOnOutOfMemoryError \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -XX:HeapDumpPath=/var/log/app/ \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Native Memory Tracking（デバッグ用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -XX:NativeMemoryTracking=summary \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -jar app.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<table><thead><tr><th>領域</th><th>格納内容</th><th>GC対象</th></tr></thead><tbody><tr><td>Heap</td><td>オブジェクトインスタンス、配列</td><td>はい</td></tr><tr><td>Metaspace</td><td>クラスメタデータ、定数プール</td><td>ClassLoader経由</td></tr><tr><td>Stack</td><td>ローカル変数、メソッド呼び出し情報</td><td>いいえ（自動解放）</td></tr><tr><td>Code Cache</td><td>JITコンパイル済みコード</td><td>部分的</td></tr><tr><td>Direct Memory</td><td>NIO バッファ</td><td>間接的</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="次のステップ">次のステップ<a href="#次のステップ" class="hash-link" aria-label="次のステップ への直接リンク" title="次のステップ への直接リンク">​</a></h2>
<ul>
<li><a href="/idp-server/docs/content_11_learning/jvm/jvm-04-gc">ガベージコレクション</a> - ヒープの自動管理メカニズム</li>
<li><a href="/idp-server/docs/content_11_learning/jvm/jvm-05-gc-tuning">GCチューニング</a> - 本番環境での最適化</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/20-jvm/jvm-03-memory.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/idp-server/docs/content_11_learning/jvm/jvm-02-classloading"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">クラスローディング</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/idp-server/docs/content_11_learning/jvm/jvm-04-gc"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">ガベージコレクション</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#はじめに" class="table-of-contents__link toc-highlight">はじめに</a></li><li><a href="#jvmメモリ構造の全体像" class="table-of-contents__link toc-highlight">JVMメモリ構造の全体像</a></li><li><a href="#ヒープheap" class="table-of-contents__link toc-highlight">ヒープ（Heap）</a><ul><li><a href="#概要" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#世代別構成" class="table-of-contents__link toc-highlight">世代別構成</a></li><li><a href="#オブジェクトのライフサイクル" class="table-of-contents__link toc-highlight">オブジェクトのライフサイクル</a></li><li><a href="#ヒープサイズの設定" class="table-of-contents__link toc-highlight">ヒープサイズの設定</a></li><li><a href="#世代別サイズ比率" class="table-of-contents__link toc-highlight">世代別サイズ比率</a></li></ul></li><li><a href="#スタックstack" class="table-of-contents__link toc-highlight">スタック（Stack）</a><ul><li><a href="#概要-1" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#スタックのライフサイクル" class="table-of-contents__link toc-highlight">スタックのライフサイクル</a></li><li><a href="#スタックとヒープの違い" class="table-of-contents__link toc-highlight">スタックとヒープの違い</a></li><li><a href="#プリミティブ型と参照型の格納" class="table-of-contents__link toc-highlight">プリミティブ型と参照型の格納</a></li><li><a href="#スタックフレームの構成" class="table-of-contents__link toc-highlight">スタックフレームの構成</a></li><li><a href="#オペランドスタックの動作" class="table-of-contents__link toc-highlight">オペランドスタックの動作</a></li><li><a href="#スタックサイズの設定" class="table-of-contents__link toc-highlight">スタックサイズの設定</a></li><li><a href="#stackoverflowerror" class="table-of-contents__link toc-highlight">StackOverflowError</a></li><li><a href="#スタックトレースの読み方" class="table-of-contents__link toc-highlight">スタックトレースの読み方</a></li><li><a href="#再帰のスタック消費と対策" class="table-of-contents__link toc-highlight">再帰のスタック消費と対策</a></li><li><a href="#virtual-threads-とスタック" class="table-of-contents__link toc-highlight">Virtual Threads とスタック</a></li></ul></li><li><a href="#スレッドセーフとメモリ" class="table-of-contents__link toc-highlight">スレッドセーフとメモリ</a><ul><li><a href="#スレッドセーフとは" class="table-of-contents__link toc-highlight">スレッドセーフとは</a></li><li><a href="#なぜスタックはスレッドセーフか" class="table-of-contents__link toc-highlight">なぜスタックはスレッドセーフか</a></li><li><a href="#なぜヒープは危険か" class="table-of-contents__link toc-highlight">なぜヒープは危険か</a></li><li><a href="#共有オブジェクトになるケース" class="table-of-contents__link toc-highlight">共有オブジェクトになるケース</a></li><li><a href="#java-memory-modeljmm" class="table-of-contents__link toc-highlight">Java Memory Model（JMM）</a></li><li><a href="#スレッドセーフにする方法" class="table-of-contents__link toc-highlight">スレッドセーフにする方法</a></li><li><a href="#スレッドセーフなコレクション" class="table-of-contents__link toc-highlight">スレッドセーフなコレクション</a></li></ul></li><li><a href="#metaspace" class="table-of-contents__link toc-highlight">Metaspace</a><ul><li><a href="#概要-2" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#permgen-との違い" class="table-of-contents__link toc-highlight">PermGen との違い</a></li><li><a href="#サイズ設定" class="table-of-contents__link toc-highlight">サイズ設定</a></li><li><a href="#metaspace-監視" class="table-of-contents__link toc-highlight">Metaspace 監視</a></li></ul></li><li><a href="#code-cache" class="table-of-contents__link toc-highlight">Code Cache</a><ul><li><a href="#概要-3" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#サイズ設定-1" class="table-of-contents__link toc-highlight">サイズ設定</a></li><li><a href="#code-cache-が満杯になると" class="table-of-contents__link toc-highlight">Code Cache が満杯になると</a></li></ul></li><li><a href="#direct-memory" class="table-of-contents__link toc-highlight">Direct Memory</a><ul><li><a href="#概要-4" class="table-of-contents__link toc-highlight">概要</a></li><li><a href="#特徴" class="table-of-contents__link toc-highlight">特徴</a></li><li><a href="#サイズ設定-2" class="table-of-contents__link toc-highlight">サイズ設定</a></li></ul></li><li><a href="#メモリ領域のサマリー" class="table-of-contents__link toc-highlight">メモリ領域のサマリー</a></li><li><a href="#メモリ使用量の確認" class="table-of-contents__link toc-highlight">メモリ使用量 の確認</a><ul><li><a href="#jcmd" class="table-of-contents__link toc-highlight">jcmd</a></li><li><a href="#jstat" class="table-of-contents__link toc-highlight">jstat</a></li><li><a href="#visualvm--jconsole" class="table-of-contents__link toc-highlight">VisualVM / JConsole</a></li></ul></li><li><a href="#outofmemoryerror-の種類" class="table-of-contents__link toc-highlight">OutOfMemoryError の種類</a></li><li><a href="#本番環境の推奨設定" class="table-of-contents__link toc-highlight">本番環境の推奨設定</a></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a></li><li><a href="#次のステップ" class="table-of-contents__link toc-highlight">次のステップ</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/docs/introduction">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/idp-server/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>