{
  "id": "0f12803e-37b6-437e-8ca9-5822bd852b74",
  "type": "sms",
  "attributes": {},
  "metadata": {
    "type": "external",
    "description": "mocky",
    "verification_code_param": "verification_code",
    "templates": {
      "registration": {
        "subject": "[ID Verification] Your signup sms confirmation code",
        "body": "Hello,\n\nPlease enter the following verification code:\n\n【{VERIFICATION_CODE}】\n\nThis code will expire in {EXPIRE_SECONDS} seconds.\n\nIf you did not request this, please contact your administrator.\n\n– IDP Support"
      },
      "authentication": {
        "subject": "[ID Verification] Your login sms confirmation code",
        "body": "Hello,\n\nPlease enter the following verification code:\n\n【{VERIFICATION_CODE}】\n\nThis code will expire in {EXPIRE_SECONDS} seconds.\n\nIf you did not request this, please contact your administrator.\n\n– IDP Support"
      }
    },
    "retry_count_limitation": 5,
    "expire_seconds": 300
  },
  "interactions": {
    "sms-authentication-challenge": {
      "request": {
        "schema": {
          "type": "object",
          "properties": {
            "phone_number": {
              "type": "string"
            },
            "template": {
              "type": "string"
            }
          }
        }
      },
      "execution": {
        "function": "http_request",
        "http_request": {
          "url": "http://host.docker.internal:4000/sms-authentication-challenge",
          "method": "POST",
          "oauth_authorization": {
            "type": "password",
            "token_endpoint": "http://host.docker.internal:4000/token",
            "client_id": "your-client-id",
            "username": "username",
            "password": "password",
            "scope": "application"
          },
          "header_mapping_rules": [
            {
              "static_value": "application/json",
              "to": "Content-Type"
            }
          ],
          "body_mapping_rules": [
            {
              "from": "$.request_body",
              "to": "*"
            }
          ]
        },
        "http_request_store": {
          "key": "sms-authentication-challenge",
          "interaction_mapping_rules": [
            {
              "from": "$.response_body.transaction_id",
              "to": "transaction_id"
            }
          ]
        }
      },
      "post_hook": {},
      "response": {
        "body_mapping_rules": [
          {
            "from": "$.execution_http_request.response_body",
            "to": "*"
          }
        ]
      }
    },
    "sms-authentication": {
      "request": {
        "schema": {
          "type": "object",
          "properties": {
            "verification_code": {
              "type": "string"
            }
          }
        }
      },
      "pre_hook": {
      },
      "execution": {
        "function": "http_request",
        "previous_interaction": {
          "key": "sms-authentication-challenge"
        },
        "http_request": {
          "url": "http://host.docker.internal:4000/sms-authentication",
          "method": "POST",
          "oauth_authorization": {
            "type": "password",
            "token_endpoint": "http://host.docker.internal:4000/token",
            "client_id": "your-client-id",
            "username": "username",
            "password": "password",
            "scope": "application"
          },
          "header_mapping_rules": [
            {
              "static_value": "application/json",
              "to": "Content-Type"
            }
          ],
          "body_mapping_rules": [
            {
              "from": "$.request_body.verification_code",
              "to": "verification_code"
            },
            {
              "from": "$.interaction.transaction_id",
              "to": "transaction_id"
            }
          ]
        },
        "http_request_store": {
          "key": "sms-authentication",
          "interaction_mapping_rules": [
            {
              "from": "$.status_code",
              "to": "status_code"
            },
            {
              "from": "$.response_headers",
              "to": "response_headers"
            },
            {
              "from": "$.response_body",
              "to": "response_body"
            }
          ]
        }
      },
      "post_hook": {},
      "response": {
        "body_mapping_rules": [
          {
            "from": "$.execution_http_request.response_body",
            "to": "*"
          }
        ]
      }
    }
  }
}