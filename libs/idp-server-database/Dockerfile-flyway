# Flyway official image for database migrations
# Supports both PostgreSQL and MySQL via DB_TYPE environment variable
FROM flyway/flyway:11.19.1

# Copy migration SQL files
COPY postgresql /flyway/sql/postgresql
COPY mysql /flyway/sql/mysql

# Copy entrypoint script
COPY entrypoint.sh /entrypoint.sh

# Set executable permission and grant ownership to existing non-root user (ubuntu)
RUN chmod +x /entrypoint.sh && \
    chown -R ubuntu:ubuntu /flyway

# Switch to non-root user
USER ubuntu

ENTRYPOINT ["/entrypoint.sh"]
CMD ["migrate"]
