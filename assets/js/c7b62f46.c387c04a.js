"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[7660],{24731:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>o,frontMatter:()=>d,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"content_11_learning/linux/namespaces","title":"Linux Namespaces","description":"\u30b3\u30f3\u30c6\u30ca\u6280\u8853\u306e\u57fa\u76e4\u3068\u306a\u308bLinux Namespaces\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002","source":"@site/docs/content_11_learning/14-linux/namespaces.md","sourceDirName":"content_11_learning/14-linux","slug":"/content_11_learning/linux/namespaces","permalink":"/idp-server/docs/content_11_learning/linux/namespaces","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/14-linux/namespaces.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","permalink":"/idp-server/docs/content_11_learning/linux/network-troubleshooting"},"next":{"title":"Linux Cgroups","permalink":"/idp-server/docs/content_11_learning/linux/cgroups"}}');var r=s(74848),c=s(28453);const d={},i="Linux Namespaces",l={},t=[{value:"\u76ee\u6b21",id:"\u76ee\u6b21",level:2},{value:"Namespaces\u3068\u306f",id:"namespaces\u3068\u306f",level:2},{value:"Namespace\u306e\u6982\u5ff5",id:"namespace\u306e\u6982\u5ff5",level:3},{value:"\u306a\u305c\u91cd\u8981\u304b",id:"\u306a\u305c\u91cd\u8981\u304b",level:3},{value:"Namespace\u306e\u7a2e\u985e",id:"namespace\u306e\u7a2e\u985e",level:2},{value:"7\u7a2e\u985e\u306eNamespace",id:"7\u7a2e\u985e\u306enamespace",level:3},{value:"\u78ba\u8a8d\u65b9\u6cd5",id:"\u78ba\u8a8d\u65b9\u6cd5",level:3},{value:"Namespace\u306e\u64cd\u4f5c",id:"namespace\u306e\u64cd\u4f5c",level:2},{value:"unshare \u30b3\u30de\u30f3\u30c9",id:"unshare-\u30b3\u30de\u30f3\u30c9",level:3},{value:"nsenter \u30b3\u30de\u30f3\u30c9",id:"nsenter-\u30b3\u30de\u30f3\u30c9",level:3},{value:"\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb",id:"\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb",level:3},{value:"PID Namespace",id:"pid-namespace",level:2},{value:"PID Namespace\u306e\u4ed5\u7d44\u307f",id:"pid-namespace\u306e\u4ed5\u7d44\u307f",level:3},{value:"\u5b9f\u9a13",id:"\u5b9f\u9a13",level:3},{value:"Network Namespace",id:"network-namespace",level:2},{value:"Network Namespace\u306e\u4ed5\u7d44\u307f",id:"network-namespace\u306e\u4ed5\u7d44\u307f",level:3},{value:"\u5b9f\u9a13: Network Namespace \u306e\u4f5c\u6210",id:"\u5b9f\u9a13-network-namespace-\u306e\u4f5c\u6210",level:3},{value:"Docker\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af",id:"docker\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af",level:3},{value:"Mount Namespace",id:"mount-namespace",level:2},{value:"Mount Namespace\u306e\u4ed5\u7d44\u307f",id:"mount-namespace\u306e\u4ed5\u7d44\u307f",level:3},{value:"\u5b9f\u9a13",id:"\u5b9f\u9a13-1",level:3},{value:"pivot_root",id:"pivot_root",level:3},{value:"User Namespace",id:"user-namespace",level:2},{value:"User Namespace\u306e\u4ed5\u7d44\u307f",id:"user-namespace\u306e\u4ed5\u7d44\u307f",level:3},{value:"\u5b9f\u9a13",id:"\u5b9f\u9a13-2",level:3},{value:"\u30b3\u30f3\u30c6\u30ca\u3068Namespace",id:"\u30b3\u30f3\u30c6\u30ca\u3068namespace",level:2},{value:"Docker\u30b3\u30f3\u30c6\u30ca\u306e\u69cb\u6210",id:"docker\u30b3\u30f3\u30c6\u30ca\u306e\u69cb\u6210",level:3},{value:"Namespace\u5171\u6709\u30aa\u30d7\u30b7\u30e7\u30f3",id:"namespace\u5171\u6709\u30aa\u30d7\u30b7\u30e7\u30f3",level:3},{value:"Kubernetes\u3067\u306e\u5171\u6709",id:"kubernetes\u3067\u306e\u5171\u6709",level:3},{value:"\u307e\u3068\u3081",id:"\u307e\u3068\u3081",level:2},{value:"Namespace\u306e\u7a2e\u985e\u3068\u7528\u9014",id:"namespace\u306e\u7a2e\u985e\u3068\u7528\u9014",level:3},{value:"\u4e3b\u306a\u30b3\u30de\u30f3\u30c9",id:"\u4e3b\u306a\u30b3\u30de\u30f3\u30c9",level:3},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:3},{value:"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9",id:"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"linux-namespaces",children:"Linux Namespaces"})}),"\n",(0,r.jsx)(n.p,{children:"\u30b3\u30f3\u30c6\u30ca\u6280\u8853\u306e\u57fa\u76e4\u3068\u306a\u308bLinux Namespaces\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u76ee\u6b21",children:"\u76ee\u6b21"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#namespaces%E3%81%A8%E3%81%AF",children:"Namespaces\u3068\u306f"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#namespace%E3%81%AE%E7%A8%AE%E9%A1%9E",children:"Namespace\u306e\u7a2e\u985e"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#namespace%E3%81%AE%E6%93%8D%E4%BD%9C",children:"Namespace\u306e\u64cd\u4f5c"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#pid-namespace",children:"PID Namespace"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#network-namespace",children:"Network Namespace"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#mount-namespace",children:"Mount Namespace"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#user-namespace",children:"User Namespace"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%A8namespace",children:"\u30b3\u30f3\u30c6\u30ca\u3068Namespace"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"namespaces\u3068\u306f",children:"Namespaces\u3068\u306f"}),"\n",(0,r.jsx)(n.h3,{id:"namespace\u306e\u6982\u5ff5",children:"Namespace\u306e\u6982\u5ff5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Namespace \u306e\u5f79\u5272                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  Namespace = \u30ea\u30bd\u30fc\u30b9\u306e\u5206\u96e2\u30fb\u4eee\u60f3\u5316\u306e\u4ed5\u7d44\u307f                  \u2502\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                    Linux Kernel                      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502         \u2502                    \u2502                    \u2502        \u2502\n\u2502         \u25bc                    \u25bc                    \u25bc        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502  Namespace A  \u2502   \u2502  Namespace B  \u2502   \u2502  Namespace C  \u2502\u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\u2502\n\u2502  \u2502  \u2502Process 1\u2502 \u2502   \u2502  \u2502Process 1\u2502 \u2502   \u2502  \u2502Process 1\u2502 \u2502\u2502\n\u2502  \u2502  \u2502(PID 1)  \u2502 \u2502   \u2502  \u2502(PID 1)  \u2502 \u2502   \u2502  \u2502(PID 1)  \u2502 \u2502\u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\u2502\n\u2502  \u2502  eth0: ...   \u2502   \u2502  eth0: ...   \u2502   \u2502  eth0: ...   \u2502\u2502\n\u2502  \u2502  /: ...      \u2502   \u2502  /: ...      \u2502   \u2502  /: ...      \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                              \u2502\n\u2502  \u5404 Namespace \u306f\u72ec\u7acb\u3057\u305f\u300c\u4e16\u754c\u300d\u3092\u6301\u3064                       \u2502\n\u2502  \u30fb\u305d\u308c\u305e\u308c\u304c PID 1 \u3092\u6301\u3066\u308b                                 \u2502\n\u2502  \u30fb\u305d\u308c\u305e\u308c\u304c\u72ec\u81ea\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u6301\u3066\u308b                      \u2502\n\u2502  \u30fb\u305d\u308c\u305e\u308c\u304c\u72ec\u81ea\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u6301\u3066\u308b                  \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u306a\u305c\u91cd\u8981\u304b",children:"\u306a\u305c\u91cd\u8981\u304b"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u30b3\u30f3\u30c6\u30ca\u306e\u57fa\u76e4"}),": Docker, Kubernetes \u306fNamespace\u3092\u4f7f\u7528"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"}),": \u30d7\u30ed\u30bb\u30b9\u9593\u306e\u5206\u96e2"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8"}),": \u540c\u4e00\u30db\u30b9\u30c8\u4e0a\u3067\u306e\u8907\u6570\u74b0\u5883\u306e\u5171\u5b58"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"namespace\u306e\u7a2e\u985e",children:"Namespace\u306e\u7a2e\u985e"}),"\n",(0,r.jsx)(n.h3,{id:"7\u7a2e\u985e\u306enamespace",children:"7\u7a2e\u985e\u306eNamespace"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Namespace"}),(0,r.jsx)(n.th,{children:"\u30d5\u30e9\u30b0"}),(0,r.jsx)(n.th,{children:"\u5206\u96e2\u3059\u308b\u3082\u306e"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PID"}),(0,r.jsx)(n.td,{children:"CLONE_NEWPID"}),(0,r.jsx)(n.td,{children:"\u30d7\u30ed\u30bb\u30b9ID"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Network"}),(0,r.jsx)(n.td,{children:"CLONE_NEWNET"}),(0,r.jsx)(n.td,{children:"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b9\u30bf\u30c3\u30af"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Mount"}),(0,r.jsx)(n.td,{children:"CLONE_NEWNS"}),(0,r.jsx)(n.td,{children:"\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"UTS"}),(0,r.jsx)(n.td,{children:"CLONE_NEWUTS"}),(0,r.jsx)(n.td,{children:"\u30db\u30b9\u30c8\u540d\u30fb\u30c9\u30e1\u30a4\u30f3\u540d"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"IPC"}),(0,r.jsx)(n.td,{children:"CLONE_NEWIPC"}),(0,r.jsx)(n.td,{children:"SystemV IPC, POSIX\u30e1\u30c3\u30bb\u30fc\u30b8\u30ad\u30e5\u30fc"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"User"}),(0,r.jsx)(n.td,{children:"CLONE_NEWUSER"}),(0,r.jsx)(n.td,{children:"UID/GID"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Cgroup"}),(0,r.jsx)(n.td,{children:"CLONE_NEWCGROUP"}),(0,r.jsx)(n.td,{children:"Cgroup\u30eb\u30fc\u30c8"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"\u78ba\u8a8d\u65b9\u6cd5",children:"\u78ba\u8a8d\u65b9\u6cd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u73fe\u5728\u306e\u30d7\u30ed\u30bb\u30b9\u306eNamespace\nls -la /proc/$$/ns/\n\n# \u51fa\u529b\u4f8b\n# lrwxrwxrwx 1 user user 0 Dec 23 10:00 cgroup -> 'cgroup:[4026531835]'\n# lrwxrwxrwx 1 user user 0 Dec 23 10:00 ipc -> 'ipc:[4026531839]'\n# lrwxrwxrwx 1 user user 0 Dec 23 10:00 mnt -> 'mnt:[4026531840]'\n# lrwxrwxrwx 1 user user 0 Dec 23 10:00 net -> 'net:[4026532008]'\n# lrwxrwxrwx 1 user user 0 Dec 23 10:00 pid -> 'pid:[4026531836]'\n# lrwxrwxrwx 1 user user 0 Dec 23 10:00 user -> 'user:[4026531837]'\n# lrwxrwxrwx 1 user user 0 Dec 23 10:00 uts -> 'uts:[4026531838]'\n\n# \u6570\u5024\u306finode\u756a\u53f7\uff08\u540c\u3058\u756a\u53f7 = \u540c\u3058Namespace\uff09\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"namespace\u306e\u64cd\u4f5c",children:"Namespace\u306e\u64cd\u4f5c"}),"\n",(0,r.jsx)(n.h3,{id:"unshare-\u30b3\u30de\u30f3\u30c9",children:"unshare \u30b3\u30de\u30f3\u30c9"}),"\n",(0,r.jsx)(n.p,{children:"\u65b0\u3057\u3044Namespace\u3067\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u65b0\u3057\u3044UTS Namespace\u3067\u30b7\u30a7\u30eb\u8d77\u52d5\nsudo unshare --uts /bin/bash\n\n# Namespace\u5185\u3067\u30db\u30b9\u30c8\u540d\u5909\u66f4\nhostname mycontainer\nhostname  # \u2192 mycontainer\n\n# \u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u78ba\u8a8d\uff08\u30db\u30b9\u30c8\u306e\u30db\u30b9\u30c8\u540d\u306f\u5909\u308f\u3063\u3066\u3044\u306a\u3044\uff09\nhostname  # \u2192 original-hostname\n"})}),"\n",(0,r.jsx)(n.h3,{id:"nsenter-\u30b3\u30de\u30f3\u30c9",children:"nsenter \u30b3\u30de\u30f3\u30c9"}),"\n",(0,r.jsx)(n.p,{children:"\u65e2\u5b58\u306eNamespace\u306b\u5165\u308a\u307e\u3059\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# PID 1234 \u306e\u3059\u3079\u3066\u306eNamespace\u306b\u5165\u308b\nsudo nsenter -t 1234 -a\n\n# \u7279\u5b9a\u306eNamespace\u306e\u307f\nsudo nsenter -t 1234 --net    # Network Namespace\u306e\u307f\nsudo nsenter -t 1234 --pid    # PID Namespace\u306e\u307f\nsudo nsenter -t 1234 --mount  # Mount Namespace\u306e\u307f\n\n# Docker\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308b\nPID=$(docker inspect -f '{{.State.Pid}}' container-name)\nsudo nsenter -t $PID -n -m -u -i -p\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb",children:"\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"// Namespace\u95a2\u9023\u306e\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\nclone()    // \u65b0\u3057\u3044Namespace\u3067\u30d7\u30ed\u30bb\u30b9\u4f5c\u6210\nunshare()  // \u73fe\u5728\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u65b0\u3057\u3044Namespace\u306b\u79fb\u52d5\nsetns()    // \u65e2\u5b58\u306eNamespace\u306b\u53c2\u52a0\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"pid-namespace",children:"PID Namespace"}),"\n",(0,r.jsx)(n.h3,{id:"pid-namespace\u306e\u4ed5\u7d44\u307f",children:"PID Namespace\u306e\u4ed5\u7d44\u307f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   PID Namespace                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u30db\u30b9\u30c8\u306e\u8996\u70b9:                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  PID 1 (init)                                        \u2502   \u2502\n\u2502  \u2502  \u251c\u2500\u2500 PID 100 (bash)                                  \u2502   \u2502\n\u2502  \u2502  \u251c\u2500\u2500 PID 200 (docker)                                \u2502   \u2502\n\u2502  \u2502  \u2502   \u2514\u2500\u2500 PID 300 (container init) \u25c4\u2500\u2500 \u3053\u308c\u304c...     \u2502   \u2502\n\u2502  \u2502  \u2502       \u2514\u2500\u2500 PID 301 (app)                           \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500 ...                                             \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                              \u2502\n\u2502  \u30b3\u30f3\u30c6\u30ca\u306e\u8996\u70b9:                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  PID 1 (container init) \u25c4\u2500\u2500 \u30b3\u30f3\u30c6\u30ca\u5185\u3067\u306f PID 1     \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500 PID 2 (app)                                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                              \u2502\n\u2502  \u540c\u3058\u30d7\u30ed\u30bb\u30b9\u3067\u3082\u3001\u898b\u308b\u5834\u6240\u306b\u3088\u3063\u3066PID\u304c\u7570\u306a\u308b                \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b9f\u9a13",children:"\u5b9f\u9a13"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u65b0\u3057\u3044PID Namespace\u3067\u30b7\u30a7\u30eb\u8d77\u52d5\nsudo unshare --pid --fork --mount-proc /bin/bash\n\n# \u30d7\u30ed\u30bb\u30b9\u4e00\u89a7\u3092\u78ba\u8a8d\nps aux\n# PID 1 \u304c\u3053\u306e\u30b7\u30a7\u30eb\u306b\u306a\u3063\u3066\u3044\u308b\n\n# \u30db\u30b9\u30c8\u306e\u30d7\u30ed\u30bb\u30b9\u306f\u898b\u3048\u306a\u3044\nps aux | wc -l  # \u5c11\u306a\u3044\u6570\n\n# \u5225\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u30db\u30b9\u30c8\u3067\u78ba\u8a8d\nps aux | grep unshare  # PID \u304c\u7570\u306a\u308b\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"network-namespace",children:"Network Namespace"}),"\n",(0,r.jsx)(n.h3,{id:"network-namespace\u306e\u4ed5\u7d44\u307f",children:"Network Namespace\u306e\u4ed5\u7d44\u307f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Network Namespace                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u30db\u30b9\u30c8 (Root Network Namespace)                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  eth0: 192.168.1.100                                 \u2502   \u2502\n\u2502  \u2502  docker0: 172.17.0.1                                 \u2502   \u2502\n\u2502  \u2502  veth123 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                  \u2502                          \u2502\n\u2502  Container Network Namespace     \u2502                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  eth0: 172.17.0.2 \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 (veth pair)          \u2502   \u2502\n\u2502  \u2502  lo: 127.0.0.1                                       \u2502   \u2502\n\u2502  \u2502                                                      \u2502   \u2502\n\u2502  \u2502  \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3001iptables \u3082\u72ec\u7acb                 \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b9f\u9a13-network-namespace-\u306e\u4f5c\u6210",children:"\u5b9f\u9a13: Network Namespace \u306e\u4f5c\u6210"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Network Namespace \u4f5c\u6210\nsudo ip netns add myns\n\n# \u4e00\u89a7\u78ba\u8a8d\nip netns list\n\n# Namespace\u5185\u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\nsudo ip netns exec myns ip addr\n# lo \u306e\u307f\u5b58\u5728\uff08DOWN\u72b6\u614b\uff09\n\n# loopback\u3092\u6709\u52b9\u5316\nsudo ip netns exec myns ip link set lo up\n\n# veth\u30da\u30a2\u4f5c\u6210\uff08\u30db\u30b9\u30c8\u3068Namespace\u3092\u63a5\u7d9a\uff09\nsudo ip link add veth-host type veth peer name veth-ns\n\n# \u7247\u65b9\u3092Namespace\u306b\u79fb\u52d5\nsudo ip link set veth-ns netns myns\n\n# IP\u30a2\u30c9\u30ec\u30b9\u8a2d\u5b9a\nsudo ip addr add 10.0.0.1/24 dev veth-host\nsudo ip link set veth-host up\n\nsudo ip netns exec myns ip addr add 10.0.0.2/24 dev veth-ns\nsudo ip netns exec myns ip link set veth-ns up\n\n# \u758e\u901a\u78ba\u8a8d\nsudo ip netns exec myns ping 10.0.0.1\n\n# \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\nsudo ip netns delete myns\n"})}),"\n",(0,r.jsx)(n.h3,{id:"docker\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af",children:"Docker\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u30b3\u30f3\u30c6\u30ca\u306eNetwork Namespace\u78ba\u8a8d\ndocker run -d --name test nginx\nPID=$(docker inspect -f '{{.State.Pid}}' test)\nsudo ls -la /proc/$PID/ns/net\n\n# \u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u78ba\u8a8d\nsudo nsenter -t $PID -n ip addr\nsudo nsenter -t $PID -n ip route\nsudo nsenter -t $PID -n iptables -L\n\n# \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\ndocker rm -f test\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"mount-namespace",children:"Mount Namespace"}),"\n",(0,r.jsx)(n.h3,{id:"mount-namespace\u306e\u4ed5\u7d44\u307f",children:"Mount Namespace\u306e\u4ed5\u7d44\u307f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Mount Namespace                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u30db\u30b9\u30c8:                                                     \u2502\n\u2502  /                                                          \u2502\n\u2502  \u251c\u2500\u2500 bin                                                    \u2502\n\u2502  \u251c\u2500\u2500 etc                                                    \u2502\n\u2502  \u251c\u2500\u2500 home                                                   \u2502\n\u2502  \u2514\u2500\u2500 var                                                    \u2502\n\u2502                                                              \u2502\n\u2502  \u30b3\u30f3\u30c6\u30ca (\u72ec\u81ea\u306e Mount Namespace):                          \u2502\n\u2502  /  \u2190 OverlayFS\u3067\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u30de\u30a6\u30f3\u30c8                  \u2502\n\u2502  \u251c\u2500\u2500 bin  (\u30a4\u30e1\u30fc\u30b8\u304b\u3089)                                    \u2502\n\u2502  \u251c\u2500\u2500 etc  (\u30a4\u30e1\u30fc\u30b8\u304b\u3089)                                    \u2502\n\u2502  \u251c\u2500\u2500 app  (\u30a4\u30e1\u30fc\u30b8\u304b\u3089)                                    \u2502\n\u2502  \u2514\u2500\u2500 data \u2190 \u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8 (\u30db\u30b9\u30c8\u306e/var/data)          \u2502\n\u2502                                                              \u2502\n\u2502  \u5404\u30b3\u30f3\u30c6\u30ca\u306f\u72ec\u81ea\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u30d3\u30e5\u30fc\u3092\u6301\u3064               \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b9f\u9a13-1",children:"\u5b9f\u9a13"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u65b0\u3057\u3044Mount Namespace\u3067\u30b7\u30a7\u30eb\u8d77\u52d5\nsudo unshare --mount /bin/bash\n\n# \u4e00\u6642\u7684\u306a\u30de\u30a6\u30f3\u30c8\uff08\u30db\u30b9\u30c8\u306b\u306f\u5f71\u97ff\u3057\u306a\u3044\uff09\nmkdir /tmp/mytest\nmount -t tmpfs tmpfs /tmp/mytest\necho "hello" > /tmp/mytest/test.txt\n\n# \u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u78ba\u8a8d\nls /tmp/mytest  # \u7a7a\uff08\u30db\u30b9\u30c8\u306b\u306f\u898b\u3048\u306a\u3044\uff09\n'})}),"\n",(0,r.jsx)(n.h3,{id:"pivot_root",children:"pivot_root"}),"\n",(0,r.jsx)(n.p,{children:"\u30b3\u30f3\u30c6\u30ca\u306e\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u5909\u66f4\u3057\u307e\u3059\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Docker\u304c\u884c\u3063\u3066\u3044\u308b\u3053\u3068\uff08\u7c21\u7565\u5316\uff09\n# 1. \u65b0\u3057\u3044Mount Namespace\u3092\u4f5c\u6210\n# 2. \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u30de\u30a6\u30f3\u30c8\n# 3. pivot_root \u3067\u30eb\u30fc\u30c8\u3092\u5909\u66f4\n# 4. \u53e4\u3044\u30eb\u30fc\u30c8\u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"user-namespace",children:"User Namespace"}),"\n",(0,r.jsx)(n.h3,{id:"user-namespace\u306e\u4ed5\u7d44\u307f",children:"User Namespace\u306e\u4ed5\u7d44\u307f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   User Namespace                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u30db\u30b9\u30c8:                                                     \u2502\n\u2502  UID 1000 (user) \u304c unshare \u3092\u5b9f\u884c                          \u2502\n\u2502                                                              \u2502\n\u2502  User Namespace\u5185:                                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  UID 0 (root) \u2190 Namespace\u5185\u3067\u306froot\u306b\u898b\u3048\u308b          \u2502   \u2502\n\u2502  \u2502                                                      \u2502   \u2502\n\u2502  \u2502  \u30de\u30c3\u30d4\u30f3\u30b0:                                          \u2502   \u2502\n\u2502  \u2502  Namespace UID 0 \u2194 Host UID 1000                     \u2502   \u2502\n\u2502  \u2502                                                      \u2502   \u2502\n\u2502  \u2502  Namespace\u5185\u3067root\u6a29\u9650\u3092\u6301\u3064\u304c\u3001                      \u2502   \u2502\n\u2502  \u2502  \u30db\u30b9\u30c8\u306b\u5bfe\u3057\u3066\u306f\u4e00\u822c\u30e6\u30fc\u30b6\u30fc\u306e\u6a29\u9650\u3057\u304b\u306a\u3044            \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                              \u2502\n\u2502  Rootless Container \u306e\u57fa\u76e4\u6280\u8853                              \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b9f\u9a13-2",children:"\u5b9f\u9a13"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# User Namespace\u4f5c\u6210\uff08root\u4e0d\u8981\uff09\nunshare --user --map-root-user /bin/bash\n\n# Namespace\u5185\u3067\u78ba\u8a8d\nid\n# uid=0(root) gid=0(root) groups=0(root)\n\nwhoami\n# root\n\n# \u3067\u3082\u30db\u30b9\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u7de8\u96c6\u3067\u304d\u306a\u3044\ntouch /etc/test  # Permission denied\n\n# \u30de\u30c3\u30d4\u30f3\u30b0\u78ba\u8a8d\ncat /proc/$$/uid_map\n# 0  1000  1\n# Namespace UID 0 = Host UID 1000\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u30b3\u30f3\u30c6\u30ca\u3068namespace",children:"\u30b3\u30f3\u30c6\u30ca\u3068Namespace"}),"\n",(0,r.jsx)(n.h3,{id:"docker\u30b3\u30f3\u30c6\u30ca\u306e\u69cb\u6210",children:"Docker\u30b3\u30f3\u30c6\u30ca\u306e\u69cb\u6210"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u30b3\u30f3\u30c6\u30ca\u306eNamespace\u78ba\u8a8d\ndocker run -d --name test nginx\nPID=$(docker inspect -f '{{.State.Pid}}' test)\n\n# \u5404Namespace\u78ba\u8a8d\nsudo ls -la /proc/$PID/ns/\n# cgroup, ipc, mnt, net, pid, user, uts\n\n# \u30db\u30b9\u30c8\u306eNamespace\u3068\u6bd4\u8f03\nsudo ls -la /proc/1/ns/\n# \u7570\u306a\u308binode\u756a\u53f7 = \u7570\u306a\u308bNamespace\n\n# \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\ndocker rm -f test\n"})}),"\n",(0,r.jsx)(n.h3,{id:"namespace\u5171\u6709\u30aa\u30d7\u30b7\u30e7\u30f3",children:"Namespace\u5171\u6709\u30aa\u30d7\u30b7\u30e7\u30f3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u30db\u30b9\u30c8\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f7f\u7528\ndocker run --network host nginx\n\n# \u30db\u30b9\u30c8\u306ePID Namespace\u3092\u4f7f\u7528\ndocker run --pid host nginx\n\n# \u5225\u30b3\u30f3\u30c6\u30ca\u3068Namespace\u5171\u6709\ndocker run -d --name nginx nginx\ndocker run --network container:nginx --pid container:nginx busybox\n"})}),"\n",(0,r.jsx)(n.h3,{id:"kubernetes\u3067\u306e\u5171\u6709",children:"Kubernetes\u3067\u306e\u5171\u6709"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Pod\u5185\u306e\u30b3\u30f3\u30c6\u30ca\u306fNetwork/IPC\u3092\u5171\u6709\napiVersion: v1\nkind: Pod\nmetadata:\n  name: shared-ns-pod\nspec:\n  shareProcessNamespace: true  # PID Namespace\u3082\u5171\u6709\n  containers:\n  - name: app\n    image: myapp\n  - name: sidecar\n    image: sidecar\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u307e\u3068\u3081",children:"\u307e\u3068\u3081"}),"\n",(0,r.jsx)(n.h3,{id:"namespace\u306e\u7a2e\u985e\u3068\u7528\u9014",children:"Namespace\u306e\u7a2e\u985e\u3068\u7528\u9014"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Namespace"}),(0,r.jsx)(n.th,{children:"\u7528\u9014"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PID"}),(0,r.jsx)(n.td,{children:"\u30d7\u30ed\u30bb\u30b9\u306e\u5206\u96e2\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u3067PID 1"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Network"}),(0,r.jsx)(n.td,{children:"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b9\u30bf\u30c3\u30af\u306e\u5206\u96e2"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Mount"}),(0,r.jsx)(n.td,{children:"\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u5206\u96e2"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"UTS"}),(0,r.jsx)(n.td,{children:"\u30db\u30b9\u30c8\u540d\u306e\u5206\u96e2"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"IPC"}),(0,r.jsx)(n.td,{children:"\u30d7\u30ed\u30bb\u30b9\u9593\u901a\u4fe1\u306e\u5206\u96e2"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"User"}),(0,r.jsx)(n.td,{children:"UID/GID\u306e\u5206\u96e2\u3001rootless container"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Cgroup"}),(0,r.jsx)(n.td,{children:"Cgroup\u30d3\u30e5\u30fc\u306e\u5206\u96e2"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"\u4e3b\u306a\u30b3\u30de\u30f3\u30c9",children:"\u4e3b\u306a\u30b3\u30de\u30f3\u30c9"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u30b3\u30de\u30f3\u30c9"}),(0,r.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"unshare"}),(0,r.jsx)(n.td,{children:"\u65b0\u3057\u3044Namespace\u3067\u30d7\u30ed\u30b0\u30e9\u30e0\u5b9f\u884c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"nsenter"}),(0,r.jsx)(n.td,{children:"\u65e2\u5b58\u306eNamespace\u306b\u5165\u308b"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ip netns"}),(0,r.jsx)(n.td,{children:"Network Namespace\u7ba1\u7406"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ls /proc/PID/ns/"}),(0,r.jsx)(n.td,{children:"\u30d7\u30ed\u30bb\u30b9\u306eNamespace\u78ba\u8a8d"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/idp-server/docs/content_11_learning/linux/cgroups",children:"Cgroups"})," - \u30ea\u30bd\u30fc\u30b9\u5236\u9650"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/idp-server/docs/content_11_learning/linux/overlay-filesystem",children:"OverlayFS"})," - \u30b3\u30f3\u30c6\u30ca\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9",children:"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man7/namespaces.7.html",children:"Namespaces man page"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://lwn.net/Articles/531114/",children:"Linux Namespaces (LWN.net)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://ericchiang.github.io/post/containers-from-scratch/",children:"Containers From Scratch"})}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>i});var a=s(96540);const r={},c=a.createContext(r);function d(e){const n=a.useContext(c);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);