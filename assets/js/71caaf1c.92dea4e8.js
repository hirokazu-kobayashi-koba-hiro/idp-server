"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[86898],{15713:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>s,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"content_11_learning/networking/connection-pooling","title":"\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u8a73\u7d30","description":"\u6240\u8981\u6642\u9593","source":"@site/docs/content_11_learning/15-networking/11-connection-pooling.md","sourceDirName":"content_11_learning/15-networking","slug":"/content_11_learning/networking/connection-pooling","permalink":"/idp-server/docs/content_11_learning/networking/connection-pooling","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/15-networking/11-connection-pooling.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{},"sidebar":"docs","previous":{"title":"Web\u30b5\u30fc\u30d0\u30fc\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","permalink":"/idp-server/docs/content_11_learning/networking/web-server-architecture"},"next":{"title":"\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068API Gateway","permalink":"/idp-server/docs/content_11_learning/networking/api-gateway-networking"}}');var t=i(74848),l=i(28453);const r={},c="\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u8a73\u7d30",s={},a=[{value:"\u6240\u8981\u6642\u9593",id:"\u6240\u8981\u6642\u9593",level:2},{value:"\u5b66\u3079\u308b\u3053\u3068",id:"\u5b66\u3079\u308b\u3053\u3068",level:2},{value:"\u524d\u63d0\u77e5\u8b58",id:"\u524d\u63d0\u77e5\u8b58",level:2},{value:"1. \u306a\u305c\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u304c\u5fc5\u8981\u304b",id:"1-\u306a\u305c\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u304c\u5fc5\u8981\u304b",level:2},{value:"1.1 \u63a5\u7d9a\u306e\u30b3\u30b9\u30c8",id:"11-\u63a5\u7d9a\u306e\u30b3\u30b9\u30c8",level:3},{value:"1.2 \u30d7\u30fc\u30eb\u306a\u3057\u306e\u554f\u984c",id:"12-\u30d7\u30fc\u30eb\u306a\u3057\u306e\u554f\u984c",level:3},{value:"1.3 \u30d7\u30fc\u30eb\u3042\u308a\u306e\u52d5\u4f5c",id:"13-\u30d7\u30fc\u30eb\u3042\u308a\u306e\u52d5\u4f5c",level:3},{value:"2. \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u30d7\u30fc\u30eb\uff08HikariCP\uff09",id:"2-\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u30d7\u30fc\u30ebhikaricp",level:2},{value:"2.1 HikariCP \u306e\u57fa\u672c",id:"21-hikaricp-\u306e\u57fa\u672c",level:3},{value:"2.2 HikariCP \u8a2d\u5b9a\uff08Spring Boot\uff09",id:"22-hikaricp-\u8a2d\u5b9aspring-boot",level:3},{value:"2.3 \u5404\u8a2d\u5b9a\u306e\u610f\u5473",id:"23-\u5404\u8a2d\u5b9a\u306e\u610f\u5473",level:3},{value:"2.4 \u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u6c7a\u3081\u65b9",id:"24-\u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u6c7a\u3081\u65b9",level:3},{value:"3. \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30ed\u30ad\u30b7\uff08PgBouncer\uff09",id:"3-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30ed\u30ad\u30b7pgbouncer",level:2},{value:"3.1 \u306a\u305c\u5fc5\u8981\u304b",id:"31-\u306a\u305c\u5fc5\u8981\u304b",level:3},{value:"3.2 \u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9",id:"32-\u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9",level:3},{value:"3.3 \u8a2d\u5b9a\u4f8b",id:"33-\u8a2d\u5b9a\u4f8b",level:3},{value:"4. HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb",id:"4-http\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb",level:2},{value:"4.1 \u306a\u305cHTTP\u3067\u3082\u30d7\u30fc\u30eb\u304c\u5fc5\u8981\u304b",id:"41-\u306a\u305chttp\u3067\u3082\u30d7\u30fc\u30eb\u304c\u5fc5\u8981\u304b",level:3},{value:"4.2 RestTemplate\uff08\u30ec\u30ac\u30b7\u30fc\uff09",id:"42-resttemplate\u30ec\u30ac\u30b7\u30fc",level:3},{value:"4.3 WebClient\uff08\u63a8\u5968\uff09",id:"43-webclient\u63a8\u5968",level:3},{value:"4.4 OkHttp",id:"44-okhttp",level:3},{value:"5. Redis \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb",id:"5-redis-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb",level:2},{value:"5.1 Lettuce\uff08Spring Boot \u30c7\u30d5\u30a9\u30eb\u30c8\uff09",id:"51-lettucespring-boot-\u30c7\u30d5\u30a9\u30eb\u30c8",level:3},{value:"5.2 Jedis",id:"52-jedis",level:3},{value:"6. \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",id:"6-\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",level:2},{value:"6.1 \u3088\u304f\u3042\u308b\u554f\u984c",id:"61-\u3088\u304f\u3042\u308b\u554f\u984c",level:3},{value:"6.2 HikariCP \u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u8a2d\u5b9a",id:"62-hikaricp-\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u8a2d\u5b9a",level:3},{value:"6.3 \u30e1\u30c8\u30ea\u30af\u30b9\u78ba\u8a8d\uff08Spring Boot Actuator\uff09",id:"63-\u30e1\u30c8\u30ea\u30af\u30b9\u78ba\u8a8dspring-boot-actuator",level:3},{value:"7. \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"7-\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:2},{value:"7.1 \u8a2d\u5b9a\u306e\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",id:"71-\u8a2d\u5b9a\u306e\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",level:3},{value:"7.2 \u672c\u756a\u74b0\u5883\u3067\u306e\u8a2d\u5b9a\u4f8b",id:"72-\u672c\u756a\u74b0\u5883\u3067\u306e\u8a2d\u5b9a\u4f8b",level:3},{value:"\u307e\u3068\u3081",id:"\u307e\u3068\u3081",level:2},{value:"\u5b66\u3093\u3060\u3053\u3068",id:"\u5b66\u3093\u3060\u3053\u3068",level:3},{value:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8",id:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8",level:3},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:3},{value:"\u53c2\u8003\u30ea\u30f3\u30af",id:"\u53c2\u8003\u30ea\u30f3\u30af",level:3}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u8a73\u7d30",children:"\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u8a73\u7d30"})}),"\n",(0,t.jsx)(e.h2,{id:"\u6240\u8981\u6642\u9593",children:"\u6240\u8981\u6642\u9593"}),"\n",(0,t.jsx)(e.p,{children:"\u7d0445\u5206"}),"\n",(0,t.jsx)(e.h2,{id:"\u5b66\u3079\u308b\u3053\u3068",children:"\u5b66\u3079\u308b\u3053\u3068"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u306a\u305c\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u304c\u5fc5\u8981\u306a\u306e\u304b"}),"\n",(0,t.jsx)(e.li,{children:"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u30d7\u30fc\u30eb\uff08HikariCP\uff09\u306e\u4ed5\u7d44\u307f\u3068\u8a2d\u5b9a"}),"\n",(0,t.jsx)(e.li,{children:"HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb"}),"\n",(0,t.jsx)(e.li,{children:"Redis\u7b49\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb"}),"\n",(0,t.jsx)(e.li,{children:"\u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u6c7a\u3081\u65b9"}),"\n",(0,t.jsx)(e.li,{children:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"\u524d\u63d0\u77e5\u8b58",children:"\u524d\u63d0\u77e5\u8b58"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/tcp-fundamentals",children:"09-tcp-fundamentals.md"})," - TCP\u57fa\u790e\uff083\u30a6\u30a7\u30a4\u30cf\u30f3\u30c9\u30b7\u30a7\u30a4\u30af\u3001TIME_WAIT\uff09"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/web-server-architecture",children:"10-web-server-architecture.md"})," - Web\u30b5\u30fc\u30d0\u30fc\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"1-\u306a\u305c\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u304c\u5fc5\u8981\u304b",children:"1. \u306a\u305c\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u304c\u5fc5\u8981\u304b"}),"\n",(0,t.jsx)(e.h3,{id:"11-\u63a5\u7d9a\u306e\u30b3\u30b9\u30c8",children:"1.1 \u63a5\u7d9a\u306e\u30b3\u30b9\u30c8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              TCP\u63a5\u7d9a\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010\u63a5\u7d9a\u3054\u3068\u306b\u767a\u751f\u3059\u308b\u30b3\u30b9\u30c8\u3011                                \u2502\n\u2502                                                              \u2502\n\u2502  1. TCP 3\u30a6\u30a7\u30a4\u30cf\u30f3\u30c9\u30b7\u30a7\u30a4\u30af                               \u2502\n\u2502     Client \u2500\u2500SYN\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Server                          \u2502\n\u2502     Client \u25c4\u2500\u2500SYN+ACK\u2500\u2500\u2500\u2500\u2500\u2500 Server    \u2190 1 RTT              \u2502\n\u2502     Client \u2500\u2500ACK\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Server                          \u2502\n\u2502                                                              \u2502\n\u2502  2. TLS\u30cf\u30f3\u30c9\u30b7\u30a7\u30a4\u30af\uff08HTTPS/TLS\u63a5\u7d9a\u306e\u5834\u5408\uff09                \u2502\n\u2502     \u8ffd\u52a0\u3067 1\u301c2 RTT                                         \u2502\n\u2502                                                              \u2502\n\u2502  3. \u8a8d\u8a3c\uff08\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5834\u5408\uff09                               \u2502\n\u2502     \u30e6\u30fc\u30b6\u30fc\u540d/\u30d1\u30b9\u30ef\u30fc\u30c9\u691c\u8a3c\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb               \u2502\n\u2502                                                              \u2502\n\u2502  4. \u5207\u65ad\u6642\u306e TIME_WAIT                                      \u2502\n\u2502     \u5207\u65ad\u5f8c 60\u79d2\u301c120\u79d2 \u30bd\u30b1\u30c3\u30c8\u304c\u6b8b\u5b58                       \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u5177\u4f53\u7684\u306a\u6642\u9593\u3011                                            \u2502\n\u2502                                                              \u2502\n\u2502  \u540c\u4e00\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u5185:                                       \u2502\n\u2502  - TCP\u63a5\u7d9a: 0.5ms\u301c1ms                                      \u2502\n\u2502  - TLS\u8ffd\u52a0: 1ms\u301c2ms                                        \u2502\n\u2502  - PostgreSQL\u8a8d\u8a3c: 5ms\u301c10ms                                \u2502\n\u2502  \u2192 \u5408\u8a08: \u7d0410ms \u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9                            \u2502\n\u2502                                                              \u2502\n\u2502  \u30af\u30ed\u30b9\u30ea\u30fc\u30b8\u30e7\u30f3\uff08\u6771\u4eac\u2194\u30d0\u30fc\u30b8\u30cb\u30a2\uff09:                       \u2502\n\u2502  - RTT: \u7d04150ms                                             \u2502\n\u2502  - TCP + TLS: 300ms\u301c450ms                                  \u2502\n\u2502  \u2192 \u5408\u8a08: \u6570\u767ems \u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9                            \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"12-\u30d7\u30fc\u30eb\u306a\u3057\u306e\u554f\u984c",children:"1.2 \u30d7\u30fc\u30eb\u306a\u3057\u306e\u554f\u984c"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30d7\u30fc\u30eb\u306a\u3057\u306e\u52d5\u4f5c                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u30ea\u30af\u30a8\u30b9\u30c8\u3054\u3068\u306b\u63a5\u7d9a\u30fb\u5207\u65ad                                  \u2502\n\u2502                                                              \u2502\n\u2502  Request 1:                                                  \u2502\n\u2502    [\u63a5\u7d9a 10ms][\u30af\u30a8\u30ea 2ms][\u5207\u65ad] \u2192 \u5408\u8a08 12ms+               \u2502\n\u2502                                                              \u2502\n\u2502  Request 2:                                                  \u2502\n\u2502    [\u63a5\u7d9a 10ms][\u30af\u30a8\u30ea 2ms][\u5207\u65ad] \u2192 \u5408\u8a08 12ms+               \u2502\n\u2502                                                              \u2502\n\u2502  Request 3:                                                  \u2502\n\u2502    [\u63a5\u7d9a 10ms][\u30af\u30a8\u30ea 2ms][\u5207\u65ad] \u2192 \u5408\u8a08 12ms+               \u2502\n\u2502                                                              \u2502\n\u2502  \u554f\u984c:                                                       \u2502\n\u2502  - \u63a5\u7d9a\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u30af\u30a8\u30ea\u6642\u9593\u3088\u308a\u9577\u3044                   \u2502\n\u2502  - TIME_WAIT \u3067\u30bd\u30b1\u30c3\u30c8\u67af\u6e07\u306e\u30ea\u30b9\u30af                         \u2502\n\u2502  - DB\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u63a5\u7d9a\u6570\u304c\u5236\u5fa1\u3067\u304d\u306a\u3044                       \u2502\n\u2502  - \u9ad8\u8ca0\u8377\u6642\u306bDB\u63a5\u7d9a\u4e0a\u9650\u306b\u9054\u3059\u308b                             \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"13-\u30d7\u30fc\u30eb\u3042\u308a\u306e\u52d5\u4f5c",children:"1.3 \u30d7\u30fc\u30eb\u3042\u308a\u306e\u52d5\u4f5c"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30d7\u30fc\u30eb\u3042\u308a\u306e\u52d5\u4f5c                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u8d77\u52d5\u6642\u306b\u63a5\u7d9a\u3092\u78ba\u7acb\u3057\u3066\u30d7\u30fc\u30eb                                \u2502\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  Connection Pool                                    \u2502    \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2510               \u2502    \u2502\n\u2502  \u2502  \u2502Conn\u2502 \u2502Conn\u2502 \u2502Conn\u2502 \u2502Conn\u2502 \u2502Conn\u2502  (idle)       \u2502    \u2502\n\u2502  \u2502  \u2502 1  \u2502 \u2502 2  \u2502 \u2502 3  \u2502 \u2502 4  \u2502 \u2502 5  \u2502               \u2502    \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2518               \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502       \u2191                                                     \u2502\n\u2502       \u2502 borrow                                              \u2502\n\u2502       \u2502                                                     \u2502\n\u2502  Request 1:                                                  \u2502\n\u2502    [\u501f\u7528 0.01ms][\u30af\u30a8\u30ea 2ms][\u8fd4\u5374] \u2192 \u5408\u8a08 2ms               \u2502\n\u2502                                                              \u2502\n\u2502  Request 2:                                                  \u2502\n\u2502    [\u501f\u7528 0.01ms][\u30af\u30a8\u30ea 2ms][\u8fd4\u5374] \u2192 \u5408\u8a08 2ms               \u2502\n\u2502                                                              \u2502\n\u2502  \u52b9\u679c:                                                       \u2502\n\u2502  - \u63a5\u7d9a\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u307b\u307c\u30bc\u30ed                             \u2502\n\u2502  - TIME_WAIT \u554f\u984c\u306a\u3057\uff08\u63a5\u7d9a\u3092\u7dad\u6301\u3059\u308b\u305f\u3081\uff09                 \u2502\n\u2502  - \u63a5\u7d9a\u6570\u306e\u4e0a\u9650\u3092\u5236\u5fa1\u53ef\u80fd                                   \u2502\n\u2502  - DB\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u8ca0\u8377\u3092\u4e88\u6e2c\u53ef\u80fd                             \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"2-\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u30d7\u30fc\u30ebhikaricp",children:"2. \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u30d7\u30fc\u30eb\uff08HikariCP\uff09"}),"\n",(0,t.jsx)(e.h3,{id:"21-hikaricp-\u306e\u57fa\u672c",children:"2.1 HikariCP \u306e\u57fa\u672c"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              HikariCP \u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  Spring Boot Application                                     \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  HikariDataSource                                   \u2502    \u2502\n\u2502  \u2502                                                     \u2502    \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502    \u2502\n\u2502  \u2502  \u2502  ConcurrentBag (\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u7ba1\u7406)             \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502                                               \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2502 Connection[] (\u30d7\u30fc\u30eb)                  \u2502   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2502                                        \u2502   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2502  [0] IDLE     \u2190 \u501f\u7528\u53ef\u80fd              \u2502   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2502  [1] IN_USE   \u2190 \u4f7f\u7528\u4e2d                \u2502   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2502  [2] IDLE     \u2190 \u501f\u7528\u53ef\u80fd              \u2502   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2502  [3] IN_USE   \u2190 \u4f7f\u7528\u4e2d                \u2502   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2502  [4] IDLE     \u2190 \u501f\u7528\u53ef\u80fd              \u2502   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2502  ...                                   \u2502   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502                                               \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  HouseKeeper (\u5b9a\u671f\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9)               \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  - \u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u306e\u524a\u9664                         \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  - \u63a5\u7d9a\u306e\u6709\u52b9\u6027\u30c1\u30a7\u30c3\u30af                       \u2502  \u2502    \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502    \u2502\n\u2502  \u2502                                                     \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u2502 TCP\u63a5\u7d9a\uff08\u7dad\u6301\uff09                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  PostgreSQL / MySQL                                         \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"22-hikaricp-\u8a2d\u5b9aspring-boot",children:"2.2 HikariCP \u8a2d\u5b9a\uff08Spring Boot\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"spring:\n  datasource:\n    url: jdbc:postgresql://localhost:5432/mydb\n    username: myuser\n    password: ${DB_PASSWORD}\n\n    hikari:\n      # \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\n      minimum-idle: 5          # \u6700\u5c0f\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\n      maximum-pool-size: 10    # \u6700\u5927\u63a5\u7d9a\u6570\n\n      # \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n      connection-timeout: 30000      # \u63a5\u7d9a\u53d6\u5f97\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 (ms)\n      idle-timeout: 600000           # \u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u306e\u751f\u5b58\u6642\u9593 (ms)\n      max-lifetime: 1800000          # \u63a5\u7d9a\u306e\u6700\u5927\u751f\u5b58\u6642\u9593 (ms)\n\n      # \u691c\u8a3c\n      validation-timeout: 5000       # \u63a5\u7d9a\u691c\u8a3c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 (ms)\n\n      # \u305d\u306e\u4ed6\n      pool-name: MyAppPool           # \u30d7\u30fc\u30eb\u540d\uff08\u30ed\u30b0\u3067\u8b58\u5225\u7528\uff09\n      auto-commit: true              # \u81ea\u52d5\u30b3\u30df\u30c3\u30c8\n"})}),"\n",(0,t.jsx)(e.h3,{id:"23-\u5404\u8a2d\u5b9a\u306e\u610f\u5473",children:"2.3 \u5404\u8a2d\u5b9a\u306e\u610f\u5473"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              HikariCP \u8a2d\u5b9a\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010maximum-pool-size\u3011                                       \u2502\n\u2502  \u30d7\u30fc\u30eb\u304c\u6301\u3066\u308b\u6700\u5927\u63a5\u7d9a\u6570                                    \u2502\n\u2502                                                              \u2502\n\u2502  - \u5168\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u3053\u306e\u6570\u3092\u8d85\u3048\u308b\u3068\u5f85\u6a5f\u304c\u767a\u751f                 \u2502\n\u2502  - DB\u30b5\u30fc\u30d0\u30fc\u306e max_connections \u3082\u8003\u616e\u5fc5\u8981                  \u2502\n\u2502  - \u30a2\u30d7\u30ea\u8907\u6570\u53f0\u306e\u5834\u5408: \u5168\u30a2\u30d7\u30ea\u306e\u5408\u8a08 < DB\u4e0a\u9650              \u2502\n\u2502                                                              \u2502\n\u2502  \u4f8b: \u30a2\u30d7\u30ea5\u53f0 \xd7 pool-size 10 = 50\u63a5\u7d9a                     \u2502\n\u2502      \u2192 PostgreSQL max_connections \u306f 100 \u4ee5\u4e0a\u5fc5\u8981           \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010minimum-idle\u3011                                            \u2502\n\u2502  \u7dad\u6301\u3059\u308b\u6700\u5c0f\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570                                  \u2502\n\u2502                                                              \u2502\n\u2502  - \u8ca0\u8377\u304c\u4f4e\u3044\u6642\u3067\u3082\u3053\u306e\u6570\u306f\u7dad\u6301                             \u2502\n\u2502  - \u30b3\u30fc\u30eb\u30c9\u30b9\u30bf\u30fc\u30c8\u56de\u907f\uff08\u6700\u521d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u901f\u3044\uff09           \u2502\n\u2502  - maximum-pool-size \u3068\u540c\u3058\u306b\u3059\u308b\u306e\u304c HikariCP \u63a8\u5968         \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010connection-timeout\u3011                                      \u2502\n\u2502  \u30d7\u30fc\u30eb\u304b\u3089\u63a5\u7d9a\u3092\u53d6\u5f97\u3059\u308b\u307e\u3067\u306e\u6700\u5927\u5f85\u6a5f\u6642\u9593                  \u2502\n\u2502                                                              \u2502\n\u2502  - \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3059\u308b\u3068 SQLException \u767a\u751f                     \u2502\n\u2502  - 30\u79d2\u304c\u30c7\u30d5\u30a9\u30eb\u30c8                                         \u2502\n\u2502  - \u77ed\u3059\u304e\u308b\u3068\u9ad8\u8ca0\u8377\u6642\u306b\u30a8\u30e9\u30fc\u591a\u767a                           \u2502\n\u2502  - \u9577\u3059\u304e\u308b\u3068\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8                       \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010max-lifetime\u3011                                            \u2502\n\u2502  \u63a5\u7d9a\u306e\u6700\u5927\u751f\u5b58\u6642\u9593                                          \u2502\n\u2502                                                              \u2502\n\u2502  - \u3053\u306e\u6642\u9593\u3092\u904e\u304e\u305f\u63a5\u7d9a\u306f\u7834\u68c4\u2192\u518d\u4f5c\u6210                       \u2502\n\u2502  - DB\u306e wait_timeout \u3088\u308a\u77ed\u304f\u3059\u308b                           \u2502\n\u2502  - PostgreSQL\u30c7\u30d5\u30a9\u30eb\u30c8: \u7121\u5236\u9650                             \u2502\n\u2502  - MySQL \u30c7\u30d5\u30a9\u30eb\u30c8: 8\u6642\u9593 (28800\u79d2)                        \u2502\n\u2502                                                              \u2502\n\u2502  \u63a8\u5968: DB\u306e wait_timeout - 30\u79d2                             \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010idle-timeout\u3011                                            \u2502\n\u2502  \u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u304c\u524a\u9664\u3055\u308c\u308b\u307e\u3067\u306e\u6642\u9593                          \u2502\n\u2502                                                              \u2502\n\u2502  - minimum-idle \u3092\u4e0b\u56de\u3089\u306a\u3044\u7bc4\u56f2\u3067\u524a\u9664                      \u2502\n\u2502  - minimum-idle = maximum-pool-size \u306a\u3089\u7121\u52b9                \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"24-\u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u6c7a\u3081\u65b9",children:"2.4 \u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u6c7a\u3081\u65b9"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u6c7a\u3081\u65b9                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010\u516c\u5f0f\uff08HikariCP\u4f5c\u8005\u63a8\u5968\uff09\u3011                                \u2502\n\u2502                                                              \u2502\n\u2502  connections = (core_count * 2) + effective_spindle_count   \u2502\n\u2502                                                              \u2502\n\u2502  - core_count: CPU\u30b3\u30a2\u6570                                    \u2502\n\u2502  - effective_spindle_count: HDD\u306a\u30891\u3001SSD\u306a\u30890              \u2502\n\u2502                                                              \u2502\n\u2502  \u4f8b: 4\u30b3\u30a2CPU + SSD = (4 * 2) + 0 = 8\u63a5\u7d9a                   \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u73fe\u5b9f\u7684\u306a\u8003\u3048\u65b9\u3011                                          \u2502\n\u2502                                                              \u2502\n\u2502  \u30b9\u30ec\u30c3\u30c9\u6570\u3068\u306e\u30d0\u30e9\u30f3\u30b9:                                     \u2502\n\u2502                                                              \u2502\n\u2502  Tomcat max-threads: 200                                    \u2502\n\u2502  DB pool-size: 10                                           \u2502\n\u2502                                                              \u2502\n\u2502  \u2192 200\u30b9\u30ec\u30c3\u30c9\u304c\u540c\u6642\u306bDB\u63a5\u7d9a\u3092\u8981\u6c42\u3059\u308b\u3068                   \u2502\n\u2502    190\u30b9\u30ec\u30c3\u30c9\u304c\u5f85\u6a5f\u72b6\u614b\u306b\u306a\u308b                              \u2502\n\u2502                                                              \u2502\n\u2502  \u5bfe\u7b56:                                                       \u2502\n\u2502  1. \u30af\u30a8\u30ea\u3092\u901f\u304f\u3059\u308b\uff08\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u6700\u9069\u5316\uff09                  \u2502\n\u2502  2. \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u3092\u9069\u5207\u306b\u5897\u3084\u3059                              \u2502\n\u2502  3. \u30b9\u30ec\u30c3\u30c9\u6570\u3092\u6e1b\u3089\u3059                                      \u2502\n\u2502  4. \u975e\u540c\u671f\u51e6\u7406\u3067DB\u30a2\u30af\u30bb\u30b9\u3092\u6e1b\u3089\u3059                          \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u3088\u304f\u3042\u308b\u8a2d\u5b9a\u4f8b\u3011                                          \u2502\n\u2502                                                              \u2502\n\u2502  \u5c0f\u898f\u6a21\u30a2\u30d7\u30ea\uff081\u53f0\uff09:                                        \u2502\n\u2502    maximum-pool-size: 10                                    \u2502\n\u2502                                                              \u2502\n\u2502  \u4e2d\u898f\u6a21\u30a2\u30d7\u30ea\uff085\u301c10\u53f0\uff09:                                    \u2502\n\u2502    maximum-pool-size: 10\u301c20                                \u2502\n\u2502    \u203b \u5168\u30a2\u30d7\u30ea\u5408\u8a08\u304cDB\u4e0a\u9650\u3092\u8d85\u3048\u306a\u3044\u3053\u3068                    \u2502\n\u2502                                                              \u2502\n\u2502  \u5927\u898f\u6a21\uff08PgBouncer\u4f7f\u7528\uff09:                                    \u2502\n\u2502    \u30a2\u30d7\u30ea\u5074: 20\u301c50                                         \u2502\n\u2502    PgBouncer \u3067\u96c6\u7d04\u3057\u3066 DB \u3078                               \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"3-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30ed\u30ad\u30b7pgbouncer",children:"3. \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30ed\u30ad\u30b7\uff08PgBouncer\uff09"}),"\n",(0,t.jsx)(e.h3,{id:"31-\u306a\u305c\u5fc5\u8981\u304b",children:"3.1 \u306a\u305c\u5fc5\u8981\u304b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              PgBouncer \u306e\u5f79\u5272                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010\u554f\u984c: \u30a2\u30d7\u30ea\u53f0\u6570\u304c\u5897\u3048\u308b\u3068\u63a5\u7d9a\u6570\u304c\u7206\u767a\u3011                  \u2502\n\u2502                                                              \u2502\n\u2502  App 1 (pool=20) \u2500\u2500\u2510                                        \u2502\n\u2502  App 2 (pool=20) \u2500\u2500\u253c\u2500\u2500\u25ba PostgreSQL (max_connections=100)   \u2502\n\u2502  App 3 (pool=20) \u2500\u2500\u2524                                        \u2502\n\u2502  App 4 (pool=20) \u2500\u2500\u2524    \u2190 80\u63a5\u7d9a\u3067\u4f59\u88d5\u306a\u3057                  \u2502\n\u2502  App 5 (pool=20) \u2500\u2500\u2518    \u2190 100\u8d85\u3048\u3067\u63a5\u7d9a\u30a8\u30e9\u30fc               \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u89e3\u6c7a: PgBouncer \u3067\u63a5\u7d9a\u3092\u96c6\u7d04\u3011                            \u2502\n\u2502                                                              \u2502\n\u2502  App 1 (pool=20) \u2500\u2500\u2510                                        \u2502\n\u2502  App 2 (pool=20) \u2500\u2500\u2524                                        \u2502\n\u2502  App 3 (pool=20) \u2500\u2500\u253c\u2500\u2500\u25ba PgBouncer \u2500\u2500\u25ba PostgreSQL           \u2502\n\u2502  App 4 (pool=20) \u2500\u2500\u2524    (100\u63a5\u7d9a)     (20\u63a5\u7d9a)              \u2502\n\u2502  App 5 (pool=20) \u2500\u2500\u2518                                        \u2502\n\u2502                                                              \u2502\n\u2502  \u30a2\u30d7\u30ea\u5074: 100\u63a5\u7d9a                                          \u2502\n\u2502  DB\u5074: 20\u63a5\u7d9a \u2190 \u5927\u5e45\u524a\u6e1b                                    \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"32-\u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9",children:"3.2 \u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              PgBouncer \u306e\u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010session \u30e2\u30fc\u30c9\u3011                                          \u2502\n\u2502  - \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\u4e2d\u306f\u540c\u3058DB\u63a5\u7d9a\u3092\u7dad\u6301                     \u2502\n\u2502  - \u52b9\u679c\u306f\u9650\u5b9a\u7684\uff08\u63a5\u7d9a\u3092\u5171\u6709\u3057\u306a\u3044\uff09                         \u2502\n\u2502  - PREPARE\u6587\u3001\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u304c\u4f7f\u3048\u308b                          \u2502\n\u2502                                                              \u2502\n\u2502  \u3010transaction \u30e2\u30fc\u30c9\u3011\u2605\u63a8\u5968                                \u2502\n\u2502  - \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5358\u4f4d\u3067DB\u63a5\u7d9a\u3092\u5171\u6709                       \u2502\n\u2502  - \u52b9\u679c\u304c\u9ad8\u3044\uff081\u3064\u306eDB\u63a5\u7d9a\u3092\u8907\u6570\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u518d\u5229\u7528\uff09      \u2502\n\u2502  - PREPARE\u6587\u3001SET\u3001\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u306f\u4f7f\u3048\u306a\u3044                   \u2502\n\u2502                                                              \u2502\n\u2502  \u3010statement \u30e2\u30fc\u30c9\u3011                                        \u2502\n\u2502  - SQL\u6587\u5358\u4f4d\u3067DB\u63a5\u7d9a\u3092\u5171\u6709                                  \u2502\n\u2502  - \u6700\u3082\u52b9\u7387\u7684\u3060\u304c\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4e0d\u53ef                       \u2502\n\u2502  - \u7279\u6b8a\u306a\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u306e\u307f                                   \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"33-\u8a2d\u5b9a\u4f8b",children:"3.3 \u8a2d\u5b9a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# /etc/pgbouncer/pgbouncer.ini\n\n[databases]\nmydb = host=127.0.0.1 port=5432 dbname=mydb\n\n[pgbouncer]\nlisten_addr = 0.0.0.0\nlisten_port = 6432\nauth_type = md5\nauth_file = /etc/pgbouncer/userlist.txt\n\n# \u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9\npool_mode = transaction\n\n# \u63a5\u7d9a\u6570\u8a2d\u5b9a\nmax_client_conn = 1000    # \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u6700\u5927\u63a5\u7d9a\ndefault_pool_size = 20    # DB\u6bce\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\nmin_pool_size = 5         # \u6700\u5c0f\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\nreserve_pool_size = 5     # \u4e88\u5099\u63a5\u7d9a\u6570\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"4-http\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb",children:"4. HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb"}),"\n",(0,t.jsx)(e.h3,{id:"41-\u306a\u305chttp\u3067\u3082\u30d7\u30fc\u30eb\u304c\u5fc5\u8981\u304b",children:"4.1 \u306a\u305cHTTP\u3067\u3082\u30d7\u30fc\u30eb\u304c\u5fc5\u8981\u304b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\u306e\u554f\u984c                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u9593\u901a\u4fe1\u3011                                  \u2502\n\u2502                                                              \u2502\n\u2502  Service A \u2500\u2500HTTP\u2500\u2500\u25ba Service B                              \u2502\n\u2502                                                              \u2502\n\u2502  \u5404\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u63a5\u7d9a\u3092\u4f5c\u6210\u3059\u308b\u3068:                            \u2502\n\u2502  - TCP 3\u30a6\u30a7\u30a4\u30cf\u30f3\u30c9\u30b7\u30a7\u30a4\u30af: 0.5ms\u301c1ms                    \u2502\n\u2502  - TLS\u30cf\u30f3\u30c9\u30b7\u30a7\u30a4\u30af\uff08HTTPS\uff09: 1ms\u301c2ms                     \u2502\n\u2502  - \u5207\u65ad\u5f8c\u306e TIME_WAIT \u84c4\u7a4d                                  \u2502\n\u2502                                                              \u2502\n\u2502  1000 req/sec \u306e\u5834\u5408:                                        \u2502\n\u2502  - 1\u79d2\u30671000\u56de\u306eTCP\u63a5\u7d9a\u78ba\u7acb                                 \u2502\n\u2502  - TIME_WAIT \u304c60\u79d2\u6b8b\u308b\u3068: 60,000\u30bd\u30b1\u30c3\u30c8\u6ede\u7559               \u2502\n\u2502  - \u30dd\u30fc\u30c8\u67af\u6e07\u306e\u30ea\u30b9\u30af                                       \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u89e3\u6c7a: HTTP Keep-Alive + \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u3011              \u2502\n\u2502                                                              \u2502\n\u2502  1\u3064\u306eTCP\u63a5\u7d9a\u3067\u8907\u6570\u306eHTTP\u30ea\u30af\u30a8\u30b9\u30c8/\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u3084\u308a\u53d6\u308a    \u2502\n\u2502                                                              \u2502\n\u2502  Connection: Keep-Alive                                      \u2502\n\u2502                                                              \u2502\n\u2502  Request 1 \u2500\u2500\u25ba Response 1                                   \u2502\n\u2502  Request 2 \u2500\u2500\u25ba Response 2   \u540c\u3058TCP\u63a5\u7d9a\u3092\u518d\u5229\u7528             \u2502\n\u2502  Request 3 \u2500\u2500\u25ba Response 3                                   \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"42-resttemplate\u30ec\u30ac\u30b7\u30fc",children:"4.2 RestTemplate\uff08\u30ec\u30ac\u30b7\u30fc\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"@Configuration\npublic class RestTemplateConfig {\n\n    @Bean\n    public RestTemplate restTemplate() {\n        // \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u8a2d\u5b9a\n        PoolingHttpClientConnectionManager connectionManager =\n            new PoolingHttpClientConnectionManager();\n        connectionManager.setMaxTotal(100);           // \u5168\u4f53\u306e\u6700\u5927\u63a5\u7d9a\u6570\n        connectionManager.setDefaultMaxPerRoute(20);  // \u30db\u30b9\u30c8\u3054\u3068\u306e\u6700\u5927\u63a5\u7d9a\u6570\n\n        CloseableHttpClient httpClient = HttpClients.custom()\n            .setConnectionManager(connectionManager)\n            .setKeepAliveStrategy((response, context) -> 30_000)  // Keep-Alive 30\u79d2\n            .evictIdleConnections(60, TimeUnit.SECONDS)  // \u30a2\u30a4\u30c9\u30eb60\u79d2\u3067\u524a\u9664\n            .build();\n\n        HttpComponentsClientHttpRequestFactory factory =\n            new HttpComponentsClientHttpRequestFactory(httpClient);\n        factory.setConnectTimeout(5000);      // \u63a5\u7d9a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n        factory.setReadTimeout(30000);        // \u8aad\u307f\u53d6\u308a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n\n        return new RestTemplate(factory);\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"43-webclient\u63a8\u5968",children:"4.3 WebClient\uff08\u63a8\u5968\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@Configuration\npublic class WebClientConfig {\n\n    @Bean\n    public WebClient webClient() {\n        // \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u8a2d\u5b9a\n        ConnectionProvider provider = ConnectionProvider.builder("myPool")\n            .maxConnections(100)                    // \u6700\u5927\u63a5\u7d9a\u6570\n            .maxIdleTime(Duration.ofSeconds(60))    // \u30a2\u30a4\u30c9\u30eb\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n            .maxLifeTime(Duration.ofMinutes(5))     // \u63a5\u7d9a\u306e\u6700\u5927\u751f\u5b58\u6642\u9593\n            .pendingAcquireTimeout(Duration.ofSeconds(30))  // \u53d6\u5f97\u5f85\u3061\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n            .evictInBackground(Duration.ofSeconds(30))      // \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u524a\u9664\n            .build();\n\n        HttpClient httpClient = HttpClient.create(provider)\n            .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 5000)\n            .responseTimeout(Duration.ofSeconds(30));\n\n        return WebClient.builder()\n            .clientConnector(new ReactorClientHttpConnector(httpClient))\n            .build();\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"44-okhttp",children:"4.4 OkHttp"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"@Configuration\npublic class OkHttpConfig {\n\n    @Bean\n    public OkHttpClient okHttpClient() {\n        ConnectionPool connectionPool = new ConnectionPool(\n            20,                         // \u6700\u5927\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\n            5, TimeUnit.MINUTES         // Keep-Alive\u6642\u9593\n        );\n\n        return new OkHttpClient.Builder()\n            .connectionPool(connectionPool)\n            .connectTimeout(5, TimeUnit.SECONDS)\n            .readTimeout(30, TimeUnit.SECONDS)\n            .writeTimeout(30, TimeUnit.SECONDS)\n            .build();\n    }\n}\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"5-redis-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb",children:"5. Redis \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb"}),"\n",(0,t.jsx)(e.h3,{id:"51-lettucespring-boot-\u30c7\u30d5\u30a9\u30eb\u30c8",children:"5.1 Lettuce\uff08Spring Boot \u30c7\u30d5\u30a9\u30eb\u30c8\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"spring:\n  redis:\n    host: localhost\n    port: 6379\n\n    lettuce:\n      pool:\n        max-active: 8      # \u6700\u5927\u63a5\u7d9a\u6570\n        max-idle: 8        # \u6700\u5927\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\n        min-idle: 0        # \u6700\u5c0f\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\n        max-wait: -1ms     # \u63a5\u7d9a\u53d6\u5f97\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff08-1\u306f\u7121\u9650\uff09\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@Configuration\npublic class RedisConfig {\n\n    @Bean\n    public LettuceConnectionFactory redisConnectionFactory() {\n        RedisStandaloneConfiguration config = new RedisStandaloneConfiguration();\n        config.setHostName("localhost");\n        config.setPort(6379);\n\n        // \u30d7\u30fc\u30eb\u8a2d\u5b9a\n        GenericObjectPoolConfig<Object> poolConfig = new GenericObjectPoolConfig<>();\n        poolConfig.setMaxTotal(20);\n        poolConfig.setMaxIdle(10);\n        poolConfig.setMinIdle(5);\n        poolConfig.setMaxWait(Duration.ofSeconds(10));\n\n        LettucePoolingClientConfiguration clientConfig =\n            LettucePoolingClientConfiguration.builder()\n                .poolConfig(poolConfig)\n                .commandTimeout(Duration.ofSeconds(5))\n                .build();\n\n        return new LettuceConnectionFactory(config, clientConfig);\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"52-jedis",children:"5.2 Jedis"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@Configuration\npublic class JedisConfig {\n\n    @Bean\n    public JedisPool jedisPool() {\n        JedisPoolConfig poolConfig = new JedisPoolConfig();\n        poolConfig.setMaxTotal(20);          // \u6700\u5927\u63a5\u7d9a\u6570\n        poolConfig.setMaxIdle(10);           // \u6700\u5927\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\n        poolConfig.setMinIdle(5);            // \u6700\u5c0f\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\n        poolConfig.setMaxWait(Duration.ofSeconds(10));  // \u53d6\u5f97\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n\n        // \u63a5\u7d9a\u691c\u8a3c\uff08\u501f\u7528\u6642\u306bPING\u3092\u9001\u4fe1\uff09\n        poolConfig.setTestOnBorrow(true);\n\n        return new JedisPool(poolConfig, "localhost", 6379);\n    }\n}\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"6-\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",children:"6. \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"}),"\n",(0,t.jsx)(e.h3,{id:"61-\u3088\u304f\u3042\u308b\u554f\u984c",children:"6.1 \u3088\u304f\u3042\u308b\u554f\u984c"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u306e\u30c8\u30e9\u30d6\u30eb                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010\u554f\u984c1: Connection pool exhausted\u3011                        \u2502\n\u2502                                                              \u2502\n\u2502  \u539f\u56e0:                                                       \u2502\n\u2502  - \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u304c\u5c0f\u3055\u3059\u304e\u308b                                 \u2502\n\u2502  - \u63a5\u7d9a\u304c\u8fd4\u5374\u3055\u308c\u3066\u3044\u306a\u3044\uff08\u30ea\u30fc\u30af\uff09                         \u2502\n\u2502  - \u30af\u30a8\u30ea\u304c\u9045\u3059\u304e\u308b                                         \u2502\n\u2502                                                              \u2502\n\u2502  \u78ba\u8a8d\u65b9\u6cd5\uff08HikariCP\uff09:                                       \u2502\n\u2502  - Active connections \u304c maximum-pool-size \u306b\u5f35\u308a\u4ed8\u304d       \u2502\n\u2502  - Pending threads \u304c\u5897\u52a0                                   \u2502\n\u2502                                                              \u2502\n\u2502  \u5bfe\u7b56:                                                       \u2502\n\u2502  - leak-detection-threshold \u3092\u8a2d\u5b9a                          \u2502\n\u2502  - \u30b9\u30ed\u30fc\u30af\u30a8\u30ea\u3092\u7279\u5b9a\u3057\u3066\u4fee\u6b63                               \u2502\n\u2502  - \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u3092\u5897\u3084\u3059\uff08\u6839\u672c\u89e3\u6c7a\u3067\u306f\u306a\u3044\uff09                 \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u554f\u984c2: Connection leak detected\u3011                         \u2502\n\u2502                                                              \u2502\n\u2502  \u539f\u56e0:                                                       \u2502\n\u2502  - try-with-resources \u3092\u4f7f\u3063\u3066\u3044\u306a\u3044                        \u2502\n\u2502  - \u4f8b\u5916\u767a\u751f\u6642\u306b\u63a5\u7d9a\u304c\u30af\u30ed\u30fc\u30ba\u3055\u308c\u3066\u3044\u306a\u3044                   \u2502\n\u2502                                                              \u2502\n\u2502  \u60aa\u3044\u4f8b:                                                     \u2502\n\u2502  Connection conn = dataSource.getConnection();               \u2502\n\u2502  // \u4f8b\u5916\u304c\u767a\u751f\u3059\u308b\u3068 conn \u304c\u30ea\u30fc\u30af\u3059\u308b                      \u2502\n\u2502  Statement stmt = conn.createStatement();                    \u2502\n\u2502  ResultSet rs = stmt.executeQuery("...");                   \u2502\n\u2502  conn.close();  // \u2190 \u3053\u3053\u306b\u5230\u9054\u3057\u306a\u3044\u53ef\u80fd\u6027                 \u2502\n\u2502                                                              \u2502\n\u2502  \u826f\u3044\u4f8b:                                                     \u2502\n\u2502  try (Connection conn = dataSource.getConnection();          \u2502\n\u2502       Statement stmt = conn.createStatement();               \u2502\n\u2502       ResultSet rs = stmt.executeQuery("...")) {            \u2502\n\u2502      // \u51e6\u7406                                                 \u2502\n\u2502  }  // \u2190 \u81ea\u52d5\u7684\u306b\u30af\u30ed\u30fc\u30ba                                   \u2502\n\u2502                                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u554f\u984c3: Connection is closed / Connection reset\u3011          \u2502\n\u2502                                                              \u2502\n\u2502  \u539f\u56e0:                                                       \u2502\n\u2502  - DB\u304c\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u3092\u5207\u65ad\u3057\u305f                               \u2502\n\u2502  - max-lifetime \u304c DB \u306e wait_timeout \u3088\u308a\u9577\u3044              \u2502\n\u2502  - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0d\u5b89\u5b9a                                       \u2502\n\u2502                                                              \u2502\n\u2502  \u5bfe\u7b56:                                                       \u2502\n\u2502  - max-lifetime < DB wait_timeout \u306b\u8a2d\u5b9a                    \u2502\n\u2502  - connection-test-query \u3092\u8a2d\u5b9a\uff08\u975e\u63a8\u5968\u3001JDBC4\u3067\u306f\u4e0d\u8981\uff09    \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,t.jsx)(e.h3,{id:"62-hikaricp-\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u8a2d\u5b9a",children:"6.2 HikariCP \u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u8a2d\u5b9a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# application.yml\nspring:\n  datasource:\n    hikari:\n      # \u30ea\u30fc\u30af\u691c\u51fa\uff08\u958b\u767a/\u30c6\u30b9\u30c8\u74b0\u5883\u3067\u6709\u52b9\u306b\uff09\n      leak-detection-threshold: 60000  # 60\u79d2\u4ee5\u4e0a\u501f\u7528\u3067\u30ed\u30b0\u51fa\u529b\n\n      # \u30e1\u30c8\u30ea\u30af\u30b9\n      register-mbeans: true  # JMX MBean\u767b\u9332\n\nlogging:\n  level:\n    com.zaxxer.hikari: DEBUG  # HikariCP\u306e\u30ed\u30b0\u3092\u8a73\u7d30\u306b\n"})}),"\n",(0,t.jsx)(e.h3,{id:"63-\u30e1\u30c8\u30ea\u30af\u30b9\u78ba\u8a8dspring-boot-actuator",children:"6.3 \u30e1\u30c8\u30ea\u30af\u30b9\u78ba\u8a8d\uff08Spring Boot Actuator\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# application.yml\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,metrics\n  endpoint:\n    health:\n      show-details: always\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u30a2\u30af\u30c6\u30a3\u30d6\u63a5\u7d9a\u6570\ncurl http://localhost:8080/actuator/metrics/hikaricp.connections.active\n\n# \u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\ncurl http://localhost:8080/actuator/metrics/hikaricp.connections.idle\n\n# \u5f85\u6a5f\u30b9\u30ec\u30c3\u30c9\u6570\ncurl http://localhost:8080/actuator/metrics/hikaricp.connections.pending\n\n# \u63a5\u7d9a\u53d6\u5f97\u6642\u9593\ncurl http://localhost:8080/actuator/metrics/hikaricp.connections.acquire\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"7-\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"7. \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,t.jsx)(e.h3,{id:"71-\u8a2d\u5b9a\u306e\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",children:"7.1 \u8a2d\u5b9a\u306e\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u8a2d\u5b9a\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u25a1 maximum-pool-size \u306f\u9069\u5207\u304b                               \u2502\n\u2502    - \u30a2\u30d7\u30ea\u5168\u53f0\u306e\u5408\u8a08 < DB max_connections                  \u2502\n\u2502    - HikariCP\u63a8\u5968: (core_count * 2) + spindle_count         \u2502\n\u2502                                                              \u2502\n\u2502  \u25a1 minimum-idle \u306f maximum-pool-size \u3068\u540c\u3058\u304b               \u2502\n\u2502    - HikariCP\u4f5c\u8005\u306e\u63a8\u5968                                     \u2502\n\u2502    - \u52d5\u7684\u30b5\u30a4\u30ba\u5909\u66f4\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u56de\u907f                     \u2502\n\u2502                                                              \u2502\n\u2502  \u25a1 max-lifetime \u306f DB wait_timeout \u3088\u308a\u77ed\u3044\u304b               \u2502\n\u2502    - MySQL: 28800\u79d2 (8\u6642\u9593)                                 \u2502\n\u2502    - PostgreSQL: \u7121\u5236\u9650\uff08\u8a2d\u5b9a\u304c\u5fc5\u8981\uff09                       \u2502\n\u2502    - \u63a8\u5968: wait_timeout - 30\u79d2                              \u2502\n\u2502                                                              \u2502\n\u2502  \u25a1 connection-timeout \u306f\u9069\u5207\u304b                              \u2502\n\u2502    - \u30c7\u30d5\u30a9\u30eb\u30c8 30\u79d2\u306f\u591a\u304f\u306e\u5834\u5408\u3067\u59a5\u5f53                      \u2502\n\u2502    - \u77ed\u3059\u304e\u308b\u3068\u9ad8\u8ca0\u8377\u6642\u306b\u30a8\u30e9\u30fc\u591a\u767a                         \u2502\n\u2502                                                              \u2502\n\u2502  \u25a1 leak-detection-threshold \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u304b               \u2502\n\u2502    - \u958b\u767a/\u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306f\u5fc5\u9808                                \u2502\n\u2502    - \u672c\u756a\u3067\u3082\u8a2d\u5b9a\u63a8\u5968\uff0860\u79d2\u301c\uff09                             \u2502\n\u2502                                                              \u2502\n\u2502  \u25a1 \u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53ce\u96c6\u3057\u3066\u3044\u308b\u304b                               \u2502\n\u2502    - Actuator + Prometheus/Grafana                          \u2502\n\u2502    - \u30a2\u30af\u30c6\u30a3\u30d6\u63a5\u7d9a\u6570\u3001\u5f85\u6a5f\u6570\u3092\u76e3\u8996                         \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"72-\u672c\u756a\u74b0\u5883\u3067\u306e\u8a2d\u5b9a\u4f8b",children:"7.2 \u672c\u756a\u74b0\u5883\u3067\u306e\u8a2d\u5b9a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# production application.yml\nspring:\n  datasource:\n    url: jdbc:postgresql://${DB_HOST}:5432/${DB_NAME}\n    username: ${DB_USERNAME}\n    password: ${DB_PASSWORD}\n\n    hikari:\n      pool-name: ProdPool\n\n      # \u30b5\u30a4\u30ba\uff084\u30b3\u30a2\u30b5\u30fc\u30d0\u30fc\u60f3\u5b9a\uff09\n      maximum-pool-size: 10\n      minimum-idle: 10\n\n      # \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n      connection-timeout: 30000\n      idle-timeout: 600000\n      max-lifetime: 1800000      # 30\u5206\uff08PostgreSQL wait_timeout\u672a\u8a2d\u5b9a\u306e\u5834\u5408\uff09\n\n      # \u30ea\u30fc\u30af\u691c\u51fa\n      leak-detection-threshold: 60000\n\n      # \u691c\u8a3c\n      validation-timeout: 5000\n\n      # JMX\n      register-mbeans: true\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"\u307e\u3068\u3081",children:"\u307e\u3068\u3081"}),"\n",(0,t.jsx)(e.h3,{id:"\u5b66\u3093\u3060\u3053\u3068",children:"\u5b66\u3093\u3060\u3053\u3068"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"TCP\u63a5\u7d9a\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3068\u30d7\u30fc\u30ea\u30f3\u30b0\u306b\u3088\u308b\u89e3\u6c7a"}),"\n",(0,t.jsx)(e.li,{children:"HikariCP\u306e\u8a2d\u5b9a\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u9069\u5207\u306a\u5024\u306e\u6c7a\u3081\u65b9"}),"\n",(0,t.jsx)(e.li,{children:"PgBouncer\u306b\u3088\u308b\u63a5\u7d9a\u96c6\u7d04"}),"\n",(0,t.jsx)(e.li,{children:"HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3001Redis\u306e\u30d7\u30fc\u30eb\u8a2d\u5b9a"}),"\n",(0,t.jsx)(e.li,{children:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u65b9\u6cd5"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8",children:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'1. \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306f\u5927\u304d\u3051\u308c\u3070\u826f\u3044\u308f\u3051\u3067\u306f\u306a\u3044\n   - DB\u306e max_connections \u3092\u8d85\u3048\u3066\u306f\u3044\u3051\u306a\u3044\n   - \u9069\u5207\u306a\u30b5\u30a4\u30ba\u306f (core_count * 2) + spindle_count\n\n2. \u63a5\u7d9a\u30ea\u30fc\u30af\u3092\u9632\u3050\n   - try-with-resources \u3092\u4f7f\u3046\n   - leak-detection-threshold \u3092\u8a2d\u5b9a\n\n3. max-lifetime \u306b\u6ce8\u610f\n   - DB\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3088\u308a\u77ed\u304f\u8a2d\u5b9a\n   - \u305d\u3046\u3057\u306a\u3044\u3068 "Connection is closed" \u30a8\u30e9\u30fc\n\n4. \u30e1\u30c8\u30ea\u30af\u30b9\u3067\u76e3\u8996\n   - \u30a2\u30af\u30c6\u30a3\u30d6\u63a5\u7d9a\u6570\u3001\u5f85\u6a5f\u6570\u3092\u76e3\u8996\n   - \u554f\u984c\u3092\u65e9\u671f\u767a\u898b\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/tcp-fundamentals",children:"09-tcp-fundamentals.md"})," - TCP\u57fa\u790e\uff08TIME_WAIT\u7b49\uff09"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/web-server-architecture",children:"10-web-server-architecture.md"})," - Web\u30b5\u30fc\u30d0\u30fc\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"\u53c2\u8003\u30ea\u30f3\u30af",children:"\u53c2\u8003\u30ea\u30f3\u30af"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/brettwooldridge/HikariCP",children:"HikariCP GitHub"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing",children:"About Pool Sizing (HikariCP Wiki)"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://www.pgbouncer.org/config.html",children:"PgBouncer Documentation"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/data.html#data.sql.datasource.connection-pool",children:"Spring Boot - Connection Pooling"})}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>c});var o=i(96540);const t={},l=o.createContext(t);function r(n){const e=o.useContext(l);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),o.createElement(l.Provider,{value:e},n.children)}}}]);