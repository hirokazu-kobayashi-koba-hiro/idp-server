"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[2753],{88327:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"content_10_ai_developer/ai-52-notification-apns","title":"idp-server-notification-apns-adapter","description":"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981","source":"@site/docs/content_10_ai_developer/ai-52-notification-apns.md","sourceDirName":"content_10_ai_developer","slug":"/content_10_ai_developer/ai-52-notification-apns","permalink":"/idp-server/docs/content_10_ai_developer/ai-52-notification-apns","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_10_ai_developer/ai-52-notification-apns.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"idp-server-notification-fcm-adapter","permalink":"/idp-server/docs/content_10_ai_developer/ai-51-notification-fcm"},"next":{"title":"idp-server-email-aws-adapter","permalink":"/idp-server/docs/content_10_ai_developer/ai-53-email-aws"}}');var r=i(74848),s=i(28453);const a={},o="idp-server-notification-apns-adapter",c={},l=[{value:"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981",id:"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981",level:2},{value:"\u8cac\u52d9",id:"\u8cac\u52d9",level:3},{value:"\u4e3b\u8981\u6a5f\u80fd",id:"\u4e3b\u8981\u6a5f\u80fd",level:3},{value:"\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3",id:"\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3",level:2},{value:"\u91cd\u8981\u30dd\u30a4\u30f3\u30c8",id:"\u91cd\u8981\u30dd\u30a4\u30f3\u30c8",level:2},{value:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"idp-server-notification-apns-adapter",children:"idp-server-notification-apns-adapter"})}),"\n",(0,r.jsx)(e.h2,{id:"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981",children:"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,r.jsx)(e.code,{children:"libs/idp-server-notification-apns-adapter/"}),"\n",(0,r.jsx)(e.strong,{children:"\u78ba\u8a8d\u65e5"}),": 2025-10-12"]}),"\n",(0,r.jsx)(e.h3,{id:"\u8cac\u52d9",children:"\u8cac\u52d9"}),"\n",(0,r.jsx)(e.p,{children:"Apple Push Notification Service (APNS) \u306b\u3088\u308b\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u4e3b\u8981\u6a5f\u80fd",children:"\u4e3b\u8981\u6a5f\u80fd"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"iOS/macOS"})," \u30d7\u30c3\u30b7\u30e5\u901a\u77e5"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Badge/Sound/Alert"})," \u8a2d\u5b9a"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Silent Notification"}),": \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u66f4\u65b0"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Token Authentication"}),": JWT\u8a8d\u8a3c"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3",children:"\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,r.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(7988).A+"#L42-L134",children:"ApnsNotifier.java:42-134"})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'/**\n * APNS\u901a\u77e5\u5b9f\u88c5\n * \u78ba\u8a8d\u65b9\u6cd5: \u5b9f\u30d5\u30a1\u30a4\u30eb\u306e42-134\u884c\u76ee\n */\npublic class ApnsNotifier implements AuthenticationDeviceNotifier {\n\n  LoggerWrapper log = LoggerWrapper.getLogger(ApnsNotifier.class);\n  JsonConverter jsonConverter = JsonConverter.snakeCaseInstance();\n  Map<String, JwtTokenCache> jwtTokenCache = new ConcurrentHashMap<>();  // \u2705 JWT\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u30ad\u30e3\u30c3\u30b7\u30e5\n  HttpClient httpClient = HttpClient.newBuilder().version(HttpClient.Version.HTTP_2).build();\n\n  private static final String PRODUCTION_URL = "https://api.push.apple.com";\n  private static final String DEVELOPMENT_URL = "https://api.sandbox.push.apple.com";\n\n  @Override\n  public NotificationChannel chanel() {\n    return new NotificationChannel("apns");\n  }\n\n  @Override\n  public NotificationResult notify(\n      Tenant tenant,\n      AuthenticationDevice device,\n      AuthenticationExecutionConfig configuration) {\n\n    // 1. APNS\u8a2d\u5b9a\u53d6\u5f97\n    ApnsConfiguration apnsConfiguration =\n        jsonConverter.read(configuration.details().get("apns"), ApnsConfiguration.class);\n\n    // 2. JWT\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u53d6\u5f97\uff08\u30ad\u30e3\u30c3\u30b7\u30e5\u30011\u6642\u9593\u6709\u52b9\uff09\n    String jwtToken = getOrCreateJwtToken(tenant, apnsConfiguration);\n\n    // 3. \u901a\u77e5\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u53d6\u5f97\n    NotificationTemplate template = apnsConfiguration.findTemplate("default");\n    String notificationToken = device.notificationToken().value();\n\n    // 4. APNs\u30da\u30a4\u30ed\u30fc\u30c9\u69cb\u7bc9\uff08JSON\uff09\n    String payload = createApnsPayload(template, tenant);\n\n    // 5. HTTP/2\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\n    String apnsUrl = (apnsConfiguration.isProduction() ? PRODUCTION_URL : DEVELOPMENT_URL)\n        + "/3/device/" + notificationToken;\n\n    HttpRequest request =\n        HttpRequest.newBuilder()\n            .uri(URI.create(apnsUrl))\n            .header("Authorization", "bearer " + jwtToken)\n            .header("apns-topic", apnsConfiguration.bundleId())\n            .header("apns-priority", "10")\n            .header("apns-push-type", "alert")\n            .header("Content-Type", "application/json")\n            .POST(HttpRequest.BodyPublishers.ofString(payload))\n            .build();\n\n    HttpResponse<String> response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());\n\n    if (response.statusCode() == 200) {\n      return NotificationResult.success("apns", Map.of("status", "sent"));\n    } else {\n      return NotificationResult.failure("apns", "APNs returned: " + response.statusCode());\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u91cd\u8981\u30dd\u30a4\u30f3\u30c8",children:"\u91cd\u8981\u30dd\u30a4\u30f3\u30c8"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u2705 Java\u6a19\u6e96",(0,r.jsx)(e.code,{children:"HttpClient"}),"\uff08HTTP/2\u5bfe\u5fdc\uff09\u3067APNs\u76f4\u63a5\u901a\u4fe1"]}),"\n",(0,r.jsx)(e.li,{children:"\u2705 JWT\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u306e\u751f\u6210\u30fb\u30ad\u30e3\u30c3\u30b7\u30e5\uff081\u6642\u9593\u6709\u52b9\uff09"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 Production/Development\u74b0\u5883\u5207\u308a\u66ff\u3048"}),"\n",(0,r.jsxs)(e.li,{children:["\u2705 ",(0,r.jsx)(e.code,{children:"NotificationTemplate"}),"\u306b\u3088\u308b\u8a2d\u5b9a\u99c6\u52d5"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"/idp-server/docs/content_10_ai_developer/ai-50-notification-security-event",children:"\u901a\u77e5\u30fb\u30a4\u30d9\u30f3\u30c8\u5c64\u7d71\u5408\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"})," - APNS\u3092\u542b\u3080\u5168\u901a\u77e5\u30e2\u30b8\u30e5\u30fc\u30eb"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"/idp-server/docs/content_10_ai_developer/ai-51-notification-fcm",children:"idp-server-notification-fcm-adapter"})," - Firebase Cloud Messaging"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"/idp-server/docs/content_10_ai_developer/ai-53-email-aws",children:"idp-server-email-aws-adapter"})," - \u30e1\u30fc\u30eb\u9001\u4fe1"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u60c5\u5831\u6e90"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"libs/idp-server-notification-apns-adapter/"}),"\u914d\u4e0b\u306e\u5b9f\u88c5\u30b3\u30fc\u30c9"]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(7988).A+"",children:"ApnsNotifier.java"})}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u6700\u7d42\u66f4\u65b0"}),": 2025-10-12"]})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},7988:(n,e,i)=>{i.d(e,{A:()=>t});const t=i.p+"assets/files/ApnsNotifier-3f2a890421f42bcd692af1b4996298f7.java"},28453:(n,e,i)=>{i.d(e,{R:()=>a,x:()=>o});var t=i(96540);const r={},s=t.createContext(r);function a(n){const e=t.useContext(s);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:a(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);