"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[77733],{83402:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"content_11_learning/linux/iptables-firewall","title":"iptables \u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb","description":"Linux\u306e\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001iptables\u3001nftables\u306e\u57fa\u790e\u3092\u5b66\u3073\u307e\u3059\u3002","source":"@site/docs/content_11_learning/14-linux/iptables-firewall.md","sourceDirName":"content_11_learning/14-linux","slug":"/content_11_learning/linux/iptables-firewall","permalink":"/idp-server/docs/content_11_learning/linux/iptables-firewall","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/14-linux/iptables-firewall.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"SSH","permalink":"/idp-server/docs/content_11_learning/linux/ssh"},"next":{"title":"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","permalink":"/idp-server/docs/content_11_learning/linux/network-troubleshooting"}}');var i=l(74848),t=l(28453);const d={},r="iptables \u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb",c={},a=[{value:"\u76ee\u6b21",id:"\u76ee\u6b21",level:2},{value:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u306f",id:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u306f",level:2},{value:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u5f79\u5272",id:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u5f79\u5272",level:3},{value:"Linux\u306e\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u6b74\u53f2",id:"linux\u306e\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u6b74\u53f2",level:3},{value:"\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30c4\u30fc\u30eb",id:"\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30c4\u30fc\u30eb",level:3},{value:"iptables\u306e\u57fa\u672c",id:"iptables\u306e\u57fa\u672c",level:2},{value:"iptables\u306e\u78ba\u8a8d",id:"iptables\u306e\u78ba\u8a8d",level:3},{value:"\u30d1\u30b1\u30c3\u30c8\u306e\u6d41\u308c",id:"\u30d1\u30b1\u30c3\u30c8\u306e\u6d41\u308c",level:3},{value:"\u30c1\u30a7\u30fc\u30f3\u3068\u30c6\u30fc\u30d6\u30eb",id:"\u30c1\u30a7\u30fc\u30f3\u3068\u30c6\u30fc\u30d6\u30eb",level:2},{value:"\u4e3b\u306a\u30c1\u30a7\u30fc\u30f3",id:"\u4e3b\u306a\u30c1\u30a7\u30fc\u30f3",level:3},{value:"\u4e3b\u306a\u30c6\u30fc\u30d6\u30eb",id:"\u4e3b\u306a\u30c6\u30fc\u30d6\u30eb",level:3},{value:"\u30bf\u30fc\u30b2\u30c3\u30c8\uff08\u30a2\u30af\u30b7\u30e7\u30f3\uff09",id:"\u30bf\u30fc\u30b2\u30c3\u30c8\u30a2\u30af\u30b7\u30e7\u30f3",level:3},{value:"\u30eb\u30fc\u30eb\u306e\u66f8\u304d\u65b9",id:"\u30eb\u30fc\u30eb\u306e\u66f8\u304d\u65b9",level:2},{value:"\u57fa\u672c\u69cb\u6587",id:"\u57fa\u672c\u69cb\u6587",level:3},{value:"\u3088\u304f\u4f7f\u3046\u30b3\u30de\u30f3\u30c9",id:"\u3088\u304f\u4f7f\u3046\u30b3\u30de\u30f3\u30c9",level:3},{value:"\u30de\u30c3\u30c1\u30f3\u30b0\u6761\u4ef6",id:"\u30de\u30c3\u30c1\u30f3\u30b0\u6761\u4ef6",level:3},{value:"\u5b9f\u4f8b",id:"\u5b9f\u4f8b",level:3},{value:"\u5b9f\u8df5\u7684\u306a\u8a2d\u5b9a\u4f8b",id:"\u5b9f\u8df5\u7684\u306a\u8a2d\u5b9a\u4f8b",level:2},{value:"\u57fa\u672c\u7684\u306a\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a",id:"\u57fa\u672c\u7684\u306a\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a",level:3},{value:"NAT\u8a2d\u5b9a\uff08\u30eb\u30fc\u30bf\u30fc\uff09",id:"nat\u8a2d\u5b9a\u30eb\u30fc\u30bf\u30fc",level:3},{value:"\u30eb\u30fc\u30eb\u306e\u6c38\u7d9a\u5316",id:"\u30eb\u30fc\u30eb\u306e\u6c38\u7d9a\u5316",level:3},{value:"nftables",id:"nftables",level:2},{value:"nftables\u3068\u306f",id:"nftables\u3068\u306f",level:3},{value:"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9",id:"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9",level:3},{value:"nftables\u8a2d\u5b9a\u4f8b",id:"nftables\u8a2d\u5b9a\u4f8b",level:3},{value:"\u30b3\u30f3\u30c6\u30ca\u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb",id:"\u30b3\u30f3\u30c6\u30ca\u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb",level:2},{value:"Docker\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af",id:"docker\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af",level:3},{value:"Docker \u306e\u30dd\u30fc\u30c8\u516c\u958b",id:"docker-\u306e\u30dd\u30fc\u30c8\u516c\u958b",level:3},{value:"DOCKER-USER \u30c1\u30a7\u30fc\u30f3",id:"docker-user-\u30c1\u30a7\u30fc\u30f3",level:3},{value:"Kubernetes \u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30ea\u30b7\u30fc",id:"kubernetes-\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30ea\u30b7\u30fc",level:3},{value:"\u307e\u3068\u3081",id:"\u307e\u3068\u3081",level:2},{value:"\u91cd\u8981\u306a\u30b3\u30de\u30f3\u30c9",id:"\u91cd\u8981\u306a\u30b3\u30de\u30f3\u30c9",level:3},{value:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:3},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:3},{value:"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9",id:"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9",level:2}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"iptables-\u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb",children:"iptables \u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb"})}),"\n",(0,i.jsx)(e.p,{children:"Linux\u306e\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001iptables\u3001nftables\u306e\u57fa\u790e\u3092\u5b66\u3073\u307e\u3059\u3002"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u76ee\u6b21",children:"\u76ee\u6b21"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"#%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB%E3%81%A8%E3%81%AF",children:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u306f"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"#iptables%E3%81%AE%E5%9F%BA%E6%9C%AC",children:"iptables\u306e\u57fa\u672c"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"#%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3%E3%81%A8%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB",children:"\u30c1\u30a7\u30fc\u30f3\u3068\u30c6\u30fc\u30d6\u30eb"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"#%E3%83%AB%E3%83%BC%E3%83%AB%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9",children:"\u30eb\u30fc\u30eb\u306e\u66f8\u304d\u65b9"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"#%E5%AE%9F%E8%B7%B5%E7%9A%84%E3%81%AA%E8%A8%AD%E5%AE%9A%E4%BE%8B",children:"\u5b9f\u8df5\u7684\u306a\u8a2d\u5b9a\u4f8b"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"#nftables",children:"nftables"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%A8%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB",children:"\u30b3\u30f3\u30c6\u30ca\u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb"})}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u306f",children:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u306f"}),"\n",(0,i.jsx)(e.h3,{id:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u5f79\u5272",children:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u5f79\u5272"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u6982\u5ff5                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8                                              \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u25bc                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502              \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb                         \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502   \u2502\n\u2502  \u2502  \u2502  \u30eb\u30fc\u30eb:                                       \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502  \u2713 \u30dd\u30fc\u30c8 80, 443 \u2192 \u8a31\u53ef\uff08Web\u30b5\u30fc\u30d0\u30fc\uff09       \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502  \u2713 \u30dd\u30fc\u30c8 22 (\u7279\u5b9aIP) \u2192 \u8a31\u53ef\uff08SSH\uff09           \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502  \u2717 \u305d\u306e\u4ed6\u3059\u3079\u3066 \u2192 \u62d2\u5426                        \u2502 \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u25bc                                                      \u2502\n\u2502  \u30b5\u30fc\u30d0\u30fc\uff08\u4fdd\u8b77\u3055\u308c\u308b\uff09                                       \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(e.h3,{id:"linux\u306e\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u6b74\u53f2",children:"Linux\u306e\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u6b74\u53f2"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u30c4\u30fc\u30eb"}),(0,i.jsx)(e.th,{children:"\u8aac\u660e"}),(0,i.jsx)(e.th,{children:"\u72b6\u614b"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ipfwadm"}),(0,i.jsx)(e.td,{children:"\u6700\u521d\u306e\u30c4\u30fc\u30eb"}),(0,i.jsx)(e.td,{children:"\u5ec3\u6b62"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ipchains"}),(0,i.jsx)(e.td,{children:"Linux 2.2"}),(0,i.jsx)(e.td,{children:"\u5ec3\u6b62"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"iptables"}),(0,i.jsx)(e.td,{children:"Linux 2.4+"}),(0,i.jsx)(e.td,{children:"\u73fe\u5f79\uff08\u5e83\u304f\u4f7f\u7528\uff09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"nftables"}),(0,i.jsx)(e.td,{children:"Linux 3.13+"}),(0,i.jsx)(e.td,{children:"\u73fe\u5f79\uff08\u65b0\u3057\u3044\uff09"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30c4\u30fc\u30eb",children:"\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30c4\u30fc\u30eb"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u5225\n# Ubuntu: ufw\uff08Uncomplicated Firewall\uff09\nsudo ufw enable\nsudo ufw allow 22/tcp\n\n# RHEL/CentOS: firewalld\nsudo firewall-cmd --add-port=22/tcp --permanent\nsudo firewall-cmd --reload\n\n# \u3053\u308c\u3089\u306f\u5185\u90e8\u3067 iptables/nftables \u3092\u64cd\u4f5c\u3057\u3066\u3044\u307e\u3059\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"iptables\u306e\u57fa\u672c",children:"iptables\u306e\u57fa\u672c"}),"\n",(0,i.jsx)(e.h3,{id:"iptables\u306e\u78ba\u8a8d",children:"iptables\u306e\u78ba\u8a8d"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u73fe\u5728\u306e\u30eb\u30fc\u30eb\u3092\u8868\u793a\nsudo iptables -L\nsudo iptables -L -n -v    # \u8a73\u7d30\u8868\u793a\uff08\u6570\u5024\u8868\u793a\uff09\n\n# \u51fa\u529b\u4f8b\n# Chain INPUT (policy ACCEPT)\n# target     prot opt source               destination\n# ACCEPT     tcp  --  0.0.0.0/0           0.0.0.0/0           tcp dpt:22\n\n# Chain FORWARD (policy ACCEPT)\n# ...\n\n# Chain OUTPUT (policy ACCEPT)\n# ...\n\n# NAT\u30c6\u30fc\u30d6\u30eb\nsudo iptables -t nat -L -n -v\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u30d1\u30b1\u30c3\u30c8\u306e\u6d41\u308c",children:"\u30d1\u30b1\u30c3\u30c8\u306e\u6d41\u308c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   \u30d1\u30b1\u30c3\u30c8\u306e\u6d41\u308c                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u5916\u90e8\u304b\u3089\u306e\u30d1\u30b1\u30c3\u30c8                                          \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u25bc                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                               \u2502\n\u2502  \u2502PREROUTING\u2502\u2500\u2500\u2500\u2500\u25ba\u2502\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u2502                             \u2502\n\u2502  \u2502 (NAT)   \u2502     \u2502  \u5224\u65ad    \u2502                               \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                               \u2502\n\u2502                       \u2502                                     \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502         \u25bc             \u2502             \u25bc                       \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502    \u2502  INPUT  \u2502        \u2502       \u2502 FORWARD \u2502                  \u2502\n\u2502    \u2502(\u30d5\u30a3\u30eb\u30bf)\u2502        \u2502       \u2502(\u30d5\u30a3\u30eb\u30bf)\u2502                  \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518        \u2502       \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502         \u2502             \u2502            \u2502                       \u2502\n\u2502         \u25bc             \u2502            \u25bc                       \u2502\n\u2502    \u30ed\u30fc\u30ab\u30eb\u30d7\u30ed\u30bb\u30b9    \u2502       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502         \u2502             \u2502       \u2502POSTROUTING\u2502                 \u2502\n\u2502         \u2502             \u2502       \u2502  (NAT)   \u2502                  \u2502\n\u2502         \u25bc             \u2502       \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502            \u2502                       \u2502\n\u2502    \u2502 OUTPUT  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502                       \u2502\n\u2502    \u2502(\u30d5\u30a3\u30eb\u30bf)\u2502                     \u2502                       \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                     \u2502                       \u2502\n\u2502         \u2502                          \u2502                       \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                     \u2502                                       \u2502\n\u2502                     \u25bc                                       \u2502\n\u2502                 \u5916\u90e8\u3078\u9001\u4fe1                                   \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u30c1\u30a7\u30fc\u30f3\u3068\u30c6\u30fc\u30d6\u30eb",children:"\u30c1\u30a7\u30fc\u30f3\u3068\u30c6\u30fc\u30d6\u30eb"}),"\n",(0,i.jsx)(e.h3,{id:"\u4e3b\u306a\u30c1\u30a7\u30fc\u30f3",children:"\u4e3b\u306a\u30c1\u30a7\u30fc\u30f3"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u30c1\u30a7\u30fc\u30f3"}),(0,i.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"INPUT"}),(0,i.jsx)(e.td,{children:"\u30ed\u30fc\u30ab\u30eb\u30d7\u30ed\u30bb\u30b9\u5b9b\u3066\u306e\u30d1\u30b1\u30c3\u30c8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"OUTPUT"}),(0,i.jsx)(e.td,{children:"\u30ed\u30fc\u30ab\u30eb\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u306e\u30d1\u30b1\u30c3\u30c8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"FORWARD"}),(0,i.jsx)(e.td,{children:"\u8ee2\u9001\u3055\u308c\u308b\u30d1\u30b1\u30c3\u30c8\uff08\u30eb\u30fc\u30bf\u30fc\u3068\u3057\u3066\u52d5\u4f5c\u6642\uff09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"PREROUTING"}),(0,i.jsx)(e.td,{children:"\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u524d\u306e\u51e6\u7406\uff08DNAT\uff09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"POSTROUTING"}),(0,i.jsx)(e.td,{children:"\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5f8c\u306e\u51e6\u7406\uff08SNAT/MASQUERADE\uff09"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"\u4e3b\u306a\u30c6\u30fc\u30d6\u30eb",children:"\u4e3b\u306a\u30c6\u30fc\u30d6\u30eb"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u30c6\u30fc\u30d6\u30eb"}),(0,i.jsx)(e.th,{children:"\u7528\u9014"}),(0,i.jsx)(e.th,{children:"\u4f7f\u7528\u53ef\u80fd\u306a\u30c1\u30a7\u30fc\u30f3"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"filter"}),(0,i.jsx)(e.td,{children:"\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09"}),(0,i.jsx)(e.td,{children:"INPUT, OUTPUT, FORWARD"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"nat"}),(0,i.jsx)(e.td,{children:"\u30a2\u30c9\u30ec\u30b9\u5909\u63db"}),(0,i.jsx)(e.td,{children:"PREROUTING, POSTROUTING, OUTPUT"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"mangle"}),(0,i.jsx)(e.td,{children:"\u30d1\u30b1\u30c3\u30c8\u52a0\u5de5"}),(0,i.jsx)(e.td,{children:"\u5168\u30c1\u30a7\u30fc\u30f3"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"raw"}),(0,i.jsx)(e.td,{children:"\u63a5\u7d9a\u8ffd\u8de1\u306e\u9664\u5916"}),(0,i.jsx)(e.td,{children:"PREROUTING, OUTPUT"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"\u30bf\u30fc\u30b2\u30c3\u30c8\u30a2\u30af\u30b7\u30e7\u30f3",children:"\u30bf\u30fc\u30b2\u30c3\u30c8\uff08\u30a2\u30af\u30b7\u30e7\u30f3\uff09"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u30bf\u30fc\u30b2\u30c3\u30c8"}),(0,i.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ACCEPT"}),(0,i.jsx)(e.td,{children:"\u30d1\u30b1\u30c3\u30c8\u3092\u8a31\u53ef"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"DROP"}),(0,i.jsx)(e.td,{children:"\u30d1\u30b1\u30c3\u30c8\u3092\u7834\u68c4\uff08\u5fdc\u7b54\u306a\u3057\uff09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"REJECT"}),(0,i.jsx)(e.td,{children:"\u30d1\u30b1\u30c3\u30c8\u3092\u62d2\u5426\uff08\u30a8\u30e9\u30fc\u5fdc\u7b54\uff09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"LOG"}),(0,i.jsx)(e.td,{children:"\u30ed\u30b0\u306b\u8a18\u9332"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"SNAT"}),(0,i.jsx)(e.td,{children:"\u9001\u4fe1\u5143\u30a2\u30c9\u30ec\u30b9\u5909\u63db"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"DNAT"}),(0,i.jsx)(e.td,{children:"\u5b9b\u5148\u30a2\u30c9\u30ec\u30b9\u5909\u63db"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"MASQUERADE"}),(0,i.jsx)(e.td,{children:"\u52d5\u7684SNAT"})]})]})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u30eb\u30fc\u30eb\u306e\u66f8\u304d\u65b9",children:"\u30eb\u30fc\u30eb\u306e\u66f8\u304d\u65b9"}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u672c\u69cb\u6587",children:"\u57fa\u672c\u69cb\u6587"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"iptables [-t table] COMMAND chain rule-specification [target]\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u3088\u304f\u4f7f\u3046\u30b3\u30de\u30f3\u30c9",children:"\u3088\u304f\u4f7f\u3046\u30b3\u30de\u30f3\u30c9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u30eb\u30fc\u30eb\u8ffd\u52a0\n-A  # Append\uff08\u672b\u5c3e\u306b\u8ffd\u52a0\uff09\n-I  # Insert\uff08\u5148\u982d\u307e\u305f\u306f\u6307\u5b9a\u4f4d\u7f6e\u306b\u633f\u5165\uff09\n\n# \u30eb\u30fc\u30eb\u524a\u9664\n-D  # Delete\uff08\u524a\u9664\uff09\n-F  # Flush\uff08\u5168\u524a\u9664\uff09\n\n# \u30c1\u30a7\u30fc\u30f3\u64cd\u4f5c\n-N  # \u65b0\u898f\u30c1\u30a7\u30fc\u30f3\u4f5c\u6210\n-X  # \u30c1\u30a7\u30fc\u30f3\u524a\u9664\n-P  # \u30c7\u30d5\u30a9\u30eb\u30c8\u30dd\u30ea\u30b7\u30fc\u8a2d\u5b9a\n\n# \u78ba\u8a8d\n-L  # List\uff08\u4e00\u89a7\u8868\u793a\uff09\n-S  # \u8a2d\u5b9a\u30b3\u30de\u30f3\u30c9\u5f62\u5f0f\u3067\u8868\u793a\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u30de\u30c3\u30c1\u30f3\u30b0\u6761\u4ef6",children:"\u30de\u30c3\u30c1\u30f3\u30b0\u6761\u4ef6"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u30d7\u30ed\u30c8\u30b3\u30eb\n-p tcp\n-p udp\n-p icmp\n\n# \u30dd\u30fc\u30c8\n--dport 80        # \u5b9b\u5148\u30dd\u30fc\u30c8\n--sport 1024:     # \u9001\u4fe1\u5143\u30dd\u30fc\u30c8\uff081024\u4ee5\u4e0a\uff09\n-m multiport --dports 80,443  # \u8907\u6570\u30dd\u30fc\u30c8\n\n# IP\u30a2\u30c9\u30ec\u30b9\n-s 192.168.1.0/24  # \u9001\u4fe1\u5143\n-d 10.0.0.1        # \u5b9b\u5148\n\n# \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n-i eth0            # \u5165\u529b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n-o eth0            # \u51fa\u529b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n\n# \u72b6\u614b\uff08\u63a5\u7d9a\u8ffd\u8de1\uff09\n-m state --state NEW,ESTABLISHED,RELATED\n-m conntrack --ctstate NEW,ESTABLISHED\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u5b9f\u4f8b",children:"\u5b9f\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# SSH\uff08\u30dd\u30fc\u30c822\uff09\u3092\u8a31\u53ef\nsudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT\n\n# \u7279\u5b9aIP\u304b\u3089\u306e\u307fSSH\u3092\u8a31\u53ef\nsudo iptables -A INPUT -p tcp -s 192.168.1.100 --dport 22 -j ACCEPT\n\n# HTTP/HTTPS\u3092\u8a31\u53ef\nsudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT\nsudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT\n\n# \u78ba\u7acb\u6e08\u307f\u63a5\u7d9a\u3092\u8a31\u53ef\nsudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u3092\u8a31\u53ef\nsudo iptables -A INPUT -i lo -j ACCEPT\n\n# \u305d\u306e\u4ed6\u3092\u3059\u3079\u3066\u62d2\u5426\nsudo iptables -A INPUT -j DROP\n\n# \u30eb\u30fc\u30eb\u524a\u9664\uff08\u756a\u53f7\u6307\u5b9a\uff09\nsudo iptables -L INPUT --line-numbers\nsudo iptables -D INPUT 3\n\n# \u5168\u30eb\u30fc\u30eb\u30af\u30ea\u30a2\nsudo iptables -F\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u5b9f\u8df5\u7684\u306a\u8a2d\u5b9a\u4f8b",children:"\u5b9f\u8df5\u7684\u306a\u8a2d\u5b9a\u4f8b"}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u672c\u7684\u306a\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a",children:"\u57fa\u672c\u7684\u306a\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# \u57fa\u672c\u7684\u306aWeb\u30b5\u30fc\u30d0\u30fc\u306e\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u8a2d\u5b9a\n\n# \u65e2\u5b58\u30eb\u30fc\u30eb\u3092\u30af\u30ea\u30a2\niptables -F\niptables -X\n\n# \u30c7\u30d5\u30a9\u30eb\u30c8\u30dd\u30ea\u30b7\u30fc\niptables -P INPUT DROP\niptables -P FORWARD DROP\niptables -P OUTPUT ACCEPT\n\n# \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u8a31\u53ef\niptables -A INPUT -i lo -j ACCEPT\n\n# \u78ba\u7acb\u6e08\u307f\u63a5\u7d9a\u8a31\u53ef\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# SSH\uff08\u7ba1\u7406\u7528\u3001\u7279\u5b9aIP\u306e\u307f\uff09\niptables -A INPUT -p tcp -s 10.0.0.0/8 --dport 22 -j ACCEPT\n\n# HTTP/HTTPS\niptables -A INPUT -p tcp --dport 80 -j ACCEPT\niptables -A INPUT -p tcp --dport 443 -j ACCEPT\n\n# ICMP\uff08ping\uff09\niptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT\n\n# \u30ed\u30b0\uff08\u30c7\u30d0\u30c3\u30b0\u7528\uff09\niptables -A INPUT -j LOG --log-prefix "IPTables-Dropped: "\n'})}),"\n",(0,i.jsx)(e.h3,{id:"nat\u8a2d\u5b9a\u30eb\u30fc\u30bf\u30fc",children:"NAT\u8a2d\u5b9a\uff08\u30eb\u30fc\u30bf\u30fc\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# IP\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u6709\u52b9\u5316\necho 1 > /proc/sys/net/ipv4/ip_forward\n\n# SNAT\uff08\u9001\u4fe1\u5143NAT\uff09- \u5185\u90e8\u2192\u5916\u90e8\niptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\n\n# DNAT\uff08\u5b9b\u5148NAT\uff09- \u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\n# \u5916\u90e880\u756a \u2192 \u5185\u90e8\u30b5\u30fc\u30d0\u30fc192.168.1.10:8080\niptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 \\\n  -j DNAT --to-destination 192.168.1.10:8080\n\n# FORWARD\u30c1\u30a7\u30fc\u30f3\u306e\u8a31\u53ef\niptables -A FORWARD -i eth1 -o eth0 -j ACCEPT\niptables -A FORWARD -i eth0 -o eth1 -m state --state ESTABLISHED,RELATED -j ACCEPT\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u30eb\u30fc\u30eb\u306e\u6c38\u7d9a\u5316",children:"\u30eb\u30fc\u30eb\u306e\u6c38\u7d9a\u5316"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Debian/Ubuntu\nsudo apt install iptables-persistent\nsudo netfilter-persistent save\nsudo netfilter-persistent reload\n\n# \u307e\u305f\u306f\nsudo iptables-save > /etc/iptables/rules.v4\nsudo iptables-restore < /etc/iptables/rules.v4\n\n# RHEL/CentOS\nsudo service iptables save\n# /etc/sysconfig/iptables \u306b\u4fdd\u5b58\u3055\u308c\u308b\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"nftables",children:"nftables"}),"\n",(0,i.jsx)(e.h3,{id:"nftables\u3068\u306f",children:"nftables\u3068\u306f"}),"\n",(0,i.jsx)(e.p,{children:"iptables\u306e\u5f8c\u7d99\u3068\u3057\u3066\u958b\u767a\u3055\u308c\u305f\u3001\u3088\u308a\u52b9\u7387\u7684\u3067\u67d4\u8edf\u306a\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3059\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   iptables vs nftables                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  iptables:                                                   \u2502\n\u2502  \u30fb\u8907\u6570\u306e\u30c4\u30fc\u30eb\uff08iptables, ip6tables, arptables...\uff09        \u2502\n\u2502  \u30fb\u30eb\u30fc\u30eb\u3054\u3068\u306b\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u547c\u3073\u51fa\u3057                     \u2502\n\u2502  \u30fb\u5927\u91cf\u30eb\u30fc\u30eb\u3067\u6027\u80fd\u4f4e\u4e0b                                      \u2502\n\u2502                                                              \u2502\n\u2502  nftables:                                                   \u2502\n\u2502  \u30fb\u5358\u4e00\u306e\u30c4\u30fc\u30eb\uff08nft\uff09                                       \u2502\n\u2502  \u30fb\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u3088\u308b\u52b9\u7387\u7684\u306a\u51e6\u7406                              \u2502\n\u2502  \u30fb\u30bb\u30c3\u30c8\u3001\u30de\u30c3\u30d7\u306b\u3088\u308b\u9ad8\u901f\u30de\u30c3\u30c1\u30f3\u30b0                        \u2502\n\u2502  \u30fb\u3088\u308a\u8aad\u307f\u3084\u3059\u3044\u69cb\u6587                                        \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9",children:"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u30eb\u30fc\u30eb\u8868\u793a\nsudo nft list ruleset\n\n# \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\nsudo nft add table inet filter\n\n# \u30c1\u30a7\u30fc\u30f3\u4f5c\u6210\nsudo nft add chain inet filter input { type filter hook input priority 0 \\; policy drop \\; }\n\n# \u30eb\u30fc\u30eb\u8ffd\u52a0\nsudo nft add rule inet filter input tcp dport 22 accept\nsudo nft add rule inet filter input tcp dport { 80, 443 } accept\n\n# \u30eb\u30fc\u30eb\u524a\u9664\nsudo nft delete rule inet filter input handle 5\n\n# \u8a2d\u5b9a\u4fdd\u5b58\nsudo nft list ruleset > /etc/nftables.conf\n"})}),"\n",(0,i.jsx)(e.h3,{id:"nftables\u8a2d\u5b9a\u4f8b",children:"nftables\u8a2d\u5b9a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"#!/usr/sbin/nft -f\n\n# \u65e2\u5b58\u8a2d\u5b9a\u30af\u30ea\u30a2\nflush ruleset\n\ntable inet filter {\n    chain input {\n        type filter hook input priority 0; policy drop;\n\n        # \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u8a31\u53ef\n        iif lo accept\n\n        # \u78ba\u7acb\u6e08\u307f\u63a5\u7d9a\u8a31\u53ef\n        ct state established,related accept\n\n        # SSH\n        tcp dport 22 accept\n\n        # HTTP/HTTPS\n        tcp dport { 80, 443 } accept\n\n        # ICMP\n        icmp type echo-request accept\n    }\n\n    chain forward {\n        type filter hook forward priority 0; policy drop;\n    }\n\n    chain output {\n        type filter hook output priority 0; policy accept;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u30b3\u30f3\u30c6\u30ca\u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb",children:"\u30b3\u30f3\u30c6\u30ca\u3068\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb"}),"\n",(0,i.jsx)(e.h3,{id:"docker\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af",children:"Docker\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                Docker \u3068 iptables                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  Docker \u306f\u81ea\u52d5\u7684\u306b iptables \u30eb\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059               \u2502\n\u2502                                                              \u2502\n\u2502  \u30fbDOCKER \u30c1\u30a7\u30fc\u30f3: \u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1                 \u2502\n\u2502  \u30fbDOCKER-USER \u30c1\u30a7\u30fc\u30f3: \u30ab\u30b9\u30bf\u30e0\u30eb\u30fc\u30eb\u7528                   \u2502\n\u2502  \u30fbNAT \u30eb\u30fc\u30eb: \u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0                              \u2502\n\u2502                                                              \u2502\n\u2502  \u78ba\u8a8d:                                                       \u2502\n\u2502  sudo iptables -L DOCKER                                    \u2502\n\u2502  sudo iptables -t nat -L -n                                 \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(e.h3,{id:"docker-\u306e\u30dd\u30fc\u30c8\u516c\u958b",children:"Docker \u306e\u30dd\u30fc\u30c8\u516c\u958b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306e -p \u30aa\u30d7\u30b7\u30e7\u30f3\ndocker run -p 8080:80 nginx\n\n# iptables \u3067\u78ba\u8a8d\nsudo iptables -t nat -L -n | grep 8080\n# DNAT  tcp  --  0.0.0.0/0  0.0.0.0/0  tcp dpt:8080 to:172.17.0.2:80\n"})}),"\n",(0,i.jsx)(e.h3,{id:"docker-user-\u30c1\u30a7\u30fc\u30f3",children:"DOCKER-USER \u30c1\u30a7\u30fc\u30f3"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Docker \u304c\u4f5c\u6210\u3059\u308b\u30eb\u30fc\u30eb\u3088\u308a\u524d\u306b\u8a55\u4fa1\u3055\u308c\u308b\n# \u30ab\u30b9\u30bf\u30e0\u30eb\u30fc\u30eb\u306f\u3053\u3053\u306b\u8ffd\u52a0\n\n# \u7279\u5b9aIP\u304b\u3089\u306e\u307f\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\nsudo iptables -I DOCKER-USER -i eth0 ! -s 192.168.1.0/24 -j DROP\n\n# \u78ba\u8a8d\nsudo iptables -L DOCKER-USER -n -v\n"})}),"\n",(0,i.jsx)(e.h3,{id:"kubernetes-\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30ea\u30b7\u30fc",children:"Kubernetes \u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30ea\u30b7\u30fc"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# NetworkPolicy \u3067Pod\u9593\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u5236\u5fa1\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-all\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  - Egress\n---\n# \u7279\u5b9a\u306ePod\u304b\u3089\u306e\u307f\u8a31\u53ef\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-from-frontend\nspec:\n  podSelector:\n    matchLabels:\n      app: backend\n  ingress:\n  - from:\n    - podSelector:\n        matchLabels:\n          app: frontend\n    ports:\n    - protocol: TCP\n      port: 8080\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u307e\u3068\u3081",children:"\u307e\u3068\u3081"}),"\n",(0,i.jsx)(e.h3,{id:"\u91cd\u8981\u306a\u30b3\u30de\u30f3\u30c9",children:"\u91cd\u8981\u306a\u30b3\u30de\u30f3\u30c9"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u30b3\u30de\u30f3\u30c9"}),(0,i.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"iptables -L"}),(0,i.jsx)(e.td,{children:"\u30eb\u30fc\u30eb\u8868\u793a"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"iptables -A"}),(0,i.jsx)(e.td,{children:"\u30eb\u30fc\u30eb\u8ffd\u52a0"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"iptables -D"}),(0,i.jsx)(e.td,{children:"\u30eb\u30fc\u30eb\u524a\u9664"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"iptables -F"}),(0,i.jsx)(e.td,{children:"\u5168\u30eb\u30fc\u30eb\u30af\u30ea\u30a2"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"iptables-save"}),(0,i.jsx)(e.td,{children:"\u30eb\u30fc\u30eb\u4fdd\u5b58"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"iptables-restore"}),(0,i.jsx)(e.td,{children:"\u30eb\u30fc\u30eb\u5fa9\u5143"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u30c7\u30d5\u30a9\u30eb\u30c8\u30dd\u30ea\u30b7\u30fc\u306f DROP\uff08\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u65b9\u5f0f\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u78ba\u7acb\u6e08\u307f\u63a5\u7d9a\u306f\u8a31\u53ef"}),"\n",(0,i.jsx)(e.li,{children:"\u30ed\u30b0\u3092\u6709\u52b9\u306b\u3057\u3066\u30c7\u30d0\u30c3\u30b0"}),"\n",(0,i.jsx)(e.li,{children:"\u30eb\u30fc\u30eb\u306f\u5fc5\u305a\u6c38\u7d9a\u5316"}),"\n",(0,i.jsx)(e.li,{children:"Docker\u74b0\u5883\u3067\u306f DOCKER-USER \u30c1\u30a7\u30fc\u30f3\u3092\u4f7f\u7528"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/linux/network-troubleshooting",children:"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"})," - \u8a3a\u65ad\u30c4\u30fc\u30eb"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/linux/namespaces",children:"Namespaces"})," - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d\u524d\u7a7a\u9593"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9",children:"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html",children:"iptables Tutorial"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://wiki.nftables.org/",children:"nftables Wiki"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.docker.com/network/iptables/",children:"Docker and iptables"})}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},28453:(n,e,l)=>{l.d(e,{R:()=>d,x:()=>r});var s=l(96540);const i={},t=s.createContext(i);function d(n){const e=s.useContext(t);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),s.createElement(t.Provider,{value:e},n.children)}}}]);