"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6887],{61676:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>o,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"content_09_project/analytics-statistics-design","title":"\u7d71\u8a08\u30fb\u5206\u6790\u6a5f\u80fd \u8a2d\u8a08\u63d0\u6848","description":"Issue #441 \u5bfe\u5fdc: \u30c6\u30ca\u30f3\u30c8\u7d71\u8a08\u30c7\u30fc\u30bf\u53ce\u96c6\u30fb\u5206\u6790\u6a5f\u80fd\u306e\u8ffd\u52a0","source":"@site/docs/content_09_project/analytics-statistics-design.md","sourceDirName":"content_09_project","slug":"/content_09_project/analytics-statistics-design","permalink":"/idp-server/docs/content_09_project/analytics-statistics-design","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_09_project/analytics-statistics-design.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u30b9\u30c8\u30ec\u30b9\u30c6\u30b9\u30c8\u7d50\u679c","permalink":"/idp-server/docs/content_08_ops/ops-02-performance-test"},"next":{"title":"Control Plane\u5206\u96e2\u8a2d\u8a08\u63d0\u6848","permalink":"/idp-server/docs/content_09_project/control-plane-separation-design"}}');var t=s(74848),l=s(28453);const r={},a="\u7d71\u8a08\u30fb\u5206\u6790\u6a5f\u80fd \u8a2d\u8a08\u63d0\u6848",d={},c=[{value:"\ud83d\udcca \u73fe\u72b6\u5206\u6790\u3068\u8ab2\u984c",id:"-\u73fe\u72b6\u5206\u6790\u3068\u8ab2\u984c",level:2},{value:"\u73fe\u5728\u306eidp-server\u6a5f\u80fd",id:"\u73fe\u5728\u306eidp-server\u6a5f\u80fd",level:3},{value:"\u904b\u7528\u4e0a\u306e\u8ab2\u984c",id:"\u904b\u7528\u4e0a\u306e\u8ab2\u984c",level:3},{value:"\ud83d\udd0d \u7af6\u5408\u5206\u6790\u7d50\u679c",id:"-\u7af6\u5408\u5206\u6790\u7d50\u679c",level:2},{value:"Keycloak",id:"keycloak",level:3},{value:"Auth0",id:"auth0",level:3},{value:"\u696d\u754c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"\u696d\u754c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:3},{value:"\ud83c\udfaf \u8a2d\u8a08\u63d0\u6848",id:"-\u8a2d\u8a08\u63d0\u6848",level:2},{value:"1. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981",id:"1-\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981",level:3},{value:"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb\u8a2d\u8a08",id:"2-\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb\u8a2d\u8a08",level:3},{value:"\u57fa\u672c\u7d71\u8a08\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3",id:"\u57fa\u672c\u7d71\u8a08\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3",level:4},{value:"\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\uff08\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\uff09",id:"\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0",level:4},{value:"\u96c6\u7d04\u7d71\u8a08\u30d3\u30e5\u30fc",id:"\u96c6\u7d04\u7d71\u8a08\u30d3\u30e5\u30fc",level:4},{value:"3. Statistics API \u8a2d\u8a08",id:"3-statistics-api-\u8a2d\u8a08",level:3},{value:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u69cb\u6210",id:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u69cb\u6210",level:4},{value:"API\u4ed5\u69d8\u8a73\u7d30",id:"api\u4ed5\u69d8\u8a73\u7d30",level:4},{value:"4. \u5b9f\u88c5\u65b9\u91dd",id:"4-\u5b9f\u88c5\u65b9\u91dd",level:3},{value:"Phase 1: \u57fa\u672c\u7d71\u8a08\u6a5f\u80fd",id:"phase-1-\u57fa\u672c\u7d71\u8a08\u6a5f\u80fd",level:4},{value:"Phase 2: \u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u7d71\u8a08",id:"phase-2-\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u7d71\u8a08",level:4},{value:"Phase 3: \u9ad8\u5ea6\u5206\u6790\u6a5f\u80fd",id:"phase-3-\u9ad8\u5ea6\u5206\u6790\u6a5f\u80fd",level:4},{value:"5. \u6280\u8853\u7684\u8003\u616e\u4e8b\u9805",id:"5-\u6280\u8853\u7684\u8003\u616e\u4e8b\u9805",level:3},{value:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316",id:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316",level:4},{value:"\u30c7\u30fc\u30bf\u4fdd\u6301\u6226\u7565",id:"\u30c7\u30fc\u30bf\u4fdd\u6301\u6226\u7565",level:4},{value:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56",id:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56",level:4},{value:"\ud83d\ude80 \u5b9f\u88c5\u8a08\u753b",id:"-\u5b9f\u88c5\u8a08\u753b",level:2},{value:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f31: \u57fa\u672c\u7d71\u8a08API (Week 1-2)",id:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f31-\u57fa\u672c\u7d71\u8a08api-week-1-2",level:3},{value:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f32: \u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u5bfe\u5fdc (Week 3-4)",id:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f32-\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u5bfe\u5fdc-week-3-4",level:3},{value:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f33: \u9ad8\u5ea6\u5206\u6790\u6a5f\u80fd (Week 5-6)",id:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f33-\u9ad8\u5ea6\u5206\u6790\u6a5f\u80fd-week-5-6",level:3},{value:"\ud83d\udccb \u671f\u5f85\u3055\u308c\u308b\u52b9\u679c",id:"-\u671f\u5f85\u3055\u308c\u308b\u52b9\u679c",level:2},{value:"\u904b\u7528\u6539\u5584",id:"\u904b\u7528\u6539\u5584",level:3},{value:"\u30d3\u30b8\u30cd\u30b9\u4fa1\u5024",id:"\u30d3\u30b8\u30cd\u30b9\u4fa1\u5024",level:3},{value:"\u958b\u767a\u8005\u4f53\u9a13",id:"\u958b\u767a\u8005\u4f53\u9a13",level:3}];function h(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"\u7d71\u8a08\u5206\u6790\u6a5f\u80fd-\u8a2d\u8a08\u63d0\u6848",children:"\u7d71\u8a08\u30fb\u5206\u6790\u6a5f\u80fd \u8a2d\u8a08\u63d0\u6848"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Issue #441 \u5bfe\u5fdc"}),": \u30c6\u30ca\u30f3\u30c8\u7d71\u8a08\u30c7\u30fc\u30bf\u53ce\u96c6\u30fb\u5206\u6790\u6a5f\u80fd\u306e\u8ffd\u52a0"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"-\u73fe\u72b6\u5206\u6790\u3068\u8ab2\u984c",children:"\ud83d\udcca \u73fe\u72b6\u5206\u6790\u3068\u8ab2\u984c"}),"\n",(0,t.jsx)(e.h3,{id:"\u73fe\u5728\u306eidp-server\u6a5f\u80fd",children:"\u73fe\u5728\u306eidp-server\u6a5f\u80fd"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u2705 ",(0,t.jsx)(e.strong,{children:"\u76e3\u67fb\u30ed\u30b0API"}),": ",(0,t.jsx)(e.code,{children:"/v1/management/tenants/{tenant-id}/audit-logs"})," \u3067\u8a73\u7d30\u30ed\u30b0\u53d6\u5f97\u53ef\u80fd"]}),"\n",(0,t.jsxs)(e.li,{children:["\u2705 ",(0,t.jsx)(e.strong,{children:"\u30e6\u30fc\u30b6\u30fc\u7ba1\u7406API"}),": \u30e6\u30fc\u30b6\u30fc\u4e00\u89a7\u30fb\u8a73\u7d30\u60c5\u5831\u306e\u53d6\u5f97"]}),"\n",(0,t.jsxs)(e.li,{children:["\u2705 ",(0,t.jsx)(e.strong,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8"}),": \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u95a2\u9023\u30a4\u30d9\u30f3\u30c8\u306e\u8a18\u9332\u30fb\u901a\u77e5"]}),"\n",(0,t.jsxs)(e.li,{children:["\u274c ",(0,t.jsx)(e.strong,{children:"\u7d71\u8a08\u30fb\u5206\u6790\u6a5f\u80fd"}),": \u96c6\u8a08\u30c7\u30fc\u30bf\u3084\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u7528\u30e1\u30c8\u30ea\u30af\u30b9\u4e0d\u8db3"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"\u904b\u7528\u4e0a\u306e\u8ab2\u984c",children:"\u904b\u7528\u4e0a\u306e\u8ab2\u984c"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u610f\u601d\u6c7a\u5b9a\u652f\u63f4\u4e0d\u8db3"}),": \u5229\u7528\u72b6\u6cc1\u306e\u53ef\u8996\u5316\u30fb\u30c8\u30ec\u30f3\u30c9\u5206\u6790\u4e0d\u53ef"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u30d7\u30e9\u30f3\u30cb\u30f3\u30b0\u56f0\u96e3"}),": \u30ea\u30bd\u30fc\u30b9\u4f7f\u7528\u91cf\u306e\u4e88\u6e2c\u56f0\u96e3"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u8996\u4e0d\u8db3"}),": \u7570\u5e38\u30d1\u30bf\u30fc\u30f3\u30fb\u8105\u5a01\u691c\u77e5\u306e\u81ea\u52d5\u5316\u4e0d\u53ef"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u5831\u544a\u7169\u96d1"}),": \u5b9a\u671f\u5831\u544a\u7528\u30c7\u30fc\u30bf\u53ce\u96c6\u306e\u624b\u4f5c\u696d"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"-\u7af6\u5408\u5206\u6790\u7d50\u679c",children:"\ud83d\udd0d \u7af6\u5408\u5206\u6790\u7d50\u679c"}),"\n",(0,t.jsx)(e.h3,{id:"keycloak",children:"Keycloak"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"\u5f37\u307f"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Prometheus\u9023\u643a\u306b\u3088\u308b\u5305\u62ec\u7684\u30e1\u30c8\u30ea\u30af\u30b9"}),"\n",(0,t.jsx)(e.li,{children:"Grafana\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u63d0\u4f9b"}),"\n",(0,t.jsx)(e.li,{children:"\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u76e3\u8996\u5bfe\u5fdc"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"\u63d0\u4f9b\u30e1\u30c8\u30ea\u30af\u30b9"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u30ed\u30b0\u30a4\u30f3\u6210\u529f/\u5931\u6557\u56de\u6570\uff08IdP\u30fb\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5225\uff09"}),"\n",(0,t.jsx)(e.li,{children:"\u30c8\u30fc\u30af\u30f3\u767a\u884c\u30fb\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u56de\u6570"}),"\n",(0,t.jsx)(e.li,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9\u6642\u9593\u5206\u5e03"}),"\n",(0,t.jsx)(e.li,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u7d71\u8a08"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"auth0",children:"Auth0"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"\u5f37\u307f"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"SaaS\u7279\u5316\u306e\u6d17\u7df4\u3055\u308c\u305f\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9"}),"\n",(0,t.jsx)(e.li,{children:"\u5229\u7528\u91cf\u30fb\u8acb\u6c42\u9023\u52d5\u306e\u7d71\u8a08\u6a5f\u80fd"}),"\n",(0,t.jsx)(e.li,{children:"\u5916\u90e8\u5206\u6790\u30c4\u30fc\u30eb\u7d71\u5408"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"\u63d0\u4f9b\u30e1\u30c8\u30ea\u30af\u30b9"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u4f7f\u7528\u91cf\u76e3\u8996"}),"\n",(0,t.jsx)(e.li,{children:"MFA\u5229\u7528\u72b6\u6cc1\u30fb\u6210\u529f\u7387"}),"\n",(0,t.jsx)(e.li,{children:"API\u547c\u3073\u51fa\u3057\u7d71\u8a08"}),"\n",(0,t.jsx)(e.li,{children:"\u30e6\u30fc\u30b6\u30fc\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u5206\u6790"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"\u696d\u754c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"\u696d\u754c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u6027"}),": 2025\u5e74\u306e\u30c8\u30ec\u30f3\u30c9\u306f\u5373\u5ea7\u306e\u6d1e\u5bdf\u63d0\u4f9b"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"AI/ML\u7d71\u5408"}),": \u7570\u5e38\u691c\u77e5\u30fb\u4e88\u6e2c\u5206\u6790\u306e\u81ea\u52d5\u5316"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30bc\u30ed\u30c8\u30e9\u30b9\u30c8\u5bfe\u5fdc"}),": \u7d99\u7d9a\u7684\u306a\u4fe1\u983c\u5ea6\u8a55\u4fa1\u30fb\u30ea\u30b9\u30af\u30a2\u30bb\u30b9\u30e1\u30f3\u30c8"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30ce\u30f3\u30d2\u30e5\u30fc\u30de\u30f3ID\u5bfe\u5fdc"}),": 2025\u5e74\u306b\u306f\u4eba\u9593:\u30dc\u30c3\u30c8 = 1:3 \u306e\u6bd4\u7387\u4e88\u60f3"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"-\u8a2d\u8a08\u63d0\u6848",children:"\ud83c\udfaf \u8a2d\u8a08\u63d0\u6848"}),"\n",(0,t.jsx)(e.h3,{id:"1-\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981",children:"1. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981"}),"\n",(0,t.jsx)(e.mermaid,{value:'flowchart TD\n    subgraph "Data Collection Layer"\n        AL[Audit Logs]\n        SE[Security Events]\n        UA[User Activities]\n        TA[Token Activities]\n    end\n\n    subgraph "Aggregation Engine"\n        RT[Real-time Processor]\n        BA[Batch Aggregator]\n        ML[ML Analytics]\n    end\n\n    subgraph "Storage Layer"\n        TS[(Time Series DB)]\n        AS[(Aggregated Stats)]\n        Cache[Redis Cache]\n    end\n\n    subgraph "API Layer"\n        SA[Statistics API]\n        DA[Dashboard API]\n        EA[Export API]\n    end\n\n    subgraph "Client Applications"\n        AC[Admin Console]\n        GD[Grafana Dashboard]\n        BI[BI Tools]\n    end\n\n    AL --\x3e RT\n    SE --\x3e RT\n    UA --\x3e RT\n    TA --\x3e RT\n\n    RT --\x3e TS\n    RT --\x3e Cache\n    BA --\x3e AS\n\n    TS --\x3e SA\n    AS --\x3e SA\n    Cache --\x3e DA\n\n    SA --\x3e AC\n    DA --\x3e GD\n    EA --\x3e BI'}),"\n",(0,t.jsx)(e.h3,{id:"2-\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb\u8a2d\u8a08",children:"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb\u8a2d\u8a08"}),"\n",(0,t.jsx)(e.h4,{id:"\u57fa\u672c\u7d71\u8a08\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3",children:"\u57fa\u672c\u7d71\u8a08\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30c6\u30ca\u30f3\u30c8\u5225\u65e5\u6b21\u7d71\u8a08\nCREATE TABLE tenant_daily_statistics (\n    id UUID PRIMARY KEY,\n    tenant_id UUID NOT NULL,\n    date DATE NOT NULL,\n\n    -- \u8a8d\u8a3c\u7d71\u8a08\n    total_logins INTEGER DEFAULT 0,\n    successful_logins INTEGER DEFAULT 0,\n    failed_logins INTEGER DEFAULT 0,\n    unique_users INTEGER DEFAULT 0,\n\n    -- \u30c8\u30fc\u30af\u30f3\u7d71\u8a08\n    tokens_issued INTEGER DEFAULT 0,\n    tokens_refreshed INTEGER DEFAULT 0,\n    tokens_revoked INTEGER DEFAULT 0,\n\n    -- \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7d71\u8a08\n    mfa_attempts INTEGER DEFAULT 0,\n    mfa_successes INTEGER DEFAULT 0,\n    security_events INTEGER DEFAULT 0,\n\n    -- \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u7d71\u8a08\n    avg_response_time_ms INTEGER DEFAULT 0,\n    p95_response_time_ms INTEGER DEFAULT 0,\n    error_rate DECIMAL(5,4) DEFAULT 0,\n\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    UNIQUE(tenant_id, date)\n);\n\n-- RLS\u9069\u7528\nALTER TABLE tenant_daily_statistics ENABLE ROW LEVEL SECURITY;\nCREATE POLICY rls_tenant_daily_statistics\n  ON tenant_daily_statistics\n  USING (tenant_id = current_setting('app.tenant_id')::uuid);\nALTER TABLE tenant_daily_statistics FORCE ROW LEVEL SECURITY;\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0",children:"\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\uff08\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u6642\u9593\u5225\u7d71\u8a08\uff0824\u6642\u9593\u4fdd\u6301\uff09\nCREATE TABLE tenant_hourly_metrics (\n    id UUID PRIMARY KEY,\n    tenant_id UUID NOT NULL,\n    timestamp TIMESTAMP NOT NULL,\n    metric_type VARCHAR(100) NOT NULL,\n    metric_value INTEGER NOT NULL,\n\n    -- \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u6700\u9069\u5316\n    INDEX idx_tenant_hourly_timestamp (tenant_id, timestamp),\n    INDEX idx_tenant_hourly_type (tenant_id, metric_type)\n);\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u96c6\u7d04\u7d71\u8a08\u30d3\u30e5\u30fc",children:"\u96c6\u7d04\u7d71\u8a08\u30d3\u30e5\u30fc"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u6708\u6b21\u96c6\u7d04\u30d3\u30e5\u30fc\nCREATE VIEW tenant_monthly_statistics AS\nSELECT\n    tenant_id,\n    DATE_TRUNC('month', date) as month,\n    SUM(total_logins) as total_logins,\n    SUM(successful_logins) as successful_logins,\n    AVG(unique_users) as avg_unique_users,\n    SUM(tokens_issued) as total_tokens_issued,\n    AVG(avg_response_time_ms) as avg_response_time,\n    AVG(error_rate) as avg_error_rate\nFROM tenant_daily_statistics\nGROUP BY tenant_id, DATE_TRUNC('month', date);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"3-statistics-api-\u8a2d\u8a08",children:"3. Statistics API \u8a2d\u8a08"}),"\n",(0,t.jsx)(e.h4,{id:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u69cb\u6210",children:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u69cb\u6210"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"GET /v1/management/tenants/{tenant-id}/statistics/dashboard\nGET /v1/management/tenants/{tenant-id}/statistics/summary\nGET /v1/management/tenants/{tenant-id}/statistics/time-series\nGET /v1/management/tenants/{tenant-id}/statistics/reports\nGET /v1/management/tenants/{tenant-id}/statistics/export\n"})}),"\n",(0,t.jsx)(e.h4,{id:"api\u4ed5\u69d8\u8a73\u7d30",children:"API\u4ed5\u69d8\u8a73\u7d30"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"1. \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u7d71\u8a08"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-http",children:"GET /v1/management/tenants/{tenant-id}/statistics/dashboard\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9\u4f8b:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "tenant_id": "67e7eae6-62b0-4500-9eff-87459f63fc66",\n  "period": "last_7_days",\n  "summary": {\n    "total_users": 1250,\n    "active_users_today": 89,\n    "total_logins_today": 156,\n    "success_rate": 97.3,\n    "avg_response_time_ms": 245\n  },\n  "trends": {\n    "user_growth_rate": 12.5,\n    "login_trend": "increasing",\n    "error_rate_trend": "stable"\n  },\n  "security": {\n    "security_events_count": 3,\n    "mfa_adoption_rate": 78.5,\n    "suspicious_activities": 1\n  },\n  "performance": {\n    "avg_response_time": 245,\n    "p95_response_time": 890,\n    "uptime_percentage": 99.9\n  }\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"2. \u6642\u7cfb\u5217\u30c7\u30fc\u30bf"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-http",children:"GET /v1/management/tenants/{tenant-id}/statistics/time-series\n  ?metric=logins,users,tokens\n  &period=7d\n  &granularity=1h\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9\u4f8b:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "tenant_id": "67e7eae6-62b0-4500-9eff-87459f63fc66",\n  "period": {\n    "start": "2025-09-06T00:00:00Z",\n    "end": "2025-09-13T23:59:59Z",\n    "granularity": "1h"\n  },\n  "metrics": {\n    "logins": [\n      {"timestamp": "2025-09-13T00:00:00Z", "value": 23},\n      {"timestamp": "2025-09-13T01:00:00Z", "value": 15},\n      {"timestamp": "2025-09-13T02:00:00Z", "value": 8}\n    ],\n    "users": [\n      {"timestamp": "2025-09-13T00:00:00Z", "value": 18},\n      {"timestamp": "2025-09-13T01:00:00Z", "value": 12}\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"3. \u8a73\u7d30\u30ec\u30dd\u30fc\u30c8"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-http",children:"GET /v1/management/tenants/{tenant-id}/statistics/reports\n  ?type=security|usage|performance\n  &period=30d\n  &format=json\n"})}),"\n",(0,t.jsx)(e.h3,{id:"4-\u5b9f\u88c5\u65b9\u91dd",children:"4. \u5b9f\u88c5\u65b9\u91dd"}),"\n",(0,t.jsx)(e.h4,{id:"phase-1-\u57fa\u672c\u7d71\u8a08\u6a5f\u80fd",children:"Phase 1: \u57fa\u672c\u7d71\u8a08\u6a5f\u80fd"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u76ee\u6a19"}),": \u65e2\u5b58\u306e\u76e3\u67fb\u30ed\u30b0\u30fb\u30a4\u30d9\u30f3\u30c8\u30c7\u30fc\u30bf\u304b\u3089\u57fa\u672c\u30e1\u30c8\u30ea\u30af\u30b9\u751f\u6210"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u671f\u9593"}),": 1-2\u9031\u9593"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u6210\u679c\u7269"}),":","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u65e5\u6b21\u30d0\u30c3\u30c1\u51e6\u7406\u3067\u306e\u7d71\u8a08\u751f\u6210"}),"\n",(0,t.jsx)(e.li,{children:"\u57fa\u672c\u7684\u306aREST API"}),"\n",(0,t.jsx)(e.li,{children:"\u30b7\u30f3\u30d7\u30eb\u306a\u7ba1\u7406\u753b\u9762"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"phase-2-\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u7d71\u8a08",children:"Phase 2: \u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u7d71\u8a08"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u76ee\u6a19"}),": \u6642\u9593\u5358\u4f4d\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u7d71\u8a08"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u671f\u9593"}),": 2-3\u9031\u9593"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u6210\u679c\u7269"}),":","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u578b\u7d71\u8a08\u66f4\u65b0"}),"\n",(0,t.jsx)(e.li,{children:"\u6642\u7cfb\u5217\u30c7\u30fc\u30bfAPI"}),"\n",(0,t.jsx)(e.li,{children:"Grafana\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u9023\u643a"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"phase-3-\u9ad8\u5ea6\u5206\u6790\u6a5f\u80fd",children:"Phase 3: \u9ad8\u5ea6\u5206\u6790\u6a5f\u80fd"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u76ee\u6a19"}),": \u7570\u5e38\u691c\u77e5\u30fb\u4e88\u6e2c\u5206\u6790"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u671f\u9593"}),": 3-4\u9031\u9593"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u6210\u679c\u7269"}),":","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"ML\u57fa\u76e4\u7d71\u5408"}),"\n",(0,t.jsx)(e.li,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7570\u5e38\u691c\u77e5"}),"\n",(0,t.jsx)(e.li,{children:"\u5bb9\u91cf\u8a08\u753b\u652f\u63f4\u6a5f\u80fd"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"5-\u6280\u8853\u7684\u8003\u616e\u4e8b\u9805",children:"5. \u6280\u8853\u7684\u8003\u616e\u4e8b\u9805"}),"\n",(0,t.jsx)(e.h4,{id:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316",children:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'// \u975e\u540c\u671f\u7d71\u8a08\u66f4\u65b0\n@EventListener\n@Async("statisticsTaskExecutor")\npublic void handleAuthenticationEvent(AuthenticationEvent event) {\n    statisticsAggregator.incrementLoginCount(\n        event.getTenantId(),\n        event.isSuccessful()\n    );\n}\n\n// \u30d0\u30c3\u30c1\u51e6\u7406\u306b\u3088\u308b\u5927\u91cf\u30c7\u30fc\u30bf\u96c6\u7d04\n@Scheduled(cron = "0 0 1 * * ?") // \u6bce\u65e5AM1\u6642\u5b9f\u884c\npublic void aggregateDailyStatistics() {\n    List<TenantIdentifier> tenants = tenantService.findAll();\n    tenants.parallelStream().forEach(this::processTenantsStatistics);\n}\n'})}),"\n",(0,t.jsx)(e.h4,{id:"\u30c7\u30fc\u30bf\u4fdd\u6301\u6226\u7565",children:"\u30c7\u30fc\u30bf\u4fdd\u6301\u6226\u7565"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# \u30c7\u30fc\u30bf\u4fdd\u6301\u30dd\u30ea\u30b7\u30fc\u8a2d\u5b9a\nstatistics:\n  retention:\n    hourly_data: 7d    # \u6642\u9593\u5225\u30c7\u30fc\u30bf: 7\u65e5\u9593\n    daily_data: 1y     # \u65e5\u5225\u30c7\u30fc\u30bf: 1\u5e74\u9593\n    monthly_data: 3y   # \u6708\u5225\u30c7\u30fc\u30bf: 3\u5e74\u9593\n  aggregation:\n    batch_size: 1000\n    processing_threads: 4\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56",children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30c7\u30fc\u30bf\u533f\u540d\u5316"}),": \u500b\u4eba\u60c5\u5831\u9664\u53bb\u30fb\u30cf\u30c3\u30b7\u30e5\u5316"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30a2\u30af\u30bb\u30b9\u5236\u5fa1"}),": \u30c6\u30ca\u30f3\u30c8\u7ba1\u7406\u8005\u306e\u307f\u7d71\u8a08\u30c7\u30fc\u30bf\u95b2\u89a7\u53ef\u80fd"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u76e3\u67fb\u30ed\u30b0"}),": \u7d71\u8a08\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u8a18\u9332"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"-\u5b9f\u88c5\u8a08\u753b",children:"\ud83d\ude80 \u5b9f\u88c5\u8a08\u753b"}),"\n",(0,t.jsx)(e.h3,{id:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f31-\u57fa\u672c\u7d71\u8a08api-week-1-2",children:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f31: \u57fa\u672c\u7d71\u8a08API (Week 1-2)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@RestController\n@RequestMapping("/v1/management/tenants/{tenant-id}/statistics")\npublic class TenantStatisticsApi {\n\n    @GetMapping("/dashboard")\n    public ResponseEntity<DashboardStatistics> getDashboard(\n        @PathVariable("tenant-id") TenantIdentifier tenantId,\n        @RequestParam(defaultValue = "7d") String period\n    ) {\n        // \u5b9f\u88c5\n    }\n\n    @GetMapping("/summary")\n    public ResponseEntity<StatisticsSummary> getSummary(\n        @PathVariable("tenant-id") TenantIdentifier tenantId,\n        @RequestParam(defaultValue = "24h") String period\n    ) {\n        // \u5b9f\u88c5\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f32-\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u5bfe\u5fdc-week-3-4",children:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f32: \u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u5bfe\u5fdc (Week 3-4)"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Redis/InfluxDB\u306b\u3088\u308b\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u30b9\u30c8\u30ec\u30fc\u30b8"}),"\n",(0,t.jsx)(e.li,{children:"WebSocket\u63a5\u7d9a\u306b\u3088\u308b\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u66f4\u65b0"}),"\n",(0,t.jsx)(e.li,{children:"Grafana\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f33-\u9ad8\u5ea6\u5206\u6790\u6a5f\u80fd-week-5-6",children:"\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f33: \u9ad8\u5ea6\u5206\u6790\u6a5f\u80fd (Week 5-6)"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u6a5f\u68b0\u5b66\u7fd2\u306b\u3088\u308b\u7570\u5e38\u691c\u77e5"}),"\n",(0,t.jsx)(e.li,{children:"\u4e88\u6e2c\u5206\u6790\uff08\u8ca0\u8377\u30fb\u5229\u7528\u91cf\u4e88\u6e2c\uff09"}),"\n",(0,t.jsx)(e.li,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30f3\u30b5\u30a4\u30c8"}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"-\u671f\u5f85\u3055\u308c\u308b\u52b9\u679c",children:"\ud83d\udccb \u671f\u5f85\u3055\u308c\u308b\u52b9\u679c"}),"\n",(0,t.jsx)(e.h3,{id:"\u904b\u7528\u6539\u5584",children:"\u904b\u7528\u6539\u5584"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"30%\u524a\u6e1b"}),": \u904b\u7528\u76e3\u8996\u306b\u304b\u304b\u308b\u624b\u4f5c\u696d\u6642\u9593"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"50%\u5411\u4e0a"}),": \u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u691c\u77e5\u306e\u8fc5\u901f\u6027"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"24/7"}),": \u81ea\u52d5\u5316\u3055\u308c\u305f\u30d8\u30eb\u30b9\u76e3\u8996"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"\u30d3\u30b8\u30cd\u30b9\u4fa1\u5024",children:"\u30d3\u30b8\u30cd\u30b9\u4fa1\u5024"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30c7\u30fc\u30bf\u99c6\u52d5"}),": \u7d71\u8a08\u306b\u57fa\u3065\u304f\u610f\u601d\u6c7a\u5b9a\u652f\u63f4"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u4e88\u9632\u4fdd\u5168"}),": \u554f\u984c\u306e\u4e8b\u524d\u5bdf\u77e5\u30fb\u5bfe\u51e6"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9"}),": \u81ea\u52d5\u5316\u3055\u308c\u305f\u76e3\u67fb\u30ec\u30dd\u30fc\u30c8\u751f\u6210"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"\u958b\u767a\u8005\u4f53\u9a13",children:"\u958b\u767a\u8005\u4f53\u9a13"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u53ef\u89b3\u6e2c\u6027"}),": \u30b7\u30b9\u30c6\u30e0\u52d5\u4f5c\u306e\u5b8c\u5168\u306a\u53ef\u8996\u5316"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30c7\u30d0\u30c3\u30b0\u652f\u63f4"}),": \u554f\u984c\u306e\u6839\u672c\u539f\u56e0\u8fc5\u901f\u7279\u5b9a"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316"}),": \u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306e\u5b9a\u91cf\u7684\u628a\u63e1"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:["\u3053\u306e\u7d71\u8a08\u30fb\u5206\u6790\u6a5f\u80fd\u306b\u3088\u308a\u3001idp-server\u306f\u5358\u306a\u308b\u8a8d\u8a3c\u57fa\u76e4\u304b\u3089\u3001",(0,t.jsx)(e.strong,{children:"\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30c8\u306a\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30c6\u30a3\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0"}),"\u3078\u3068\u9032\u5316\u3057\u307e\u3059\u3002"]})]})}function o(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(h,{...n})}):h(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>r,x:()=>a});var i=s(96540);const t={},l=i.createContext(t);function r(n){const e=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);