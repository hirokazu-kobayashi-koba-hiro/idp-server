"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[4357],{22466:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"content_06_developer-guide/configuration/authn/email","title":"Email\u8a8d\u8a3c","description":"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3001email-authentication \u65b9\u5f0f\u306b\u3088\u308b\u8a8d\u8a3c\u51e6\u7406\u306e \u6982\u8981\u30fb\u8a2d\u5b9a\u30fb\u5229\u7528\u65b9\u6cd5 \u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002","source":"@site/docs/content_06_developer-guide/05-configuration/authn/email.md","sourceDirName":"content_06_developer-guide/05-configuration/authn","slug":"/content_06_developer-guide/configuration/authn/email","permalink":"/idp-server/docs/content_06_developer-guide/configuration/authn/email","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_06_developer-guide/05-configuration/authn/email.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"\u8a8d\u8a3c\u30c7\u30d0\u30a4\u30b9\u901a\u77e5","permalink":"/idp-server/docs/content_06_developer-guide/configuration/authn/authentication-device"},"next":{"title":"External Token\u8a8d\u8a3c","permalink":"/idp-server/docs/content_06_developer-guide/configuration/authn/external-token"}}');var s=i(74848),l=i(28453);const c={},r="Email\u8a8d\u8a3c",d={},o=[{value:"\u6982\u8981",id:"\u6982\u8981",level:2},{value:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u6a5f\u80fd",id:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u6a5f\u80fd",level:3},{value:"\u8a2d\u5b9a",id:"\u8a2d\u5b9a",level:2},{value:"\u57fa\u672c\u69cb\u9020",id:"\u57fa\u672c\u69cb\u9020",level:3},{value:"Interaction 1: email-authentication-challenge",id:"interaction-1-email-authentication-challenge",level:3},{value:"Request Schema",id:"request-schema",level:4},{value:"Execution",id:"execution",level:4},{value:"Response",id:"response",level:4},{value:"Interaction 2: email-authentication",id:"interaction-2-email-authentication",level:3},{value:"Request Schema",id:"request-schema-1",level:4},{value:"Execution",id:"execution-1",level:4},{value:"Response",id:"response-1",level:4},{value:"\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8b\uff08no-action\uff09",id:"\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8bno-action",level:3},{value:"\u8a2d\u5b9a\u30d1\u30bf\u30fc\u30f3\u8a73\u7d30",id:"\u8a2d\u5b9a\u30d1\u30bf\u30fc\u30f3\u8a73\u7d30",level:2},{value:"\u30d1\u30bf\u30fc\u30f31: \u30c6\u30b9\u30c8\u7528\uff08no-action\uff09",id:"\u30d1\u30bf\u30fc\u30f31-\u30c6\u30b9\u30c8\u7528no-action",level:3},{value:"\u30d1\u30bf\u30fc\u30f32: SMTP\u9001\u4fe1",id:"\u30d1\u30bf\u30fc\u30f32-smtp\u9001\u4fe1",level:3},{value:"execution.details\u8a2d\u5b9a",id:"executiondetails\u8a2d\u5b9a",level:4},{value:"\u30d1\u30bf\u30fc\u30f33: HTTP API\u9001\u4fe1",id:"\u30d1\u30bf\u30fc\u30f33-http-api\u9001\u4fe1",level:3},{value:"execution.details\u8a2d\u5b9a",id:"executiondetails\u8a2d\u5b9a-1",level:4},{value:"\u65e7\u8a2d\u5b9a\u65b9\u5f0f\uff08\u5ec3\u6b62\u4e88\u5b9a\uff09",id:"\u65e7\u8a2d\u5b9a\u65b9\u5f0f\u5ec3\u6b62\u4e88\u5b9a",level:2},{value:"2. SMTP\u9001\u4fe1",id:"2-smtp\u9001\u4fe1",level:3},{value:"\u57fa\u672c\u69cb\u9020",id:"\u57fa\u672c\u69cb\u9020-1",level:4},{value:"SMTP\u8a2d\u5b9a",id:"smtp\u8a2d\u5b9a",level:4},{value:"Email\u8a8d\u8a3c\u8a2d\u5b9a",id:"email\u8a8d\u8a3c\u8a2d\u5b9a",level:4},{value:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u8a2d\u5b9a",id:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u8a2d\u5b9a",level:4},{value:"3. HTTP API\u9001\u4fe1",id:"3-http-api\u9001\u4fe1",level:3},{value:"\u57fa\u672c\u69cb\u9020",id:"\u57fa\u672c\u69cb\u9020-2",level:4},{value:"HTTP API\u8a2d\u5b9a",id:"http-api\u8a2d\u5b9a",level:4},{value:"\u5229\u7528\u53ef\u80fd\u306a\u30e1\u30fc\u30eb\u914d\u4fe1\u30b5\u30fc\u30d3\u30b9\u4f8b",id:"\u5229\u7528\u53ef\u80fd\u306a\u30e1\u30fc\u30eb\u914d\u4fe1\u30b5\u30fc\u30d3\u30b9\u4f8b",level:4},{value:"4. \u30c6\u30b9\u30c8\u7528\uff08no-action\uff09",id:"4-\u30c6\u30b9\u30c8\u7528no-action",level:3},{value:"\u5229\u7528\u65b9\u6cd5",id:"\u5229\u7528\u65b9\u6cd5",level:2},{value:"\u4e8b\u524d\u6e96\u5099",id:"\u4e8b\u524d\u6e96\u5099",level:3},{value:"\u8a8d\u8a3c\u30d5\u30ed\u30fc",id:"\u8a8d\u8a3c\u30d5\u30ed\u30fc",level:3},{value:"1. \u30c1\u30e3\u30ec\u30f3\u30b8\u9001\u4fe1\uff08email-authentication-challenge\uff09",id:"1-\u30c1\u30e3\u30ec\u30f3\u30b8\u9001\u4fe1email-authentication-challenge",level:4},{value:"2. \u30b3\u30fc\u30c9\u691c\u8a3c\uff08email-authentication\uff09",id:"2-\u30b3\u30fc\u30c9\u691c\u8a3cemail-authentication",level:4},{value:"\u30a8\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3",id:"\u30a8\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3",level:3},{value:"\u30b3\u30fc\u30c9\u671f\u9650\u5207\u308c",id:"\u30b3\u30fc\u30c9\u671f\u9650\u5207\u308c",level:4},{value:"\u8a66\u884c\u56de\u6570\u4e0a\u9650",id:"\u8a66\u884c\u56de\u6570\u4e0a\u9650",level:4},{value:"\u30b3\u30fc\u30c9\u4e0d\u4e00\u81f4",id:"\u30b3\u30fc\u30c9\u4e0d\u4e00\u81f4",level:4},{value:"\u5b9f\u88c5\u8a73\u7d30",id:"\u5b9f\u88c5\u8a73\u7d30",level:2},{value:"\u4e3b\u8981\u30af\u30e9\u30b9",id:"\u4e3b\u8981\u30af\u30e9\u30b9",level:3},{value:"\u51e6\u7406\u306e\u6d41\u308c",id:"\u51e6\u7406\u306e\u6d41\u308c",level:3},{value:"\u8a2d\u5b9a\u4f8b\u53c2\u7167",id:"\u8a2d\u5b9a\u4f8b\u53c2\u7167",level:3},{value:"\u9001\u4fe1\u65b9\u5f0f\u306e\u6bd4\u8f03",id:"\u9001\u4fe1\u65b9\u5f0f\u306e\u6bd4\u8f03",level:3}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"email\u8a8d\u8a3c",children:"Email\u8a8d\u8a3c"})}),"\n",(0,s.jsxs)(e.p,{children:["\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3001",(0,s.jsx)(e.code,{children:"email-authentication"})," \u65b9\u5f0f\u306b\u3088\u308b\u8a8d\u8a3c\u51e6\u7406\u306e ",(0,s.jsx)(e.code,{children:"\u6982\u8981"}),"\u30fb",(0,s.jsx)(e.code,{children:"\u8a2d\u5b9a"}),"\u30fb",(0,s.jsx)(e.code,{children:"\u5229\u7528\u65b9\u6cd5"})," \u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u6982\u8981",children:"\u6982\u8981"}),"\n",(0,s.jsx)(e.p,{children:"Email\u8a8d\u8a3c\u306f\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306b\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\uff08OTP\uff09\u3092\u9001\u4fe1\u3057\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u672c\u4eba\u78ba\u8a8d\u3092\u884c\u3046\u8a8d\u8a3c\u65b9\u5f0f\u3067\u3059\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"idp-server"})," \u3067\u306fEmail\u8a8d\u8a3c\u6a5f\u80fd\u3092\u4ee5\u4e0b\u306e\u30d1\u30bf\u30fc\u30f3\u3067\u63d0\u4f9b\u3057\u307e\u3059\uff1a"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5916\u90e8Email\u8a8d\u8a3c\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528"}),": \u5916\u90e8API\u30b5\u30fc\u30d3\u30b9\u3067\u30b3\u30fc\u30c9\u751f\u6210\u30fb\u9001\u4fe1\u30fb\u691c\u8a3c\u3092\u884c\u3046"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"SMTP\u9001\u4fe1"}),": idp-server\u3067\u30b3\u30fc\u30c9\u751f\u6210\u30fb\u691c\u8a3c\u3057\u3001SMTP\u3067\u30e1\u30fc\u30eb\u9001\u4fe1"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"HTTP API\u9001\u4fe1"}),": idp-server\u3067\u30b3\u30fc\u30c9\u751f\u6210\u30fb\u691c\u8a3c\u3057\u3001HTTP API\u3067\u30e1\u30fc\u30eb\u9001\u4fe1"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u30c6\u30b9\u30c8\u7528\uff08no-action\uff09"}),": \u5b9f\u969b\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u3092\u884c\u308f\u306a\u3044\u30c6\u30b9\u30c8\u8a2d\u5b9a"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Email\u8a8d\u8a3c\u306f\u4ee5\u4e0b\u306e2\u3064\u306e\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3\u3092\u9023\u7d9a\u7684\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u6210\u7acb\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"email-authentication-challenge"}),": \u8a8d\u8a3c\u7528\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u306e\u751f\u6210\u30fb\u9001\u4fe1"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"email-authentication"}),": \u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u306e\u691c\u8a3c"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u6a5f\u80fd",children:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u6a5f\u80fd"}),"\n",(0,s.jsx)(e.p,{children:"\u30e1\u30fc\u30eb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u306f\u4ee5\u4e0b\u306e\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u304c\u5229\u7528\u53ef\u80fd\u3067\u3059\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"{VERIFICATION_CODE}"}),": \u751f\u6210\u3055\u308c\u305f\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\uff086\u6841\u6570\u5b57\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"{EXPIRE_SECONDS}"}),": \u6709\u52b9\u671f\u9650\uff08\u79d2\u6570\uff09"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u3053\u308c\u3089\u306e\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u306f\u3001SMTP\u9001\u4fe1\u30fbHTTP API\u9001\u4fe1\u30fb\u30c6\u30b9\u30c8\u7528\u8a2d\u5b9a\u306e\u3059\u3079\u3066\u3067\u5171\u901a\u3057\u3066\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002"}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u8a2d\u5b9a",children:"\u8a2d\u5b9a"}),"\n",(0,s.jsxs)(e.p,{children:["Email\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u306b\u306f\u3001\u30c6\u30ca\u30f3\u30c8\u306b ",(0,s.jsx)(e.code,{children:'type = "email"'})," \u306e\u8a8d\u8a3c\u8a2d\u5b9a\u3092\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u672c\u69cb\u9020",children:"\u57fa\u672c\u69cb\u9020"}),"\n",(0,s.jsxs)(e.p,{children:["\u3059\u3079\u3066\u306e\u8a8d\u8a3c\u8a2d\u5b9a\u306f\u3001\u7d71\u4e00\u3055\u308c\u305finteractions\u5f62\u5f0f\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002Email\u8a8d\u8a3c\u3067\u306f",(0,s.jsx)(e.strong,{children:"2\u3064\u306einteraction"}),"\u3092\u5b9a\u7fa9\u3057\u307e\u3059\uff1a"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"email-authentication-challenge"}),": \u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u751f\u6210\u30fb\u9001\u4fe1"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"email-authentication"}),": \u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u691c\u8a3c"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "id": "UUID",\n  "type": "email",\n  "attributes": {},\n  "metadata": {\n    "type": "external",\n    "description": "Email authentication",\n    "transaction_id_param": "transaction_id",\n    "verification_code_param": "verification_code"\n  },\n  "interactions": {\n    "email-authentication-challenge": {\n      "request": { "schema": {...} },\n      "execution": { "function": "email_authentication_challenge", "details": {...} },\n      "response": { "body_mapping_rules": [...] }\n    },\n    "email-authentication": {\n      "request": { "schema": {...} },\n      "execution": { "function": "email_authentication" },\n      "response": { "body_mapping_rules": [...] }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"interaction-1-email-authentication-challenge",children:"Interaction 1: email-authentication-challenge"}),"\n",(0,s.jsx)(e.p,{children:"\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3057\u3001\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308binteraction\u3067\u3059\u3002"}),"\n",(0,s.jsx)(e.h4,{id:"request-schema",children:"Request Schema"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "request": {\n    "schema": {\n      "type": "object",\n      "properties": {\n        "email": { "type": "string" },\n        "template": { "type": "string" }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h4,{id:"execution",children:"Execution"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"function"}),": ",(0,s.jsx)(e.code,{children:"email_authentication_challenge"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"details\u8a2d\u5b9a"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "execution": {\n    "function": "email_authentication_challenge",\n    "details": {\n      "function": "no_action",\n      "sender": "test@gmail.com",\n      "templates": {\n        "registration": {\n          "subject": "[ID Verification] Your signup email confirmation code",\n          "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds."\n        },\n        "authentication": {\n          "subject": "[ID Verification] Your login email confirmation code",\n          "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds."\n        }\n      },\n      "retry_count_limitation": 5,\n      "expire_seconds": 300\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"details.function"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"no_action"}),": \u30c6\u30b9\u30c8\u7528\uff08\u5b9f\u969b\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u306a\u3057\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"smtp"}),": SMTP\u7d4c\u7531\u3067\u30e1\u30fc\u30eb\u9001\u4fe1"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"http_request"}),": HTTP API\u7d4c\u7531\u3067\u30e1\u30fc\u30eb\u9001\u4fe1"]}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"response",children:"Response"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "response": {\n    "body_mapping_rules": [\n      { "from": "$.response_body", "to": "*" }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"interaction-2-email-authentication",children:"Interaction 2: email-authentication"}),"\n",(0,s.jsx)(e.p,{children:"\u9001\u4fe1\u3055\u308c\u305f\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u3092\u691c\u8a3c\u3059\u308binteraction\u3067\u3059\u3002"}),"\n",(0,s.jsx)(e.h4,{id:"request-schema-1",children:"Request Schema"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "request": {\n    "schema": {\n      "type": "object",\n      "properties": {\n        "verification_code": { "type": "string" }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h4,{id:"execution-1",children:"Execution"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"function"}),": ",(0,s.jsx)(e.code,{children:"email_authentication"})]}),"\n",(0,s.jsx)(e.p,{children:"\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u306e\u691c\u8a3c\u3092\u884c\u3044\u307e\u3059\u3002"}),"\n",(0,s.jsx)(e.h4,{id:"response-1",children:"Response"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "response": {\n    "body_mapping_rules": [\n      { "from": "$.response_body", "to": "*" }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8bno-action",children:"\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8b\uff08no-action\uff09"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,s.jsx)(e.code,{children:"config/examples/e2e/test-tenant/authentication-config/email/no-action.json"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "id": "6f5b0255-8faf-42cf-9f24-4f702386993f",\n  "type": "email",\n  "attributes": {},\n  "metadata": {\n    "type": "external",\n    "description": "mocky",\n    "transaction_id_param": "transaction_id",\n    "verification_code_param": "verification_code"\n  },\n  "interactions": {\n    "email-authentication-challenge": {\n      "request": {\n        "schema": {\n          "type": "object",\n          "properties": {\n            "email": { "type": "string" },\n            "template": { "type": "string" }\n          }\n        }\n      },\n      "pre_hook": {},\n      "execution": {\n        "function": "email_authentication_challenge",\n        "details": {\n          "function": "no_action",\n          "sender": "test@gmail.com",\n          "templates": {\n            "registration": {\n              "subject": "[ID Verification] Your signup email confirmation code",\n              "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds.\\n\\nIf you did not request this, please contact your administrator.\\n\\n\u2013 IDP Support"\n            },\n            "authentication": {\n              "subject": "[ID Verification] Your login email confirmation code",\n              "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds.\\n\\nIf you did not request this, please contact your administrator.\\n\\n\u2013 IDP Support"\n            }\n          },\n          "retry_count_limitation": 5,\n          "expire_seconds": 300\n        }\n      },\n      "post_hook": {},\n      "response": {\n        "body_mapping_rules": [\n          { "from": "$.response_body", "to": "*" }\n        ]\n      }\n    },\n    "email-authentication": {\n      "request": {\n        "schema": {\n          "type": "object",\n          "properties": {\n            "verification_code": { "type": "string" }\n          }\n        }\n      },\n      "pre_hook": {},\n      "execution": {\n        "function": "email_authentication"\n      },\n      "post_hook": {},\n      "response": {\n        "body_mapping_rules": [\n          { "from": "$.response_body", "to": "*" }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u8a2d\u5b9a\u30d1\u30bf\u30fc\u30f3\u8a73\u7d30",children:"\u8a2d\u5b9a\u30d1\u30bf\u30fc\u30f3\u8a73\u7d30"}),"\n",(0,s.jsx)(e.h3,{id:"\u30d1\u30bf\u30fc\u30f31-\u30c6\u30b9\u30c8\u7528no-action",children:"\u30d1\u30bf\u30fc\u30f31: \u30c6\u30b9\u30c8\u7528\uff08no-action\uff09"}),"\n",(0,s.jsx)(e.p,{children:"\u5b9f\u969b\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u3092\u884c\u308f\u305a\u3001\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u306e\u307f\u751f\u6210\u3059\u308b\u30c6\u30b9\u30c8\u7528\u8a2d\u5b9a\u3067\u3059\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"execution.details.function"}),": ",(0,s.jsx)(e.code,{children:'"no_action"'})]}),"\n",(0,s.jsx)(e.p,{children:"\u4e0a\u8a18\u306e\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"\u30d1\u30bf\u30fc\u30f32-smtp\u9001\u4fe1",children:"\u30d1\u30bf\u30fc\u30f32: SMTP\u9001\u4fe1"}),"\n",(0,s.jsx)(e.p,{children:"idp-server\u3067\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u3092\u751f\u6210\u30fb\u691c\u8a3c\u3057\u3001SMTP\u3067\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\u3067\u3059\u3002"}),"\n",(0,s.jsx)(e.h4,{id:"executiondetails\u8a2d\u5b9a",children:"execution.details\u8a2d\u5b9a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "execution": {\n    "function": "email_authentication_challenge",\n    "details": {\n      "function": "smtp",\n      "sender": "noreply@example.com",\n      "smtp_config": {\n        "host": "smtp.gmail.com",\n        "port": 587,\n        "username": "your-email@gmail.com",\n        "password": "your-app-password",\n        "auth": true,\n        "starttls_enable": true\n      },\n      "templates": {\n        "registration": {\n          "subject": "[ID Verification] Your signup email confirmation code",\n          "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds."\n        },\n        "authentication": {\n          "subject": "[ID Verification] Your login email confirmation code",\n          "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds."\n        }\n      },\n      "retry_count_limitation": 5,\n      "expire_seconds": 300\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"\u30d1\u30bf\u30fc\u30f33-http-api\u9001\u4fe1",children:"\u30d1\u30bf\u30fc\u30f33: HTTP API\u9001\u4fe1"}),"\n",(0,s.jsx)(e.p,{children:"idp-server\u3067\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u3092\u751f\u6210\u30fb\u691c\u8a3c\u3057\u3001HTTP API\u3067\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\u3067\u3059\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,s.jsx)(e.code,{children:"config/examples/e2e/test-tenant/authentication-config/email/external.json"})]}),"\n",(0,s.jsx)(e.h4,{id:"executiondetails\u8a2d\u5b9a-1",children:"execution.details\u8a2d\u5b9a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "execution": {\n    "function": "email_authentication_challenge",\n    "details": {\n      "function": "http_request",\n      "sender": "noreply@example.com",\n      "http_request_config": {\n        "url": "https://api.sendgrid.com/v3/mail/send",\n        "method": "POST",\n        "auth_type": "bearer",\n        "bearer_token": "your-api-key",\n        "header_mapping_rules": [...],\n        "body_mapping_rules": [...]\n      },\n      "templates": {\n        "registration": { "subject": "...", "body": "..." },\n        "authentication": { "subject": "...", "body": "..." }\n      },\n      "retry_count_limitation": 5,\n      "expire_seconds": 300\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u65e7\u8a2d\u5b9a\u65b9\u5f0f\u5ec3\u6b62\u4e88\u5b9a",children:"\u65e7\u8a2d\u5b9a\u65b9\u5f0f\uff08\u5ec3\u6b62\u4e88\u5b9a\uff09"}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u65b9\u5f0f\u306f\u65e7\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u305f\u69cb\u9020\u3067\u3059\u3002\u65b0\u898f\u5b9f\u88c5\u3067\u306finteractions\u5f62\u5f0f\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"2-smtp\u9001\u4fe1",children:"2. SMTP\u9001\u4fe1"}),"\n",(0,s.jsx)(e.p,{children:"idp-server\u3067\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u3092\u751f\u6210\u30fb\u691c\u8a3c\u3057\u3001SMTP\u3067\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\u3067\u3059\u3002"}),"\n",(0,s.jsx)(e.h4,{id:"\u57fa\u672c\u69cb\u9020-1",children:"\u57fa\u672c\u69cb\u9020"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "id": "\u8a2d\u5b9aID",\n  "type": "email",\n  "payload": {\n    "type": "smtp",\n    "sender": "\u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9",\n    "settings": {\n      "smtp": { /* SMTP\u8a2d\u5b9a */ }\n    },\n    "templates": { /* \u30e1\u30fc\u30eb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 */ },\n    "retry_count_limitation": 5,\n    "expire_seconds": 300\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h4,{id:"smtp\u8a2d\u5b9a",children:"SMTP\u8a2d\u5b9a"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u9805\u76ee"}),(0,s.jsx)(e.th,{children:"\u578b"}),(0,s.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"host"})}),(0,s.jsx)(e.td,{children:"string"}),(0,s.jsxs)(e.td,{children:["SMTP\u30b5\u30fc\u30d0\u30fc\u306e\u30db\u30b9\u30c8\u540d\uff08\u4f8b\uff1a",(0,s.jsx)(e.code,{children:"smtp.gmail.com"}),"\uff09"]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"port"})}),(0,s.jsx)(e.td,{children:"integer"}),(0,s.jsxs)(e.td,{children:["SMTP\u30dd\u30fc\u30c8\u756a\u53f7\uff08\u901a\u5e38\u306f ",(0,s.jsx)(e.code,{children:"587"})," \u307e\u305f\u306f ",(0,s.jsx)(e.code,{children:"465"}),"\uff09"]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"username"})}),(0,s.jsx)(e.td,{children:"string"}),(0,s.jsx)(e.td,{children:"SMTP\u8a8d\u8a3c\u7528\u30e6\u30fc\u30b6\u30fc\u540d"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"password"})}),(0,s.jsx)(e.td,{children:"string"}),(0,s.jsx)(e.td,{children:"SMTP\u8a8d\u8a3c\u7528\u30d1\u30b9\u30ef\u30fc\u30c9"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"auth"})}),(0,s.jsx)(e.td,{children:"boolean"}),(0,s.jsx)(e.td,{children:"SMTP\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u304b\u3069\u3046\u304b"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"starttls.enable"})}),(0,s.jsx)(e.td,{children:"boolean"}),(0,s.jsxs)(e.td,{children:["STARTTLS\u3092\u6709\u52b9\u306b\u3059\u308b\u304b\uff08",(0,s.jsx)(e.code,{children:"true"}),"\u3067\u901a\u4fe1\u304c\u6697\u53f7\u5316\u3055\u308c\u308b\uff09"]})]})]})]}),"\n",(0,s.jsx)(e.h4,{id:"email\u8a8d\u8a3c\u8a2d\u5b9a",children:"Email\u8a8d\u8a3c\u8a2d\u5b9a"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u9805\u76ee"}),(0,s.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"sender"})}),(0,s.jsx)(e.td,{children:"\u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"retry_count_limitation"})}),(0,s.jsx)(e.td,{children:"\u691c\u8a3c\u30ea\u30c8\u30e9\u30a4\u4e0a\u9650\u56de\u6570\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff1a5\uff09"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"expire_seconds"})}),(0,s.jsx)(e.td,{children:"\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\uff08\u79d2\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\uff1a300\uff09"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"templates"})}),(0,s.jsxs)(e.td,{children:["\u30e1\u30fc\u30eb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08",(0,s.jsx)(e.code,{children:"registration"}),"\u3001",(0,s.jsx)(e.code,{children:"authentication"}),"\uff09"]})]})]})]}),"\n",(0,s.jsx)(e.h4,{id:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u8a2d\u5b9a",children:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u8a2d\u5b9a"}),"\n",(0,s.jsxs)(e.p,{children:["\u5404\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u306f ",(0,s.jsx)(e.code,{children:"subject"}),"\uff08\u4ef6\u540d\uff09\u3068 ",(0,s.jsx)(e.code,{children:"body"}),"\uff08\u672c\u6587\uff09\u3092\u8a2d\u5b9a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'"templates": {\n  "registration": {\n    "subject": "[ID Verification] Your signup confirmation code",\n    "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds."\n  },\n  "authentication": {\n    "subject": "[ID Verification] Your login confirmation code",\n    "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds."\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-http-api\u9001\u4fe1",children:"3. HTTP API\u9001\u4fe1"}),"\n",(0,s.jsx)(e.p,{children:"idp-server\u3067\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u3092\u751f\u6210\u30fb\u691c\u8a3c\u3057\u3001HTTP API\u3067\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\u3067\u3059\u3002SendGrid\u3001Mailgun\u7b49\u306e\u30e1\u30fc\u30eb\u914d\u4fe1\u30b5\u30fc\u30d3\u30b9API\u3068\u9023\u643a\u3067\u304d\u307e\u3059\u3002"}),"\n",(0,s.jsx)(e.h4,{id:"\u57fa\u672c\u69cb\u9020-2",children:"\u57fa\u672c\u69cb\u9020"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "id": "\u8a2d\u5b9aID",\n  "type": "email",\n  "payload": {\n    "type": "http_request",\n    "function": "http_request",\n    "sender": "\u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9",\n    "sender_config": {\n      "http_request": { /* HTTP API\u8a2d\u5b9a */ }\n    },\n    "templates": {\n      "registration": {\n        "subject": "[ID Verification] Your signup confirmation code",\n        "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds."\n      },\n      "authentication": {\n        "subject": "[ID Verification] Your login confirmation code", \n        "body": "Hello,\\n\\nPlease enter the following verification code:\\n\\n\u3010{VERIFICATION_CODE}\u3011\\n\\nThis code will expire in {EXPIRE_SECONDS} seconds."\n      }\n    },\n    "retry_count_limitation": 5,\n    "expire_seconds": 300\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u91cd\u8981"}),": HTTP API\u9001\u4fe1\u3067\u3082\u3001idp-server\u5074\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\uff08\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u7f6e\u63db\uff09\u3092\u884c\u3046\u305f\u3081\u3001",(0,s.jsx)(e.code,{children:"templates"}),"\u8a2d\u5b9a\u304c\u5fc5\u9808\u3067\u3059\u3002"]}),"\n",(0,s.jsx)(e.h4,{id:"http-api\u8a2d\u5b9a",children:"HTTP API\u8a2d\u5b9a"}),"\n",(0,s.jsxs)(e.p,{children:["HTTP API\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u3092 ",(0,s.jsx)(e.code,{children:"sender_config.http_request"})," \u3067\u8a2d\u5b9a\u3057\u307e\u3059\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'"sender_config": {\n  "http_request": {\n    "url": "https://api.sendgrid.v3/mail/send",\n    "method": "POST",\n    "headers": {\n      "Authorization": "Bearer ${API_KEY}",\n      "Content-Type": "application/json"\n    },\n    "body_mapping_rules": [\n      {\n        "from": "$.request_body.from",\n        "to": "from.email"\n      },\n      {\n        "from": "$.request_body.to",\n        "to": "personalizations[0].to[0].email"\n      },\n      {\n        "from": "$.request_body.subject", \n        "to": "subject"\n      },\n      {\n        "from": "$.request_body.body",\n        "to": "content[0].value"\n      },\n      {\n        "static_value": "text/plain",\n        "to": "content[0].type"\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u9001\u4fe1\u30c7\u30fc\u30bf\u30d5\u30ed\u30fc"}),":"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["idp-server\u304c ",(0,s.jsx)(e.code,{children:"templates"})," \u3067\u30e1\u30fc\u30eb\u5185\u5bb9\u3092\u751f\u6210\uff08\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u7f6e\u63db\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"EmailSendingRequest"})," \u304c\u4f5c\u6210\u3055\u308c\u3001\u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u304c ",(0,s.jsx)(e.code,{children:"request_body"})," \u3068\u3057\u3066\u5229\u7528\u53ef\u80fd\uff1a","\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "from": "\u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9",\n  "to": "\u5b9b\u5148\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9", \n  "subject": "\u7f6e\u63db\u6e08\u307f\u4ef6\u540d",\n  "body": "\u7f6e\u63db\u6e08\u307f\u672c\u6587"\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"body_mapping_rules"})," \u306b\u3088\u308a\u5916\u90e8API\u5f62\u5f0f\u306b\u30de\u30c3\u30d4\u30f3\u30b0"]}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"\u5229\u7528\u53ef\u80fd\u306a\u30e1\u30fc\u30eb\u914d\u4fe1\u30b5\u30fc\u30d3\u30b9\u4f8b",children:"\u5229\u7528\u53ef\u80fd\u306a\u30e1\u30fc\u30eb\u914d\u4fe1\u30b5\u30fc\u30d3\u30b9\u4f8b"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u30b5\u30fc\u30d3\u30b9"}),(0,s.jsx)(e.th,{children:"API URL"}),(0,s.jsx)(e.th,{children:"\u8a8d\u8a3c\u65b9\u5f0f"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SendGrid"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"https://api.sendgrid.v3/mail/send"})}),(0,s.jsx)(e.td,{children:"Bearer Token"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Mailgun"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"https://api.mailgun.net/v3/{domain}/messages"})}),(0,s.jsx)(e.td,{children:"Basic Auth"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Amazon SES"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"https://email.{region}.amazonaws.com/"})}),(0,s.jsx)(e.td,{children:"AWS Signature"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Postmark"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"https://api.postmarkapp.com/email"})}),(0,s.jsx)(e.td,{children:"X-Postmark-Server-Token"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"4-\u30c6\u30b9\u30c8\u7528no-action",children:"4. \u30c6\u30b9\u30c8\u7528\uff08no-action\uff09"}),"\n",(0,s.jsx)(e.p,{children:"\u5b9f\u969b\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u3092\u884c\u308f\u306a\u3044\u3001\u958b\u767a\u30fb\u30c6\u30b9\u30c8\u7528\u306e\u8a2d\u5b9a\u3067\u3059\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "id": "\u8a2d\u5b9aID",\n  "type": "email",\n  "interactions": {\n    "email-authentication-challenge": {\n      "execution": {\n        "function": "email_authentication_challenge",\n        "details": {\n          "function": "no_action",\n          "sender": "test@example.com",\n          "templates": { /* \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u8a2d\u5b9a */ },\n          "retry_count_limitation": 5,\n          "expire_seconds": 300\n        }\n      }\n    },\n    "email-authentication": {\n      "execution": {\n        "function": "email_authentication"\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u5229\u7528\u65b9\u6cd5",children:"\u5229\u7528\u65b9\u6cd5"}),"\n",(0,s.jsx)(e.h3,{id:"\u4e8b\u524d\u6e96\u5099",children:"\u4e8b\u524d\u6e96\u5099"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\u30c6\u30ca\u30f3\u30c8\u306b ",(0,s.jsx)(e.code,{children:'type = "email"'})," \u306e\u8a2d\u5b9a\uff08",(0,s.jsx)(e.code,{children:"AuthenticationConfiguration"}),"\uff09\u3092\u767b\u9332\u3059\u308b"]}),"\n",(0,s.jsx)(e.li,{children:"\u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\u3067Email\u8a8d\u8a3c\u3092\u6709\u52b9\u5316\u3059\u308b"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u8a8d\u8a3c\u30d5\u30ed\u30fc",children:"\u8a8d\u8a3c\u30d5\u30ed\u30fc"}),"\n",(0,s.jsx)(e.p,{children:"Email\u8a8d\u8a3c\u306f\u4ee5\u4e0b\u306e2\u6bb5\u968e\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(e.h4,{id:"1-\u30c1\u30e3\u30ec\u30f3\u30b8\u9001\u4fe1email-authentication-challenge",children:"1. \u30c1\u30e3\u30ec\u30f3\u30b8\u9001\u4fe1\uff08email-authentication-challenge\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-http",children:'POST /v1/authorizations/{authorization_id}/email-authentication-challenge\nContent-Type: application/json\n\n{\n  "email": "user@example.com",\n  "template": "authentication"\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9\u4f8b\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "status": "challenge_sent",\n  "message": "Verification code has been sent to your email"\n}\n'})}),"\n",(0,s.jsx)(e.h4,{id:"2-\u30b3\u30fc\u30c9\u691c\u8a3cemail-authentication",children:"2. \u30b3\u30fc\u30c9\u691c\u8a3c\uff08email-authentication\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-http",children:'POST /v1/authorizations/{authorization_id}/email-authentication\nContent-Type: application/json\n\n{\n  "verification_code": "123456"\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9\u4f8b\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "status": "success",\n  "user": {\n    "sub": "user-id",\n    "email_verified": true\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u30a8\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3",children:"\u30a8\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,s.jsx)(e.h4,{id:"\u30b3\u30fc\u30c9\u671f\u9650\u5207\u308c",children:"\u30b3\u30fc\u30c9\u671f\u9650\u5207\u308c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "error": "invalid_request",\n  "error_description": "email challenge is expired"\n}\n'})}),"\n",(0,s.jsx)(e.h4,{id:"\u8a66\u884c\u56de\u6570\u4e0a\u9650",children:"\u8a66\u884c\u56de\u6570\u4e0a\u9650"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "error": "invalid_request", \n  "error_description": "email challenge is reached limited to 5 attempts"\n}\n'})}),"\n",(0,s.jsx)(e.h4,{id:"\u30b3\u30fc\u30c9\u4e0d\u4e00\u81f4",children:"\u30b3\u30fc\u30c9\u4e0d\u4e00\u81f4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "error": "invalid_request",\n  "error_description": "Invalid verification code"\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u5b9f\u88c5\u8a73\u7d30",children:"\u5b9f\u88c5\u8a73\u7d30"}),"\n",(0,s.jsx)(e.h3,{id:"\u4e3b\u8981\u30af\u30e9\u30b9",children:"\u4e3b\u8981\u30af\u30e9\u30b9"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u30af\u30e9\u30b9\u540d"}),(0,s.jsx)(e.th,{children:"\u5f79\u5272"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"EmailAuthenticationInteractor"})}),(0,s.jsxs)(e.td,{children:["Email\u8a8d\u8a3c\u306e\u30e1\u30a4\u30f3\u30ed\u30b8\u30c3\u30af\uff08",(0,s.jsx)(e.code,{children:"libs/idp-server-authentication-interactors"}),")"]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"EmailAuthenticationExecutor"})}),(0,s.jsx)(e.td,{children:"\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u691c\u8a3c\u51e6\u7406"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"EmailVerificationChallenge"})}),(0,s.jsx)(e.td,{children:"\u30c1\u30e3\u30ec\u30f3\u30b8\u60c5\u5831\u306e\u7ba1\u7406\uff08\u30b3\u30fc\u30c9\u3001\u6709\u52b9\u671f\u9650\u3001\u8a66\u884c\u56de\u6570\uff09"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"EmailAuthenticationConfiguration"})}),(0,s.jsx)(e.td,{children:"Email\u8a8d\u8a3c\u8a2d\u5b9a\u306e\u7ba1\u7406"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"\u51e6\u7406\u306e\u6d41\u308c",children:"\u51e6\u7406\u306e\u6d41\u308c"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u30c1\u30e3\u30ec\u30f3\u30b8\u9001\u4fe1\u6642"}),"\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u30ef\u30f3\u30bf\u30a4\u30e0\u30b3\u30fc\u30c9\u751f\u6210\uff086\u6841\u6570\u5b57\uff09"}),"\n",(0,s.jsx)(e.li,{children:"\u6709\u52b9\u671f\u9650\u30fb\u8a66\u884c\u56de\u6570\u5236\u9650\u306e\u8a2d\u5b9a"}),"\n",(0,s.jsx)(e.li,{children:"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u57fa\u3065\u304f\u30e1\u30fc\u30eb\u9001\u4fe1"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u30b3\u30fc\u30c9\u691c\u8a3c\u6642"}),"\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u6709\u52b9\u671f\u9650\u30c1\u30a7\u30c3\u30af"}),"\n",(0,s.jsx)(e.li,{children:"\u8a66\u884c\u56de\u6570\u30c1\u30a7\u30c3\u30af"}),"\n",(0,s.jsx)(e.li,{children:"\u30b3\u30fc\u30c9\u7167\u5408"}),"\n",(0,s.jsxs)(e.li,{children:["\u30e6\u30fc\u30b6\u30fc\u306e ",(0,s.jsx)(e.code,{children:"email_verified"})," \u30d5\u30e9\u30b0\u3092 ",(0,s.jsx)(e.code,{children:"true"})," \u306b\u66f4\u65b0"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u8a2d\u5b9a\u4f8b\u53c2\u7167",children:"\u8a2d\u5b9a\u4f8b\u53c2\u7167"}),"\n",(0,s.jsx)(e.p,{children:"\u5b9f\u969b\u306e\u8a2d\u5b9a\u4f8b\u306f\u4ee5\u4e0b\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"config-sample/*/authentication-config/email/smtp.json"})," - SMTP\u8a2d\u5b9a"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"config-sample/*/authentication-config/email/external.json"})," - \u5916\u90e8API\u8a2d\u5b9a\uff08http_request\u4f7f\u7528\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"config-sample/*/authentication-config/email/no-action.json"})," - \u30c6\u30b9\u30c8\u8a2d\u5b9a"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u9001\u4fe1\u65b9\u5f0f\u306e\u6bd4\u8f03",children:"\u9001\u4fe1\u65b9\u5f0f\u306e\u6bd4\u8f03"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u9001\u4fe1\u65b9\u5f0f"}),(0,s.jsx)(e.th,{children:"\u8a2d\u5b9a\u306e\u8907\u96d1\u3055"}),(0,s.jsx)(e.th,{children:"\u62e1\u5f35\u6027"}),(0,s.jsx)(e.th,{children:"\u63a8\u5968\u7528\u9014"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\u5916\u90e8API\uff08http_request\uff09"})}),(0,s.jsx)(e.td,{children:"\u2605\u2605\u2605"}),(0,s.jsx)(e.td,{children:"\u2605\u2605\u2605"}),(0,s.jsx)(e.td,{children:"\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u5b8c\u5168\u59d4\u8b72\u3001\u9ad8\u5ea6\u306a\u30ab\u30b9\u30bf\u30de\u30a4\u30ba"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"SMTP"})}),(0,s.jsx)(e.td,{children:"\u2605\u2605"}),(0,s.jsx)(e.td,{children:"\u2605\u2605"}),(0,s.jsx)(e.td,{children:"\u65e2\u5b58SMTP\u30b5\u30fc\u30d0\u30fc\u6d3b\u7528\u3001\u30b7\u30f3\u30d7\u30eb\u69cb\u6210"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"HTTP API"})}),(0,s.jsx)(e.td,{children:"\u2605\u2605"}),(0,s.jsx)(e.td,{children:"\u2605\u2605\u2605"}),(0,s.jsx)(e.td,{children:"\u30af\u30e9\u30a6\u30c9\u30e1\u30fc\u30eb\u914d\u4fe1\u30b5\u30fc\u30d3\u30b9\u6d3b\u7528"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"no-action"})}),(0,s.jsx)(e.td,{children:"\u2605"}),(0,s.jsx)(e.td,{children:"\u2605"}),(0,s.jsx)(e.td,{children:"\u958b\u767a\u30fb\u30c6\u30b9\u30c8\u74b0\u5883"})]})]})]})]})}function h(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>c,x:()=>r});var t=i(96540);const s={},l=t.createContext(s);function c(n){const e=t.useContext(l);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),t.createElement(l.Provider,{value:e},n.children)}}}]);