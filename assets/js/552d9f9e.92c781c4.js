"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[15348],{31036:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>t,toc:()=>s});const t=JSON.parse('{"id":"content_11_learning/java/java-08-concurrency","title":"Java \u4e26\u884c\u51e6\u7406","description":"Java\u306e\u4e26\u884c\u51e6\u7406\u306e\u57fa\u790e\u3092\u5b66\u3073\u307e\u3059\u3002","source":"@site/docs/content_11_learning/25-java/java-08-concurrency.md","sourceDirName":"content_11_learning/25-java","slug":"/content_11_learning/java/java-08-concurrency","permalink":"/idp-server/docs/content_11_learning/java/java-08-concurrency","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/25-java/java-08-concurrency.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Java \u30e9\u30e0\u30c0\u5f0f","permalink":"/idp-server/docs/content_11_learning/java/java-07-lambda"},"next":{"title":"Java Records","permalink":"/idp-server/docs/content_11_learning/java/java-09-records"}}');var a=r(74848),l=r(28453);const c={},i="Java \u4e26\u884c\u51e6\u7406",d={},s=[{value:"\u306a\u305c\u4e26\u884c\u51e6\u7406\u304b",id:"\u306a\u305c\u4e26\u884c\u51e6\u7406\u304b",level:2},{value:"Thread \u306e\u57fa\u790e",id:"thread-\u306e\u57fa\u790e",level:2},{value:"Thread \u306e\u4f5c\u6210",id:"thread-\u306e\u4f5c\u6210",level:3},{value:"Thread \u306e\u5236\u5fa1",id:"thread-\u306e\u5236\u5fa1",level:3},{value:"Thread \u306e\u72b6\u614b",id:"thread-\u306e\u72b6\u614b",level:3},{value:"\u540c\u671f\u5316",id:"\u540c\u671f\u5316",level:2},{value:"synchronized",id:"synchronized",level:3},{value:"volatile",id:"volatile",level:3},{value:"Atomic \u30af\u30e9\u30b9",id:"atomic-\u30af\u30e9\u30b9",level:2},{value:"ExecutorService",id:"executorservice",level:2},{value:"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9",id:"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9",level:3},{value:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u306e\u7a2e\u985e",id:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u306e\u7a2e\u985e",level:3},{value:"Virtual Threads\uff08Java 21+\uff09",id:"virtual-threadsjava-21",level:3},{value:"Future \u3068 CompletableFuture",id:"future-\u3068-completablefuture",level:2},{value:"Future",id:"future",level:3},{value:"CompletableFuture",id:"completablefuture",level:3},{value:"\u8907\u6570\u306e CompletableFuture",id:"\u8907\u6570\u306e-completablefuture",level:3},{value:"\u975e\u540c\u671f\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3",id:"\u975e\u540c\u671f\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3",level:3},{value:"Locks",id:"locks",level:2},{value:"ReentrantLock",id:"reentrantlock",level:3},{value:"ReadWriteLock",id:"readwritelock",level:3},{value:"StampedLock\uff08Java 8+\uff09",id:"stampedlockjava-8",level:3},{value:"\u540c\u671f\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3",id:"\u540c\u671f\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3",level:2},{value:"CountDownLatch",id:"countdownlatch",level:3},{value:"CyclicBarrier",id:"cyclicbarrier",level:3},{value:"Semaphore",id:"semaphore",level:3},{value:"Concurrent \u30b3\u30ec\u30af\u30b7\u30e7\u30f3",id:"concurrent-\u30b3\u30ec\u30af\u30b7\u30e7\u30f3",level:2},{value:"ConcurrentHashMap",id:"concurrenthashmap",level:3},{value:"BlockingQueue",id:"blockingqueue",level:3},{value:"CopyOnWriteArrayList",id:"copyonwritearraylist",level:3},{value:"\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u56de\u907f",id:"\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u56de\u907f",level:2},{value:"\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u4f8b",id:"\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u4f8b",level:3},{value:"\u56de\u907f\u7b56",id:"\u56de\u907f\u7b56",level:3},{value:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:2},{value:"1. \u4e0d\u5909\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3046",id:"1-\u4e0d\u5909\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3046",level:3},{value:"2. \u30ed\u30c3\u30af\u306e\u7bc4\u56f2\u3092\u6700\u5c0f\u5316",id:"2-\u30ed\u30c3\u30af\u306e\u7bc4\u56f2\u3092\u6700\u5c0f\u5316",level:3},{value:"3. ExecutorService \u3092\u4f7f\u3046\uff08Thread \u3092\u76f4\u63a5\u4f7f\u308f\u306a\u3044\uff09",id:"3-executorservice-\u3092\u4f7f\u3046thread-\u3092\u76f4\u63a5\u4f7f\u308f\u306a\u3044",level:3},{value:"4. try-finally \u3067\u30ed\u30c3\u30af\u89e3\u653e\u3092\u4fdd\u8a3c",id:"4-try-finally-\u3067\u30ed\u30c3\u30af\u89e3\u653e\u3092\u4fdd\u8a3c",level:3},{value:"\u307e\u3068\u3081",id:"\u307e\u3068\u3081",level:2},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"java-\u4e26\u884c\u51e6\u7406",children:"Java \u4e26\u884c\u51e6\u7406"})}),"\n",(0,a.jsx)(n.p,{children:"Java\u306e\u4e26\u884c\u51e6\u7406\u306e\u57fa\u790e\u3092\u5b66\u3073\u307e\u3059\u3002"}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\u306a\u305c\u4e26\u884c\u51e6\u7406\u304b",children:"\u306a\u305c\u4e26\u884c\u51e6\u7406\u304b"}),"\n",(0,a.jsx)(n.p,{children:"\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u3067\u306f\u3001\u91cd\u3044\u51e6\u7406\u4e2d\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u56fa\u307e\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// \u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9: \u91cd\u3044\u51e6\u7406\u4e2d\u306f\u4f55\u3082\u3067\u304d\u306a\u3044\nString data = fetchFromNetwork();  // 3\u79d2\u304b\u304b\u308b\nupdateUI(data);  // \u305d\u306e\u9593UI\u306f\u56fa\u307e\u308b\n\n// \u30de\u30eb\u30c1\u30b9\u30ec\u30c3\u30c9: \u4e26\u884c\u3057\u3066\u51e6\u7406\nexecutor.submit(() -> {\n    String data = fetchFromNetwork();\n    runOnUiThread(() -> updateUI(data));\n});\n// UI\u306f\u5fdc\u7b54\u3057\u7d9a\u3051\u308b\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u4e26\u884c\u51e6\u7406\u3092\u4f7f\u3046\u3068\u3001\u8907\u6570\u306e\u30bf\u30b9\u30af\u3092\u540c\u6642\u306b\u5b9f\u884c\u3067\u304d\u3001CPU\u30b3\u30a2\u3092\u6709\u52b9\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30c7\u30fc\u30bf\u7af6\u5408\u3084\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306a\u3069\u3001\u65b0\u305f\u306a\u554f\u984c\u306b\u3082\u5bfe\u51e6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"thread-\u306e\u57fa\u790e",children:"Thread \u306e\u57fa\u790e"}),"\n",(0,a.jsx)(n.h3,{id:"thread-\u306e\u4f5c\u6210",children:"Thread \u306e\u4f5c\u6210"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u65b9\u6cd51: Runnable\u3092\u6e21\u3059\uff08\u63a8\u5968\uff09\nThread thread = new Thread(() -> {\n    System.out.println("Running in: " + Thread.currentThread().getName());\n});\nthread.start();\n\n// \u65b9\u6cd52: Thread\u3092\u7d99\u627f\uff08\u975e\u63a8\u5968\uff09\nclass MyThread extends Thread {\n    @Override\n    public void run() {\n        System.out.println("Running");\n    }\n}\nnew MyThread().start();\n'})}),"\n",(0,a.jsx)(n.h3,{id:"thread-\u306e\u5236\u5fa1",children:"Thread \u306e\u5236\u5fa1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'Thread thread = new Thread(() -> {\n    try {\n        Thread.sleep(1000);  // 1\u79d2\u30b9\u30ea\u30fc\u30d7\n        System.out.println("Done");\n    } catch (InterruptedException e) {\n        Thread.currentThread().interrupt();\n    }\n});\n\nthread.start();\nthread.join();  // \u30b9\u30ec\u30c3\u30c9\u306e\u7d42\u4e86\u3092\u5f85\u3064\nthread.join(5000);  // \u6700\u59275\u79d2\u5f85\u3064\n\n// \u5272\u308a\u8fbc\u307f\nthread.interrupt();\nboolean interrupted = Thread.interrupted();  // \u5272\u308a\u8fbc\u307f\u30d5\u30e9\u30b0\u3092\u30af\u30ea\u30a2\u3057\u3066\u53d6\u5f97\nboolean isInterrupted = thread.isInterrupted();  // \u30d5\u30e9\u30b0\u3092\u53d6\u5f97\uff08\u30af\u30ea\u30a2\u3057\u306a\u3044\uff09\n'})}),"\n",(0,a.jsx)(n.h3,{id:"thread-\u306e\u72b6\u614b",children:"Thread \u306e\u72b6\u614b"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"NEW \u2192 RUNNABLE \u2192 (BLOCKED | WAITING | TIMED_WAITING) \u2192 TERMINATED\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"Thread.State state = thread.getState();\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\u540c\u671f\u5316",children:"\u540c\u671f\u5316"}),"\n",(0,a.jsx)(n.h3,{id:"synchronized",children:"synchronized"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public class Counter {\n    private int count = 0;\n\n    // \u30e1\u30bd\u30c3\u30c9\u5168\u4f53\u3092\u540c\u671f\u5316\n    public synchronized void increment() {\n        count++;\n    }\n\n    public synchronized int getCount() {\n        return count;\n    }\n}\n\n// \u30d6\u30ed\u30c3\u30af\u5358\u4f4d\u306e\u540c\u671f\u5316\npublic class Counter {\n    private final Object lock = new Object();\n    private int count = 0;\n\n    public void increment() {\n        synchronized (lock) {\n            count++;\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"volatile",children:"volatile"}),"\n",(0,a.jsx)(n.p,{children:"\u53ef\u8996\u6027\u3092\u4fdd\u8a3c\uff08\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4ecb\u3055\u305a\u76f4\u63a5\u30e1\u30e2\u30ea\u30a2\u30af\u30bb\u30b9\uff09\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public class Flag {\n    private volatile boolean running = true;\n\n    public void stop() {\n        running = false;  // \u4ed6\u306e\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u5373\u5ea7\u306b\u898b\u3048\u308b\n    }\n\n    public void run() {\n        while (running) {\n            // ...\n        }\n    }\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u6ce8\u610f"}),": volatile \u306f\u53ef\u8996\u6027\u306e\u307f\u3002\u539f\u5b50\u6027\u306f\u4fdd\u8a3c\u3057\u306a\u3044\uff08",(0,a.jsx)(n.code,{children:"count++"})," \u306f\u975e\u539f\u5b50\u7684\uff09\u3002"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"atomic-\u30af\u30e9\u30b9",children:"Atomic \u30af\u30e9\u30b9"}),"\n",(0,a.jsx)(n.p,{children:"\u539f\u5b50\u7684\u306a\u64cd\u4f5c\u3092\u63d0\u4f9b\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"AtomicInteger counter = new AtomicInteger(0);\n\ncounter.incrementAndGet();  // ++counter\ncounter.getAndIncrement();  // counter++\ncounter.addAndGet(5);       // counter += 5\ncounter.compareAndSet(expected, newValue);  // CAS\u64cd\u4f5c\n\n// \u8907\u96d1\u306a\u66f4\u65b0\ncounter.updateAndGet(current -> current * 2);\ncounter.accumulateAndGet(5, (current, delta) -> current + delta);\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"AtomicReference<User> userRef = new AtomicReference<>(initialUser);\nuserRef.set(newUser);\nUser current = userRef.get();\nuserRef.compareAndSet(expectedUser, newUser);\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"executorservice",children:"ExecutorService"}),"\n",(0,a.jsx)(n.p,{children:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u3092\u7ba1\u7406\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9",children:"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u56fa\u5b9a\u30b5\u30a4\u30ba\u306e\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\nExecutorService executor = Executors.newFixedThreadPool(4);\n\n// \u30bf\u30b9\u30af\u306e\u6295\u5165\nexecutor.execute(() -> {\n    System.out.println("Task executed");\n});\n\n// \u7d50\u679c\u3092\u53d6\u5f97\u3059\u308b\u30bf\u30b9\u30af\nFuture<String> future = executor.submit(() -> {\n    Thread.sleep(1000);\n    return "Result";\n});\n\nString result = future.get();  // \u30d6\u30ed\u30c3\u30af\u3057\u3066\u7d50\u679c\u3092\u5f85\u3064\nString result2 = future.get(5, TimeUnit.SECONDS);  // \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u4ed8\u304d\n\n// \u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\nexecutor.shutdown();  // \u65b0\u898f\u30bf\u30b9\u30af\u3092\u53d7\u3051\u4ed8\u3051\u306a\u3044\nexecutor.awaitTermination(60, TimeUnit.SECONDS);  // \u7d42\u4e86\u3092\u5f85\u3064\nexecutor.shutdownNow();  // \u5b9f\u884c\u4e2d\u306e\u30bf\u30b9\u30af\u3082\u4e2d\u65ad\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u306e\u7a2e\u985e",children:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u306e\u7a2e\u985e"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u56fa\u5b9a\u30b5\u30a4\u30ba\nExecutorService fixed = Executors.newFixedThreadPool(4);\n\n// \u30ad\u30e3\u30c3\u30b7\u30e5\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30b9\u30ec\u30c3\u30c9\u3092\u4f5c\u6210\u30fb\u518d\u5229\u7528\uff09\nExecutorService cached = Executors.newCachedThreadPool();\n\n// \u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\nExecutorService single = Executors.newSingleThreadExecutor();\n\n// \u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5b9f\u884c\nScheduledExecutorService scheduled = Executors.newScheduledThreadPool(2);\nscheduled.schedule(() -> System.out.println("Delayed"), 5, TimeUnit.SECONDS);\nscheduled.scheduleAtFixedRate(() -> System.out.println("Periodic"), 0, 1, TimeUnit.SECONDS);\n\n// \u30ab\u30b9\u30bf\u30e0\nThreadPoolExecutor custom = new ThreadPoolExecutor(\n    2,                      // \u30b3\u30a2\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\n    10,                     // \u6700\u5927\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\n    60, TimeUnit.SECONDS,   // \u30a2\u30a4\u30c9\u30eb\u30b9\u30ec\u30c3\u30c9\u306e\u751f\u5b58\u6642\u9593\n    new LinkedBlockingQueue<>(100)  // \u30bf\u30b9\u30af\u30ad\u30e5\u30fc\n);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"virtual-threadsjava-21",children:"Virtual Threads\uff08Java 21+\uff09"}),"\n",(0,a.jsx)(n.p,{children:"\u8efd\u91cf\u306a\u4eee\u60f3\u30b9\u30ec\u30c3\u30c9\u3002\u5927\u91cf\u306e\u4e26\u884c\u30bf\u30b9\u30af\u306b\u9069\u3059\u308b\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Virtual Thread \u30921\u3064\u4f5c\u6210\nThread vThread = Thread.startVirtualThread(() -> {\n    System.out.println("Running in virtual thread");\n});\n\n// Virtual Thread \u7528\u306e ExecutorService\ntry (ExecutorService executor = Executors.newVirtualThreadPerTaskExecutor()) {\n    for (int i = 0; i < 10000; i++) {\n        executor.submit(() -> {\n            // \u5404\u30bf\u30b9\u30af\u304c\u72ec\u81ea\u306e\u4eee\u60f3\u30b9\u30ec\u30c3\u30c9\u3067\u5b9f\u884c\n            Thread.sleep(1000);\n            return "Done";\n        });\n    }\n}  // \u81ea\u52d5\u7684\u306b\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\n\n// Thread.Builder\nThread.ofVirtual()\n    .name("my-virtual-thread")\n    .start(() -> System.out.println("Running"));\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"future-\u3068-completablefuture",children:"Future \u3068 CompletableFuture"}),"\n",(0,a.jsx)(n.h3,{id:"future",children:"Future"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"ExecutorService executor = Executors.newFixedThreadPool(4);\n\nFuture<Integer> future = executor.submit(() -> {\n    Thread.sleep(1000);\n    return 42;\n});\n\n// \u5b8c\u4e86\u78ba\u8a8d\nboolean isDone = future.isDone();\nboolean isCancelled = future.isCancelled();\n\n// \u7d50\u679c\u53d6\u5f97\uff08\u30d6\u30ed\u30c3\u30ad\u30f3\u30b0\uff09\nInteger result = future.get();\nInteger resultWithTimeout = future.get(5, TimeUnit.SECONDS);\n\n// \u30ad\u30e3\u30f3\u30bb\u30eb\nfuture.cancel(true);  // true = \u5b9f\u884c\u4e2d\u3067\u3082\u5272\u308a\u8fbc\u307f\n"})}),"\n",(0,a.jsx)(n.h3,{id:"completablefuture",children:"CompletableFuture"}),"\n",(0,a.jsx)(n.p,{children:"\u975e\u540c\u671f\u51e6\u7406\u3092\u5408\u6210\u53ef\u80fd\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u975e\u540c\u671f\u5b9f\u884c\nCompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {\n    return fetchData();\n});\n\n// \u5909\u63db\nCompletableFuture<Integer> lengthFuture = future\n    .thenApply(String::length);\n\n// \u526f\u4f5c\u7528\nfuture.thenAccept(System.out::println);\n\n// \u30c1\u30a7\u30fc\u30f3\nCompletableFuture<String> chain = CompletableFuture\n    .supplyAsync(() -> fetchUserId())\n    .thenApply(id -> fetchUserName(id))\n    .thenApply(name -> "Hello, " + name);\n\n// \u4f8b\u5916\u51e6\u7406\nCompletableFuture<String> handled = future\n    .exceptionally(ex -> "Error: " + ex.getMessage());\n\nCompletableFuture<String> handled2 = future\n    .handle((result, ex) -> {\n        if (ex != null) {\n            return "Error: " + ex.getMessage();\n        }\n        return result;\n    });\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u8907\u6570\u306e-completablefuture",children:"\u8907\u6570\u306e CompletableFuture"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'CompletableFuture<String> f1 = CompletableFuture.supplyAsync(() -> "Result1");\nCompletableFuture<String> f2 = CompletableFuture.supplyAsync(() -> "Result2");\nCompletableFuture<String> f3 = CompletableFuture.supplyAsync(() -> "Result3");\n\n// \u4e21\u65b9\u5b8c\u4e86\u3092\u5f85\u3064\nCompletableFuture<Void> both = f1.thenAcceptBoth(f2, (r1, r2) -> {\n    System.out.println(r1 + ", " + r2);\n});\n\n// \u7d50\u679c\u3092\u7d50\u5408\nCompletableFuture<String> combined = f1.thenCombine(f2, (r1, r2) -> r1 + r2);\n\n// \u3059\u3079\u3066\u5b8c\u4e86\u3092\u5f85\u3064\nCompletableFuture<Void> all = CompletableFuture.allOf(f1, f2, f3);\nall.thenRun(() -> {\n    String r1 = f1.join();\n    String r2 = f2.join();\n    String r3 = f3.join();\n});\n\n// \u3044\u305a\u308c\u304b\u5b8c\u4e86\nCompletableFuture<Object> any = CompletableFuture.anyOf(f1, f2, f3);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u975e\u540c\u671f\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3",children:"\u975e\u540c\u671f\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'CompletableFuture<String> result = CompletableFuture\n    .supplyAsync(() -> fetchUserId())           // IO\u64cd\u4f5c\n    .thenApplyAsync(id -> fetchUserDetails(id)) // \u5225\u306e\u975e\u540c\u671f\u64cd\u4f5c\n    .thenApplyAsync(details -> formatUser(details))\n    .exceptionally(ex -> {\n        log.error("Failed", ex);\n        return "Unknown User";\n    });\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"locks",children:"Locks"}),"\n",(0,a.jsx)(n.p,{children:"\u3088\u308a\u67d4\u8edf\u306a\u30ed\u30c3\u30af\u6a5f\u69cb\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"reentrantlock",children:"ReentrantLock"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"private final ReentrantLock lock = new ReentrantLock();\n\npublic void doSomething() {\n    lock.lock();\n    try {\n        // \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30bb\u30af\u30b7\u30e7\u30f3\n    } finally {\n        lock.unlock();\n    }\n}\n\n// tryLock\uff08\u30ce\u30f3\u30d6\u30ed\u30c3\u30ad\u30f3\u30b0\uff09\nif (lock.tryLock()) {\n    try {\n        // ...\n    } finally {\n        lock.unlock();\n    }\n} else {\n    // \u30ed\u30c3\u30af\u53d6\u5f97\u5931\u6557\n}\n\n// \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u4ed8\u304d\nif (lock.tryLock(5, TimeUnit.SECONDS)) {\n    try {\n        // ...\n    } finally {\n        lock.unlock();\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"readwritelock",children:"ReadWriteLock"}),"\n",(0,a.jsx)(n.p,{children:"\u8aad\u307f\u53d6\u308a\u306f\u4e26\u884c\u53ef\u3001\u66f8\u304d\u8fbc\u307f\u306f\u6392\u4ed6\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"private final ReadWriteLock rwLock = new ReentrantReadWriteLock();\nprivate final Lock readLock = rwLock.readLock();\nprivate final Lock writeLock = rwLock.writeLock();\n\npublic String read() {\n    readLock.lock();\n    try {\n        return data;\n    } finally {\n        readLock.unlock();\n    }\n}\n\npublic void write(String newData) {\n    writeLock.lock();\n    try {\n        data = newData;\n    } finally {\n        writeLock.unlock();\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"stampedlockjava-8",children:"StampedLock\uff08Java 8+\uff09"}),"\n",(0,a.jsx)(n.p,{children:"\u697d\u89b3\u7684\u8aad\u307f\u53d6\u308a\u3092\u30b5\u30dd\u30fc\u30c8\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"private final StampedLock lock = new StampedLock();\nprivate double x, y;\n\n// \u697d\u89b3\u7684\u8aad\u307f\u53d6\u308a\npublic double distanceFromOrigin() {\n    long stamp = lock.tryOptimisticRead();\n    double currentX = x, currentY = y;\n    if (!lock.validate(stamp)) {\n        // \u697d\u89b3\u7684\u8aad\u307f\u53d6\u308a\u5931\u6557\u3001\u60b2\u89b3\u7684\u306b\u518d\u53d6\u5f97\n        stamp = lock.readLock();\n        try {\n            currentX = x;\n            currentY = y;\n        } finally {\n            lock.unlockRead(stamp);\n        }\n    }\n    return Math.sqrt(currentX * currentX + currentY * currentY);\n}\n\n// \u66f8\u304d\u8fbc\u307f\npublic void move(double deltaX, double deltaY) {\n    long stamp = lock.writeLock();\n    try {\n        x += deltaX;\n        y += deltaY;\n    } finally {\n        lock.unlockWrite(stamp);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\u540c\u671f\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3",children:"\u540c\u671f\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3"}),"\n",(0,a.jsx)(n.h3,{id:"countdownlatch",children:"CountDownLatch"}),"\n",(0,a.jsx)(n.p,{children:"\u30ab\u30a6\u30f3\u30c8\u304c0\u306b\u306a\u308b\u307e\u3067\u5f85\u6a5f\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'CountDownLatch latch = new CountDownLatch(3);\n\n// \u30ef\u30fc\u30ab\u30fc\u30b9\u30ec\u30c3\u30c9\nfor (int i = 0; i < 3; i++) {\n    executor.submit(() -> {\n        try {\n            doWork();\n        } finally {\n            latch.countDown();  // \u30ab\u30a6\u30f3\u30c8\u3092\u6e1b\u3089\u3059\n        }\n    });\n}\n\n// \u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\nlatch.await();  // \u30ab\u30a6\u30f3\u30c8\u304c0\u306b\u306a\u308b\u307e\u3067\u5f85\u6a5f\nSystem.out.println("All workers completed");\n'})}),"\n",(0,a.jsx)(n.h3,{id:"cyclicbarrier",children:"CyclicBarrier"}),"\n",(0,a.jsx)(n.p,{children:"\u5168\u30b9\u30ec\u30c3\u30c9\u304c\u5230\u9054\u3059\u308b\u307e\u3067\u5f85\u6a5f\uff08\u7e70\u308a\u8fd4\u3057\u4f7f\u7528\u53ef\u80fd\uff09\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'CyclicBarrier barrier = new CyclicBarrier(3, () -> {\n    System.out.println("All threads reached barrier");\n});\n\nfor (int i = 0; i < 3; i++) {\n    executor.submit(() -> {\n        doPhase1();\n        barrier.await();  // \u5168\u54e1\u304c\u5230\u9054\u3059\u308b\u307e\u3067\u5f85\u6a5f\n        doPhase2();\n        barrier.await();  // \u518d\u5229\u7528\u53ef\u80fd\n        doPhase3();\n    });\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"semaphore",children:"Semaphore"}),"\n",(0,a.jsx)(n.p,{children:"\u540c\u6642\u30a2\u30af\u30bb\u30b9\u6570\u3092\u5236\u9650\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"Semaphore semaphore = new Semaphore(3);  // \u6700\u59273\u3064\u306e\u8a31\u53ef\n\npublic void accessResource() {\n    try {\n        semaphore.acquire();  // \u8a31\u53ef\u3092\u53d6\u5f97\uff08\u30d6\u30ed\u30c3\u30ad\u30f3\u30b0\uff09\n        // \u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\n    } finally {\n        semaphore.release();  // \u8a31\u53ef\u3092\u89e3\u653e\n    }\n}\n\n// tryAcquire\uff08\u30ce\u30f3\u30d6\u30ed\u30c3\u30ad\u30f3\u30b0\uff09\nif (semaphore.tryAcquire(5, TimeUnit.SECONDS)) {\n    try {\n        // ...\n    } finally {\n        semaphore.release();\n    }\n}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"concurrent-\u30b3\u30ec\u30af\u30b7\u30e7\u30f3",children:"Concurrent \u30b3\u30ec\u30af\u30b7\u30e7\u30f3"}),"\n",(0,a.jsx)(n.h3,{id:"concurrenthashmap",children:"ConcurrentHashMap"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'ConcurrentMap<String, Integer> map = new ConcurrentHashMap<>();\n\n// \u539f\u5b50\u7684\u306a\u64cd\u4f5c\nmap.putIfAbsent("key", 1);\nmap.computeIfAbsent("key", k -> expensiveComputation(k));\nmap.compute("key", (k, v) -> v == null ? 1 : v + 1);\nmap.merge("key", 1, Integer::sum);\n\n// \u4e26\u884c\u30a4\u30c6\u30ec\u30fc\u30b7\u30e7\u30f3\uff08ConcurrentModificationException\u306b\u306a\u3089\u306a\u3044\uff09\nmap.forEach((k, v) -> System.out.println(k + "=" + v));\n'})}),"\n",(0,a.jsx)(n.h3,{id:"blockingqueue",children:"BlockingQueue"}),"\n",(0,a.jsx)(n.p,{children:"\u751f\u7523\u8005-\u6d88\u8cbb\u8005\u30d1\u30bf\u30fc\u30f3\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"BlockingQueue<Task> queue = new LinkedBlockingQueue<>(100);\n\n// \u751f\u7523\u8005\nexecutor.submit(() -> {\n    while (true) {\n        Task task = createTask();\n        queue.put(task);  // \u30ad\u30e5\u30fc\u304c\u6e80\u676f\u306a\u3089\u30d6\u30ed\u30c3\u30af\n    }\n});\n\n// \u6d88\u8cbb\u8005\nexecutor.submit(() -> {\n    while (true) {\n        Task task = queue.take();  // \u30ad\u30e5\u30fc\u304c\u7a7a\u306a\u3089\u30d6\u30ed\u30c3\u30af\n        process(task);\n    }\n});\n\n// \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u4ed8\u304d\nTask task = queue.poll(5, TimeUnit.SECONDS);\nboolean added = queue.offer(task, 5, TimeUnit.SECONDS);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"copyonwritearraylist",children:"CopyOnWriteArrayList"}),"\n",(0,a.jsx)(n.p,{children:"\u8aad\u307f\u53d6\u308a\u304c\u591a\u304f\u3001\u66f8\u304d\u8fbc\u307f\u304c\u5c11\u306a\u3044\u5834\u5408\u306b\u6709\u52b9\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'List<String> list = new CopyOnWriteArrayList<>();\n\n// \u66f8\u304d\u8fbc\u307f\u6642\u306b\u5185\u90e8\u914d\u5217\u3092\u30b3\u30d4\u30fc\nlist.add("item");\n\n// \u8aad\u307f\u53d6\u308a\u306f\u30ed\u30c3\u30af\u4e0d\u8981\nfor (String item : list) {\n    // \u5b89\u5168\u306b\u30a4\u30c6\u30ec\u30fc\u30b7\u30e7\u30f3\n}\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u56de\u907f",children:"\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u56de\u907f"}),"\n",(0,a.jsx)(n.h3,{id:"\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u4f8b",children:"\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u4f8b"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// \u30b9\u30ec\u30c3\u30c91\nsynchronized (lockA) {\n    synchronized (lockB) { }\n}\n\n// \u30b9\u30ec\u30c3\u30c92\nsynchronized (lockB) {\n    synchronized (lockA) { }  // \u30c7\u30c3\u30c9\u30ed\u30c3\u30af\uff01\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u56de\u907f\u7b56",children:"\u56de\u907f\u7b56"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// 1. \u30ed\u30c3\u30af\u306e\u9806\u5e8f\u3092\u7d71\u4e00\nObject[] locks = {lockA, lockB};\nArrays.sort(locks, (a, b) -> System.identityHashCode(a) - System.identityHashCode(b));\nsynchronized (locks[0]) {\n    synchronized (locks[1]) {\n        // ...\n    }\n}\n\n// 2. tryLock \u3067\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\nif (lock1.tryLock(1, TimeUnit.SECONDS)) {\n    try {\n        if (lock2.tryLock(1, TimeUnit.SECONDS)) {\n            try {\n                // ...\n            } finally {\n                lock2.unlock();\n            }\n        }\n    } finally {\n        lock1.unlock();\n    }\n}\n\n// 3. \u5358\u4e00\u306e\u30ed\u30c3\u30af\u3092\u4f7f\u7528\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u4e0d\u5909\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3046",children:"1. \u4e0d\u5909\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3046"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// \u4e0d\u5909\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\npublic final class ImmutableUser {\n    private final String name;\n    private final int age;\n\n    public ImmutableUser(String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n    // getter \u306e\u307f\u3001setter \u306a\u3057\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u30ed\u30c3\u30af\u306e\u7bc4\u56f2\u3092\u6700\u5c0f\u5316",children:"2. \u30ed\u30c3\u30af\u306e\u7bc4\u56f2\u3092\u6700\u5c0f\u5316"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// NG: \u30ed\u30c3\u30af\u7bc4\u56f2\u304c\u5e83\u3059\u304e\u308b\nsynchronized (lock) {\n    String data = fetchFromNetwork();  // IO\u64cd\u4f5c\n    process(data);\n}\n\n// OK: \u5fc5\u8981\u306a\u90e8\u5206\u306e\u307f\u30ed\u30c3\u30af\nString data = fetchFromNetwork();\nsynchronized (lock) {\n    process(data);\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-executorservice-\u3092\u4f7f\u3046thread-\u3092\u76f4\u63a5\u4f7f\u308f\u306a\u3044",children:"3. ExecutorService \u3092\u4f7f\u3046\uff08Thread \u3092\u76f4\u63a5\u4f7f\u308f\u306a\u3044\uff09"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// NG\nnew Thread(() -> doSomething()).start();\n\n// OK\nexecutor.submit(() -> doSomething());\n"})}),"\n",(0,a.jsx)(n.h3,{id:"4-try-finally-\u3067\u30ed\u30c3\u30af\u89e3\u653e\u3092\u4fdd\u8a3c",children:"4. try-finally \u3067\u30ed\u30c3\u30af\u89e3\u653e\u3092\u4fdd\u8a3c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"lock.lock();\ntry {\n    // ...\n} finally {\n    lock.unlock();\n}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\u307e\u3068\u3081",children:"\u307e\u3068\u3081"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"\u6982\u5ff5"}),(0,a.jsx)(n.th,{children:"\u7528\u9014"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"synchronized"}),(0,a.jsx)(n.td,{children:"\u57fa\u672c\u7684\u306a\u540c\u671f\u5316"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"volatile"}),(0,a.jsx)(n.td,{children:"\u53ef\u8996\u6027\u306e\u4fdd\u8a3c"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Atomic*"}),(0,a.jsx)(n.td,{children:"\u539f\u5b50\u7684\u306a\u64cd\u4f5c"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"ExecutorService"}),(0,a.jsx)(n.td,{children:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u7ba1\u7406"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Virtual Threads"}),(0,a.jsx)(n.td,{children:"\u8efd\u91cf\u306a\u4e26\u884c\u51e6\u7406\uff08Java 21+\uff09"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"CompletableFuture"}),(0,a.jsx)(n.td,{children:"\u975e\u540c\u671f\u51e6\u7406\u306e\u5408\u6210"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Lock"}),(0,a.jsx)(n.td,{children:"\u67d4\u8edf\u306a\u30ed\u30c3\u30af"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Concurrent*"}),(0,a.jsx)(n.td,{children:"\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306a\u30b3\u30ec\u30af\u30b7\u30e7\u30f3"})]})]})]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/idp-server/docs/content_11_learning/java/java-09-records",children:"Records"})," - \u4e0d\u5909\u30c7\u30fc\u30bf\u30af\u30e9\u30b9"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>i});var t=r(96540);const a={},l=t.createContext(a);function c(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);