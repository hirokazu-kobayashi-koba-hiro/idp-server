"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[58548],{7869:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>E,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"content_11_learning/postgresql/dba-09-extensions","title":"PostgreSQL \u62e1\u5f35\u6a5f\u80fd\uff08Extensions\uff09\u30ac\u30a4\u30c9","description":"PostgreSQL\u306f\u62e1\u5f35\u6a5f\u80fd\uff08Extension\uff09\u306b\u3088\u3063\u3066\u6a5f\u80fd\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002","source":"@site/docs/content_11_learning/11-postgresql/dba-09-extensions.md","sourceDirName":"content_11_learning/11-postgresql","slug":"/content_11_learning/postgresql/dba-09-extensions","permalink":"/idp-server/docs/content_11_learning/postgresql/dba-09-extensions","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/11-postgresql/dba-09-extensions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"PostgreSQL \u30d7\u30e9\u30f3\u30ca\u30fc\u6df1\u6398\u308a\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_11_learning/postgresql/dba-08-planner"},"next":{"title":"PostgreSQL SQL\u57fa\u790e\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_11_learning/postgresql/dev-01-sql-basics"}}');var t=s(74848),l=s(28453);const a={},i="PostgreSQL \u62e1\u5f35\u6a5f\u80fd\uff08Extensions\uff09\u30ac\u30a4\u30c9",d={},c=[{value:"\u76ee\u6b21",id:"\u76ee\u6b21",level:2},{value:"1. \u62e1\u5f35\u6a5f\u80fd\u306e\u57fa\u672c\u64cd\u4f5c",id:"1-\u62e1\u5f35\u6a5f\u80fd\u306e\u57fa\u672c\u64cd\u4f5c",level:2},{value:"1.1 \u62e1\u5f35\u6a5f\u80fd\u306e\u6982\u5ff5",id:"11-\u62e1\u5f35\u6a5f\u80fd\u306e\u6982\u5ff5",level:3},{value:"1.2 \u57fa\u672c\u30b3\u30de\u30f3\u30c9",id:"12-\u57fa\u672c\u30b3\u30de\u30f3\u30c9",level:3},{value:"1.3 shared_preload_libraries",id:"13-shared_preload_libraries",level:3},{value:"shared_preload_libraries \u304c\u5fc5\u8981\u306b\u306a\u308b\u6280\u8853\u7684\u57fa\u6e96",id:"shared_preload_libraries-\u304c\u5fc5\u8981\u306b\u306a\u308b\u6280\u8853\u7684\u57fa\u6e96",level:4},{value:"shared_preload_libraries \u304c\u4e0d\u8981\u306a\u62e1\u5f35\u6a5f\u80fd\u306e\u7279\u5fb4",id:"shared_preload_libraries-\u304c\u4e0d\u8981\u306a\u62e1\u5f35\u6a5f\u80fd\u306e\u7279\u5fb4",level:4},{value:"\u5224\u65ad\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8",id:"\u5224\u65ad\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8",level:4},{value:"\u62e1\u5f35\u6a5f\u80fd\u5225\u306e\u5206\u985e\u4e00\u89a7",id:"\u62e1\u5f35\u6a5f\u80fd\u5225\u306e\u5206\u985e\u4e00\u89a7",level:4},{value:"2. \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30fb\u76e3\u8996\u7cfb",id:"2-\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u76e3\u8996\u7cfb",level:2},{value:"2.1 pg_stat_statements",id:"21-pg_stat_statements",level:3},{value:"\u8a2d\u5b9a",id:"\u8a2d\u5b9a",level:4},{value:"\u4f7f\u7528\u4f8b",id:"\u4f7f\u7528\u4f8b",level:4},{value:"2.2 pg_buffercache",id:"22-pg_buffercache",level:3},{value:"2.3 pg_prewarm",id:"23-pg_prewarm",level:3},{value:"2.4 auto_explain",id:"24-auto_explain",level:3},{value:"3. \u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7cfb",id:"3-\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7cfb",level:2},{value:"3.1 pg_repack",id:"31-pg_repack",level:3},{value:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08Debian/Ubuntu\uff09",id:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebdebianubuntu",level:4},{value:"\u4f7f\u7528\u4f8b",id:"\u4f7f\u7528\u4f8b-1",level:4},{value:"3.2 pg_squeeze",id:"32-pg_squeeze",level:3},{value:"4. \u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u7cfb",id:"4-\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u7cfb",level:2},{value:"4.1 pg_cron",id:"41-pg_cron",level:3},{value:"\u8a2d\u5b9a",id:"\u8a2d\u5b9a-1",level:4},{value:"\u4f7f\u7528\u4f8b",id:"\u4f7f\u7528\u4f8b-2",level:4},{value:"cron\u5f0f\u306e\u66f8\u5f0f",id:"cron\u5f0f\u306e\u66f8\u5f0f",level:4},{value:"4.2 pg_partman",id:"42-pg_partman",level:3},{value:"\u8a2d\u5b9a\u30fb\u4f7f\u7528\u4f8b",id:"\u8a2d\u5b9a\u4f7f\u7528\u4f8b",level:4},{value:"5. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fb\u6697\u53f7\u5316\u7cfb",id:"5-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u6697\u53f7\u5316\u7cfb",level:2},{value:"5.1 pgcrypto",id:"51-pgcrypto",level:3},{value:"5.2 pgaudit",id:"52-pgaudit",level:3},{value:"\u8a2d\u5b9a",id:"\u8a2d\u5b9a-2",level:4},{value:"\u30ed\u30b0\u51fa\u529b\u4f8b",id:"\u30ed\u30b0\u51fa\u529b\u4f8b",level:4},{value:"6. \u30c7\u30fc\u30bf\u578b\u30fb\u691c\u7d22\u62e1\u5f35\u7cfb",id:"6-\u30c7\u30fc\u30bf\u578b\u691c\u7d22\u62e1\u5f35\u7cfb",level:2},{value:"6.1 uuid-ossp",id:"61-uuid-ossp",level:3},{value:"6.2 pg_trgm",id:"62-pg_trgm",level:3},{value:"6.3 hstore",id:"63-hstore",level:3},{value:"6.4 citext",id:"64-citext",level:3},{value:"6.5 ltree",id:"65-ltree",level:3},{value:"7. \u5730\u7406\u60c5\u5831\u7cfb",id:"7-\u5730\u7406\u60c5\u5831\u7cfb",level:2},{value:"7.1 PostGIS",id:"71-postgis",level:3},{value:"8. \u5916\u90e8\u30c7\u30fc\u30bf\u9023\u643a\u7cfb",id:"8-\u5916\u90e8\u30c7\u30fc\u30bf\u9023\u643a\u7cfb",level:2},{value:"8.1 postgres_fdw",id:"81-postgres_fdw",level:3},{value:"8.2 file_fdw",id:"82-file_fdw",level:3},{value:"8.3 aws_commons\uff08RDS\u5c02\u7528\uff09",id:"83-aws_commonsrds\u5c02\u7528",level:3},{value:"\u4e3b\u306a\u95a2\u6570",id:"\u4e3b\u306a\u95a2\u6570",level:4},{value:"\u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03",id:"\u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03",level:4},{value:"8.4 aws_s3\uff08RDS\u5c02\u7528\uff09",id:"84-aws_s3rds\u5c02\u7528",level:3},{value:"\u524d\u63d0\u6761\u4ef6\uff08IAM\u30ed\u30fc\u30eb\u8a2d\u5b9a\uff09",id:"\u524d\u63d0\u6761\u4ef6iam\u30ed\u30fc\u30eb\u8a2d\u5b9a",level:4},{value:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",id:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",level:4},{value:"S3\u304b\u3089\u306e\u30a4\u30f3\u30dd\u30fc\u30c8",id:"s3\u304b\u3089\u306e\u30a4\u30f3\u30dd\u30fc\u30c8",level:4},{value:"S3\u3078\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8",id:"s3\u3078\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8",level:4},{value:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9",id:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9",level:4},{value:"8.5 aws_lambda\uff08RDS\u5c02\u7528\uff09",id:"85-aws_lambdards\u5c02\u7528",level:3},{value:"9. \u62e1\u5f35\u6a5f\u80fd\u306e\u7ba1\u7406\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"9-\u62e1\u5f35\u6a5f\u80fd\u306e\u7ba1\u7406\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:2},{value:"9.1 \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406",id:"91-\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406",level:3},{value:"9.2 \u4f9d\u5b58\u95a2\u4fc2\u306e\u78ba\u8a8d",id:"92-\u4f9d\u5b58\u95a2\u4fc2\u306e\u78ba\u8a8d",level:3},{value:"9.3 RDS/Aurora\u3067\u306e\u5bfe\u5fdc\u72b6\u6cc1",id:"93-rdsaurora\u3067\u306e\u5bfe\u5fdc\u72b6\u6cc1",level:3},{value:"9.4 \u672c\u756a\u74b0\u5883\u3067\u306e\u63a8\u5968\u62e1\u5f35\u6a5f\u80fd\u30bb\u30c3\u30c8",id:"94-\u672c\u756a\u74b0\u5883\u3067\u306e\u63a8\u5968\u62e1\u5f35\u6a5f\u80fd\u30bb\u30c3\u30c8",level:3},{value:"\u53c2\u8003\u30ea\u30f3\u30af",id:"\u53c2\u8003\u30ea\u30f3\u30af",level:2}];function o(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"postgresql-\u62e1\u5f35\u6a5f\u80fdextensions\u30ac\u30a4\u30c9",children:"PostgreSQL \u62e1\u5f35\u6a5f\u80fd\uff08Extensions\uff09\u30ac\u30a4\u30c9"})}),"\n",(0,t.jsx)(e.p,{children:"PostgreSQL\u306f\u62e1\u5f35\u6a5f\u80fd\uff08Extension\uff09\u306b\u3088\u3063\u3066\u6a5f\u80fd\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002\n\u672c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001\u5b9f\u904b\u7528\u3067\u3088\u304f\u4f7f\u308f\u308c\u308b\u62e1\u5f35\u6a5f\u80fd\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"\u76ee\u6b21",children:"\u76ee\u6b21"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"#1-%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%AE%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C",children:"\u62e1\u5f35\u6a5f\u80fd\u306e\u57fa\u672c\u64cd\u4f5c"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"#2-%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E7%9B%A3%E8%A6%96%E7%B3%BB",children:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30fb\u76e3\u8996\u7cfb"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"#3-%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E7%B3%BB",children:"\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7cfb"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"#4-%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0%E7%B3%BB",children:"\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u7cfb"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"#5-%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E6%9A%97%E5%8F%B7%E5%8C%96%E7%B3%BB",children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fb\u6697\u53f7\u5316\u7cfb"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"#6-%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B%E6%A4%9C%E7%B4%A2%E6%8B%A1%E5%BC%B5%E7%B3%BB",children:"\u30c7\u30fc\u30bf\u578b\u30fb\u691c\u7d22\u62e1\u5f35\u7cfb"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"#7-%E5%9C%B0%E7%90%86%E6%83%85%E5%A0%B1%E7%B3%BB",children:"\u5730\u7406\u60c5\u5831\u7cfb"})}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"#8-%E5%A4%96%E9%83%A8%E3%83%87%E3%83%BC%E3%82%BF%E9%80%A3%E6%90%BA%E7%B3%BB",children:"\u5916\u90e8\u30c7\u30fc\u30bf\u9023\u643a\u7cfb"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"8.1 postgres_fdw"}),"\n",(0,t.jsx)(e.li,{children:"8.2 file_fdw"}),"\n",(0,t.jsx)(e.li,{children:"8.3 aws_commons\uff08RDS\u5c02\u7528\uff09"}),"\n",(0,t.jsx)(e.li,{children:"8.4 aws_s3\uff08RDS\u5c02\u7528\uff09"}),"\n",(0,t.jsx)(e.li,{children:"8.5 aws_lambda\uff08RDS\u5c02\u7528\uff09"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"#9-%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%AE%E7%AE%A1%E7%90%86%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9",children:"\u62e1\u5f35\u6a5f\u80fd\u306e\u7ba1\u7406\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"})}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"1-\u62e1\u5f35\u6a5f\u80fd\u306e\u57fa\u672c\u64cd\u4f5c",children:"1. \u62e1\u5f35\u6a5f\u80fd\u306e\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,t.jsx)(e.h3,{id:"11-\u62e1\u5f35\u6a5f\u80fd\u306e\u6982\u5ff5",children:"1.1 \u62e1\u5f35\u6a5f\u80fd\u306e\u6982\u5ff5"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    PostgreSQL \u62e1\u5f35\u6a5f\u80fd                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u62e1\u5f35\u6a5f\u80fd\u3068\u306f\u3011                                               \u2502\n\u2502  PostgreSQL\u306e\u6a5f\u80fd\u3092\u62e1\u5f35\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8                           \u2502\n\u2502  \u30fb\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u578b                                               \u2502\n\u2502  \u30fb\u65b0\u3057\u3044\u95a2\u6570/\u6f14\u7b97\u5b50                                            \u2502\n\u2502  \u30fb\u65b0\u3057\u3044\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30bf\u30a4\u30d7                                     \u2502\n\u2502  \u30fb\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc                                     \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u63d0\u4f9b\u5f62\u614b\u3011                                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 contrib: PostgreSQL\u672c\u4f53\u306b\u540c\u68b1                            \u2502   \u2502\n\u2502  \u2502   \u4f8b: pg_stat_statements, pgcrypto, uuid-ossp           \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 \u5916\u90e8: \u5225\u9014\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981                             \u2502   \u2502\n\u2502  \u2502   \u4f8b: PostGIS, pg_partman, pg_cron, pgaudit             \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"12-\u57fa\u672c\u30b3\u30de\u30f3\u30c9",children:"1.2 \u57fa\u672c\u30b3\u30de\u30f3\u30c9"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u5229\u7528\u53ef\u80fd\u306a\u62e1\u5f35\u6a5f\u80fd\u306e\u4e00\u89a7\nSELECT * FROM pg_available_extensions ORDER BY name;\n\n-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u62e1\u5f35\u6a5f\u80fd\u306e\u4e00\u89a7\nSELECT extname, extversion FROM pg_extension ORDER BY extname;\n\n-- \u62e1\u5f35\u6a5f\u80fd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pg_stat_statements;\n\n-- \u7279\u5b9a\u30b9\u30ad\u30fc\u30de\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION pg_stat_statements WITH SCHEMA public;\n\n-- \u62e1\u5f35\u6a5f\u80fd\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\nALTER EXTENSION pg_stat_statements UPDATE;\n\n-- \u7279\u5b9a\u30d0\u30fc\u30b8\u30e7\u30f3\u3078\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\nALTER EXTENSION pg_stat_statements UPDATE TO '1.10';\n\n-- \u62e1\u5f35\u6a5f\u80fd\u306e\u524a\u9664\nDROP EXTENSION pg_stat_statements;\n\n-- \u4f9d\u5b58\u95a2\u4fc2\u3082\u542b\u3081\u3066\u524a\u9664\nDROP EXTENSION pg_stat_statements CASCADE;\n"})}),"\n",(0,t.jsx)(e.h3,{id:"13-shared_preload_libraries",children:"1.3 shared_preload_libraries"}),"\n",(0,t.jsx)(e.p,{children:"\u4e00\u90e8\u306e\u62e1\u5f35\u6a5f\u80fd\u306f\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306b\u30ed\u30fc\u30c9\u304c\u5fc5\u8981\u3067\u3059\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\n# \u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8907\u6570\u6307\u5b9a\u53ef\u80fd\nshared_preload_libraries = 'pg_stat_statements, pg_cron, pgaudit'\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            shared_preload_libraries \u304c\u5fc5\u8981\u306a\u62e1\u5f35\u6a5f\u80fd            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u5fc5\u9808\u3011                                                       \u2502\n\u2502  \u30fbpg_stat_statements  - \u30af\u30a8\u30ea\u7d71\u8a08\u53ce\u96c6                        \u2502\n\u2502  \u30fbpg_cron            - \u30b8\u30e7\u30d6\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9                     \u2502\n\u2502  \u30fbpgaudit            - \u76e3\u67fb\u30ed\u30b0                               \u2502\n\u2502  \u30fbauto_explain       - \u81ea\u52d5EXPLAIN\u51fa\u529b                        \u2502\n\u2502  \u30fbpg_prewarm         - \u30d0\u30c3\u30d5\u30a1\u30ad\u30e3\u30c3\u30b7\u30e5\u30a6\u30a9\u30fc\u30e0\u30a2\u30c3\u30d7       \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u4e0d\u8981\u3011                                                       \u2502\n\u2502  \u30fbpgcrypto           - \u6697\u53f7\u5316\u95a2\u6570                             \u2502\n\u2502  \u30fbuuid-ossp          - UUID\u751f\u6210                               \u2502\n\u2502  \u30fbpg_trgm            - \u985e\u4f3c\u691c\u7d22                               \u2502\n\u2502  \u30fbhstore             - \u30ad\u30fc\u30d0\u30ea\u30e5\u30fc\u578b                         \u2502\n\u2502  \u30fbPostGIS            - \u5730\u7406\u60c5\u5831                               \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u6ce8\u610f\u3011                                                       \u2502\n\u2502  shared_preload_libraries\u306e\u5909\u66f4\u5f8c\u306f\u518d\u8d77\u52d5\u304c\u5fc5\u8981                \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"shared_preload_libraries-\u304c\u5fc5\u8981\u306b\u306a\u308b\u6280\u8853\u7684\u57fa\u6e96",children:"shared_preload_libraries \u304c\u5fc5\u8981\u306b\u306a\u308b\u6280\u8853\u7684\u57fa\u6e96"}),"\n",(0,t.jsx)(e.p,{children:"\u306a\u305c\u4e00\u90e8\u306e\u62e1\u5f35\u6a5f\u80fd\u3060\u3051\u304c\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306e\u30ed\u30fc\u30c9\u3092\u5fc5\u8981\u3068\u3059\u308b\u306e\u304b\u3001\n\u305d\u306e\u6280\u8853\u7684\u306a\u7406\u7531\u306f\u4ee5\u4e0b\u306e3\u3064\u306e\u6761\u4ef6\u306b\u96c6\u7d04\u3055\u308c\u307e\u3059\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        shared_preload_libraries \u304c\u5fc5\u8981\u306a\u6280\u8853\u7684\u7406\u7531              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u6761\u4ef61\u3011\u5171\u6709\u30e1\u30e2\u30ea\u3092\u78ba\u4fdd\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 PostgreSQL\u306e\u5171\u6709\u30e1\u30e2\u30ea\u306f\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306b\u78ba\u4fdd\u3055\u308c\u308b       \u2502   \u2502\n\u2502  \u2502 \u2192 \u5f8c\u304b\u3089\u52d5\u7684\u306b\u8ffd\u52a0\u3067\u304d\u306a\u3044                               \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u4f8b: pg_stat_statements                                   \u2502   \u2502\n\u2502  \u2502     \u30af\u30a8\u30ea\u7d71\u8a08\u3092\u4fdd\u5b58\u3059\u308b\u9818\u57df\u3092\u5171\u6709\u30e1\u30e2\u30ea\u306b\u78ba\u4fdd           \u2502   \u2502\n\u2502  \u2502     pg_stat_statements.max = 10000 \u2192 \u305d\u306e\u5206\u306e\u30e1\u30e2\u30ea\u78ba\u4fdd  \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u6761\u4ef62\u3011\u30d5\u30c3\u30af\uff08Hook\uff09\u3092\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 PostgreSQL\u306f\u5404\u51e6\u7406\u30dd\u30a4\u30f3\u30c8\u306b\u30d5\u30c3\u30af\u6a5f\u69cb\u3092\u63d0\u4f9b             \u2502   \u2502\n\u2502  \u2502 \u30d5\u30c3\u30af\u306f\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306b\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b               \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u4e3b\u306a\u30d5\u30c3\u30af\u30dd\u30a4\u30f3\u30c8:                                      \u2502   \u2502\n\u2502  \u2502 \u30fbExecutorStart_hook  - \u30af\u30a8\u30ea\u5b9f\u884c\u958b\u59cb\u6642                 \u2502   \u2502\n\u2502  \u2502 \u30fbExecutorEnd_hook    - \u30af\u30a8\u30ea\u5b9f\u884c\u5b8c\u4e86\u6642                 \u2502   \u2502\n\u2502  \u2502 \u30fbProcessUtility_hook - DDL/\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u5b9f\u884c\u6642         \u2502   \u2502\n\u2502  \u2502 \u30fbplanner_hook        - \u30af\u30a8\u30ea\u30d7\u30e9\u30f3\u4f5c\u6210\u6642               \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u4f8b: pg_stat_statements                                   \u2502   \u2502\n\u2502  \u2502     ExecutorEnd_hook \u2192 \u30af\u30a8\u30ea\u5b8c\u4e86\u6642\u306b\u7d71\u8a08\u8a18\u9332           \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u4f8b: auto_explain                                         \u2502   \u2502\n\u2502  \u2502     ExecutorEnd_hook \u2192 \u30af\u30a8\u30ea\u5b8c\u4e86\u6642\u306b\u5b9f\u884c\u8a08\u753b\u51fa\u529b       \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u4f8b: pgaudit                                              \u2502   \u2502\n\u2502  \u2502     ProcessUtility_hook \u2192 DDL\u5b9f\u884c\u6642\u306b\u76e3\u67fb\u30ed\u30b0\u51fa\u529b       \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u6761\u4ef63\u3011\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u3092\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 \u5e38\u99d0\u30d7\u30ed\u30bb\u30b9\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308b\u6a5f\u80fd                           \u2502   \u2502\n\u2502  \u2502 \u2192 \u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306b\u30ef\u30fc\u30ab\u30fc\u3092\u767b\u9332\u30fb\u8d77\u52d5                   \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u4f8b: pg_cron                                              \u2502   \u2502\n\u2502  \u2502     \u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3068\u3057\u3066\u5e38\u99d0\u3057\u3001\u5b9a\u671f\u7684\u306b\u30b8\u30e7\u30d6\u3092\u5b9f\u884c       \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u4f8b: pg_prewarm (autoprewarm)                             \u2502   \u2502\n\u2502  \u2502     \u5b9a\u671f\u7684\u306b\u30d0\u30c3\u30d5\u30a1\u72b6\u614b\u3092\u4fdd\u5b58\u3059\u308b\u30ef\u30fc\u30ab\u30fc               \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"shared_preload_libraries-\u304c\u4e0d\u8981\u306a\u62e1\u5f35\u6a5f\u80fd\u306e\u7279\u5fb4",children:"shared_preload_libraries \u304c\u4e0d\u8981\u306a\u62e1\u5f35\u6a5f\u80fd\u306e\u7279\u5fb4"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        shared_preload_libraries \u304c\u4e0d\u8981\u306a\u62e1\u5f35\u6a5f\u80fd                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u7279\u5fb4\u3011\u30bb\u30c3\u30b7\u30e7\u30f3\u5358\u4f4d\u3067\u52d5\u4f5c\u3057\u3001\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u72b6\u614b\u3092\u6301\u305f\u306a\u3044     \u2502\n\u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 \u30fb\u65b0\u3057\u3044\u95a2\u6570\u3092\u63d0\u4f9b\u3059\u308b\u3060\u3051                               \u2502   \u2502\n\u2502  \u2502   pgcrypto: crypt(), encrypt() \u306a\u3069                      \u2502   \u2502\n\u2502  \u2502   uuid-ossp: uuid_generate_v4() \u306a\u3069                     \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u30fb\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u578b\u3092\u63d0\u4f9b\u3059\u308b\u3060\u3051                           \u2502   \u2502\n\u2502  \u2502   hstore: \u30ad\u30fc\u30d0\u30ea\u30e5\u30fc\u578b                                 \u2502   \u2502\n\u2502  \u2502   ltree: \u968e\u5c64\u30d1\u30b9\u578b                                      \u2502   \u2502\n\u2502  \u2502   PostGIS: geometry, geography\u578b                         \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u30fb\u65b0\u3057\u3044\u6f14\u7b97\u5b50/\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u3060\u3051                \u2502   \u2502\n\u2502  \u2502   pg_trgm: %, <-> \u6f14\u7b97\u5b50\u3001GIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9               \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502 \u3053\u308c\u3089\u306f CREATE EXTENSION \u6642\u306b                           \u2502   \u2502\n\u2502  \u2502 \u30b7\u30b9\u30c6\u30e0\u30ab\u30bf\u30ed\u30b0\uff08pg_proc, pg_type\u7b49\uff09\u306b\u767b\u9332\u3055\u308c\u308b\u3060\u3051   \u2502   \u2502\n\u2502  \u2502 \u2192 \u5b9f\u884c\u6642\u306b\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u3067\u30ed\u30fc\u30c9\u3055\u308c\u308b                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u5224\u65ad\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8",children:"\u5224\u65ad\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"                    \u62e1\u5f35\u6a5f\u80fd\u306e\u6a5f\u80fd\u306f\uff1f\n                          \u2502\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u25bc               \u25bc               \u25bc\n    \u5171\u6709\u30e1\u30e2\u30ea\u304c      \u30d5\u30c3\u30af\u767b\u9332\u304c    \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\n      \u5fc5\u8981\uff1f           \u5fc5\u8981\uff1f         \u30ef\u30fc\u30ab\u30fc\u304c\u5fc5\u8981\uff1f\n          \u2502               \u2502               \u2502\n     \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n     Yes      No     Yes      No     Yes      No\n     \u2502         \u2502      \u2502        \u2502      \u2502        \u2502\n     \u25bc         \u2502      \u25bc        \u2502      \u25bc        \u2502\n  \u5fc5\u8981 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2192 \u5fc5\u8981 \u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2192 \u5fc5\u8981      \u2502\n                                               \u2502\n                                               \u25bc\n                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                           \u2502  \u3059\u3079\u3066No\u306e\u5834\u5408                        \u2502\n                           \u2502  \u2192 shared_preload_libraries \u4e0d\u8981      \u2502\n                           \u2502  \u2192 CREATE EXTENSION \u3060\u3051\u3067OK          \u2502\n                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u62e1\u5f35\u6a5f\u80fd\u5225\u306e\u5206\u985e\u4e00\u89a7",children:"\u62e1\u5f35\u6a5f\u80fd\u5225\u306e\u5206\u985e\u4e00\u89a7"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"\u62e1\u5f35\u6a5f\u80fd"}),(0,t.jsx)(e.th,{style:{textAlign:"center"},children:"\u5171\u6709\u30e1\u30e2\u30ea"}),(0,t.jsx)(e.th,{style:{textAlign:"center"},children:"\u30d5\u30c3\u30af"}),(0,t.jsx)(e.th,{style:{textAlign:"center"},children:"BG\u30ef\u30fc\u30ab\u30fc"}),(0,t.jsx)(e.th,{style:{textAlign:"center"},children:"\u5fc5\u8981\uff1f"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"pg_stat_statements"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)(e.strong,{children:"\u5fc5\u8981"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"pgaudit"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)(e.strong,{children:"\u5fc5\u8981"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"auto_explain"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)(e.strong,{children:"\u5fc5\u8981"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"pg_cron"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)(e.strong,{children:"\u5fc5\u8981"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"pg_prewarm (auto)"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)(e.strong,{children:"\u5fc5\u8981"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"pgcrypto"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u4e0d\u8981"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"uuid-ossp"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u4e0d\u8981"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"pg_trgm"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u4e0d\u8981"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"hstore"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u4e0d\u8981"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"PostGIS"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u4e0d\u8981"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"pg_repack"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u4e0d\u8981"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"pg_partman"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"-"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u203b"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u203b\u6761\u4ef6\u4ed8\u304d"})]})]})]}),"\n",(0,t.jsxs)(e.p,{children:["\u203b pg_partman: ",(0,t.jsx)(e.code,{children:"pg_partman_bgw"}),"\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u3068\u3057\u3066\u4f7f\u3046\u5834\u5408\u306e\u307f\u5fc5\u8981\u3002\n",(0,t.jsx)(e.code,{children:"pg_cron"}),"\u3068\u9023\u643a\u3057\u3066\u5b9a\u671f\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f\u4e0d\u8981\u3002"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"2-\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u76e3\u8996\u7cfb",children:"2. \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30fb\u76e3\u8996\u7cfb"}),"\n",(0,t.jsx)(e.h3,{id:"21-pg_stat_statements",children:"2.1 pg_stat_statements"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u6700\u3082\u91cd\u8981\u306a\u62e1\u5f35\u6a5f\u80fd\u306e\u4e00\u3064\u3002\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u7d71\u8a08\u3092\u53ce\u96c6\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     pg_stat_statements                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u6a5f\u80fd\u3011                                                       \u2502\n\u2502  \u30fb\u5b9f\u884c\u3055\u308c\u305fSQL\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53ce\u96c6                               \u2502\n\u2502  \u30fb\u5b9f\u884c\u56de\u6570\u3001\u5408\u8a08\u6642\u9593\u3001\u5e73\u5747\u6642\u9593\u3001\u884c\u6570\u306a\u3069\u3092\u8a18\u9332                \u2502\n\u2502  \u30fb\u30af\u30a8\u30ea\u3092\u6b63\u898f\u5316\uff08\u30d1\u30e9\u30e1\u30fc\u30bf\u3092$1, $2\u306b\u7f6e\u63db\uff09                  \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3011                                               \u2502\n\u2502  \u30fb\u30b9\u30ed\u30fc\u30af\u30a8\u30ea\u306e\u7279\u5b9a                                          \u2502\n\u2502  \u30fb\u6700\u3082\u983b\u7e41\u306b\u5b9f\u884c\u3055\u308c\u308b\u30af\u30a8\u30ea\u306e\u7279\u5b9a                            \u2502\n\u2502  \u30fb\u30ea\u30bd\u30fc\u30b9\u6d88\u8cbb\u306e\u5927\u304d\u3044\u30af\u30a8\u30ea\u306e\u7279\u5b9a                            \u2502\n\u2502  \u30fb\u30af\u30a8\u30ea\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u7d4c\u6642\u5909\u5316\u76e3\u8996                          \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u8a2d\u5b9a",children:"\u8a2d\u5b9a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\nshared_preload_libraries = 'pg_stat_statements'\n\n# \u8ffd\u8de1\u3059\u308b\u30af\u30a8\u30ea\u6570\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 5000\uff09\npg_stat_statements.max = 10000\n\n# \u8ffd\u8de1\u5bfe\u8c61\uff08all/top/none\uff09\npg_stat_statements.track = all\n\n# \u30cd\u30b9\u30c8\u3057\u305f\u95a2\u6570\u547c\u3073\u51fa\u3057\u3082\u8ffd\u8de1\npg_stat_statements.track_utility = on\n\n# WAL\u4f7f\u7528\u91cf\u3082\u8ffd\u8de1\uff08PostgreSQL 13+\uff09\npg_stat_statements.track_wal = on\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u4f7f\u7528\u4f8b",children:"\u4f7f\u7528\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pg_stat_statements;\n\n-- \u7dcf\u5b9f\u884c\u6642\u9593\u304c\u9577\u3044\u30af\u30a8\u30eaTOP10\nSELECT\n    substring(query, 1, 80) AS query_preview,\n    calls,\n    round(total_exec_time::numeric, 2) AS total_time_ms,\n    round(mean_exec_time::numeric, 2) AS avg_time_ms,\n    round((100 * total_exec_time / sum(total_exec_time) OVER ())::numeric, 2) AS percentage,\n    rows\nFROM pg_stat_statements\nORDER BY total_exec_time DESC\nLIMIT 10;\n\n-- \u5e73\u5747\u5b9f\u884c\u6642\u9593\u304c\u9577\u3044\u30af\u30a8\u30eaTOP10\nSELECT\n    substring(query, 1, 80) AS query_preview,\n    calls,\n    round(mean_exec_time::numeric, 2) AS avg_time_ms,\n    round(stddev_exec_time::numeric, 2) AS stddev_ms,\n    rows / nullif(calls, 0) AS avg_rows\nFROM pg_stat_statements\nWHERE calls > 100  -- \u5341\u5206\u306a\u5b9f\u884c\u56de\u6570\u304c\u3042\u308b\u3082\u306e\nORDER BY mean_exec_time DESC\nLIMIT 10;\n\n-- \u5b9f\u884c\u56de\u6570\u304c\u591a\u3044\u30af\u30a8\u30eaTOP10\nSELECT\n    substring(query, 1, 80) AS query_preview,\n    calls,\n    round(total_exec_time::numeric, 2) AS total_time_ms,\n    round(mean_exec_time::numeric, 2) AS avg_time_ms\nFROM pg_stat_statements\nORDER BY calls DESC\nLIMIT 10;\n\n-- I/O\u6642\u9593\u304c\u9577\u3044\u30af\u30a8\u30ea\uff08PostgreSQL 13+\uff09\nSELECT\n    substring(query, 1, 80) AS query_preview,\n    calls,\n    round(blk_read_time::numeric, 2) AS read_time_ms,\n    round(blk_write_time::numeric, 2) AS write_time_ms,\n    shared_blks_read,\n    shared_blks_hit\nFROM pg_stat_statements\nWHERE blk_read_time > 0\nORDER BY blk_read_time DESC\nLIMIT 10;\n\n-- \u7d71\u8a08\u306e\u30ea\u30bb\u30c3\u30c8\nSELECT pg_stat_statements_reset();\n\n-- \u7279\u5b9a\u30e6\u30fc\u30b6\u30fc\u306e\u7d71\u8a08\u306e\u307f\u30ea\u30bb\u30c3\u30c8\nSELECT pg_stat_statements_reset(userid := (SELECT oid FROM pg_roles WHERE rolname = 'app_user'));\n"})}),"\n",(0,t.jsx)(e.h3,{id:"22-pg_buffercache",children:"2.2 pg_buffercache"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u5171\u6709\u30d0\u30c3\u30d5\u30a1\u306e\u5185\u5bb9\u3092\u53ef\u8996\u5316\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pg_buffercache;\n\n-- \u30c6\u30fc\u30d6\u30eb\u5225\u306e\u30d0\u30c3\u30d5\u30a1\u4f7f\u7528\u91cf\nSELECT\n    c.relname AS table_name,\n    count(*) AS buffers,\n    pg_size_pretty(count(*) * 8192) AS buffer_size,\n    round(100.0 * count(*) / (SELECT count(*) FROM pg_buffercache), 2) AS percentage\nFROM pg_buffercache b\nJOIN pg_class c ON b.relfilenode = pg_relation_filenode(c.oid)\nWHERE c.relkind IN ('r', 'i')  -- \u30c6\u30fc\u30d6\u30eb\u3068\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\nGROUP BY c.relname\nORDER BY buffers DESC\nLIMIT 20;\n\n-- \u30d0\u30c3\u30d5\u30a1\u306e\u30c0\u30fc\u30c6\u30a3\u7387\nSELECT\n    count(*) FILTER (WHERE isdirty) AS dirty_buffers,\n    count(*) AS total_buffers,\n    round(100.0 * count(*) FILTER (WHERE isdirty) / count(*), 2) AS dirty_percentage\nFROM pg_buffercache\nWHERE relfilenode IS NOT NULL;\n"})}),"\n",(0,t.jsx)(e.h3,{id:"23-pg_prewarm",children:"2.3 pg_prewarm"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u30c6\u30fc\u30d6\u30eb/\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5171\u6709\u30d0\u30c3\u30d5\u30a1\u306b\u30d7\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        pg_prewarm                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3011                                               \u2502\n\u2502  \u30fb\u30b5\u30fc\u30d0\u30fc\u518d\u8d77\u52d5\u5f8c\u306e\u30b3\u30fc\u30eb\u30c9\u30b9\u30bf\u30fc\u30c8\u5bfe\u7b56                      \u2502\n\u2502  \u30fb\u983b\u7e41\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u4e8b\u524d\u30ed\u30fc\u30c9                    \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30e2\u30fc\u30c9\u3011                                                     \u2502\n\u2502  \u30fbbuffer: \u5171\u6709\u30d0\u30c3\u30d5\u30a1\u306b\u8aad\u307f\u8fbc\u307f\uff08\u63a8\u5968\uff09                      \u2502\n\u2502  \u30fbprefetch: OS\u306e\u30d5\u30a1\u30a4\u30eb\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1             \u2502\n\u2502  \u30fbread: \u5358\u7d14\u306a\u8aad\u307f\u8fbc\u307f\uff08\u30ad\u30e3\u30c3\u30b7\u30e5\u52b9\u679c\u306a\u3057\uff09                  \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\uff08\u81ea\u52d5\u4fdd\u5b58/\u5fa9\u5143\u6a5f\u80fd\uff09\nshared_preload_libraries = 'pg_prewarm'\npg_prewarm.autoprewarm = on\npg_prewarm.autoprewarm_interval = 300  # 5\u5206\u3054\u3068\u306b\u72b6\u614b\u4fdd\u5b58\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pg_prewarm;\n\n-- \u30c6\u30fc\u30d6\u30eb\u3092\u30d0\u30c3\u30d5\u30a1\u306b\u30ed\u30fc\u30c9\nSELECT pg_prewarm('users');\n\n-- \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u30d0\u30c3\u30d5\u30a1\u306b\u30ed\u30fc\u30c9\nSELECT pg_prewarm('users_pkey');\n\n-- \u30e2\u30fc\u30c9\u3092\u6307\u5b9a\nSELECT pg_prewarm('users', 'buffer');\nSELECT pg_prewarm('users', 'prefetch');\n\n-- \u624b\u52d5\u3067\u30d0\u30c3\u30d5\u30a1\u72b6\u614b\u3092\u4fdd\u5b58\nSELECT autoprewarm_dump_now();\n"})}),"\n",(0,t.jsx)(e.h3,{id:"24-auto_explain",children:"2.4 auto_explain"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u30b9\u30ed\u30fc\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u8a08\u753b\u3092\u81ea\u52d5\u7684\u306b\u30ed\u30b0\u51fa\u529b\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\nshared_preload_libraries = 'auto_explain'\n\n# \u95be\u5024\uff08ms\uff09\u3092\u8d85\u3048\u305f\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u8a08\u753b\u3092\u51fa\u529b\nauto_explain.log_min_duration = 1000  # 1\u79d2\n\n# ANALYZE\u60c5\u5831\u3092\u542b\u3081\u308b\uff08\u5b9f\u969b\u306e\u884c\u6570\u306a\u3069\uff09\nauto_explain.log_analyze = on\n\n# \u30d0\u30c3\u30d5\u30a1\u4f7f\u7528\u72b6\u6cc1\u3092\u542b\u3081\u308b\nauto_explain.log_buffers = on\n\n# \u51fa\u529b\u5f62\u5f0f\nauto_explain.log_format = 'text'  # text/xml/json/yaml\n\n# \u30cd\u30b9\u30c8\u3057\u305f\u95a2\u6570\u3082\u5bfe\u8c61\nauto_explain.log_nested_statements = on\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30bb\u30c3\u30b7\u30e7\u30f3\u5358\u4f4d\u3067\u6709\u52b9\u5316\uff08\u30c6\u30b9\u30c8\u7528\uff09\nLOAD 'auto_explain';\nSET auto_explain.log_min_duration = 0;  -- \u5168\u30af\u30a8\u30ea\nSET auto_explain.log_analyze = on;\n\n-- \u30c6\u30b9\u30c8\u30af\u30a8\u30ea\u5b9f\u884c\nSELECT * FROM large_table WHERE condition;\n-- \u2192 \u30b5\u30fc\u30d0\u30fc\u30ed\u30b0\u306b\u5b9f\u884c\u8a08\u753b\u304c\u51fa\u529b\u3055\u308c\u308b\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"3-\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7cfb",children:"3. \u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7cfb"}),"\n",(0,t.jsx)(e.h3,{id:"31-pg_repack",children:"3.1 pg_repack"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u30c6\u30fc\u30d6\u30eb\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u518d\u7de8\u6210\uff08VACUUM FULL\u306e\u4ee3\u66ff\uff09"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        pg_repack                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010VACUUM FULL \u3068\u306e\u6bd4\u8f03\u3011                                       \u2502\n\u2502                                                                 \u2502\n\u2502  VACUUM FULL:                                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 \u2705 \u6a19\u6e96\u6a5f\u80fd                                              \u2502   \u2502\n\u2502  \u2502 \u274c \u6392\u4ed6\u30ed\u30c3\u30af\uff08\u30c6\u30fc\u30d6\u30eb\u5168\u4f53\u3092\u30ed\u30c3\u30af\uff09                   \u2502   \u2502\n\u2502  \u2502 \u274c \u5b9f\u884c\u4e2d\u306f\u8aad\u307f\u66f8\u304d\u4e0d\u53ef                                 \u2502   \u2502\n\u2502  \u2502 \u274c \u5927\u304d\u306a\u30c6\u30fc\u30d6\u30eb\u3067\u306f\u9577\u6642\u9593\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0                 \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2502  pg_repack:                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 \u2705 \u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u5b9f\u884c\u53ef\u80fd                                  \u2502   \u2502\n\u2502  \u2502 \u2705 \u5b9f\u884c\u4e2d\u3082\u8aad\u307f\u66f8\u304d\u53ef\u80fd                                 \u2502   \u2502\n\u2502  \u2502 \u2705 \u6700\u5f8c\u306e\u5207\u308a\u66ff\u3048\u6642\u306e\u307f\u77ed\u6642\u9593\u30ed\u30c3\u30af                     \u2502   \u2502\n\u2502  \u2502 \u274c \u4e00\u6642\u7684\u306b2\u500d\u306e\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u304c\u5fc5\u8981                      \u2502   \u2502\n\u2502  \u2502 \u274c \u30ec\u30d7\u30ea\u30ab\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30c6\u30a3\uff08PK\u7b49\uff09\u304c\u5fc5\u8981              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebdebianubuntu",children:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08Debian/Ubuntu\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"sudo apt install postgresql-15-repack\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u4f7f\u7528\u4f8b-1",children:"\u4f7f\u7528\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u62e1\u5f35\u6a5f\u80fd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pg_repack;\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u30c6\u30fc\u30d6\u30eb\u306e\u518d\u7de8\u6210\npg_repack -d mydb -t large_table\n\n# \u7279\u5b9a\u30b9\u30ad\u30fc\u30de\u306e\u5168\u30c6\u30fc\u30d6\u30eb\npg_repack -d mydb -s public\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5168\u4f53\npg_repack -d mydb\n\n# \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u307f\u518d\u7de8\u6210\npg_repack -d mydb -t large_table --only-indexes\n\n# \u4e26\u5217\u5b9f\u884c\uff08PostgreSQL 14+\uff09\npg_repack -d mydb -t large_table -j 4\n\n# \u30c9\u30e9\u30a4\u30e9\u30f3\uff08\u5b9f\u884c\u305b\u305a\u306b\u78ba\u8a8d\uff09\npg_repack -d mydb -t large_table --dry-run\n"})}),"\n",(0,t.jsx)(e.h3,{id:"32-pg_squeeze",children:"3.2 pg_squeeze"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"pg_repack\u306e\u4ee3\u66ff\u3002\u7570\u306a\u308b\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u30c6\u30fc\u30d6\u30eb\u518d\u7de8\u6210"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               pg_repack vs pg_squeeze                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010pg_repack\u3011                                                  \u2502\n\u2502  \u30fb\u30c8\u30ea\u30ac\u30fc\u3067\u5909\u66f4\u3092\u30ad\u30e3\u30d7\u30c1\u30e3                                  \u2502\n\u2502  \u30fb\u5916\u90e8\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c                                          \u2502\n\u2502  \u30fb\u4e00\u822c\u7684\u306b\u9ad8\u901f                                                 \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010pg_squeeze\u3011                                                 \u2502\n\u2502  \u30fb\u8ad6\u7406\u30c7\u30b3\u30fc\u30c9\u3067\u5909\u66f4\u3092\u30ad\u30e3\u30d7\u30c1\u30e3                              \u2502\n\u2502  \u30fb\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u3067\u5b9f\u884c                              \u2502\n\u2502  \u30fb\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5b9f\u884c\u304c\u53ef\u80fd                                      \u2502\n\u2502  \u30fb\u8ad6\u7406\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u74b0\u5883\u3067\u3082\u4f7f\u7528\u53ef\u80fd                        \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"4-\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u7cfb",children:"4. \u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u7cfb"}),"\n",(0,t.jsx)(e.h3,{id:"41-pg_cron",children:"4.1 pg_cron"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"PostgreSQL\u5185\u3067cron\u30b8\u30e7\u30d6\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         pg_cron                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u7279\u5fb4\u3011                                                       \u2502\n\u2502  \u30fbPostgreSQL\u5185\u90e8\u3067\u30b8\u30e7\u30d6\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0                      \u2502\n\u2502  \u30fbcron\u69cb\u6587\u3067\u6642\u9593\u6307\u5b9a                                          \u2502\n\u2502  \u30fbSQL/\u95a2\u6570\u3092\u5b9a\u671f\u5b9f\u884c                                          \u2502\n\u2502  \u30fb\u5b9f\u884c\u5c65\u6b74\u306e\u8a18\u9332                                              \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3011                                               \u2502\n\u2502  \u30fb\u53e4\u3044\u30c7\u30fc\u30bf\u306e\u5b9a\u671f\u524a\u9664                                        \u2502\n\u2502  \u30fb\u7d71\u8a08\u60c5\u5831\u306e\u5b9a\u671f\u53ce\u96c6                                          \u2502\n\u2502  \u30fb\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u7ba1\u7406                                          \u2502\n\u2502  \u30fb\u5b9a\u671f\u7684\u306aVACUUM/ANALYZE                                      \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u8a2d\u5b9a-1",children:"\u8a2d\u5b9a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\nshared_preload_libraries = 'pg_cron'\n\n# pg_cron\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\ncron.database_name = 'postgres'\n\n# \u540c\u6642\u5b9f\u884c\u30b8\u30e7\u30d6\u6570\ncron.max_running_jobs = 32\n\n# \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30ef\u30fc\u30ab\u30fc\u4f7f\u7528\uff08\u63a8\u5968\uff09\ncron.use_background_workers = on\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u4f7f\u7528\u4f8b-2",children:"\u4f7f\u7528\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pg_cron;\n\n-- \u30b8\u30e7\u30d6\u306e\u767b\u9332\uff08\u6bce\u65e5AM3\u6642\u306b\u53e4\u3044\u30ed\u30b0\u3092\u524a\u9664\uff09\nSELECT cron.schedule(\n    'cleanup-old-logs',           -- \u30b8\u30e7\u30d6\u540d\n    '0 3 * * *',                  -- cron\u5f0f\uff08\u6bce\u65e53:00\uff09\n    $$DELETE FROM logs WHERE created_at < now() - interval '30 days'$$\n);\n\n-- \u6bce\u66420\u5206\u306bVACUUM ANALYZE\nSELECT cron.schedule(\n    'hourly-vacuum',\n    '0 * * * *',\n    'VACUUM ANALYZE active_sessions'\n);\n\n-- \u6bce\u67081\u65e5\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u4f5c\u6210\nSELECT cron.schedule(\n    'create-monthly-partition',\n    '0 0 1 * *',\n    $$SELECT create_next_partition('events')$$\n);\n\n-- 5\u5206\u3054\u3068\u306b\u7d71\u8a08\u66f4\u65b0\nSELECT cron.schedule(\n    'update-stats',\n    '*/5 * * * *',\n    'SELECT refresh_materialized_view_concurrently()'\n);\n\n-- \u30b8\u30e7\u30d6\u4e00\u89a7\nSELECT * FROM cron.job;\n\n-- \u30b8\u30e7\u30d6\u306e\u524a\u9664\nSELECT cron.unschedule('cleanup-old-logs');\n\n-- \u30b8\u30e7\u30d6ID\u3067\u524a\u9664\nSELECT cron.unschedule(1);\n\n-- \u5b9f\u884c\u5c65\u6b74\nSELECT * FROM cron.job_run_details\nORDER BY start_time DESC\nLIMIT 20;\n\n-- \u5931\u6557\u3057\u305f\u30b8\u30e7\u30d6\u306e\u78ba\u8a8d\nSELECT * FROM cron.job_run_details\nWHERE status = 'failed'\nORDER BY start_time DESC;\n\n-- \u5225\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u30b8\u30e7\u30d6\u5b9f\u884c\uff08PostgreSQL 14+\uff09\nSELECT cron.schedule_in_database(\n    'cleanup-app-logs',\n    '0 4 * * *',\n    $$DELETE FROM logs WHERE age > 90$$,\n    'app_database'\n);\n"})}),"\n",(0,t.jsx)(e.h4,{id:"cron\u5f0f\u306e\u66f8\u5f0f",children:"cron\u5f0f\u306e\u66f8\u5f0f"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      cron\u5f0f\u306e\u66f8\u5f0f                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5206 (0-59)                                      \u2502\n\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u6642 (0-23)                                      \u2502\n\u2502  \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u65e5 (1-31)                                      \u2502\n\u2502  \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u6708 (1-12)                                      \u2502\n\u2502  \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500 \u66dc\u65e5 (0-6, 0=\u65e5\u66dc)                             \u2502\n\u2502  \u2502 \u2502 \u2502 \u2502 \u2502                                                     \u2502\n\u2502  * * * * *                                                      \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u4f8b\u3011                                                         \u2502\n\u2502  '0 3 * * *'      \u6bce\u65e53:00                                     \u2502\n\u2502  '*/5 * * * *'    5\u5206\u3054\u3068                                      \u2502\n\u2502  '0 0 * * 0'      \u6bce\u9031\u65e5\u66dc0:00                                 \u2502\n\u2502  '0 0 1 * *'      \u6bce\u67081\u65e50:00                                  \u2502\n\u2502  '30 4 1,15 * *'  \u6bce\u67081\u65e5\u306815\u65e5\u306e4:30                          \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"42-pg_partman",children:"4.2 pg_partman"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u7ba1\u7406\u3092\u81ea\u52d5\u5316\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       pg_partman                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u6a5f\u80fd\u3011                                                       \u2502\n\u2502  \u30fb\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u81ea\u52d5\u4f5c\u6210                                    \u2502\n\u2502  \u30fb\u53e4\u3044\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u81ea\u52d5\u524a\u9664/\u30a2\u30fc\u30ab\u30a4\u30d6                    \u2502\n\u2502  \u30fb\u6642\u9593\u30d9\u30fc\u30b9/\u30b7\u30ea\u30a2\u30eb\u30d9\u30fc\u30b9\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5bfe\u5fdc              \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u5bfe\u5fdc\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30bf\u30a4\u30d7\u3011                                  \u2502\n\u2502  \u30fbRANGE\uff08\u6642\u9593\u3001\u6570\u5024\uff09                                         \u2502\n\u2502  \u30fbLIST                                                         \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u8a2d\u5b9a\u4f7f\u7528\u4f8b",children:"\u8a2d\u5b9a\u30fb\u4f7f\u7528\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE SCHEMA IF NOT EXISTS partman;\nCREATE EXTENSION IF NOT EXISTS pg_partman SCHEMA partman;\n\n-- \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\nCREATE TABLE events (\n    id BIGSERIAL,\n    event_time TIMESTAMPTZ NOT NULL,\n    event_type TEXT,\n    payload JSONB,\n    PRIMARY KEY (id, event_time)\n) PARTITION BY RANGE (event_time);\n\n-- pg_partman\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u7ba1\u7406\u3092\u8a2d\u5b9a\nSELECT partman.create_parent(\n    p_parent_table := 'public.events',\n    p_control := 'event_time',\n    p_type := 'native',\n    p_interval := 'daily',\n    p_premake := 7,           -- 7\u65e5\u5148\u307e\u3067\u4e8b\u524d\u4f5c\u6210\n    p_start_partition := (now() - interval '30 days')::text\n);\n\n-- \u8a2d\u5b9a\u306e\u78ba\u8a8d\nSELECT * FROM partman.part_config;\n\n-- \u624b\u52d5\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u5b9f\u884c\nCALL partman.run_maintenance_proc();\n\n-- \u53e4\u3044\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u4fdd\u6301\u8a2d\u5b9a\uff0830\u65e5\u3088\u308a\u53e4\u3044\u3082\u306e\u3092\u524a\u9664\uff09\nUPDATE partman.part_config\nSET retention = '30 days',\n    retention_keep_table = false,  -- \u30c6\u30fc\u30d6\u30eb\u524a\u9664\n    retention_keep_index = false\nWHERE parent_table = 'public.events';\n\n-- pg_cron\u3068\u9023\u643a\uff08\u6bce\u6642\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\uff09\nSELECT cron.schedule(\n    'partman-maintenance',\n    '0 * * * *',\n    'CALL partman.run_maintenance_proc()'\n);\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"5-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u6697\u53f7\u5316\u7cfb",children:"5. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fb\u6697\u53f7\u5316\u7cfb"}),"\n",(0,t.jsx)(e.h3,{id:"51-pgcrypto",children:"5.1 pgcrypto"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u6697\u53f7\u5316\u95a2\u6570\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pgcrypto;\n\n-- \u30cf\u30c3\u30b7\u30e5\u95a2\u6570\nSELECT encode(digest('password', 'sha256'), 'hex');\nSELECT encode(digest('password', 'sha512'), 'hex');\n\n-- \u30d1\u30b9\u30ef\u30fc\u30c9\u30cf\u30c3\u30b7\u30e5\uff08bcrypt\uff09\nSELECT crypt('user_password', gen_salt('bf', 10));\n\n-- \u30d1\u30b9\u30ef\u30fc\u30c9\u691c\u8a3c\nSELECT crypt('input_password', stored_hash) = stored_hash;\n\n-- \u30e9\u30f3\u30c0\u30e0\u30d0\u30a4\u30c8\u751f\u6210\nSELECT encode(gen_random_bytes(32), 'hex');\n\n-- UUID\u751f\u6210\uff08PostgreSQL 13+\u306fgen_random_uuid()\u304c\u6a19\u6e96\uff09\nSELECT gen_random_uuid();\n\n-- \u5bfe\u79f0\u9375\u6697\u53f7\uff08AES-256\uff09\n-- \u6697\u53f7\u5316\nSELECT encode(\n    encrypt('\u6a5f\u5bc6\u30c7\u30fc\u30bf'::bytea, 'encryption_key'::bytea, 'aes'),\n    'base64'\n);\n\n-- \u5fa9\u53f7\nSELECT convert_from(\n    decrypt(\n        decode('\u6697\u53f7\u5316\u3055\u308c\u305f\u30c7\u30fc\u30bf', 'base64'),\n        'encryption_key'::bytea,\n        'aes'\n    ),\n    'UTF8'\n);\n\n-- PGP\u6697\u53f7\u5316\nSELECT armor(pgp_sym_encrypt('\u6a5f\u5bc6\u30c7\u30fc\u30bf', 'passphrase'));\n\n-- PGP\u5fa9\u53f7\nSELECT pgp_sym_decrypt(\n    dearmor('-----BEGIN PGP MESSAGE----- ...'),\n    'passphrase'\n);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"52-pgaudit",children:"5.2 pgaudit"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u8a73\u7d30\u306a\u76e3\u67fb\u30ed\u30b0\u3092\u51fa\u529b\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        pgaudit                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u6a5f\u80fd\u3011                                                       \u2502\n\u2502  \u30fb\u30bb\u30c3\u30b7\u30e7\u30f3\u76e3\u67fb\u30ed\u30b0\uff08\u5168\u30af\u30a8\u30ea\uff09                              \u2502\n\u2502  \u30fb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u76e3\u67fb\u30ed\u30b0\uff08\u7279\u5b9a\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u30a2\u30af\u30bb\u30b9\uff09            \u2502\n\u2502  \u30fb\u30ed\u30fc\u30eb\u5225\u306e\u76e3\u67fb\u8a2d\u5b9a                                          \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30ed\u30b0\u5bfe\u8c61\u3011                                                   \u2502\n\u2502  \u30fbREAD: SELECT, COPY FROM                                     \u2502\n\u2502  \u30fbWRITE: INSERT, UPDATE, DELETE, TRUNCATE, COPY TO            \u2502\n\u2502  \u30fbFUNCTION: \u95a2\u6570\u547c\u3073\u51fa\u3057                                      \u2502\n\u2502  \u30fbROLE: \u30ed\u30fc\u30eb\u64cd\u4f5c                                            \u2502\n\u2502  \u30fbDDL: CREATE, ALTER, DROP                                    \u2502\n\u2502  \u30fbMISC: \u305d\u306e\u4ed6                                                \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u8a2d\u5b9a-2",children:"\u8a2d\u5b9a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\nshared_preload_libraries = 'pgaudit'\n\n# \u30bb\u30c3\u30b7\u30e7\u30f3\u76e3\u67fb\uff08\u5168\u30e6\u30fc\u30b6\u30fc\uff09\npgaudit.log = 'ddl, role'\n\n# \u30ed\u30b0\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u540d\u3092\u542b\u3081\u308b\npgaudit.log_relation = on\n\n# \u30ed\u30b0\u306b\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u3092\u542b\u3081\u308b\npgaudit.log_statement_once = off\n\n# \u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u8a18\u9332\npgaudit.log_parameter = on\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pgaudit;\n\n-- \u7279\u5b9a\u30ed\u30fc\u30eb\u306e\u76e3\u67fb\u8a2d\u5b9a\nALTER ROLE audited_user SET pgaudit.log = 'read, write';\n\n-- \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u76e3\u67fb\u7528\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\nCREATE ROLE auditor NOLOGIN;\nGRANT SELECT ON sensitive_table TO auditor;\n\n-- \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u76e3\u67fb\u306e\u6709\u52b9\u5316\nSET pgaudit.role = 'auditor';\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u30ed\u30b0\u51fa\u529b\u4f8b",children:"\u30ed\u30b0\u51fa\u529b\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'AUDIT: SESSION,1,1,DDL,CREATE TABLE,TABLE,public.users,\n       "CREATE TABLE users (id SERIAL PRIMARY KEY, name TEXT)"\n\nAUDIT: SESSION,2,1,READ,SELECT,TABLE,public.users,\n       "SELECT * FROM users WHERE id = $1",[123]\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"6-\u30c7\u30fc\u30bf\u578b\u691c\u7d22\u62e1\u5f35\u7cfb",children:"6. \u30c7\u30fc\u30bf\u578b\u30fb\u691c\u7d22\u62e1\u5f35\u7cfb"}),"\n",(0,t.jsx)(e.h3,{id:"61-uuid-ossp",children:"6.1 uuid-ossp"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"UUID\u751f\u6210\u95a2\u6570\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\n\n-- \u30d0\u30fc\u30b8\u30e7\u30f31 UUID\uff08MAC\u30a2\u30c9\u30ec\u30b9+\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\uff09\nSELECT uuid_generate_v1();\n\n-- \u30d0\u30fc\u30b8\u30e7\u30f34 UUID\uff08\u30e9\u30f3\u30c0\u30e0\uff09\u203b\u6700\u3082\u4e00\u822c\u7684\nSELECT uuid_generate_v4();\n\n-- PostgreSQL 13+\u306f\u6a19\u6e96\u95a2\u6570\u3067\u4ee3\u66ff\u53ef\u80fd\nSELECT gen_random_uuid();\n\n-- \u30c6\u30fc\u30d6\u30eb\u3067\u306e\u4f7f\u7528\u4f8b\nCREATE TABLE orders (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMPTZ DEFAULT now()\n);\n'})}),"\n",(0,t.jsx)(e.h3,{id:"62-pg_trgm",children:"6.2 pg_trgm"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u985e\u4f3c\u6587\u5b57\u5217\u691c\u7d22\uff08\u3042\u3044\u307e\u3044\u691c\u7d22\uff09\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        pg_trgm                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u30c8\u30e9\u30a4\u30b0\u30e9\u30e0 (trigram)\u3011                                     \u2502\n\u2502  \u6587\u5b57\u5217\u30923\u6587\u5b57\u305a\u3064\u306b\u5206\u5272\u3057\u3066\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97                       \u2502\n\u2502                                                                 \u2502\n\u2502  "hello" \u2192 {"  h", " he", "hel", "ell", "llo", "lo ", "o  "}   \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3011                                               \u2502\n\u2502  \u30fb\u30bf\u30a4\u30d7\u30df\u30b9\u8a31\u5bb9\u691c\u7d22                                          \u2502\n\u2502  \u30fb\u6c0f\u540d\u306e\u3042\u3044\u307e\u3044\u691c\u7d22                                          \u2502\n\u2502  \u30fb\u5546\u54c1\u540d\u306e\u985e\u4f3c\u691c\u7d22                                            \u2502\n\u2502  \u30fbLIKE\u691c\u7d22\u306e\u9ad8\u901f\u5316                                            \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS pg_trgm;\n\n-- \u985e\u4f3c\u5ea6\u306e\u8a08\u7b97\nSELECT similarity('hello', 'hallo');  -- 0.5\nSELECT similarity('PostgreSQL', 'PostgrsQL');  -- 0.6\n\n-- \u985e\u4f3c\u5ea6\u306b\u3088\u308b\u691c\u7d22\nSELECT name, similarity(name, 'Jhon') AS sim\nFROM users\nWHERE similarity(name, 'Jhon') > 0.3\nORDER BY sim DESC;\n\n-- %\u6f14\u7b97\u5b50\uff08\u95be\u5024: pg_trgm.similarity_threshold\uff09\nSELECT * FROM users WHERE name % 'Jhon';\n\n-- GIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u4f5c\u6210\uff08\u9ad8\u901f\u5316\uff09\nCREATE INDEX idx_users_name_trgm ON users USING gin (name gin_trgm_ops);\n\n-- GiST\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08ORDER BY similarity\u306b\u6700\u9069\uff09\nCREATE INDEX idx_users_name_gist ON users USING gist (name gist_trgm_ops);\n\n-- LIKE/ILIKE\u306e\u9ad8\u901f\u5316\n-- GIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u3042\u308c\u3070\u3001LIKE\u3082\u9ad8\u901f\nSELECT * FROM users WHERE name LIKE '%smith%';\nSELECT * FROM users WHERE name ILIKE '%SMITH%';\n\n-- \u6b63\u898f\u8868\u73fe\u3082\u9ad8\u901f\u5316\nSELECT * FROM users WHERE name ~ 'john|jane';\n"})}),"\n",(0,t.jsx)(e.h3,{id:"63-hstore",children:"6.3 hstore"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u30ad\u30fc\u30d0\u30ea\u30e5\u30fc\u578b\u306e\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS hstore;\n\n-- hstore\u30ab\u30e9\u30e0\u306e\u4f5c\u6210\nCREATE TABLE products (\n    id SERIAL PRIMARY KEY,\n    name TEXT,\n    attributes hstore\n);\n\n-- \u30c7\u30fc\u30bf\u306e\u633f\u5165\nINSERT INTO products (name, attributes)\nVALUES ('Laptop', 'brand => Dell, cpu => \"Intel i7\", ram => \"16GB\"');\n\n-- \u5024\u306e\u53d6\u5f97\nSELECT attributes -> 'brand' FROM products;\n\n-- \u30ad\u30fc\u306e\u5b58\u5728\u78ba\u8a8d\nSELECT * FROM products WHERE attributes ? 'gpu';\n\n-- \u8907\u6570\u30ad\u30fc\u306e\u5b58\u5728\u78ba\u8a8d\nSELECT * FROM products WHERE attributes ?& ARRAY['brand', 'cpu'];\n\n-- \u5024\u3067\u306e\u691c\u7d22\nSELECT * FROM products WHERE attributes @> 'brand => Dell';\n\n-- \u30ad\u30fc\u306e\u8ffd\u52a0/\u66f4\u65b0\nUPDATE products\nSET attributes = attributes || 'ssd => \"512GB\"'\nWHERE id = 1;\n\n-- GIN\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\nCREATE INDEX idx_products_attrs ON products USING gin (attributes);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"64-citext",children:"6.4 citext"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u5927\u6587\u5b57\u5c0f\u6587\u5b57\u3092\u533a\u5225\u3057\u306a\u3044\u30c6\u30ad\u30b9\u30c8\u578b\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS citext;\n\n-- citext\u30ab\u30e9\u30e0\u306e\u4f5c\u6210\nCREATE TABLE users (\n    id SERIAL PRIMARY KEY,\n    email citext UNIQUE,\n    username citext\n);\n\n-- \u5927\u6587\u5b57\u5c0f\u6587\u5b57\u3092\u7121\u8996\u3057\u3066\u4e00\u610f\u5236\u7d04\nINSERT INTO users (email) VALUES ('User@Example.com');\nINSERT INTO users (email) VALUES ('user@example.com');  -- \u91cd\u8907\u30a8\u30e9\u30fc\n\n-- \u691c\u7d22\u3082\u5927\u6587\u5b57\u5c0f\u6587\u5b57\u3092\u7121\u8996\nSELECT * FROM users WHERE email = 'USER@EXAMPLE.COM';  -- \u30de\u30c3\u30c1\u3059\u308b\n"})}),"\n",(0,t.jsx)(e.h3,{id:"65-ltree",children:"6.5 ltree"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u968e\u5c64\u69cb\u9020\u30c7\u30fc\u30bf\u3092\u52b9\u7387\u7684\u306b\u6271\u3044\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS ltree;\n\n-- \u968e\u5c64\u30c7\u30fc\u30bf\u306e\u683c\u7d0d\nCREATE TABLE categories (\n    id SERIAL PRIMARY KEY,\n    name TEXT,\n    path ltree\n);\n\n-- \u30c7\u30fc\u30bf\u306e\u633f\u5165\nINSERT INTO categories (name, path) VALUES\n    ('Electronics', 'electronics'),\n    ('Computers', 'electronics.computers'),\n    ('Laptops', 'electronics.computers.laptops'),\n    ('Desktops', 'electronics.computers.desktops'),\n    ('Phones', 'electronics.phones');\n\n-- \u5b50\u5b6b\u306e\u53d6\u5f97\uff08@>\uff09\nSELECT * FROM categories WHERE path <@ 'electronics.computers';\n\n-- \u7956\u5148\u306e\u53d6\u5f97\uff08<@\uff09\nSELECT * FROM categories WHERE path @> 'electronics.computers.laptops';\n\n-- \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\nSELECT * FROM categories WHERE path ~ 'electronics.*{1}';  -- \u76f4\u63a5\u306e\u5b50\n\n-- GiST\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\nCREATE INDEX idx_categories_path ON categories USING gist (path);\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"7-\u5730\u7406\u60c5\u5831\u7cfb",children:"7. \u5730\u7406\u60c5\u5831\u7cfb"}),"\n",(0,t.jsx)(e.h3,{id:"71-postgis",children:"7.1 PostGIS"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u5730\u7406\u7a7a\u9593\u30c7\u30fc\u30bf\u3092\u6271\u3046\u6700\u3082\u5f37\u529b\u306a\u62e1\u5f35\u6a5f\u80fd\u3067\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        PostGIS                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u6a5f\u80fd\u3011                                                       \u2502\n\u2502  \u30fbgeometry/geography \u30c7\u30fc\u30bf\u578b                                 \u2502\n\u2502  \u30fb\u7a7a\u9593\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08GiST\uff09                                    \u2502\n\u2502  \u30fb\u7a7a\u9593\u95a2\u6570\uff08\u8ddd\u96e2\u3001\u4ea4\u5dee\u3001\u5305\u542b\u306a\u3069\uff09                            \u2502\n\u2502  \u30fb\u5ea7\u6a19\u7cfb\u5909\u63db                                                  \u2502\n\u2502  \u30fb\u30e9\u30b9\u30bf\u30fc\u30c7\u30fc\u30bf\u5bfe\u5fdc                                          \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3011                                               \u2502\n\u2502  \u30fb\u4f4d\u7f6e\u60c5\u5831\u30b5\u30fc\u30d3\u30b9                                            \u2502\n\u2502  \u30fb\u914d\u9001\u30eb\u30fc\u30c8\u6700\u9069\u5316                                            \u2502\n\u2502  \u30fb\u5730\u56f3\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3                                        \u2502\n\u2502  \u30fb\u4e0d\u52d5\u7523\u691c\u7d22                                                  \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS postgis;\n\n-- \u4f4d\u7f6e\u60c5\u5831\u30c6\u30fc\u30d6\u30eb\nCREATE TABLE locations (\n    id SERIAL PRIMARY KEY,\n    name TEXT,\n    location geography(Point, 4326)  -- WGS84\u5ea7\u6a19\u7cfb\n);\n\n-- \u30c7\u30fc\u30bf\u306e\u633f\u5165\nINSERT INTO locations (name, location)\nVALUES ('Tokyo Station', ST_GeogFromText('POINT(139.7671 35.6812)'));\n\n-- \u7279\u5b9a\u5730\u70b9\u304b\u3089\u306e\u8ddd\u96e2\u3067\u691c\u7d22\uff08\u534a\u5f845km\u4ee5\u5185\uff09\nSELECT name, ST_Distance(location, ST_GeogFromText('POINT(139.7671 35.6812)')) AS distance_m\nFROM locations\nWHERE ST_DWithin(location, ST_GeogFromText('POINT(139.7671 35.6812)'), 5000);\n\n-- \u7a7a\u9593\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\nCREATE INDEX idx_locations_geog ON locations USING gist (location);\n\n-- \u6700\u5bc4\u308a\u306e\u5834\u6240\u3092\u691c\u7d22\nSELECT name, ST_Distance(location, ST_GeogFromText('POINT(139.75 35.68)')) AS distance_m\nFROM locations\nORDER BY location <-> ST_GeogFromText('POINT(139.75 35.68)')\nLIMIT 5;\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"8-\u5916\u90e8\u30c7\u30fc\u30bf\u9023\u643a\u7cfb",children:"8. \u5916\u90e8\u30c7\u30fc\u30bf\u9023\u643a\u7cfb"}),"\n",(0,t.jsx)(e.h3,{id:"81-postgres_fdw",children:"8.1 postgres_fdw"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u4ed6\u306ePostgreSQL\u30b5\u30fc\u30d0\u30fc\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS postgres_fdw;\n\n-- \u5916\u90e8\u30b5\u30fc\u30d0\u30fc\u306e\u5b9a\u7fa9\nCREATE SERVER remote_server\nFOREIGN DATA WRAPPER postgres_fdw\nOPTIONS (host 'remote-host', port '5432', dbname 'remote_db');\n\n-- \u30e6\u30fc\u30b6\u30fc\u30de\u30c3\u30d4\u30f3\u30b0\nCREATE USER MAPPING FOR local_user\nSERVER remote_server\nOPTIONS (user 'remote_user', password 'remote_password');\n\n-- \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\nIMPORT FOREIGN SCHEMA public\nFROM SERVER remote_server\nINTO local_schema;\n\n-- \u500b\u5225\u306e\u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\nCREATE FOREIGN TABLE remote_users (\n    id INTEGER,\n    name TEXT,\n    email TEXT\n)\nSERVER remote_server\nOPTIONS (schema_name 'public', table_name 'users');\n\n-- \u4f7f\u7528\uff08\u901a\u5e38\u306e\u30c6\u30fc\u30d6\u30eb\u3068\u540c\u69d8\uff09\nSELECT * FROM remote_users WHERE id = 1;\n"})}),"\n",(0,t.jsx)(e.h3,{id:"82-file_fdw",children:"8.2 file_fdw"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"CSV\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u30c6\u30fc\u30d6\u30eb\u3068\u3057\u3066\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS file_fdw;\n\n-- \u30b5\u30fc\u30d0\u30fc\u5b9a\u7fa9\nCREATE SERVER file_server FOREIGN DATA WRAPPER file_fdw;\n\n-- \u5916\u90e8\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\nCREATE FOREIGN TABLE import_data (\n    id INTEGER,\n    name TEXT,\n    value NUMERIC\n)\nSERVER file_server\nOPTIONS (\n    filename '/var/lib/postgresql/data/import.csv',\n    format 'csv',\n    header 'true'\n);\n\n-- \u4f7f\u7528\nSELECT * FROM import_data;\nCOPY real_table FROM (SELECT * FROM import_data WHERE value > 100);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"83-aws_commonsrds\u5c02\u7528",children:"8.3 aws_commons\uff08RDS\u5c02\u7528\uff09"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"AWS\u9023\u643a\u62e1\u5f35\u6a5f\u80fd\u306e\u5171\u901a\u57fa\u76e4\u3067\u3059\u3002"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Note:"})," ",(0,t.jsx)(e.code,{children:"shared_preload_libraries"})," \u3078\u306e\u8ffd\u52a0\u306f",(0,t.jsx)(e.strong,{children:"\u4e0d\u8981"}),"\u3067\u3059\u3002\n\u901a\u5e38\u306f ",(0,t.jsx)(e.code,{children:"aws_s3"})," \u3084 ",(0,t.jsx)(e.code,{children:"aws_lambda"})," \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b ",(0,t.jsx)(e.code,{children:"CASCADE"})," \u3067\u81ea\u52d5\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       aws_commons                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u5f79\u5272\u3011                                                       \u2502\n\u2502  aws_s3, aws_lambda \u306a\u3069AWS\u9023\u643a\u62e1\u5f35\u306e\u5171\u901a\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u3092\u63d0\u4f9b    \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u4f9d\u5b58\u95a2\u4fc2\u3011                                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502              aws_commons\uff08\u5171\u901a\u57fa\u76e4\uff09                     \u2502   \u2502\n\u2502  \u2502                    \u25b2                                     \u2502   \u2502\n\u2502  \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502   \u2502\n\u2502  \u2502         \u2502                     \u2502                          \u2502   \u2502\n\u2502  \u2502     aws_s3               aws_lambda                      \u2502   \u2502\n\u2502  \u2502   (S3\u9023\u643a)             (Lambda\u9023\u643a)                      \u2502   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u63d0\u4f9b\u3059\u308b\u4e3b\u306a\u95a2\u6570\u3011                                           \u2502\n\u2502  \u30fbcreate_s3_uri()              - S3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306eURI\u4f5c\u6210      \u2502\n\u2502  \u30fbcreate_lambda_function_arn() - Lambda\u95a2\u6570\u306eARN\u4f5c\u6210          \u2502\n\u2502  \u30fbcreate_aws_credentials()     - \u8a8d\u8a3c\u60c5\u5831\u306e\u4f5c\u6210\uff08\u975e\u63a8\u5968\uff09     \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u4e3b\u306a\u95a2\u6570",children:"\u4e3b\u306a\u95a2\u6570"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08\u901a\u5e38\u306f\u4f9d\u5b58\u95a2\u4fc2\u3067\u81ea\u52d5\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff09\nCREATE EXTENSION IF NOT EXISTS aws_commons;\n\n-- S3 URI\u306e\u4f5c\u6210\nSELECT aws_commons.create_s3_uri(\n    'bucket-name',           -- \u30d0\u30b1\u30c3\u30c8\u540d\n    'path/to/object.csv',    -- \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30ad\u30fc\n    'ap-northeast-1'         -- \u30ea\u30fc\u30b8\u30e7\u30f3\n);\n\n-- Lambda\u95a2\u6570ARN\u306e\u4f5c\u6210\nSELECT aws_commons.create_lambda_function_arn(\n    'function-name',         -- \u95a2\u6570\u540d\n    'ap-northeast-1'         -- \u30ea\u30fc\u30b8\u30e7\u30f3\n);\n\n-- \u8a8d\u8a3c\u60c5\u5831\u306e\u4f5c\u6210\uff08IAM\u30ed\u30fc\u30eb\u4f7f\u7528\u6642\u306f\u4e0d\u8981\u3001\u975e\u63a8\u5968\uff09\nSELECT aws_commons.create_aws_credentials(\n    'AKIAIOSFODNN7EXAMPLE',  -- \u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\n    'wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY',  -- \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\n    ''                       -- \u30bb\u30c3\u30b7\u30e7\u30f3\u30c8\u30fc\u30af\u30f3\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09\n);\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03",children:"\u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"\u65b9\u5f0f"}),(0,t.jsx)(e.th,{children:"\u8a2d\u5b9a\u65b9\u6cd5"}),(0,t.jsx)(e.th,{style:{textAlign:"center"},children:"\u63a8\u5968\u5ea6"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"IAM\u30ed\u30fc\u30eb"})}),(0,t.jsx)(e.td,{children:"RDS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30fc\u30eb\u3092\u30a2\u30bf\u30c3\u30c1"}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u2705 \u63a8\u5968"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u30a2\u30af\u30bb\u30b9\u30ad\u30fc"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"create_aws_credentials()"}),"\u3067\u6307\u5b9a"]}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:"\u26a0\ufe0f \u975e\u63a8\u5968"})]})]})]}),"\n",(0,t.jsx)(e.p,{children:"IAM\u30ed\u30fc\u30eb\u4f7f\u7528\u6642\u306f\u8a8d\u8a3c\u60c5\u5831\u306e\u6307\u5b9a\u304c\u4e0d\u8981\u3067\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u9762\u3067\u3082\u512a\u308c\u3066\u3044\u307e\u3059\u3002"}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h3,{id:"84-aws_s3rds\u5c02\u7528",children:"8.4 aws_s3\uff08RDS\u5c02\u7528\uff09"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Amazon S3\u3068\u306e\u9593\u3067\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8/\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Note:"})," ",(0,t.jsx)(e.code,{children:"shared_preload_libraries"})," \u3078\u306e\u8ffd\u52a0\u306f",(0,t.jsx)(e.strong,{children:"\u4e0d\u8981"}),"\u3067\u3059\u3002\n",(0,t.jsx)(e.code,{children:"CREATE EXTENSION"})," \u306e\u307f\u3067\u4f7f\u7528\u53ef\u80fd\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u518d\u8d77\u52d5\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\n\uff08\u65b0\u3057\u3044\u95a2\u6570\u3092\u63d0\u4f9b\u3059\u308b\u3060\u3051\u3067\u3001\u5171\u6709\u30e1\u30e2\u30ea\u30fb\u30d5\u30c3\u30af\u30fbBG\u30ef\u30fc\u30ab\u30fc\u3092\u4f7f\u7528\u3057\u306a\u3044\u305f\u3081\uff09"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         aws_s3                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u63d0\u4f9b\u5143\u3011Amazon RDS for PostgreSQL \u5c02\u7528                       \u2502\n\u2502  \u3010\u524d\u63d0\u3011aws_commons \u62e1\u5f35\u6a5f\u80fd\u304c\u5fc5\u8981\uff08CASCADE \u3067\u81ea\u52d5\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff09\u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3011                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                          \u2502   \u2502\n\u2502  \u2502   RDS PostgreSQL  \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba  Amazon S3        \u2502   \u2502\n\u2502  \u2502        \u2502                                    \u2502            \u2502   \u2502\n\u2502  \u2502        \u2502  table_import_from_s3()           \u2502            \u2502   \u2502\n\u2502  \u2502        \u2502  \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502            \u2502   \u2502\n\u2502  \u2502        \u2502                                    \u2502            \u2502   \u2502\n\u2502  \u2502        \u2502  query_export_to_s3()             \u2502            \u2502   \u2502\n\u2502  \u2502        \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba   \u2502            \u2502   \u2502\n\u2502  \u2502        \u2502                                    \u2502            \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u6a5f\u80fd\u3011                                                       \u2502\n\u2502  \u30fbS3\u304b\u3089\u30c6\u30fc\u30d6\u30eb\u3078\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8                            \u2502\n\u2502  \u30fb\u30af\u30a8\u30ea\u7d50\u679c\u3092S3\u3078\u30a8\u30af\u30b9\u30dd\u30fc\u30c8                                \u2502\n\u2502  \u30fbCSV/\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\u5bfe\u5fdc                                        \u2502\n\u2502  \u30fbgzip\u5727\u7e2e\u5bfe\u5fdc                                                \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u8a8d\u8a3c\u65b9\u5f0f\u3011                                                   \u2502\n\u2502  \u30fbIAM\u30ed\u30fc\u30eb\u3092RDS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a2\u30bf\u30c3\u30c1\uff08\u63a8\u5968\uff09                \u2502\n\u2502  \u30fb\u30a2\u30af\u30bb\u30b9\u30ad\u30fc/\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\uff08\u975e\u63a8\u5968\uff09                     \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u524d\u63d0\u6761\u4ef6iam\u30ed\u30fc\u30eb\u8a2d\u5b9a",children:"\u524d\u63d0\u6761\u4ef6\uff08IAM\u30ed\u30fc\u30eb\u8a2d\u5b9a\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    IAM\u30ed\u30fc\u30eb\u8a2d\u5b9a\u624b\u9806                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  1. IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210                                             \u2502\n\u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502     \u2502 {                                                    \u2502    \u2502\n\u2502     \u2502   "Version": "2012-10-17",                          \u2502    \u2502\n\u2502     \u2502   "Statement": [                                     \u2502    \u2502\n\u2502     \u2502     {                                                \u2502    \u2502\n\u2502     \u2502       "Effect": "Allow",                            \u2502    \u2502\n\u2502     \u2502       "Action": [                                    \u2502    \u2502\n\u2502     \u2502         "s3:GetObject",                             \u2502    \u2502\n\u2502     \u2502         "s3:PutObject",                             \u2502    \u2502\n\u2502     \u2502         "s3:ListBucket"                             \u2502    \u2502\n\u2502     \u2502       ],                                             \u2502    \u2502\n\u2502     \u2502       "Resource": [                                  \u2502    \u2502\n\u2502     \u2502         "arn:aws:s3:::your-bucket",                 \u2502    \u2502\n\u2502     \u2502         "arn:aws:s3:::your-bucket/*"                \u2502    \u2502\n\u2502     \u2502       ]                                              \u2502    \u2502\n\u2502     \u2502     }                                                \u2502    \u2502\n\u2502     \u2502   ]                                                  \u2502    \u2502\n\u2502     \u2502 }                                                    \u2502    \u2502\n\u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                                 \u2502\n\u2502  2. RDS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bIAM\u30ed\u30fc\u30eb\u3092\u30a2\u30bf\u30c3\u30c1                        \u2502\n\u2502     aws rds add-role-to-db-instance \\                          \u2502\n\u2502       --db-instance-identifier your-rds-instance \\             \u2502\n\u2502       --role-arn arn:aws:iam::123456789:role/rds-s3-role \\    \u2502\n\u2502       --feature-name s3Import                                  \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,t.jsx)(e.h4,{id:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",children:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- aws_commons\u3082\u81ea\u52d5\u7684\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\nCREATE EXTENSION IF NOT EXISTS aws_s3 CASCADE;\n\n-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d\nSELECT * FROM pg_extension WHERE extname IN ('aws_s3', 'aws_commons');\n"})}),"\n",(0,t.jsx)(e.h4,{id:"s3\u304b\u3089\u306e\u30a4\u30f3\u30dd\u30fc\u30c8",children:"S3\u304b\u3089\u306e\u30a4\u30f3\u30dd\u30fc\u30c8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u57fa\u672c\u7684\u306a\u30a4\u30f3\u30dd\u30fc\u30c8\nSELECT aws_s3.table_import_from_s3(\n    'target_table',                    -- \u30a4\u30f3\u30dd\u30fc\u30c8\u5148\u30c6\u30fc\u30d6\u30eb\n    '',                                -- \u30ab\u30e9\u30e0\u6307\u5b9a\uff08\u7a7a=\u5168\u30ab\u30e9\u30e0\uff09\n    '(format csv, header true)',       -- COPY\u30aa\u30d7\u30b7\u30e7\u30f3\n    aws_commons.create_s3_uri(\n        'my-bucket',                   -- \u30d0\u30b1\u30c3\u30c8\u540d\n        'data/import.csv',             -- \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30ad\u30fc\n        'ap-northeast-1'               -- \u30ea\u30fc\u30b8\u30e7\u30f3\n    )\n);\n\n-- \u7279\u5b9a\u30ab\u30e9\u30e0\u306e\u307f\u30a4\u30f3\u30dd\u30fc\u30c8\nSELECT aws_s3.table_import_from_s3(\n    'users',\n    'id, name, email',                 -- \u30ab\u30e9\u30e0\u6307\u5b9a\n    '(format csv, header true, null ''NULL'')',\n    aws_commons.create_s3_uri(\n        'my-bucket',\n        'imports/users.csv',\n        'ap-northeast-1'\n    )\n);\n\n-- gzip\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\nSELECT aws_s3.table_import_from_s3(\n    'large_table',\n    '',\n    '(format csv, header true)',\n    aws_commons.create_s3_uri(\n        'my-bucket',\n        'data/large_data.csv.gz',\n        'ap-northeast-1'\n    )\n);\n"})}),"\n",(0,t.jsx)(e.h4,{id:"s3\u3078\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8",children:"S3\u3078\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30af\u30a8\u30ea\u7d50\u679c\u3092S3\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\nSELECT aws_s3.query_export_to_s3(\n    'SELECT * FROM orders WHERE created_at >= ''2024-01-01''',\n    aws_commons.create_s3_uri(\n        'my-bucket',\n        'exports/orders_2024.csv',\n        'ap-northeast-1'\n    ),\n    options := 'format csv, header true'\n);\n\n-- \u8907\u96d1\u306a\u30af\u30a8\u30ea\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\nSELECT aws_s3.query_export_to_s3(\n    $$\n    SELECT\n        u.id,\n        u.name,\n        u.email,\n        count(o.id) as order_count,\n        sum(o.total) as total_amount\n    FROM users u\n    LEFT JOIN orders o ON u.id = o.user_id\n    GROUP BY u.id, u.name, u.email\n    $$,\n    aws_commons.create_s3_uri(\n        'my-bucket',\n        'reports/user_summary.csv',\n        'ap-northeast-1'\n    ),\n    options := 'format csv, header true'\n);\n\n-- \u623b\u308a\u5024\uff08\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3055\u308c\u305f\u884c\u6570\u3068\u30d5\u30a1\u30a4\u30eb\u60c5\u5831\uff09\n-- rows_uploaded | files_uploaded | bytes_uploaded\n-- 10000         | 1              | 524288\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9",children:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    aws_s3 \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u30c7\u30fc\u30bf\u30ec\u30a4\u30af\u9023\u643a\u3011                                           \u2502\n\u2502  RDS \u2192 S3 \u2192 Athena/Redshift/EMR                                \u2502\n\u2502  \u5b9a\u671f\u7684\u306b\u30af\u30a8\u30ea\u7d50\u679c\u3092S3\u306b\u51fa\u529b\u3057\u3001\u5206\u6790\u57fa\u76e4\u3067\u6d3b\u7528                \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30d0\u30eb\u30af\u30a4\u30f3\u30dd\u30fc\u30c8\u3011                                           \u2502\n\u2502  \u5927\u91cfCSV\u30d5\u30a1\u30a4\u30eb\u3092S3\u7d4c\u7531\u3067\u9ad8\u901f\u306b\u30ed\u30fc\u30c9                         \u2502\n\u2502  COPY\u30b3\u30de\u30f3\u30c9\u3088\u308a\u9ad8\u901f\uff08\u4e26\u5217\u51e6\u7406\uff09                              \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u88dc\u5b8c\u3011                                           \u2502\n\u2502  \u7279\u5b9a\u30c6\u30fc\u30d6\u30eb\u306e\u8ad6\u7406\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092S3\u306b\u76f4\u63a5\u51fa\u529b                  \u2502\n\u2502  \u65e5\u6b21\u3067\u30de\u30b9\u30bf\u30fc\u30c7\u30fc\u30bf\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8                            \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010ETL\u51e6\u7406\u3011                                                    \u2502\n\u2502  S3 \u2192 RDS: Lambda/Glue\u3067\u52a0\u5de5\u3057\u305f\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8             \u2502\n\u2502  RDS \u2192 S3: \u52a0\u5de5\u7d50\u679c\u3092\u4ed6\u30b7\u30b9\u30c6\u30e0\u3078\u9023\u643a                          \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010pg_cron\u3068\u306e\u9023\u643a\u4f8b\u3011                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 SELECT cron.schedule(                                    \u2502   \u2502\n\u2502  \u2502     'daily-export',                                      \u2502   \u2502\n\u2502  \u2502     '0 2 * * *',                                        \u2502   \u2502\n\u2502  \u2502     $$SELECT aws_s3.query_export_to_s3(                 \u2502   \u2502\n\u2502  \u2502         'SELECT * FROM daily_metrics',                   \u2502   \u2502\n\u2502  \u2502         aws_commons.create_s3_uri(                       \u2502   \u2502\n\u2502  \u2502             'analytics-bucket',                          \u2502   \u2502\n\u2502  \u2502             'metrics/' || to_char(now(), 'YYYYMMDD'),   \u2502   \u2502\n\u2502  \u2502             'ap-northeast-1'                             \u2502   \u2502\n\u2502  \u2502         ),                                               \u2502   \u2502\n\u2502  \u2502         options := 'format csv'                          \u2502   \u2502\n\u2502  \u2502     )$$                                                  \u2502   \u2502\n\u2502  \u2502 );                                                       \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"85-aws_lambdards\u5c02\u7528",children:"8.5 aws_lambda\uff08RDS\u5c02\u7528\uff09"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"PostgreSQL\u304b\u3089AWS Lambda\u95a2\u6570\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Note:"})," ",(0,t.jsx)(e.code,{children:"shared_preload_libraries"})," \u3078\u306e\u8ffd\u52a0\u306f",(0,t.jsx)(e.strong,{children:"\u4e0d\u8981"}),"\u3067\u3059\u3002\n",(0,t.jsx)(e.code,{children:"CREATE EXTENSION"})," \u306e\u307f\u3067\u4f7f\u7528\u53ef\u80fd\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u518d\u8d77\u52d5\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCREATE EXTENSION IF NOT EXISTS aws_lambda CASCADE;\n\n-- Lambda\u95a2\u6570\u306e\u540c\u671f\u547c\u3073\u51fa\u3057\nSELECT aws_lambda.invoke(\n    aws_commons.create_lambda_function_arn(\n        'my-function',\n        'ap-northeast-1'\n    ),\n    '{\"key\": \"value\"}'::json\n);\n\n-- \u975e\u540c\u671f\u547c\u3073\u51fa\u3057\nSELECT aws_lambda.invoke(\n    aws_commons.create_lambda_function_arn(\n        'my-async-function',\n        'ap-northeast-1'\n    ),\n    '{\"event\": \"data\"}'::json,\n    'Event'  -- \u975e\u540c\u671f\n);\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    aws_lambda \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u30c8\u30ea\u30ac\u30fc\u304b\u3089\u306e\u547c\u3073\u51fa\u3057\u3011                                     \u2502\n\u2502  INSERT/UPDATE\u6642\u306bLambda\u3067\u5916\u90e8\u30b7\u30b9\u30c6\u30e0\u3078\u901a\u77e5                   \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u30c7\u30fc\u30bf\u5909\u63db\u3011                                                 \u2502\n\u2502  \u8907\u96d1\u306a\u5909\u63db\u30ed\u30b8\u30c3\u30af\u3092Lambda\u306b\u59d4\u8b72                              \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u5916\u90e8API\u9023\u643a\u3011                                                \u2502\n\u2502  Lambda\u3092\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066REST API\u547c\u3073\u51fa\u3057                        \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"9-\u62e1\u5f35\u6a5f\u80fd\u306e\u7ba1\u7406\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"9. \u62e1\u5f35\u6a5f\u80fd\u306e\u7ba1\u7406\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,t.jsx)(e.h3,{id:"91-\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406",children:"9.1 \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u62e1\u5f35\u6a5f\u80fd\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\nSELECT\n    extname,\n    extversion,\n    (SELECT version FROM pg_available_extension_versions\n     WHERE name = e.extname\n     ORDER BY version DESC LIMIT 1) AS latest_version\nFROM pg_extension e\nORDER BY extname;\n\n-- \u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u53ef\u80fd\u306a\u62e1\u5f35\u6a5f\u80fd\nSELECT\n    name,\n    installed_version,\n    default_version\nFROM pg_available_extensions\nWHERE installed_version IS NOT NULL\n  AND installed_version <> default_version;\n"})}),"\n",(0,t.jsx)(e.h3,{id:"92-\u4f9d\u5b58\u95a2\u4fc2\u306e\u78ba\u8a8d",children:"9.2 \u4f9d\u5b58\u95a2\u4fc2\u306e\u78ba\u8a8d"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u62e1\u5f35\u6a5f\u80fd\u306e\u4f9d\u5b58\u95a2\u4fc2\nSELECT\n    e.extname,\n    d.refobjid::regclass AS depends_on\nFROM pg_depend d\nJOIN pg_extension e ON d.objid = e.oid\nWHERE d.deptype = 'e'\n  AND d.classid = 'pg_extension'::regclass;\n"})}),"\n",(0,t.jsx)(e.h3,{id:"93-rdsaurora\u3067\u306e\u5bfe\u5fdc\u72b6\u6cc1",children:"9.3 RDS/Aurora\u3067\u306e\u5bfe\u5fdc\u72b6\u6cc1"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                RDS/Aurora \u3067\u306e\u62e1\u5f35\u6a5f\u80fd\u5bfe\u5fdc                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u3010\u5229\u7528\u53ef\u80fd\uff08\u4e3b\u8981\u306a\u3082\u306e\uff09\u3011                                     \u2502\n\u2502  \u2705 pg_stat_statements                                          \u2502\n\u2502  \u2705 pgcrypto                                                    \u2502\n\u2502  \u2705 uuid-ossp                                                   \u2502\n\u2502  \u2705 pg_trgm                                                     \u2502\n\u2502  \u2705 hstore                                                      \u2502\n\u2502  \u2705 PostGIS                                                     \u2502\n\u2502  \u2705 pg_partman                                                  \u2502\n\u2502  \u2705 pgaudit                                                     \u2502\n\u2502  \u2705 pg_repack                                                   \u2502\n\u2502  \u2705 postgres_fdw                                                \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010RDS\u56fa\u6709\u3011                                                    \u2502\n\u2502  \u2705 pg_cron\uff08RDS PostgreSQL 12.5+\uff09                            \u2502\n\u2502     \u2192 cron.database_name \u306fParameter Group\u3067\u8a2d\u5b9a               \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u5229\u7528\u4e0d\u53ef\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u7406\u7531\uff09\u3011                           \u2502\n\u2502  \u274c adminpack                                                   \u2502\n\u2502  \u274c file_fdw\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u5236\u7d04\u3042\u308a\uff09                       \u2502\n\u2502                                                                 \u2502\n\u2502  \u3010\u78ba\u8a8d\u65b9\u6cd5\u3011                                                   \u2502\n\u2502  SHOW rds.extensions;                                           \u2502\n\u2502  SELECT * FROM pg_available_extensions;                        \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(e.h3,{id:"94-\u672c\u756a\u74b0\u5883\u3067\u306e\u63a8\u5968\u62e1\u5f35\u6a5f\u80fd\u30bb\u30c3\u30c8",children:"9.4 \u672c\u756a\u74b0\u5883\u3067\u306e\u63a8\u5968\u62e1\u5f35\u6a5f\u80fd\u30bb\u30c3\u30c8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'-- \u76e3\u8996\u30fb\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\uff08\u5fc5\u9808\uff09\nCREATE EXTENSION IF NOT EXISTS pg_stat_statements;\n\n-- \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\nCREATE EXTENSION IF NOT EXISTS pgcrypto;\nCREATE EXTENSION IF NOT EXISTS pgaudit;\n\n-- \u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\nCREATE EXTENSION IF NOT EXISTS pg_repack;\n\n-- \u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\uff08\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u7ba1\u7406\u7528\uff09\n-- shared_preload_libraries \u306b\u8ffd\u52a0\u5f8c\nCREATE EXTENSION IF NOT EXISTS pg_cron;\nCREATE SCHEMA IF NOT EXISTS partman;\nCREATE EXTENSION IF NOT EXISTS pg_partman SCHEMA partman;\n\n-- \u691c\u7d22\u6a5f\u80fd\u5f37\u5316\nCREATE EXTENSION IF NOT EXISTS pg_trgm;\n\n-- UUID\n-- PostgreSQL 13+\u306f\u4e0d\u8981\uff08gen_random_uuid()\u304c\u6a19\u6e96\uff09\n-- CREATE EXTENSION IF NOT EXISTS "uuid-ossp";\n'})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\nshared_preload_libraries = 'pg_stat_statements, pg_cron, pgaudit'\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"\u53c2\u8003\u30ea\u30f3\u30af",children:"\u53c2\u8003\u30ea\u30f3\u30af"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/contrib.html",children:"PostgreSQL Extensions"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/pgstatstatements.html",children:"pg_stat_statements"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/citusdata/pg_cron",children:"pg_cron"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/pgpartman/pg_partman",children:"pg_partman"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/reorg/pg_repack",children:"pg_repack"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://postgis.net/",children:"PostGIS"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://www.pgaudit.org/",children:"pgAudit"})}),"\n"]})]})}function E(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(o,{...n})}):o(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>a,x:()=>i});var r=s(96540);const t={},l=r.createContext(t);function a(n){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);