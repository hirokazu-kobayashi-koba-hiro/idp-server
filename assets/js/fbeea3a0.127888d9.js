"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[4658],{12605:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"content_06_developer-guide/application-plane/token-endpoint","title":"Token Endpoint\u5b9f\u88c5\u30ac\u30a4\u30c9","description":"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684","source":"@site/docs/content_06_developer-guide/03-application-plane/03-token-endpoint.md","sourceDirName":"content_06_developer-guide/03-application-plane","slug":"/content_06_developer-guide/application-plane/token-endpoint","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/token-endpoint","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_06_developer-guide/03-application-plane/03-token-endpoint.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"docs","previous":{"title":"Authorization Code Flow\u5b9f\u88c5\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/authorization-flow"},"next":{"title":"\u8a8d\u8a3c\u5b9f\u88c5\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/authentication"}}');var i=t(74848),s=t(28453);const c={},o="Token Endpoint\u5b9f\u88c5\u30ac\u30a4\u30c9",d={},l=[{value:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",id:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",level:2},{value:"\u6240\u8981\u6642\u9593",id:"\u6240\u8981\u6642\u9593",level:3},{value:"\u524d\u63d0\u77e5\u8b58",id:"\u524d\u63d0\u77e5\u8b58",level:3},{value:"Token Endpoint\u3068\u306f",id:"token-endpoint\u3068\u306f",level:2},{value:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4e00\u89a7",id:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4e00\u89a7",level:2},{value:"\u5b9f\u88c5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",id:"\u5b9f\u88c5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",level:2},{value:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",id:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",level:3},{value:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",id:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",level:3},{value:"\u4e3b\u8981\u30c9\u30e1\u30a4\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8",id:"\u4e3b\u8981\u30c9\u30e1\u30a4\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8",level:3},{value:"1. Token Request\uff08\u30c8\u30fc\u30af\u30f3\u767a\u884c\uff09",id:"1-token-request\u30c8\u30fc\u30af\u30f3\u767a\u884c",level:2},{value:"1.1 \u51e6\u7406\u30d5\u30ed\u30fc\u5168\u4f53",id:"11-\u51e6\u7406\u30d5\u30ed\u30fc\u5168\u4f53",level:3},{value:"1.2 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\uff08Client Authentication\uff09",id:"12-\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3cclient-authentication",level:3},{value:"\u6a19\u6e965\u7a2e\u985e + FAPI\u62e1\u5f352\u7a2e\u985e",id:"\u6a19\u6e965\u7a2e\u985e--fapi\u62e1\u5f352\u7a2e\u985e",level:3},{value:"\u6a19\u6e96\u8a8d\u8a3c\u65b9\u5f0f\uff085\u7a2e\u985e\uff09",id:"\u6a19\u6e96\u8a8d\u8a3c\u65b9\u5f0f5\u7a2e\u985e",level:4},{value:"FAPI\u62e1\u5f35\u8a8d\u8a3c\u65b9\u5f0f\uff082\u7a2e\u985e\uff09",id:"fapi\u62e1\u5f35\u8a8d\u8a3c\u65b9\u5f0f2\u7a2e\u985e",level:4},{value:"client_secret_basic \u306e\u4f8b",id:"client_secret_basic-\u306e\u4f8b",level:3},{value:"client_secret_post \u306e\u4f8b",id:"client_secret_post-\u306e\u4f8b",level:3},{value:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u306e\u51e6\u7406\u30d5\u30ed\u30fc",id:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u306e\u51e6\u7406\u30d5\u30ed\u30fc",level:3},{value:"1.3 Grant Type\u5225\u306eService",id:"13-grant-type\u5225\u306eservice",level:3},{value:"4\u7a2e\u985e\u306e\u6a19\u6e96Grant Type",id:"4\u7a2e\u985e\u306e\u6a19\u6e96grant-type",level:3},{value:"AuthorizationCodeGrantService \u306e\u51e6\u7406\u8a73\u7d30",id:"authorizationcodegrantservice-\u306e\u51e6\u7406\u8a73\u7d30",level:3},{value:"1.4 \u5404Grant Type\u306e\u8a73\u7d30\u5b9f\u88c5",id:"14-\u5404grant-type\u306e\u8a73\u7d30\u5b9f\u88c5",level:3},{value:"1.4.1 Authorization Code Grant\uff08\u6700\u91cd\u8981\uff09",id:"141-authorization-code-grant\u6700\u91cd\u8981",level:4},{value:"1.4.2 Client Credentials Grant",id:"142-client-credentials-grant",level:4},{value:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b",id:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b",level:3},{value:"\u51e6\u7406\u30d5\u30ed\u30fc",id:"\u51e6\u7406\u30d5\u30ed\u30fc",level:3},{value:"1.4.3 Refresh Token Grant",id:"143-refresh-token-grant",level:4},{value:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b",id:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b-1",level:3},{value:"\u51e6\u7406\u30d5\u30ed\u30fc",id:"\u51e6\u7406\u30d5\u30ed\u30fc-1",level:3},{value:"2. Token Introspection\uff08\u30c8\u30fc\u30af\u30f3\u691c\u8a3c\uff09",id:"2-token-introspection\u30c8\u30fc\u30af\u30f3\u691c\u8a3c",level:2},{value:"\u30ea\u30af\u30a8\u30b9\u30c8",id:"\u30ea\u30af\u30a8\u30b9\u30c8",level:3},{value:"\u30ec\u30b9\u30dd\u30f3\u30b9",id:"\u30ec\u30b9\u30dd\u30f3\u30b9",level:3},{value:"EntryService\u5b9f\u88c5",id:"entryservice\u5b9f\u88c5",level:3},{value:"3. Token Revocation\uff08\u30c8\u30fc\u30af\u30f3\u5931\u52b9\uff09",id:"3-token-revocation\u30c8\u30fc\u30af\u30f3\u5931\u52b9",level:2},{value:"\u30ea\u30af\u30a8\u30b9\u30c8",id:"\u30ea\u30af\u30a8\u30b9\u30c8-1",level:3},{value:"\u30ec\u30b9\u30dd\u30f3\u30b9",id:"\u30ec\u30b9\u30dd\u30f3\u30b9-1",level:3},{value:"E2E\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9",id:"e2e\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9",level:2},{value:"\u5b9f\u969b\u306e\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb",id:"\u5b9f\u969b\u306e\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb",level:3},{value:"\u30c6\u30b9\u30c8\u6642\u306e\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8",id:"\u30c6\u30b9\u30c8\u6642\u306e\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8",level:3},{value:"\u30c6\u30b9\u30c8\u5b9f\u884c",id:"\u30c6\u30b9\u30c8\u5b9f\u884c",level:3},{value:"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc\u3068\u5bfe\u51e6\u6cd5",id:"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc\u3068\u5bfe\u51e6\u6cd5",level:2},{value:"\u30a8\u30e9\u30fc1: <code>invalid_client</code> - \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u5931\u6557",id:"\u30a8\u30e9\u30fc1-invalid_client---\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u5931\u6557",level:3},{value:"\u30a8\u30e9\u30fc2: <code>invalid_grant</code> - Authorization Code\u4e0d\u6b63",id:"\u30a8\u30e9\u30fc2-invalid_grant---authorization-code\u4e0d\u6b63",level:3},{value:"\u30a8\u30e9\u30fc3: <code>unsupported_grant_type</code>",id:"\u30a8\u30e9\u30fc3-unsupported_grant_type",level:3},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:2},{value:"\ud83d\udcd6 \u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"-\u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:3},{value:"\ud83d\udd17 \u8a73\u7d30\u60c5\u5831",id:"-\u8a73\u7d30\u60c5\u5831",level:3}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"token-endpoint\u5b9f\u88c5\u30ac\u30a4\u30c9",children:"Token Endpoint\u5b9f\u88c5\u30ac\u30a4\u30c9"})}),"\n",(0,i.jsx)(n.h2,{id:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",children:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"}),"\uff08\u30c8\u30fc\u30af\u30f3\u767a\u884c\u30fb\u691c\u8a3c\u30fb\u5931\u52b9\uff09\u306e\u5b9f\u88c5\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u76ee\u6a19\u3067\u3059\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u6240\u8981\u6642\u9593",children:"\u6240\u8981\u6642\u9593"}),"\n",(0,i.jsxs)(n.p,{children:["\u23f1\ufe0f ",(0,i.jsx)(n.strong,{children:"\u7d0430\u5206"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u524d\u63d0\u77e5\u8b58",children:"\u524d\u63d0\u77e5\u8b58"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/application-plane/authorization-flow",children:"02. Authorization Flow"})}),"\n",(0,i.jsx)(n.li,{children:"OAuth 2.0\u57fa\u790e\u77e5\u8b58"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"token-endpoint\u3068\u306f",children:"Token Endpoint\u3068\u306f"}),"\n",(0,i.jsxs)(n.p,{children:["OAuth 2.0\u306e",(0,i.jsx)(n.strong,{children:"\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff08Token Endpoint\uff09"})," \u306f\u3001\u30c8\u30fc\u30af\u30f3\u306b\u95a2\u3059\u308b3\u3064\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\uff1a"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Token Request"}),": \u30c8\u30fc\u30af\u30f3\u767a\u884c\uff08RFC 6749 Section 3.2\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Token Introspection"}),": \u30c8\u30fc\u30af\u30f3\u691c\u8a3c\uff08RFC 7662\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Token Revocation"}),": \u30c8\u30fc\u30af\u30f3\u5931\u52b9\uff08RFC 7009\uff09"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"RFC\u6e96\u62e0"}),": OAuth 2.0 (RFC 6749), Token Introspection (RFC 7662), Token Revocation (RFC 7009)"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4e00\u89a7",children:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4e00\u89a7"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# \u30c8\u30fc\u30af\u30f3\u767a\u884c\uff08RFC 6749\uff09\nPOST /{tenant-id}/v1/tokens\n\n# \u30c8\u30fc\u30af\u30f3\u30a4\u30f3\u30c8\u30ed\u30b9\u30da\u30af\u30b7\u30e7\u30f3\uff08RFC 7662\uff09\nPOST /{tenant-id}/v1/tokens/introspection\n\n# \u30c8\u30fc\u30af\u30f3\u5931\u52b9\uff08RFC 7009\uff09\nPOST /{tenant-id}/v1/tokens/revocation\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(59706).A+"",children:"TokenV1Api.java"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u5b9f\u88c5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",children:"\u5b9f\u88c5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf"}),"\n",(0,i.jsx)(n.h3,{id:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",children:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"HTTP\u30ea\u30af\u30a8\u30b9\u30c8\n    \u2193\nController (TokenV1Api) - HTTP\u51e6\u7406\n    \u2193\nEntryService (TokenEntryService) - \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7ba1\u7406\n    \u2193\nCore\u5c64 (TokenProtocol \u2192 TokenRequestHandler)\n    \u251c\u2500 Validator: \u5165\u529b\u5f62\u5f0f\u30c1\u30a7\u30c3\u30af\n    \u251c\u2500 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\uff085\u7a2e\u985e\uff09\n    \u251c\u2500 Grant Type\u5225Service\u9078\u629e\uff084\u7a2e\u985e+\u62e1\u5f35\uff09\n    \u2514\u2500 \u30c8\u30fc\u30af\u30f3\u767a\u884c\n    \u2193\nRepository - \u30c7\u30fc\u30bf\u6c38\u7d9a\u5316\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",children:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u30af\u30e9\u30b9"}),(0,i.jsx)(n.th,{children:"\u5f79\u5272"}),(0,i.jsx)(n.th,{children:"\u4e3b\u306a\u51e6\u7406"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"TokenV1Api"})}),(0,i.jsx)(n.td,{children:"HTTP\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"}),(0,i.jsx)(n.td,{children:"\u30d1\u30e9\u30e1\u30fc\u30bf\u53d7\u3051\u53d6\u308a\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u8fd4\u5374"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"TokenEntryService"})}),(0,i.jsx)(n.td,{children:"\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3"}),(0,i.jsx)(n.td,{children:"\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3001\u30a4\u30d9\u30f3\u30c8\u767a\u884c"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"TokenRequestHandler"})}),(0,i.jsx)(n.td,{children:"\u30c8\u30fc\u30af\u30f3\u767a\u884c\u51e6\u7406"}),(0,i.jsx)(n.td,{children:"Validator\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3001Service\u9078\u629e"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"ClientAuthenticationHandler"})}),(0,i.jsx)(n.td,{children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c"}),(0,i.jsx)(n.td,{children:"5\u7a2e\u985e\u306e\u8a8d\u8a3c\u65b9\u5f0f\u304b\u3089\u9078\u629e\u30fb\u5b9f\u884c"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"OAuthTokenCreationServices"})}),(0,i.jsx)(n.td,{children:"Grant Type\u632f\u308a\u5206\u3051"}),(0,i.jsx)(n.td,{children:"4\u7a2e\u985e+\u62e1\u5f35\u304b\u3089Service\u9078\u629e"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3b\u8981\u30c9\u30e1\u30a4\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8",children:"\u4e3b\u8981\u30c9\u30e1\u30a4\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8"}),(0,i.jsx)(n.th,{children:"\u8aac\u660e"}),(0,i.jsx)(n.th,{children:"\u4fdd\u5b58\u5834\u6240"}),(0,i.jsx)(n.th,{children:"\u6709\u52b9\u671f\u9650"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"OAuthToken"})}),(0,i.jsx)(n.td,{children:"Access Token/Refresh Token"}),(0,i.jsx)(n.td,{children:"DB"}),(0,i.jsx)(n.td,{children:"\u8a2d\u5b9a\u306b\u3088\u308b\uff08\u30c7\u30d5\u30a9\u30eb\u30c81\u6642\u9593\uff09"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"AuthorizationCodeGrant"})}),(0,i.jsx)(n.td,{children:"Authorization Code"}),(0,i.jsx)(n.td,{children:"Redis + DB"}),(0,i.jsx)(n.td,{children:"5\u5206\uff08\u4f7f\u7528\u5f8c\u5373\u7121\u52b9\uff09"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"ClientCredentials"})}),(0,i.jsx)(n.td,{children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u60c5\u5831"}),(0,i.jsx)(n.td,{children:"-"}),(0,i.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-token-request\u30c8\u30fc\u30af\u30f3\u767a\u884c",children:"1. Token Request\uff08\u30c8\u30fc\u30af\u30f3\u767a\u884c\uff09"}),"\n",(0,i.jsxs)(n.p,{children:["\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u6700\u3082\u91cd\u8981\u306a\u6a5f\u80fd\u306f",(0,i.jsx)(n.strong,{children:"\u30c8\u30fc\u30af\u30f3\u767a\u884c"}),"\u3067\u3059\u3002Authorization Code\u3084\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u60c5\u5831\u3092\u4f7f\u3063\u3066Access Token/Refresh Token/ID Token\u3092\u767a\u884c\u3057\u307e\u3059\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"11-\u51e6\u7406\u30d5\u30ed\u30fc\u5168\u4f53",children:"1.1 \u51e6\u7406\u30d5\u30ed\u30fc\u5168\u4f53"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(32436).A+"#L82-L120",children:"TokenRequestHandler.java:82-120"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"POST /{tenant-id}/v1/tokens\n    \u2193\nTokenRequestHandler.handle()\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Validator\uff08\u5165\u529b\u5f62\u5f0f\u30c1\u30a7\u30c3\u30af\uff09          \u2502\n\u2502    - grant_type\u5fc5\u9808                     \u2502\n\u2502    - \u30d1\u30e9\u30e1\u30fc\u30bf\u5f62\u5f0f\u30c1\u30a7\u30c3\u30af               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. \u8a2d\u5b9a\u53d6\u5f97                             \u2502\n\u2502    - AuthorizationServerConfiguration  \u2502\n\u2502    - ClientConfiguration               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c                      \u2502\n\u2502    \u2192 ClientAuthenticationHandler       \u2502\n\u2502       \u2514\u2500 5\u7a2e\u985e\u304b\u3089\u9078\u629e\u30fb\u5b9f\u884c            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. Grant Type\u5225Service\u9078\u629e              \u2502\n\u2502    \u2192 OAuthTokenCreationServices        \u2502\n\u2502       \u2514\u2500 4\u7a2e\u985e+\u62e1\u5f35\u304b\u3089\u9078\u629e             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5. \u30c8\u30fc\u30af\u30f3\u767a\u884c                         \u2502\n\u2502    \u2192 Service.create()                  \u2502\n\u2502       \u251c\u2500 Authorization Code\u691c\u8a3c        \u2502\n\u2502       \u251c\u2500 Access Token\u751f\u6210              \u2502\n\u2502       \u251c\u2500 Refresh Token\u751f\u6210             \u2502\n\u2502       \u251c\u2500 ID Token\u751f\u6210\uff08OIDC\uff09          \u2502\n\u2502       \u2514\u2500 DB\u4fdd\u5b58                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\nTokenRequestResponse\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"12-\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3cclient-authentication",children:"1.2 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\uff08Client Authentication\uff09"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u8a73\u7d30"}),": ",(0,i.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/application-plane/client-authentication",children:"10. Client Authentication\u5b9f\u88c5"})," - 7\u3064\u306e\u8a8d\u8a3c\u65b9\u5f0f\u306e\u5b8c\u5168\u30ac\u30a4\u30c9"]}),"\n",(0,i.jsx)(n.h3,{id:"\u6a19\u6e965\u7a2e\u985e--fapi\u62e1\u5f352\u7a2e\u985e",children:"\u6a19\u6e965\u7a2e\u985e + FAPI\u62e1\u5f352\u7a2e\u985e"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(76471).A+"#L32-L40",children:"ClientAuthenticators.java:32-40"})]}),"\n",(0,i.jsx)(n.h4,{id:"\u6a19\u6e96\u8a8d\u8a3c\u65b9\u5f0f5\u7a2e\u985e",children:"\u6a19\u6e96\u8a8d\u8a3c\u65b9\u5f0f\uff085\u7a2e\u985e\uff09"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u8a8d\u8a3c\u65b9\u5f0f"}),(0,i.jsx)(n.th,{children:"\u9001\u4fe1\u65b9\u6cd5"}),(0,i.jsx)(n.th,{children:"\u7528\u9014"}),(0,i.jsx)(n.th,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ec\u30d9\u30eb"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"client_secret_basic"})}),(0,i.jsx)(n.td,{children:"Basic\u8a8d\u8a3c\u30d8\u30c3\u30c0\u30fc"}),(0,i.jsx)(n.td,{children:"\u6700\u3082\u4e00\u822c\u7684"}),(0,i.jsx)(n.td,{children:"\u2b50\u2b50"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"client_secret_post"})}),(0,i.jsx)(n.td,{children:"POST\u30dc\u30c7\u30a3"}),(0,i.jsx)(n.td,{children:"\u30ec\u30ac\u30b7\u30fc"}),(0,i.jsx)(n.td,{children:"\u2b50"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"client_secret_jwt"})}),(0,i.jsx)(n.td,{children:"JWT\u7f72\u540d\uff08\u5171\u6709\u9375\uff09"}),(0,i.jsx)(n.td,{children:"\u9ad8\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"}),(0,i.jsx)(n.td,{children:"\u2b50\u2b50\u2b50"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"private_key_jwt"})}),(0,i.jsx)(n.td,{children:"JWT\u7f72\u540d\uff08\u79d8\u5bc6\u9375\uff09"}),(0,i.jsx)(n.td,{children:"\u6700\u9ad8\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"}),(0,i.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"none"})}),(0,i.jsx)(n.td,{children:"\u8a8d\u8a3c\u306a\u3057"}),(0,i.jsx)(n.td,{children:"\u30d1\u30d6\u30ea\u30c3\u30af\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff08SPA/Mobile+PKCE\uff09"}),(0,i.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"fapi\u62e1\u5f35\u8a8d\u8a3c\u65b9\u5f0f2\u7a2e\u985e",children:"FAPI\u62e1\u5f35\u8a8d\u8a3c\u65b9\u5f0f\uff082\u7a2e\u985e\uff09"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.code,{children:"libs/idp-server-core-extension-fapi/src/main/java/org/idp/server/core/openid/extension/fapi/"})]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u8a8d\u8a3c\u65b9\u5f0f"}),(0,i.jsx)(n.th,{children:"\u9001\u4fe1\u65b9\u6cd5"}),(0,i.jsx)(n.th,{children:"\u7528\u9014"}),(0,i.jsx)(n.th,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ec\u30d9\u30eb"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"tls_client_auth"})}),(0,i.jsx)(n.td,{children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\uff08MTLS\uff09"}),(0,i.jsx)(n.td,{children:"FAPI\u6e96\u62e0\u30fb\u91d1\u878d\u6a5f\u95a2"}),(0,i.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"self_signed_tls_client_auth"})}),(0,i.jsx)(n.td,{children:"\u81ea\u5df1\u7f72\u540d\u8a3c\u660e\u66f8\uff08MTLS\uff09"}),(0,i.jsx)(n.td,{children:"FAPI\u6e96\u62e0\u30fb\u958b\u767a\u74b0\u5883"}),(0,i.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"client_secret_basic-\u306e\u4f8b",children:"client_secret_basic \u306e\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Authorization \u30d8\u30c3\u30c0\u30fc\u306bBase64\u30a8\u30f3\u30b3\u30fc\u30c9\nAuthorization: Basic base64(client_id:client_secret)\n\n# \u5b9f\u969b\u306e\u30ea\u30af\u30a8\u30b9\u30c8\ncurl -X POST "http://localhost:8080/${TENANT_ID}/v1/tokens" \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -H "Authorization: Basic $(echo -n \'my-client:my-secret\' | base64)" \\\n  -d "grant_type=authorization_code&code=${CODE}&redirect_uri=${REDIRECT_URI}"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"client_secret_post-\u306e\u4f8b",children:"client_secret_post \u306e\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# POST\u30dc\u30c7\u30a3\u306bclient_id/client_secret\u3092\u542b\u3081\u308b\ncurl -X POST "http://localhost:8080/${TENANT_ID}/v1/tokens" \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=authorization_code&code=${CODE}&redirect_uri=${REDIRECT_URI}&client_id=my-client&client_secret=my-secret"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u306e\u51e6\u7406\u30d5\u30ed\u30fc",children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u306e\u51e6\u7406\u30d5\u30ed\u30fc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"TokenRequestHandler.handle()\n    \u2193\nTokenRequestContext\u4f5c\u6210\n    \u251c\u2500 clientSecretBasic (Authorization\u30d8\u30c3\u30c0\u30fc\u304b\u3089\u62bd\u51fa)\n    \u251c\u2500 clientCert (MTLS\u30d8\u30c3\u30c0\u30fc\u304b\u3089\u62bd\u51fa)\n    \u2514\u2500 parameters (POST\u30dc\u30c7\u30a3)\n    \u2193\nClientAuthenticationHandler.authenticate(context)\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 ClientAuthenticators.get(\u8a8d\u8a3c\u30bf\u30a4\u30d7)       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  client_secret_basic                     \u2502\n\u2502    \u2192 ClientSecretBasicAuthenticator      \u2502\n\u2502       \u2514\u2500 Base64\u30c7\u30b3\u30fc\u30c9 \u2192 \u691c\u8a3c           \u2502\n\u2502                                          \u2502\n\u2502  client_secret_post                      \u2502\n\u2502    \u2192 ClientSecretPostAuthenticator       \u2502\n\u2502       \u2514\u2500 POST\u30dc\u30c7\u30a3\u304b\u3089\u62bd\u51fa \u2192 \u691c\u8a3c       \u2502\n\u2502                                          \u2502\n\u2502  client_secret_jwt                       \u2502\n\u2502    \u2192 ClientSecretJwtAuthenticator        \u2502\n\u2502       \u2514\u2500 JWT\u691c\u8a3c\uff08HMAC\u7f72\u540d\uff09             \u2502\n\u2502                                          \u2502\n\u2502  private_key_jwt                         \u2502\n\u2502    \u2192 PrivateKeyJwtAuthenticator          \u2502\n\u2502       \u2514\u2500 JWT\u691c\u8a3c\uff08RSA/ECDSA\u7f72\u540d\uff09        \u2502\n\u2502                                          \u2502\n\u2502  none                                    \u2502\n\u2502    \u2192 PublicClientAuthenticator           \u2502\n\u2502       \u2514\u2500 PKCE\u5fc5\u9808\u30c1\u30a7\u30c3\u30af                \u2502\n\u2502                                          \u2502\n\u2502  + FAPI\u62e1\u5f35\uff08\u30d7\u30e9\u30b0\u30a4\u30f3\uff09                 \u2502\n\u2502                                          \u2502\n\u2502  tls_client_auth                         \u2502\n\u2502    \u2192 TlsClientAuthAuthenticator          \u2502\n\u2502       \u2514\u2500 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u691c\u8a3c\uff08MTLS\uff09   \u2502\n\u2502                                          \u2502\n\u2502  self_signed_tls_client_auth             \u2502\n\u2502    \u2192 SelfSignedTlsClientAuthAuthenticator\u2502\n\u2502       \u2514\u2500 \u81ea\u5df1\u7f72\u540d\u8a3c\u660e\u66f8\u691c\u8a3c\uff08MTLS\uff09       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\nClientCredentials\uff08\u8a8d\u8a3c\u6e08\u307f\u60c5\u5831\uff09\n\n\u203b FAPI\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306e\u307fMTLS\u8a8d\u8a3c\u304c\u6709\u52b9\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"13-grant-type\u5225\u306eservice",children:"1.3 Grant Type\u5225\u306eService"}),"\n",(0,i.jsx)(n.h3,{id:"4\u7a2e\u985e\u306e\u6a19\u6e96grant-type",children:"4\u7a2e\u985e\u306e\u6a19\u6e96Grant Type"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(93360).A+"#L43-L56",children:"OAuthTokenCreationServices.java:43-56"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"OAuthTokenCreationServices.get(grantType)\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Grant Type\u3067\u632f\u308a\u5206\u3051                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 authorization_code                     \u2502\n\u2502   \u2192 AuthorizationCodeGrantService      \u2502\n\u2502      \u251c\u2500 Validator\uff08code\u5fc5\u9808\u7b49\uff09        \u2502\n\u2502      \u251c\u2500 AuthorizationCodeGrant\u53d6\u5f97     \u2502\n\u2502      \u251c\u2500 Verifier\uff08used, \u671f\u9650, URI\uff09    \u2502\n\u2502      \u251c\u2500 AccessToken\u751f\u6210                \u2502\n\u2502      \u251c\u2500 RefreshToken\u751f\u6210               \u2502\n\u2502      \u251c\u2500 IdToken\u751f\u6210\uff08OIDC\uff09            \u2502\n\u2502      \u2514\u2500 AuthorizationGranted\u4fdd\u5b58       \u2502\n\u2502                                        \u2502\n\u2502 refresh_token                          \u2502\n\u2502   \u2192 RefreshTokenGrantService           \u2502\n\u2502      \u2514\u2500 \u65b0\u3057\u3044Access Token\u767a\u884c         \u2502\n\u2502                                        \u2502\n\u2502 password                               \u2502\n\u2502   \u2192 ResourceOwnerPasswordCredentials   \u2502\n\u2502      \u2514\u2500 \u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u30fb\u30c8\u30fc\u30af\u30f3\u767a\u884c      \u2502\n\u2502                                        \u2502\n\u2502 client_credentials                     \u2502\n\u2502   \u2192 ClientCredentialsGrantService      \u2502\n\u2502      \u2514\u2500 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6a29\u9650\u3067\u30c8\u30fc\u30af\u30f3\u767a\u884c   \u2502\n\u2502                                        \u2502\n\u2502 + \u62e1\u5f35Grant Type\uff08\u30d7\u30e9\u30b0\u30a4\u30f3\uff09           \u2502\n\u2502   \u4f8b: urn:openid:params:grant-type:ciba \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h3,{id:"authorizationcodegrantservice-\u306e\u51e6\u7406\u8a73\u7d30",children:"AuthorizationCodeGrantService \u306e\u51e6\u7406\u8a73\u7d30"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5\u5834\u6240"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(35642).A+"#L127-L203",children:"AuthorizationCodeGrantService.java:127-203"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"AuthorizationCodeGrantService.create(tokenRequestContext, clientCredentials)\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Validator\uff08\u5165\u529b\u5f62\u5f0f\u30c1\u30a7\u30c3\u30af\uff09               \u2502\n\u2502    \u5b9f\u88c5: TokenRequestCodeGrantValidator      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - code\u5fc5\u9808\u30c1\u30a7\u30c3\u30af                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. AuthorizationCodeGrant\u53d6\u5f97                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  authorizationCodeGrantRepository.find()    \u2502\n\u2502  - \u5b58\u5728\u3057\u306a\u3044 \u2192 invalid_grant \u30a8\u30e9\u30fc         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. AuthorizationRequest\u53d6\u5f97                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  authorizationRequestRepository.find()      \u2502\n\u2502  - \u5143\u306e\u8a8d\u53ef\u30ea\u30af\u30a8\u30b9\u30c8\u60c5\u5831\uff08scope, nonce\u7b49\uff09   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. Verifier\uff08\u30d3\u30b8\u30cd\u30b9\u30eb\u30fc\u30eb\u691c\u8a3c\uff09             \u2502\n\u2502    \u5b9f\u88c5: AuthorizationCodeGrantVerifier      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Base Verifier\u9078\u629e\uff08OAuth2 or OIDC\uff09         \u2502\n\u2502    \u251c\u2500 \u6709\u52b9\u671f\u9650\u30c1\u30a7\u30c3\u30af                        \u2502\n\u2502    \u251c\u2500 used=false \u30c1\u30a7\u30c3\u30af                    \u2502\n\u2502    \u251c\u2500 redirect_uri\u5b8c\u5168\u4e00\u81f4                   \u2502\n\u2502    \u251c\u2500 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e00\u81f4                        \u2502\n\u2502    \u2514\u2500 PKCE\u691c\u8a3c\uff08\u8a72\u5f53\u6642\uff09                      \u2502\n\u2502                                             \u2502\n\u2502  Extension Verifiers\uff08\u8a72\u5f53\u6642\u306e\u307f\uff09            \u2502\n\u2502    \u2514\u2500 \u30d7\u30e9\u30b0\u30a4\u30f3\u30ed\u30fc\u30c9\u62e1\u5f35\u691c\u8a3c                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5. \u30c8\u30fc\u30af\u30f3\u751f\u6210                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  AuthorizationGrant\u62bd\u51fa                      \u2502\n\u2502    \u251c\u2500 user, scope, authentication           \u2502\n\u2502    \u2193                                         \u2502\n\u2502  AccessTokenCreator.create()                \u2502\n\u2502    \u251c\u2500 JWT\u751f\u6210\uff08RS256\u7b49\uff09                      \u2502\n\u2502    \u2514\u2500 \u6709\u52b9\u671f\u9650\u8a2d\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c81\u6642\u9593\uff09          \u2502\n\u2502    \u2193                                         \u2502\n\u2502  RefreshTokenCreator.create()               \u2502\n\u2502    \u2514\u2500 \u6709\u52b9\u671f\u9650\u8a2d\u5b9a\uff08\u8a2d\u5b9a\u306b\u3088\u308b\uff09              \u2502\n\u2502    \u2193                                         \u2502\n\u2502  if (OIDC)                                  \u2502\n\u2502    IdTokenCreator.createIdToken()           \u2502\n\u2502      \u251c\u2500 nonce\u542b\u3081\u308b                          \u2502\n\u2502      \u251c\u2500 at_hash, c_hash\u8a08\u7b97                  \u2502\n\u2502      \u2514\u2500 \u30ab\u30b9\u30bf\u30e0\u30af\u30ec\u30fc\u30e0\u8ffd\u52a0                  \u2502\n\u2502    \u2193                                         \u2502\n\u2502  OAuthTokenBuilder.build()                  \u2502\n\u2502    \u2514\u2500 \u5168\u30c8\u30fc\u30af\u30f3\u30921\u3064\u306eOAuthToken\u306b\u7d71\u5408       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 6. AuthorizationGranted\u767b\u9332/\u66f4\u65b0             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  authorizationGrantedRepository.find()      \u2502\n\u2502    - \u65e2\u5b58\u306e\u540c\u610f\u60c5\u5831\u3092\u53d6\u5f97                     \u2502\n\u2502    \u2193                                         \u2502\n\u2502  exists? \u2192 merge() : register()             \u2502\n\u2502    - \u540c\u610f\u60c5\u5831\u3092\u8a18\u9332\uff08\u6b21\u56de\u306e\u81ea\u52d5\u627f\u8a8d\u7528\uff09       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 7. \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  oAuthTokenCommandRepository.register()     \u2502\n\u2502    - OAuthToken\u4fdd\u5b58                          \u2502\n\u2502    \u2193                                         \u2502\n\u2502  authorizationCodeGrantRepository.delete()  \u2502\n\u2502    - Authorization Code\u524a\u9664\uff08\u4f7f\u7528\u6e08\u307f\uff09      \u2502\n\u2502    \u2193                                         \u2502\n\u2502  authorizationRequestRepository.delete()    \u2502\n\u2502    - AuthorizationRequest\u524a\u9664\uff08\u4e0d\u8981\uff09        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\nOAuthToken\uff08Access/Refresh/ID Token\uff09\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"RFC 6749 Section 4.1.3\u6e96\u62e0\u306e\u5b9f\u88c5"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"14-\u5404grant-type\u306e\u8a73\u7d30\u5b9f\u88c5",children:"1.4 \u5404Grant Type\u306e\u8a73\u7d30\u5b9f\u88c5"}),"\n",(0,i.jsx)(n.h4,{id:"141-authorization-code-grant\u6700\u91cd\u8981",children:"1.4.1 Authorization Code Grant\uff08\u6700\u91cd\u8981\uff09"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u7528\u9014"}),": \u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u5f8c\u306b\u30c8\u30fc\u30af\u30f3\u53d6\u5f97\uff08\u6700\u3082\u4e00\u822c\u7684\u306a\u30d5\u30ed\u30fc\uff09"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(35642).A+"#L127-L203",children:"AuthorizationCodeGrantService.java:127-203"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8080/${TENANT_ID}/v1/tokens" \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -H "Authorization: Basic $(echo -n \'client-id:client-secret\' | base64)" \\\n  -d "grant_type=authorization_code&code=${CODE}&redirect_uri=${REDIRECT_URI}"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "token_type": "Bearer",\n  "expires_in": 3600,\n  "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "scope": "openid profile email"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u51e6\u7406\u306e\u8a73\u7d30"}),": \u4e0a\u8a18\u300cAuthorizationCodeGrantService \u306e\u51e6\u7406\u8a73\u7d30\u300d\u30bb\u30af\u30b7\u30e7\u30f3\u53c2\u7167"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"142-client-credentials-grant",children:"1.4.2 Client Credentials Grant"}),"\n",(0,i.jsx)(n.p,{children:"**\u7528\u9014"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u30b5\u30fc\u30d0\u30fc\u9593\u901a\u4fe1"}),"\uff08\u30e6\u30fc\u30b6\u30fc\u306a\u3057\uff09- \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u304cAPI\u306b\u30a2\u30af\u30bb\u30b9"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f7f\u7528\u5834\u9762"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u9593\u901a\u4fe1"}),"\n",(0,i.jsx)(n.li,{children:"\u30d0\u30c3\u30c1\u51e6\u7406"}),"\n",(0,i.jsx)(n.li,{children:"\u7ba1\u7406\u7528\u30b9\u30af\u30ea\u30d7\u30c8"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b",children:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(90993).A+"#L49-L88",children:"ClientCredentialsGrantService.java:49-88"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8080/${TENANT_ID}/v1/tokens" \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -H "Authorization: Basic $(echo -n \'client-id:client-secret\' | base64)" \\\n  -d "grant_type=client_credentials&scope=api:read api:write"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "token_type": "Bearer",\n  "expires_in": 3600,\n  "scope": "api:read api:write"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6ce8\u610f"}),": Refresh Token\u3068ID Token\u306f\u767a\u884c\u3055\u308c\u306a\u3044\uff08\u30e6\u30fc\u30b6\u30fc\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u306a\u3044\u305f\u3081\uff09"]}),"\n",(0,i.jsx)(n.h3,{id:"\u51e6\u7406\u30d5\u30ed\u30fc",children:"\u51e6\u7406\u30d5\u30ed\u30fc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ClientCredentialsGrantService.create()\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Validator                                \u2502\n\u2502    \u5b9f\u88c5: ClientCredentialsGrantValidator     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - scope\u5f62\u5f0f\u30c1\u30a7\u30c3\u30af                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. Scope\u691c\u8a3c                                 \u2502\n\u2502    \u5b9f\u88c5: ClientCredentialsGrantVerifier      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a31\u53efscope\u3067\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0       \u2502\n\u2502  - \u7a7a\u306a\u3089\u4f8b\u5916                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. AuthorizationGrant\u4f5c\u6210                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - subject: \u306a\u3057\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u81ea\u8eab\uff09          \u2502\n\u2502  - scope: \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u6e08\u307fscope             \u2502\n\u2502  - grant_type: client_credentials           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. AccessToken\u751f\u6210                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  AccessTokenCreator.create()                \u2502\n\u2502  - subject\u306fclient_id                        \u2502\n\u2502  - scope\u306b\u57fa\u3065\u304f\u6a29\u9650\u8a2d\u5b9a                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5. OAuthToken\u4fdd\u5b58                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  oAuthTokenCommandRepository.register()     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"143-refresh-token-grant",children:"1.4.3 Refresh Token Grant"}),"\n",(0,i.jsx)(n.p,{children:"**\u7528\u9014"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Access Token\u66f4\u65b0"})," - \u6709\u52b9\u671f\u9650\u5207\u308c\u524d\u306b\u65b0\u3057\u3044Access Token\u3092\u53d6\u5f97"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f7f\u7528\u5834\u9762"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Access Token\u671f\u9650\u5207\u308c\u6642"}),"\n",(0,i.jsx)(n.li,{children:"\u30e6\u30fc\u30b6\u30fc\u518d\u8a8d\u8a3c\u306a\u3057\u3067\u30c8\u30fc\u30af\u30f3\u66f4\u65b0"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b-1",children:"\u30ea\u30af\u30a8\u30b9\u30c8\u4f8b"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(29132).A+"#L53-L90",children:"RefreshTokenGrantService.java:53-90"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8080/${TENANT_ID}/v1/tokens" \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -H "Authorization: Basic $(echo -n \'client-id:client-secret\' | base64)" \\\n  -d "grant_type=refresh_token&refresh_token=${REFRESH_TOKEN}"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",  // \u65b0\u3057\u3044Access Token\n  "token_type": "Bearer",\n  "expires_in": 3600,\n  "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",  // \u65b0\u3057\u3044Refresh Token\n  "scope": "openid profile email"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u51e6\u7406\u30d5\u30ed\u30fc-1",children:"\u51e6\u7406\u30d5\u30ed\u30fc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"RefreshTokenGrantService.create()\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Validator                                \u2502\n\u2502    \u5b9f\u88c5: RefreshTokenGrantValidator          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - refresh_token\u5fc5\u9808\u30c1\u30a7\u30c3\u30af                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. \u5143\u306eOAuthToken\u53d6\u5f97                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  oAuthTokenQueryRepository.find()           \u2502\n\u2502  - Refresh Token\u306b\u7d10\u3065\u304fOAuthToken\u53d6\u5f97       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. Verifier\u691c\u8a3c                              \u2502\n\u2502    \u5b9f\u88c5: RefreshTokenVerifier                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - Refresh Token\u6709\u52b9\u671f\u9650\u30c1\u30a7\u30c3\u30af              \u2502\n\u2502  - \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e00\u81f4\u30c1\u30a7\u30c3\u30af                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. \u65b0\u3057\u3044\u30c8\u30fc\u30af\u30f3\u751f\u6210                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  AccessTokenCreator.refresh()               \u2502\n\u2502    - \u65b0\u3057\u3044Access Token\u751f\u6210                  \u2502\n\u2502    \u2193                                         \u2502\n\u2502  RefreshTokenCreator.refresh()              \u2502\n\u2502    - \u65b0\u3057\u3044Refresh Token\u751f\u6210                 \u2502\n\u2502    - \u307e\u305f\u306f\u65e2\u5b58\u306eRefresh Token\u3092\u518d\u5229\u7528       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5. \u30c8\u30fc\u30af\u30f3\u5165\u308c\u66ff\u3048                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  oAuthTokenCommandRepository.delete(\u65e7)     \u2502\n\u2502  oAuthTokenCommandRepository.register(\u65b0)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u91cd\u8981"}),": \u5143\u306eOAuthToken\u306f\u524a\u9664\u3055\u308c\u3001\u65b0\u3057\u3044OAuthToken\u306b\u7f6e\u304d\u63db\u308f\u308b"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-token-introspection\u30c8\u30fc\u30af\u30f3\u691c\u8a3c",children:"2. Token Introspection\uff08\u30c8\u30fc\u30af\u30f3\u691c\u8a3c\uff09"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"RFC 7662\u6e96\u62e0"})}),"\n",(0,i.jsx)(n.h3,{id:"\u30ea\u30af\u30a8\u30b9\u30c8",children:"\u30ea\u30af\u30a8\u30b9\u30c8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"POST /{tenant-id}/v1/tokens/introspection\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\ntoken=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u30ec\u30b9\u30dd\u30f3\u30b9",children:"\u30ec\u30b9\u30dd\u30f3\u30b9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "active": true,\n  "scope": "openid profile email",\n  "client_id": "test-client",\n  "username": "user@example.com",\n  "token_type": "Bearer",\n  "exp": 1695555600,\n  "iat": 1695552000,\n  "sub": "user-12345"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"entryservice\u5b9f\u88c5",children:"EntryService\u5b9f\u88c5"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(54600).A+"#L83",children:"TokenEntryService.java:83"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Override\npublic TokenIntrospectionResponse inspect(\n    TenantIdentifier tenantIdentifier,\n    Map<String, String[]> params,\n    String authorizationHeader,\n    String clientCert,\n    RequestAttributes requestAttributes) {\n\n  // 1. Tenant\u53d6\u5f97\n  Tenant tenant = tenantQueryRepository.get(tenantIdentifier);\n\n  // 2. TokenIntrospectionRequest\u4f5c\u6210\n  TokenIntrospectionRequest tokenIntrospectionRequest =\n      new TokenIntrospectionRequest(tenant, authorizationHeader, params);\n  tokenIntrospectionRequest.setClientCert(clientCert);\n\n  // 3. Core\u5c64\u306b\u59d4\u8b72\n  TokenProtocol tokenProtocol = tokenProtocols.get(tenant.authorizationProvider());\n  TokenIntrospectionResponse result = tokenProtocol.inspect(tokenIntrospectionRequest);\n\n  // 4. \u30a4\u30d9\u30f3\u30c8\u767a\u884c\n  if (result.hasOAuthToken()) {\n    eventPublisher.publish(\n        tenant, result.oAuthToken(), result.securityEventType(), requestAttributes);\n  }\n\n  return result;\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-token-revocation\u30c8\u30fc\u30af\u30f3\u5931\u52b9",children:"3. Token Revocation\uff08\u30c8\u30fc\u30af\u30f3\u5931\u52b9\uff09"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"RFC 7009\u6e96\u62e0"})}),"\n",(0,i.jsx)(n.h3,{id:"\u30ea\u30af\u30a8\u30b9\u30c8-1",children:"\u30ea\u30af\u30a8\u30b9\u30c8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"POST /{tenant-id}/v1/tokens/revocation\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\ntoken=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...&\ntoken_type_hint=access_token\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u30ec\u30b9\u30dd\u30f3\u30b9-1",children:"\u30ec\u30b9\u30dd\u30f3\u30b9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"HTTP/1.1 200 OK\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6ce8\u610f"}),": RFC 7009\u306b\u3088\u308a\u3001\u6210\u529f\u6642\u306f\u30dc\u30c7\u30a3\u306a\u3057\uff08200 OK\u306e\u307f\uff09"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"e2e\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9",children:"E2E\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b9f\u969b\u306e\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb",children:"\u5b9f\u969b\u306e\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u53c2\u8003"}),": ",(0,i.jsx)(n.code,{children:"e2e/src/tests/scenario/application/scenario-02-sso-oidc.test.js"})]}),"\n",(0,i.jsx)(n.p,{children:"\u5b9f\u969b\u306eE2E\u30c6\u30b9\u30c8\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u30b7\u30ca\u30ea\u30aa\u3092\u30ab\u30d0\u30fc\u3057\u3066\u3044\u307e\u3059\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u30c6\u30ca\u30f3\u30c8\u30fb\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30fb\u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7"}),"\n",(0,i.jsx)(n.li,{children:"Authorization Code Flow\u5168\u4f53"}),"\n",(0,i.jsx)(n.li,{children:"\u30c8\u30fc\u30af\u30f3\u767a\u884c\u30fb\u691c\u8a3c\u30fb\u5931\u52b9"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u30c6\u30b9\u30c8\u6642\u306e\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8",children:"\u30c6\u30b9\u30c8\u6642\u306e\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 \u78ba\u8a8d\u3059\u3079\u304d\u3053\u3068\nexpect(response.status).toBe(200);\nexpect(response.data).toHaveProperty('access_token');\nexpect(response.data).toHaveProperty('token_type', 'Bearer');\nexpect(response.data).toHaveProperty('expires_in');\n\n// OIDC\u6642\nexpect(response.data).toHaveProperty('id_token');\n\n// Refresh Token\u767a\u884c\u6642\nexpect(response.data).toHaveProperty('refresh_token');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u30c6\u30b9\u30c8\u5b9f\u884c",children:"\u30c6\u30b9\u30c8\u5b9f\u884c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd e2e\nnpm test -- scenario-02-sso-oidc.test.js\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc\u3068\u5bfe\u51e6\u6cd5",children:"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc\u3068\u5bfe\u51e6\u6cd5"}),"\n",(0,i.jsxs)(n.h3,{id:"\u30a8\u30e9\u30fc1-invalid_client---\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u5931\u6557",children:["\u30a8\u30e9\u30fc1: ",(0,i.jsx)(n.code,{children:"invalid_client"})," - \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u5931\u6557"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u969b\u306e\u30a8\u30e9\u30fc"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "invalid_client",\n  "error_description": "Client authentication failed"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539f\u56e0"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"client_id/client_secret\u304c\u4e0d\u6b63"}),"\n",(0,i.jsx)(n.li,{children:"Basic\u8a8d\u8a3c\u306eBase64\u30a8\u30f3\u30b3\u30fc\u30c9\u30df\u30b9"}),"\n",(0,i.jsx)(n.li,{children:"Authorization\u30d8\u30c3\u30c0\u30fc\u3068\u30dc\u30c7\u30a3\u3067client_id\u304c\u7570\u306a\u308b"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u6c7a\u7b56"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u2705 \u6b63\u3057\u3044\uff08client_secret_basic\uff09\ncurl -X POST "http://localhost:8080/${TENANT_ID}/v1/tokens" \\\n  -H "Authorization: Basic $(echo -n \'my-client:my-secret\' | base64)" \\\n  -d "grant_type=authorization_code&code=${CODE}&redirect_uri=${REDIRECT_URI}"\n\n# \u274c \u9593\u9055\u3044: -n\u30aa\u30d7\u30b7\u30e7\u30f3\u5fd8\u308c\uff08\u6539\u884c\u304c\u5165\u308b\uff09\necho \'my-client:my-secret\' | base64\n\n# \u2705 \u6b63\u3057\u3044\uff08client_secret_post\uff09\ncurl -X POST "http://localhost:8080/${TENANT_ID}/v1/tokens" \\\n  -d "grant_type=authorization_code&code=${CODE}&client_id=my-client&client_secret=my-secret&redirect_uri=${REDIRECT_URI}"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"\u30a8\u30e9\u30fc2-invalid_grant---authorization-code\u4e0d\u6b63",children:["\u30a8\u30e9\u30fc2: ",(0,i.jsx)(n.code,{children:"invalid_grant"})," - Authorization Code\u4e0d\u6b63"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u969b\u306e\u30a8\u30e9\u30fc"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "invalid_grant",\n  "error_description": "not found authorization code."\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539f\u56e0"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authorization Code\u304c\u65e2\u306b\u4f7f\u7528\u6e08\u307f"})," \uff08\u4f7f\u7528\u5f8c\u5373\u524a\u9664\u3055\u308c\u308b\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authorization Code\u304c\u671f\u9650\u5207\u308c"})," \uff085\u5206\u7d4c\u904e\u3067\u81ea\u52d5\u524a\u9664\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authorization Code\u304c\u5b58\u5728\u3057\u306a\u3044"})," \uff08\u8aa4\u3063\u305f\u30b3\u30fc\u30c9\uff09"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"redirect_uri\u306e\u4e0d\u4e00\u81f4"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u88c5\u8a73\u7d30"}),":\n\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u3067\u306f",(0,i.jsx)(n.code,{children:"used"}),"\u30d5\u30e9\u30b0\u3067\u306f\u306a\u304f\u3001",(0,i.jsx)(n.strong,{children:"\u4f7f\u7528\u5f8c\u5373\u524a\u9664\u3059\u308b\u8a2d\u8a08"}),"\u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u30c8\u30fc\u30af\u30f3\u767a\u884c\u6210\u529f \u2192 Authorization Code\u524a\u9664\uff08",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(35642).A+"#L199",children:"AuthorizationCodeGrantService.java:199"}),"\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:["\u518d\u4f7f\u7528\u8a66\u884c \u2192 \u30ec\u30b3\u30fc\u30c9\u4e0d\u5b58\u5728 \u2192 ",(0,i.jsx)(n.code,{children:"invalid_grant"}),"\u30a8\u30e9\u30fc"]}),"\n",(0,i.jsx)(n.li,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3: used/expired/\u5b58\u5728\u3057\u306a\u3044 \u3092\u533a\u5225\u3057\u306a\u3044\uff08\u653b\u6483\u8005\u306b\u60c5\u5831\u3092\u4e0e\u3048\u306a\u3044\uff09"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u6c7a\u7b56"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# 1. Authorization Code\u306e\u5b58\u5728\u78ba\u8a8d\ndocker exec -it postgres psql -U idp_user -d idp_db -c \\\n  \"SELECT code, expires_at, redirect_uri FROM authorization_code_grant WHERE code='${CODE}';\"\n\n# 2. \u30ec\u30b3\u30fc\u30c9\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408 \u2192 \u6700\u521d\u304b\u3089\u3084\u308a\u76f4\u3057\uff08Authorization Request\u304b\u3089\u518d\u5b9f\u884c\uff09\n# 3. expires_at < now \u306e\u5834\u5408 \u2192 \u6700\u521d\u304b\u3089\u3084\u308a\u76f4\u3057\n# 4. redirect_uri\u4e0d\u4e00\u81f4 \u2192 \u6b63\u3057\u3044URI\u3092\u6307\u5b9a\n\n# Authorization Request\u3067\u6307\u5b9a\u3057\u305fredirect_uri\u3068\u5b8c\u5168\u4e00\u81f4\u5fc5\u9808\nredirect_uri=https://app.example.com/callback  # \u2705\nredirect_uri=https://app.example.com/callback/ # \u274c \u672b\u5c3e\u30b9\u30e9\u30c3\u30b7\u30e5\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u91cd\u8981"}),": Authorization Code\u306f",(0,i.jsx)(n.strong,{children:"\u30ef\u30f3\u30bf\u30a4\u30e0\u4f7f\u7528"}),"\u3067\u3059\u3002\u4e00\u5ea6\u4f7f\u7528\u3059\u308b\u3068\u7269\u7406\u7684\u306b\u524a\u9664\u3055\u308c\u308b\u305f\u3081\u3001\u518d\u4f7f\u7528\u306f\u4e0d\u53ef\u80fd\u3067\u3059\u3002"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"\u30a8\u30e9\u30fc3-unsupported_grant_type",children:["\u30a8\u30e9\u30fc3: ",(0,i.jsx)(n.code,{children:"unsupported_grant_type"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9f\u969b\u306e\u30a8\u30e9\u30fc"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "unsupported_grant_type",\n  "error_description": "unsupported grant_type (password)"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539f\u56e0"}),": \u30c6\u30ca\u30f3\u30c8\u8a2d\u5b9a\u3067Grant Type\u304c\u7121\u52b9\u5316\u3055\u308c\u3066\u3044\u308b"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u6c7a\u7b56"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308bgrant_type\u3092\u78ba\u8a8d\ncurl -X GET "http://localhost:8080/${TENANT_ID}/.well-known/openid-configuration" \\\n  | jq \'.grant_types_supported\'\n\n# \u51fa\u529b\u4f8b:\n# ["authorization_code", "refresh_token", "client_credentials"]\n\n# password\u304c\u542b\u307e\u308c\u3066\u3044\u306a\u3044 \u2192 \u30c6\u30ca\u30f3\u30c8\u8a2d\u5b9a\u3067\u7121\u52b9\u5316\u3055\u308c\u3066\u3044\u308b\n# Management API\u3067\u6709\u52b9\u5316\u304c\u5fc5\u8981\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,i.jsx)(n.p,{children:"\u2705 Token Flow\u306e\u5b9f\u88c5\u3092\u7406\u89e3\u3057\u305f\uff01"}),"\n",(0,i.jsx)(n.h3,{id:"-\u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\ud83d\udcd6 \u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/application-plane/authentication",children:"04. Authentication\u5b9f\u88c5"})," - \u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/application-plane/userinfo",children:"05. UserInfo\u5b9f\u88c5"})," - \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u53d6\u5f97"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"-\u8a73\u7d30\u60c5\u5831",children:"\ud83d\udd17 \u8a73\u7d30\u60c5\u5831"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../../../content_10_ai_developer/ai-11-core.md#token---%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3",children:"AI\u958b\u767a\u8005\u5411\u3051: Core - Token"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc6749#section-3.2",children:"RFC 6749 Section 3.2"})," - Token Endpoint"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc7662",children:"RFC 7662"})," - Token Introspection"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(54600).A+"",children:"TokenEntryService.java"}),"\n",(0,i.jsx)(n.strong,{children:"\u6700\u7d42\u66f4\u65b0"}),": 2025-10-12"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},76471:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/files/ClientAuthenticators-99daae9a4be18c2abd215247b2aefaf1.java"},32436:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/files/TokenRequestHandler-7e082b80cb8b2dc691efbf85a13e83fe.java"},35642:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/files/AuthorizationCodeGrantService-51584ffaad2ed181451cdfb01295eae0.java"},90993:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/files/ClientCredentialsGrantService-3ce58a20b5aa830b7bf63a2586cc3a99.java"},93360:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/files/OAuthTokenCreationServices-1dca63693ab789be5009f6c2ff4a717b.java"},29132:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/files/RefreshTokenGrantService-33ae32da6e8798ab91760896c5d34182.java"},59706:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/files/TokenV1Api-ba03efa52178b8c05c5586836a8981b8.java"},54600:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/files/TokenEntryService-39a647b9aa53cbc9733fdcfd84fdef9c.java"},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var r=t(96540);const i={},s=r.createContext(i);function c(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);