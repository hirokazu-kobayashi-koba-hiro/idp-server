"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[4797],{92340:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"content_06_developer-guide/application-plane/federation","title":"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\uff08\u5916\u90e8IdP\u9023\u643a\uff09\u5b9f\u88c5\u30ac\u30a4\u30c9","description":"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684","source":"@site/docs/content_06_developer-guide/03-application-plane/08-federation.md","sourceDirName":"content_06_developer-guide/03-application-plane","slug":"/content_06_developer-guide/application-plane/federation","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/federation","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_06_developer-guide/03-application-plane/08-federation.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{},"sidebar":"docs","previous":{"title":"\u8eab\u5143\u78ba\u8a8d\u7533\u8fbc\u307f\u5b9f\u88c5\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/identity-verification"},"next":{"title":"\u30a4\u30d9\u30f3\u30c8\u51e6\u7406\u5b9f\u88c5\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/events"}}');var t=i(74848),o=i(28453);const r={},d="\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\uff08\u5916\u90e8IdP\u9023\u643a\uff09\u5b9f\u88c5\u30ac\u30a4\u30c9",l={},c=[{value:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",id:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",level:2},{value:"\u6240\u8981\u6642\u9593",id:"\u6240\u8981\u6642\u9593",level:3},{value:"\u524d\u63d0\u77e5\u8b58",id:"\u524d\u63d0\u77e5\u8b58",level:3},{value:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u306f",id:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u306f",level:2},{value:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",id:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",level:2},{value:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",id:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",level:3},{value:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",id:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",level:3},{value:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",id:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",level:2},{value:"Federation Request",id:"federation-request",level:3},{value:"Federation Callback",id:"federation-callback",level:3},{value:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u51e6\u7406\u30d5\u30ed\u30fc",id:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u51e6\u7406\u30d5\u30ed\u30fc",level:2},{value:"Phase 1: Federation Request",id:"phase-1-federation-request",level:3},{value:"Phase 2: \u5916\u90e8IdP\u3067\u306e\u8a8d\u8a3c",id:"phase-2-\u5916\u90e8idp\u3067\u306e\u8a8d\u8a3c",level:3},{value:"Phase 3: Federation Callback",id:"phase-3-federation-callback",level:3},{value:"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u308b\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc",id:"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u308b\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc",level:2},{value:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9",id:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9",level:2},{value:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a",id:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a",level:2},{value:"User\u540c\u5b9a\u6226\u7565",id:"user\u540c\u5b9a\u6226\u7565",level:2},{value:"\u5916\u90e8IdP\u306esub\u3068\u306e\u7d10\u4ed8\u3051",id:"\u5916\u90e8idp\u306esub\u3068\u306e\u7d10\u4ed8\u3051",level:3},{value:"\u521d\u56de\u30ed\u30b0\u30a4\u30f3\uff08\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\uff09",id:"\u521d\u56de\u30ed\u30b0\u30a4\u30f3\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210",level:4},{value:"2\u56de\u76ee\u4ee5\u964d\u306e\u30ed\u30b0\u30a4\u30f3\uff08\u65e2\u5b58\u30e6\u30fc\u30b6\u30fc\uff09",id:"2\u56de\u76ee\u4ee5\u964d\u306e\u30ed\u30b0\u30a4\u30f3\u65e2\u5b58\u30e6\u30fc\u30b6\u30fc",level:4},{value:"\u30ec\u30b9\u30dd\u30f3\u30b9",id:"\u30ec\u30b9\u30dd\u30f3\u30b9",level:2},{value:"Federation Request\u6210\u529f",id:"federation-request\u6210\u529f",level:3},{value:"Federation Callback\u6210\u529f",id:"federation-callback\u6210\u529f",level:3},{value:"\u30a8\u30e9\u30fc",id:"\u30a8\u30e9\u30fc",level:3},{value:"1. \u8a2d\u5b9a\u306a\u3057",id:"1-\u8a2d\u5b9a\u306a\u3057",level:4},{value:"2. state\u691c\u8a3c\u5931\u6557",id:"2-state\u691c\u8a3c\u5931\u6557",level:4},{value:"3. ID Token\u691c\u8a3c\u5931\u6557",id:"3-id-token\u691c\u8a3c\u5931\u6557",level:4},{value:"SSO\uff08\u30b7\u30f3\u30b0\u30eb\u30b5\u30a4\u30f3\u30aa\u30f3\uff09",id:"sso\u30b7\u30f3\u30b0\u30eb\u30b5\u30a4\u30f3\u30aa\u30f3",level:2},{value:"E2E\u30c6\u30b9\u30c8\u4f8b",id:"e2e\u30c6\u30b9\u30c8\u4f8b",level:2},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:2},{value:"\ud83d\udcd6 \u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"-\u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:3},{value:"\ud83d\udd17 \u8a73\u7d30\u60c5\u5831",id:"-\u8a73\u7d30\u60c5\u5831",level:3}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u5916\u90e8idp\u9023\u643a\u5b9f\u88c5\u30ac\u30a4\u30c9",children:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\uff08\u5916\u90e8IdP\u9023\u643a\uff09\u5b9f\u88c5\u30ac\u30a4\u30c9"})}),"\n",(0,t.jsx)(n.h2,{id:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",children:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684"}),"\n",(0,t.jsx)(n.p,{children:"**\u5916\u90e8\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30c6\u30a3\u30d7\u30ed\u30d0\u30a4\u30c0\uff08IdP\uff09**\u3068\u306e\u9023\u643a\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u76ee\u6a19\u3067\u3059\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u6240\u8981\u6642\u9593",children:"\u6240\u8981\u6642\u9593"}),"\n",(0,t.jsxs)(n.p,{children:["\u23f1\ufe0f ",(0,t.jsx)(n.strong,{children:"\u7d0430\u5206"})]}),"\n",(0,t.jsx)(n.h3,{id:"\u524d\u63d0\u77e5\u8b58",children:"\u524d\u63d0\u77e5\u8b58"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/application-plane/authentication",children:"04. Authentication\u5b9f\u88c5"})}),"\n",(0,t.jsx)(n.li,{children:"OpenID Connect\u57fa\u790e\u77e5\u8b58"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u306f",children:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u306f"}),"\n",(0,t.jsx)(n.p,{children:"Authorization Code Flow\u306e\u8a8d\u8a3c\u30d5\u30a7\u30fc\u30ba\u3067\u3001**\u5916\u90e8IdP\uff08Google/Azure AD\u7b49\uff09**\u3092\u4f7f\u3063\u3066\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u3092\u884c\u3046\u4ed5\u7d44\u307f\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Authorization Request\n  \u2193\n[\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u8868\u793a]\n  \u2193\n\u3010\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u3011\u2190 \u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5bfe\u8c61\n  \u251c\u2500 Google \u3067\u30ed\u30b0\u30a4\u30f3\n  \u251c\u2500 Azure AD \u3067\u30ed\u30b0\u30a4\u30f3\n  \u2514\u2500 \u306a\u3069\n  \u2193\nAuthorization Code\u767a\u884c\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5bfe\u5fdc\u30d7\u30ed\u30c8\u30b3\u30eb"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"OpenID Connect (OIDC)"})," - \u5b9f\u88c5\u6e08\u307f"]}),"\n",(0,t.jsxs)(n.li,{children:["\ud83d\udd1c ",(0,t.jsx)(n.strong,{children:"SAML 2.0"})," - \u5bfe\u5fdc\u4e88\u5b9a"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u7528\u9014"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30baSSO\uff08Google Workspace\u3001Azure AD\u7b49\uff09"}),"\n",(0,t.jsx)(n.li,{children:"BYOIdP\uff08\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8SaaS\u3067\u306eIdP\u6301\u3061\u8fbc\u307f\uff09"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",children:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf"}),"\n",(0,t.jsx)(n.h3,{id:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",children:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"HTTP\u30ea\u30af\u30a8\u30b9\u30c8\n    \u2193\nController (OAuthV1Api) - HTTP\u51e6\u7406\n    \u2193\nEntryService (OAuthFlowEntryService) - \u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\n    \u251c\u2500 FederationInteractor\u9078\u629e\uff08Plugin\uff09\n    \u251c\u2500 SsoSession\u4f5c\u6210\n    \u251c\u2500 \u5916\u90e8IdP\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n    \u2193\n\u5916\u90e8IdP\uff08Google/Azure AD\u7b49\uff09\n    \u251c\u2500 \u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\n    \u2514\u2500 Authorization Code\u767a\u884c\n    \u2193\nCallback\n    \u2193\nEntryService (OAuthFlowEntryService.callbackFederation())\n    \u251c\u2500 SsoSession\u53d6\u5f97\uff08state\u691c\u8a3c\uff09\n    \u251c\u2500 Token Request\uff08\u5916\u90e8IdP\u3078\uff09\n    \u251c\u2500 ID Token\u691c\u8a3c\n    \u251c\u2500 UserInfo\u53d6\u5f97\n    \u251c\u2500 User\u4f5c\u6210/\u66f4\u65b0\n    \u2514\u2500 AuthenticationTransaction\u66f4\u65b0\n    \u2193\nAuthorization Code\u767a\u884c\uff08\u901a\u5e38\u30d5\u30ed\u30fc\uff09\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",children:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30af\u30e9\u30b9"}),(0,t.jsx)(n.th,{children:"\u5c64"}),(0,t.jsx)(n.th,{children:"\u5f79\u5272"}),(0,t.jsx)(n.th,{children:"\u5b9f\u88c5"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"OAuthV1Api"})}),(0,t.jsx)(n.td,{children:"Controller"}),(0,t.jsx)(n.td,{children:"HTTP\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(48262).A+"",children:"OAuthV1Api.java"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"OAuthFlowEntryService"})}),(0,t.jsx)(n.td,{children:"UseCase"}),(0,t.jsx)(n.td,{children:"\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30fb\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(6282).A+"#L216-L246",children:"OAuthFlowEntryService.java:216-246"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"FederationInteractor"})}),(0,t.jsx)(n.td,{children:"Core"}),(0,t.jsx)(n.td,{children:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u51e6\u7406\uff08Plugin\uff09"}),(0,t.jsx)(n.td,{children:"Extension Core"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"OidcSsoExecutor"})}),(0,t.jsx)(n.td,{children:"Core"}),(0,t.jsx)(n.td,{children:"\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u5225\u51e6\u7406\uff08Google/Azure AD\u7b49\uff09"}),(0,t.jsx)(n.td,{children:"Extension Core"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"SsoSession"})}),(0,t.jsx)(n.td,{children:"Core"}),(0,t.jsx)(n.td,{children:"state/nonce/code_verifier\u4fdd\u6301"}),(0,t.jsx)(n.td,{children:"Extension Core"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",children:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"}),"\n",(0,t.jsx)(n.h3,{id:"federation-request",children:"Federation Request"}),"\n",(0,t.jsx)(n.p,{children:"\u5916\u90e8IdP\u3078\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3092\u958b\u59cb\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"POST /{tenant-id}/v1/authentications/{auth-req-id}/federations/{type}/{provider}\n\n# \u4f8b: Google\u3067\u30ed\u30b0\u30a4\u30f3\nPOST /{tenant-id}/v1/authentications/abc-123/federations/oidc/google\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"HTTP/1.1 302 Found\nLocation: https://accounts.google.com/o/oauth2/v2/auth?\n  client_id=xxx.apps.googleusercontent.com&\n  redirect_uri=http://localhost:8080/{tenant-id}/v1/federations/callback/oidc/google&\n  response_type=code&\n  scope=openid+profile+email&\n  state=uuid&\n  nonce=uuid&\n  code_challenge=xxx&\n  code_challenge_method=S256\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(6282).A+"#L216-L246",children:"OAuthFlowEntryService.java:216-246"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"federation-callback",children:"Federation Callback"}),"\n",(0,t.jsx)(n.p,{children:"\u5916\u90e8IdP\u304b\u3089\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u53d7\u4fe1\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /{tenant-id}/v1/federations/callback/{type}/{provider}?code=xxx&state=uuid\n\n# \u4f8b: Google\u304b\u3089\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\nGET /{tenant-id}/v1/federations/callback/oidc/google?code=abc123&state=session-uuid\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u30d1\u30e9\u30e1\u30fc\u30bf"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"code"}),": \u8a8d\u53ef\u30b3\u30fc\u30c9\uff08\u5916\u90e8IdP\u304c\u767a\u884c\uff09"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"state"}),": Session\u8b58\u5225\u5b50\uff08\u6539\u3056\u3093\u691c\u8a3c\u7528\uff09"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(6282).A+"#L248-L281",children:"OAuthFlowEntryService.java:248-281"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u51e6\u7406\u30d5\u30ed\u30fc",children:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u51e6\u7406\u30d5\u30ed\u30fc"}),"\n",(0,t.jsx)(n.h3,{id:"phase-1-federation-request",children:"Phase 1: Federation Request"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"POST /{tenant-id}/v1/authentications/{auth-req-id}/federations/oidc/google\n    \u2193\nOAuthFlowEntryService.requestFederation()\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. FederationInteractor\u9078\u629e\uff08Plugin\uff09                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  FederationInteractors.get(FederationType.OIDC)    \u2502\n\u2502    \u2192 OidcFederationInteractor                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. \u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u53d6\u5f97                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  FederationConfigurationQueryRepository.get()      \u2502\n\u2502    \u2192 OidcSsoConfiguration                          \u2502\n\u2502       - client_id                                  \u2502\n\u2502       - authorization_endpoint                     \u2502\n\u2502       - scopes\u7b49                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. SsoSession\u4f5c\u6210                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SsoSession\u306e\u5f79\u5272: Callback\u6642\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u691c\u8a3c        \u2502\n\u2502                                                     \u2502\n\u2502  \u4fdd\u5b58\u3055\u308c\u308b\u60c5\u5831:                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 state: UUID                                 \u2502   \u2502\n\u2502  \u2502  \u7528\u9014: CSRF\u653b\u6483\u9632\u6b62                          \u2502   \u2502\n\u2502  \u2502  \u691c\u8a3c: Callback\u6642\u306bstate\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u4e00\u81f4\u78ba\u8a8d  \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 nonce: UUID                                 \u2502   \u2502\n\u2502  \u2502  \u7528\u9014: \u30ea\u30d7\u30ec\u30a4\u653b\u6483\u9632\u6b62                       \u2502   \u2502\n\u2502  \u2502  \u691c\u8a3c: ID Token\u306enonce\u30af\u30ec\u30fc\u30e0\u3068\u4e00\u81f4\u78ba\u8a8d     \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 code_verifier: \u30e9\u30f3\u30c0\u30e0\u6587\u5b57\u5217\uff0843-128\u6587\u5b57\uff09   \u2502   \u2502\n\u2502  \u2502  \u7528\u9014: PKCE\uff08\u30b3\u30fc\u30c9\u6a2a\u53d6\u308a\u9632\u6b62\uff09              \u2502   \u2502\n\u2502  \u2502  \u4f7f\u7528: Token Request\u6642\u306b\u5916\u90e8IdP\u3078\u9001\u4fe1       \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 authorizationRequestIdentifier              \u2502   \u2502\n\u2502  \u2502  \u7528\u9014: \u5143\u306e\u8a8d\u53ef\u30ea\u30af\u30a8\u30b9\u30c8\u8b58\u5225                 \u2502   \u2502\n\u2502  \u2502  \u4f7f\u7528: AuthenticationTransaction\u53d6\u5f97        \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 ssoProvider: GOOGLE                         \u2502   \u2502\n\u2502  \u2502  \u7528\u9014: \u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u8b58\u5225                       \u2502   \u2502\n\u2502  \u2502  \u4f7f\u7528: Callback\u6642\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. SsoSession\u4fdd\u5b58\uff08DB: federation_sso_session\uff09      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SsoSessionCommandRepository.register()            \u2502\n\u2502    \u2192 Callback\u6642\u306e\u691c\u8a3c\u306b\u4f7f\u7528                          \u2502\n\u2502                                                     \u2502\n\u2502  \u4fdd\u5b58\u5834\u6240:                                           \u2502\n\u2502  - PostgreSQL/MySQL\uff08federation_sso_session\u30c6\u30fc\u30d6\u30eb\uff09\u2502\n\u2502  - JSONB\u5f62\u5f0f\u3067payload\u4fdd\u5b58                           \u2502\n\u2502  - \u30c6\u30ca\u30f3\u30c8\u5206\u96e2\uff08RLS\u9069\u7528\uff09                           \u2502\n\u2502  - \u4e00\u6642\u30c7\u30fc\u30bf\uff08\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u5b8c\u4e86\u5f8c\u306f\u524a\u9664\uff09          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5. \u5916\u90e8IdP\u3078\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URL\u751f\u6210                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  https://accounts.google.com/o/oauth2/v2/auth?     \u2502\n\u2502    client_id=xxx&                                  \u2502\n\u2502    redirect_uri=http://localhost/{tenant}/callback&\u2502\n\u2502    state={state}&                                  \u2502\n\u2502    nonce={nonce}&                                  \u2502\n\u2502    code_challenge=SHA256(code_verifier)&  \u2190 PKCE  \u2502\n\u2502    code_challenge_method=S256&                     \u2502\n\u2502    scope=openid+profile+email                     \u2502\n\u2502                                                     \u2502\n\u2502  PKCE\u4f7f\u7528\u7406\u7531\uff08RFC 7636\uff09:                           \u2502\n\u2502  - \u5916\u90e8IdP\u304b\u3089\u306eAuthorization Code\u3082\u30d6\u30e9\u30a6\u30b6\u7d4c\u7531    \u2502\n\u2502  - \u30d6\u30e9\u30a6\u30b6 = Code\u6a2a\u53d6\u308a\u30ea\u30b9\u30af                       \u2502\n\u2502  - code_verifier\u691c\u8a3c\u3067Code\u6a2a\u53d6\u308a\u9632\u6b62                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u2192 \u30ec\u30b9\u30dd\u30f3\u30b9: 302 Redirect\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u691c\u8a3c\u306e\u4ed5\u7d44\u307f"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"state"}),": CSRF\u653b\u6483\u9632\u6b62\uff08Callback\u6642\u306bstate\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u4e00\u81f4\u78ba\u8a8d\uff09"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"nonce"}),": \u30ea\u30d7\u30ec\u30a4\u653b\u6483\u9632\u6b62\uff08ID Token\u306enonce\u30af\u30ec\u30fc\u30e0\u3068\u4e00\u81f4\u78ba\u8a8d\uff09"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"code_verifier"}),": PKCE\uff08Token Request\u6642\u306b\u5916\u90e8IdP\u3078\u9001\u4fe1\u3001code_challenge\u3068\u7167\u5408\uff09"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"phase-2-\u5916\u90e8idp\u3067\u306e\u8a8d\u8a3c",children:"Phase 2: \u5916\u90e8IdP\u3067\u306e\u8a8d\u8a3c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u30e6\u30fc\u30b6\u30fc \u2192 Google\u30ed\u30b0\u30a4\u30f3\u753b\u9762\n    \u2193\nGoogle \u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u8a8d\u8a3c\n    \u2193\nGoogle \u304c Authorization Code \u767a\u884c\n    \u2193\n302 Redirect: http://localhost/{tenant}/v1/federations/callback/oidc/google?code=abc123&state={state}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"phase-3-federation-callback",children:"Phase 3: Federation Callback"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'GET /{tenant-id}/v1/federations/callback/oidc/google?code=abc123&state={state}\n    \u2193\nOAuthFlowEntryService.callbackFederation()\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. SsoSession\u53d6\u5f97\uff08state\u691c\u8a3c\uff09                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SsoSessionQueryRepository.get(state)              \u2502\n\u2502  - state\u4e00\u81f4\u78ba\u8a8d\uff08\u6539\u3056\u3093\u691c\u51fa\uff09                         \u2502\n\u2502  - \u5b58\u5728\u3057\u306a\u3044 \u2192 invalid_request \u30a8\u30e9\u30fc                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. Token Request\uff08\u5916\u90e8IdP\u3078\uff09                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  POST https://oauth2.googleapis.com/token          \u2502\n\u2502    grant_type=authorization_code&                  \u2502\n\u2502    code=abc123&                                    \u2502\n\u2502    client_id=xxx&                                  \u2502\n\u2502    client_secret=yyy&                              \u2502\n\u2502    code_verifier={verifier}  \u2190 PKCE                \u2502\n\u2502                                                     \u2502\n\u2502  \u30ec\u30b9\u30dd\u30f3\u30b9:                                          \u2502\n\u2502  {                                                  \u2502\n\u2502    "access_token": "ya29.xxx",                     \u2502\n\u2502    "id_token": "eyJhbGci...",                      \u2502\n\u2502    "expires_in": 3600                              \u2502\n\u2502  }                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. ID Token\u691c\u8a3c                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - \u7f72\u540d\u691c\u8a3c\uff08JWKS\u304b\u3089\u516c\u958b\u9375\u53d6\u5f97\uff09                       \u2502\n\u2502  - iss\u691c\u8a3c\uff08https://accounts.google.com\uff09           \u2502\n\u2502  - aud\u691c\u8a3c\uff08client_id\u4e00\u81f4\uff09                          \u2502\n\u2502  - exp\u691c\u8a3c\uff08\u6709\u52b9\u671f\u9650\u5185\uff09                              \u2502\n\u2502  - nonce\u691c\u8a3c\uff08SsoSession\u306enonce\u3068\u4e00\u81f4\uff09              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. UserInfo\u53d6\u5f97\uff08\u5916\u90e8IdP\u3078\uff09                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  GET https://openidconnect.googleapis.com/v1/userinfo\u2502\n\u2502  Authorization: Bearer ya29.xxx                    \u2502\n\u2502                                                     \u2502\n\u2502  \u30ec\u30b9\u30dd\u30f3\u30b9:                                          \u2502\n\u2502  {                                                  \u2502\n\u2502    "sub": "google-user-12345",                     \u2502\n\u2502    "email": "user@gmail.com",                      \u2502\n\u2502    "name": "John Doe",                             \u2502\n\u2502    "picture": "https://..."                        \u2502\n\u2502  }                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5. User\u4f5c\u6210/\u66f4\u65b0                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u65e2\u5b58\u30e6\u30fc\u30b6\u30fc\u691c\u7d22:                                     \u2502\n\u2502    external_user_id = "google-user-12345"          \u2502\n\u2502    provider_id = "google"                          \u2502\n\u2502                                                     \u2502\n\u2502  \u5b58\u5728\u3059\u308b \u2192 \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u66f4\u65b0\uff08email/name\u7b49\uff09            \u2502\n\u2502  \u5b58\u5728\u3057\u306a\u3044 \u2192 \u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 6. SsoCredentials\u4fdd\u5b58                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - user_id                                         \u2502\n\u2502  - sso_provider: "google"                          \u2502\n\u2502  - access_token: "ya29.xxx"  \u2190 SSO\u7d99\u7d9a\u7528            \u2502\n\u2502  - refresh_token                                   \u2502\n\u2502  - id_token                                        \u2502\n\u2502  \u2192 \u6b21\u56de\u30ed\u30b0\u30a4\u30f3\u6642\u306bSSO\u53ef\u80fd                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 7. AuthenticationTransaction\u66f4\u65b0                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  interactionResults: {                             \u2502\n\u2502    "oidc_federation": {successCount: 1, ...}       \u2502\n\u2502  }                                                  \u2502\n\u2502  isSuccess(): true  \u2190 \u8a8d\u8a3c\u5b8c\u4e86                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\nAuthorization Code\u767a\u884c\u53ef\u80fd\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u308b\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc",children:"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u308b\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"SsoProvider"}),(0,t.jsx)(n.th,{children:"\u8aac\u660e"}),(0,t.jsx)(n.th,{children:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"GOOGLE"})}),(0,t.jsx)(n.td,{children:"Google Workspace / Gmail"}),(0,t.jsx)(n.td,{children:"accounts.google.com"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"AZURE_AD"})}),(0,t.jsx)(n.td,{children:"Microsoft Azure AD / Entra ID"}),(0,t.jsx)(n.td,{children:"login.microsoftonline.com"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"GENERIC_OIDC"})}),(0,t.jsx)(n.td,{children:"\u6a19\u6e96OIDC\u6e96\u62e0IdP"}),(0,t.jsx)(n.td,{children:"\u30ab\u30b9\u30bf\u30e0\u8a2d\u5b9a"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u62e1\u5f35\u53ef\u80fd"}),": \u65b0\u3057\u3044SsoProvider\u3092Plugin\u3068\u3057\u3066\u8ffd\u52a0\u53ef\u80fd"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u8a73\u7d30"}),": ",(0,t.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/implementation-guides/impl-08-federation-provider",children:"\u5b9f\u88c5\u30ac\u30a4\u30c9: Federation Provider\u5b9f\u88c5"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9",children:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9"}),(0,t.jsx)(n.th,{children:"\u4f8b"}),(0,t.jsx)(n.th,{children:"\u5229\u70b9"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30baSSO"})}),(0,t.jsx)(n.td,{children:"Google Workspace\u3001Azure AD"}),(0,t.jsx)(n.td,{children:"\u65e2\u5b58\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u53ef\u80fd"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u56fd\u5bb6\u30c7\u30b8\u30bf\u30ebID"})}),(0,t.jsx)(n.td,{children:"\u30de\u30a4\u30ca\u30f3\u30d0\u30fc\u30ab\u30fc\u30c9"}),(0,t.jsx)(n.td,{children:"\u9ad8\u4fe1\u983c\u6027\u8a8d\u8a3c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u5b66\u8853\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3"})}),(0,t.jsx)(n.td,{children:"\u5b66\u8a8d\uff08GakuNin\uff09\u3001eduGAIN"}),(0,t.jsx)(n.td,{children:"\u5b66\u8853\u6a5f\u95a2\u9593SSO"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"BYOIdP"})}),(0,t.jsx)(n.td,{children:"\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8SaaS\u3067\u306eIdP\u6301\u3061\u8fbc\u307f"}),(0,t.jsx)(n.td,{children:"\u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306b\u7570\u306a\u308bIdP"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a",children:"\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Management API\u3067\u4e8b\u524d\u8a2d\u5b9a\u304c\u5fc5\u8981"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "id": "550e8400-e29b-41d4-a716-446655440000",\n  "type": "oidc_federation",\n  "sso_provider": "google",\n  "client_id": "xxx.apps.googleusercontent.com",\n  "client_secret": "GOCSPX-xxx",\n  "authorization_endpoint": "https://accounts.google.com/o/oauth2/v2/auth",\n  "token_endpoint": "https://oauth2.googleapis.com/token",\n  "userinfo_endpoint": "https://openidconnect.googleapis.com/v1/userinfo",\n  "jwks_uri": "https://www.googleapis.com/oauth2/v3/certs",\n  "issuer": "https://accounts.google.com",\n  "scopes": ["openid", "profile", "email"],\n  "user_info_mapping": {\n    "sub": "sub",\n    "email": "email",\n    "name": "name",\n    "picture": "picture"\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u8a2d\u5b9aAPI"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"POST /v1/management/tenants/{tenant-id}/federation-configurations\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"user\u540c\u5b9a\u6226\u7565",children:"User\u540c\u5b9a\u6226\u7565"}),"\n",(0,t.jsx)(n.h3,{id:"\u5916\u90e8idp\u306esub\u3068\u306e\u7d10\u4ed8\u3051",children:"\u5916\u90e8IdP\u306esub\u3068\u306e\u7d10\u4ed8\u3051"}),"\n",(0,t.jsxs)(n.p,{children:["\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u3001\u5916\u90e8IdP\u306e",(0,t.jsx)(n.code,{children:"sub"}),"\uff08Subject Identifier\uff09\u3067\u30e6\u30fc\u30b6\u30fc\u3092\u8b58\u5225\uff1a"]}),"\n",(0,t.jsx)(n.h4,{id:"\u521d\u56de\u30ed\u30b0\u30a4\u30f3\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210",children:"\u521d\u56de\u30ed\u30b0\u30a4\u30f3\uff08\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u5916\u90e8IdP\uff08Google\uff09\u304b\u3089\u306eID Token:\n{\n  "sub": "google-user-12345",\n  "email": "john@gmail.com",\n  "name": "John Doe"\n}\n    \u2193\nidp-server\u3067\u30e6\u30fc\u30b6\u30fc\u691c\u7d22:\n  WHERE external_user_id = "google-user-12345"\n    AND provider_id = "google"\n    \u2193\n  \u7d50\u679c: \u898b\u3064\u304b\u3089\u306a\u3044\uff08\u521d\u56de\u30ed\u30b0\u30a4\u30f3\uff09\n    \u2193\n\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210:\n{\n  "id": "user-uuid-abc",  \u2190 idp-server\u5185\u90e8ID\n  "external_user_id": "google-user-12345",  \u2190 Google\u306esub\n  "provider_id": "google",\n  "email": "john@gmail.com",\n  "name": "John Doe",\n  "email_verified": true  \u2190 Google\u3067\u691c\u8a3c\u6e08\u307f\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"2\u56de\u76ee\u4ee5\u964d\u306e\u30ed\u30b0\u30a4\u30f3\u65e2\u5b58\u30e6\u30fc\u30b6\u30fc",children:"2\u56de\u76ee\u4ee5\u964d\u306e\u30ed\u30b0\u30a4\u30f3\uff08\u65e2\u5b58\u30e6\u30fc\u30b6\u30fc\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u5916\u90e8IdP\uff08Google\uff09\u304b\u3089\u306eID Token:\n{\n  "sub": "google-user-12345",  \u2190 \u540c\u3058sub\n  "email": "john@gmail.com"\n}\n    \u2193\nidp-server\u3067\u30e6\u30fc\u30b6\u30fc\u691c\u7d22:\n  WHERE external_user_id = "google-user-12345"\n    AND provider_id = "google"\n    \u2193\n  \u7d50\u679c: \u898b\u3064\u304b\u3063\u305f\uff08user-uuid-abc\uff09\n    \u2193\n\u65e2\u5b58\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u66f4\u65b0:\n{\n  "id": "user-uuid-abc",  \u2190 \u540c\u3058ID\n  "email": "john@gmail.com",  \u2190 \u6700\u65b0\u60c5\u5831\u306b\u66f4\u65b0\n  "name": "John Doe"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u691c\u7d22\u306b provider_id \u3082\u5fc5\u8981\u306a\u7406\u7531"}),":\n\u8907\u6570\u306eIdP\u3067\u540c\u3058sub\u304c\u5b58\u5728\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u305f\u3081\u3001",(0,t.jsx)(n.code,{children:"external_user_id"})," \u3068 ",(0,t.jsx)(n.code,{children:"provider_id"})," \u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u4e00\u610f\u306b\u8b58\u5225"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30ec\u30b9\u30dd\u30f3\u30b9",children:"\u30ec\u30b9\u30dd\u30f3\u30b9"}),"\n",(0,t.jsx)(n.h3,{id:"federation-request\u6210\u529f",children:"Federation Request\u6210\u529f"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"HTTP/1.1 302 Found\nLocation: https://accounts.google.com/o/oauth2/v2/auth?...\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u30d6\u30e9\u30a6\u30b6\u304c\u5916\u90e8IdP\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"federation-callback\u6210\u529f",children:"Federation Callback\u6210\u529f"}),"\n",(0,t.jsx)(n.p,{children:"\u5916\u90e8IdP\u8a8d\u8a3c\u6210\u529f\u5f8c\u3001idp-server\u306e\u8a8d\u8a3c\u30d5\u30ed\u30fc\u306b\u623b\u308b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"HTTP/1.1 302 Found\nLocation: /{tenant-id}/v1/authorizations/{auth-req-id}/authorize\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u306e\u5f8c\u3001\u901a\u5e38\u306eAuthorization Code\u767a\u884c\u30d5\u30ed\u30fc\u306b\u7d9a\u304f"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"\u30a8\u30e9\u30fc",children:"\u30a8\u30e9\u30fc"}),"\n",(0,t.jsx)(n.h4,{id:"1-\u8a2d\u5b9a\u306a\u3057",children:"1. \u8a2d\u5b9a\u306a\u3057"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "error": "invalid_request",\n  "error_description": "Federation configuration not found for provider: google"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"HTTP Status"}),": ",(0,t.jsx)(n.code,{children:"400 Bad Request"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5bfe\u51e6"}),": Management API\u3067\u8a2d\u5b9a\u3092\u767b\u9332"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"2-state\u691c\u8a3c\u5931\u6557",children:"2. state\u691c\u8a3c\u5931\u6557"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "error": "invalid_request",\n  "error_description": "Invalid state parameter"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"HTTP Status"}),": ",(0,t.jsx)(n.code,{children:"400 Bad Request"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u539f\u56e0"}),": state\u6539\u3056\u3093\u3001\u307e\u305f\u306fSession\u671f\u9650\u5207\u308c\uff085\u5206\uff09"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"3-id-token\u691c\u8a3c\u5931\u6557",children:"3. ID Token\u691c\u8a3c\u5931\u6557"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "error": "invalid_request",\n  "error_description": "ID token verification failed: invalid signature"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"HTTP Status"}),": ",(0,t.jsx)(n.code,{children:"400 Bad Request"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u539f\u56e0"}),": \u7f72\u540d\u4e0d\u6b63\u3001iss\u4e0d\u4e00\u81f4\u3001aud\u4e0d\u4e00\u81f4\u3001nonce\u4e0d\u4e00\u81f4"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"sso\u30b7\u30f3\u30b0\u30eb\u30b5\u30a4\u30f3\u30aa\u30f3",children:"SSO\uff08\u30b7\u30f3\u30b0\u30eb\u30b5\u30a4\u30f3\u30aa\u30f3\uff09"}),"\n",(0,t.jsx)(n.p,{children:"\u4e00\u5ea6\u5916\u90e8IdP\u3067\u8a8d\u8a3c\u3059\u308b\u3068\u3001SsoCredentials\u304c\u4fdd\u5b58\u3055\u308c\u3001\u6b21\u56de\u30ed\u30b0\u30a4\u30f3\u6642\u306bSSO\u53ef\u80fd\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u521d\u56de\u30ed\u30b0\u30a4\u30f3:\n  \u5916\u90e8IdP\u8a8d\u8a3c \u2192 User\u4f5c\u6210 \u2192 SsoCredentials\u4fdd\u5b58\n\n2\u56de\u76ee\u4ee5\u964d:\n  SsoCredentials\u5b58\u5728 \u2192 \u5916\u90e8IdP\u306eAccess Token\u3067\u81ea\u52d5\u8a8d\u8a3c\n  \uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u4e0d\u8981\uff09\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"SsoCredentials\u306e\u6709\u52b9\u671f\u9650"}),": \u5916\u90e8IdP\u306eAccess Token\u6709\u52b9\u671f\u9650\u306b\u4f9d\u5b58"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"e2e\u30c6\u30b9\u30c8\u4f8b",children:"E2E\u30c6\u30b9\u30c8\u4f8b"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003"}),": ",(0,t.jsx)(n.code,{children:"e2e/src/tests/scenario/application/scenario-federation-oidc.test.js"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const { v4: uuidv4 } = require('uuid');\nconst axios = require('axios');\n\ndescribe('OIDC Federation Flow', () => {\n  let tenantId = '18ffff8d-8d97-460f-a71b-33f2e8afd41e';\n  let clientId = 'test-client';\n  let redirectUri = 'http://localhost:3000/callback';\n\n  beforeAll(async () => {\n    // Management API\u3067\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u767b\u9332\n    await axios.post(\n      `http://localhost:8080/v1/management/tenants/${tenantId}/federation-configurations`,\n      {\n        id: uuidv4(),\n        type: 'oidc_federation',\n        sso_provider: 'google',\n        client_id: 'xxx.apps.googleusercontent.com',\n        client_secret: 'GOCSPX-xxx',\n        authorization_endpoint: 'https://accounts.google.com/o/oauth2/v2/auth',\n        token_endpoint: 'https://oauth2.googleapis.com/token',\n        userinfo_endpoint: 'https://openidconnect.googleapis.com/v1/userinfo',\n        jwks_uri: 'https://www.googleapis.com/oauth2/v3/certs',\n        issuer: 'https://accounts.google.com',\n        scopes: ['openid', 'profile', 'email']\n      },\n      {\n        headers: { Authorization: `Bearer ${adminToken}` }\n      }\n    );\n  });\n\n  test('should redirect to external IdP', async () => {\n    // 1. Authorization Request\n    const authResponse = await axios.get(\n      `http://localhost:8080/${tenantId}/v1/authorizations`,\n      {\n        params: {\n          response_type: 'code',\n          client_id: clientId,\n          redirect_uri: redirectUri,\n          scope: 'openid'\n        },\n        maxRedirects: 0,\n        validateStatus: (status) => status === 302\n      }\n    );\n\n    const authReqId = extractAuthReqId(authResponse.headers.location);\n\n    // 2. Federation Request\n    const federationResponse = await axios.post(\n      `http://localhost:8080/${tenantId}/v1/authentications/${authReqId}/federations/oidc/google`,\n      {},\n      {\n        maxRedirects: 0,\n        validateStatus: (status) => status === 302\n      }\n    );\n\n    // Google\u3078\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u78ba\u8a8d\n    expect(federationResponse.status).toBe(302);\n    expect(federationResponse.headers.location).toContain('accounts.google.com/o/oauth2/v2/auth');\n    expect(federationResponse.headers.location).toContain('state=');\n    expect(federationResponse.headers.location).toContain('nonce=');\n    expect(federationResponse.headers.location).toContain('code_challenge=');\n  });\n\n  test('should handle federation callback', async () => {\n    // \u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306f\u3001\u5916\u90e8IdP\u306e\u4ee3\u308f\u308a\u306b\u30e2\u30c3\u30af\u3092\u4f7f\u7528\n    // \u5b9f\u969b\u306eGoogle\u8a8d\u8a3c\u306f\u624b\u52d5\u30c6\u30b9\u30c8\u3067\u5b9f\u65bd\n\n    const mockState = 'test-state-uuid';\n    const mockCode = 'mock-google-code';\n\n    // 3. Federation Callback\uff08\u30e2\u30c3\u30af\uff09\n    const callbackResponse = await axios.get(\n      `http://localhost:8080/${tenantId}/v1/federations/callback/oidc/google`,\n      {\n        params: {\n          code: mockCode,\n          state: mockState\n        },\n        maxRedirects: 0,\n        validateStatus: (status) => status === 302\n      }\n    );\n\n    // Authorization Code\u767a\u884c\u30d5\u30ed\u30fc\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u78ba\u8a8d\n    expect(callbackResponse.status).toBe(302);\n    expect(callbackResponse.headers.location).toContain('/authorizations/');\n    expect(callbackResponse.headers.location).toContain('/authorize');\n  });\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6ce8\u610f"}),": \u5b9f\u969b\u306eGoogle\u8a8d\u8a3c\u306f\u30e2\u30c3\u30af\u74b0\u5883\u3067\u306f\u56f0\u96e3\u306a\u305f\u3081\u3001\u30c6\u30b9\u30c8\u3067\u306fCallback\u90e8\u5206\u306e\u307f\u3092\u691c\u8a3c\u3002\u5b9f\u969b\u306e\u5916\u90e8IdP\u9023\u643a\u306f\u624b\u52d5\u30c6\u30b9\u30c8\u3067\u78ba\u8a8d\u3002"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,t.jsx)(n.p,{children:"\u2705 \u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5\u3092\u7406\u89e3\u3057\u305f\uff01"}),"\n",(0,t.jsx)(n.h3,{id:"-\u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\ud83d\udcd6 \u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/implementation-guides/impl-08-federation-provider",children:"\u5b9f\u88c5\u30ac\u30a4\u30c9: Federation Provider\u5b9f\u88c5"})," - \u65b0\u3057\u3044SsoProvider\u8ffd\u52a0\u65b9\u6cd5"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"-\u8a73\u7d30\u60c5\u5831",children:"\ud83d\udd17 \u8a73\u7d30\u60c5\u5831"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/idp-server/docs/content_10_ai_developer/ai-43-federation-oidc",children:"AI\u958b\u767a\u8005\u5411\u3051: Federation - OIDC"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect Core 1.0"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,t.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(6282).A+"",children:"OAuthFlowEntryService.java"}),"\n",(0,t.jsx)(n.strong,{children:"\u6700\u7d42\u66f4\u65b0"}),": 2025-10-13"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},48262:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/files/OAuthV1Api-928899572ba80efe6e161cc4a4ced791.java"},6282:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/files/OAuthFlowEntryService-761866fc4d70d6c09291e153e2fc6fb6.java"},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>d});var s=i(96540);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);