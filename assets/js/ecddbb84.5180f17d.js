"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6447],{61290:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"content_09_project/security-event-pubsub-architecture","title":"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u30d5\u30c3\u30af Pub/Sub \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08","description":"Issue #419 \u5bfe\u5fdc: WebHook\u30d9\u30fc\u30b9\u304b\u3089Pub/Sub\u578b\u3078\u306e\u79fb\u884c\u306b\u3088\u308b\u62e1\u5f35\u6027\u30fb\u5197\u9577\u5316\u5b9f\u73fe","source":"@site/docs/content_09_project/security-event-pubsub-architecture.md","sourceDirName":"content_09_project","slug":"/content_09_project/security-event-pubsub-architecture","permalink":"/idp-server/docs/content_09_project/security-event-pubsub-architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_09_project/security-event-pubsub-architecture.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"License","permalink":"/idp-server/docs/content_09_project/project-04-license"},"next":{"title":"Unit Testing - Detailed Class Lists & Verification Points","permalink":"/idp-server/docs/content_09_project/unit-testing-detailed-class-lists"}}');var r=t(74848),i=t(28453);const a={},l="\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u30d5\u30c3\u30af Pub/Sub \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08",o={},u=[{value:"\ud83d\udccb \u73fe\u72b6\u5206\u6790",id:"-\u73fe\u72b6\u5206\u6790",level:2},{value:"\u73fe\u5728\u306eWebHook\u5b9f\u88c5\u306e\u8ab2\u984c",id:"\u73fe\u5728\u306ewebhook\u5b9f\u88c5\u306e\u8ab2\u984c",level:3},{value:"<strong>\ud83d\udd17 WebHook\u65b9\u5f0f\u306e\u5236\u7d04</strong>",id:"-webhook\u65b9\u5f0f\u306e\u5236\u7d04",level:4},{value:"<strong>\u73fe\u5728\u306e\u5b9f\u88c5\u72b6\u6cc1</strong> (\u8a73\u7d30\u5206\u6790\u6e08\u307f)",id:"\u73fe\u5728\u306e\u5b9f\u88c5\u72b6\u6cc1-\u8a73\u7d30\u5206\u6790\u6e08\u307f",level:4},{value:"\ud83c\udfd7\ufe0f Pub/Sub \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08",id:"\ufe0f-pubsub-\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08",level:2},{value:"<strong>Option 1: AWS SNS/SQS \u30d9\u30fc\u30b9</strong> (\u63a8\u5968)",id:"option-1-aws-snssqs-\u30d9\u30fc\u30b9-\u63a8\u5968",level:3},{value:"<strong>\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981</strong>",id:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981",level:4},{value:"<strong>\u6280\u8853\u4ed5\u69d8\u8a73\u7d30</strong>",id:"\u6280\u8853\u4ed5\u69d8\u8a73\u7d30",level:4},{value:"<strong>Publisher\u5b9f\u88c5</strong>",id:"publisher\u5b9f\u88c5",level:5},{value:"<strong>Subscriber \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u8a2d\u8a08</strong>",id:"subscriber-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u8a2d\u8a08",level:5},{value:"<strong>SQS Consumer\u5b9f\u88c5</strong>",id:"sqs-consumer\u5b9f\u88c5",level:5},{value:"<strong>\u30c6\u30ca\u30f3\u30c8\u5206\u96e2\u30fb\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30b7\u30fc</strong>",id:"\u30c6\u30ca\u30f3\u30c8\u5206\u96e2\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30b7\u30fc",level:4},{value:"<strong>\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u30fbDLQ\u6226\u7565</strong>",id:"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0dlq\u6226\u7565",level:4},{value:"<strong>\u30e1\u30c8\u30ea\u30af\u30b9\u30fb\u76e3\u8996</strong>",id:"\u30e1\u30c8\u30ea\u30af\u30b9\u76e3\u8996",level:4},{value:"<strong>Option 2: Apache Kafka \u30d9\u30fc\u30b9</strong> (\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u8981\u4ef6\u5411\u3051)",id:"option-2-apache-kafka-\u30d9\u30fc\u30b9-\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u8981\u4ef6\u5411\u3051",level:3},{value:"<strong>\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u7279\u5fb4</strong>",id:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u7279\u5fb4",level:4},{value:"<strong>Kafka\u5b9f\u88c5\u4f8b</strong>",id:"kafka\u5b9f\u88c5\u4f8b",level:4},{value:"<strong>Option 3: NATS \u30d9\u30fc\u30b9</strong> (\u8efd\u91cf\u30fb\u9ad8\u6027\u80fd)",id:"option-3-nats-\u30d9\u30fc\u30b9-\u8efd\u91cf\u9ad8\u6027\u80fd",level:3},{value:"<strong>NATS Streaming\u8a2d\u8a08</strong>",id:"nats-streaming\u8a2d\u8a08",level:4},{value:"<strong>NATS\u5b9f\u88c5\u4f8b</strong>",id:"nats\u5b9f\u88c5\u4f8b",level:4},{value:"\ud83d\udcca \u6280\u8853\u9078\u629e\u80a2\u6bd4\u8f03\u5206\u6790",id:"-\u6280\u8853\u9078\u629e\u80a2\u6bd4\u8f03\u5206\u6790",level:2},{value:"\ud83d\udd04 \u79fb\u884c\u6226\u7565\u30fb\u4e92\u63db\u6027\u4fdd\u8a3c",id:"-\u79fb\u884c\u6226\u7565\u4e92\u63db\u6027\u4fdd\u8a3c",level:2},{value:"<strong>Phase 1: \u4f75\u5b58\u671f\u9593 (Month 1-2)</strong>",id:"phase-1-\u4f75\u5b58\u671f\u9593-month-1-2",level:3},{value:"<strong>Hybrid Publisher\u5b9f\u88c5</strong>",id:"hybrid-publisher\u5b9f\u88c5",level:4},{value:"<strong>\u8a2d\u5b9a\u7ba1\u7406API\u62e1\u5f35</strong>",id:"\u8a2d\u5b9a\u7ba1\u7406api\u62e1\u5f35",level:4},{value:"<strong>Phase 2: \u6bb5\u968e\u7684\u79fb\u884c (Month 3-4)</strong>",id:"phase-2-\u6bb5\u968e\u7684\u79fb\u884c-month-3-4",level:3},{value:"<strong>\u30c6\u30ca\u30f3\u30c8\u5225\u79fb\u884c\u5b9f\u884c</strong>",id:"\u30c6\u30ca\u30f3\u30c8\u5225\u79fb\u884c\u5b9f\u884c",level:4},{value:"<strong>Phase 3: WebHook\u5ec3\u6b62 (Month 5-6)</strong>",id:"phase-3-webhook\u5ec3\u6b62-month-5-6",level:3},{value:"<strong>\u5b8c\u5168\u79fb\u884c\u78ba\u8a8d\u30fb\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7</strong>",id:"\u5b8c\u5168\u79fb\u884c\u78ba\u8a8d\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7",level:4},{value:"\ud83c\udfaf \u63a8\u5968\u5b9f\u88c5\u30a2\u30d7\u30ed\u30fc\u30c1",id:"-\u63a8\u5968\u5b9f\u88c5\u30a2\u30d7\u30ed\u30fc\u30c1",level:2},{value:"<strong>\u77ed\u671f\u63a8\u5968: AWS SNS/SQS</strong> (3-6\u30f6\u6708)",id:"\u77ed\u671f\u63a8\u5968-aws-snssqs-3-6\u30f6\u6708",level:3},{value:"<strong>\u9577\u671f\u691c\u8a0e: Apache Kafka</strong> (12-18\u30f6\u6708)",id:"\u9577\u671f\u691c\u8a0e-apache-kafka-12-18\u30f6\u6708",level:3},{value:"<strong>\u7279\u6b8a\u7528\u9014: NATS</strong> (\u8efd\u91cf\u30fb\u30a8\u30c3\u30b8\u5bfe\u5fdc)",id:"\u7279\u6b8a\u7528\u9014-nats-\u8efd\u91cf\u30a8\u30c3\u30b8\u5bfe\u5fdc",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u30d5\u30c3\u30af-pubsub-\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08",children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u30d5\u30c3\u30af Pub/Sub \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Issue #419 \u5bfe\u5fdc"}),": WebHook\u30d9\u30fc\u30b9\u304b\u3089Pub/Sub\u578b\u3078\u306e\u79fb\u884c\u306b\u3088\u308b\u62e1\u5f35\u6027\u30fb\u5197\u9577\u5316\u5b9f\u73fe"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-\u73fe\u72b6\u5206\u6790",children:"\ud83d\udccb \u73fe\u72b6\u5206\u6790"}),"\n",(0,r.jsx)(n.h3,{id:"\u73fe\u5728\u306ewebhook\u5b9f\u88c5\u306e\u8ab2\u984c",children:"\u73fe\u5728\u306eWebHook\u5b9f\u88c5\u306e\u8ab2\u984c"}),"\n",(0,r.jsx)(n.h4,{id:"-webhook\u65b9\u5f0f\u306e\u5236\u7d04",children:(0,r.jsx)(n.strong,{children:"\ud83d\udd17 WebHook\u65b9\u5f0f\u306e\u5236\u7d04"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u540c\u671f\u51e6\u7406"}),": HTTP\u914d\u4fe1\u304c\u30a4\u30d9\u30f3\u30c8\u51e6\u7406\u30b9\u30ec\u30c3\u30c9\u3092\u30d6\u30ed\u30c3\u30af"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5358\u4e00\u8cfc\u8aad\u8005"}),": 1\u30a4\u30d9\u30f3\u30c8\u30bf\u30a4\u30d7 = 1WebHook URL \u306e\u5236\u9650"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u30b9\u30b1\u30fc\u30eb\u5236\u7d04"}),": \u5358\u4e00\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u51e6\u7406\u30fb\u6c34\u5e73\u30b9\u30b1\u30fc\u30eb\u4e0d\u53ef"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u969c\u5bb3\u8010\u6027"}),": \u30a4\u30f3\u30e1\u30e2\u30ea\u30ea\u30c8\u30e9\u30a4\u30fb\u518d\u8d77\u52d5\u6642\u30c7\u30fc\u30bf\u55aa\u5931"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u904b\u7528\u8907\u96d1\u6027"}),": \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u5065\u5168\u6027\u30c1\u30a7\u30c3\u30af\u30fb\u8a2d\u5b9a\u7ba1\u7406\u306e\u56f0\u96e3"]}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"\u73fe\u5728\u306e\u5b9f\u88c5\u72b6\u6cc1-\u8a73\u7d30\u5206\u6790\u6e08\u307f",children:[(0,r.jsx)(n.strong,{children:"\u73fe\u5728\u306e\u5b9f\u88c5\u72b6\u6cc1"})," (\u8a73\u7d30\u5206\u6790\u6e08\u307f)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\ud83d\udcca \u5145\u5b9f\u3057\u305f\u57fa\u76e4\n\u251c\u2500\u2500 130+ \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u30bf\u30a4\u30d7\n\u251c\u2500\u2500 \u30c6\u30ca\u30f3\u30c8\u5225\u8a2d\u5b9a\u7ba1\u7406 (JSON\u8a2d\u5b9a)\n\u251c\u2500\u2500 \u30d7\u30e9\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0 (\u52d5\u7684\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0)\n\u251c\u2500\u2500 SSF (RFC 8935) \u6e96\u62e0\u5b9f\u88c5\n\u2514\u2500\u2500 \u5305\u62ec\u7684\u76e3\u67fb\u30fb\u7d50\u679c\u8ffd\u8de1\n\n\ud83d\udd34 \u5236\u7d04\u30fb\u8ab2\u984c\n\u251c\u2500\u2500 \u540c\u671fHTTP\u914d\u4fe1 \u2192 \u30b9\u30ec\u30c3\u30c9\u30d6\u30ed\u30c3\u30af\n\u251c\u2500\u2500 \u56fa\u5b9a\u8a2d\u5b9a \u2192 \u52d5\u7684\u8cfc\u8aad\u8005\u8ffd\u52a0\u4e0d\u53ef\n\u251c\u2500\u2500 \u30a4\u30f3\u30e1\u30e2\u30ea\u30ea\u30c8\u30e9\u30a4 \u2192 \u969c\u5bb3\u6642\u30c7\u30fc\u30bf\u55aa\u5931\n\u251c\u2500\u2500 \u5358\u4e00\u914d\u4fe1\u5148 \u2192 \u30d5\u30a1\u30f3\u30a2\u30a6\u30c8\u4e0d\u53ef\n\u2514\u2500\u2500 \u624b\u52d5\u8a2d\u5b9a\u7ba1\u7406 \u2192 \u904b\u7528\u8ca0\u8377\u5927\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-pubsub-\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08",children:"\ud83c\udfd7\ufe0f Pub/Sub \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08"}),"\n",(0,r.jsxs)(n.h3,{id:"option-1-aws-snssqs-\u30d9\u30fc\u30b9-\u63a8\u5968",children:[(0,r.jsx)(n.strong,{children:"Option 1: AWS SNS/SQS \u30d9\u30fc\u30b9"})," (\u63a8\u5968)"]}),"\n",(0,r.jsx)(n.h4,{id:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981",children:(0,r.jsx)(n.strong,{children:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981"})}),"\n",(0,r.jsx)(n.mermaid,{value:'flowchart TD\n    subgraph "idp-server Application"\n        SE[Security Event Generator]\n        SEP[Security Event Publisher]\n        SEM[Security Event Manager]\n    end\n\n    subgraph "AWS Pub/Sub Infrastructure"\n        SNS[SNS Topics]\n        subgraph "Fan-out Queues"\n            SQS1[SQS Queue 1<br/>WebHook Processor]\n            SQS2[SQS Queue 2<br/>Slack Notifier]\n            SQS3[SQS Queue 3<br/>Email Alerts]\n            SQS4[SQS Queue N<br/>Custom Handler]\n        end\n        DLQ[Dead Letter Queue]\n    end\n\n    subgraph "Subscriber Services"\n        WH[WebHook Service]\n        SLACK[Slack Service]\n        EMAIL[Email Service]\n        CUSTOM[Custom Services]\n    end\n\n    subgraph "Management & Monitoring"\n        ADMIN[Admin Console]\n        METRICS[CloudWatch Metrics]\n        ALERTS[CloudWatch Alarms]\n    end\n\n    SE --\x3e SEP\n    SEP --\x3e SNS\n\n    SNS --\x3e SQS1\n    SNS --\x3e SQS2\n    SNS --\x3e SQS3\n    SNS --\x3e SQS4\n\n    SQS1 --\x3e WH\n    SQS2 --\x3e SLACK\n    SQS3 --\x3e EMAIL\n    SQS4 --\x3e CUSTOM\n\n    SQS1 -.-> DLQ\n    SQS2 -.-> DLQ\n    SQS3 -.-> DLQ\n\n    SEM --\x3e ADMIN\n    METRICS --\x3e ALERTS\n\n    WH --\x3e METRICS\n    SLACK --\x3e METRICS\n    EMAIL --\x3e METRICS'}),"\n",(0,r.jsx)(n.h4,{id:"\u6280\u8853\u4ed5\u69d8\u8a73\u7d30",children:(0,r.jsx)(n.strong,{children:"\u6280\u8853\u4ed5\u69d8\u8a73\u7d30"})}),"\n",(0,r.jsx)(n.h5,{id:"publisher\u5b9f\u88c5",children:(0,r.jsx)(n.strong,{children:"Publisher\u5b9f\u88c5"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u65b0\u3057\u3044Pub/Sub\u5bfe\u5fdcPublisher\n@Component\npublic class SnsSecurityEventPublisher implements SecurityEventPublisher {\n\n    private final SnsClient snsClient;\n    private final SecurityEventTopicResolver topicResolver;\n\n    @Override\n    @Async("securityEventPublisherExecutor")\n    public CompletableFuture<PublishResult> publishAsync(\n            TenantIdentifier tenantId,\n            SecurityEvent securityEvent) {\n\n        // \u30c6\u30ca\u30f3\u30c8\u5225\u30fb\u30a4\u30d9\u30f3\u30c8\u5225\u30c8\u30d4\u30c3\u30af\u89e3\u6c7a\n        String topicArn = topicResolver.resolveTopicArn(tenantId, securityEvent);\n\n        // \u30a4\u30d9\u30f3\u30c8\u2192SNS\u30e1\u30c3\u30bb\u30fc\u30b8\u5909\u63db\n        PublishRequest publishRequest = PublishRequest.builder()\n            .topicArn(topicArn)\n            .message(serializeEvent(securityEvent))\n            .messageAttributes(buildMessageAttributes(tenantId, securityEvent))\n            .messageGroupId(tenantId.value()) // FIFO\u5bfe\u5fdc\n            .messageDeduplicationId(securityEvent.eventId().value())\n            .build();\n\n        return CompletableFuture.supplyAsync(() ->\n            snsClient.publish(publishRequest))\n            .thenApply(this::mapToPublishResult)\n            .exceptionally(this::handlePublishFailure);\n    }\n\n    private Map<String, MessageAttributeValue> buildMessageAttributes(\n            TenantIdentifier tenantId, SecurityEvent event) {\n        return Map.of(\n            "tenantId", stringAttribute(tenantId.value()),\n            "eventType", stringAttribute(event.eventType()),\n            "severity", stringAttribute(event.severity().name()),\n            "timestamp", stringAttribute(event.occurredAt().toString())\n        );\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h5,{id:"subscriber-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u8a2d\u8a08",children:(0,r.jsx)(n.strong,{children:"Subscriber \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u8a2d\u8a08"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u6c4e\u7528Subscriber\u62bd\u8c61\u5316\n@FunctionalInterface\npublic interface SecurityEventSubscriber {\n    CompletableFuture<SubscriptionResult> handleEvent(\n        SecurityEventMessage eventMessage,\n        SubscriptionContext context\n    );\n}\n\n// WebHook\u7528Subscriber\u5b9f\u88c5\n@Component\npublic class WebHookSecurityEventSubscriber implements SecurityEventSubscriber {\n\n    private final HttpClient httpClient;\n    private final WebHookConfigurationService configService;\n\n    @Override\n    public CompletableFuture<SubscriptionResult> handleEvent(\n            SecurityEventMessage eventMessage,\n            SubscriptionContext context) {\n\n        TenantIdentifier tenantId = context.tenantId();\n        SecurityEvent event = eventMessage.getEvent();\n\n        // \u30c6\u30ca\u30f3\u30c8\u5225WebHook\u8a2d\u5b9a\u53d6\u5f97\n        List<WebHookConfiguration> configs = configService\n            .getWebHookConfigurations(tenantId, event.eventType());\n\n        // \u4e26\u5217WebHook\u914d\u4fe1\n        List<CompletableFuture<WebHookResult>> futures = configs.stream()\n            .map(config -> executeWebHook(event, config))\n            .collect(toList());\n\n        return CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))\n            .thenApply(v -> aggregateResults(futures))\n            .thenApply(this::mapToSubscriptionResult);\n    }\n\n    private CompletableFuture<WebHookResult> executeWebHook(\n            SecurityEvent event, WebHookConfiguration config) {\n\n        HttpRequest request = HttpRequest.newBuilder()\n            .uri(config.webhookUrl())\n            .timeout(Duration.ofSeconds(30))\n            .header("Content-Type", "application/json")\n            .headers(config.customHeaders().toArray(new String[0]))\n            .POST(HttpRequest.BodyPublishers.ofString(\n                serializeEventPayload(event, config)))\n            .build();\n\n        return httpClient.sendAsync(request, HttpResponse.BodyHandlers.ofString())\n            .thenApply(response -> mapToWebHookResult(config, response))\n            .exceptionally(throwable -> handleWebHookFailure(config, throwable));\n    }\n}\n\n// Slack\u901a\u77e5\u7528Subscriber\u5b9f\u88c5\n@Component\npublic class SlackSecurityEventSubscriber implements SecurityEventSubscriber {\n\n    private final SlackWebClient slackClient;\n\n    @Override\n    public CompletableFuture<SubscriptionResult> handleEvent(\n            SecurityEventMessage eventMessage,\n            SubscriptionContext context) {\n\n        SecurityEvent event = eventMessage.getEvent();\n        SlackMessage message = buildSlackMessage(event, context);\n\n        return slackClient.sendMessageAsync(message)\n            .thenApply(this::mapToSubscriptionResult)\n            .exceptionally(this::handleSlackFailure);\n    }\n\n    private SlackMessage buildSlackMessage(SecurityEvent event, SubscriptionContext context) {\n        return SlackMessage.builder()\n            .channel(context.getSlackConfiguration().channel())\n            .text(formatSecurityEventForSlack(event))\n            .attachments(buildSlackAttachments(event))\n            .build();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h5,{id:"sqs-consumer\u5b9f\u88c5",children:(0,r.jsx)(n.strong,{children:"SQS Consumer\u5b9f\u88c5"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// SQS\u2192Subscriber \u30d6\u30ea\u30c3\u30b8\n@Component\npublic class SqsSecurityEventConsumer {\n\n    private final SqsClient sqsClient;\n    private final Map<String, SecurityEventSubscriber> subscribers;\n\n    @EventListener\n    @SqsListener(queueNames = {"security-events-webhook",\n                               "security-events-slack",\n                               "security-events-email"})\n    public void handleSqsMessage(\n            @Payload SecurityEventMessage eventMessage,\n            @Header Map<String, Object> headers) {\n\n        String subscriberType = (String) headers.get("subscriberType");\n        SecurityEventSubscriber subscriber = subscribers.get(subscriberType);\n\n        if (subscriber == null) {\n            log.warn("No subscriber found for type: {}", subscriberType);\n            return;\n        }\n\n        SubscriptionContext context = SubscriptionContext.builder()\n            .tenantId(TenantIdentifier.of((String) headers.get("tenantId")))\n            .eventType((String) headers.get("eventType"))\n            .messageId((String) headers.get("messageId"))\n            .build();\n\n        subscriber.handleEvent(eventMessage, context)\n            .thenAccept(result -> recordSubscriptionMetrics(result))\n            .exceptionally(throwable -> {\n                handleSubscriptionFailure(eventMessage, context, throwable);\n                return null;\n            });\n    }\n\n    private void handleSubscriptionFailure(\n            SecurityEventMessage eventMessage,\n            SubscriptionContext context,\n            Throwable throwable) {\n\n        log.error("Subscription failed for event: {} tenant: {}",\n            eventMessage.getEvent().eventId(), context.tenantId(), throwable);\n\n        // \u30e1\u30c8\u30ea\u30af\u30b9\u8a18\u9332\n        recordFailureMetrics(eventMessage, context, throwable);\n\n        // DLQ\u3078\u306e\u81ea\u52d5\u9001\u4fe1\u306fSQS\u304c\u51e6\u7406\n        // \u30ab\u30b9\u30bf\u30e0\u30a2\u30e9\u30fc\u30c8\u30fb\u901a\u77e5\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3053\u3053\u3067\u5b9f\u88c5\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u30c6\u30ca\u30f3\u30c8\u5206\u96e2\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30b7\u30fc",children:(0,r.jsx)(n.strong,{children:"\u30c6\u30ca\u30f3\u30c8\u5206\u96e2\u30fb\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30b7\u30fc"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u30c6\u30ca\u30f3\u30c8\u5225\u30c8\u30d4\u30c3\u30af\u6226\u7565\n@Component\npublic class TenantAwareTopicResolver implements SecurityEventTopicResolver {\n\n    private static final String TOPIC_PATTERN =\n        "arn:aws:sns:{region}:{account}:security-events-{tenant}-{eventType}";\n\n    @Override\n    public String resolveTopicArn(TenantIdentifier tenantId, SecurityEvent event) {\n        // \u30c6\u30ca\u30f3\u30c8\u5225\u30fb\u30a4\u30d9\u30f3\u30c8\u5225\u30c8\u30d4\u30c3\u30af\n        return TOPIC_PATTERN\n            .replace("{region}", awsConfig.getRegion())\n            .replace("{account}", awsConfig.getAccountId())\n            .replace("{tenant}", sanitizeTenantId(tenantId))\n            .replace("{eventType}", sanitizeEventType(event.eventType()));\n    }\n\n    private String sanitizeTenantId(TenantIdentifier tenantId) {\n        // SNS\u30c8\u30d4\u30c3\u30af\u540d\u898f\u5247\u306b\u6e96\u62e0 (\u82f1\u6570\u5b57\u30fb\u30cf\u30a4\u30d5\u30f3\u30fb\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2)\n        return tenantId.value().replaceAll("[^a-zA-Z0-9-_]", "_");\n    }\n}\n\n// \u30c6\u30ca\u30f3\u30c8\u5225\u8a2d\u5b9a\u7ba1\u7406\n@Component\npublic class TenantSubscriptionManager {\n\n    private final SnsClient snsClient;\n    private final SqsClient sqsClient;\n\n    public void createTenantSubscription(\n            TenantIdentifier tenantId,\n            SecurityEventType eventType,\n            SubscriberConfiguration config) {\n\n        String topicArn = resolveTopicArn(tenantId, eventType);\n        String queueArn = resolveQueueArn(tenantId, config.subscriberType());\n\n        // SNS Subscription\u4f5c\u6210\n        SubscribeRequest subscribeRequest = SubscribeRequest.builder()\n            .topicArn(topicArn)\n            .protocol("sqs")\n            .endpoint(queueArn)\n            .attributes(buildSubscriptionAttributes(config))\n            .build();\n\n        SubscribeResponse response = snsClient.subscribe(subscribeRequest);\n\n        // \u8cfc\u8aad\u8a2d\u5b9a\u3092DB\u4fdd\u5b58\n        saveSubscriptionConfiguration(tenantId, eventType, config,\n            response.subscriptionArn());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0dlq\u6226\u7565",children:(0,r.jsx)(n.strong,{children:"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u30fbDLQ\u6226\u7565"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// DLQ\u30fb\u30ea\u30c8\u30e9\u30a4\u8a2d\u5b9a\n@Configuration\npublic class SecurityEventPubSubConfiguration {\n\n    @Bean\n    public SqsAsyncClient sqsAsyncClient() {\n        return SqsAsyncClient.builder()\n            .region(Region.AP_NORTHEAST_1)\n            .build();\n    }\n\n    @Bean\n    @ConfigurationProperties(prefix = "security-event.pubsub")\n    public PubSubProperties pubSubProperties() {\n        return new PubSubProperties();\n    }\n\n    // DLQ\u8a2d\u5b9a\n    public static class PubSubProperties {\n        private int maxRetries = 3;\n        private Duration retryBackoff = Duration.ofSeconds(30);\n        private Duration visibilityTimeout = Duration.ofMinutes(5);\n        private Duration messageRetention = Duration.ofDays(14);\n\n        // getters and setters\n    }\n}\n\n// DLQ\u30e1\u30c3\u30bb\u30fc\u30b8\u518d\u51e6\u7406\n@Component\npublic class DeadLetterQueueProcessor {\n\n    @Scheduled(fixedDelay = 300000) // 5\u5206\u9593\u9694\n    public void processDlqMessages() {\n\n        ReceiveMessageRequest receiveRequest = ReceiveMessageRequest.builder()\n            .queueUrl(dlqUrl)\n            .maxNumberOfMessages(10)\n            .visibilityTimeoutSeconds(300)\n            .build();\n\n        sqsClient.receiveMessage(receiveRequest)\n            .thenAccept(response -> {\n                for (Message message : response.messages()) {\n                    processDlqMessage(message);\n                }\n            });\n    }\n\n    private void processDlqMessage(Message message) {\n        try {\n            // \u30e1\u30c3\u30bb\u30fc\u30b8\u5185\u5bb9\u89e3\u6790\n            SecurityEventMessage eventMessage =\n                deserializeEventMessage(message.body());\n\n            // \u5931\u6557\u539f\u56e0\u5206\u6790\n            DlqAnalysisResult analysis = analyzeDlqMessage(eventMessage, message);\n\n            // \u81ea\u52d5\u4fee\u5fa9\u53ef\u80fd\u304b\u30c1\u30a7\u30c3\u30af\n            if (analysis.isAutoRecoverable()) {\n                // \u5143\u306e\u30ad\u30e5\u30fc\u306b\u518d\u9001\u4fe1\n                reprocessMessage(eventMessage);\n                deleteMessage(message);\n            } else {\n                // \u7ba1\u7406\u8005\u30a2\u30e9\u30fc\u30c8\u30fb\u624b\u52d5\u5bfe\u5fdc\u8981\u6c42\n                sendDlqAlert(analysis);\n            }\n\n        } catch (Exception e) {\n            log.error("DLQ message processing failed: {}", message.messageId(), e);\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u30e1\u30c8\u30ea\u30af\u30b9\u76e3\u8996",children:(0,r.jsx)(n.strong,{children:"\u30e1\u30c8\u30ea\u30af\u30b9\u30fb\u76e3\u8996"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u7d71\u5408\n@Component\npublic class SecurityEventMetricsCollector {\n\n    private final CloudWatchAsyncClient cloudWatchClient;\n    private final MeterRegistry meterRegistry;\n\n    public void recordPublishMetrics(SecurityEvent event, PublishResult result) {\n        Timer.Sample sample = Timer.start(meterRegistry);\n\n        sample.stop(Timer.builder("security_event_publish_time")\n            .tag("tenant", event.tenantId().value())\n            .tag("event_type", event.eventType())\n            .tag("status", result.isSuccess() ? "success" : "failure")\n            .register(meterRegistry));\n\n        Counter.builder("security_event_publish_total")\n            .tag("tenant", event.tenantId().value())\n            .tag("event_type", event.eventType())\n            .tag("status", result.isSuccess() ? "success" : "failure")\n            .register(meterRegistry)\n            .increment();\n    }\n\n    public void recordSubscriptionMetrics(SubscriptionResult result) {\n        Counter.builder("security_event_subscription_total")\n            .tag("subscriber_type", result.subscriberType())\n            .tag("status", result.isSuccess() ? "success" : "failure")\n            .register(meterRegistry)\n            .increment();\n\n        if (!result.isSuccess()) {\n            Counter.builder("security_event_subscription_errors")\n                .tag("subscriber_type", result.subscriberType())\n                .tag("error_type", result.errorType())\n                .register(meterRegistry)\n                .increment();\n        }\n    }\n}\n\n// CloudWatch \u30a2\u30e9\u30fc\u30e0\u8a2d\u5b9a\n@Configuration\npublic class SecurityEventAlarmsConfiguration {\n\n    @Bean\n    public CloudWatchAlarm highFailureRateAlarm() {\n        return CloudWatchAlarm.builder()\n            .alarmName("security-events-high-failure-rate")\n            .alarmDescription("Security event processing failure rate > 5%")\n            .metricName("security_event_subscription_errors")\n            .namespace("IdpServer/SecurityEvents")\n            .statistic(Statistic.SUM)\n            .period(Duration.ofMinutes(5))\n            .evaluationPeriods(2)\n            .threshold(50.0) // 5\u5206\u9593\u306b50\u4ef6\u4ee5\u4e0a\u306e\u5931\u6557\n            .comparisonOperator(ComparisonOperator.GREATER_THAN_THRESHOLD)\n            .build();\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"option-2-apache-kafka-\u30d9\u30fc\u30b9-\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u8981\u4ef6\u5411\u3051",children:[(0,r.jsx)(n.strong,{children:"Option 2: Apache Kafka \u30d9\u30fc\u30b9"})," (\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u8981\u4ef6\u5411\u3051)"]}),"\n",(0,r.jsx)(n.h4,{id:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u7279\u5fb4",children:(0,r.jsx)(n.strong,{children:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u7279\u5fb4"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Kafka Topics (\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5206\u6563)\n\u251c\u2500\u2500 security-events-{tenant}-authentication\n\u251c\u2500\u2500 security-events-{tenant}-authorization\n\u251c\u2500\u2500 security-events-{tenant}-administration\n\u2514\u2500\u2500 security-events-{tenant}-federation\n\nConsumer Groups (\u8cfc\u8aad\u8005\u7a2e\u5225)\n\u251c\u2500\u2500 webhook-processors (\u4e26\u5217\u51e6\u7406)\n\u251c\u2500\u2500 slack-notifiers (\u9806\u6b21\u51e6\u7406)\n\u251c\u2500\u2500 email-alerts (\u30d0\u30c3\u30c1\u51e6\u7406)\n\u2514\u2500\u2500 analytics-collectors (\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406)\n"})}),"\n",(0,r.jsx)(n.h4,{id:"kafka\u5b9f\u88c5\u4f8b",children:(0,r.jsx)(n.strong,{children:"Kafka\u5b9f\u88c5\u4f8b"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class KafkaSecurityEventPublisher implements SecurityEventPublisher {\n\n    private final KafkaTemplate<String, SecurityEventMessage> kafkaTemplate;\n\n    @Override\n    public CompletableFuture<PublishResult> publishAsync(\n            TenantIdentifier tenantId, SecurityEvent securityEvent) {\n\n        String topic = resolveKafkaTopic(tenantId, securityEvent);\n        String key = buildPartitionKey(tenantId, securityEvent);\n\n        SecurityEventMessage message = SecurityEventMessage.builder()\n            .event(securityEvent)\n            .tenantId(tenantId)\n            .publishedAt(Instant.now())\n            .build();\n\n        ListenableFuture<SendResult<String, SecurityEventMessage>> future =\n            kafkaTemplate.send(topic, key, message);\n\n        return future.toCompletableFuture()\n            .thenApply(this::mapToPublishResult)\n            .exceptionally(this::handlePublishFailure);\n    }\n\n    private String buildPartitionKey(TenantIdentifier tenantId, SecurityEvent event) {\n        // \u30c6\u30ca\u30f3\u30c8\u5358\u4f4d\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5206\u6563\n        // \u9806\u5e8f\u4fdd\u8a3c\u304c\u5fc5\u8981\u306a\u30a4\u30d9\u30f3\u30c8\u306f\u540c\u4e00\u30ad\u30fc\n        if (event.requiresOrdering()) {\n            return tenantId.value() + ":" + event.userId().value();\n        }\n        return tenantId.value();\n    }\n}\n\n@KafkaListener(topics = "security-events-#{tenant}-#{eventType}",\n               groupId = "webhook-processors")\npublic void handleWebHookEvent(SecurityEventMessage message) {\n    webHookSubscriber.handleEvent(message, buildContext(message))\n        .exceptionally(throwable -> {\n            // Kafka\u81ea\u4f53\u304c\u518d\u8a66\u884c\u30fbDLQ\u3092\u7ba1\u7406\n            log.error("WebHook processing failed", throwable);\n            return null;\n        });\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"option-3-nats-\u30d9\u30fc\u30b9-\u8efd\u91cf\u9ad8\u6027\u80fd",children:[(0,r.jsx)(n.strong,{children:"Option 3: NATS \u30d9\u30fc\u30b9"})," (\u8efd\u91cf\u30fb\u9ad8\u6027\u80fd)"]}),"\n",(0,r.jsx)(n.h4,{id:"nats-streaming\u8a2d\u8a08",children:(0,r.jsx)(n.strong,{children:"NATS Streaming\u8a2d\u8a08"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Subject\u968e\u5c64\n\u251c\u2500\u2500 security.events.{tenant}.auth.*\n\u251c\u2500\u2500 security.events.{tenant}.oauth.*\n\u251c\u2500\u2500 security.events.{tenant}.admin.*\n\u2514\u2500\u2500 security.events.{tenant}.federation.*\n\nQueue Groups (\u8ca0\u8377\u5206\u6563)\n\u251c\u2500\u2500 webhook-workers\n\u251c\u2500\u2500 slack-workers\n\u251c\u2500\u2500 email-workers\n\u2514\u2500\u2500 analytics-workers\n"})}),"\n",(0,r.jsx)(n.h4,{id:"nats\u5b9f\u88c5\u4f8b",children:(0,r.jsx)(n.strong,{children:"NATS\u5b9f\u88c5\u4f8b"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class NatsSecurityEventPublisher implements SecurityEventPublisher {\n\n    private final Connection natsConnection;\n\n    @Override\n    public CompletableFuture<PublishResult> publishAsync(\n            TenantIdentifier tenantId, SecurityEvent securityEvent) {\n\n        String subject = buildNatsSubject(tenantId, securityEvent);\n        byte[] data = serializeEvent(securityEvent);\n\n        return CompletableFuture.supplyAsync(() -> {\n            try {\n                natsConnection.publish(subject, data);\n                return PublishResult.success();\n            } catch (Exception e) {\n                return PublishResult.failure(e);\n            }\n        });\n    }\n\n    private String buildNatsSubject(TenantIdentifier tenantId, SecurityEvent event) {\n        return String.format("security.events.%s.%s.%s",\n            sanitizeTenantId(tenantId),\n            event.category(),\n            event.eventType());\n    }\n}\n\n@Component\npublic class NatsSecurityEventSubscriber {\n\n    @PostConstruct\n    public void subscribeToEvents() {\n        // Queue Group\u8cfc\u8aad (\u8ca0\u8377\u5206\u6563)\n        natsConnection.subscribe("security.events.*.auth.*", "webhook-workers",\n            message -> handleAuthEvent(message));\n\n        natsConnection.subscribe("security.events.*.oauth.*", "webhook-workers",\n            message -> handleOAuthEvent(message));\n    }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-\u6280\u8853\u9078\u629e\u80a2\u6bd4\u8f03\u5206\u6790",children:"\ud83d\udcca \u6280\u8853\u9078\u629e\u80a2\u6bd4\u8f03\u5206\u6790"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u89b3\u70b9"}),(0,r.jsx)(n.th,{children:"AWS SNS/SQS"}),(0,r.jsx)(n.th,{children:"Apache Kafka"}),(0,r.jsx)(n.th,{children:"NATS"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u5b66\u7fd2\u30b3\u30b9\u30c8"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u4f4e"}),(0,r.jsx)(n.td,{children:"\ud83d\udd34 \u9ad8"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u4e2d"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u904b\u7528\u30b3\u30b9\u30c8"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u4e2d (\u5f93\u91cf\u8ab2\u91d1)"}),(0,r.jsx)(n.td,{children:"\ud83d\udd34 \u9ad8 (\u81ea\u5df1\u7ba1\u7406)"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u4f4e"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u4e2d (~3K TPS)"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u9ad8 (100K+ TPS)"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u9ad8 (10K+ TPS)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u9806\u5e8f\u4fdd\u8a3c"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 FIFO\u5236\u9650\u3042\u308a"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5185\u4fdd\u8a3c"}),(0,r.jsx)(n.td,{children:"\ud83d\udd34 \u5236\u9650\u3042\u308a"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u8010\u4e45\u6027"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u9ad8"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u9ad8"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u4e2d"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u62e1\u5f35\u6027"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u81ea\u52d5"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u624b\u52d5\u8abf\u6574"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u624b\u52d5\u8abf\u6574"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u30cd\u30a4\u30c6\u30a3\u30d6"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Topic\u5206\u96e2"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Subject\u5206\u96e2"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u76e3\u8996\u30fb\u904b\u7528"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 CloudWatch\u7d71\u5408"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u5916\u90e8\u30c4\u30fc\u30eb"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u5916\u90e8\u30c4\u30fc\u30eb"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u30b3\u30b9\u30c8\u4e88\u6e2c"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 \u5909\u52d5\u7684"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u56fa\u5b9a\u7684"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 \u56fa\u5b9a\u7684"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-\u79fb\u884c\u6226\u7565\u4e92\u63db\u6027\u4fdd\u8a3c",children:"\ud83d\udd04 \u79fb\u884c\u6226\u7565\u30fb\u4e92\u63db\u6027\u4fdd\u8a3c"}),"\n",(0,r.jsx)(n.h3,{id:"phase-1-\u4f75\u5b58\u671f\u9593-month-1-2",children:(0,r.jsx)(n.strong,{children:"Phase 1: \u4f75\u5b58\u671f\u9593 (Month 1-2)"})}),"\n",(0,r.jsx)(n.h4,{id:"hybrid-publisher\u5b9f\u88c5",children:(0,r.jsx)(n.strong,{children:"Hybrid Publisher\u5b9f\u88c5"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class HybridSecurityEventPublisher implements SecurityEventPublisher {\n\n    private final WebHookSecurityEventPublisher legacyPublisher;\n    private final PubSubSecurityEventPublisher newPublisher;\n    private final SecurityEventMigrationConfig migrationConfig;\n\n    @Override\n    public CompletableFuture<PublishResult> publishAsync(\n            TenantIdentifier tenantId, SecurityEvent securityEvent) {\n\n        // \u30c6\u30ca\u30f3\u30c8\u30fb\u30a4\u30d9\u30f3\u30c8\u5225\u79fb\u884c\u30d5\u30e9\u30b0\u78ba\u8a8d\n        if (migrationConfig.shouldUsePubSub(tenantId, securityEvent.eventType())) {\n            // \u65b0\u3057\u3044Pub/Sub\u65b9\u5f0f\n            return newPublisher.publishAsync(tenantId, securityEvent)\n                .thenCompose(result -> {\n                    // \u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\uff1a\u5931\u6557\u6642\u306fWebHook\u5b9f\u884c\n                    if (!result.isSuccess() && migrationConfig.enableFallback()) {\n                        return legacyPublisher.publishAsync(tenantId, securityEvent);\n                    }\n                    return CompletableFuture.completedFuture(result);\n                });\n        } else {\n            // \u5f93\u6765\u306eWebHook\u65b9\u5f0f\u7d99\u7d9a\n            return legacyPublisher.publishAsync(tenantId, securityEvent);\n        }\n    }\n}\n\n// \u6bb5\u968e\u7684\u79fb\u884c\u8a2d\u5b9a\n@ConfigurationProperties(prefix = "security-event.migration")\npublic class SecurityEventMigrationConfig {\n\n    private Set<String> pubsubEnabledTenants = new HashSet<>();\n    private Set<String> pubsubEnabledEventTypes = new HashSet<>();\n    private boolean enableFallback = true;\n    private double pubsubMigrationRatio = 0.0; // 0% \u2192 100%\n\n    public boolean shouldUsePubSub(TenantIdentifier tenantId, String eventType) {\n        // \u30c6\u30ca\u30f3\u30c8\u5358\u4f4d\u79fb\u884c\n        if (pubsubEnabledTenants.contains(tenantId.value())) {\n            return true;\n        }\n\n        // \u30a4\u30d9\u30f3\u30c8\u30bf\u30a4\u30d7\u5358\u4f4d\u79fb\u884c\n        if (pubsubEnabledEventTypes.contains(eventType)) {\n            return true;\n        }\n\n        // \u6bb5\u968e\u7684\u79fb\u884c (\u6bd4\u7387\u30d9\u30fc\u30b9)\n        return Math.random() < pubsubMigrationRatio;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u8a2d\u5b9a\u7ba1\u7406api\u62e1\u5f35",children:(0,r.jsx)(n.strong,{children:"\u8a2d\u5b9a\u7ba1\u7406API\u62e1\u5f35"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@RestController\n@RequestMapping("/v1/management/tenants/{tenant-id}/security-event-hooks")\npublic class SecurityEventHookMigrationApi {\n\n    @PostMapping("/migrate-to-pubsub")\n    public ResponseEntity<MigrationResult> migrateToPubSub(\n            @PathVariable("tenant-id") TenantIdentifier tenantId,\n            @RequestBody MigrationRequest request) {\n\n        // \u65e2\u5b58WebHook\u8a2d\u5b9a\u2192Pub/Sub\u8cfc\u8aad\u8a2d\u5b9a\u5909\u63db\n        List<WebHookConfiguration> webhookConfigs =\n            webhookService.getWebHookConfigurations(tenantId);\n\n        List<SubscriberConfiguration> subscriberConfigs =\n            migrationService.convertWebHooksToSubscribers(webhookConfigs);\n\n        // Pub/Sub\u8cfc\u8aad\u8a2d\u5b9a\u4f5c\u6210\n        MigrationResult result = pubsubService\n            .createSubscriberConfigurations(tenantId, subscriberConfigs);\n\n        // \u79fb\u884c\u30d5\u30e9\u30b0\u6709\u52b9\u5316\n        if (result.isSuccess()) {\n            migrationConfig.enablePubSubForTenant(tenantId);\n        }\n\n        return ResponseEntity.ok(result);\n    }\n\n    @PostMapping("/rollback-to-webhook")\n    public ResponseEntity<RollbackResult> rollbackToWebHook(\n            @PathVariable("tenant-id") TenantIdentifier tenantId) {\n\n        // Pub/Sub\u8cfc\u8aad\u524a\u9664\n        pubsubService.deleteSubscriberConfigurations(tenantId);\n\n        // WebHook\u8a2d\u5b9a\u5fa9\u5143\n        RollbackResult result = webhookService.restoreWebHookConfigurations(tenantId);\n\n        // \u79fb\u884c\u30d5\u30e9\u30b0\u7121\u52b9\u5316\n        migrationConfig.disablePubSubForTenant(tenantId);\n\n        return ResponseEntity.ok(result);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"phase-2-\u6bb5\u968e\u7684\u79fb\u884c-month-3-4",children:(0,r.jsx)(n.strong,{children:"Phase 2: \u6bb5\u968e\u7684\u79fb\u884c (Month 3-4)"})}),"\n",(0,r.jsx)(n.h4,{id:"\u30c6\u30ca\u30f3\u30c8\u5225\u79fb\u884c\u5b9f\u884c",children:(0,r.jsx)(n.strong,{children:"\u30c6\u30ca\u30f3\u30c8\u5225\u79fb\u884c\u5b9f\u884c"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u79fb\u884c\u7ba1\u7406\u30b9\u30af\u30ea\u30d7\u30c8\u4f8b\n#!/bin/bash\n\nTENANTS=("tenant-a" "tenant-b" "tenant-c")\nEVENT_TYPES=("authentication" "oauth" "admin")\n\nfor tenant in "${TENANTS[@]}"; do\n    echo "Migrating tenant: $tenant"\n\n    # 1. Pub/Sub\u8cfc\u8aad\u8a2d\u5b9a\u4f5c\u6210\n    curl -X POST "/v1/management/tenants/$tenant/security-event-hooks/migrate-to-pubsub" \\\n         -H "Authorization: Bearer $ADMIN_TOKEN" \\\n         -H "Content-Type: application/json" \\\n         -d \'{"dryRun": true}\'\n\n    # 2. \u30c6\u30b9\u30c8\u5b9f\u884c\n    ./test-pubsub-integration.sh "$tenant"\n\n    if [ $? -eq 0 ]; then\n        # 3. \u672c\u683c\u79fb\u884c\u5b9f\u884c\n        curl -X POST "/v1/management/tenants/$tenant/security-event-hooks/migrate-to-pubsub" \\\n             -H "Authorization: Bearer $ADMIN_TOKEN" \\\n             -H "Content-Type: application/json" \\\n             -d \'{"dryRun": false}\'\n\n        echo "Migration completed for tenant: $tenant"\n    else\n        echo "Migration failed for tenant: $tenant - manual intervention required"\n    fi\ndone\n'})}),"\n",(0,r.jsx)(n.h3,{id:"phase-3-webhook\u5ec3\u6b62-month-5-6",children:(0,r.jsx)(n.strong,{children:"Phase 3: WebHook\u5ec3\u6b62 (Month 5-6)"})}),"\n",(0,r.jsx)(n.h4,{id:"\u5b8c\u5168\u79fb\u884c\u78ba\u8a8d\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7",children:(0,r.jsx)(n.strong,{children:"\u5b8c\u5168\u79fb\u884c\u78ba\u8a8d\u30fb\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class MigrationCompletionService {\n\n    @EventListener(ApplicationReadyEvent.class)\n    public void verifyMigrationCompletion() {\n\n        List<TenantIdentifier> remainingWebhookTenants =\n            webhookService.getTenantsUsingWebHooks();\n\n        if (remainingWebhookTenants.isEmpty()) {\n            log.info("\u2705 All tenants migrated to Pub/Sub successfully");\n\n            // WebHook\u95a2\u9023\u30ea\u30bd\u30fc\u30b9\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\n            cleanupWebHookResources();\n\n            // \u8a2d\u5b9a\u30fb\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u66f4\u65b0\n            updateConfigurationForPubSubOnly();\n\n        } else {\n            log.warn("\u26a0\ufe0f  Migration incomplete - remaining tenants: {}",\n                remainingWebhookTenants);\n        }\n    }\n\n    private void cleanupWebHookResources() {\n        // WebHook\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u505c\u6b62\n        webhookTaskExecutor.shutdown();\n\n        // WebHook\u8a2d\u5b9a\u30c6\u30fc\u30d6\u30eb\u975e\u6d3b\u6027\u5316\n        webhookConfigurationRepository.markAsLegacy();\n\n        // \u76e3\u8996\u30fb\u30a2\u30e9\u30fc\u30c8\u66f4\u65b0\n        monitoringService.updateMetricsForPubSubOnly();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-\u63a8\u5968\u5b9f\u88c5\u30a2\u30d7\u30ed\u30fc\u30c1",children:"\ud83c\udfaf \u63a8\u5968\u5b9f\u88c5\u30a2\u30d7\u30ed\u30fc\u30c1"}),"\n",(0,r.jsxs)(n.h3,{id:"\u77ed\u671f\u63a8\u5968-aws-snssqs-3-6\u30f6\u6708",children:[(0,r.jsx)(n.strong,{children:"\u77ed\u671f\u63a8\u5968: AWS SNS/SQS"})," (3-6\u30f6\u6708)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u5b9f\u88c5\u5bb9\u6613\u6027"}),": AWS\u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u6d3b\u7528"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u904b\u7528\u8ca0\u8377\u8efd\u6e1b"}),": \u30a4\u30f3\u30d5\u30e9\u7ba1\u7406\u4e0d\u8981"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3"}),": \u81ea\u52d5\u30b9\u30b1\u30fc\u30eb\u30fb\u9ad8\u53ef\u7528\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u30b3\u30b9\u30c8\u52b9\u7387"}),": \u5f93\u91cf\u8ab2\u91d1\u30fb\u521d\u671f\u6295\u8cc7\u4e0d\u8981"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u76e3\u8996\u7d71\u5408"}),": CloudWatch native\u9023\u643a"]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"\u9577\u671f\u691c\u8a0e-apache-kafka-12-18\u30f6\u6708",children:[(0,r.jsx)(n.strong,{children:"\u9577\u671f\u691c\u8a0e: Apache Kafka"})," (12-18\u30f6\u6708)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,r.jsx)(n.strong,{children:"\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u8981\u4ef6"}),": 1\u4e07TPS\u8d85\u306e\u51e6\u7406\u304c\u5fc5\u8981"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,r.jsx)(n.strong,{children:"\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406"}),": \u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u5206\u6790\u30fb\u6a5f\u68b0\u5b66\u7fd2\u7d71\u5408"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,r.jsx)(n.strong,{children:"\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0"}),": \u5b8c\u5168\u306a\u76e3\u67fb\u30fb\u518d\u751f\u6a5f\u80fd"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,r.jsx)(n.strong,{children:"\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u62e1\u5f35"}),": \u8907\u6570\u30b5\u30fc\u30d3\u30b9\u9593\u30a4\u30d9\u30f3\u30c8\u9023\u643a"]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"\u7279\u6b8a\u7528\u9014-nats-\u8efd\u91cf\u30a8\u30c3\u30b8\u5bfe\u5fdc",children:[(0,r.jsx)(n.strong,{children:"\u7279\u6b8a\u7528\u9014: NATS"})," (\u8efd\u91cf\u30fb\u30a8\u30c3\u30b8\u5bfe\u5fdc)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u26a1 ",(0,r.jsx)(n.strong,{children:"\u8efd\u91cf\u5b9f\u88c5"}),": \u30ea\u30bd\u30fc\u30b9\u5236\u7d04\u74b0\u5883"]}),"\n",(0,r.jsxs)(n.li,{children:["\u26a1 ",(0,r.jsx)(n.strong,{children:"\u30a8\u30c3\u30b8\u914d\u5099"}),": \u5730\u7406\u5206\u6563\u30fb\u30ec\u30a4\u30c6\u30f3\u30b7\u91cd\u8996"]}),"\n",(0,r.jsxs)(n.li,{children:["\u26a1 ",(0,r.jsx)(n.strong,{children:"IoT\u7d71\u5408"}),": \u30c7\u30d0\u30a4\u30b9\u9023\u643a\u30fbM2M\u901a\u4fe1"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u3053\u306e\u8a2d\u8a08\u306b\u3088\u308a\u3001idp-server\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u30d5\u30c3\u30af\u306f",(0,r.jsx)(n.strong,{children:"\u73fe\u4ee3\u7684\u306aPub/Sub\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3"}),"\u306b\u79fb\u884c\u3057\u3001\u62e1\u5f35\u6027\u30fb\u5197\u9577\u6027\u30fb\u904b\u7528\u6027\u3092\u5927\u5e45\u306b\u5411\u4e0a\u3067\u304d\u307e\u3059\u3002\u5927\u962a\u9b42\u3067\u7206\u901f\u6539\u5584\u3001\u5b9f\u73fe\u3084\uff01 \ud83d\ude80"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var s=t(96540);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);