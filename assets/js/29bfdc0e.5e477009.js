"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[64662],{56559:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>T,frontMatter:()=>d,metadata:()=>E,toc:()=>t});const E=JSON.parse('{"id":"content_11_learning/postgresql/dev-08-plpgsql-advanced","title":"PostgreSQL PL/pgSQL \u5fdc\u7528\u7de8","description":"\u6240\u8981\u6642\u9593","source":"@site/docs/content_11_learning/11-postgresql/dev-08-plpgsql-advanced.md","sourceDirName":"content_11_learning/11-postgresql","slug":"/content_11_learning/postgresql/dev-08-plpgsql-advanced","permalink":"/idp-server/docs/content_11_learning/postgresql/dev-08-plpgsql-advanced","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/11-postgresql/dev-08-plpgsql-advanced.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"PostgreSQL PL/pgSQL \u57fa\u672c\u7de8","permalink":"/idp-server/docs/content_11_learning/postgresql/dev-07-plpgsql-basics"},"next":{"title":"\u6697\u53f7\u5316\uff08Cryptography\uff09\u5b66\u7fd2\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_11_learning/crypto/"}}');var l=s(74848),r=s(28453);const d={},i="PostgreSQL PL/pgSQL \u5fdc\u7528\u7de8",c={},t=[{value:"\u6240\u8981\u6642\u9593",id:"\u6240\u8981\u6642\u9593",level:2},{value:"\u5b66\u3079\u308b\u3053\u3068",id:"\u5b66\u3079\u308b\u3053\u3068",level:2},{value:"\u524d\u63d0\u77e5\u8b58",id:"\u524d\u63d0\u77e5\u8b58",level:2},{value:"1. \u52d5\u7684SQL",id:"1-\u52d5\u7684sql",level:2},{value:"1.1 EXECUTE\u6587\u306e\u57fa\u672c",id:"11-execute\u6587\u306e\u57fa\u672c",level:3},{value:"1.2 format()\u95a2\u6570\u306b\u3088\u308b\u5b89\u5168\u306a\u30af\u30a8\u30ea\u69cb\u7bc9",id:"12-format\u95a2\u6570\u306b\u3088\u308b\u5b89\u5168\u306a\u30af\u30a8\u30ea\u69cb\u7bc9",level:3},{value:"1.3 \u5b9f\u8df5\u4f8b: \u52d5\u7684WHERE\u53e5",id:"13-\u5b9f\u8df5\u4f8b-\u52d5\u7684where\u53e5",level:3},{value:"2. \u30c8\u30ea\u30ac\u30fc",id:"2-\u30c8\u30ea\u30ac\u30fc",level:2},{value:"2.1 \u30c8\u30ea\u30ac\u30fc\u3068\u306f",id:"21-\u30c8\u30ea\u30ac\u30fc\u3068\u306f",level:3},{value:"2.2 \u30c8\u30ea\u30ac\u30fc\u95a2\u6570\u306e\u4f5c\u6210",id:"22-\u30c8\u30ea\u30ac\u30fc\u95a2\u6570\u306e\u4f5c\u6210",level:3},{value:"2.3 CREATE TRIGGER\u306e\u6587\u6cd5\u8a73\u7d30",id:"23-create-trigger\u306e\u6587\u6cd5\u8a73\u7d30",level:3},{value:"\u57fa\u672c\u69cb\u6587",id:"\u57fa\u672c\u69cb\u6587",level:4},{value:"\u5404\u8981\u7d20\u306e\u8aac\u660e",id:"\u5404\u8981\u7d20\u306e\u8aac\u660e",level:4},{value:"\u30c8\u30ea\u30ac\u30fc\u547d\u540d\u898f\u5247",id:"\u30c8\u30ea\u30ac\u30fc\u547d\u540d\u898f\u5247",level:4},{value:"RETURN\u306e\u610f\u5473",id:"return\u306e\u610f\u5473",level:4},{value:"2.4 \u5b9f\u8df5\u4f8b1: updated_at\u81ea\u52d5\u66f4\u65b0",id:"24-\u5b9f\u8df5\u4f8b1-updated_at\u81ea\u52d5\u66f4\u65b0",level:3},{value:"2.5 \u5b9f\u8df5\u4f8b2: \u76e3\u67fb\u30ed\u30b0\u306e\u8a18\u9332",id:"25-\u5b9f\u8df5\u4f8b2-\u76e3\u67fb\u30ed\u30b0\u306e\u8a18\u9332",level:3},{value:"2.6 \u5b9f\u8df5\u4f8b3: \u30c7\u30fc\u30bf\u691c\u8a3c",id:"26-\u5b9f\u8df5\u4f8b3-\u30c7\u30fc\u30bf\u691c\u8a3c",level:3},{value:"2.7 \u30c8\u30ea\u30ac\u30fc\u7279\u6b8a\u5909\u6570",id:"27-\u30c8\u30ea\u30ac\u30fc\u7279\u6b8a\u5909\u6570",level:3},{value:"2.8 \u30c8\u30ea\u30ac\u30fc\u306e\u7ba1\u7406",id:"28-\u30c8\u30ea\u30ac\u30fc\u306e\u7ba1\u7406",level:3},{value:"2.9 \u30c8\u30ea\u30ac\u30fc\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"29-\u30c8\u30ea\u30ac\u30fc\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:3},{value:"3. \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1",id:"3-\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1",level:2},{value:"3.1 \u95a2\u6570\u5185\u3067\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u52d5\u4f5c",id:"31-\u95a2\u6570\u5185\u3067\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u52d5\u4f5c",level:3},{value:"3.2 \u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3",id:"32-\u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3",level:3},{value:"3.3 \u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3067\u306eCOMMIT\uff08PostgreSQL 11+\uff09",id:"33-\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3067\u306ecommitpostgresql-11",level:3},{value:"4. \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316",id:"4-\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316",level:2},{value:"4.1 VOLATILE/STABLE/IMMUTABLE\u5c5e\u6027",id:"41-volatilestableimmutable\u5c5e\u6027",level:3},{value:"4.2 SQL\u95a2\u6570 vs PL/pgSQL\u95a2\u6570",id:"42-sql\u95a2\u6570-vs-plpgsql\u95a2\u6570",level:3},{value:"4.3 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u52a3\u5316\u306e\u4f8b",id:"43-\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u52a3\u5316\u306e\u4f8b",level:3},{value:"4.4 EXPLAIN ANALYZE\u3067\u306e\u5b9f\u884c\u8a08\u753b\u78ba\u8a8d",id:"44-explain-analyze\u3067\u306e\u5b9f\u884c\u8a08\u753b\u78ba\u8a8d",level:3},{value:"5. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",id:"5-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",level:2},{value:"5.1 SECURITY DEFINER vs SECURITY INVOKER",id:"51-security-definer-vs-security-invoker",level:3},{value:"5.2 search_path\u306e\u56fa\u5b9a",id:"52-search_path\u306e\u56fa\u5b9a",level:3},{value:"5.3 \u5165\u529b\u691c\u8a3c",id:"53-\u5165\u529b\u691c\u8a3c",level:3},{value:"6. \u5fdc\u7528\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"6-\u5fdc\u7528\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:2},{value:"6.1 \u52d5\u7684SQL\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",id:"61-\u52d5\u7684sql\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",level:3},{value:"6.2 \u30c8\u30ea\u30ac\u30fc\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u8003\u616e",id:"62-\u30c8\u30ea\u30ac\u30fc\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u8003\u616e",level:3},{value:"6.3 SECURITY DEFINER\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"63-security-definer\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:3},{value:"7. \u53c2\u8003\u30ea\u30f3\u30af",id:"7-\u53c2\u8003\u30ea\u30f3\u30af",level:2},{value:"\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:3},{value:"\u95a2\u9023\u3059\u308b\u5b66\u7fd2\u30b3\u30f3\u30c6\u30f3\u30c4",id:"\u95a2\u9023\u3059\u308b\u5b66\u7fd2\u30b3\u30f3\u30c6\u30f3\u30c4",level:3},{value:"\u307e\u3068\u3081",id:"\u307e\u3068\u3081",level:2}];function a(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"postgresql-plpgsql-\u5fdc\u7528\u7de8",children:"PostgreSQL PL/pgSQL \u5fdc\u7528\u7de8"})}),"\n",(0,l.jsx)(e.h2,{id:"\u6240\u8981\u6642\u9593",children:"\u6240\u8981\u6642\u9593"}),"\n",(0,l.jsx)(e.p,{children:"\u7d0450\u5206"}),"\n",(0,l.jsx)(e.h2,{id:"\u5b66\u3079\u308b\u3053\u3068",children:"\u5b66\u3079\u308b\u3053\u3068"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u52d5\u7684SQL\u306e\u5b89\u5168\u306a\u4f7f\u3044\u65b9\u3068SQL\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5bfe\u7b56"}),"\n",(0,l.jsx)(e.li,{children:"\u30c8\u30ea\u30ac\u30fc\u95a2\u6570\u306e\u5b9f\u88c5\uff08BEFORE/AFTER\u3001NEW/OLD\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1\u306e\u8a73\u7d30"}),"\n",(0,l.jsx)(e.li,{children:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316\uff08VOLATILE/STABLE/IMMUTABLE\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8003\u616e\u4e8b\u9805\uff08SECURITY DEFINER\uff09"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u524d\u63d0\u77e5\u8b58",children:"\u524d\u63d0\u77e5\u8b58"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/postgresql/dev-07-plpgsql-basics",children:"dev-07-plpgsql-basics.md"})," - PL/pgSQL\u57fa\u672c\u7de8"]}),"\n",(0,l.jsx)(e.li,{children:"SQL\u306e\u57fa\u672c\u64cd\u4f5c\u3068\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u7406\u89e3"}),"\n"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"1-\u52d5\u7684sql",children:"1. \u52d5\u7684SQL"}),"\n",(0,l.jsx)(e.h3,{id:"11-execute\u6587\u306e\u57fa\u672c",children:"1.1 EXECUTE\u6587\u306e\u57fa\u672c"}),"\n",(0,l.jsx)(e.p,{children:"\u9759\u7684SQL\u3067\u306f\u5bfe\u5fdc\u3067\u304d\u306a\u3044\u3001\u5b9f\u884c\u6642\u306b\u6c7a\u307e\u308b\u30c6\u30fc\u30d6\u30eb\u540d\u3084\u30ab\u30e9\u30e0\u540d\u3092\u6271\u3046\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION get_table_count(p_table_name TEXT)\nRETURNS BIGINT AS $$\nDECLARE\n    v_count BIGINT;\nBEGIN\n    -- \u52d5\u7684\u306b\u30c6\u30fc\u30d6\u30eb\u540d\u3092\u6307\u5b9a\n    EXECUTE format('SELECT COUNT(*) FROM %I', p_table_name)\n    INTO v_count;\n\n    RETURN v_count;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u4f7f\u7528\u4f8b\nSELECT get_table_count('users');\nSELECT get_table_count('orders');\n"})}),"\n",(0,l.jsx)(e.h3,{id:"12-format\u95a2\u6570\u306b\u3088\u308b\u5b89\u5168\u306a\u30af\u30a8\u30ea\u69cb\u7bc9",children:"1.2 format()\u95a2\u6570\u306b\u3088\u308b\u5b89\u5168\u306a\u30af\u30a8\u30ea\u69cb\u7bc9"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u7d76\u5bfe\u306b\u5b88\u308b\u3079\u304d\u30eb\u30fc\u30eb"}),": SQL\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5bfe\u7b56"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u274c \u5371\u967a: SQL\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u306e\u8106\u5f31\u6027\nCREATE OR REPLACE FUNCTION unsafe_query(p_table_name TEXT)\nRETURNS BIGINT AS $$\nDECLARE\n    v_count BIGINT;\nBEGIN\n    -- \u3053\u308c\u306f\u5371\u967a\uff01 p_table_name\u306b \"users; DROP TABLE users; --\" \u304c\u6e21\u3055\u308c\u308b\u53ef\u80fd\u6027\n    EXECUTE 'SELECT COUNT(*) FROM ' || p_table_name INTO v_count;\n    RETURN v_count;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u2705 \u5b89\u5168: format()\u95a2\u6570\u3068\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u3092\u4f7f\u7528\nCREATE OR REPLACE FUNCTION safe_query(p_table_name TEXT)\nRETURNS BIGINT AS $$\nDECLARE\n    v_count BIGINT;\nBEGIN\n    -- %I: \u8b58\u5225\u5b50\uff08\u30c6\u30fc\u30d6\u30eb\u540d\u3001\u30ab\u30e9\u30e0\u540d\uff09\u3092\u5b89\u5168\u306b\u30a8\u30b9\u30b1\u30fc\u30d7\n    EXECUTE format('SELECT COUNT(*) FROM %I', p_table_name)\n    INTO v_count;\n\n    RETURN v_count;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"format()\u306e\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc"}),":"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc"}),(0,l.jsx)(e.th,{children:"\u7528\u9014"}),(0,l.jsx)(e.th,{children:"\u30a8\u30b9\u30b1\u30fc\u30d7"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"%I"})}),(0,l.jsx)(e.td,{children:"\u8b58\u5225\u5b50\uff08\u30c6\u30fc\u30d6\u30eb\u540d\u3001\u30ab\u30e9\u30e0\u540d\uff09"}),(0,l.jsx)(e.td,{children:"\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u3080"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"%L"})}),(0,l.jsx)(e.td,{children:"\u30ea\u30c6\u30e9\u30eb\uff08\u6587\u5b57\u5217\u3001\u6570\u5024\uff09"}),(0,l.jsx)(e.td,{children:"\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u3080"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"%s"})}),(0,l.jsx)(e.td,{children:"\u6587\u5b57\u5217\uff08\u30a8\u30b9\u30b1\u30fc\u30d7\u306a\u3057\uff09"}),(0,l.jsx)(e.td,{children:"\u305d\u306e\u307e\u307e\u57cb\u3081\u8fbc\u307f\uff08\u5371\u967a\uff09"})]})]})]}),"\n",(0,l.jsx)(e.h3,{id:"13-\u5b9f\u8df5\u4f8b-\u52d5\u7684where\u53e5",children:"1.3 \u5b9f\u8df5\u4f8b: \u52d5\u7684WHERE\u53e5"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION search_users(\n    p_name TEXT DEFAULT NULL,\n    p_department_id INTEGER DEFAULT NULL,\n    p_email_pattern TEXT DEFAULT NULL\n) RETURNS TABLE (\n    id INTEGER,\n    name TEXT,\n    email TEXT\n) AS $$\nDECLARE\n    v_sql TEXT;\n    v_where_clauses TEXT[] := ARRAY[]::TEXT[];\nBEGIN\n    v_sql := 'SELECT id, name, email FROM users';\n\n    -- \u52d5\u7684\u306bWHERE\u53e5\u3092\u69cb\u7bc9\n    IF p_name IS NOT NULL THEN\n        v_where_clauses := array_append(v_where_clauses, format('name = %L', p_name));\n    END IF;\n\n    IF p_department_id IS NOT NULL THEN\n        v_where_clauses := array_append(v_where_clauses, format('department_id = %L', p_department_id));\n    END IF;\n\n    IF p_email_pattern IS NOT NULL THEN\n        v_where_clauses := array_append(v_where_clauses, format('email LIKE %L', p_email_pattern));\n    END IF;\n\n    -- WHERE\u53e5\u3092\u7d50\u5408\n    IF array_length(v_where_clauses, 1) > 0 THEN\n        v_sql := v_sql || ' WHERE ' || array_to_string(v_where_clauses, ' AND ');\n    END IF;\n\n    RAISE NOTICE 'Executing SQL: %', v_sql;\n\n    RETURN QUERY EXECUTE v_sql;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u4f7f\u7528\u4f8b\nSELECT * FROM search_users(p_name := 'Alice');\nSELECT * FROM search_users(p_department_id := 2, p_email_pattern := '%@example.com');\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"2-\u30c8\u30ea\u30ac\u30fc",children:"2. \u30c8\u30ea\u30ac\u30fc"}),"\n",(0,l.jsx)(e.h3,{id:"21-\u30c8\u30ea\u30ac\u30fc\u3068\u306f",children:"2.1 \u30c8\u30ea\u30ac\u30fc\u3068\u306f"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u30c8\u30ea\u30ac\u30fc"}),"\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\uff08INSERT\u3001UPDATE\u3001DELETE\uff09\u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306b\u3001\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3055\u308c\u308b\u95a2\u6570\u3067\u3059\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   \u30c8\u30ea\u30ac\u30fc\u306e\u5b9f\u884c\u30bf\u30a4\u30df\u30f3\u30b0                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  BEFORE                  AFTER                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\n\u2502  \u2502       \u2502              \u2502       \u2502                      \u2502\n\u2502  \u2502 \u691c\u8a3c  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 \u30ed\u30b0  \u2502                      \u2502\n\u2502  \u2502 \u5909\u66f4  \u2502  \u5b9f\u969b\u306e\u64cd\u4f5c  \u2502 \u901a\u77e5  \u2502                      \u2502\n\u2502  \u2502       \u2502              \u2502       \u2502                      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502\n\u2502                                                         \u2502\n\u2502  - \u30c7\u30fc\u30bf\u691c\u8a3c            - \u76e3\u67fb\u30ed\u30b0\u8a18\u9332                  \u2502\n\u2502  - \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u8a2d\u5b9a      - \u95a2\u9023\u30c7\u30fc\u30bf\u66f4\u65b0                \u2502\n\u2502  - \u30c7\u30fc\u30bf\u5909\u66f4            - \u901a\u77e5\u9001\u4fe1                      \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u30c8\u30ea\u30ac\u30fc\u306e\u7a2e\u985e"}),":"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u30bf\u30a4\u30df\u30f3\u30b0"}),(0,l.jsx)(e.th,{children:"\u8aac\u660e"}),(0,l.jsx)(e.th,{children:"\u7528\u9014"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"BEFORE"})}),(0,l.jsx)(e.td,{children:"\u30c7\u30fc\u30bf\u5909\u66f4\u524d\u306b\u5b9f\u884c"}),(0,l.jsx)(e.td,{children:"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3001\u5024\u306e\u81ea\u52d5\u8a2d\u5b9a"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"AFTER"})}),(0,l.jsx)(e.td,{children:"\u30c7\u30fc\u30bf\u5909\u66f4\u5f8c\u306b\u5b9f\u884c"}),(0,l.jsx)(e.td,{children:"\u30ed\u30b0\u8a18\u9332\u3001\u95a2\u9023\u30c6\u30fc\u30d6\u30eb\u66f4\u65b0"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"INSTEAD OF"})}),(0,l.jsx)(e.td,{children:"\u30d3\u30e5\u30fc\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u306e\u4ee3\u66ff"}),(0,l.jsx)(e.td,{children:"\u30d3\u30e5\u30fc\u306e\u66f4\u65b0\u53ef\u80fd\u5316"})]})]})]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u5b9f\u884c\u5358\u4f4d"}),":"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7a2e\u985e"}),(0,l.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"FOR EACH ROW"})}),(0,l.jsx)(e.td,{children:"\u5f71\u97ff\u3092\u53d7\u3051\u308b\u884c\u3054\u3068\u306b\u5b9f\u884c"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"FOR EACH STATEMENT"})}),(0,l.jsx)(e.td,{children:"SQL\u6587\u3054\u3068\u306b1\u56de\u5b9f\u884c"})]})]})]}),"\n",(0,l.jsx)(e.h3,{id:"22-\u30c8\u30ea\u30ac\u30fc\u95a2\u6570\u306e\u4f5c\u6210",children:"2.2 \u30c8\u30ea\u30ac\u30fc\u95a2\u6570\u306e\u4f5c\u6210"}),"\n",(0,l.jsxs)(e.p,{children:["\u30c8\u30ea\u30ac\u30fc\u95a2\u6570\u306f",(0,l.jsx)(e.code,{children:"RETURNS TRIGGER"}),"\u3092\u6307\u5b9a\u3057\u3001\u7279\u5225\u306a\u5909\u6570",(0,l.jsx)(e.code,{children:"NEW"}),"\u3068",(0,l.jsx)(e.code,{children:"OLD"}),"\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION trigger_function_name()\nRETURNS TRIGGER AS $$\nBEGIN\n    -- NEW: \u65b0\u3057\u3044\u884c\u30c7\u30fc\u30bf (INSERT, UPDATE)\n    -- OLD: \u53e4\u3044\u884c\u30c7\u30fc\u30bf (UPDATE, DELETE)\n\n    -- BEFORE TRIGGER\u3067NEW\u3092\u5909\u66f4\u53ef\u80fd\n    -- AFTER TRIGGER\u3067NEW\u3092\u5909\u66f4\u3057\u3066\u3082\u53cd\u6620\u3055\u308c\u306a\u3044\n\n    RETURN NEW;  -- \u307e\u305f\u306f RETURN OLD\u3001RETURN NULL\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u30c8\u30ea\u30ac\u30fc\u306e\u4f5c\u6210\nCREATE TRIGGER trigger_name\n    BEFORE INSERT OR UPDATE OR DELETE ON table_name\n    FOR EACH ROW\n    EXECUTE FUNCTION trigger_function_name();\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"NEW/OLD\u306e\u5229\u7528\u53ef\u80fd\u6027"}),":"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u64cd\u4f5c"}),(0,l.jsx)(e.th,{children:"NEW"}),(0,l.jsx)(e.th,{children:"OLD"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"INSERT"}),(0,l.jsx)(e.td,{children:"\u2705"}),(0,l.jsx)(e.td,{children:"\u274c"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"UPDATE"}),(0,l.jsx)(e.td,{children:"\u2705"}),(0,l.jsx)(e.td,{children:"\u2705"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"DELETE"}),(0,l.jsx)(e.td,{children:"\u274c"}),(0,l.jsx)(e.td,{children:"\u2705"})]})]})]}),"\n",(0,l.jsx)(e.h3,{id:"23-create-trigger\u306e\u6587\u6cd5\u8a73\u7d30",children:"2.3 CREATE TRIGGER\u306e\u6587\u6cd5\u8a73\u7d30"}),"\n",(0,l.jsx)(e.h4,{id:"\u57fa\u672c\u69cb\u6587",children:"\u57fa\u672c\u69cb\u6587"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE TRIGGER trigger_name\n    { BEFORE | AFTER | INSTEAD OF } { event [ OR ... ] }\n    ON table_name\n    [ FOR [ EACH ] { ROW | STATEMENT } ]\n    [ WHEN ( condition ) ]\n    EXECUTE FUNCTION function_name ( arguments )\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u5404\u8981\u7d20\u306e\u8aac\u660e",children:"\u5404\u8981\u7d20\u306e\u8aac\u660e"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u30bf\u30a4\u30df\u30f3\u30b0 (Timing)"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"BEFORE   -- \u30c7\u30fc\u30bf\u5909\u66f4\u306e\u524d\u306b\u5b9f\u884c\nAFTER    -- \u30c7\u30fc\u30bf\u5909\u66f4\u306e\u5f8c\u306b\u5b9f\u884c\nINSTEAD OF  -- \u30d3\u30e5\u30fc\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u3092\u7f6e\u304d\u63db\u3048\uff08\u30d3\u30e5\u30fc\u5c02\u7528\uff09\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u30a4\u30d9\u30f3\u30c8 (Event)"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"INSERT           -- INSERT\u6642\u306e\u307f\nUPDATE           -- UPDATE\u6642\u306e\u307f\nDELETE           -- DELETE\u6642\u306e\u307f\nINSERT OR UPDATE -- INSERT \u307e\u305f\u306f UPDATE\u6642\nUPDATE OR DELETE -- UPDATE \u307e\u305f\u306f DELETE\u6642\nINSERT OR UPDATE OR DELETE  -- \u3059\u3079\u3066\u306e\u5909\u66f4\u6642\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u7279\u5b9a\u30ab\u30e9\u30e0\u306e\u66f4\u65b0\u6642\u306e\u307f\uff08UPDATE\u5c02\u7528\uff09"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE TRIGGER trigger_name\n    BEFORE UPDATE OF email, name ON users  -- email\u307e\u305f\u306fname\u304c\u66f4\u65b0\u3055\u308c\u305f\u6642\u306e\u307f\n    FOR EACH ROW\n    EXECUTE FUNCTION trigger_function();\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u5b9f\u884c\u5358\u4f4d (Level)"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"FOR EACH ROW        -- \u5f71\u97ff\u3092\u53d7\u3051\u308b\u884c\u3054\u3068\u306b\u5b9f\u884c\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\nFOR EACH STATEMENT  -- SQL\u6587\u3054\u3068\u306b1\u56de\u5b9f\u884c\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u5177\u4f53\u4f8b\u3067\u7406\u89e3\u3059\u308b"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:'-- \u4ee5\u4e0b\u306eUPDATE\u6587\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\nUPDATE users SET status = \'active\' WHERE department_id = 1;\n-- \u7d50\u679c: 100\u884c\u304c\u66f4\u65b0\u3055\u308c\u305f\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         FOR EACH ROW vs FOR EACH STATEMENT                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  \u3010FOR EACH ROW\u3011                                           \u2502\n\u2502  \u5f71\u97ff\u3092\u53d7\u3051\u305f "\u5404\u884c" \u306b\u5bfe\u3057\u3066\u5b9f\u884c                            \u2502\n\u2502                                                             \u2502\n\u2502  UPDATE\u5b9f\u884c \u2192 100\u884c\u66f4\u65b0                                     \u2502\n\u2502     \u251c\u2500 \u30c8\u30ea\u30ac\u30fc\u5b9f\u884c (1\u884c\u76ee) \u2192 NEW/OLD\u4f7f\u7528\u53ef\u80fd              \u2502\n\u2502     \u251c\u2500 \u30c8\u30ea\u30ac\u30fc\u5b9f\u884c (2\u884c\u76ee) \u2192 NEW/OLD\u4f7f\u7528\u53ef\u80fd              \u2502\n\u2502     \u251c\u2500 ...                                                  \u2502\n\u2502     \u2514\u2500 \u30c8\u30ea\u30ac\u30fc\u5b9f\u884c (100\u884c\u76ee) \u2192 NEW/OLD\u4f7f\u7528\u53ef\u80fd            \u2502\n\u2502                                                             \u2502\n\u2502  \u5408\u8a08: 100\u56de\u5b9f\u884c                                             \u2502\n\u2502  \u7528\u9014: \u5404\u884c\u306e\u30c7\u30fc\u30bf\u3092\u53c2\u7167\u30fb\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u51e6\u7406             \u2502\n\u2502       \uff08\u76e3\u67fb\u30ed\u30b0\u3001\u30c7\u30fc\u30bf\u691c\u8a3c\u3001\u95a2\u9023\u30c6\u30fc\u30d6\u30eb\u66f4\u65b0\uff09              \u2502\n\u2502                                                             \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n\u2502                                                             \u2502\n\u2502  \u3010FOR EACH STATEMENT\u3011                                     \u2502\n\u2502  SQL\u6587\u5168\u4f53\u306b\u5bfe\u3057\u3066 "1\u56de\u3060\u3051" \u5b9f\u884c                            \u2502\n\u2502                                                             \u2502\n\u2502  UPDATE\u5b9f\u884c \u2192 100\u884c\u66f4\u65b0                                     \u2502\n\u2502     \u2514\u2500 \u30c8\u30ea\u30ac\u30fc\u5b9f\u884c (1\u56de\u306e\u307f) \u2192 NEW/OLD\u306f\u4f7f\u7528\u4e0d\u53ef          \u2502\n\u2502                                                             \u2502\n\u2502  \u5408\u8a08: 1\u56de\u5b9f\u884c                                               \u2502\n\u2502  \u7528\u9014: \u884c\u306e\u5185\u5bb9\u306b\u95a2\u4fc2\u306a\u3044\u51e6\u7406                                \u2502\n\u2502       \uff08\u901a\u77e5\u9001\u4fe1\u3001\u7d71\u8a08\u66f4\u65b0\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u30af\u30ea\u30a2\uff09                \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u30b3\u30fc\u30c9\u4f8b"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- FOR EACH ROW: \u5404\u884c\u306e\u76e3\u67fb\u30ed\u30b0\u3092\u8a18\u9332\nCREATE OR REPLACE FUNCTION audit_each_row()\nRETURNS TRIGGER AS $$\nBEGIN\n    -- \u5404\u884c\u306e\u30c7\u30fc\u30bf\u3092\u8a18\u9332\u3067\u304d\u308b\n    INSERT INTO audit_log (table_name, operation, user_id, changed_data)\n    VALUES (TG_TABLE_NAME, TG_OP, NEW.id, row_to_json(NEW));\n\n    RAISE NOTICE 'Audited user_id=%', NEW.id;  -- 100\u56de\u8868\u793a\u3055\u308c\u308b\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER users_audit_row\n    AFTER UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION audit_each_row();\n\n-- FOR EACH STATEMENT: \u300c\u4f55\u304b\u66f4\u65b0\u3055\u308c\u305f\u300d\u3068\u3044\u3046\u4e8b\u5b9f\u3060\u3051\u3092\u8a18\u9332\nCREATE OR REPLACE FUNCTION notify_table_updated()\nRETURNS TRIGGER AS $$\nBEGIN\n    -- NEW/OLD\u306f\u4f7f\u3048\u306a\u3044\uff01\n    -- \u4f55\u884c\u304c\u66f4\u65b0\u3055\u308c\u305f\u304b\u306f\u5206\u304b\u3089\u306a\u3044\n\n    INSERT INTO system_notifications (message)\n    VALUES (format('Table % was modified by %', TG_TABLE_NAME, TG_OP));\n\n    RAISE NOTICE 'Users table was updated';  -- 1\u56de\u3060\u3051\u8868\u793a\u3055\u308c\u308b\n    RETURN NULL;  -- STATEMENT\u30ec\u30d9\u30eb\u3067\u306f\u5e38\u306bNULL\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER users_notify_statement\n    AFTER UPDATE ON users\n    FOR EACH STATEMENT\n    EXECUTE FUNCTION notify_table_updated();\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u9055\u3044"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- 1,000\u884c\u3092\u66f4\u65b0\u3059\u308b\u5834\u5408\n\n-- FOR EACH ROW: 1,000\u56de\u306e\u30c8\u30ea\u30ac\u30fc\u5b9f\u884c\n--   \u2192 \u5404\u884c\u306e\u51e6\u7406\u304c\u91cd\u3044\u3068\u9045\u304f\u306a\u308b\n\n-- FOR EACH STATEMENT: 1\u56de\u306e\u30c8\u30ea\u30ac\u30fc\u5b9f\u884c\n--   \u2192 \u884c\u6570\u306b\u95a2\u4fc2\u306a\u304f\u9ad8\u901f\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u3069\u3061\u3089\u3092\u4f7f\u3046\u3079\u304d\u304b"}),":"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u30b1\u30fc\u30b9"}),(0,l.jsx)(e.th,{children:"\u63a8\u5968"}),(0,l.jsx)(e.th,{children:"\u7406\u7531"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5404\u884c\u306e\u30c7\u30fc\u30bf\u304c\u5fc5\u8981"}),(0,l.jsx)(e.td,{children:"FOR EACH ROW"}),(0,l.jsx)(e.td,{children:"NEW/OLD\u3067\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u53ef\u80fd"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u884c\u6570\u304c\u591a\u3044 & \u91cd\u3044\u51e6\u7406"}),(0,l.jsx)(e.td,{children:"FOR EACH STATEMENT"}),(0,l.jsx)(e.td,{children:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u5411\u4e0a"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u901a\u77e5\u30fb\u7d71\u8a08\u66f4\u65b0\u306e\u307f"}),(0,l.jsx)(e.td,{children:"FOR EACH STATEMENT"}),(0,l.jsx)(e.td,{children:"\u884c\u306e\u5185\u5bb9\u306f\u4e0d\u8981"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u76e3\u67fb\u30ed\u30b0\uff08\u5168\u884c\u8a18\u9332\uff09"}),(0,l.jsx)(e.td,{children:"FOR EACH ROW"}),(0,l.jsx)(e.td,{children:"\u5404\u884c\u306e\u5909\u66f4\u5c65\u6b74\u304c\u5fc5\u8981"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u6761\u4ef6 (WHEN\u53e5) - PostgreSQL 9.0+"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u7279\u5b9a\u306e\u6761\u4ef6\u3092\u6e80\u305f\u3059\u5834\u5408\u306e\u307f\u30c8\u30ea\u30ac\u30fc\u5b9f\u884c\nCREATE TRIGGER trigger_name\n    AFTER UPDATE ON users\n    FOR EACH ROW\n    WHEN (OLD.status IS DISTINCT FROM NEW.status)  -- status\u304c\u5b9f\u969b\u306b\u5909\u308f\u3063\u305f\u6642\u306e\u307f\n    EXECUTE FUNCTION log_status_change();\n\n-- \u8907\u6570\u6761\u4ef6\nCREATE TRIGGER trigger_name\n    BEFORE INSERT OR UPDATE ON users\n    FOR EACH ROW\n    WHEN (NEW.email IS NOT NULL AND NEW.email != '')\n    EXECUTE FUNCTION validate_email();\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"WHEN\u53e5\u306e\u5236\u7d04"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"OLD"}),"\u3068",(0,l.jsx)(e.code,{children:"NEW"}),"\u306e\u307f\u53c2\u7167\u53ef\u80fd\uff08\u30c6\u30fc\u30d6\u30eb\u30a2\u30af\u30bb\u30b9\u4e0d\u53ef\uff09"]}),"\n",(0,l.jsx)(e.li,{children:"BEFORE TRIGGER\u3067\u306fNEW\u306e\u5909\u66f4\u524d\u306e\u5024\u3092\u53c2\u7167"}),"\n",(0,l.jsx)(e.li,{children:"\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u4f7f\u7528\u4e0d\u53ef"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u5b9f\u884c\u95a2\u6570\u3068\u30d1\u30e9\u30e1\u30fc\u30bf"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30d1\u30e9\u30e1\u30fc\u30bf\u306a\u3057\uff08\u6700\u3082\u4e00\u822c\u7684\uff09\nEXECUTE FUNCTION my_trigger_function()\n\n-- \u30d1\u30e9\u30e1\u30fc\u30bf\u3042\u308a\uff08\u6587\u5b57\u5217\u306e\u307f\uff09\nEXECUTE FUNCTION my_trigger_function('param1', 'param2')\n\n-- \u30c8\u30ea\u30ac\u30fc\u95a2\u6570\u5185\u3067\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u53d6\u5f97\nCREATE OR REPLACE FUNCTION my_trigger_function()\nRETURNS TRIGGER AS $$\nBEGIN\n    RAISE NOTICE 'Trigger args: %, %', TG_ARGV[0], TG_ARGV[1];\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u30c8\u30ea\u30ac\u30fc\u547d\u540d\u898f\u5247",children:"\u30c8\u30ea\u30ac\u30fc\u547d\u540d\u898f\u5247"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u63a8\u5968\u547d\u540d\u30d1\u30bf\u30fc\u30f3: {table}_{event}_{timing}\nCREATE TRIGGER users_audit_after\n    AFTER INSERT OR UPDATE OR DELETE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION audit_trigger();\n\nCREATE TRIGGER users_validate_before\n    BEFORE INSERT OR UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION validate_user_data();\n\nCREATE TRIGGER orders_email_updated\n    AFTER UPDATE OF email ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION notify_email_changed();\n"})}),"\n",(0,l.jsx)(e.h4,{id:"return\u306e\u610f\u5473",children:"RETURN\u306e\u610f\u5473"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u30c8\u30ea\u30ac\u30fc\u7a2e\u985e"}),(0,l.jsx)(e.th,{children:"RETURN\u5024"}),(0,l.jsx)(e.th,{children:"\u52d5\u4f5c"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"BEFORE ROW"})}),(0,l.jsx)(e.td,{children:"NEW"}),(0,l.jsx)(e.td,{children:"NEW\u306e\u5185\u5bb9\u3067\u66f4\u65b0\u304c\u5b9f\u884c\u3055\u308c\u308b"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"BEFORE ROW"})}),(0,l.jsx)(e.td,{children:"OLD"}),(0,l.jsx)(e.td,{children:"\u5143\u306e\u5024\u3067\u66f4\u65b0\uff08NEW\u306e\u5909\u66f4\u3092\u7121\u8996\uff09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"BEFORE ROW"})}),(0,l.jsx)(e.td,{children:"NULL"}),(0,l.jsx)(e.td,{children:"\u64cd\u4f5c\u3092\u30ad\u30e3\u30f3\u30bb\u30eb\uff08\u884c\u304c\u633f\u5165/\u66f4\u65b0/\u524a\u9664\u3055\u308c\u306a\u3044\uff09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"AFTER ROW"})}),(0,l.jsx)(e.td,{children:"\u4efb\u610f"}),(0,l.jsx)(e.td,{children:"\u623b\u308a\u5024\u306f\u7121\u8996\u3055\u308c\u308b\uff08\u901a\u5e38\u306fNEW\u3092\u8fd4\u3059\uff09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"STATEMENT"})}),(0,l.jsx)(e.td,{children:"NULL"}),(0,l.jsx)(e.td,{children:"\u5e38\u306bNULL\u3092\u8fd4\u3059\uff08NEW/OLD\u306f\u4f7f\u7528\u4e0d\u53ef\uff09"})]})]})]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"RETURN NULL\u306e\u6d3b\u7528\u4f8b"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u7279\u5b9a\u6761\u4ef6\u3067INSERT\u3092\u30b9\u30ad\u30c3\u30d7\nCREATE OR REPLACE FUNCTION skip_invalid_users()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF NEW.email IS NULL OR NEW.email = '' THEN\n        RAISE NOTICE 'Skipping user with invalid email';\n        RETURN NULL;  -- \u3053\u306e\u884c\u306f\u633f\u5165\u3055\u308c\u306a\u3044\n    END IF;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER users_skip_invalid\n    BEFORE INSERT ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION skip_invalid_users();\n"})}),"\n",(0,l.jsx)(e.h3,{id:"24-\u5b9f\u8df5\u4f8b1-updated_at\u81ea\u52d5\u66f4\u65b0",children:"2.4 \u5b9f\u8df5\u4f8b1: updated_at\u81ea\u52d5\u66f4\u65b0"}),"\n",(0,l.jsx)(e.p,{children:"\u6700\u3082\u4e00\u822c\u7684\u306a\u4f7f\u7528\u4f8b\u3067\u3059\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30c8\u30ea\u30ac\u30fc\u95a2\u6570: updated_at\u3092\u81ea\u52d5\u66f4\u65b0\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = now();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- users\u30c6\u30fc\u30d6\u30eb\u306b\u30c8\u30ea\u30ac\u30fc\u3092\u8a2d\u5b9a\nCREATE TRIGGER update_users_updated_at\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- \u30c6\u30b9\u30c8\nUPDATE users SET name = 'Alice Updated' WHERE id = 1;\nSELECT id, name, updated_at FROM users WHERE id = 1;\n-- updated_at\u304c\u81ea\u52d5\u66f4\u65b0\u3055\u308c\u308b\n"})}),"\n",(0,l.jsx)(e.h3,{id:"25-\u5b9f\u8df5\u4f8b2-\u76e3\u67fb\u30ed\u30b0\u306e\u8a18\u9332",children:"2.5 \u5b9f\u8df5\u4f8b2: \u76e3\u67fb\u30ed\u30b0\u306e\u8a18\u9332"}),"\n",(0,l.jsx)(e.p,{children:"\u30c7\u30fc\u30bf\u5909\u66f4\u5c65\u6b74\u3092\u81ea\u52d5\u7684\u306b\u8a18\u9332\u3057\u307e\u3059\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u76e3\u67fb\u30ed\u30b0\u30c6\u30fc\u30d6\u30eb\nCREATE TABLE audit_log (\n    id SERIAL PRIMARY KEY,\n    table_name TEXT NOT NULL,\n    operation TEXT NOT NULL,  -- INSERT, UPDATE, DELETE\n    old_data JSONB,\n    new_data JSONB,\n    changed_by TEXT DEFAULT CURRENT_USER,\n    changed_at TIMESTAMP DEFAULT now()\n);\n\n-- \u76e3\u67fb\u30ed\u30b0\u30c8\u30ea\u30ac\u30fc\u95a2\u6570\nCREATE OR REPLACE FUNCTION audit_trigger()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF TG_OP = 'DELETE' THEN\n        INSERT INTO audit_log (table_name, operation, old_data)\n        VALUES (TG_TABLE_NAME, TG_OP, row_to_json(OLD));\n        RETURN OLD;\n    ELSIF TG_OP = 'UPDATE' THEN\n        INSERT INTO audit_log (table_name, operation, old_data, new_data)\n        VALUES (TG_TABLE_NAME, TG_OP, row_to_json(OLD), row_to_json(NEW));\n        RETURN NEW;\n    ELSIF TG_OP = 'INSERT' THEN\n        INSERT INTO audit_log (table_name, operation, new_data)\n        VALUES (TG_TABLE_NAME, TG_OP, row_to_json(NEW));\n        RETURN NEW;\n    END IF;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- users\u30c6\u30fc\u30d6\u30eb\u306b\u9069\u7528\nCREATE TRIGGER users_audit_trigger\n    AFTER INSERT OR UPDATE OR DELETE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION audit_trigger();\n\n-- \u30c6\u30b9\u30c8\nINSERT INTO users (name, email) VALUES ('Bob', 'bob@example.com');\nUPDATE users SET email = 'bob.new@example.com' WHERE name = 'Bob';\nDELETE FROM users WHERE name = 'Bob';\n\n-- \u76e3\u67fb\u30ed\u30b0\u78ba\u8a8d\nSELECT * FROM audit_log ORDER BY changed_at DESC;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"26-\u5b9f\u8df5\u4f8b3-\u30c7\u30fc\u30bf\u691c\u8a3c",children:"2.6 \u5b9f\u8df5\u4f8b3: \u30c7\u30fc\u30bf\u691c\u8a3c"}),"\n",(0,l.jsx)(e.p,{children:"BEFORE TRIGGER\u3067\u30c7\u30fc\u30bf\u3092\u691c\u8a3c\u3057\u3001\u4e0d\u6b63\u306a\u30c7\u30fc\u30bf\u306e\u633f\u5165\u3092\u9632\u304e\u307e\u3059\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION validate_email_trigger()\nRETURNS TRIGGER AS $$\nBEGIN\n    -- \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u5f62\u5f0f\u30c1\u30a7\u30c3\u30af\n    IF NEW.email IS NULL OR NEW.email = '' THEN\n        RAISE EXCEPTION 'Email cannot be empty';\n    END IF;\n\n    IF NEW.email !~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}$' THEN\n        RAISE EXCEPTION 'Invalid email format: %', NEW.email;\n    END IF;\n\n    -- \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5c0f\u6587\u5b57\u306b\u6b63\u898f\u5316\n    NEW.email = lower(NEW.email);\n\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER validate_user_email\n    BEFORE INSERT OR UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION validate_email_trigger();\n\n-- \u30c6\u30b9\u30c8\nINSERT INTO users (name, email) VALUES ('Test', 'INVALID_EMAIL');  -- \u30a8\u30e9\u30fc\nINSERT INTO users (name, email) VALUES ('Test', 'Test@Example.COM');  -- test@example.com \u306b\u6b63\u898f\u5316\n"})}),"\n",(0,l.jsx)(e.h3,{id:"27-\u30c8\u30ea\u30ac\u30fc\u7279\u6b8a\u5909\u6570",children:"2.7 \u30c8\u30ea\u30ac\u30fc\u7279\u6b8a\u5909\u6570"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u30c8\u30ea\u30ac\u30fc\u7279\u6b8a\u5909\u6570"}),":"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u5909\u6570"}),(0,l.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"NEW"})}),(0,l.jsx)(e.td,{children:"\u65b0\u3057\u3044\u884c\uff08INSERT/UPDATE\uff09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"OLD"})}),(0,l.jsx)(e.td,{children:"\u53e4\u3044\u884c\uff08UPDATE/DELETE\uff09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"TG_OP"})}),(0,l.jsx)(e.td,{children:"\u64cd\u4f5c\u7a2e\u5225\uff08'INSERT', 'UPDATE', 'DELETE'\uff09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"TG_TABLE_NAME"})}),(0,l.jsx)(e.td,{children:"\u30c6\u30fc\u30d6\u30eb\u540d"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"TG_TABLE_SCHEMA"})}),(0,l.jsx)(e.td,{children:"\u30b9\u30ad\u30fc\u30de\u540d"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"TG_WHEN"})}),(0,l.jsx)(e.td,{children:"'BEFORE' or 'AFTER'"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"TG_LEVEL"})}),(0,l.jsx)(e.td,{children:"'ROW' or 'STATEMENT'"})]})]})]}),"\n",(0,l.jsx)(e.h3,{id:"28-\u30c8\u30ea\u30ac\u30fc\u306e\u7ba1\u7406",children:"2.8 \u30c8\u30ea\u30ac\u30fc\u306e\u7ba1\u7406"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30c8\u30ea\u30ac\u30fc\u4e00\u89a7\u8868\u793a\nSELECT\n    trigger_name,\n    event_manipulation,\n    event_object_table,\n    action_statement\nFROM information_schema.triggers\nWHERE trigger_schema = 'public'\nORDER BY event_object_table, trigger_name;\n\n-- \u30c8\u30ea\u30ac\u30fc\u306e\u524a\u9664\nDROP TRIGGER IF EXISTS trigger_name ON table_name;\n\n-- \u30c8\u30ea\u30ac\u30fc\u306e\u7121\u52b9\u5316\uff08PostgreSQL 14+\uff09\nALTER TABLE table_name DISABLE TRIGGER trigger_name;\n\n-- \u30c8\u30ea\u30ac\u30fc\u306e\u6709\u52b9\u5316\nALTER TABLE table_name ENABLE TRIGGER trigger_name;\n\n-- \u3059\u3079\u3066\u306e\u30c8\u30ea\u30ac\u30fc\u3092\u7121\u52b9\u5316\nALTER TABLE table_name DISABLE TRIGGER ALL;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"29-\u30c8\u30ea\u30ac\u30fc\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"2.9 \u30c8\u30ea\u30ac\u30fc\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u63a8\u5968"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u2705 \u30c8\u30ea\u30ac\u30fc\u306f\u30b7\u30f3\u30d7\u30eb\u306b\u4fdd\u3064"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u8907\u96d1\u306a\u30ed\u30b8\u30c3\u30af\u306f\u95a2\u6570\u306b\u5206\u96e2"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 BEFORE TRIGGER\u3067\u30c7\u30fc\u30bf\u691c\u8a3c\u30fb\u5909\u66f4"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 AFTER TRIGGER\u3067\u30ed\u30b0\u30fb\u901a\u77e5"}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 \u30c8\u30ea\u30ac\u30fc\u540d\u306f",(0,l.jsx)(e.code,{children:"{table}_{event}_{timing}"}),"\u5f62\u5f0f\uff08\u4f8b: ",(0,l.jsx)(e.code,{children:"users_audit_after"}),"\uff09"]}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u975e\u63a8\u5968"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u274c \u30c8\u30ea\u30ac\u30fc\u5185\u3067\u30c8\u30ea\u30ac\u30fc\u3092\u9023\u9396\u3055\u305b\u308b\uff08\u30c7\u30d0\u30c3\u30b0\u304c\u56f0\u96e3\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u274c \u30c8\u30ea\u30ac\u30fc\u5185\u3067\u9577\u6642\u9593\u51e6\u7406\uff08\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u4f4e\u4e0b\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u274c BEFORE TRIGGER\u3067AFTER\u3067\u3084\u308b\u3079\u304d\u51e6\u7406\uff08\u30ed\u30b0\u8a18\u9332\u7b49\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u274c \u30c8\u30ea\u30ac\u30fc\u5185\u3067\u4f8b\u5916\u3092\u6295\u3052\u3059\u304e\u308b\uff08\u901a\u5e38\u306e\u64cd\u4f5c\u304c\u5931\u6557\u3059\u308b\uff09"}),"\n"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"3-\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1",children:"3. \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1"}),"\n",(0,l.jsx)(e.h3,{id:"31-\u95a2\u6570\u5185\u3067\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u52d5\u4f5c",children:"3.1 \u95a2\u6570\u5185\u3067\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u52d5\u4f5c"}),"\n",(0,l.jsxs)(e.p,{children:["PL/pgSQL\u95a2\u6570\u306f",(0,l.jsx)(e.strong,{children:"\u65e2\u5b58\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5185\u3067\u5b9f\u884c"}),"\u3055\u308c\u307e\u3059\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3                         \u2502\n\u2502  BEGIN;                                            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502    \u2502 PL/pgSQL\u95a2\u6570\u306e\u5b9f\u884c                   \u2502       \u2502\n\u2502    \u2502   - \u8907\u6570\u306eSQL\u6587                      \u2502       \u2502\n\u2502    \u2502   - EXCEPTION\u3067\u90e8\u5206\u30ed\u30fc\u30eb\u30d0\u30c3\u30af      \u2502       \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502  COMMIT; (\u5168\u4f53\u304c\u78ba\u5b9a)                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u95a2\u6570\u5185\u3067",(0,l.jsx)(e.code,{children:"COMMIT"}),"/",(0,l.jsx)(e.code,{children:"ROLLBACK"}),"\u306f\u5b9f\u884c\u3067\u304d\u306a\u3044\uff08PostgreSQL 11\u672a\u6e80\uff09"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"EXCEPTION"}),"\u53e5\u3067\u30ad\u30e3\u30c3\u30c1\u3055\u308c\u305f\u30a8\u30e9\u30fc\u306f",(0,l.jsx)(e.strong,{children:"\u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3"}),"\u3067\u30ed\u30fc\u30eb\u30d0\u30c3\u30af"]}),"\n",(0,l.jsx)(e.li,{children:"\u95a2\u6570\u5168\u4f53\u304c\u5931\u6557\u3057\u305f\u5834\u5408\u306f\u3001\u547c\u3073\u51fa\u3057\u5143\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3082\u30ed\u30fc\u30eb\u30d0\u30c3\u30af"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"32-\u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3",children:"3.2 \u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION insert_with_fallback(p_email TEXT)\nRETURNS INTEGER AS $$\nDECLARE\n    v_user_id INTEGER;\nBEGIN\n    -- \u307e\u305a\u901a\u5e38\u306eINSERT\u3092\u8a66\u307f\u308b\n    INSERT INTO users (name, email)\n    VALUES ('New User', p_email)\n    RETURNING id INTO v_user_id;\n\n    RETURN v_user_id;\n\nEXCEPTION\n    WHEN unique_violation THEN\n        -- \u4e00\u610f\u5236\u7d04\u9055\u53cd\u306e\u5834\u5408\u3001\u65e2\u5b58\u30e6\u30fc\u30b6\u30fc\u306eID\u3092\u8fd4\u3059\n        RAISE NOTICE 'Email % already exists, returning existing user', p_email;\n\n        SELECT id INTO v_user_id\n        FROM users\n        WHERE email = p_email;\n\n        RETURN v_user_id;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30b3\u30b9\u30c8"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"EXCEPTION\u53e5\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u81ea\u52d5\u7684\u306b\u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u308b"}),"\n",(0,l.jsx)(e.li,{children:"\u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u3042\u308b"}),"\n",(0,l.jsx)(e.li,{children:"\u983b\u7e41\u306b\u5b9f\u884c\u3055\u308c\u308b\u95a2\u6570\u3067\u306f\u3001EXCEPTION\u3092\u907f\u3051\u3066\u4e8b\u524d\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u274c \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u4f4e\u4e0b\u306e\u53ef\u80fd\u6027\nCREATE OR REPLACE FUNCTION slow_insert(p_email TEXT)\nRETURNS INTEGER AS $$\nDECLARE\n    v_user_id INTEGER;\nBEGIN\n    INSERT INTO users (email) VALUES (p_email) RETURNING id INTO v_user_id;\n    RETURN v_user_id;\nEXCEPTION WHEN unique_violation THEN\n    SELECT id INTO v_user_id FROM users WHERE email = p_email;\n    RETURN v_user_id;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u2705 \u6539\u5584\u7248: \u4e8b\u524d\u30c1\u30a7\u30c3\u30af\nCREATE OR REPLACE FUNCTION fast_insert(p_email TEXT)\nRETURNS INTEGER AS $$\nDECLARE\n    v_user_id INTEGER;\nBEGIN\n    -- \u65e2\u5b58\u30c1\u30a7\u30c3\u30af\n    SELECT id INTO v_user_id FROM users WHERE email = p_email;\n    IF FOUND THEN\n        RETURN v_user_id;\n    END IF;\n\n    -- \u65b0\u898f\u633f\u5165\n    INSERT INTO users (email) VALUES (p_email) RETURNING id INTO v_user_id;\n    RETURN v_user_id;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"33-\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3067\u306ecommitpostgresql-11",children:"3.3 \u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3067\u306eCOMMIT\uff08PostgreSQL 11+\uff09"}),"\n",(0,l.jsx)(e.p,{children:"\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\uff08PROCEDURE\uff09\u3067\u306f\u3001\u95a2\u6570\u3068\u7570\u306a\u308a\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1\u304c\u53ef\u80fd\u3067\u3059\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE PROCEDURE batch_update_users()\nAS $$\nDECLARE\n    v_user RECORD;\n    v_count INTEGER := 0;\nBEGIN\n    FOR v_user IN SELECT * FROM users LOOP\n        -- \u4f55\u304b\u66f4\u65b0\u51e6\u7406\n        UPDATE users SET updated_at = now() WHERE id = v_user.id;\n\n        v_count := v_count + 1;\n\n        -- 100\u4ef6\u3054\u3068\u306b\u30b3\u30df\u30c3\u30c8\uff08\u5927\u91cf\u30c7\u30fc\u30bf\u51e6\u7406\u306e\u5834\u5408\uff09\n        IF v_count % 100 = 0 THEN\n            COMMIT;\n            RAISE NOTICE 'Committed % records', v_count;\n        END IF;\n    END LOOP;\n\n    -- \u6b8b\u308a\u3092\u30b3\u30df\u30c3\u30c8\n    COMMIT;\n    RAISE NOTICE 'Total % records processed', v_count;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u5b9f\u884c\nCALL batch_update_users();\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u95a2\u6570 vs \u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\uff08\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1\uff09"}),":"]}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u9805\u76ee"}),(0,l.jsx)(e.th,{children:"FUNCTION"}),(0,l.jsx)(e.th,{children:"PROCEDURE"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"COMMIT/ROLLBACK"}),(0,l.jsx)(e.td,{children:"\u4e0d\u53ef"}),(0,l.jsx)(e.td,{children:"\u53ef\u80fd\uff08PG11+\uff09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5883\u754c"}),(0,l.jsx)(e.td,{children:"\u547c\u3073\u51fa\u3057\u5143"}),(0,l.jsx)(e.td,{children:"\u72ec\u81ea\u306b\u5236\u5fa1\u53ef\u80fd"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u7528\u9014"}),(0,l.jsx)(e.td,{children:"\u30c7\u30fc\u30bf\u53d6\u5f97\u3001\u8a08\u7b97"}),(0,l.jsx)(e.td,{children:"\u30d0\u30c3\u30c1\u51e6\u7406\u3001\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9"})]})]})]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"4-\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316",children:"4. \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316"}),"\n",(0,l.jsx)(e.h3,{id:"41-volatilestableimmutable\u5c5e\u6027",children:"4.1 VOLATILE/STABLE/IMMUTABLE\u5c5e\u6027"}),"\n",(0,l.jsxs)(e.p,{children:["\u95a2\u6570\u306e",(0,l.jsx)(e.strong,{children:"\u526f\u4f5c\u7528\u3068\u7d50\u679c\u306e\u5909\u52d5\u6027"}),"\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    \u95a2\u6570\u306e\u5c5e\u6027                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 VOLATILE   \u2502 \u30c7\u30d5\u30a9\u30eb\u30c8\u3002\u540c\u3058\u5f15\u6570\u3067\u3082\u6bce\u56de\u7d50\u679c\u304c\u5909\u308f\u308b\u53ef\u80fd\u6027   \u2502\n\u2502 (\u63ee\u767a\u6027)    \u2502 \u4f8b: now(), random(), \u30ab\u30ec\u30f3\u30c8\u30b7\u30fc\u30b1\u30f3\u30b9\u5024        \u2502\n\u2502            \u2502 - \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30b9\u30ad\u30e3\u30f3\u3067\u4f7f\u7528\u4e0d\u53ef                  \u2502\n\u2502            \u2502 - \u6bce\u56de\u5b9f\u884c\u3055\u308c\u308b                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 STABLE     \u2502 \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5185\u3067\u540c\u3058\u5f15\u6570\u306a\u3089\u540c\u3058\u7d50\u679c         \u2502\n\u2502 (\u5b89\u5b9a)      \u2502 \u4f8b: current_date, \u30c6\u30fc\u30d6\u30eb\u53c2\u7167\u3092\u542b\u3080\u95a2\u6570         \u2502\n\u2502            \u2502 - \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30b9\u30ad\u30e3\u30f3\u3067\u4f7f\u7528\u53ef\u80fd                  \u2502\n\u2502            \u2502 - \u540c\u4e00\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5185\u3067\u6700\u9069\u5316\u53ef\u80fd              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 IMMUTABLE  \u2502 \u5e38\u306b\u540c\u3058\u5f15\u6570\u3067\u540c\u3058\u7d50\u679c\uff08\u526f\u4f5c\u7528\u306a\u3057\uff09             \u2502\n\u2502 (\u4e0d\u5909)      \u2502 \u4f8b: \u6570\u5b66\u95a2\u6570\u3001\u6587\u5b57\u5217\u64cd\u4f5c                         \u2502\n\u2502            \u2502 - \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306b\u4f7f\u7528\u53ef\u80fd                      \u2502\n\u2502            \u2502 - \u5b9f\u884c\u8a08\u753b\u6642\u306b\u4e8b\u524d\u8a55\u4fa1\u53ef\u80fd                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u4f8b"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- VOLATILE (\u30c7\u30d5\u30a9\u30eb\u30c8)\nCREATE OR REPLACE FUNCTION get_random_user()\nRETURNS users AS $$\nBEGIN\n    RETURN (SELECT * FROM users ORDER BY random() LIMIT 1);\nEND;\n$$ LANGUAGE plpgsql VOLATILE;\n\n-- STABLE\nCREATE OR REPLACE FUNCTION get_user_by_email(p_email TEXT)\nRETURNS users AS $$\nBEGIN\n    RETURN (SELECT * FROM users WHERE email = p_email);\nEND;\n$$ LANGUAGE plpgsql STABLE;\n\n-- IMMUTABLE\nCREATE OR REPLACE FUNCTION calculate_circle_area(p_radius NUMERIC)\nRETURNS NUMERIC AS $$\nBEGIN\n    RETURN 3.14159 * p_radius * p_radius;\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"42-sql\u95a2\u6570-vs-plpgsql\u95a2\u6570",children:"4.2 SQL\u95a2\u6570 vs PL/pgSQL\u95a2\u6570"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"SQL\u95a2\u6570\u306f\u53ef\u80fd\u306a\u9650\u308a\u30a4\u30f3\u30e9\u30a4\u30f3\u5316\u3055\u308c\u308b"}),"\uff08\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u5411\u4e0a\uff09\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- SQL\u95a2\u6570\uff08\u63a8\u5968: \u5358\u7d14\u306a\u51e6\u7406\u306e\u5834\u5408\uff09\nCREATE OR REPLACE FUNCTION get_tax_sql(p_amount NUMERIC)\nRETURNS NUMERIC AS $$\n    SELECT p_amount * 0.1;\n$$ LANGUAGE sql IMMUTABLE;\n\n-- PL/pgSQL\u95a2\u6570\uff08\u8907\u96d1\u306a\u51e6\u7406\u304c\u5fc5\u8981\u306a\u5834\u5408\uff09\nCREATE OR REPLACE FUNCTION get_tax_plpgsql(p_amount NUMERIC)\nRETURNS NUMERIC AS $$\nBEGIN\n    IF p_amount < 0 THEN\n        RAISE EXCEPTION 'Amount cannot be negative';\n    END IF;\n    RETURN p_amount * 0.1;\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE;\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u4f7f\u3044\u5206\u3051"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5358\u7d14\u306a\u8a08\u7b97\u30fb\u96c6\u7d04 \u2192 SQL\u95a2\u6570\uff08\u30a4\u30f3\u30e9\u30a4\u30f3\u5316\u306e\u6069\u6075\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u5236\u5fa1\u69cb\u9020\u30fb\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u304c\u5fc5\u8981 \u2192 PL/pgSQL\u95a2\u6570"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"43-\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u52a3\u5316\u306e\u4f8b",children:"4.3 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u52a3\u5316\u306e\u4f8b"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u274c \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u4f4e\u4e0b\nCREATE OR REPLACE FUNCTION get_constant()\nRETURNS INTEGER AS $$\nBEGIN\n    RETURN 100;\nEND;\n$$ LANGUAGE plpgsql;  -- \u30c7\u30d5\u30a9\u30eb\u30c8\u3067VOLATILE\n\n-- WHERE\u53e5\u3067\u4f7f\u7528\u3059\u308b\u3068\u3001\u6bce\u884c\u3054\u3068\u306b\u95a2\u6570\u304c\u547c\u3070\u308c\u308b\nSELECT * FROM large_table WHERE value < get_constant();\n\n-- \u2705 \u5bfe\u51e6: \u9069\u5207\u306a\u5c5e\u6027\u3092\u6307\u5b9a\nCREATE OR REPLACE FUNCTION get_constant()\nRETURNS INTEGER AS $$\nBEGIN\n    RETURN 100;\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE;  -- \u5b9a\u6570\u306a\u306e\u3067IMMUTABLE\n"})}),"\n",(0,l.jsx)(e.h3,{id:"44-explain-analyze\u3067\u306e\u5b9f\u884c\u8a08\u753b\u78ba\u8a8d",children:"4.4 EXPLAIN ANALYZE\u3067\u306e\u5b9f\u884c\u8a08\u753b\u78ba\u8a8d"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u95a2\u6570\u3092\u542b\u3080\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u8a08\u753b\u3092\u78ba\u8a8d\nEXPLAIN ANALYZE\nSELECT\n    id,\n    total_amount,\n    calculate_tax(total_amount) AS tax\nFROM orders\nWHERE total_amount > 1000;\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"5-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",children:"5. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"}),"\n",(0,l.jsx)(e.h3,{id:"51-security-definer-vs-security-invoker",children:"5.1 SECURITY DEFINER vs SECURITY INVOKER"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u95a2\u6570\u306e\u5b9f\u884c\u6a29\u9650                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 SECURITY INVOKER \u2502 \u30c7\u30d5\u30a9\u30eb\u30c8\u3002\u95a2\u6570\u3092\u547c\u3073\u51fa\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e   \u2502\n\u2502                  \u2502 \u6a29\u9650\u3067\u5b9f\u884c                               \u2502\n\u2502                  \u2502 - \u547c\u3073\u51fa\u3057\u5074\u304c\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u6a29\u9650\u304c\u5fc5\u8981     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 SECURITY DEFINER \u2502 \u95a2\u6570\u306e\u6240\u6709\u8005\u306e\u6a29\u9650\u3067\u5b9f\u884c                 \u2502\n\u2502                  \u2502 - \u547c\u3073\u51fa\u3057\u5074\u306f\u95a2\u6570\u306e\u5b9f\u884c\u6a29\u9650\u306e\u307f\u3067OK     \u2502\n\u2502                  \u2502 - \u6a29\u9650\u6607\u683c\u306e\u30ea\u30b9\u30af\u3042\u308a                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"SECURITY DEFINER\u306e\u4f8b"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u7ba1\u7406\u8005\u306e\u307f\u304cusers\u30c6\u30fc\u30d6\u30eb\u3092\u5909\u66f4\u3067\u304d\u308b\u74b0\u5883\u3067\u3001\n-- \u4e00\u822c\u30e6\u30fc\u30b6\u30fc\u306b\u3082\u7279\u5b9a\u306e\u66f4\u65b0\u3092\u8a31\u53ef\u3059\u308b\n\nCREATE OR REPLACE FUNCTION update_user_last_login(p_user_id INTEGER)\nRETURNS VOID AS $$\nBEGIN\n    UPDATE users\n    SET last_login_at = now()\n    WHERE id = p_user_id;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n\n-- \u3053\u306e\u95a2\u6570\u306f\u6240\u6709\u8005\uff08\u7ba1\u7406\u8005\uff09\u306e\u6a29\u9650\u3067\u5b9f\u884c\u3055\u308c\u308b\u305f\u3081\u3001\n-- \u4e00\u822c\u30e6\u30fc\u30b6\u30fc\u3067\u3082\u5b9f\u884c\u53ef\u80fd\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u26a0\ufe0f SECURITY DEFINER\u306e\u5371\u967a\u6027"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u274c \u5371\u967a\u306a\u4f8b: SQL\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3067\u6a29\u9650\u6607\u683c\nCREATE OR REPLACE FUNCTION unsafe_definer(p_table_name TEXT)\nRETURNS BIGINT AS $$\nDECLARE\n    v_count BIGINT;\nBEGIN\n    -- p_table_name\u306b\u4efb\u610f\u306eSQL\u3092\u6ce8\u5165\u3055\u308c\u308b\u53ef\u80fd\u6027\n    EXECUTE 'SELECT COUNT(*) FROM ' || p_table_name INTO v_count;\n    RETURN v_count;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n\n-- \u653b\u6483\u4f8b:\n-- SELECT unsafe_definer('users; DROP TABLE users; --');\n"})}),"\n",(0,l.jsx)(e.h3,{id:"52-search_path\u306e\u56fa\u5b9a",children:"5.2 search_path\u306e\u56fa\u5b9a"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"SECURITY DEFINER"}),"\u95a2\u6570\u3067\u306f\u3001\u5fc5\u305a",(0,l.jsx)(e.code,{children:"search_path"}),"\u3092\u56fa\u5b9a\u3059\u3079\u304d\u3067\u3059\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION secure_function()\nRETURNS INTEGER AS $$\nBEGIN\n    -- search_path\u3092\u56fa\u5b9a\uff08\u30b9\u30ad\u30fc\u30de\u30cf\u30a4\u30b8\u30e3\u30c3\u30af\u5bfe\u7b56\uff09\n    SET search_path = public, pg_temp;\n\n    -- \u51e6\u7406...\n    RETURN 1;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u30b9\u30ad\u30fc\u30de\u30cf\u30a4\u30b8\u30e3\u30c3\u30af\u653b\u6483"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u653b\u6483\u8005\u304c\u60aa\u610f\u3042\u308b\u30b9\u30ad\u30fc\u30de\u3092\u4f5c\u6210\nCREATE SCHEMA attacker;\nCREATE FUNCTION attacker.now() RETURNS TIMESTAMPTZ AS $$\nBEGIN\n    -- \u60aa\u610f\u3042\u308b\u51e6\u7406\n    RETURN now();\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u8106\u5f31\u306a\u95a2\u6570\uff08search_path\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\uff09\nCREATE OR REPLACE FUNCTION vulnerable_function()\nRETURNS TIMESTAMPTZ AS $$\nBEGIN\n    RETURN now();  -- attacker\u30b9\u30ad\u30fc\u30de\u306enow()\u304c\u547c\u3070\u308c\u308b\u53ef\u80fd\u6027\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"53-\u5165\u529b\u691c\u8a3c",children:"5.3 \u5165\u529b\u691c\u8a3c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION validate_and_update_email(\n    p_user_id INTEGER,\n    p_email TEXT\n)\nRETURNS VOID AS $$\nBEGIN\n    -- \u5165\u529b\u691c\u8a3c\n    IF p_user_id IS NULL OR p_user_id <= 0 THEN\n        RAISE EXCEPTION 'Invalid user ID: %', p_user_id;\n    END IF;\n\n    IF p_email IS NULL OR p_email = '' THEN\n        RAISE EXCEPTION 'Email cannot be empty';\n    END IF;\n\n    IF p_email !~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}$' THEN\n        RAISE EXCEPTION 'Invalid email format: %', p_email;\n    END IF;\n\n    -- \u66f4\u65b0\u51e6\u7406\n    UPDATE users\n    SET email = lower(p_email),\n        updated_at = now()\n    WHERE id = p_user_id;\n\n    IF NOT FOUND THEN\n        RAISE EXCEPTION 'User % not found', p_user_id;\n    END IF;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"6-\u5fdc\u7528\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"6. \u5fdc\u7528\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,l.jsx)(e.h3,{id:"61-\u52d5\u7684sql\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",children:"6.1 \u52d5\u7684SQL\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u2705 \u5e38\u306b",(0,l.jsx)(e.code,{children:"format()"}),"\u95a2\u6570\u3092\u4f7f\u7528"]}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 \u8b58\u5225\u5b50\u306b\u306f",(0,l.jsx)(e.code,{children:"%I"}),"\u3001\u30ea\u30c6\u30e9\u30eb\u306b\u306f",(0,l.jsx)(e.code,{children:"%L"}),"\u3092\u4f7f\u7528"]}),"\n",(0,l.jsxs)(e.li,{children:["\u2705 ",(0,l.jsx)(e.code,{children:"%s"}),"\u306f\u7d76\u5bfe\u306b\u4f7f\u7528\u3057\u306a\u3044"]}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u5165\u529b\u5024\u3092\u691c\u8a3c\uff08\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u65b9\u5f0f\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u52d5\u7684\u306b\u751f\u6210\u3055\u308c\u305fSQL\u3092\u30ed\u30b0\u51fa\u529b\uff08\u30c7\u30d0\u30c3\u30b0\u7528\uff09"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"62-\u30c8\u30ea\u30ac\u30fc\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u8003\u616e",children:"6.2 \u30c8\u30ea\u30ac\u30fc\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u8003\u616e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u274c \u975e\u52b9\u7387: \u3059\u3079\u3066\u306e\u66f4\u65b0\u3067\u30ed\u30b0\u3092\u8a18\u9332\nCREATE TRIGGER users_audit\n    AFTER UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION audit_trigger();\n\n-- \u2705 \u6539\u5584: \u7279\u5b9a\u30ab\u30e9\u30e0\u306e\u5909\u66f4\u6642\u306e\u307f\u30ed\u30b0\u8a18\u9332\nCREATE TRIGGER users_audit\n    AFTER UPDATE OF email, name ON users  -- \u7279\u5b9a\u30ab\u30e9\u30e0\u306e\u307f\n    FOR EACH ROW\n    WHEN (OLD.* IS DISTINCT FROM NEW.*)  -- \u5b9f\u969b\u306b\u5909\u66f4\u304c\u3042\u3063\u305f\u5834\u5408\u306e\u307f\n    EXECUTE FUNCTION audit_trigger();\n"})}),"\n",(0,l.jsx)(e.h3,{id:"63-security-definer\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"6.3 SECURITY DEFINER\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION safe_definer_function(p_param TEXT)\nRETURNS INTEGER AS $$\nBEGIN\n    -- 1. search_path\u3092\u56fa\u5b9a\n    SET search_path = public, pg_temp;\n\n    -- 2. \u5165\u529b\u691c\u8a3c\n    IF p_param IS NULL OR p_param = '' THEN\n        RAISE EXCEPTION 'Parameter cannot be empty';\n    END IF;\n\n    -- 3. \u52d5\u7684SQL\u306f\u907f\u3051\u308b\uff08\u3084\u3080\u3092\u5f97\u306a\u3044\u5834\u5408\u306fformat()\u4f7f\u7528\uff09\n\n    -- 4. \u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247\u306b\u5f93\u3046\n\n    RETURN 1;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER\nSET search_path = public, pg_temp;  -- CREATE\u6642\u306b\u3082\u6307\u5b9a\u53ef\u80fd\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"7-\u53c2\u8003\u30ea\u30f3\u30af",children:"7. \u53c2\u8003\u30ea\u30f3\u30af"}),"\n",(0,l.jsx)(e.h3,{id:"\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/plpgsql.html",children:"PostgreSQL\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - PL/pgSQL"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/triggers.html",children:"PostgreSQL\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - \u30c8\u30ea\u30ac\u30fc"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/xfunc-volatility.html",children:"PostgreSQL\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - \u95a2\u6570\u306e\u63ee\u767a\u6027\u5206\u985e"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/sql-createfunction.html#SQL-CREATEFUNCTION-SECURITY",children:"PostgreSQL\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - SECURITY DEFINER"})}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u95a2\u9023\u3059\u308b\u5b66\u7fd2\u30b3\u30f3\u30c6\u30f3\u30c4",children:"\u95a2\u9023\u3059\u308b\u5b66\u7fd2\u30b3\u30f3\u30c6\u30f3\u30c4"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/postgresql/dev-07-plpgsql-basics",children:"dev-07-plpgsql-basics.md"})," - PL/pgSQL\u57fa\u672c\u7de8"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/postgresql/dev-04-transactions",children:"dev-04-transactions.md"})," - \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/postgresql/dev-05-query-optimization",children:"dev-05-query-optimization.md"})," - \u30af\u30a8\u30ea\u6700\u9069\u5316"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/postgresql/dba-04-security",children:"dba-04-security.md"})," - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a"]}),"\n"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"\u307e\u3068\u3081",children:"\u307e\u3068\u3081"}),"\n",(0,l.jsx)(e.p,{children:"PL/pgSQL\u5fdc\u7528\u7de8\u3067\u306f\u3001\u5b9f\u8df5\u7684\u306a\u6280\u8853\u3092\u5b66\u3073\u307e\u3057\u305f\u3002"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u5b66\u3093\u3060\u3053\u3068"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u2705 \u52d5\u7684SQL\u306e\u5b89\u5168\u306a\u4f7f\u3044\u65b9\uff08format()\u3001SQL\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5bfe\u7b56\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u30c8\u30ea\u30ac\u30fc\u306e\u5b9f\u88c5\uff08BEFORE/AFTER\u3001NEW/OLD\u3001\u76e3\u67fb\u30ed\u30b0\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5236\u5fa1\uff08\u30b5\u30d6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3001\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3067\u306eCOMMIT\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316\uff08VOLATILE/STABLE/IMMUTABLE\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u2705 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff08SECURITY DEFINER\u3001search_path\u56fa\u5b9a\u3001\u5165\u529b\u691c\u8a3c\uff09"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),":"]}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u5b9f\u969b\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u30c8\u30ea\u30ac\u30fc\u3092\u5b9f\u88c5\u3057\u3066\u307f\u308b"}),"\n",(0,l.jsx)(e.li,{children:"\u65e2\u5b58\u306e\u52d5\u7684SQL\u95a2\u6570\u3092\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ec\u30d3\u30e5\u30fc\u3059\u308b"}),"\n",(0,l.jsx)(e.li,{children:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u3044\u95a2\u6570\u3092\u6700\u9069\u5316\u3059\u308b"}),"\n",(0,l.jsx)(e.li,{children:"SECURITY DEFINER\u3092\u4f7f\u3063\u305f\u6a29\u9650\u5236\u5fa1\u3092\u8a2d\u8a08\u3059\u308b"}),"\n"]})]})}function T(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>d,x:()=>i});var E=s(96540);const l={},r=E.createContext(l);function d(n){const e=E.useContext(r);return E.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:d(n.components),E.createElement(r.Provider,{value:e},n.children)}}}]);