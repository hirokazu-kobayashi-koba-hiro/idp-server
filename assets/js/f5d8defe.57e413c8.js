"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[43402],{9587:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"content_11_learning/networking/api-gateway-networking","title":"\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068API Gateway","description":"\u6240\u8981\u6642\u9593","source":"@site/docs/content_11_learning/15-networking/05-api-gateway-networking.md","sourceDirName":"content_11_learning/15-networking","slug":"/content_11_learning/networking/api-gateway-networking","permalink":"/idp-server/docs/content_11_learning/networking/api-gateway-networking","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/15-networking/05-api-gateway-networking.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"docs","previous":{"title":"SSL/TLS\u8a3c\u660e\u66f8\u7ba1\u7406","permalink":"/idp-server/docs/content_11_learning/networking/ssl-tls-certificates"},"next":{"title":"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","permalink":"/idp-server/docs/content_11_learning/networking/network-troubleshooting"}}');var a=i(74848),r=i(28453);const t={},l="\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068API Gateway",o={},c=[{value:"\u6240\u8981\u6642\u9593",id:"\u6240\u8981\u6642\u9593",level:2},{value:"\u5b66\u3079\u308b\u3053\u3068",id:"\u5b66\u3079\u308b\u3053\u3068",level:2},{value:"\u524d\u63d0\u77e5\u8b58",id:"\u524d\u63d0\u77e5\u8b58",level:2},{value:"1. \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068API Gateway\u306e\u57fa\u790e",id:"1-\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068api-gateway\u306e\u57fa\u790e",level:2},{value:"1.1 \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u306f",id:"11-\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u306f",level:3},{value:"1.2 API Gateway\u30d1\u30bf\u30fc\u30f3",id:"12-api-gateway\u30d1\u30bf\u30fc\u30f3",level:3},{value:"2. Nginx\u306b\u3088\u308b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a",id:"2-nginx\u306b\u3088\u308b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a",level:2},{value:"2.1 \u57fa\u672c\u7684\u306a\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a",id:"21-\u57fa\u672c\u7684\u306a\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a",level:3},{value:"2.2 \u30d1\u30b9\u30d9\u30fc\u30b9\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0",id:"22-\u30d1\u30b9\u30d9\u30fc\u30b9\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0",level:3},{value:"3. \u8a8d\u8a3c\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",id:"3-\u8a8d\u8a3c\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",level:2},{value:"3.1 \u57fa\u672c\u8a8d\u8a3c\uff08Basic Authentication\uff09",id:"31-\u57fa\u672c\u8a8d\u8a3cbasic-authentication",level:3},{value:"3.2 API\u30ad\u30fc\u8a8d\u8a3c",id:"32-api\u30ad\u30fc\u8a8d\u8a3c",level:3},{value:"3.3 JWT\u8a8d\u8a3c",id:"33-jwt\u8a8d\u8a3c",level:3},{value:"4. \u30ec\u30fc\u30c8\u5236\u9650\u3068\u30b9\u30ed\u30c3\u30c8\u30ea\u30f3\u30b0",id:"4-\u30ec\u30fc\u30c8\u5236\u9650\u3068\u30b9\u30ed\u30c3\u30c8\u30ea\u30f3\u30b0",level:2},{value:"4.1 Nginx\u306b\u3088\u308b\u30ec\u30fc\u30c8\u5236\u9650",id:"41-nginx\u306b\u3088\u308b\u30ec\u30fc\u30c8\u5236\u9650",level:3},{value:"4.2 \u63a5\u7d9a\u6570\u5236\u9650",id:"42-\u63a5\u7d9a\u6570\u5236\u9650",level:3},{value:"4. \u8a8d\u8a3c\u30fb\u8a8d\u53ef",id:"4-\u8a8d\u8a3c\u8a8d\u53ef",level:2},{value:"4.1 \u8a8d\u8a3c\u65b9\u5f0f\u306e\u7a2e\u985e",id:"41-\u8a8d\u8a3c\u65b9\u5f0f\u306e\u7a2e\u985e",level:3},{value:"5. \u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u3068CORS",id:"5-\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u3068cors",level:2},{value:"5.1 Nginx\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0",id:"51-nginx\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0",level:3},{value:"5.2 CORS\u8a2d\u5b9a",id:"52-cors\u8a2d\u5b9a",level:3},{value:"Nginx\u3067\u306eCORS\u8a2d\u5b9a",id:"nginx\u3067\u306ecors\u8a2d\u5b9a",level:4},{value:"\u8907\u6570\u30aa\u30ea\u30b8\u30f3\u3078\u306e\u5bfe\u5fdc",id:"\u8907\u6570\u30aa\u30ea\u30b8\u30f3\u3078\u306e\u5bfe\u5fdc",level:4},{value:"6. \u30ed\u30b0\u3068\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0",id:"6-\u30ed\u30b0\u3068\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0",level:2},{value:"6.1 \u30a2\u30af\u30bb\u30b9\u30ed\u30b0",id:"61-\u30a2\u30af\u30bb\u30b9\u30ed\u30b0",level:3},{value:"6.2 \u30e1\u30c8\u30ea\u30af\u30b9\u53ce\u96c6",id:"62-\u30e1\u30c8\u30ea\u30af\u30b9\u53ce\u96c6",level:3},{value:"\u307e\u3068\u3081",id:"\u307e\u3068\u3081",level:2},{value:"\u5b66\u3093\u3060\u3053\u3068",id:"\u5b66\u3093\u3060\u3053\u3068",level:3},{value:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8",id:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8",level:3},{value:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:3},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:3},{value:"\u53c2\u8003\u30ea\u30f3\u30af",id:"\u53c2\u8003\u30ea\u30f3\u30af",level:3}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068api-gateway",children:"\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068API Gateway"})}),"\n",(0,a.jsx)(e.h2,{id:"\u6240\u8981\u6642\u9593",children:"\u6240\u8981\u6642\u9593"}),"\n",(0,a.jsx)(e.p,{children:"\u7d0435\u5206"}),"\n",(0,a.jsx)(e.h2,{id:"\u5b66\u3079\u308b\u3053\u3068",children:"\u5b66\u3079\u308b\u3053\u3068"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u57fa\u672c\u6982\u5ff5\u3068\u5f79\u5272"}),"\n",(0,a.jsx)(e.li,{children:"Nginx\u3092\u4f7f\u7528\u3057\u305f\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a"}),"\n",(0,a.jsx)(e.li,{children:"API Gateway\u30d1\u30bf\u30fc\u30f3\u306e\u4e00\u822c\u7684\u306a\u5b9f\u88c5"}),"\n",(0,a.jsx)(e.li,{children:"\u30ec\u30fc\u30c8\u5236\u9650\u3001\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u3001\u8a8d\u8a3c\u306e\u5b9f\u88c5"}),"\n",(0,a.jsx)(e.li,{children:"CORS\u306e\u8a2d\u5b9a\u3068\u5bfe\u5fdc"}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"\u524d\u63d0\u77e5\u8b58",children:"\u524d\u63d0\u77e5\u8b58"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/dns-fundamentals",children:"01-dns-fundamentals.md"})," - DNS\u57fa\u790e"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/load-balancing",children:"03-load-balancing.md"})," - \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b7\u30f3\u30b0"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/ssl-tls-certificates",children:"04-ssl-tls-certificates.md"})," - SSL/TLS\u8a3c\u660e\u66f8"]}),"\n",(0,a.jsx)(e.li,{children:"HTTP/REST\u306e\u57fa\u672c"}),"\n"]}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"1-\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068api-gateway\u306e\u57fa\u790e",children:"1. \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068API Gateway\u306e\u57fa\u790e"}),"\n",(0,a.jsx)(e.h3,{id:"11-\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u306f",children:"1.1 \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u306f"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7"}),"\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306e\u9593\u306b\u914d\u7f6e\u3055\u308c\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u4ee3\u7406\u3067\u53d7\u3051\u53d6\u308a\u3001\u9069\u5207\u306a\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u8ee2\u9001\u3059\u308b\u5f79\u5272\u3092\u6301\u3061\u307e\u3059\u3002"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u5f79\u5272                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff08\u30d6\u30e9\u30a6\u30b6\u3001\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u7b49\uff09                   \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u2502 HTTPS \u30ea\u30af\u30a8\u30b9\u30c8                                     \u2502\n\u2502      \u25bc                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502           \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7 (Nginx/HAProxy)           \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502 1. \u8a8d\u8a3c\u30fb\u8a8d\u53ef                                  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 2. \u30ea\u30af\u30a8\u30b9\u30c8\u691c\u8a3c                              \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 3. \u30ec\u30fc\u30c8\u5236\u9650\uff08\u30b9\u30ed\u30c3\u30c8\u30ea\u30f3\u30b0\uff09                 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 4. \u30ad\u30e3\u30c3\u30b7\u30f3\u30b0                                \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 5. SSL/TLS\u7d42\u7aef                                 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 6. \u30ed\u30ae\u30f3\u30b0\u30fb\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0                      \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u251c\u2500\u2500\u2500\u25ba Web\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u30fc                      \u2502\n\u2502      \u251c\u2500\u2500\u2500\u25ba API\u30b5\u30fc\u30d0\u30fc                                      \u2502\n\u2502      \u251c\u2500\u2500\u2500\u25ba \u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u7fa4                               \u2502\n\u2502      \u2514\u2500\u2500\u2500\u25ba \u9759\u7684\u30b3\u30f3\u30c6\u30f3\u30c4\u30b5\u30fc\u30d0\u30fc                           \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsx)(e.h3,{id:"12-api-gateway\u30d1\u30bf\u30fc\u30f3",children:"1.2 API Gateway\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"API Gateway"}),"\u306f\u3001\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u304a\u3044\u3066\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u8907\u6570\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u306e\u9593\u306b\u914d\u7f6e\u3055\u308c\u308b\u5358\u4e00\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              API Gateway \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u5229\u70b9:                                                       \u2502\n\u2502  1. \u5358\u4e00\u30a8\u30f3\u30c8\u30ea\u30fc\u30dd\u30a4\u30f3\u30c8                                   \u2502\n\u2502     - \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f1\u3064\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u307f\u77e5\u308b\u5fc5\u8981         \u2502\n\u2502                                                              \u2502\n\u2502  2. \u30d7\u30ed\u30c8\u30b3\u30eb\u5909\u63db                                           \u2502\n\u2502     - \u5916\u90e8: HTTPS/REST \u2192 \u5185\u90e8: gRPC/HTTP                    \u2502\n\u2502                                                              \u2502\n\u2502  3. \u30ea\u30af\u30a8\u30b9\u30c8\u96c6\u7d04                                           \u2502\n\u2502     - \u8907\u6570\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u547c\u3073\u51fa\u3057\u30921\u3064\u306b\u96c6\u7d04                 \u2502\n\u2502                                                              \u2502\n\u2502  4. \u8a8d\u8a3c\u30fb\u8a8d\u53ef\u306e\u4e00\u5143\u5316                                       \u2502\n\u2502     - JWT\u691c\u8a3c\u3001API\u30ad\u30fc\u7ba1\u7406                                  \u2502\n\u2502                                                              \u2502\n\u2502  5. \u30ec\u30fc\u30c8\u5236\u9650\u30fb\u30b9\u30ed\u30c3\u30c8\u30ea\u30f3\u30b0                               \u2502\n\u2502     - \u30b5\u30fc\u30d3\u30b9\u4fdd\u8b77                                           \u2502\n\u2502                                                              \u2502\n\u2502  6. \u30ad\u30e3\u30c3\u30b7\u30f3\u30b0                                             \u2502\n\u2502     - \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u8ca0\u8377\u8efd\u6e1b                                   \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"2-nginx\u306b\u3088\u308b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a",children:"2. Nginx\u306b\u3088\u308b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a"}),"\n",(0,a.jsx)(e.h3,{id:"21-\u57fa\u672c\u7684\u306a\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a",children:"2.1 \u57fa\u672c\u7684\u306a\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a"}),"\n",(0,a.jsx)(e.p,{children:"Nginx\u3092\u4f7f\u7528\u3057\u305f\u30b7\u30f3\u30d7\u30eb\u306a\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"# /etc/nginx/sites-available/api-gateway\n\nserver {\n    listen 443 ssl http2;\n    server_name api.example.com;\n\n    # SSL/TLS\u8a2d\u5b9a\n    ssl_certificate /etc/letsencrypt/live/api.example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/api.example.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';\n\n    # \u30ed\u30ae\u30f3\u30b0\n    access_log /var/log/nginx/api-access.log;\n    error_log /var/log/nginx/api-error.log;\n\n    # \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u30d7\u30ed\u30ad\u30b7\n    location / {\n        proxy_pass http://backend-app:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u8a2d\u5b9a\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"22-\u30d1\u30b9\u30d9\u30fc\u30b9\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0",children:"2.2 \u30d1\u30b9\u30d9\u30fc\u30b9\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0"}),"\n",(0,a.jsx)(e.p,{children:"\u8907\u6570\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u3078\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"server {\n    listen 443 ssl http2;\n    server_name api.example.com;\n\n    # /api/v1/* \u2192 API v1\u30b5\u30fc\u30d0\u30fc\n    location /api/v1/ {\n        proxy_pass http://api-v1-backend:8080/;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n\n    # /api/v2/* \u2192 API v2\u30b5\u30fc\u30d0\u30fc\n    location /api/v2/ {\n        proxy_pass http://api-v2-backend:8080/;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n\n    # /auth/* \u2192 \u8a8d\u8a3c\u30b5\u30fc\u30d3\u30b9\n    location /auth/ {\n        proxy_pass http://auth-service:9000/;\n        proxy_set_header Host $host;\n    }\n\n    # /static/* \u2192 \u9759\u7684\u30b3\u30f3\u30c6\u30f3\u30c4\uff08CDN/S3\u7b49\uff09\n    location /static/ {\n        proxy_pass http://cdn.example.com/;\n        proxy_cache my_cache;\n        proxy_cache_valid 200 1h;\n    }\n}\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"3-\u8a8d\u8a3c\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",children:"3. \u8a8d\u8a3c\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"}),"\n",(0,a.jsx)(e.h3,{id:"31-\u57fa\u672c\u8a8d\u8a3cbasic-authentication",children:"3.1 \u57fa\u672c\u8a8d\u8a3c\uff08Basic Authentication\uff09"}),"\n",(0,a.jsx)(e.p,{children:"\u6700\u3082\u30b7\u30f3\u30d7\u30eb\u306a\u8a8d\u8a3c\u65b9\u5f0f:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:'# /etc/nginx/sites-available/api-gateway\n\nserver {\n    listen 443 ssl http2;\n    server_name api.example.com;\n\n    location /api/ {\n        # Basic\u8a8d\u8a3c\n        auth_basic "API Access";\n        auth_basic_user_file /etc/nginx/.htpasswd;\n\n        proxy_pass http://backend-api:8080/;\n        proxy_set_header Host $host;\n    }\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# .htpasswd\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\nsudo apt-get install apache2-utils\nsudo htpasswd -c /etc/nginx/.htpasswd username\n"})}),"\n",(0,a.jsx)(e.h3,{id:"32-api\u30ad\u30fc\u8a8d\u8a3c",children:"3.2 API\u30ad\u30fc\u8a8d\u8a3c"}),"\n",(0,a.jsx)(e.p,{children:"\u30ab\u30b9\u30bf\u30e0\u30d8\u30c3\u30c0\u30fc\u306b\u3088\u308bAPI\u30ad\u30fc\u691c\u8a3c:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:'server {\n    listen 443 ssl http2;\n    server_name api.example.com;\n\n    location /api/ {\n        # API\u30ad\u30fc\u30c1\u30a7\u30c3\u30af\n        if ($http_x_api_key = "") {\n            return 401 "API Key Required";\n        }\n\n        # API\u30ad\u30fc\u691c\u8a3c\uff08\u7c21\u6613\u7248\uff09\n        set $valid_key 0;\n        if ($http_x_api_key = "your-secret-api-key") {\n            set $valid_key 1;\n        }\n\n        if ($valid_key = 0) {\n            return 403 "Invalid API Key";\n        }\n\n        proxy_pass http://backend-api:8080/;\n        proxy_set_header Host $host;\n        proxy_set_header X-API-Key $http_x_api_key;\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"33-jwt\u8a8d\u8a3c",children:"3.3 JWT\u8a8d\u8a3c"}),"\n",(0,a.jsx)(e.p,{children:"JWT\uff08JSON Web Token\uff09\u306b\u3088\u308b\u8a8d\u8a3c\uff08nginx-jwt \u30e2\u30b8\u30e5\u30fc\u30eb\u4f7f\u7528\uff09:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"# JWT\u691c\u8a3c\u306e\u6982\u5ff5\uff08\u5b9f\u88c5\u306b\u306fnginx-jwt\u30e2\u30b8\u30e5\u30fc\u30eb\u307e\u305f\u306fLua\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u5fc5\u8981\uff09\n\nserver {\n    listen 443 ssl http2;\n    server_name api.example.com;\n\n    location /api/ {\n        # Authorization\u30d8\u30c3\u30c0\u30fc\u304b\u3089\u30c8\u30fc\u30af\u30f3\u53d6\u5f97\n        # JWT\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\uff08\u7f72\u540d\u691c\u8a3c\u3001\u6709\u52b9\u671f\u9650\u78ba\u8a8d\uff09\n        # \u203b\u5b9f\u88c5\u8a73\u7d30\u306fnginx-jwt\u30e2\u30b8\u30e5\u30fc\u30eb\u307e\u305f\u306fLua\u30b9\u30af\u30ea\u30d7\u30c8\u53c2\u7167\n\n        # \u691c\u8a3c\u6210\u529f\u5f8c\u3001\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u30d7\u30ed\u30ad\u30b7\n        proxy_pass http://backend-api:8080/;\n        proxy_set_header Host $host;\n        proxy_set_header X-User-ID $jwt_claim_sub;  # JWT\u306esub\u30af\u30ec\u30fc\u30e0\u3092\u6e21\u3059\n    }\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"JWT\u691c\u8a3c\u306e\u4e00\u822c\u7684\u306a\u6d41\u308c:"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"1. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304cAuthorization\u30d8\u30c3\u30c0\u30fc\u3067JWT\u3092\u9001\u4fe1\n   Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n\n2. \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3067JWT\u691c\u8a3c\n   - \u7f72\u540d\u691c\u8a3c\uff08HMAC/RSA\uff09\n   - \u6709\u52b9\u671f\u9650\u78ba\u8a8d\uff08exp claim\uff09\n   - Issuer\u78ba\u8a8d\uff08iss claim\uff09\n\n3. \u691c\u8a3c\u6210\u529f\n   - \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u8ee2\u9001\n   - \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u30d8\u30c3\u30c0\u30fc\u306b\u8ffd\u52a0\n\n4. \u691c\u8a3c\u5931\u6557\n   - 401 Unauthorized\u3092\u8fd4\u3059\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"4-\u30ec\u30fc\u30c8\u5236\u9650\u3068\u30b9\u30ed\u30c3\u30c8\u30ea\u30f3\u30b0",children:"4. \u30ec\u30fc\u30c8\u5236\u9650\u3068\u30b9\u30ed\u30c3\u30c8\u30ea\u30f3\u30b0"}),"\n",(0,a.jsx)(e.h3,{id:"41-nginx\u306b\u3088\u308b\u30ec\u30fc\u30c8\u5236\u9650",children:"4.1 Nginx\u306b\u3088\u308b\u30ec\u30fc\u30c8\u5236\u9650"}),"\n",(0,a.jsx)(e.p,{children:"\u30ea\u30af\u30a8\u30b9\u30c8\u6570\u3092\u5236\u9650\u3057\u3066\u30b5\u30fc\u30d3\u30b9\u3092\u4fdd\u8b77:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"# /etc/nginx/nginx.conf\n\nhttp {\n    # \u30ec\u30fc\u30c8\u5236\u9650\u30be\u30fc\u30f3\u5b9a\u7fa9\n    # \u30af\u30e9\u30a4\u30a2\u30f3\u30c8IP\u3054\u3068\u306b10MB\u30011\u79d2\u3042\u305f\u308a10\u30ea\u30af\u30a8\u30b9\u30c8\u307e\u3067\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\n\n    # API\u30ad\u30fc\u3054\u3068\u306e\u30ec\u30fc\u30c8\u5236\u9650\n    limit_req_zone $http_x_api_key zone=apikey_limit:10m rate=100r/s;\n\n    server {\n        listen 443 ssl http2;\n        server_name api.example.com;\n\n        location /api/ {\n            # \u30ec\u30fc\u30c8\u5236\u9650\u9069\u7528\uff08burst=20\u3067\u4e00\u6642\u7684\u306a\u8d85\u904e\u3092\u8a31\u53ef\uff09\n            limit_req zone=api_limit burst=20 nodelay;\n\n            # 429 Too Many Requests\u306e\u30ab\u30b9\u30bf\u30e0\u30ec\u30b9\u30dd\u30f3\u30b9\n            limit_req_status 429;\n\n            proxy_pass http://backend-api:8080/;\n            proxy_set_header Host $host;\n        }\n\n        # \u30d7\u30ec\u30df\u30a2\u30e0API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff08\u9ad8\u30ec\u30fc\u30c8\u5236\u9650\uff09\n        location /api/premium/ {\n            limit_req zone=apikey_limit burst=50 nodelay;\n\n            proxy_pass http://backend-api:8080/premium/;\n            proxy_set_header Host $host;\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"42-\u63a5\u7d9a\u6570\u5236\u9650",children:"4.2 \u63a5\u7d9a\u6570\u5236\u9650"}),"\n",(0,a.jsx)(e.p,{children:"\u540c\u6642\u63a5\u7d9a\u6570\u306e\u5236\u9650:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"http {\n    # \u63a5\u7d9a\u6570\u5236\u9650\u30be\u30fc\u30f3\n    limit_conn_zone $binary_remote_addr zone=conn_limit:10m;\n\n    server {\n        listen 443 ssl http2;\n        server_name api.example.com;\n\n        location /api/ {\n            # \u30af\u30e9\u30a4\u30a2\u30f3\u30c8IP\u3054\u3068\u306b10\u63a5\u7d9a\u307e\u3067\n            limit_conn conn_limit 10;\n\n            proxy_pass http://backend-api:8080/;\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"4-\u8a8d\u8a3c\u8a8d\u53ef",children:"4. \u8a8d\u8a3c\u30fb\u8a8d\u53ef"}),"\n",(0,a.jsx)(e.h3,{id:"41-\u8a8d\u8a3c\u65b9\u5f0f\u306e\u7a2e\u985e",children:"4.1 \u8a8d\u8a3c\u65b9\u5f0f\u306e\u7a2e\u985e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          API Gateway \u8a8d\u8a3c\u65b9\u5f0f                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  1. Basic\u8a8d\u8a3c                                                \u2502\n\u2502     - HTTP\u30d8\u30c3\u30c0\u30fc\u3067\u30e6\u30fc\u30b6\u30fc\u540d/\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u9001\u4fe1              \u2502\n\u2502     - \u30b7\u30f3\u30d7\u30eb\u3060\u304c\u3001HTTPS\u5fc5\u9808                                \u2502\n\u2502                                                              \u2502\n\u2502  2. API\u30ad\u30fc\u8a8d\u8a3c                                              \u2502\n\u2502     - \u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u30fc\u307e\u305f\u306f\u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u30ad\u30fc\u9001\u4fe1      \u2502\n\u2502     - \u30b7\u30f3\u30d7\u30eb\u306a\u30a2\u30af\u30bb\u30b9\u5236\u5fa1                                 \u2502\n\u2502     - \u4f7f\u7528\u91cf\u5236\u9650\u3068\u7d44\u307f\u5408\u308f\u305b                                 \u2502\n\u2502                                                              \u2502\n\u2502  3. JWT\uff08JSON Web Token\uff09\u8a8d\u8a3c                               \u2502\n\u2502     - JWT\u30c8\u30fc\u30af\u30f3\u306e\u691c\u8a3c                                      \u2502\n\u2502     - OAuth 2.0 / OIDC\u7d71\u5408                                  \u2502\n\u2502     - \u30b9\u30c6\u30fc\u30c8\u30ec\u30b9\u306a\u8a8d\u8a3c                                     \u2502\n\u2502                                                              \u2502\n\u2502  4. OAuth 2.0                                               \u2502\n\u2502     - \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u30d9\u30fc\u30b9\u306e\u8a8d\u8a3c                            \u2502\n\u2502     - \u5916\u90e8\u8a8d\u8a3c\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u9023\u643a                               \u2502\n\u2502     - \u30b9\u30b3\u30fc\u30d7\u30d9\u30fc\u30b9\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1                            \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"5-\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u3068cors",children:"5. \u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u3068CORS"}),"\n",(0,a.jsx)(e.h3,{id:"51-nginx\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0",children:"5.1 Nginx\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0"}),"\n",(0,a.jsx)(e.p,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u8ca0\u8377\u3092\u8efd\u6e1b:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:'# /etc/nginx/nginx.conf\n\nhttp {\n    # \u30ad\u30e3\u30c3\u30b7\u30e5\u30d1\u30b9\u5b9a\u7fa9\n    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=1g inactive=60m use_temp_path=off;\n\n    server {\n        listen 443 ssl http2;\n        server_name api.example.com;\n\n        location /api/public/ {\n            # \u30ad\u30e3\u30c3\u30b7\u30e5\u6709\u52b9\u5316\n            proxy_cache api_cache;\n\n            # \u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\uff08URL + \u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\uff09\n            proxy_cache_key "$scheme$request_method$host$request_uri";\n\n            # \u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9200\u306e\u5834\u5408\u30015\u5206\u9593\u30ad\u30e3\u30c3\u30b7\u30e5\n            proxy_cache_valid 200 5m;\n\n            # \u30ad\u30e3\u30c3\u30b7\u30e5\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u30d8\u30c3\u30c0\u30fc\u306b\u8ffd\u52a0\uff08\u30c7\u30d0\u30c3\u30b0\u7528\uff09\n            add_header X-Cache-Status $upstream_cache_status;\n\n            # \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3078\u30d7\u30ed\u30ad\u30b7\n            proxy_pass http://backend-api:8080/public/;\n            proxy_set_header Host $host;\n        }\n\n        # \u8a8d\u8a3c\u304c\u5fc5\u8981\u306a\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff08\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3057\uff09\n        location /api/private/ {\n            proxy_pass http://backend-api:8080/private/;\n            proxy_set_header Host $host;\n            proxy_set_header Authorization $http_authorization;\n\n            # \u30ad\u30e3\u30c3\u30b7\u30e5\u7121\u52b9\u5316\n            proxy_no_cache 1;\n            proxy_cache_bypass 1;\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"52-cors\u8a2d\u5b9a",children:"5.2 CORS\u8a2d\u5b9a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              CORS (Cross-Origin Resource Sharing)            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u30d6\u30e9\u30a6\u30b6 (https://example.com)                              \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u2502 OPTIONS /users (\u30d7\u30ea\u30d5\u30e9\u30a4\u30c8\u30ea\u30af\u30a8\u30b9\u30c8)              \u2502\n\u2502      \u25bc                                                      \u2502\n\u2502  API Gateway (https://api.example.com)                      \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u2502 \u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc:                                  \u2502\n\u2502      \u2502 Access-Control-Allow-Origin: https://example.com    \u2502\n\u2502      \u2502 Access-Control-Allow-Methods: GET,POST,PUT,DELETE   \u2502\n\u2502      \u2502 Access-Control-Allow-Headers: Content-Type,Authorization \u2502\n\u2502      \u2502 Access-Control-Max-Age: 3600                        \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u2502 200 OK                                               \u2502\n\u2502      \u25bc                                                      \u2502\n\u2502  \u30d6\u30e9\u30a6\u30b6\uff08CORS\u8a31\u53ef\u78ba\u8a8d\uff09                                    \u2502\n\u2502      \u2502                                                      \u2502\n\u2502      \u2502 \u5b9f\u969b\u306e\u30ea\u30af\u30a8\u30b9\u30c8: GET /users                         \u2502\n\u2502      \u25bc                                                      \u2502\n\u2502  API Gateway                                                 \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsx)(e.h4,{id:"nginx\u3067\u306ecors\u8a2d\u5b9a",children:"Nginx\u3067\u306eCORS\u8a2d\u5b9a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"server {\n    listen 443 ssl http2;\n    server_name api.example.com;\n\n    location /api/ {\n        # \u30d7\u30ea\u30d5\u30e9\u30a4\u30c8\u30ea\u30af\u30a8\u30b9\u30c8\uff08OPTIONS\uff09\u3078\u306e\u5fdc\u7b54\n        if ($request_method = 'OPTIONS') {\n            add_header 'Access-Control-Allow-Origin' 'https://example.com' always;\n            add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;\n            add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-API-Key' always;\n            add_header 'Access-Control-Max-Age' 3600 always;\n            add_header 'Content-Type' 'text/plain; charset=utf-8' always;\n            add_header 'Content-Length' 0 always;\n            return 204;\n        }\n\n        # \u5b9f\u969b\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3078\u306eCORS\u30d8\u30c3\u30c0\u30fc\u8ffd\u52a0\n        add_header 'Access-Control-Allow-Origin' 'https://example.com' always;\n        add_header 'Access-Control-Allow-Credentials' 'true' always;\n\n        proxy_pass http://backend-api:8080/;\n        proxy_set_header Host $host;\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h4,{id:"\u8907\u6570\u30aa\u30ea\u30b8\u30f3\u3078\u306e\u5bfe\u5fdc",children:"\u8907\u6570\u30aa\u30ea\u30b8\u30f3\u3078\u306e\u5bfe\u5fdc"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"# \u8907\u6570\u306e\u30aa\u30ea\u30b8\u30f3\u3092\u8a31\u53ef\u3059\u308b\u5834\u5408\n\nmap $http_origin $cors_origin {\n    default \"\";\n    \"~^https://example\\.com$\" $http_origin;\n    \"~^https://app\\.example\\.com$\" $http_origin;\n    \"~^http://localhost:3000$\" $http_origin;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name api.example.com;\n\n    location /api/ {\n        if ($request_method = 'OPTIONS') {\n            add_header 'Access-Control-Allow-Origin' $cors_origin always;\n            add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;\n            add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization' always;\n            add_header 'Access-Control-Max-Age' 3600 always;\n            return 204;\n        }\n\n        add_header 'Access-Control-Allow-Origin' $cors_origin always;\n\n        proxy_pass http://backend-api:8080/;\n    }\n}\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"6-\u30ed\u30b0\u3068\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0",children:"6. \u30ed\u30b0\u3068\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0"}),"\n",(0,a.jsx)(e.h3,{id:"61-\u30a2\u30af\u30bb\u30b9\u30ed\u30b0",children:"6.1 \u30a2\u30af\u30bb\u30b9\u30ed\u30b0"}),"\n",(0,a.jsx)(e.p,{children:"Nginx\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u8ffd\u8de1:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"http {\n    # \u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n    log_format api_log '$remote_addr - $remote_user [$time_local] '\n                       '\"$request\" $status $body_bytes_sent '\n                       '\"$http_referer\" \"$http_user_agent\" '\n                       '$request_time $upstream_response_time '\n                       '\"$http_x_api_key\"';\n\n    server {\n        listen 443 ssl http2;\n        server_name api.example.com;\n\n        # \u30a2\u30af\u30bb\u30b9\u30ed\u30b0\n        access_log /var/log/nginx/api-access.log api_log;\n\n        # \u30a8\u30e9\u30fc\u30ed\u30b0\n        error_log /var/log/nginx/api-error.log warn;\n\n        location /api/ {\n            proxy_pass http://backend-api:8080/;\n            proxy_set_header Host $host;\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"62-\u30e1\u30c8\u30ea\u30af\u30b9\u53ce\u96c6",children:"6.2 \u30e1\u30c8\u30ea\u30af\u30b9\u53ce\u96c6"}),"\n",(0,a.jsx)(e.p,{children:"\u30ea\u30af\u30a8\u30b9\u30c8\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u53ce\u96c6\uff08Prometheus\u3068\u306e\u7d71\u5408\u4f8b\uff09:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-nginx",children:"# nginx-module-vts \u307e\u305f\u306f nginx-prometheus-exporter \u3092\u4f7f\u7528\n\nserver {\n    listen 9113;  # \u30e1\u30c8\u30ea\u30af\u30b9\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n    server_name localhost;\n\n    location /metrics {\n        # Prometheus\u30e1\u30c8\u30ea\u30af\u30b9\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\n        # nginx-module-vts\u306e\u5834\u5408: vhost_traffic_status_display;\n        # nginx-prometheus-exporter\u306e\u5834\u5408: stub_status;\n        stub_status;\n    }\n}\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"\u307e\u3068\u3081",children:"\u307e\u3068\u3081"}),"\n",(0,a.jsx)(e.h3,{id:"\u5b66\u3093\u3060\u3053\u3068",children:"\u5b66\u3093\u3060\u3053\u3068"}),"\n",(0,a.jsx)(e.p,{children:"\u672c\u7ae0\u3067\u306f\u3001\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068API Gateway\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3057\u305f:"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068API Gateway\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u672c\u6982\u5ff5"}),"\n",(0,a.jsx)(e.li,{children:"Nginx\u3092\u4f7f\u7528\u3057\u305f\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a"}),"\n",(0,a.jsx)(e.li,{children:"\u30d1\u30b9\u30d9\u30fc\u30b9\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9f\u88c5"}),"\n",(0,a.jsx)(e.li,{children:"\u8a8d\u8a3c\u65b9\u5f0f\uff08Basic\u8a8d\u8a3c\u3001API\u30ad\u30fc\u3001JWT\uff09"}),"\n",(0,a.jsx)(e.li,{children:"\u30ec\u30fc\u30c8\u5236\u9650\u3068\u30b9\u30ed\u30c3\u30c8\u30ea\u30f3\u30b0\u306e\u5b9f\u88c5"}),"\n",(0,a.jsx)(e.li,{children:"\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u306b\u3088\u308b\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316"}),"\n",(0,a.jsx)(e.li,{children:"CORS\u8a2d\u5b9a"}),"\n",(0,a.jsx)(e.li,{children:"\u30ed\u30b0\u3068\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0"}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8",children:"\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"1. \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u5f79\u5272\n   - \u5358\u4e00\u30a8\u30f3\u30c8\u30ea\u30fc\u30dd\u30a4\u30f3\u30c8\n   - SSL/TLS\u7d42\u7aef\n   - \u8a8d\u8a3c\u30fb\u8a8d\u53ef\u306e\u4e00\u5143\u5316\n   - \u30ec\u30fc\u30c8\u5236\u9650\u3068\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\n\n2. \u30d1\u30b9\u30d9\u30fc\u30b9\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\n   - /api/v1/* \u2192 APIv1\u30b5\u30fc\u30d0\u30fc\n   - /api/v2/* \u2192 APIv2\u30b5\u30fc\u30d0\u30fc\n   - /static/* \u2192 \u9759\u7684\u30b3\u30f3\u30c6\u30f3\u30c4\n   - \u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u7d71\u5408\u306b\u6709\u52b9\n\n3. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\n   - Basic\u8a8d\u8a3c\uff08\u30b7\u30f3\u30d7\u30eb\uff09\n   - API\u30ad\u30fc\u8a8d\u8a3c\uff08\u4e2d\u9593\uff09\n   - JWT\u8a8d\u8a3c\uff08\u63a8\u5968\uff09\n\n4. \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316\n   - \u30ec\u30fc\u30c8\u5236\u9650\u3067\u30b5\u30fc\u30d3\u30b9\u4fdd\u8b77\n   - \u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u3067\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u8ca0\u8377\u8efd\u6e1b\n   - \u9069\u5207\u306aTTL\u8a2d\u5b9a\n\n5. CORS\u8a2d\u5b9a\n   - \u30d7\u30ea\u30d5\u30e9\u30a4\u30c8\u30ea\u30af\u30a8\u30b9\u30c8\u5bfe\u5fdc\n   - \u8907\u6570\u30aa\u30ea\u30b8\u30f3\u30b5\u30dd\u30fc\u30c8\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u25a1 HTTPS/TLS\u5fc5\u9808\uff08Let's Encrypt\u3067\u8a3c\u660e\u66f8\u53d6\u5f97\uff09\n\u25a1 \u9069\u5207\u306a\u8a8d\u8a3c\u65b9\u5f0f\u306e\u9078\u629e\uff08JWT\u63a8\u5968\uff09\n\u25a1 \u30ec\u30fc\u30c8\u5236\u9650\u3067DDoS\u5bfe\u7b56\n\u25a1 \u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u5411\u4e0a\n\u25a1 CORS\u3092\u9069\u5207\u306b\u8a2d\u5b9a\n\u25a1 \u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3067\u76e3\u8996\n\u25a1 \u30e1\u30c8\u30ea\u30af\u30b9\u53ce\u96c6\uff08Prometheus\u7b49\uff09\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/network-troubleshooting",children:"06-network-troubleshooting.md"})," - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/networking/load-balancing",children:"03-load-balancing.md"})," - \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b7\u30f3\u30b0\u306e\u8a73\u7d30"]}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"\u53c2\u8003\u30ea\u30f3\u30af",children:"\u53c2\u8003\u30ea\u30f3\u30af"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"https://nginx.org/en/docs/",children:"Nginx Documentation"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/",children:"Nginx Reverse Proxy"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"https://www.haproxy.org/documentation.html",children:"HAProxy Documentation"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS",children:"CORS MDN Documentation"})}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>l});var s=i(96540);const a={},r=s.createContext(a);function t(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:t(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);