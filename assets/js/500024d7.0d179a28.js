"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[249],{79805:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"content_06_developer-guide/application-plane/authentication","title":"\u8a8d\u8a3c\u5b9f\u88c5\u30ac\u30a4\u30c9","description":"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684","source":"@site/docs/content_06_developer-guide/03-application-plane/04-authentication.md","sourceDirName":"content_06_developer-guide/03-application-plane","slug":"/content_06_developer-guide/application-plane/authentication","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_06_developer-guide/03-application-plane/04-authentication.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"docs","previous":{"title":"Token Endpoint\u5b9f\u88c5\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/token-endpoint"},"next":{"title":"UserInfo\u5b9f\u88c5\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_06_developer-guide/application-plane/userinfo"}}');var s=t(74848),r=t(28453);const c={},a="\u8a8d\u8a3c\u5b9f\u88c5\u30ac\u30a4\u30c9",o={},d=[{value:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",id:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",level:2},{value:"\u6240\u8981\u6642\u9593",id:"\u6240\u8981\u6642\u9593",level:3},{value:"\u524d\u63d0\u77e5\u8b58",id:"\u524d\u63d0\u77e5\u8b58",level:3},{value:"\u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3\u3068\u306f",id:"\u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3\u3068\u306f",level:2},{value:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",id:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",level:2},{value:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",id:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",level:3},{value:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",id:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",level:3},{value:"\u30c7\u30fc\u30bf\u30d5\u30ed\u30fc",id:"\u30c7\u30fc\u30bf\u30d5\u30ed\u30fc",level:3},{value:"AuthenticationTransaction\uff08\u8a8d\u8a3c\u72b6\u614b\u7ba1\u7406\uff09",id:"authenticationtransaction\u8a8d\u8a3c\u72b6\u614b\u7ba1\u7406",level:2},{value:"\u5f79\u5272",id:"\u5f79\u5272",level:3},{value:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9",id:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9",level:3},{value:"\u72b6\u614b\u9077\u79fb",id:"\u72b6\u614b\u9077\u79fb",level:3},{value:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",id:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",level:2},{value:"\u8a8d\u8a3c\u65b9\u5f0f\uff08Interaction Type\uff09",id:"\u8a8d\u8a3c\u65b9\u5f0finteraction-type",level:2},{value:"\u5b9f\u88c5\u306e\u5168\u4f53\u30d5\u30ed\u30fc",id:"\u5b9f\u88c5\u306e\u5168\u4f53\u30d5\u30ed\u30fc",level:2},{value:"EntryService\u5b9f\u88c5",id:"entryservice\u5b9f\u88c5",level:2},{value:"\u5b9f\u969b\u306e\u51e6\u7406\u30d5\u30ed\u30fc\uff0810\u30b9\u30c6\u30c3\u30d7\uff09",id:"\u5b9f\u969b\u306e\u51e6\u7406\u30d5\u30ed\u30fc10\u30b9\u30c6\u30c3\u30d7",level:3},{value:"\u30ec\u30b9\u30dd\u30f3\u30b9\u69cb\u9020",id:"\u30ec\u30b9\u30dd\u30f3\u30b9\u69cb\u9020",level:3},{value:"\u8a8d\u8a3c\u6210\u529f\uff08\u5358\u4e00\u8a8d\u8a3c\u306e\u5834\u5408\uff09",id:"\u8a8d\u8a3c\u6210\u529f\u5358\u4e00\u8a8d\u8a3c\u306e\u5834\u5408",level:4},{value:"\u8a8d\u8a3c\u6210\u529f\uff08\u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981\u306a\u5834\u5408\uff09",id:"\u8a8d\u8a3c\u6210\u529f\u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981\u306a\u5834\u5408",level:4},{value:"\u8a8d\u8a3c\u5931\u6557",id:"\u8a8d\u8a3c\u5931\u6557",level:4},{value:"\u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af",id:"\u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af",level:4},{value:"\u30dd\u30a4\u30f3\u30c8",id:"\u30dd\u30a4\u30f3\u30c8",level:3},{value:"AuthenticationInteractor\uff08Plugin\uff09",id:"authenticationinteractorplugin",level:2},{value:"Password\u8a8d\u8a3c\u306e\u4f8b",id:"password\u8a8d\u8a3c\u306e\u4f8b",level:3},{value:"SMS OTP\u8a8d\u8a3c\u306e\u4f8b",id:"sms-otp\u8a8d\u8a3c\u306e\u4f8b",level:3},{value:"\u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\uff08\u8907\u6570\u8a8d\u8a3c\uff09",id:"\u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\u8907\u6570\u8a8d\u8a3c",level:2},{value:"AuthenticationPolicy\u306e\u69cb\u9020",id:"authenticationpolicy\u306e\u69cb\u9020",level:3},{value:"\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u69cb\u9020",id:"\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u69cb\u9020",level:4},{value:"\u30d5\u30a3\u30fc\u30eb\u30c9\u8aac\u660e",id:"\u30d5\u30a3\u30fc\u30eb\u30c9\u8aac\u660e",level:4},{value:"\u6761\u4ef6\uff08Condition\uff09\u306e\u69cb\u9020",id:"\u6761\u4ef6condition\u306e\u69cb\u9020",level:4},{value:"\u52d5\u4f5c\u4f8b",id:"\u52d5\u4f5c\u4f8b",level:3},{value:"\u4f8b1: \u30d1\u30b9\u30ef\u30fc\u30c9 + SMS \u306e2\u8981\u7d20\u8a8d\u8a3c",id:"\u4f8b1-\u30d1\u30b9\u30ef\u30fc\u30c9--sms-\u306e2\u8981\u7d20\u8a8d\u8a3c",level:4},{value:"\u4f8b2: WebAuthn\u5358\u72ec OR \u30d1\u30b9\u30ef\u30fc\u30c9+SMS\uff08<code>any_of</code>\uff09",id:"\u4f8b2-webauthn\u5358\u72ec-or-\u30d1\u30b9\u30ef\u30fc\u30c9smsany_of",level:4},{value:"\u4f8b3: \u5931\u6557\u56de\u6570\u306b\u3088\u308b\u30ed\u30c3\u30af",id:"\u4f8b3-\u5931\u6557\u56de\u6570\u306b\u3088\u308b\u30ed\u30c3\u30af",level:4},{value:"E2E\u30c6\u30b9\u30c8\u4f8b",id:"e2e\u30c6\u30b9\u30c8\u4f8b",level:2},{value:"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc",id:"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc",level:2},{value:"\u30a8\u30e9\u30fc1: <code>invalid_request</code> - \u8a8d\u8a3c\u5931\u6557",id:"\u30a8\u30e9\u30fc1-invalid_request---\u8a8d\u8a3c\u5931\u6557",level:3},{value:"\u30a8\u30e9\u30fc2: \u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981",id:"\u30a8\u30e9\u30fc2-\u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981",level:3},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:2},{value:"\ud83d\udcd6 \u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"-\u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:3},{value:"\ud83d\udd17 \u8a73\u7d30\u60c5\u5831",id:"-\u8a73\u7d30\u60c5\u5831",level:3}];function l(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u8a8d\u8a3c\u5b9f\u88c5\u30ac\u30a4\u30c9",children:"\u8a8d\u8a3c\u5b9f\u88c5\u30ac\u30a4\u30c9"})}),"\n",(0,s.jsx)(e.h2,{id:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684",children:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3"}),"\uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u3001SMS\u3001FIDO2\u7b49\u306e\u8a8d\u8a3c\u5b9f\u884c\uff09\u306e\u5b9f\u88c5\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u76ee\u6a19\u3067\u3059\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u6240\u8981\u6642\u9593",children:"\u6240\u8981\u6642\u9593"}),"\n",(0,s.jsxs)(e.p,{children:["\u23f1\ufe0f ",(0,s.jsx)(e.strong,{children:"\u7d0430\u5206"})]}),"\n",(0,s.jsx)(e.h3,{id:"\u524d\u63d0\u77e5\u8b58",children:"\u524d\u63d0\u77e5\u8b58"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"/idp-server/docs/content_06_developer-guide/application-plane/authorization-flow",children:"02. Authorization Flow"})}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3\u3068\u306f",children:"\u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3\u3068\u306f"}),"\n",(0,s.jsxs)(e.p,{children:["Authorization Code Flow\u306e\u4e2d\u3067\u3001",(0,s.jsx)(e.strong,{children:"\u30e6\u30fc\u30b6\u30fc\u672c\u4eba\u78ba\u8a8d"}),"\u3092\u884c\u3046\u51e6\u7406\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Authorization Request\n  \u2193\n[\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u8868\u793a]\n  \u2193\n\u3010\u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3\u3011\u2190 \u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5bfe\u8c61\n  \u251c\u2500 \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\n  \u251c\u2500 SMS OTP\u8a8d\u8a3c\n  \u251c\u2500 FIDO2\u8a8d\u8a3c\n  \u2514\u2500 \u306a\u3069\n  \u2193\nAuthorization Code\u767a\u884c\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf",children:"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5168\u4f53\u50cf"}),"\n",(0,s.jsx)(e.h3,{id:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf",children:"30\u79d2\u3067\u7406\u89e3\u3059\u308b\u5168\u4f53\u50cf"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"HTTP\u30ea\u30af\u30a8\u30b9\u30c8\n    \u2193\nController (AuthenticationV1Api) - HTTP\u51e6\u7406\n    \u2193\nEntryService (OAuthFlowEntryService.interact()) - \u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\n    \u251c\u2500 Tenant\u53d6\u5f97\n    \u251c\u2500 AuthorizationRequest\u53d6\u5f97\n    \u251c\u2500 OAuthSession\u53d6\u5f97\n    \u251c\u2500 AuthenticationTransaction\u53d6\u5f97\uff08\u8a8d\u8a3c\u72b6\u614b\uff09\n    \u251c\u2500 AuthenticationInteractor\u9078\u629e\uff08Plugin\uff09\n    \u251c\u2500 \u8a8d\u8a3c\u5b9f\u884c\uff08interact\uff09\n    \u251c\u2500 AuthenticationTransaction\u66f4\u65b0\n    \u251c\u2500 OAuthSession\u66f4\u65b0\uff08\u6210\u529f\u6642\uff09\n    \u251c\u2500 \u30ed\u30c3\u30af\u51e6\u7406\uff08\u5931\u6557\u56de\u6570\u8d85\u904e\u6642\uff09\n    \u2514\u2500 \u30a4\u30d9\u30f3\u30c8\u767a\u884c\n    \u2193\nCore\u5c64 (AuthenticationInteractor) - \u8a8d\u8a3c\u30ed\u30b8\u30c3\u30af\n    \u251c\u2500 PasswordAuthenticationInteractor\n    \u251c\u2500 SmsAuthenticationInteractor\n    \u251c\u2500 EmailAuthenticationInteractor\n    \u251c\u2500 WebAuthnAuthenticationInteractor\n    \u251c\u2500 FidoUafAuthenticationInteractor\n    \u2514\u2500 DeviceAuthenticationInteractor\n    \u2193\nRepository - \u30e6\u30fc\u30b6\u30fc\u691c\u8a3c\u30fb\u8a8d\u8a3c\u72b6\u614b\u4fdd\u5b58\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9",children:"\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u8cac\u52d9"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u30af\u30e9\u30b9"}),(0,s.jsx)(e.th,{children:"\u5c64"}),(0,s.jsx)(e.th,{children:"\u5f79\u5272"}),(0,s.jsx)(e.th,{children:"\u5b9f\u88c5"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"AuthenticationV1Api"})}),(0,s.jsx)(e.td,{children:"Controller"}),(0,s.jsx)(e.td,{children:"HTTP\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(1240).A+"",children:"AuthenticationV1Api.java"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"OAuthFlowEntryService"})}),(0,s.jsx)(e.td,{children:"UseCase"}),(0,s.jsx)(e.td,{children:"\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30fb\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(6282).A+"#L164-L214",children:"OAuthFlowEntryService.java:164-214"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"AuthenticationInteractor"})}),(0,s.jsx)(e.td,{children:"Core"}),(0,s.jsx)(e.td,{children:"\u8a8d\u8a3c\u30ed\u30b8\u30c3\u30af\uff08Plugin\u62e1\u5f35\u53ef\u80fd\uff09"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"libs/idp-server-authentication-interactors/"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"AuthenticationTransaction"})}),(0,s.jsx)(e.td,{children:"Core"}),(0,s.jsx)(e.td,{children:"\u8a8d\u8a3c\u72b6\u614b\u7ba1\u7406\uff08\u5b8c\u4e86\u3057\u305f\u8a8d\u8a3c\u30fb\u6b8b\u308a\u8a8d\u8a3c\uff09"}),(0,s.jsx)(e.td,{children:"Core Domain"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"OAuthSession"})}),(0,s.jsx)(e.td,{children:"Core"}),(0,s.jsx)(e.td,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\uff08\u8a8d\u8a3c\u6210\u529f\u5f8c\u306e\u60c5\u5831\u4fdd\u6301\uff09"}),(0,s.jsx)(e.td,{children:"Core Domain"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"\u30c7\u30fc\u30bf\u30d5\u30ed\u30fc",children:"\u30c7\u30fc\u30bf\u30d5\u30ed\u30fc"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. AuthenticationTransaction\uff08\u8a8d\u8a3c\u958b\u59cb\u6642\u4f5c\u6210\uff09        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - identifier: auth-req-12345                       \u2502\n\u2502  - authenticationPolicy: { success_conditions: ... }\u2502\n\u2502  - interactionResults: {}  \u2190 \u7a7a                      \u2502\n\u2502  - request.user: null                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193 \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u5b9f\u884c\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. AuthenticationTransaction\uff08\u66f4\u65b0\u5f8c\uff09               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - interactionResults: {                            \u2502\n\u2502      "password": {                                  \u2502\n\u2502        successCount: 1, failureCount: 0,           \u2502\n\u2502        attemptCount: 1, method: "password"         \u2502\n\u2502      }                                              \u2502\n\u2502    }                                                \u2502\n\u2502  - request.user: User(sub=user-12345)               \u2502\n\u2502  - isSuccess(): false  \u2190 \u307e\u3060SMS\u5fc5\u8981                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193 SMS\u8a8d\u8a3c\u5b9f\u884c\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. AuthenticationTransaction\uff08\u8a8d\u8a3c\u5b8c\u4e86\uff09             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - interactionResults: {                            \u2502\n\u2502      "password": {successCount: 1, ...},           \u2502\n\u2502      "sms": {successCount: 1, ...}                 \u2502\n\u2502    }                                                \u2502\n\u2502  - request.user: User(sub=user-12345)               \u2502\n\u2502  - isSuccess(): true  \u2190 \u8a8d\u8a3c\u5b8c\u4e86\uff01                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. OAuthSession\uff08\u8a8d\u8a3c\u60c5\u5831\u3092\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u4fdd\u5b58\uff09         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  - user: User(sub=user-12345)                       \u2502\n\u2502  - authentication: Authentication(                  \u2502\n\u2502      methods=["password", "sms"],                  \u2502\n\u2502      acr="urn:mace:incommon:iap:silver"           \u2502\n\u2502    )                                                \u2502\n\u2502  - sessionKey: tenant-12345:client-abc              \u2502\n\u2502  \u2192 Authorization Code\u767a\u884c\u3067\u4f7f\u7528                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"authenticationtransaction\u8a8d\u8a3c\u72b6\u614b\u7ba1\u7406",children:"AuthenticationTransaction\uff08\u8a8d\u8a3c\u72b6\u614b\u7ba1\u7406\uff09"}),"\n",(0,s.jsx)(e.h3,{id:"\u5f79\u5272",children:"\u5f79\u5272"}),"\n",(0,s.jsx)(e.p,{children:"\u8a8d\u8a3c\u30d5\u30ed\u30fc\u5168\u4f53\u306e\u72b6\u614b\u3092\u7ba1\u7406\u3002\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u4fdd\u6301\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"identifier"}),": AuthenticationTransaction\u8b58\u5225\u5b50"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"authorizationIdentifier"}),": \u7d10\u3065\u304fAuthorization Request ID"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"request"}),": \u8a8d\u8a3c\u30ea\u30af\u30a8\u30b9\u30c8\uff08\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u542b\u3080\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"authenticationPolicy"}),": \u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\uff08success/failure/lock\u6761\u4ef6\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"interactionResults"}),": \u5404\u8a8d\u8a3c\u65b9\u5f0f\u306e\u8a66\u884c\u7d50\u679c\uff08\u8a66\u884c\u56de\u6570\u30fb\u6210\u529f\u56de\u6570\u30fb\u5931\u6557\u56de\u6570\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"attributes"}),": \u30ab\u30b9\u30bf\u30e0\u5c5e\u6027"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9",children:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(33636).A+"",children:"AuthenticationTransaction.java"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"public class AuthenticationTransaction {\n\n  AuthenticationTransactionIdentifier identifier;\n  AuthorizationIdentifier authorizationIdentifier;\n  AuthenticationRequest request;\n  AuthenticationPolicy authenticationPolicy;\n  AuthenticationInteractionResults interactionResults;  // \u8a8d\u8a3c\u7d50\u679c\u306e\u96c6\u5408\n  AuthenticationTransactionAttributes attributes;\n\n  /**\n   * \u8a8d\u8a3c\u5b8c\u4e86\u30c1\u30a7\u30c3\u30af\uff08success_conditions\u8a55\u4fa1\uff09\n   */\n  public boolean isSuccess() {\n    if (hasAuthenticationPolicy()) {\n      AuthenticationResultConditionConfig successConditions =\n          authenticationPolicy.successConditions();\n      return MfaConditionEvaluator.isSuccessSatisfied(\n          successConditions, interactionResults);\n    }\n    return interactionResults.containsAnySuccess();\n  }\n\n  /**\n   * \u8a8d\u8a3c\u5931\u6557\u30c1\u30a7\u30c3\u30af\uff08failure_conditions\u8a55\u4fa1\uff09\n   */\n  public boolean isFailure() {\n    if (hasAuthenticationPolicy()) {\n      AuthenticationResultConditionConfig failureConditions =\n          authenticationPolicy.failureConditions();\n      return MfaConditionEvaluator.isFailureSatisfied(\n          failureConditions, interactionResults);\n    }\n    return interactionResults.containsDenyInteraction();\n  }\n\n  /**\n   * \u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af\u30c1\u30a7\u30c3\u30af\uff08lock_conditions\u8a55\u4fa1\uff09\n   */\n  public boolean isLocked() {\n    if (hasAuthenticationPolicy()) {\n      AuthenticationResultConditionConfig lockConditions =\n          authenticationPolicy.lockConditions();\n      return MfaConditionEvaluator.isLockedSatisfied(\n          lockConditions, interactionResults);\n    }\n    return false;\n  }\n\n  /**\n   * \u51e6\u7406\u5b8c\u4e86\u30c1\u30a7\u30c3\u30af\n   */\n  public boolean isComplete() {\n    return isSuccess() || isFailure() || isLocked();\n  }\n\n  /**\n   * \u8a8d\u8a3c\u7d50\u679c\u3067\u66f4\u65b0\n   */\n  public AuthenticationTransaction updateWith(\n      AuthenticationInteractionRequestResult result) {\n\n    Map<String, AuthenticationInteractionResult> resultMap = interactionResults.toMap();\n\n    // \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u66f4\u65b0\n    AuthenticationRequest updatedRequest = updateWithUser(result);\n\n    // \u65e2\u5b58\u306e\u8a8d\u8a3c\u7d50\u679c\u304c\u3042\u308b\u5834\u5408\u306f\u66f4\u65b0\u3001\u306a\u3051\u308c\u3070\u8ffd\u52a0\n    if (interactionResults.contains(result.interactionTypeName())) {\n      AuthenticationInteractionResult foundResult =\n          interactionResults.get(result.interactionTypeName());\n      AuthenticationInteractionResult updatedInteraction = foundResult.updateWith(result);\n      resultMap.put(result.interactionTypeName(), updatedInteraction);\n    } else {\n      // \u65b0\u3057\u3044\u8a8d\u8a3c\u7d50\u679c\u3092\u8ffd\u52a0\n      String operationType = result.operationType().name();\n      String method = result.method();\n      int successCount = result.isSuccess() ? 1 : 0;\n      int failureCount = result.isSuccess() ? 0 : 1;\n      LocalDateTime interactionTime = SystemDateTime.now();\n\n      AuthenticationInteractionResult newResult =\n          new AuthenticationInteractionResult(\n              operationType, method, 1, successCount, failureCount, interactionTime);\n      resultMap.put(result.interactionTypeName(), newResult);\n    }\n\n    AuthenticationInteractionResults updatedResults =\n        new AuthenticationInteractionResults(resultMap);\n\n    return new AuthenticationTransaction(\n        identifier,\n        authorizationIdentifier,\n        updatedRequest,\n        authenticationPolicy,\n        updatedResults,\n        attributes);\n  }\n\n  /**\n   * \u6700\u7d42\u7684\u306aAuthentication\u751f\u6210\uff08Authorization Code\u767a\u884c\u6642\u306b\u4f7f\u7528\uff09\n   */\n  public Authentication authentication() {\n    if (!isSuccess()) {\n      return new Authentication();\n    }\n\n    LocalDateTime time = interactionResults.authenticationTime();\n    List<String> methods = interactionResults.authenticationMethods();\n    String acr = AcrResolver.resolve(authenticationPolicy.acrMappingRules(), methods);\n\n    return new Authentication()\n        .setTime(time)\n        .addMethods(methods)\n        .addAcr(acr);\n  }\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u91cd\u8981\u306a\u5b9f\u88c5\u30dd\u30a4\u30f3\u30c8"}),":"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsxs)(e.strong,{children:[(0,s.jsx)(e.code,{children:"interactionResults"}),"\u3067\u7ba1\u7406"]}),": \u5404\u8a8d\u8a3c\u65b9\u5f0f\u306e\u8a66\u884c\u56de\u6570\u30fb\u6210\u529f\u56de\u6570\u30fb\u5931\u6557\u56de\u6570\u3092\u8a18\u9332"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u6761\u4ef6\u8a55\u4fa1\u306b\u3088\u308b\u5224\u5b9a"}),": ",(0,s.jsx)(e.code,{children:"MfaConditionEvaluator"}),"\u304c",(0,s.jsx)(e.code,{children:"success_conditions"}),"\u7b49\u3092\u8a55\u4fa1"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb"}),": ",(0,s.jsx)(e.code,{children:"updateWith()"}),"\u306f\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsxs)(e.strong,{children:["\u6700\u7d42\u7684\u306a",(0,s.jsx)(e.code,{children:"Authentication"}),"\u751f\u6210"]}),": ",(0,s.jsx)(e.code,{children:"authentication()"}),"\u30e1\u30bd\u30c3\u30c9\u304cACR\u7b49\u3092\u542b\u3080\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u72b6\u614b\u9077\u79fb",children:"\u72b6\u614b\u9077\u79fb"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'[\u521d\u671f\u72b6\u614b]\ninteractionResults: {}\nisSuccess(): false\nisComplete(): false\n    \u2193 \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u6210\u529f\n[\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u5b8c\u4e86]\ninteractionResults: {\n  "password": {successCount: 1, failureCount: 0, attemptCount: 1}\n}\nisSuccess(): false\uff082\u8981\u7d20\u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\u306e\u5834\u5408\uff09\nisComplete(): false  \u2190 \u307e\u3060\u5b8c\u4e86\u3057\u3066\u3044\u306a\u3044\n    \u2193 SMS\u8a8d\u8a3c\u6210\u529f\n[\u8a8d\u8a3c\u5b8c\u4e86]\ninteractionResults: {\n  "password": {successCount: 1, failureCount: 0, attemptCount: 1},\n  "sms": {successCount: 1, failureCount: 0, attemptCount: 1}\n}\nisSuccess(): true  \u2190 success_conditions\u6e80\u305f\u3057\u305f\nisComplete(): true\n    \u2193\nAuthorization Code\u767a\u884c\u53ef\u80fd\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5224\u5b9a\u30e1\u30bd\u30c3\u30c9\u306e\u4f7f\u3044\u5206\u3051"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"isSuccess()"}),": \u8a8d\u8a3c\u6210\u529f\uff08",(0,s.jsx)(e.code,{children:"success_conditions"}),"\u3092\u6e80\u305f\u3059\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"isFailure()"}),": \u8a8d\u8a3c\u5931\u6557\uff08",(0,s.jsx)(e.code,{children:"failure_conditions"}),"\u3092\u6e80\u305f\u3059\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"isLocked()"}),": \u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af\uff08",(0,s.jsx)(e.code,{children:"lock_conditions"}),"\u3092\u6e80\u305f\u3059\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"isComplete()"}),": \u51e6\u7406\u5b8c\u4e86\uff08success/failure/locked\u306e\u3044\u305a\u308c\u304b\uff09"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",children:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'POST /{tenant-id}/v1/authentications/{authorization-request-id}/{interaction-type}\n{\n  "username": "user@example.com",\n  "password": "secret"\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(1240).A+"",children:"AuthenticationV1Api.java"})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u8a8d\u8a3c\u65b9\u5f0finteraction-type",children:"\u8a8d\u8a3c\u65b9\u5f0f\uff08Interaction Type\uff09"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Type"}),(0,s.jsx)(e.th,{children:"\u8aac\u660e"}),(0,s.jsx)(e.th,{children:"\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"password"})}),(0,s.jsx)(e.td,{children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c"}),(0,s.jsxs)(e.td,{children:[(0,s.jsx)(e.code,{children:"username"}),", ",(0,s.jsx)(e.code,{children:"password"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"sms"})}),(0,s.jsx)(e.td,{children:"SMS OTP\u8a8d\u8a3c"}),(0,s.jsxs)(e.td,{children:[(0,s.jsx)(e.code,{children:"phone_number"}),", ",(0,s.jsx)(e.code,{children:"otp_code"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"email"})}),(0,s.jsx)(e.td,{children:"Email OTP\u8a8d\u8a3c"}),(0,s.jsxs)(e.td,{children:[(0,s.jsx)(e.code,{children:"email"}),", ",(0,s.jsx)(e.code,{children:"otp_code"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"webauthn"})}),(0,s.jsx)(e.td,{children:"WebAuthn/FIDO2"}),(0,s.jsxs)(e.td,{children:[(0,s.jsx)(e.code,{children:"credential"}),", ",(0,s.jsx)(e.code,{children:"authenticator_data"}),", ",(0,s.jsx)(e.code,{children:"signature"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"fido_uaf"})}),(0,s.jsx)(e.td,{children:"FIDO UAF"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"uaf_response"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"device"})}),(0,s.jsx)(e.td,{children:"\u30c7\u30d0\u30a4\u30b9\u8a8d\u8a3c"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"device_id"})})]})]})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u8a2d\u5b9a\u99c6\u52d5"}),": \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306b\u6709\u52b9\u306a\u8a8d\u8a3c\u65b9\u5f0f\u3092\u8a2d\u5b9a\u53ef\u80fd"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u5b9f\u88c5\u306e\u5168\u4f53\u30d5\u30ed\u30fc",children:"\u5b9f\u88c5\u306e\u5168\u4f53\u30d5\u30ed\u30fc"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'1. [\u30e6\u30fc\u30b6\u30fc] \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3067\u8a8d\u8a3c\u60c5\u5831\u5165\u529b\n   \u2193\n2. [\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9] \u8a8d\u8a3c\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\nPOST /{tenant-id}/v1/authentications/{auth-request-id}/password\n{\n  "username": "user@example.com",\n  "password": "secret123"\n}\n   \u2193\n3. [AuthenticationV1Api] \u30ea\u30af\u30a8\u30b9\u30c8\u53d7\u4fe1\n   \u2193\n4. [OAuthFlowEntryService.interact()] \u547c\u3073\u51fa\u3057\n   \u2193\n5. [OAuthProtocol] AuthenticationInteractor\u9078\u629e\n   \u2193\n6. [PasswordAuthenticationInteractor] \u30d1\u30b9\u30ef\u30fc\u30c9\u691c\u8a3c\n   \u2193\n7. [AuthenticationTransaction] \u66f4\u65b0\uff08\u8a8d\u8a3c\u72b6\u614b\u3092\u8a18\u9332\uff09\n   \u2193\n8. [\u30ec\u30b9\u30dd\u30f3\u30b9] \u8a8d\u8a3c\u7d50\u679c\u8fd4\u5374\n{\n  "status": "authenticated",\n  "next_step": "authorize"  // \u307e\u305f\u306f "additional_authentication"\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"entryservice\u5b9f\u88c5",children:"EntryService\u5b9f\u88c5"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(6282).A+"#L164-L214",children:"OAuthFlowEntryService.java:164-214"})]}),"\n",(0,s.jsx)(e.h3,{id:"\u5b9f\u969b\u306e\u51e6\u7406\u30d5\u30ed\u30fc10\u30b9\u30c6\u30c3\u30d7",children:"\u5b9f\u969b\u306e\u51e6\u7406\u30d5\u30ed\u30fc\uff0810\u30b9\u30c6\u30c3\u30d7\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"@Transaction\npublic class OAuthFlowEntryService implements OAuthFlowApi {\n\n  OAuthProtocols oAuthProtocols;\n  OAuthSessionDelegate oAuthSessionDelegate;\n  AuthenticationInteractors authenticationInteractors;\n  AuthenticationTransactionQueryRepository authenticationTransactionQueryRepository;\n  AuthenticationTransactionCommandRepository authenticationTransactionCommandRepository;\n  UserQueryRepository userQueryRepository;\n  OAuthFlowEventPublisher eventPublisher;\n  UserLifecycleEventPublisher userLifecycleEventPublisher;\n\n  @Override\n  public AuthenticationInteractionRequestResult interact(\n      TenantIdentifier tenantIdentifier,\n      AuthorizationRequestIdentifier authorizationRequestIdentifier,\n      AuthenticationInteractionType type,\n      AuthenticationInteractionRequest request,\n      RequestAttributes requestAttributes) {\n\n    // 1. Tenant\u53d6\u5f97\n    Tenant tenant = tenantQueryRepository.get(tenantIdentifier);\n\n    // 2. AuthorizationRequest\u53d6\u5f97\n    OAuthProtocol oAuthProtocol = oAuthProtocols.get(tenant.authorizationProvider());\n    AuthorizationRequest authorizationRequest =\n        oAuthProtocol.get(tenant, authorizationRequestIdentifier);\n\n    // 3. OAuthSession\u53d6\u5f97\u307e\u305f\u306f\u521d\u671f\u5316\n    OAuthSession oAuthSession =\n        oAuthSessionDelegate.findOrInitialize(authorizationRequest.sessionKey());\n\n    // 4. AuthenticationTransaction\u53d6\u5f97\n    AuthorizationIdentifier authorizationIdentifier =\n        new AuthorizationIdentifier(authorizationRequestIdentifier.value());\n    AuthenticationTransaction authenticationTransaction =\n        authenticationTransactionQueryRepository.get(tenant, authorizationIdentifier);\n\n    // 5. AuthenticationInteractor\u9078\u629e\uff08Plugin\uff09\n    AuthenticationInteractor interactor = authenticationInteractors.get(type);\n\n    // 6. \u8a8d\u8a3c\u5b9f\u884c\n    AuthenticationInteractionRequestResult result =\n        interactor.interact(  // \u2190 authenticate()\u3067\u306f\u306a\u304finteract()\n            tenant,\n            authenticationTransaction,\n            type,\n            request,\n            requestAttributes,\n            userQueryRepository);\n\n    // 7. AuthenticationTransaction\u66f4\u65b0\n    AuthenticationTransaction updatedTransaction =\n        authenticationTransaction.updateWith(result);\n    authenticationTransactionCommandRepository.update(tenant, updatedTransaction);\n\n    // 8. OAuthSession\u66f4\u65b0\uff08\u8a8d\u8a3c\u6210\u529f\u6642\uff09\n    if (result.isSuccess()) {\n      OAuthSession updated =\n          oAuthSession.didAuthentication(result.user(), updatedTransaction.authentication());\n      oAuthSessionDelegate.updateSession(updated);\n    }\n\n    // 9. \u30ed\u30c3\u30af\u51e6\u7406\uff08\u5931\u6557\u56de\u6570\u8d85\u904e\u6642\uff09\n    if (updatedTransaction.isLocked()) {\n      UserLifecycleEvent userLifecycleEvent =\n          new UserLifecycleEvent(tenant, updatedTransaction.user(), UserLifecycleType.LOCK);\n      userLifecycleEventPublisher.publish(userLifecycleEvent);\n    }\n\n    // 10. \u30a4\u30d9\u30f3\u30c8\u767a\u884c\uff08Security Event\uff09\n    eventPublisher.publish(\n        tenant, authorizationRequest, result.user(), result.eventType(), requestAttributes);\n\n    return result;\n  }\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u30ec\u30b9\u30dd\u30f3\u30b9\u69cb\u9020",children:"\u30ec\u30b9\u30dd\u30f3\u30b9\u69cb\u9020"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(61319).A+"#L67-L91",children:"PasswordAuthenticationInteractor.java:67-91"})]}),"\n",(0,s.jsxs)(e.p,{children:["\u30ec\u30b9\u30dd\u30f3\u30b9\u306f",(0,s.jsx)(e.code,{children:"AuthenticationInteractionRequestResult.response()"}),"\u304b\u3089\u53d6\u5f97\u3055\u308c\u307e\u3059\uff08",(0,s.jsx)(e.code,{children:"Map<String, Object>"}),"\uff09\u3002"]}),"\n",(0,s.jsx)(e.h4,{id:"\u8a8d\u8a3c\u6210\u529f\u5358\u4e00\u8a8d\u8a3c\u306e\u5834\u5408",children:"\u8a8d\u8a3c\u6210\u529f\uff08\u5358\u4e00\u8a8d\u8a3c\u306e\u5834\u5408\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "user": {\n    "sub": "user-12345",\n    "email": "user@example.com",\n    "name": "John Doe",\n    "email_verified": true,\n    "phone_number": "+81-90-1234-5678"\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": Interactor\u304c",(0,s.jsx)(e.code,{children:'response.put("user", user.toMinimalizedMap())'}),"\u3067\u69cb\u7bc9"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"HTTP Status"}),": ",(0,s.jsx)(e.code,{children:"200 OK"})," (",(0,s.jsx)(e.code,{children:"AuthenticationInteractionStatus.SUCCESS"}),")"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h4,{id:"\u8a8d\u8a3c\u6210\u529f\u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981\u306a\u5834\u5408",children:"\u8a8d\u8a3c\u6210\u529f\uff08\u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981\u306a\u5834\u5408\uff09"}),"\n",(0,s.jsxs)(e.p,{children:["\u8ffd\u52a0\u8a8d\u8a3c\u304c\u5fc5\u8981\u306a\u5834\u5408\u3082\u540c\u3058\u30ec\u30b9\u30dd\u30f3\u30b9\u69cb\u9020\u3067\u3059\u304c\u3001\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306f",(0,s.jsx)(e.code,{children:"AuthenticationTransaction.isAuthenticated()"}),"\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u3092\u5224\u5b9a\u3057\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "user": {\n    "sub": "user-12345",\n    "email": "user@example.com",\n    "name": "John Doe"\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5224\u5b9a\u30ed\u30b8\u30c3\u30af\uff08\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u5074\uff09"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:'// AuthenticationTransaction\u3092\u5225\u9014\u53d6\u5f97\u3057\u3066\u5224\u5b9a\nGET /{tenant-id}/v1/authentications/{auth-req-id}\n\u2192 {\n  "is_authenticated": false,\n  "completed_methods": ["password"],\n  "authentication_policy": {\n    "success_conditions": { ... }\n  }\n}\n\n// is_authenticated=false \u2192 \u8ffd\u52a0\u8a8d\u8a3c\u304c\u5fc5\u8981\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h4,{id:"\u8a8d\u8a3c\u5931\u6557",children:"\u8a8d\u8a3c\u5931\u6557"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "error": "invalid_request",\n  "error_description": "user is not found or invalid password"\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": Interactor\u304c",(0,s.jsx)(e.code,{children:'response.put("error", ...)'}),"\u3067\u69cb\u7bc9"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"HTTP Status"}),": ",(0,s.jsx)(e.code,{children:"400 Bad Request"})," (",(0,s.jsx)(e.code,{children:"AuthenticationInteractionStatus.CLIENT_ERROR"}),")"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9\u7a2e\u985e"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"invalid_request"}),": \u30e6\u30fc\u30b6\u30fc\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u6b63"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"invalid_otp"}),": OTP\u30b3\u30fc\u30c9\u304c\u4e0d\u6b63"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"otp_expired"}),": OTP\u30b3\u30fc\u30c9\u304c\u671f\u9650\u5207\u308c"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"device_not_found"}),": \u30c7\u30d0\u30a4\u30b9\u304c\u898b\u3064\u304b\u3089\u306a\u3044"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h4,{id:"\u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af",children:"\u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af"}),"\n",(0,s.jsxs)(e.p,{children:["\u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af\u306f",(0,s.jsx)(e.code,{children:"AuthenticationTransaction.isLocked()"}),"\u3067\u5224\u5b9a\u3055\u308c\u3001",(0,s.jsx)(e.code,{children:"UserLifecycleEvent"}),"\u304c\u767a\u884c\u3055\u308c\u307e\u3059\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u30ec\u30b9\u30dd\u30f3\u30b9"}),"\uff08\u30ed\u30c3\u30af\u5f8c\u306e\u8a8d\u8a3c\u8a66\u884c\u6642\uff09:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "error": "account_locked",\n  "error_description": "Account has been locked due to too many failed attempts"\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"HTTP Status"}),": ",(0,s.jsx)(e.code,{children:"403 Forbidden"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u30ed\u30c3\u30af\u51e6\u7406\u306e\u6d41\u308c"}),":"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\u5931\u6557\u56de\u6570\u304c",(0,s.jsx)(e.code,{children:"lock_conditions"}),"\u3092\u6e80\u305f\u3059\uff08\u4f8b: 5\u56de\uff09"]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"AuthenticationTransaction.isLocked() = true"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"UserLifecycleEvent(type=LOCK)"}),"\u767a\u884c"]}),"\n",(0,s.jsxs)(e.li,{children:["\u6b21\u56de\u306e\u8a8d\u8a3c\u8a66\u884c\u6642\u306b",(0,s.jsx)(e.code,{children:"account_locked"}),"\u30a8\u30e9\u30fc"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u30dd\u30a4\u30f3\u30c8",children:"\u30dd\u30a4\u30f3\u30c8"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"10\u30b9\u30c6\u30c3\u30d7\u306e\u8a73\u7d30\u51e6\u7406"}),": Tenant\u53d6\u5f97\u304b\u3089\u30a4\u30d9\u30f3\u30c8\u767a\u884c\u307e\u3067"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"OAuthSession\u7ba1\u7406"}),": \u8a8d\u8a3c\u6210\u529f\u6642\u306b\u30bb\u30c3\u30b7\u30e7\u30f3\u66f4\u65b0"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"\u30ed\u30c3\u30af\u51e6\u7406"}),": \u5931\u6557\u56de\u6570\u8d85\u904e\u6642\u306bUserLifecycleEvent\u767a\u884c"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Security Event\u767a\u884c"}),": \u5168\u3066\u306e\u8a8d\u8a3c\u8a66\u884c\u3092\u8a18\u9332"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.strong,{children:"Plugin\u9078\u629e"}),": AuthenticationInteractor\u3092\u52d5\u7684\u306b\u9078\u629e"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"authenticationinteractorplugin",children:"AuthenticationInteractor\uff08Plugin\uff09"}),"\n",(0,s.jsx)(e.h3,{id:"password\u8a8d\u8a3c\u306e\u4f8b",children:"Password\u8a8d\u8a3c\u306e\u4f8b"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(61319).A+"",children:"PasswordAuthenticationInteractor.java"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'public class PasswordAuthenticationInteractor implements AuthenticationInteractor {\n\n  UserQueryRepository userQueryRepository;\n  PasswordVerificationDelegation passwordVerificationDelegation;\n\n  @Override\n  public AuthenticationInteractionType type() {\n    return AuthenticationInteractionType.PASSWORD;\n  }\n\n  @Override\n  public AuthenticationInteractionRequestResult interact(  // \u2190 authenticate()\u3067\u306f\u306a\u3044\uff01\n      Tenant tenant,\n      AuthenticationTransaction transaction,\n      AuthenticationInteractionType type,\n      AuthenticationInteractionRequest request,\n      RequestAttributes requestAttributes,\n      UserQueryRepository userQueryRepository) {\n\n    // 1. \u30ea\u30af\u30a8\u30b9\u30c8\u304b\u3089username/password\u53d6\u5f97\n    String username = request.optValueAsString("username", "");\n    String password = request.optValueAsString("password", "");\n\n    // 2. \u30e6\u30fc\u30b6\u30fc\u691c\u7d22\n    User user = userQueryRepository.findByEmail(tenant, username);\n\n    if (user == null) {\n      return AuthenticationInteractionRequestResult.failed("user_not_found");\n    }\n\n    // 3. \u30d1\u30b9\u30ef\u30fc\u30c9\u691c\u8a3c\n    boolean verified = passwordVerificationDelegation.verify(password, user.hashedPassword());\n\n    if (!verified) {\n      return AuthenticationInteractionRequestResult.failed("invalid_password");\n    }\n\n    // 4. \u6210\u529f\n    Authentication authentication = new Authentication(\n        AuthenticationInteractionType.PASSWORD,\n        SystemDateTime.now());\n\n    return AuthenticationInteractionRequestResult.success(user, authentication);\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u30dd\u30a4\u30f3\u30c8"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.code,{children:"interact()"}),"\u30e1\u30bd\u30c3\u30c9\uff08",(0,s.jsx)(e.code,{children:"authenticate()"}),"\u3067\u306f\u306a\u3044\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 ",(0,s.jsx)(e.code,{children:"AuthenticationInteractionRequestResult"}),"\u3092\u8fd4\u5374"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 \u6210\u529f\u6642\u306f",(0,s.jsx)(e.code,{children:"Authentication"}),"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"sms-otp\u8a8d\u8a3c\u306e\u4f8b",children:"SMS OTP\u8a8d\u8a3c\u306e\u4f8b"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(55799).A+"",children:"SmsAuthenticationInteractor.java"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'public class SmsAuthenticationInteractor implements AuthenticationInteractor {\n\n  @Override\n  public AuthenticationInteractionType type() {\n    return AuthenticationInteractionType.SMS;\n  }\n\n  @Override\n  public AuthenticationInteractionRequestResult interact(\n      Tenant tenant,\n      AuthenticationTransaction transaction,\n      AuthenticationInteractionType type,\n      AuthenticationInteractionRequest request,\n      RequestAttributes requestAttributes,\n      UserQueryRepository userQueryRepository) {\n\n    // 1. OTP\u30b3\u30fc\u30c9\u53d6\u5f97\n    String otpCode = request.optValueAsString("otp_code", "");\n\n    // 2. \u30bb\u30c3\u30b7\u30e7\u30f3\u304b\u3089\u671f\u5f85\u5024\u53d6\u5f97\n    String expectedOtp = transaction.smsOtpCode();\n\n    // 3. OTP\u691c\u8a3c\n    if (!otpCode.equals(expectedOtp)) {\n      return AuthenticationInteractionRequestResult.failed("invalid_otp");\n    }\n\n    // 4. \u6709\u52b9\u671f\u9650\u30c1\u30a7\u30c3\u30af\n    if (transaction.isSmsOtpExpired()) {\n      return AuthenticationInteractionRequestResult.failed("otp_expired");\n    }\n\n    // 5. \u6210\u529f\n    User user = transaction.user();\n    Authentication authentication = new Authentication(\n        AuthenticationInteractionType.SMS,\n        SystemDateTime.now());\n\n    return AuthenticationInteractionRequestResult.success(user, authentication);\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u30dd\u30a4\u30f3\u30c8"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u2705 OTP\u30b3\u30fc\u30c9\u306f",(0,s.jsx)(e.code,{children:"AuthenticationTransaction"}),"\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b"]}),"\n",(0,s.jsxs)(e.li,{children:["\u2705 \u6709\u52b9\u671f\u9650\u30c1\u30a7\u30c3\u30af\u3082",(0,s.jsx)(e.code,{children:"AuthenticationTransaction"}),"\u3067\u5b9f\u884c"]}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u5f8c\u306e\u8ffd\u52a0\u8a8d\u8a3c\u3068\u3057\u3066\u4f7f\u7528\u3055\u308c\u308b"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\u8907\u6570\u8a8d\u8a3c",children:"\u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\uff08\u8907\u6570\u8a8d\u8a3c\uff09"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(82393).A+"",children:"AuthenticationPolicy.java"})]}),"\n",(0,s.jsx)(e.h3,{id:"authenticationpolicy\u306e\u69cb\u9020",children:"AuthenticationPolicy\u306e\u69cb\u9020"}),"\n",(0,s.jsxs)(e.p,{children:["\u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\u306f",(0,s.jsx)(e.strong,{children:"\u6761\u4ef6\u30d9\u30fc\u30b9"}),"\u3067\u5b9a\u7fa9\u3055\u308c\u307e\u3059\uff08\u7c21\u7565\u5316\u3055\u308c\u305f",(0,s.jsx)(e.code,{children:"minimum_methods"}),"\u3067\u306f\u3042\u308a\u307e\u305b\u3093\uff09\u3002"]}),"\n",(0,s.jsx)(e.h4,{id:"\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u69cb\u9020",children:"\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u69cb\u9020"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "priority": 1,\n  "available_methods": ["password", "sms", "webauthn", "device"],\n  "success_conditions": {\n    "any_of": [\n      [\n        {"path": "$.methods", "type": "array", "operation": "contains", "value": "password"},\n        {"path": "$.methods", "type": "array", "operation": "contains", "value": "sms"}\n      ],\n      [\n        {"path": "$.methods", "type": "array", "operation": "contains", "value": "webauthn"}\n      ]\n    ]\n  },\n  "failure_conditions": {\n    "any_of": [\n      [\n        {"path": "$.failure_count", "type": "number", "operation": "gte", "value": 3}\n      ]\n    ]\n  },\n  "lock_conditions": {\n    "any_of": [\n      [\n        {"path": "$.failure_count", "type": "number", "operation": "gte", "value": 5}\n      ]\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h4,{id:"\u30d5\u30a3\u30fc\u30eb\u30c9\u8aac\u660e",children:"\u30d5\u30a3\u30fc\u30eb\u30c9\u8aac\u660e"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u30d5\u30a3\u30fc\u30eb\u30c9"}),(0,s.jsx)(e.th,{children:"\u578b"}),(0,s.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"priority"})}),(0,s.jsx)(e.td,{children:"number"}),(0,s.jsx)(e.td,{children:"\u30dd\u30ea\u30b7\u30fc\u306e\u512a\u5148\u9806\u4f4d\uff08\u8907\u6570\u30dd\u30ea\u30b7\u30fc\u6642\u3001\u4f4e\u3044\u5024\u304c\u512a\u5148\uff09"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"available_methods"})}),(0,s.jsx)(e.td,{children:"array"}),(0,s.jsx)(e.td,{children:"UI\u306b\u8868\u793a\u3059\u308b\u8a8d\u8a3c\u65b9\u5f0f\u306e\u30ea\u30b9\u30c8\uff08UI\u30d2\u30f3\u30c8\uff09"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"success_conditions"})}),(0,s.jsx)(e.td,{children:"object"}),(0,s.jsxs)(e.td,{children:["\u8a8d\u8a3c\u6210\u529f\u306e\u6761\u4ef6\uff08",(0,s.jsx)(e.code,{children:"any_of"}),"\u3067\u8907\u6570\u30d1\u30bf\u30fc\u30f3\uff09"]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"failure_conditions"})}),(0,s.jsx)(e.td,{children:"object"}),(0,s.jsx)(e.td,{children:"\u8a8d\u8a3c\u5931\u6557\u306e\u6761\u4ef6"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"lock_conditions"})}),(0,s.jsx)(e.td,{children:"object"}),(0,s.jsx)(e.td,{children:"\u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af\u306e\u6761\u4ef6"})]})]})]}),"\n",(0,s.jsx)(e.h4,{id:"\u6761\u4ef6condition\u306e\u69cb\u9020",children:"\u6761\u4ef6\uff08Condition\uff09\u306e\u69cb\u9020"}),"\n",(0,s.jsxs)(e.p,{children:["\u5404\u6761\u4ef6\u306f",(0,s.jsx)(e.strong,{children:"JSONPath + \u6f14\u7b97\u5b50"}),"\u3067\u5b9a\u7fa9\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "path": "$.methods",        // \u30c1\u30a7\u30c3\u30af\u5bfe\u8c61\uff08JSONPath\uff09\n  "type": "array",            // \u30c7\u30fc\u30bf\u578b\uff08array/number/string\u7b49\uff09\n  "operation": "contains",    // \u6f14\u7b97\u5b50\n  "value": "password"         // \u671f\u5f85\u5024\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u308b\u6f14\u7b97\u5b50"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"contains"}),": \u914d\u5217\u306b\u5024\u3092\u542b\u3080"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"eq"}),": \u7b49\u3057\u3044"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ne"}),": \u7b49\u3057\u304f\u306a\u3044"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"gte"}),": \u4ee5\u4e0a"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"lte"}),": \u4ee5\u4e0b"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"gt"}),": \u3088\u308a\u5927\u304d\u3044"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"lt"}),": \u3088\u308a\u5c0f\u3055\u3044"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u52d5\u4f5c\u4f8b",children:"\u52d5\u4f5c\u4f8b"}),"\n",(0,s.jsx)(e.h4,{id:"\u4f8b1-\u30d1\u30b9\u30ef\u30fc\u30c9--sms-\u306e2\u8981\u7d20\u8a8d\u8a3c",children:"\u4f8b1: \u30d1\u30b9\u30ef\u30fc\u30c9 + SMS \u306e2\u8981\u7d20\u8a8d\u8a3c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "success_conditions": {\n    "any_of": [\n      [\n        {"path": "$.methods", "operation": "contains", "value": "password"},\n        {"path": "$.methods", "operation": "contains", "value": "sms"}\n      ]\n    ]\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u52d5\u4f5c"}),":"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306e\u307f \u2192 ",(0,s.jsx)(e.code,{children:"isAuthenticated() = false"}),"\uff08SMS\u304c\u5fc5\u8981\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:["\u30d1\u30b9\u30ef\u30fc\u30c9 + SMS \u2192 ",(0,s.jsx)(e.code,{children:"isAuthenticated() = true"}),"\uff08\u8a8d\u8a3c\u5b8c\u4e86\uff09"]}),"\n"]}),"\n",(0,s.jsxs)(e.h4,{id:"\u4f8b2-webauthn\u5358\u72ec-or-\u30d1\u30b9\u30ef\u30fc\u30c9smsany_of",children:["\u4f8b2: WebAuthn\u5358\u72ec OR \u30d1\u30b9\u30ef\u30fc\u30c9+SMS\uff08",(0,s.jsx)(e.code,{children:"any_of"}),"\uff09"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "success_conditions": {\n    "any_of": [\n      [\n        {"path": "$.methods", "operation": "contains", "value": "webauthn"}\n      ],\n      [\n        {"path": "$.methods", "operation": "contains", "value": "password"},\n        {"path": "$.methods", "operation": "contains", "value": "sms"}\n      ]\n    ]\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u52d5\u4f5c"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"WebAuthn\u5358\u72ec \u2192 \u8a8d\u8a3c\u5b8c\u4e86"}),"\n",(0,s.jsx)(e.li,{children:"\u30d1\u30b9\u30ef\u30fc\u30c9 + SMS \u2192 \u8a8d\u8a3c\u5b8c\u4e86"}),"\n",(0,s.jsx)(e.li,{children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u307f \u2192 \u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981"}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"\u4f8b3-\u5931\u6557\u56de\u6570\u306b\u3088\u308b\u30ed\u30c3\u30af",children:"\u4f8b3: \u5931\u6557\u56de\u6570\u306b\u3088\u308b\u30ed\u30c3\u30af"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "failure_conditions": {\n    "any_of": [\n      [{"path": "$.failure_count", "operation": "gte", "value": 3}]\n    ]\n  },\n  "lock_conditions": {\n    "any_of": [\n      [{"path": "$.failure_count", "operation": "gte", "value": 5}]\n    ]\n  }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u52d5\u4f5c"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"3\u56de\u5931\u6557 \u2192 \u8a8d\u8a3c\u5931\u6557\u30b9\u30c6\u30fc\u30bf\u30b9"}),"\n",(0,s.jsx)(e.li,{children:"5\u56de\u5931\u6557 \u2192 \u30a2\u30ab\u30a6\u30f3\u30c8\u30ed\u30c3\u30af\uff08UserLifecycleEvent\u767a\u884c\uff09"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"e2e\u30c6\u30b9\u30c8\u4f8b",children:"E2E\u30c6\u30b9\u30c8\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"describe('Authentication Interaction', () => {\n  let tenantId = '18ffff8d-8d97-460f-a71b-33f2e8afd41e';\n  let authReqId;\n\n  beforeAll(async () => {\n    // Authorization Request\u5b9f\u884c\n    const authResponse = await axios.get(\n      `http://localhost:8080/${tenantId}/v1/authorizations`,\n      {\n        params: {\n          response_type: 'code',\n          client_id: 'test-client',\n          redirect_uri: 'https://client.example.com/callback',\n          scope: 'openid'\n        },\n        maxRedirects: 0,\n        validateStatus: (status) => status === 302\n      }\n    );\n\n    const url = new URL(authResponse.headers.location, 'http://localhost');\n    authReqId = url.searchParams.get('id');\n  });\n\n  test('should authenticate with password', async () => {\n    const response = await axios.post(\n      `http://localhost:8080/${tenantId}/v1/authentications/${authReqId}/password`,\n      {\n        username: 'user@example.com',\n        password: 'password123'\n      }\n    );\n\n    expect(response.status).toBe(200);\n    expect(response.data.status).toBe('authenticated');\n  });\n\n  test('should require additional authentication for 2FA', async () => {\n    // \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\n    const passwordResponse = await axios.post(\n      `http://localhost:8080/${tenantId}/v1/authentications/${authReqId}/password`,\n      {\n        username: 'user@example.com',\n        password: 'password123'\n      }\n    );\n\n    expect(passwordResponse.data.status).toBe('additional_authentication_required');\n    expect(passwordResponse.data.next_methods).toContain('sms');\n\n    // SMS OTP\u8a8d\u8a3c\n    const smsResponse = await axios.post(\n      `http://localhost:8080/${tenantId}/v1/authentications/${authReqId}/sms`,\n      {\n        otp_code: '123456'\n      }\n    );\n\n    expect(smsResponse.data.status).toBe('authenticated');\n  });\n});\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc",children:"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc"}),"\n",(0,s.jsxs)(e.h3,{id:"\u30a8\u30e9\u30fc1-invalid_request---\u8a8d\u8a3c\u5931\u6557",children:["\u30a8\u30e9\u30fc1: ",(0,s.jsx)(e.code,{children:"invalid_request"})," - \u8a8d\u8a3c\u5931\u6557"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u969b\u306e\u30ec\u30b9\u30dd\u30f3\u30b9"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "error": "invalid_request",\n  "error_description": "user is not found or invalid password"\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u539f\u56e0"}),": \u30d1\u30b9\u30ef\u30fc\u30c9\u30fbOTP\u30b3\u30fc\u30c9\u7b49\u304c\u4e0d\u6b63"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u89e3\u6c7a\u7b56"}),": \u6b63\u3057\u3044\u8a8d\u8a3c\u60c5\u5831\u3092\u4f7f\u7528"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u88c5"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(61319).A+"",children:"PasswordAuthenticationInteractor.java"})]}),"\n",(0,s.jsx)(e.h3,{id:"\u30a8\u30e9\u30fc2-\u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981",children:"\u30a8\u30e9\u30fc2: \u8ffd\u52a0\u8a8d\u8a3c\u5fc5\u8981"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9f\u969b\u306e\u30ec\u30b9\u30dd\u30f3\u30b9"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n  "status": "authenticated",\n  "next_step": "otp",\n  "message": "Additional authentication required"\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"HTTP Status: 200 OK"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u91cd\u8981"}),": \u8ffd\u52a0\u8a8d\u8a3c\u304c\u5fc5\u8981\u306a\u5834\u5408\u3001\u30a8\u30e9\u30fc\u3067\u306f\u306a\u304f**\u6b63\u5e38\u30b9\u30c6\u30fc\u30bf\u30b9\uff08200\uff09**\u3067\u6b21\u306e\u8a8d\u8a3c\u30b9\u30c6\u30c3\u30d7\u3092\u8fd4\u3059"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u539f\u56e0"}),": \u8a8d\u8a3c\u30dd\u30ea\u30b7\u30fc\u3067\u8907\u6570\u8a8d\u8a3c\u304c\u5fc5\u9808"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u89e3\u6c7a\u7b56"}),": \u30ec\u30b9\u30dd\u30f3\u30b9\u306e",(0,s.jsx)(e.code,{children:"next_step"}),"\u306b\u6307\u5b9a\u3055\u308c\u305f\u8a8d\u8a3c\u65b9\u5f0f\u3092\u5b9f\u884c"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,s.jsx)(e.p,{children:"\u2705 \u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5\u3092\u7406\u89e3\u3057\u305f\uff01"}),"\n",(0,s.jsx)(e.h3,{id:"-\u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\ud83d\udcd6 \u6b21\u306b\u8aad\u3080\u3079\u304d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/idp-server/docs/content_06_developer-guide/application-plane/userinfo",children:"05. UserInfo\u5b9f\u88c5"})," - \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u53d6\u5f97"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/idp-server/docs/content_06_developer-guide/application-plane/ciba-flow",children:"06. CIBA Flow\u5b9f\u88c5"})," - \u30d0\u30c3\u30af\u30c1\u30e3\u30cd\u30eb\u8a8d\u8a3c"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"-\u8a73\u7d30\u60c5\u5831",children:"\ud83d\udd17 \u8a73\u7d30\u60c5\u5831"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"/idp-server/docs/content_10_ai_developer/ai-41-authentication",children:"AI\u958b\u767a\u8005\u5411\u3051: \u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30bf\u30fc"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"../04-implementation-guides/impl-06-authentication-interactor.md",children:"\u5b9f\u88c5\u30ac\u30a4\u30c9: Authentication Interactions"})}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(6282).A+"",children:"OAuthFlowEntryService.java"}),"\n",(0,s.jsx)(e.strong,{children:"\u6700\u7d42\u66f4\u65b0"}),": 2025-10-12"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},61319:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/files/PasswordAuthenticationInteractor-9b4509ad83a9d803bd15be9f38ec52c3.java"},55799:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/files/SmsAuthenticationInteractor-683c1e154b100ba39b68bc0f295a2ffb.java"},33636:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/files/AuthenticationTransaction-3e71d786345f87dc5bc8e73127ed5f8f.java"},82393:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/files/AuthenticationPolicy-c333845c94c91db9c476e0ef98499063.java"},1240:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/files/AuthenticationV1Api-e9588689d0a8645f4fb04129a53a8449.java"},6282:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/files/OAuthFlowEntryService-8505269aef3d2bc988bbb4a493137c59.java"},28453:(n,e,t)=>{t.d(e,{R:()=>c,x:()=>a});var i=t(96540);const s={},r=i.createContext(s);function c(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);