"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[9155],{34097:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"content_06_developer-guide/implementation-guides/oauth-oidc/session-management","title":"OIDC Session Management","description":"\ud83d\udccd \u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f4d\u7f6e\u3065\u3051","source":"@site/docs/content_06_developer-guide/04-implementation-guides/oauth-oidc/session-management.md","sourceDirName":"content_06_developer-guide/04-implementation-guides/oauth-oidc","slug":"/content_06_developer-guide/implementation-guides/oauth-oidc/session-management","permalink":"/idp-server/docs/content_06_developer-guide/implementation-guides/oauth-oidc/session-management","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_06_developer-guide/04-implementation-guides/oauth-oidc/session-management.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Scope & Claims","permalink":"/idp-server/docs/content_06_developer-guide/implementation-guides/oauth-oidc/scope-claims-management"},"next":{"title":"\u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30bf\u30fc","permalink":"/idp-server/docs/content_06_developer-guide/implementation-guides/authentication/authentication-interactor"}}');var t=i(74848),o=i(28453);const r={},d="OIDC Session Management",l={},c=[{value:"\ud83d\udccd \u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f4d\u7f6e\u3065\u3051",id:"-\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f4d\u7f6e\u3065\u3051",level:2},{value:"\ud83c\udfd7\ufe0f \u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",id:"\ufe0f-\u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",level:2},{value:"\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u7a2e\u985e",id:"\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u7a2e\u985e",level:3},{value:"\u30bb\u30c3\u30b7\u30e7\u30f3\u3068Cookie\u306e\u95a2\u4fc2",id:"\u30bb\u30c3\u30b7\u30e7\u30f3\u3068cookie\u306e\u95a2\u4fc2",level:3},{value:"Cookie\u306e\u30d1\u30b9\u30b9\u30b3\u30fc\u30d7\uff08\u30c6\u30ca\u30f3\u30c8\u5206\u96e2\uff09",id:"cookie\u306e\u30d1\u30b9\u30b9\u30b3\u30fc\u30d7\u30c6\u30ca\u30f3\u30c8\u5206\u96e2",level:3},{value:"\ud83d\udccb \u30b3\u30a2\u30af\u30e9\u30b9",id:"-\u30b3\u30a2\u30af\u30e9\u30b9",level:2},{value:"OPSession",id:"opsession",level:3},{value:"ClientSession",id:"clientsession",level:3},{value:"OIDCSessionHandler",id:"oidcsessionhandler",level:3},{value:"\ud83d\udd04 \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb",id:"-\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb",level:2},{value:"1. \u30bb\u30c3\u30b7\u30e7\u30f3\u4f5c\u6210\uff08\u8a8d\u8a3c\u6210\u529f\u6642\uff09",id:"1-\u30bb\u30c3\u30b7\u30e7\u30f3\u4f5c\u6210\u8a8d\u8a3c\u6210\u529f\u6642",level:3},{value:"2. ClientSession\u4f5c\u6210\uff08\u8a8d\u53ef\u6642\uff09",id:"2-clientsession\u4f5c\u6210\u8a8d\u53ef\u6642",level:3},{value:"3. SSO\uff08\u30bb\u30c3\u30b7\u30e7\u30f3\u518d\u5229\u7528\uff09",id:"3-sso\u30bb\u30c3\u30b7\u30e7\u30f3\u518d\u5229\u7528",level:3},{value:"\ud83d\udeaa \u30ed\u30b0\u30a2\u30a6\u30c8",id:"-\u30ed\u30b0\u30a2\u30a6\u30c8",level:2},{value:"RP-Initiated Logout",id:"rp-initiated-logout",level:3},{value:"Back-Channel Logout",id:"back-channel-logout",level:3},{value:"BackChannelLogoutService \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",id:"backchannellogoutservice-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",level:4},{value:"HttpClient\u4f9d\u5b58\u6027\u6ce8\u5165",id:"httpclient\u4f9d\u5b58\u6027\u6ce8\u5165",level:4},{value:"\ud83c\udf6a Cookie\u7ba1\u7406",id:"-cookie\u7ba1\u7406",level:2},{value:"SessionCookieDelegate \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",id:"sessioncookiedelegate-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",level:3},{value:"Spring Boot\u5b9f\u88c5",id:"spring-boot\u5b9f\u88c5",level:3},{value:"\u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97",id:"\u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97",level:3},{value:"\ud83d\uddc4\ufe0f \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8",id:"\ufe0f-\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8",level:2},{value:"OPSessionRepository",id:"opsessionrepository",level:3},{value:"ClientSessionRepository",id:"clientsessionrepository",level:3},{value:"Redis \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u69cb\u9020",id:"redis-\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u69cb\u9020",level:3},{value:"\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u9078\u629e",id:"\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u9078\u629e",level:3},{value:"\ud83d\udd04 \u30bb\u30c3\u30b7\u30e7\u30f3\u5207\u66ff\u30dd\u30ea\u30b7\u30fc",id:"-\u30bb\u30c3\u30b7\u30e7\u30f3\u5207\u66ff\u30dd\u30ea\u30b7\u30fc",level:2},{value:"\u30dd\u30ea\u30b7\u30fc\u4e00\u89a7",id:"\u30dd\u30ea\u30b7\u30fc\u4e00\u89a7",level:3},{value:"\u52d5\u4f5c\u30d5\u30ed\u30fc",id:"\u52d5\u4f5c\u30d5\u30ed\u30fc",level:3},{value:"\u30c6\u30ca\u30f3\u30c8\u8a2d\u5b9a",id:"\u30c6\u30ca\u30f3\u30c8\u8a2d\u5b9a",level:3},{value:"\u5b9f\u88c5",id:"\u5b9f\u88c5",level:3},{value:"\ud83d\udd12 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8003\u616e\u4e8b\u9805",id:"-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8003\u616e\u4e8b\u9805",level:2},{value:"1. \u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30a4\u30b8\u30e3\u30c3\u30af\u5bfe\u7b56",id:"1-\u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30a4\u30b8\u30e3\u30c3\u30af\u5bfe\u7b56",level:3},{value:"2. \u30bb\u30c3\u30b7\u30e7\u30f3\u56fa\u5b9a\u653b\u6483\u5bfe\u7b56",id:"2-\u30bb\u30c3\u30b7\u30e7\u30f3\u56fa\u5b9a\u653b\u6483\u5bfe\u7b56",level:3},{value:"3. max_age \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u691c\u8a3c",id:"3-max_age-\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u691c\u8a3c",level:3},{value:"4. prompt=login \u306e\u51e6\u7406",id:"4-promptlogin-\u306e\u51e6\u7406",level:3},{value:"\ud83c\udfaf \u5c06\u6765\u306e\u62e1\u5f35\u6a5f\u80fd",id:"-\u5c06\u6765\u306e\u62e1\u5f35\u6a5f\u80fd",level:2},{value:"Step-up Authentication\uff08\u8a8d\u8a3c\u30ec\u30d9\u30eb\u7ba1\u7406\uff09",id:"step-up-authentication\u8a8d\u8a3c\u30ec\u30d9\u30eb\u7ba1\u7406",level:3},{value:"\u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u5236\u9650",id:"\u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u5236\u9650",level:3},{value:"\u30c7\u30d0\u30a4\u30b9\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0",id:"\u30c7\u30d0\u30a4\u30b9\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0",level:3},{value:"DPoP\uff08Demonstrating Proof of Possession\uff09",id:"dpopdemonstrating-proof-of-possession",level:3},{value:"\ud83d\udcda \u95a2\u9023\u4ed5\u69d8",id:"-\u95a2\u9023\u4ed5\u69d8",level:2},{value:"\ud83d\udd17 \u95a2\u9023\u30d5\u30a1\u30a4\u30eb",id:"-\u95a2\u9023\u30d5\u30a1\u30a4\u30eb",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"oidc-session-management",children:"OIDC Session Management"})}),"\n",(0,t.jsx)(n.h2,{id:"-\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f4d\u7f6e\u3065\u3051",children:"\ud83d\udccd \u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f4d\u7f6e\u3065\u3051"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5bfe\u8c61\u8aad\u8005"}),": OIDC Session Management\u306e\u5b9f\u88c5\u8a73\u7d30\u3092\u7406\u89e3\u3057\u305f\u3044\u958b\u767a\u8005"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u5b66\u3079\u308b\u3053\u3068"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"OIDC Session Management\u306e\u4ed5\u7d44\u307f"}),"\n",(0,t.jsx)(n.li,{children:"OPSession / ClientSession \u306e\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,t.jsx)(n.li,{children:"IDP_IDENTITY / IDP_SESSION Cookie\u306e\u5f79\u5272"}),"\n",(0,t.jsx)(n.li,{children:"SSO\uff08\u30b7\u30f3\u30b0\u30eb\u30b5\u30a4\u30f3\u30aa\u30f3\uff09\u306e\u5b9f\u88c5"}),"\n",(0,t.jsx)(n.li,{children:"RP-Initiated Logout / Back-Channel Logout \u306e\u5b9f\u88c5"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u524d\u63d0\u77e5\u8b58"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"OAuth 2.0 / OpenID Connect \u306e\u57fa\u790e\u77e5\u8b58"}),"\n",(0,t.jsx)(n.li,{children:"\u8a8d\u53ef\u30b3\u30fc\u30c9\u30d5\u30ed\u30fc\u306e\u7406\u89e3"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-\u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",children:"\ud83c\udfd7\ufe0f \u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3"}),"\n",(0,t.jsx)(n.p,{children:"idp-server\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u306f\u3001Keycloak\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u53c2\u8003\u306b\u8a2d\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u7a2e\u985e",children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u7a2e\u985e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Browser Session                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                    OPSession                             \u2502   \u2502\n\u2502  \u2502  - \u30d6\u30e9\u30a6\u30b6\u3068OP\u306e\u9593\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\uff08SSO\u7528\uff09                    \u2502   \u2502\n\u2502  \u2502  - sub, authTime, acr, amr \u3092\u4fdd\u6301                        \u2502   \u2502\n\u2502  \u2502  - \u8907\u6570\u306eClientSession\u3092\u6301\u3064                             \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502           \u2502                    \u2502                    \u2502           \u2502\n\u2502           \u25bc                    \u25bc                    \u25bc           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502ClientSession\u2502      \u2502ClientSession\u2502      \u2502ClientSession\u2502     \u2502\n\u2502  \u2502  Client A   \u2502      \u2502  Client B   \u2502      \u2502  Client C   \u2502     \u2502\n\u2502  \u2502  sid: xxx   \u2502      \u2502  sid: yyy   \u2502      \u2502  sid: zzz   \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u30bb\u30c3\u30b7\u30e7\u30f3\u3068cookie\u306e\u95a2\u4fc2",children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u3068Cookie\u306e\u95a2\u4fc2"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Cookie\u540d"}),(0,t.jsx)(n.th,{children:"\u5185\u5bb9"}),(0,t.jsx)(n.th,{children:"HttpOnly"}),(0,t.jsx)(n.th,{children:"\u76ee\u7684"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"IDP_IDENTITY"})}),(0,t.jsx)(n.td,{children:"opSessionId"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"SSO\u8b58\u5225\u7528\uff08\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u4f7f\u7528\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"IDP_SESSION"})}),(0,t.jsx)(n.td,{children:"SHA256(opSessionId)"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Session Management iframe\u7528"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-springboot-adapter/src/main/java/org/idp/server/adapters/springboot/application/session/SessionCookieService.java",children:"SessionCookieService.java"})]}),"\n",(0,t.jsx)(n.h3,{id:"cookie\u306e\u30d1\u30b9\u30b9\u30b3\u30fc\u30d7\u30c6\u30ca\u30f3\u30c8\u5206\u96e2",children:"Cookie\u306e\u30d1\u30b9\u30b9\u30b3\u30fc\u30d7\uff08\u30c6\u30ca\u30f3\u30c8\u5206\u96e2\uff09"}),"\n",(0,t.jsx)(n.p,{children:"Keycloak\u3068\u540c\u69d8\u306b\u3001Cookie\u306e\u30d1\u30b9\u3067\u30c6\u30ca\u30f3\u30c8\uff08Realm\uff09\u3092\u5206\u96e2\u3067\u304d\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'Browser Cookie Storage:\n\u251c\u2500\u2500 /tenant-a/\n\u2502   \u251c\u2500\u2500 IDP_IDENTITY = "session-id-for-tenant-a"\n\u2502   \u2514\u2500\u2500 IDP_SESSION = "hash-a..."\n\u2502\n\u2514\u2500\u2500 /tenant-b/\n    \u251c\u2500\u2500 IDP_IDENTITY = "session-id-for-tenant-b"\n    \u2514\u2500\u2500 IDP_SESSION = "hash-b..."\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u308c\u306b\u3088\u308a\u3001\u540c\u4e00\u30d6\u30e9\u30a6\u30b6\u3067\u8907\u6570\u30c6\u30ca\u30f3\u30c8\u306b\u72ec\u7acb\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-\u30b3\u30a2\u30af\u30e9\u30b9",children:"\ud83d\udccb \u30b3\u30a2\u30af\u30e9\u30b9"}),"\n",(0,t.jsx)(n.h3,{id:"opsession",children:"OPSession"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u30d6\u30e9\u30a6\u30b6\u3068OP\u9593\u306e\u30bb\u30c3\u30b7\u30e7\u30f3"}),"\u3092\u8868\u3059\u30af\u30e9\u30b9\u3067\u3059\u3002\u30e6\u30fc\u30b6\u30fc\u304c\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3068\u4f5c\u6210\u3055\u308c\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u307e\u3067\u7dad\u6301\u3055\u308c\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class OPSession {\n  private final OPSessionIdentifier id;      // \u30bb\u30c3\u30b7\u30e7\u30f3ID\uff08UUID\uff09\n  private final String sub;                   // \u30e6\u30fc\u30b6\u30fc\u8b58\u5225\u5b50\n  private final Instant authTime;             // \u8a8d\u8a3c\u6642\u523b\n  private final String acr;                   // \u8a8d\u8a3c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30af\u30e9\u30b9\n  private final Set<String> amr;              // \u8a8d\u8a3c\u65b9\u5f0f\n  private final Instant createdAt;\n  private final Instant expiresAt;\n\n  public boolean isExpired() {\n    return Instant.now().isAfter(expiresAt);\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/OPSession.java",children:"OPSession.java"})]}),"\n",(0,t.jsx)(n.h3,{id:"clientsession",children:"ClientSession"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"OPSession\u3068\u7279\u5b9a\u306eRP\u306e\u9593\u306e\u30bb\u30c3\u30b7\u30e7\u30f3"}),"\u3092\u8868\u3059\u30af\u30e9\u30b9\u3067\u3059\u3002\u8a8d\u53ef\u304c\u5b8c\u4e86\u3059\u308b\u3068\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class ClientSession {\n  private final ClientSessionIdentifier sid;  // ID Token \u306e sid \u30af\u30ec\u30fc\u30e0\u306b\u542b\u307e\u308c\u308b\n  private final OPSessionIdentifier opSessionId;\n  private final String clientId;\n  private final Set<String> scopes;\n  private final String nonce;\n  private final Instant createdAt;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/ClientSession.java",children:"ClientSession.java"})]}),"\n",(0,t.jsx)(n.h3,{id:"oidcsessionhandler",children:"OIDCSessionHandler"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u64cd\u4f5c\u3092\u8abf\u6574"}),"\u3059\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class OIDCSessionHandler {\n\n  // \u8a8d\u8a3c\u6210\u529f\u6642\u306bOPSession\u3092\u4f5c\u6210\n  public OPSession onAuthenticationSuccess(\n      Tenant tenant, User user, Authentication authentication);\n\n  // \u8a8d\u53ef\u6642\u306bClientSession\u3092\u4f5c\u6210\uff08sid\u3092\u8fd4\u3059\uff09\n  public ClientSessionIdentifier onAuthorize(\n      Tenant tenant, OPSession opSession, String clientId,\n      Set<String> scopes, String nonce);\n\n  // \u30bb\u30c3\u30b7\u30e7\u30f3Cookie\u3092\u8a2d\u5b9a\n  public void registerSessionCookies(\n      Tenant tenant, OPSession opSession, SessionCookieDelegate delegate);\n\n  // Cookie\u304b\u3089OPSession\u3092\u53d6\u5f97\n  public Optional<OPSession> getOPSessionFromCookie(\n      Tenant tenant, SessionCookieDelegate delegate);\n\n  // \u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30c3\u30b7\u30e5\u3092\u8a08\u7b97\uff08IDP_SESSION cookie\u7528\uff09\n  public String computeSessionHash(String opSessionId);\n\n  // \u30bb\u30c3\u30b7\u30e7\u30f3\u6709\u52b9\u6027\u3092\u691c\u8a3c\n  public boolean isSessionValid(OPSession opSession, Long maxAge);\n\n  // OPSession\u306e\u7d42\u4e86\n  public ClientSessions terminateOPSession(\n      Tenant tenant, OPSessionIdentifier opSessionId, TerminationReason reason);\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/OIDCSessionHandler.java",children:"OIDCSessionHandler.java"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb",children:"\ud83d\udd04 \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u30bb\u30c3\u30b7\u30e7\u30f3\u4f5c\u6210\u8a8d\u8a3c\u6210\u529f\u6642",children:"1. \u30bb\u30c3\u30b7\u30e7\u30f3\u4f5c\u6210\uff08\u8a8d\u8a3c\u6210\u529f\u6642\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User    \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 \u8a8d\u8a3c\u6210\u529f      \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 OPSession\u4f5c\u6210        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 Cookie\u8a2d\u5b9a           \u2502\n                                      \u2502 - IDP_IDENTITY      \u2502\n                                      \u2502 - IDP_SESSION       \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5b9f\u88c5\u7b87\u6240"}),": ",(0,t.jsx)(n.code,{children:"OAuthFlowEntryService.authenticate()"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"if (updatedTransaction.isSuccess()) {\n  Authentication authentication = updatedTransaction.authentication();\n  OPSession opSession = oidcSessionHandler.onAuthenticationSuccess(\n      tenant, updatedTransaction.user(), authentication);\n\n  // Cookie\u8a2d\u5b9a\uff08OIDCSessionHandler\u306b\u59d4\u8b72\uff09\n  oidcSessionHandler.registerSessionCookies(tenant, opSession, sessionCookieDelegate);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-clientsession\u4f5c\u6210\u8a8d\u53ef\u6642",children:"2. ClientSession\u4f5c\u6210\uff08\u8a8d\u53ef\u6642\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u8a8d\u53ef\u627f\u8a8d  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Cookie\u8aad\u53d6    \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 OPSession\u53d6\u5f97        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 ClientSession\u4f5c\u6210    \u2502\n                                      \u2502 \u2192 sid\u751f\u6210           \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 ID Token \u306b sid\u542b\u3080  \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5b9f\u88c5\u7b87\u6240"}),": ",(0,t.jsx)(n.code,{children:"OAuthFlowEntryService.authorize()"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'oidcSessionHandler\n    .getOPSessionFromCookie(tenant, sessionCookieDelegate)\n    .ifPresent(opSession -> {\n      ClientSessionIdentifier sid = oidcSessionHandler\n          .onAuthorize(tenant, opSession, clientId, scopes, nonce);\n      oAuthAuthorizeRequest.setCustomProperties(Map.of("sid", sid.value()));\n    });\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-sso\u30bb\u30c3\u30b7\u30e7\u30f3\u518d\u5229\u7528",children:"3. SSO\uff08\u30bb\u30c3\u30b7\u30e7\u30f3\u518d\u5229\u7528\uff09"}),"\n",(0,t.jsx)(n.p,{children:"\u65e2\u5b58\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001\u518d\u8a8d\u8a3c\u306a\u3057\u3067\u8a8d\u53ef\u3092\u884c\u3044\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u8a8d\u53ef\u8981\u6c42  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Cookie\u8aad\u53d6    \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 OPSession\u53d6\u5f97        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 \u30bb\u30c3\u30b7\u30e7\u30f3\u691c\u8a3c        \u2502\n                                      \u2502 - \u6709\u52b9\u671f\u9650           \u2502\n                                      \u2502 - max_age           \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 \u8a8d\u8a3c\u30b9\u30ad\u30c3\u30d7          \u2502\n                                      \u2502 \u2192 \u76f4\u63a5\u8a8d\u53ef           \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5b9f\u88c5\u7b87\u6240"}),": ",(0,t.jsx)(n.code,{children:"OAuthFlowEntryService.authorizeWithSession()"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'// OPSession\u3092Cookie\u304b\u3089\u53d6\u5f97\uff08OIDCSessionHandler\u306b\u59d4\u8b72\uff09\nOptional<OPSession> opSessionOpt = oidcSessionHandler\n    .getOPSessionFromCookie(tenant, sessionCookieDelegate);\n\nif (opSessionOpt.isEmpty()) {\n  return new OAuthAuthorizeResponse(\n      OAuthAuthorizeStatus.BAD_REQUEST, "invalid_request", "session not found");\n}\n\nOPSession opSession = opSessionOpt.get();\n\n// max_age\u306b\u3088\u308b\u691c\u8a3c\nLong maxAge = authorizationRequest.maxAge().exists()\n    ? authorizationRequest.maxAge().toLongValue()\n    : null;\n\nif (!oidcSessionHandler.isSessionValid(opSession, maxAge)) {\n  return new OAuthAuthorizeResponse(\n      OAuthAuthorizeStatus.BAD_REQUEST, "invalid_request", "session expired");\n}\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u304b\u3089Authentication\u3092\u5fa9\u5143\nLocalDateTime authTime = LocalDateTime.ofInstant(opSession.authTime(), ZoneOffset.UTC);\nAuthentication authentication = new Authentication()\n    .setTime(authTime)\n    .addAcr(opSession.acr())\n    .addMethods(opSession.amr());\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-\u30ed\u30b0\u30a2\u30a6\u30c8",children:"\ud83d\udeaa \u30ed\u30b0\u30a2\u30a6\u30c8"}),"\n",(0,t.jsx)(n.h3,{id:"rp-initiated-logout",children:"RP-Initiated Logout"}),"\n",(0,t.jsx)(n.p,{children:"RP\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\u3092\u958b\u59cb\u3059\u308b\u30d5\u30ed\u30fc\u3067\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  RP      \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 /logout      \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 id_token_hint\u89e3\u6790    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 ClientSession \u2192 sid \u2502\n                                      \u2502 sid \u2192 OPSession     \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 \u5168ClientSession\u306b    \u2502\n                                      \u2502 \u30ed\u30b0\u30a2\u30a6\u30c8\u901a\u77e5        \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 Cookie\u524a\u9664           \u2502\n                                      \u2502 \u30bb\u30c3\u30b7\u30e7\u30f3\u7121\u52b9\u5316      \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5b9f\u88c5\u7b87\u6240"}),": ",(0,t.jsx)(n.code,{children:"OAuthFlowEntryService.logout()"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public OAuthLogoutResponse logout(...) {\n  OAuthLogoutResponse response = oAuthProtocol.logout(oAuthLogoutRequest);\n\n  if (response.isOk() && response.hasContext()) {\n    // \u30bb\u30c3\u30b7\u30e7\u30f3\u30ed\u30b0\u30a2\u30a6\u30c8\u5b9f\u884c\n    response = executeSessionLogout(tenant, response);\n\n    // Cookie\u524a\u9664\n    if (sessionCookieDelegate != null) {\n      sessionCookieDelegate.clearSessionCookies();\n    }\n  }\n\n  return response;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"back-channel-logout",children:"Back-Channel Logout"}),"\n",(0,t.jsx)(n.p,{children:"OP\u304b\u3089RP\u3078\u30d0\u30c3\u30af\u30c1\u30e3\u30cd\u30eb\u3067\u30ed\u30b0\u30a2\u30a6\u30c8\u3092\u901a\u77e5\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Logout   \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 LogoutOrchestrator\u2502\u2500\u2500\u2500\u2500\u25b6\u2502 \u5404ClientSession\u306e    \u2502\n\u2502 \u958b\u59cb     \u2502     \u2502                  \u2502     \u2502 RP\u3092\u53d6\u5f97             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                   \u2502\n                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                        \u25bc                          \u25bc                          \u25bc\n                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                 \u2502 Client A    \u2502           \u2502 Client B    \u2502           \u2502 Client C    \u2502\n                 \u2502 POST logout \u2502           \u2502 POST logout \u2502           \u2502 POST logout \u2502\n                 \u2502 token       \u2502           \u2502 token       \u2502           \u2502 token       \u2502\n                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h4,{id:"backchannellogoutservice-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",children:"BackChannelLogoutService \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public interface BackChannelLogoutService {\n\n  // Logout Token\u3092\u30a8\u30f3\u30b3\u30fc\u30c9\uff08\u578b\u5b89\u5168: JWKS\u3092String\u3067\u53d7\u3051\u53d6\u308b\uff09\n  String encodeLogoutToken(\n      LogoutToken token,\n      String signingAlgorithm,\n      String signingKeyJwks);  // Object \u2192 String \u306b\u5909\u66f4\n\n  // Logout Token\u3092\u691c\u8a3c\n  LogoutTokenValidationResult validateLogoutToken(\n      String token,\n      String expectedIssuer,\n      String expectedAudience,\n      String publicKeyJwks);  // Object \u2192 String \u306b\u5909\u66f4\n\n  // RP\u3078\u30ed\u30b0\u30a2\u30a6\u30c8\u901a\u77e5\u3092\u9001\u4fe1\n  BackChannelLogoutResult sendLogoutToken(String logoutUri, String logoutToken);\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u578b\u5b89\u5168\u6027\u306e\u6539\u5584"}),": \u4ee5\u524d\u306f",(0,t.jsx)(n.code,{children:"Object"}),"\u578b\u3060\u3063\u305fJWKS\u30d1\u30e9\u30e1\u30fc\u30bf\u3092",(0,t.jsx)(n.code,{children:"String"}),"\u578b\u306b\u5909\u66f4\u3057\u3001\u578b\u5b89\u5168\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3057\u305f\u3002"]}),"\n",(0,t.jsx)(n.h4,{id:"httpclient\u4f9d\u5b58\u6027\u6ce8\u5165",children:"HttpClient\u4f9d\u5b58\u6027\u6ce8\u5165"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"DefaultBackChannelLogoutService"}),"\u306fHttpClient\u3092\u660e\u793a\u7684\u306b\u53d7\u3051\u53d6\u308a\u307e\u3059\uff08DI\u30d5\u30ec\u30f3\u30c9\u30ea\u30fc\uff09\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class DefaultBackChannelLogoutService implements BackChannelLogoutService {\n\n  private final HttpClient httpClient;\n\n  public DefaultBackChannelLogoutService(HttpClient httpClient) {\n    this.httpClient = httpClient;\n  }\n\n  // \u30c7\u30d5\u30a9\u30eb\u30c8HttpClient\u3092\u4f5c\u6210\u3059\u308b\u30d5\u30a1\u30af\u30c8\u30ea\u30e1\u30bd\u30c3\u30c9\n  public static HttpClient createDefaultHttpClient() {\n    return HttpClient.newBuilder()\n        .connectTimeout(Duration.ofSeconds(10))\n        .followRedirects(HttpClient.Redirect.NEVER)\n        .build();\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/logout/LogoutOrchestrator.java",children:"LogoutOrchestrator.java"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/logout/BackChannelLogoutService.java",children:"BackChannelLogoutService.java"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/logout/DefaultBackChannelLogoutService.java",children:"DefaultBackChannelLogoutService.java"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-cookie\u7ba1\u7406",children:"\ud83c\udf6a Cookie\u7ba1\u7406"}),"\n",(0,t.jsx)(n.h3,{id:"sessioncookiedelegate-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",children:"SessionCookieDelegate \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9"}),"\n",(0,t.jsx)(n.p,{children:"Cookie\u306e\u8aad\u307f\u66f8\u304d\u3092\u62bd\u8c61\u5316\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public interface SessionCookieDelegate {\n\n  // \u30bb\u30c3\u30b7\u30e7\u30f3Cookie\u3092\u8a2d\u5b9a\n  void setSessionCookies(String identityToken, String sessionHash, long maxAgeSeconds);\n\n  // IDP_IDENTITY Cookie\u3092\u53d6\u5f97\n  Optional<String> getIdentityToken();\n\n  // IDP_SESSION Cookie\u3092\u53d6\u5f97\n  Optional<String> getSessionHash();\n\n  // \u30bb\u30c3\u30b7\u30e7\u30f3Cookie\u3092\u524a\u9664\n  void clearSessionCookies();\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/SessionCookieDelegate.java",children:"SessionCookieDelegate.java"})]}),"\n",(0,t.jsx)(n.h3,{id:"spring-boot\u5b9f\u88c5",children:"Spring Boot\u5b9f\u88c5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@Service\npublic class SessionCookieService implements SessionCookieDelegate {\n\n  public static final String IDENTITY_COOKIE_NAME = "IDP_IDENTITY";\n  public static final String SESSION_COOKIE_NAME = "IDP_SESSION";\n\n  @Override\n  public void setSessionCookies(String identityToken, String sessionHash, long maxAgeSeconds) {\n    // IDP_IDENTITY cookie (HttpOnly)\n    Cookie identityCookie = new Cookie(IDENTITY_COOKIE_NAME, identityToken);\n    identityCookie.setHttpOnly(true);\n    identityCookie.setSecure(true);\n    identityCookie.setPath("/");\n\n    // IDP_SESSION cookie (NOT HttpOnly - for session management iframe)\n    Cookie sessionCookie = new Cookie(SESSION_COOKIE_NAME, sessionHash);\n    sessionCookie.setHttpOnly(false);  // JavaScript \u304b\u3089\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\n    sessionCookie.setSecure(true);\n    sessionCookie.setPath("/");\n\n    // SameSite=Lax \u3092\u8a2d\u5b9a\n    addCookieWithSameSite(identityCookie, "Lax");\n    addCookieWithSameSite(sessionCookie, "Lax");\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-springboot-adapter/src/main/java/org/idp/server/adapters/springboot/application/session/SessionCookieService.java",children:"SessionCookieService.java"})]}),"\n",(0,t.jsx)(n.h3,{id:"\u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97",children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"IDP_SESSION"})," Cookie\u306b\u306f\u3001\u30bb\u30c3\u30b7\u30e7\u30f3ID\u306eSHA-256\u30cf\u30c3\u30b7\u30e5\u3092\u683c\u7d0d\u3057\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'public class SessionHashCalculator {\n\n  public static String sha256UrlEncodedHash(String input) {\n    MessageDigest digest = MessageDigest.getInstance("SHA-256");\n    byte[] hash = digest.digest(input.getBytes(StandardCharsets.UTF_8));\n    return Base64.getUrlEncoder().withoutPadding().encodeToString(hash);\n  }\n\n  public static boolean verifySessionHash(String opSessionId, String providedHash) {\n    if (opSessionId == null || providedHash == null) {\n      return false;\n    }\n    String expectedHash = sha256UrlEncodedHash(opSessionId);\n    return expectedHash.equals(providedHash);\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),": ",(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/SessionHashCalculator.java",children:"SessionHashCalculator.java"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8",children:"\ud83d\uddc4\ufe0f \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8"}),"\n",(0,t.jsx)(n.h3,{id:"opsessionrepository",children:"OPSessionRepository"}),"\n",(0,t.jsxs)(n.p,{children:["\u3059\u3079\u3066\u306e\u30e1\u30bd\u30c3\u30c9\u3067",(0,t.jsx)(n.strong,{children:"Tenant\u3092\u7b2c\u4e00\u5f15\u6570"}),"\u3068\u3057\u3066\u53d7\u3051\u53d6\u308a\u307e\u3059\uff08\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u5bfe\u5fdc\uff09\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public interface OPSessionRepository {\n  void save(Tenant tenant, OPSession session);\n  Optional<OPSession> findById(Tenant tenant, OPSessionIdentifier id);\n  void updateLastAccessedAt(Tenant tenant, OPSession session);\n  void delete(Tenant tenant, OPSessionIdentifier id);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"clientsessionrepository",children:"ClientSessionRepository"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public interface ClientSessionRepository {\n  void save(Tenant tenant, ClientSession session);\n  Optional<ClientSession> findBySid(Tenant tenant, ClientSessionIdentifier sid);\n  ClientSessions findByOpSessionId(Tenant tenant, OPSessionIdentifier opSessionId);\n  ClientSessions findByTenantAndSub(TenantIdentifier tenantId, String sub);\n  ClientSessions findByTenantClientAndSub(TenantIdentifier tenantId, String clientId, String sub);\n  void deleteBySid(Tenant tenant, ClientSessionIdentifier sid);\n  void deleteByOpSessionId(Tenant tenant, OPSessionIdentifier opSessionId);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"redis-\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u69cb\u9020",children:"Redis \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u69cb\u9020"}),"\n",(0,t.jsx)(n.p,{children:"Redis\u30b9\u30c8\u30ec\u30fc\u30b8\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3088\u308a\u52b9\u7387\u7684\u306a\u691c\u7d22\u304c\u53ef\u80fd\u3067\u3059\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# OPSession\nop_session:{tenantId}:{opSessionId}              # \u30e1\u30a4\u30f3\u30c7\u30fc\u30bf\nidx:tenant:{tenantId}:sub:{sub}                   # \u30e6\u30fc\u30b6\u30fc\u30d9\u30fc\u30b9\u691c\u7d22\n\n# ClientSession\nclient_session:{tenantId}:{sid}                   # \u30e1\u30a4\u30f3\u30c7\u30fc\u30bf\nidx:tenant:{tenantId}:op_session:{opSessionId}   # OPSession\u5225\u691c\u7d22\nidx:tenant:{tenantId}:sub:{sub}                   # \u30e6\u30fc\u30b6\u30fc\u30d9\u30fc\u30b9\u691c\u7d22\nidx:tenant:{tenantId}:client:{clientId}:sub:{sub} # \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\xd7\u30e6\u30fc\u30b6\u30fc\u691c\u7d22\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u30e6\u30fc\u30b6\u30fc\u30d9\u30fc\u30b9\u691c\u7d22"}),": \u7ba1\u7406API\u304b\u3089\u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u691c\u7d22\u30fb\u7ba1\u7406\u3067\u304d\u307e\u3059\u3002"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"findByTenantAndSub()"}),": \u7279\u5b9a\u30e6\u30fc\u30b6\u30fc\u306e\u5168\u30bb\u30c3\u30b7\u30e7\u30f3\u53d6\u5f97"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"findByTenantClientAndSub()"}),": \u7279\u5b9a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\xd7\u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u53d6\u5f97"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u9078\u629e",children:"\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u9078\u629e"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30b9\u30c8\u30ec\u30fc\u30b8"}),(0,t.jsx)(n.th,{children:"\u7279\u5fb4"}),(0,t.jsx)(n.th,{children:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Redis"}),(0,t.jsx)(n.td,{children:"\u9ad8\u901f\u3001TTL\u5bfe\u5fdc\u3001\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u691c\u7d22"}),(0,t.jsx)(n.td,{children:"\u672c\u756a\u74b0\u5883\u63a8\u5968"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Database"}),(0,t.jsx)(n.td,{children:"\u6c38\u7d9a\u5316\u3001\u76e3\u67fb"}),(0,t.jsx)(n.td,{children:"\u53b3\u683c\u306a\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u8981\u4ef6"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"In-Memory"}),(0,t.jsx)(n.td,{children:"\u30b7\u30f3\u30d7\u30eb"}),(0,t.jsx)(n.td,{children:"\u958b\u767a\u30fb\u30c6\u30b9\u30c8"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-\u30bb\u30c3\u30b7\u30e7\u30f3\u5207\u66ff\u30dd\u30ea\u30b7\u30fc",children:"\ud83d\udd04 \u30bb\u30c3\u30b7\u30e7\u30f3\u5207\u66ff\u30dd\u30ea\u30b7\u30fc"}),"\n",(0,t.jsx)(n.p,{children:"\u540c\u4e00\u30d6\u30e9\u30a6\u30b6\u3067\u5225\u30e6\u30fc\u30b6\u30fc\u304c\u8a8d\u8a3c\u3057\u3088\u3046\u3068\u3057\u305f\u5834\u5408\u306e\u52d5\u4f5c\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u30dd\u30ea\u30b7\u30fc\u4e00\u89a7",children:"\u30dd\u30ea\u30b7\u30fc\u4e00\u89a7"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30dd\u30ea\u30b7\u30fc"}),(0,t.jsx)(n.th,{children:"\u52d5\u4f5c"}),(0,t.jsx)(n.th,{children:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"STRICT"})}),(0,t.jsx)(n.td,{children:"\u30a8\u30e9\u30fc\u3092\u8fd4\u3059\uff08\u30ed\u30b0\u30a2\u30a6\u30c8\u5fc5\u9808\uff09"}),(0,t.jsx)(n.td,{children:"\u91d1\u878d\u3001\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SWITCH_ALLOWED"})}),(0,t.jsx)(n.td,{children:"\u53e4\u3044\u30bb\u30c3\u30b7\u30e7\u30f3\u524a\u9664\u2192\u65b0\u898f\u4f5c\u6210 (\u30c7\u30d5\u30a9\u30eb\u30c8)"}),(0,t.jsx)(n.td,{children:"\u4e00\u822c\u7684\u306aWeb\u30a2\u30d7\u30ea\u3001\u5171\u6709PC"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"MULTI_SESSION"})}),(0,t.jsx)(n.td,{children:"\u65b0\u898f\u4f5c\u6210\uff08\u53e4\u3044\u306e\u306f\u6b8b\u308b\uff09"}),(0,t.jsx)(n.td,{children:"\u5f8c\u65b9\u4e92\u63db\u6027\u7dad\u6301"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"\u52d5\u4f5c\u30d5\u30ed\u30fc",children:"\u52d5\u4f5c\u30d5\u30ed\u30fc"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u540c\u4e00\u30e6\u30fc\u30b6\u30fc\u304c\u518d\u8a8d\u8a3c\n\u2514\u2500\u2500 \u65e2\u5b58\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u518d\u5229\u7528\uff08lastAccessedAt\u66f4\u65b0\uff09\n\n\u5225\u30e6\u30fc\u30b6\u30fc\u304c\u8a8d\u8a3c\uff08\u65e2\u5b58\u30bb\u30c3\u30b7\u30e7\u30f3\u3042\u308a\uff09\n\u251c\u2500\u2500 STRICT         \u2192 DifferentUserAuthenticatedException\n\u251c\u2500\u2500 SWITCH_ALLOWED \u2192 \u53e4\u3044\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\uff08USER_SWITCH\uff09\u2192 \u65b0\u898f\u4f5c\u6210\n\u2514\u2500\u2500 MULTI_SESSION  \u2192 \u65b0\u898f\u4f5c\u6210\uff08\u53e4\u3044\u306e\u306fTTL\u6e80\u4e86\u307e\u3067\u6b8b\u5b58\uff09\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u30c6\u30ca\u30f3\u30c8\u8a2d\u5b9a",children:"\u30c6\u30ca\u30f3\u30c8\u8a2d\u5b9a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "session": {\n    "timeout_seconds": 3600,\n    "switch_policy": "SWITCH_ALLOWED"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u5b9f\u88c5",children:"\u5b9f\u88c5"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"OIDCSessionHandler.onAuthenticationSuccess()"})," \u3067\u30dd\u30ea\u30b7\u30fc\u306b\u57fa\u3065\u3044\u305f\u51e6\u7406\u3092\u884c\u3044\u307e\u3059\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public OPSession onAuthenticationSuccess(\n    Tenant tenant,\n    User user,\n    Authentication authentication,\n    Map<String, Map<String, Object>> interactionResults,\n    OPSession existingSession) {\n\n  if (existingSession != null && existingSession.isActive()) {\n    String existingSub = existingSession.sub();\n    String authenticatedSub = user.sub();\n\n    // \u540c\u4e00\u30e6\u30fc\u30b6\u30fc \u2192 \u30bb\u30c3\u30b7\u30e7\u30f3\u518d\u5229\u7528\n    if (existingSub != null && existingSub.equals(authenticatedSub)) {\n      sessionService.touchOPSession(tenant, existingSession);\n      return existingSession;\n    }\n\n    // \u5225\u30e6\u30fc\u30b6\u30fc \u2192 \u30dd\u30ea\u30b7\u30fc\u306b\u5f93\u3046\n    SessionSwitchPolicy policy = getSessionSwitchPolicy(tenant);\n\n    switch (policy) {\n      case STRICT:\n        throw new DifferentUserAuthenticatedException(existingSub, authenticatedSub);\n      case SWITCH_ALLOWED:\n        sessionService.terminateOPSession(tenant, existingSession.id(),\n            TerminationReason.USER_SWITCH);\n        break;\n      case MULTI_SESSION:\n      default:\n        // \u53e4\u3044\u30bb\u30c3\u30b7\u30e7\u30f3\u306f\u305d\u306e\u307e\u307e\u6b8b\u308b\n        break;\n    }\n  }\n\n  return createNewOPSession(tenant, user, authentication, interactionResults);\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u8003\u5b9f\u88c5"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/SessionSwitchPolicy.java",children:"SessionSwitchPolicy.java"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../../../../libs/idp-server-core/src/main/java/org/idp/server/core/openid/session/DifferentUserAuthenticatedException.java",children:"DifferentUserAuthenticatedException.java"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8003\u616e\u4e8b\u9805",children:"\ud83d\udd12 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8003\u616e\u4e8b\u9805"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30a4\u30b8\u30e3\u30c3\u30af\u5bfe\u7b56",children:"1. \u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30a4\u30b8\u30e3\u30c3\u30af\u5bfe\u7b56"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HttpOnly Cookie"}),": ",(0,t.jsx)(n.code,{children:"IDP_IDENTITY"})," \u306fJavaScript\u304b\u3089\u30a2\u30af\u30bb\u30b9\u4e0d\u53ef"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Secure Cookie"}),": HTTPS\u63a5\u7d9a\u306e\u307f\u3067\u9001\u4fe1"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SameSite=Lax"}),": CSRF\u653b\u6483\u3092\u8efd\u6e1b"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-\u30bb\u30c3\u30b7\u30e7\u30f3\u56fa\u5b9a\u653b\u6483\u5bfe\u7b56",children:"2. \u30bb\u30c3\u30b7\u30e7\u30f3\u56fa\u5b9a\u653b\u6483\u5bfe\u7b56"}),"\n",(0,t.jsx)(n.p,{children:"\u8a8d\u8a3c\u6210\u529f\u6642\u306b\u30bb\u30c3\u30b7\u30e7\u30f3ID\u3092\u518d\u751f\u6210\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'// OAuthSessionDataSource.java\nprivate void regenerateSessionId() {\n  String newSessionId = httpServletRequest.changeSessionId();\n  log.info("Session ID regenerated: {} -> {}", oldSessionId, newSessionId);\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-max_age-\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u691c\u8a3c",children:"3. max_age \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u691c\u8a3c"}),"\n",(0,t.jsxs)(n.p,{children:["\u8a8d\u53ef\u30ea\u30af\u30a8\u30b9\u30c8\u306e ",(0,t.jsx)(n.code,{children:"max_age"})," \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u57fa\u3065\u3044\u3066\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u6709\u52b9\u6027\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public boolean isSessionValid(OPSession opSession, Long maxAge) {\n  if (opSession == null || opSession.isExpired()) {\n    return false;\n  }\n\n  if (maxAge != null && maxAge > 0) {\n    Instant authTime = opSession.authTime();\n    Instant maxAuthTime = authTime.plusSeconds(maxAge);\n    if (Instant.now().isAfter(maxAuthTime)) {\n      return false;  // \u518d\u8a8d\u8a3c\u304c\u5fc5\u8981\n    }\n  }\n\n  return true;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-promptlogin-\u306e\u51e6\u7406",children:"4. prompt=login \u306e\u51e6\u7406"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"prompt=login"})," \u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408\u306f\u3001\u65e2\u5b58\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u7121\u8996\u3057\u3066\u518d\u8a8d\u8a3c\u3092\u8981\u6c42\u3057\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-\u5c06\u6765\u306e\u62e1\u5f35\u6a5f\u80fd",children:"\ud83c\udfaf \u5c06\u6765\u306e\u62e1\u5f35\u6a5f\u80fd"}),"\n",(0,t.jsx)(n.p,{children:"idp-server\u3067\u306f\u3001Keycloak\u306e\u9ad8\u5ea6\u306a\u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u6a5f\u80fd\u3092\u53c2\u8003\u306b\u3001\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u5c06\u6765\u7684\u306b\u5b9f\u88c5\u4e88\u5b9a\u3067\u3059\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"step-up-authentication\u8a8d\u8a3c\u30ec\u30d9\u30eb\u7ba1\u7406",children:"Step-up Authentication\uff08\u8a8d\u8a3c\u30ec\u30d9\u30eb\u7ba1\u7406\uff09"}),"\n",(0,t.jsx)(n.p,{children:"\u30e6\u30fc\u30b6\u30fc\u304c\u65e2\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u3066\u3082\u3001\u3088\u308a\u9ad8\u3044\u8a8d\u8a3c\u30ec\u30d9\u30eb\u304c\u8981\u6c42\u3055\u308c\u305f\u5834\u5408\u306b\u8ffd\u52a0\u8a8d\u8a3c\u3092\u6c42\u3081\u308b\u6a5f\u80fd\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u8a8d\u53ef\u30ea\u30af\u30a8\u30b9\u30c8: acr_values=gold\n        \u2502\n        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. \u73fe\u5728\u306e\u8a8d\u8a3c\u30ec\u30d9\u30eb\u3092\u78ba\u8a8d\uff08LoA_MAP\uff09                          \u2502\n\u2502    \u4f8b: {"bronze": 1234567890}                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502\n        \u25bc gold > bronze\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. Step-up\u8a8d\u8a3c\u3092\u8981\u6c42\uff08MFA\u7b49\uff09                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502\n        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. LoA_MAP\u66f4\u65b0                                               \u2502\n\u2502    {"bronze": 1234567890, "gold": 1234567900}               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u5236\u9650",children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u5236\u9650"}),"\n",(0,t.jsx)(n.p,{children:"\u30e6\u30fc\u30b6\u30fc\u3042\u305f\u308a\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u3092\u5236\u9650\u3059\u308b\u6a5f\u80fd\u3002"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30e2\u30fc\u30c9"}),(0,t.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DENY_NEW_SESSION"})}),(0,t.jsx)(n.td,{children:"\u4e0a\u9650\u8d85\u904e\u6642\u306b\u65b0\u898f\u30ed\u30b0\u30a4\u30f3\u3092\u62d2\u5426"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TERMINATE_OLDEST_SESSION"})}),(0,t.jsx)(n.td,{children:"\u6700\u3082\u53e4\u3044\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u65b0\u898f\u30ed\u30b0\u30a4\u30f3\u3092\u8a31\u53ef"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"\u30c7\u30d0\u30a4\u30b9\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0",children:"\u30c7\u30d0\u30a4\u30b9\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0"}),"\n",(0,t.jsx)(n.p,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u7d10\u4ed8\u3051\u3066\u7ba1\u7406\u3059\u308b\u6a5f\u80fd\u3002"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u9805\u76ee"}),(0,t.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"device"})}),(0,t.jsx)(n.td,{children:"\u30c7\u30d0\u30a4\u30b9\u7a2e\u5225\uff08Desktop, Mobile\u7b49\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"browser"})}),(0,t.jsx)(n.td,{children:"\u30d6\u30e9\u30a6\u30b6\u540d\u30fb\u30d0\u30fc\u30b8\u30e7\u30f3"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"os"})}),(0,t.jsx)(n.td,{children:"OS\u540d\u30fb\u30d0\u30fc\u30b8\u30e7\u30f3"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ipAddress"})}),(0,t.jsx)(n.td,{children:"IP\u30a2\u30c9\u30ec\u30b9"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"dpopdemonstrating-proof-of-possession",children:"DPoP\uff08Demonstrating Proof of Possession\uff09"}),"\n",(0,t.jsx)(n.p,{children:"\u30c8\u30fc\u30af\u30f3\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u79d8\u5bc6\u9375\u306b\u7d10\u4ed8\u3051\u3001\u30c8\u30fc\u30af\u30f3\u76d7\u96e3\u6642\u306e\u60aa\u7528\u3092\u9632\u6b62\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Client                              OP\n  \u2502 1. DPoP proof\u751f\u6210\uff08\u79d8\u5bc6\u9375\u3067\u7f72\u540d\uff09 \u2502\n  \u2502 2. Token Request + DPoP header   \u2502\n  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500>\u2502\n  \u2502                                  \u2502 3. DPoP\u691c\u8a3c\n  \u2502 4. Access Token (cnf: {jkt})     \u2502\n  \u2502<\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-\u95a2\u9023\u4ed5\u69d8",children:"\ud83d\udcda \u95a2\u9023\u4ed5\u69d8"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-session-1_0.html",children:"OpenID Connect Session Management 1.0"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-rpinitiated-1_0.html",children:"OpenID Connect RP-Initiated Logout 1.0"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-backchannel-1_0.html",children:"OpenID Connect Back-Channel Logout 1.0"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-frontchannel-1_0.html",children:"OpenID Connect Front-Channel Logout 1.0"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc9449",children:"RFC 9449 - OAuth 2.0 Demonstrating Proof of Possession (DPoP)"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-\u95a2\u9023\u30d5\u30a1\u30a4\u30eb",children:"\ud83d\udd17 \u95a2\u9023\u30d5\u30a1\u30a4\u30eb"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30d5\u30a1\u30a4\u30eb"}),(0,t.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"OPSession.java"})}),(0,t.jsx)(n.td,{children:"OP-Browser\u9593\u30bb\u30c3\u30b7\u30e7\u30f3"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ClientSession.java"})}),(0,t.jsx)(n.td,{children:"OP-RP\u9593\u30bb\u30c3\u30b7\u30e7\u30f3"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"OIDCSessionHandler.java"})}),(0,t.jsx)(n.td,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u7ba1\u7406\u8abf\u6574"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"OIDCSessionService.java"})}),(0,t.jsx)(n.td,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3CRUD\u64cd\u4f5c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"OPSessionRepository.java"})}),(0,t.jsx)(n.td,{children:"OP\u30bb\u30c3\u30b7\u30e7\u30f3\u30ea\u30dd\u30b8\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ClientSessionRepository.java"})}),(0,t.jsx)(n.td,{children:"Client\u30bb\u30c3\u30b7\u30e7\u30f3\u30ea\u30dd\u30b8\u30c8\u30eaIF"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SessionCookieDelegate.java"})}),(0,t.jsx)(n.td,{children:"Cookie\u64cd\u4f5c\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SessionCookieService.java"})}),(0,t.jsx)(n.td,{children:"Spring Boot Cookie\u5b9f\u88c5"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SessionHashCalculator.java"})}),(0,t.jsx)(n.td,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"BackChannelLogoutService.java"})}),(0,t.jsx)(n.td,{children:"\u30d0\u30c3\u30af\u30c1\u30e3\u30cd\u30eb\u30ed\u30b0\u30a2\u30a6\u30c8IF"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DefaultBackChannelLogoutService.java"})}),(0,t.jsx)(n.td,{children:"\u30d0\u30c3\u30af\u30c1\u30e3\u30cd\u30eb\u30ed\u30b0\u30a2\u30a6\u30c8\u5b9f\u88c5"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"IdentityCookieToken.java"})}),(0,t.jsx)(n.td,{children:"Identity Cookie JWT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"LogoutOrchestrator.java"})}),(0,t.jsx)(n.td,{children:"\u30ed\u30b0\u30a2\u30a6\u30c8\u8abf\u6574"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"OAuthFlowEntryService.java"})}),(0,t.jsx)(n.td,{children:"OAuth/OIDC\u30d5\u30ed\u30fc\u7d71\u5408"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SessionSwitchPolicy.java"})}),(0,t.jsx)(n.td,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u5207\u66ff\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DifferentUserAuthenticatedException.java"})}),(0,t.jsx)(n.td,{children:"\u5225\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u4f8b\u5916"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TerminationReason.java"})}),(0,t.jsx)(n.td,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\u7406\u7531"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>d});var s=i(96540);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);