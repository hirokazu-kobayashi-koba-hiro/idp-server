"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5476],{19465:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"content_11_learning/postgresql/dev-06-connection-pooling","title":"PostgreSQL \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0","description":"\u6240\u8981\u6642\u9593","source":"@site/docs/content_11_learning/11-postgresql/dev-06-connection-pooling.md","sourceDirName":"content_11_learning/11-postgresql","slug":"/content_11_learning/postgresql/dev-06-connection-pooling","permalink":"/idp-server/docs/content_11_learning/postgresql/dev-06-connection-pooling","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/11-postgresql/dev-06-connection-pooling.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"PostgreSQL \u30af\u30a8\u30ea\u6700\u9069\u5316","permalink":"/idp-server/docs/content_11_learning/postgresql/dev-05-query-optimization"},"next":{"title":"\u6697\u53f7\u5316\uff08Cryptography\uff09\u5b66\u7fd2\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_11_learning/crypto/"}}');var s=i(74848),t=i(28453);const o={},l="PostgreSQL \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0",c={},a=[{value:"\u6240\u8981\u6642\u9593",id:"\u6240\u8981\u6642\u9593",level:2},{value:"\u5b66\u3079\u308b\u3053\u3068",id:"\u5b66\u3079\u308b\u3053\u3068",level:2},{value:"\u524d\u63d0\u77e5\u8b58",id:"\u524d\u63d0\u77e5\u8b58",level:2},{value:"1. \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u3068\u306f",id:"1-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u3068\u306f",level:2},{value:"1.1 PostgreSQL\u63a5\u7d9a\u306e\u8ab2\u984c",id:"11-postgresql\u63a5\u7d9a\u306e\u8ab2\u984c",level:3},{value:"1.2 \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u89e3\u6c7a\u7b56",id:"12-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u89e3\u6c7a\u7b56",level:3},{value:"1.3 \u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u7a2e\u985e",id:"13-\u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u7a2e\u985e",level:3},{value:"2. PgBouncer",id:"2-pgbouncer",level:2},{value:"2.1 PgBouncer\u3068\u306f",id:"21-pgbouncer\u3068\u306f",level:3},{value:"2.2 \u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9",id:"22-\u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9",level:3},{value:"2.3 \u57fa\u672c\u8a2d\u5b9a",id:"23-\u57fa\u672c\u8a2d\u5b9a",level:3},{value:"2.4 \u8a8d\u8a3c\u8a2d\u5b9a",id:"24-\u8a8d\u8a3c\u8a2d\u5b9a",level:3},{value:"2.5 \u7ba1\u7406\u30b3\u30de\u30f3\u30c9",id:"25-\u7ba1\u7406\u30b3\u30de\u30f3\u30c9",level:3},{value:"3. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u306e\u30d7\u30fc\u30ea\u30f3\u30b0",id:"3-\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u306e\u30d7\u30fc\u30ea\u30f3\u30b0",level:2},{value:"3.1 HikariCP\uff08Java\uff09",id:"31-hikaricpjava",level:3},{value:"3.2 \u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba",id:"32-\u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba",level:3},{value:"3.3 \u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u74b0\u5883\u3067\u306e\u8003\u616e\u70b9",id:"33-\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u74b0\u5883\u3067\u306e\u8003\u616e\u70b9",level:3},{value:"4. \u63a5\u7d9a\u6570\u306e\u8a2d\u8a08",id:"4-\u63a5\u7d9a\u6570\u306e\u8a2d\u8a08",level:2},{value:"4.1 PostgreSQL\u5074\u306e\u8a2d\u5b9a",id:"41-postgresql\u5074\u306e\u8a2d\u5b9a",level:3},{value:"4.2 \u63a5\u7d9a\u6570\u306e\u898b\u7a4d\u3082\u308a",id:"42-\u63a5\u7d9a\u6570\u306e\u898b\u7a4d\u3082\u308a",level:3},{value:"4.3 shared_buffers \u3068\u306e\u95a2\u4fc2",id:"43-shared_buffers-\u3068\u306e\u95a2\u4fc2",level:3},{value:"5. AWS RDS Proxy",id:"5-aws-rds-proxy",level:2},{value:"5.1 RDS Proxy\u3068\u306f",id:"51-rds-proxy\u3068\u306f",level:3},{value:"5.2 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",id:"52-\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",level:3},{value:"5.3 IAM\u8a8d\u8a3c\u306e\u8a2d\u5b9a",id:"53-iam\u8a8d\u8a3c\u306e\u8a2d\u5b9a",level:3},{value:"6. \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",id:"6-\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",level:2},{value:"6.1 \u63a5\u7d9a\u67af\u6e07",id:"61-\u63a5\u7d9a\u67af\u6e07",level:3},{value:"6.2 idle in transaction",id:"62-idle-in-transaction",level:3},{value:"6.3 PgBouncer \u306e\u554f\u984c",id:"63-pgbouncer-\u306e\u554f\u984c",level:3},{value:"6.4 \u63a5\u7d9a\u30ea\u30fc\u30af\u306e\u691c\u51fa",id:"64-\u63a5\u7d9a\u30ea\u30fc\u30af\u306e\u691c\u51fa",level:3},{value:"7. \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"7-\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:2},{value:"7.1 \u8a2d\u8a08\u539f\u5247",id:"71-\u8a2d\u8a08\u539f\u5247",level:3},{value:"7.2 \u63a8\u5968\u8a2d\u5b9a",id:"72-\u63a8\u5968\u8a2d\u5b9a",level:3},{value:"7.3 \u76e3\u8996\u9805\u76ee",id:"73-\u76e3\u8996\u9805\u76ee",level:3},{value:"\u307e\u3068\u3081",id:"\u307e\u3068\u3081",level:2},{value:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"postgresql-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0",children:"PostgreSQL \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6240\u8981\u6642\u9593",children:"\u6240\u8981\u6642\u9593"}),"\n",(0,s.jsx)(e.p,{children:"\u7d0440\u5206"}),"\n",(0,s.jsx)(e.h2,{id:"\u5b66\u3079\u308b\u3053\u3068",children:"\u5b66\u3079\u308b\u3053\u3068"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u5fc5\u8981\u6027\u3068\u4ed5\u7d44\u307f"}),"\n",(0,s.jsx)(e.li,{children:"PgBouncer \u306e\u8a2d\u5b9a\u3068\u904b\u7528"}),"\n",(0,s.jsx)(e.li,{children:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u7ba1\u7406"}),"\n",(0,s.jsx)(e.li,{children:"\u63a5\u7d9a\u6570\u306e\u9069\u5207\u306a\u8a2d\u8a08"}),"\n",(0,s.jsx)(e.li,{children:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u524d\u63d0\u77e5\u8b58",children:"\u524d\u63d0\u77e5\u8b58"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"PostgreSQL \u306e\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.li,{children:"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u57fa\u790e\u77e5\u8b58"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"1-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u3068\u306f",children:"1. \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u3068\u306f"}),"\n",(0,s.jsx)(e.h3,{id:"11-postgresql\u63a5\u7d9a\u306e\u8ab2\u984c",children:"1.1 PostgreSQL\u63a5\u7d9a\u306e\u8ab2\u984c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    PostgreSQL\u63a5\u7d9a\u306e\u8ab2\u984c                                          \u2502\n\u2502                                                                                 \u2502\n\u2502  \u30af\u30e9\u30a4\u30a2\u30f3\u30c81 \u2500\u2500\u252c\u2500\u2500 \u63a5\u7d9a\u78ba\u7acb\uff08\u8a8d\u8a3c\u3001\u30d7\u30ed\u30bb\u30b9\u8d77\u52d5\uff09                              \u2502\n\u2502  \u30af\u30e9\u30a4\u30a2\u30f3\u30c82 \u2500\u2500\u253c\u2500\u2500 \u5404\u63a5\u7d9a\u3067\u7d0410MB\u7a0b\u5ea6\u306e\u30e1\u30e2\u30ea\u6d88\u8cbb                             \u2502\n\u2502  \u30af\u30e9\u30a4\u30a2\u30f3\u30c83 \u2500\u2500\u253c\u2500\u2500 max_connections \u306e\u4e0a\u9650\uff08\u30c7\u30d5\u30a9\u30eb\u30c8100\uff09                    \u2502\n\u2502      \u22ee          \u2502                                                              \u2502\n\u2502  \u30af\u30e9\u30a4\u30a2\u30f3\u30c8N \u2500\u2500\u2518                                                              \u2502\n\u2502                                                                                 \u2502\n\u2502  \u554f\u984c:                                                                          \u2502\n\u2502  - \u63a5\u7d9a\u78ba\u7acb\u306b50-100ms\u7a0b\u5ea6\u304b\u304b\u308b                                                 \u2502\n\u2502  - \u591a\u6570\u306e\u63a5\u7d9a\u306f\u30e1\u30e2\u30ea\u3092\u5927\u91cf\u6d88\u8cbb                                                 \u2502\n\u2502  - \u63a5\u7d9a\u6570\u306e\u4e0a\u9650\u306b\u9054\u3059\u308b\u3068\u65b0\u898f\u63a5\u7d9a\u304c\u62d2\u5426\u3055\u308c\u308b                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"12-\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u89e3\u6c7a\u7b56",children:"1.2 \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u89e3\u6c7a\u7b56"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u4ed5\u7d44\u307f                                   \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502     \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3     \u2502      \u2502   Connection    \u2502      \u2502  PostgreSQL   \u2502   \u2502\n\u2502  \u2502                         \u2502      \u2502     Pool        \u2502      \u2502               \u2502   \u2502\n\u2502  \u2502  \u30ea\u30af\u30a8\u30b9\u30c81 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2192\u2502 \u250c\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2510    \u2502      \u2502               \u2502   \u2502\n\u2502  \u2502  \u30ea\u30af\u30a8\u30b9\u30c82 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2192\u2502 \u2502\u63a5\u7d9a\u2502 \u2502\u63a5\u7d9a\u2502\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2192\u2502  \u30d0\u30c3\u30af\u30a8\u30f3\u30c9  \u2502   \u2502\n\u2502  \u2502  \u30ea\u30af\u30a8\u30b9\u30c83 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2192\u2502 \u2514\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2518    \u2502      \u2502  \u30d7\u30ed\u30bb\u30b9     \u2502   \u2502\n\u2502  \u2502        \u22ee               \u2502      \u2502  \u30d7\u30fc\u30eb (5-20)  \u2502      \u2502  (\u5c11\u6570)       \u2502   \u2502\n\u2502  \u2502  \u30ea\u30af\u30a8\u30b9\u30c8N \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2192\u2502                 \u2502      \u2502               \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                                 \u2502\n\u2502  \u5229\u70b9:                                                                          \u2502\n\u2502  - \u63a5\u7d9a\u306e\u518d\u5229\u7528\u3067\u9ad8\u901f\u5316                                                         \u2502\n\u2502  - PostgreSQL\u5074\u306e\u63a5\u7d9a\u6570\u3092\u6700\u5c0f\u9650\u306b                                               \u2502\n\u2502  - \u591a\u6570\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5c11\u6570\u306e\u63a5\u7d9a\u3067\u51e6\u7406                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"13-\u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u7a2e\u985e",children:"1.3 \u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u7a2e\u985e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      \u30d7\u30fc\u30ea\u30f3\u30b0\u306e\u5b9f\u88c5\u5834\u6240                                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u7a2e\u985e                   \u2502 \u8aac\u660e                                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074      \u2502 HikariCP, c3p0 \u306a\u3069                                    \u2502\n\u2502                       \u2502 \u5404\u30a2\u30d7\u30ea\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30d7\u30fc\u30eb\u3092\u6301\u3064                       \u2502\n\u2502                       \u2502 \u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6642\u306b\u63a5\u7d9a\u6570\u304c\u5897\u52a0                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u5916\u90e8\u30d7\u30fc\u30e9\u30fc           \u2502 PgBouncer, Pgpool-II \u306a\u3069                              \u2502\n\u2502                       \u2502 PostgreSQL\u3068\u30a2\u30d7\u30ea\u306e\u9593\u306b\u914d\u7f6e                            \u2502\n\u2502                       \u2502 \u8907\u6570\u30a2\u30d7\u30ea\u304b\u3089\u5171\u6709\u53ef\u80fd                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9     \u2502 RDS Proxy, Cloud SQL Connector \u306a\u3069                    \u2502\n\u2502                       \u2502 \u30af\u30e9\u30a6\u30c9\u74b0\u5883\u3067\u7d71\u5408\u7ba1\u7406                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"2-pgbouncer",children:"2. PgBouncer"}),"\n",(0,s.jsx)(e.h3,{id:"21-pgbouncer\u3068\u306f",children:"2.1 PgBouncer\u3068\u306f"}),"\n",(0,s.jsx)(e.p,{children:"PgBouncer\u306f\u3001PostgreSQL\u5411\u3051\u306e\u8efd\u91cf\u306a\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30e9\u30fc\u3067\u3059\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         PgBouncer \u306e\u7279\u5fb4                                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u2713 \u8efd\u91cf\uff081\u63a5\u7d9a\u3042\u305f\u308a\u7d042KB\uff09                                                      \u2502\n\u2502 \u2713 \u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u30fb\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5                                                \u2502\n\u2502 \u2713 3\u3064\u306e\u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9                                                        \u2502\n\u2502 \u2713 \u8a8d\u8a3c\u306e\u59d4\u8b72\u30fb\u4e2d\u7d99                                                             \u2502\n\u2502 \u2713 SSL/TLS \u30b5\u30dd\u30fc\u30c8                                                             \u2502\n\u2502 \u2713 \u30aa\u30f3\u30e9\u30a4\u30f3\u30ea\u30ed\u30fc\u30c9\u30fb\u518d\u8d77\u52d5                                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"22-\u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9",children:"2.2 \u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       PgBouncer \u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u30e2\u30fc\u30c9        \u2502 \u8aac\u660e                                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 session      \u2502 \u30bb\u30c3\u30b7\u30e7\u30f3\u5168\u4f53\u3067\u540c\u3058\u30b5\u30fc\u30d0\u30fc\u63a5\u7d9a\u3092\u4f7f\u7528                            \u2502\n\u2502              \u2502 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u5207\u65ad\u3059\u308b\u307e\u3067\u63a5\u7d9a\u3092\u4fdd\u6301                              \u2502\n\u2502              \u2502 \u30d7\u30fc\u30ea\u30f3\u30b0\u52b9\u679c\u306f\u9650\u5b9a\u7684\u3060\u304c\u3001\u3059\u3079\u3066\u306e\u6a5f\u80fd\u304c\u4f7f\u3048\u308b                  \u2502\n\u2502              \u2502                                                                  \u2502\n\u2502              \u2502 \u7528\u9014: \u30bb\u30c3\u30b7\u30e7\u30f3\u5909\u6570\u3001PREPARE\u6587\u3092\u591a\u7528\u3059\u308b\u5834\u5408                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 transaction  \u2502 \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5358\u4f4d\u3067\u63a5\u7d9a\u3092\u5272\u308a\u5f53\u3066\uff08\u63a8\u5968\uff09                      \u2502\n\u2502              \u2502 \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7d42\u4e86\u5f8c\u306b\u63a5\u7d9a\u3092\u30d7\u30fc\u30eb\u306b\u8fd4\u5374                        \u2502\n\u2502              \u2502 \u6700\u3082\u52b9\u7387\u7684\u306a\u30d7\u30fc\u30ea\u30f3\u30b0                                           \u2502\n\u2502              \u2502                                                                  \u2502\n\u2502              \u2502 \u5236\u9650: SET\u3001PREPARE\u3001\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u306f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5185\u306e\u307f         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 statement    \u2502 \u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u5358\u4f4d\u3067\u63a5\u7d9a\u3092\u5272\u308a\u5f53\u3066                                \u2502\n\u2502              \u2502 \u6700\u3082\u7a4d\u6975\u7684\u306a\u30d7\u30fc\u30ea\u30f3\u30b0                                           \u2502\n\u2502              \u2502                                                                  \u2502\n\u2502              \u2502 \u5236\u9650: \u8907\u6570\u6587\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4e0d\u53ef\u3001autocommit\u306e\u307f               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"23-\u57fa\u672c\u8a2d\u5b9a",children:"2.3 \u57fa\u672c\u8a2d\u5b9a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"; /etc/pgbouncer/pgbouncer.ini\n\n[databases]\n; \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3054\u3068\u306e\u8a2d\u5b9a\nmydb = host=localhost port=5432 dbname=mydb\n\n; \u63a5\u7d9a\u6587\u5b57\u5217\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\nmydb_readonly = host=replica.example.com port=5432 dbname=mydb\n\n[pgbouncer]\n; \u57fa\u672c\u8a2d\u5b9a\nlisten_addr = 0.0.0.0\nlisten_port = 6432\nauth_type = md5\nauth_file = /etc/pgbouncer/userlist.txt\n\n; \u30d7\u30fc\u30ea\u30f3\u30b0\u30e2\u30fc\u30c9\npool_mode = transaction\n\n; \u63a5\u7d9a\u6570\u5236\u9650\nmax_client_conn = 1000          ; \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u6700\u5927\u63a5\u7d9a\u6570\ndefault_pool_size = 20          ; \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3054\u3068\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\nmin_pool_size = 5               ; \u6700\u5c0f\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\nreserve_pool_size = 5           ; \u4e88\u5099\u306e\u63a5\u7d9a\u6570\n\n; \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u8a2d\u5b9a\nserver_idle_timeout = 600       ; \u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff08\u79d2\uff09\nclient_idle_timeout = 0         ; \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a2\u30a4\u30c9\u30eb\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff080=\u7121\u52b9\uff09\nquery_timeout = 0               ; \u30af\u30a8\u30ea\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff080=\u7121\u52b9\uff09\n\n; \u30ed\u30b0\u8a2d\u5b9a\nlog_connections = 1\nlog_disconnections = 1\nlog_pooler_errors = 1\n"})}),"\n",(0,s.jsx)(e.h3,{id:"24-\u8a8d\u8a3c\u8a2d\u5b9a",children:"2.4 \u8a8d\u8a3c\u8a2d\u5b9a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'; /etc/pgbouncer/userlist.txt\n; \u5f62\u5f0f: "username" "password"\n\n"myuser" "md5abc123..."   ; MD5\u30cf\u30c3\u30b7\u30e5\n"admin" "SCRAM-SHA-256$iterations:..."  ; SCRAM\u8a8d\u8a3c\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- PostgreSQL\u304b\u3089\u30d1\u30b9\u30ef\u30fc\u30c9\u30cf\u30c3\u30b7\u30e5\u3092\u53d6\u5f97\nSELECT usename, passwd FROM pg_shadow WHERE usename = 'myuser';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"25-\u7ba1\u7406\u30b3\u30de\u30f3\u30c9",children:"2.5 \u7ba1\u7406\u30b3\u30de\u30f3\u30c9"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- PgBouncer\u306b\u63a5\u7d9a\uff08\u7ba1\u7406\u7528\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\uff09\npsql -h localhost -p 6432 -U admin pgbouncer\n\n-- \u30d7\u30fc\u30eb\u72b6\u614b\u306e\u78ba\u8a8d\nSHOW POOLS;\n/*\n database |   user   | cl_active | cl_waiting | sv_active | sv_idle | sv_used\n----------+----------+-----------+------------+-----------+---------+--------\n mydb     | myuser   |        10 |          0 |         5 |      15 |       0\n*/\n\n-- \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\u306e\u78ba\u8a8d\nSHOW CLIENTS;\n\n-- \u30b5\u30fc\u30d0\u30fc\u63a5\u7d9a\u306e\u78ba\u8a8d\nSHOW SERVERS;\n\n-- \u7d71\u8a08\u60c5\u5831\nSHOW STATS;\n\n-- \u8a2d\u5b9a\u306e\u518d\u8aad\u307f\u8fbc\u307f\nRELOAD;\n\n-- \u30d7\u30fc\u30eb\u306e\u4e00\u6642\u505c\u6b62\u30fb\u518d\u958b\nPAUSE mydb;\nRESUME mydb;\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"3-\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u306e\u30d7\u30fc\u30ea\u30f3\u30b0",children:"3. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u306e\u30d7\u30fc\u30ea\u30f3\u30b0"}),"\n",(0,s.jsx)(e.h3,{id:"31-hikaricpjava",children:"3.1 HikariCP\uff08Java\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"# application.yml (Spring Boot)\nspring:\n  datasource:\n    url: jdbc:postgresql://localhost:5432/mydb\n    username: myuser\n    password: secret\n    hikari:\n      minimum-idle: 5           # \u6700\u5c0f\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\n      maximum-pool-size: 20     # \u6700\u5927\u63a5\u7d9a\u6570\n      idle-timeout: 300000      # \u30a2\u30a4\u30c9\u30eb\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff08\u30df\u30ea\u79d2\uff09\n      max-lifetime: 1800000     # \u63a5\u7d9a\u306e\u6700\u5927\u751f\u5b58\u671f\u9593\uff08\u30df\u30ea\u79d2\uff09\n      connection-timeout: 30000 # \u63a5\u7d9a\u53d6\u5f97\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n      pool-name: MyPool\n\n      # \u691c\u8a3c\u30af\u30a8\u30ea\uff08PostgreSQL\u306e\u5834\u5408\u306f\u4e0d\u8981\uff09\n      # connection-test-query: SELECT 1\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306e\u8a2d\u5b9a\nHikariConfig config = new HikariConfig();\nconfig.setJdbcUrl("jdbc:postgresql://localhost:5432/mydb");\nconfig.setUsername("myuser");\nconfig.setPassword("secret");\n\nconfig.setMinimumIdle(5);\nconfig.setMaximumPoolSize(20);\nconfig.setIdleTimeout(300000);\nconfig.setMaxLifetime(1800000);\nconfig.setConnectionTimeout(30000);\n\n// PostgreSQL\u56fa\u6709\u306e\u6700\u9069\u5316\nconfig.addDataSourceProperty("cachePrepStmts", "true");\nconfig.addDataSourceProperty("prepStmtCacheSize", "250");\nconfig.addDataSourceProperty("prepStmtCacheSqlLimit", "2048");\n\nHikariDataSource ds = new HikariDataSource(config);\n'})}),"\n",(0,s.jsx)(e.h3,{id:"32-\u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba",children:"3.2 \u9069\u5207\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u8a08\u7b97                                          \u2502\n\u2502                                                                                 \u2502\n\u2502  \u7d4c\u9a13\u5247:                                                                        \u2502\n\u2502  \u6700\u9069\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba \u2248 (CPU\u30b3\u30a2\u6570 \xd7 2) + \u30c7\u30a3\u30b9\u30af\u30b9\u30d4\u30f3\u30c9\u30eb\u6570                    \u2502\n\u2502                                                                                 \u2502\n\u2502  \u4f8b\uff1a4\u30b3\u30a2CPU\u3001SSD\uff08\u30b9\u30d4\u30f3\u30c9\u30eb=1\uff09\u306e\u5834\u5408                                        \u2502\n\u2502  \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba = (4 \xd7 2) + 1 = 9                                                 \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502  \u2502 \u6ce8\u610f: \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306f\u5927\u304d\u3051\u308c\u3070\u826f\u3044\u308f\u3051\u3067\u306f\u306a\u3044              \u2502                 \u2502\n\u2502  \u2502                                                           \u2502                 \u2502\n\u2502  \u2502 \u904e\u5927\u306a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u554f\u984c:                                  \u2502                 \u2502\n\u2502  \u2502 - \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30b9\u30a4\u30c3\u30c1\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9                     \u2502                 \u2502\n\u2502  \u2502 - \u30ed\u30c3\u30af\u7af6\u5408\u306e\u5897\u52a0                                         \u2502                 \u2502\n\u2502  \u2502 - \u30e1\u30e2\u30ea\u6d88\u8cbb\u306e\u5897\u52a0                                         \u2502                 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"33-\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u74b0\u5883\u3067\u306e\u8003\u616e\u70b9",children:"3.3 \u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u74b0\u5883\u3067\u306e\u8003\u616e\u70b9"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               \u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u74b0\u5883\u3067\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u7ba1\u7406                            \u2502\n\u2502                                                                                 \u2502\n\u2502  \u554f\u984c: \u5404\u30b5\u30fc\u30d3\u30b9\u304c\u30d7\u30fc\u30eb\u3092\u6301\u3064\u3068\u3001\u5408\u8a08\u63a5\u7d9a\u6570\u304c\u7206\u767a                              \u2502\n\u2502                                                                                 \u2502\n\u2502  \u30b5\u30fc\u30d3\u30b9A (5\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9) \xd7 20\u63a5\u7d9a = 100\u63a5\u7d9a                                   \u2502\n\u2502  \u30b5\u30fc\u30d3\u30b9B (3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9) \xd7 20\u63a5\u7d9a =  60\u63a5\u7d9a                                   \u2502\n\u2502  \u30b5\u30fc\u30d3\u30b9C (4\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9) \xd7 20\u63a5\u7d9a =  80\u63a5\u7d9a                                   \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                  \u2502\n\u2502  \u5408\u8a08: 240\u63a5\u7d9a \u2190 PostgreSQL\u306e\u9650\u754c\u3092\u8d85\u3048\u308b\u53ef\u80fd\u6027                                 \u2502\n\u2502                                                                                 \u2502\n\u2502  \u89e3\u6c7a\u7b56:                                                                        \u2502\n\u2502  1. PgBouncer\u3092\u4e2d\u9593\u306b\u914d\u7f6e\u3057\u3001\u30b5\u30fc\u30d0\u30fc\u63a5\u7d9a\u6570\u3092\u5236\u9650                               \u2502\n\u2502  2. \u5404\u30b5\u30fc\u30d3\u30b9\u306e\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u3092\u63a7\u3048\u3081\u306b\u8a2d\u5b9a                                      \u2502\n\u2502  3. RDS Proxy \u306a\u3069\u306e\u30de\u30cd\u30fc\u30b8\u30c9\u30d7\u30fc\u30e9\u30fc\u3092\u4f7f\u7528                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"                \u30a2\u30d7\u30ea\u5c64                  \u30d7\u30fc\u30e9\u30fc\u5c64              DB\u5c64\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u30b5\u30fc\u30d3\u30b9A                   \u2502    \u2502              \u2502    \u2502               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2510     \u2502    \u2502              \u2502    \u2502               \u2502\n\u2502  \u2502Pool \u2502\u2502Pool \u2502\u2502Pool \u2502 \u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2192\u2502              \u2502    \u2502               \u2502\n\u2502  \u2502(10) \u2502\u2502(10) \u2502\u2502(10) \u2502     \u2502    \u2502              \u2502    \u2502               \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2518     \u2502    \u2502  PgBouncer   \u2502    \u2502  PostgreSQL   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u2502              \u2502    \u2502               \u2502\n\u2502  \u30b5\u30fc\u30d3\u30b9B                   \u2502    \u2502  max_pool=50 \u2502\u2500\u2500\u2500\u2192\u2502 max_conn=100  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2510            \u2502    \u2502              \u2502    \u2502               \u2502\n\u2502  \u2502Pool \u2502\u2502Pool \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2192\u2502              \u2502    \u2502               \u2502\n\u2502  \u2502(10) \u2502\u2502(10) \u2502            \u2502    \u2502              \u2502    \u2502               \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2518            \u2502    \u2502              \u2502    \u2502               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"4-\u63a5\u7d9a\u6570\u306e\u8a2d\u8a08",children:"4. \u63a5\u7d9a\u6570\u306e\u8a2d\u8a08"}),"\n",(0,s.jsx)(e.h3,{id:"41-postgresql\u5074\u306e\u8a2d\u5b9a",children:"4.1 PostgreSQL\u5074\u306e\u8a2d\u5b9a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u73fe\u5728\u306e\u8a2d\u5b9a\u78ba\u8a8d\nSHOW max_connections;         -- \u6700\u5927\u63a5\u7d9a\u6570\uff08\u30c7\u30d5\u30a9\u30eb\u30c8100\uff09\nSHOW superuser_reserved_connections;  -- \u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc\u7528\u4e88\u7d04\uff08\u30c7\u30d5\u30a9\u30eb\u30c83\uff09\n\n-- \u4f7f\u7528\u53ef\u80fd\u306a\u63a5\u7d9a\u6570\nSELECT max_connections::int - superuser_reserved_connections::int AS available_connections\nFROM pg_settings\nWHERE name = 'max_connections'\nCROSS JOIN pg_settings\nWHERE name = 'superuser_reserved_connections';\n\n-- \u73fe\u5728\u306e\u63a5\u7d9a\u72b6\u6cc1\nSELECT\n    count(*) AS total_connections,\n    count(*) FILTER (WHERE state = 'active') AS active,\n    count(*) FILTER (WHERE state = 'idle') AS idle,\n    count(*) FILTER (WHERE state = 'idle in transaction') AS idle_in_transaction\nFROM pg_stat_activity\nWHERE backend_type = 'client backend';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"42-\u63a5\u7d9a\u6570\u306e\u898b\u7a4d\u3082\u308a",children:"4.2 \u63a5\u7d9a\u6570\u306e\u898b\u7a4d\u3082\u308a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      \u63a5\u7d9a\u6570\u306e\u898b\u7a4d\u3082\u308a\u4f8b                                          \u2502\n\u2502                                                                                 \u2502\n\u2502  \u524d\u63d0\u6761\u4ef6:                                                                      \u2502\n\u2502  - \u30a2\u30d7\u30ea\u30b5\u30fc\u30d0\u30fc: 10\u53f0                                                         \u2502\n\u2502  - \u5404\u30a2\u30d7\u30ea\u306e\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba: 20                                                   \u2502\n\u2502  - \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528: 5                                                        \u2502\n\u2502  - \u76e3\u8996\u30c4\u30fc\u30eb: 5                                                                \u2502\n\u2502  - \u7ba1\u7406\u8005\u63a5\u7d9a: 5                                                                \u2502\n\u2502                                                                                 \u2502\n\u2502  \u5fc5\u8981\u306a\u63a5\u7d9a\u6570:                                                                  \u2502\n\u2502  \u30a2\u30d7\u30ea: 10 \xd7 20 = 200                                                         \u2502\n\u2502  \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3: 5                                                            \u2502\n\u2502  \u76e3\u8996: 5                                                                        \u2502\n\u2502  \u7ba1\u7406: 5                                                                        \u2502\n\u2502  \u30d0\u30c3\u30d5\u30a1\uff0820%\uff09: 43                                                            \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                           \u2502\n\u2502  \u5408\u8a08: 258                                                                      \u2502\n\u2502                                                                                 \u2502\n\u2502  \u2192 max_connections = 260\u301c300 \u304c\u9069\u5207                                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"43-shared_buffers-\u3068\u306e\u95a2\u4fc2",children:"4.3 shared_buffers \u3068\u306e\u95a2\u4fc2"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u63a5\u7d9a\u6570\u3092\u5897\u3084\u3059\u5834\u5408\u306fshared_buffers\u3082\u8abf\u6574\u304c\u5fc5\u8981\n-- postgresql.conf\n\nmax_connections = 300\nshared_buffers = 4GB          -- \u63a5\u7d9a\u6570\u304c\u591a\u3044\u5834\u5408\u306f\u5897\u3084\u3059\n\n-- \u5404\u63a5\u7d9a\u306e\u30ef\u30fc\u30af\u30e1\u30e2\u30ea\nwork_mem = 64MB               -- \u63a5\u7d9a\u6570 \xd7 work_mem \u306e\u5408\u8a08\u306b\u6ce8\u610f\n\n-- \u5fc5\u8981\u30e1\u30e2\u30ea\u306e\u6982\u7b97\n-- shared_buffers + (max_connections \xd7 work_mem \xd7 \u540c\u6642\u5b9f\u884c\u30bd\u30fc\u30c8\u6570)\n-- 4GB + (300 \xd7 64MB \xd7 2) = 4GB + 38.4GB = \u7d0442GB\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"5-aws-rds-proxy",children:"5. AWS RDS Proxy"}),"\n",(0,s.jsx)(e.h3,{id:"51-rds-proxy\u3068\u306f",children:"5.1 RDS Proxy\u3068\u306f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         RDS Proxy \u306e\u7279\u5fb4                                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u2713 AWS\u30de\u30cd\u30fc\u30b8\u30c9\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30e9\u30fc                                            \u2502\n\u2502 \u2713 IAM\u8a8d\u8a3c\u3068\u306e\u7d71\u5408                                                               \u2502\n\u2502 \u2713 Secrets Manager \u3068\u306e\u7d71\u5408                                                      \u2502\n\u2502 \u2713 \u81ea\u52d5\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u5bfe\u5fdc                                                      \u2502\n\u2502 \u2713 \u30de\u30eb\u30c1AZ\u914d\u7f6e                                                                  \u2502\n\u2502 \u2713 Lambda\u95a2\u6570\u3068\u306e\u76f8\u6027\u304c\u826f\u3044                                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"52-\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",children:"5.2 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       RDS Proxy \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3                                   \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                              \u2502\n\u2502  \u2502   Lambda     \u2502                                                              \u2502\n\u2502  \u2502   \u95a2\u6570\u7fa4     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502                                                       \u2502\n\u2502                        \u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502      \u2502              \u2502      \u2502               \u2502         \u2502\n\u2502  \u2502     EC2      \u2502      \u251c\u2500\u2500\u2500\u2500\u2500\u2192\u2502  RDS Proxy   \u2502\u2500\u2500\u2500\u2500\u2500\u2192\u2502   RDS         \u2502         \u2502\n\u2502  \u2502  \u30a2\u30d7\u30ea\u7fa4    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2524      \u2502              \u2502      \u2502  (PostgreSQL) \u2502         \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502      \u2502  \u30fb\u63a5\u7d9a\u30d7\u30fc\u30eb \u2502      \u2502               \u2502         \u2502\n\u2502                        \u2502      \u2502  \u30fbIAM\u8a8d\u8a3c    \u2502      \u2502               \u2502         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502      \u2502  \u30fb\u30d5\u30a7\u30a4\u30eb   \u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502  \u2502     ECS      \u2502      \u2502      \u2502    \u30aa\u30fc\u30d0\u30fc   \u2502                                \u2502\n\u2502  \u2502  \u30b3\u30f3\u30c6\u30ca\u7fa4  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                              \u2502\n\u2502                                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"53-iam\u8a8d\u8a3c\u306e\u8a2d\u5b9a",children:"5.3 IAM\u8a8d\u8a3c\u306e\u8a2d\u5b9a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// Java\u3067\u306e IAM\u8a8d\u8a3c\u63a5\u7d9a\u4f8b\nimport software.amazon.awssdk.auth.credentials.DefaultCredentialsProvider;\nimport software.amazon.awssdk.services.rds.RdsUtilities;\n\nString authToken = RdsUtilities.builder()\n    .credentialsProvider(DefaultCredentialsProvider.create())\n    .region(Region.AP_NORTHEAST_1)\n    .build()\n    .generateAuthenticationToken(GenerateAuthenticationTokenRequest.builder()\n        .hostname("proxy-endpoint.proxy-xxxx.ap-northeast-1.rds.amazonaws.com")\n        .port(5432)\n        .username("db_user")\n        .build());\n\n// \u63a5\u7d9aURL\nString url = "jdbc:postgresql://proxy-endpoint.proxy-xxxx.ap-northeast-1.rds.amazonaws.com:5432/mydb" +\n    "?ssl=true&sslmode=require";\n\n// HikariCP\u8a2d\u5b9a\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u4ee3\u308f\u308a\u306b\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u7528\nconfig.setPassword(authToken);\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"6-\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",children:"6. \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"}),"\n",(0,s.jsx)(e.h3,{id:"61-\u63a5\u7d9a\u67af\u6e07",children:"6.1 \u63a5\u7d9a\u67af\u6e07"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u75c7\u72b6: \u65b0\u898f\u63a5\u7d9a\u304c\u3067\u304d\u306a\u3044\u3001\"too many clients\" \u30a8\u30e9\u30fc\n\n-- \u73fe\u5728\u306e\u63a5\u7d9a\u72b6\u6cc1\u3092\u78ba\u8a8d\nSELECT\n    usename,\n    application_name,\n    client_addr,\n    state,\n    count(*) as connection_count\nFROM pg_stat_activity\nWHERE backend_type = 'client backend'\nGROUP BY usename, application_name, client_addr, state\nORDER BY connection_count DESC;\n\n-- \u9577\u6642\u9593\u30a2\u30a4\u30c9\u30eb\u72b6\u614b\u306e\u63a5\u7d9a\u3092\u7279\u5b9a\nSELECT\n    pid,\n    usename,\n    application_name,\n    client_addr,\n    state,\n    query_start,\n    now() - query_start AS duration\nFROM pg_stat_activity\nWHERE state = 'idle'\n  AND now() - query_start > interval '30 minutes'\nORDER BY duration DESC;\n\n-- \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5f37\u5236\u5207\u65ad\nSELECT pg_terminate_backend(pid)\nFROM pg_stat_activity\nWHERE state = 'idle'\n  AND now() - query_start > interval '1 hour';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"62-idle-in-transaction",children:"6.2 idle in transaction"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u75c7\u72b6: \u63a5\u7d9a\u304c \"idle in transaction\" \u3067\u653e\u7f6e\u3055\u308c\u3066\u3044\u308b\n\n-- \u554f\u984c\u306e\u3042\u308b\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u7279\u5b9a\nSELECT\n    pid,\n    usename,\n    application_name,\n    state,\n    now() - xact_start AS transaction_duration,\n    query\nFROM pg_stat_activity\nWHERE state = 'idle in transaction'\n  AND now() - xact_start > interval '5 minutes'\nORDER BY transaction_duration DESC;\n\n-- \u81ea\u52d5\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306e\u8a2d\u5b9a\uff08PostgreSQL 9.6\u4ee5\u964d\uff09\n-- postgresql.conf\n-- idle_in_transaction_session_timeout = 300000  -- 5\u5206\u3067\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n"})}),"\n",(0,s.jsx)(e.h3,{id:"63-pgbouncer-\u306e\u554f\u984c",children:"6.3 PgBouncer \u306e\u554f\u984c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- PgBouncer\u306b\u63a5\u7d9a\u3057\u3066\u72b6\u614b\u78ba\u8a8d\npsql -h localhost -p 6432 pgbouncer\n\n-- \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5f85\u6a5f\u72b6\u6cc1\nSHOW POOLS;\n-- cl_waiting > 0 \u306e\u5834\u5408\u3001\u63a5\u7d9a\u5f85\u3061\u304c\u767a\u751f\u3057\u3066\u3044\u308b\n\n-- \u5bfe\u51e6\u6cd5:\n-- 1. default_pool_size \u3092\u5897\u3084\u3059\n-- 2. PostgreSQL\u306e max_connections \u3092\u5897\u3084\u3059\n-- 3. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u306e\u63a5\u7d9a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3092\u8a2d\u5b9a\n\n-- \u30b5\u30fc\u30d0\u30fc\u63a5\u7d9a\u306e\u72b6\u614b\nSHOW SERVERS;\n-- state = 'active' \u304c\u591a\u3059\u304e\u308b\u5834\u5408\u3001\u30af\u30a8\u30ea\u304c\u9045\u3044\u53ef\u80fd\u6027\n\n-- \u7d71\u8a08\u60c5\u5831\nSHOW STATS;\n-- avg_query_time \u304c\u5897\u52a0\u3057\u3066\u3044\u306a\u3044\u304b\u78ba\u8a8d\n"})}),"\n",(0,s.jsx)(e.h3,{id:"64-\u63a5\u7d9a\u30ea\u30fc\u30af\u306e\u691c\u51fa",children:"6.4 \u63a5\u7d9a\u30ea\u30fc\u30af\u306e\u691c\u51fa"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// Java\u3067\u306e\u63a5\u7d9a\u30ea\u30fc\u30af\u691c\u51fa\uff08HikariCP\uff09\nHikariConfig config = new HikariConfig();\nconfig.setLeakDetectionThreshold(60000);  // 60\u79d2\u4ee5\u4e0a\u4fdd\u6301\u3055\u308c\u305f\u3089\u8b66\u544a\n\n// \u30ed\u30b0\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8b66\u544a\u304c\u51fa\u308b\n// Connection leak detection triggered for connection ...\n// leaked connection was acquired from Thread ...\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         \u63a5\u7d9a\u30ea\u30fc\u30af\u306e\u4e00\u822c\u7684\u306a\u539f\u56e0                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1. \u4f8b\u5916\u767a\u751f\u6642\u306bconnection.close()\u304c\u547c\u3070\u308c\u306a\u3044                                   \u2502\n\u2502    \u2192 try-with-resources \u3092\u4f7f\u7528\u3059\u308b                                             \u2502\n\u2502                                                                                 \u2502\n\u2502 2. \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30b3\u30df\u30c3\u30c8/\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u5fd8\u308c                                  \u2502\n\u2502    \u2192 @Transactional \u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528                                       \u2502\n\u2502                                                                                 \u2502\n\u2502 3. ResultSet\u3084Statement\u306e\u30af\u30ed\u30fc\u30ba\u5fd8\u308c                                          \u2502\n\u2502    \u2192 try-with-resources \u3092\u4f7f\u7528                                                 \u2502\n\u2502                                                                                 \u2502\n\u2502 4. \u9577\u6642\u9593\u5b9f\u884c\u3055\u308c\u308b\u51e6\u7406\u4e2d\u306e\u63a5\u7d9a\u4fdd\u6301                                             \u2502\n\u2502    \u2192 \u51e6\u7406\u3092\u5206\u5272\u3057\u3001\u5fc5\u8981\u306a\u6642\u3060\u3051\u63a5\u7d9a\u3092\u53d6\u5f97                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// \u6b63\u3057\u3044\u63a5\u7d9a\u306e\u4f7f\u3044\u65b9\uff08try-with-resources\uff09\ntry (Connection conn = dataSource.getConnection();\n     PreparedStatement stmt = conn.prepareStatement(sql);\n     ResultSet rs = stmt.executeQuery()) {\n\n    while (rs.next()) {\n        // \u51e6\u7406\n    }\n}  // \u81ea\u52d5\u7684\u306bclose()\u304c\u547c\u3070\u308c\u308b\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"7-\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"7. \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,s.jsx)(e.h3,{id:"71-\u8a2d\u8a08\u539f\u5247",children:"7.1 \u8a2d\u8a08\u539f\u5247"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u7ba1\u7406\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u2713 \u63a5\u7d9a\u306f\u53ef\u80fd\u306a\u9650\u308a\u77ed\u6642\u9593\u3067\u8fd4\u5374\u3059\u308b                                              \u2502\n\u2502   - \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u77ed\u304f\u4fdd\u3064                                                  \u2502\n\u2502   - \u30e6\u30fc\u30b6\u30fc\u5165\u529b\u5f85\u3061\u3067\u63a5\u7d9a\u3092\u4fdd\u6301\u3057\u306a\u3044                                          \u2502\n\u2502                                                                                 \u2502\n\u2502 \u2713 \u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306f\u63a7\u3048\u3081\u306b\u8a2d\u5b9a\u3059\u308b                                                \u2502\n\u2502   - \u5fc5\u8981\u6700\u5c0f\u9650\u304b\u3089\u59cb\u3081\u3066\u3001\u76e3\u8996\u3057\u306a\u304c\u3089\u8abf\u6574                                      \u2502\n\u2502   - \u5927\u304d\u3059\u304e\u308b\u30d7\u30fc\u30eb\u306f\u304b\u3048\u3063\u3066\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u4e0b\u3052\u308b                            \u2502\n\u2502                                                                                 \u2502\n\u2502 \u2713 \u9069\u5207\u306a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3092\u8a2d\u5b9a\u3059\u308b                                                  \u2502\n\u2502   - \u63a5\u7d9a\u53d6\u5f97\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8                                                        \u2502\n\u2502   - \u30a2\u30a4\u30c9\u30eb\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8                                                        \u2502\n\u2502   - \u30af\u30a8\u30ea\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8                                                          \u2502\n\u2502                                                                                 \u2502\n\u2502 \u2713 \u63a5\u7d9a\u306e\u5065\u5168\u6027\u3092\u78ba\u8a8d\u3059\u308b                                                        \u2502\n\u2502   - HikariCP\u306f\u81ea\u52d5\u3067\u30c6\u30b9\u30c8\u30af\u30a8\u30ea\u3092\u5b9f\u884c                                          \u2502\n\u2502   - \u9577\u671f\u9593\u30a2\u30a4\u30c9\u30eb\u306e\u63a5\u7d9a\u306f\u7834\u68c4\u3057\u3066\u518d\u4f5c\u6210                                        \u2502\n\u2502                                                                                 \u2502\n\u2502 \u2713 \u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u74b0\u5883\u3067\u306f\u5916\u90e8\u30d7\u30fc\u30e9\u30fc\u3092\u691c\u8a0e                                    \u2502\n\u2502   - PgBouncer \u307e\u305f\u306f RDS Proxy                                                  \u2502\n\u2502   - \u63a5\u7d9a\u6570\u306e\u96c6\u4e2d\u7ba1\u7406\u304c\u53ef\u80fd                                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"72-\u63a8\u5968\u8a2d\u5b9a",children:"7.2 \u63a8\u5968\u8a2d\u5b9a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"# HikariCP \u63a8\u5968\u8a2d\u5b9a\uff08Spring Boot\uff09\nspring:\n  datasource:\n    hikari:\n      # \u57fa\u672c\u8a2d\u5b9a\n      maximum-pool-size: 10      # CPU\u30b3\u30a2\u6570\xd72\u7a0b\u5ea6\u304b\u3089\u958b\u59cb\n      minimum-idle: 5            # \u6700\u5c0f\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\n\n      # \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n      connection-timeout: 30000   # \u63a5\u7d9a\u53d6\u5f97\u5f85\u3061\uff0830\u79d2\uff09\n      idle-timeout: 600000        # \u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u306e\u751f\u5b58\u6642\u9593\uff0810\u5206\uff09\n      max-lifetime: 1800000       # \u63a5\u7d9a\u306e\u6700\u5927\u751f\u5b58\u6642\u9593\uff0830\u5206\uff09\n\n      # \u691c\u8a3c\n      validation-timeout: 5000    # \u63a5\u7d9a\u691c\u8a3c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff085\u79d2\uff09\n\n      # \u30ea\u30fc\u30af\u691c\u51fa\uff08\u958b\u767a\u74b0\u5883\u3067\u6709\u52b9\u5316\uff09\n      leak-detection-threshold: 60000  # 60\u79d2\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"; PgBouncer \u63a8\u5968\u8a2d\u5b9a\n[pgbouncer]\npool_mode = transaction           ; \u6700\u3082\u52b9\u7387\u7684\n\n; \u63a5\u7d9a\u6570\uff08\u74b0\u5883\u306b\u5fdc\u3058\u3066\u8abf\u6574\uff09\ndefault_pool_size = 20\nmin_pool_size = 5\nreserve_pool_size = 5\nmax_client_conn = 1000\n\n; \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\nserver_idle_timeout = 600         ; 10\u5206\nclient_idle_timeout = 0           ; \u7121\u52b9\uff08\u30a2\u30d7\u30ea\u5074\u3067\u7ba1\u7406\uff09\nserver_connect_timeout = 15\nserver_login_retry = 15\n\n; \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\ntcp_keepalive = 1\ntcp_keepidle = 60\n"})}),"\n",(0,s.jsx)(e.h3,{id:"73-\u76e3\u8996\u9805\u76ee",children:"7.3 \u76e3\u8996\u9805\u76ee"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u5b9a\u671f\u7684\u306b\u76e3\u8996\u3059\u3079\u304d\u9805\u76ee\n\n-- 1. \u63a5\u7d9a\u4f7f\u7528\u7387\nSELECT\n    count(*) * 100.0 / current_setting('max_connections')::int AS usage_percent\nFROM pg_stat_activity\nWHERE backend_type = 'client backend';\n\n-- 2. \u63a5\u7d9a\u5f85\u3061\u6642\u9593\uff08PgBouncer\uff09\n-- SHOW STATS; \u306e avg_wait_time\n\n-- 3. \u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u306e\u5272\u5408\nSELECT\n    count(*) FILTER (WHERE state = 'idle') * 100.0 / count(*) AS idle_percent\nFROM pg_stat_activity\nWHERE backend_type = 'client backend';\n\n-- 4. idle in transaction \u306e\u4ef6\u6570\nSELECT count(*)\nFROM pg_stat_activity\nWHERE state = 'idle in transaction';\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u307e\u3068\u3081",children:"\u307e\u3068\u3081"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30ea\u30f3\u30b0"}),"\u306fPostgreSQL\u306e\u63a5\u7d9a\u30b3\u30b9\u30c8\u3092\u524a\u6e1b\u3057\u3001\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3092\u5411\u4e0a\u3055\u305b\u308b"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"PgBouncer"}),"\u306f\u8efd\u91cf\u3067\u52b9\u7387\u7684\u306a\u5916\u90e8\u30d7\u30fc\u30e9\u30fc\u3068\u3057\u3066\u5e83\u304f\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"transaction \u30e2\u30fc\u30c9"}),"\u304c\u6700\u3082\u52b9\u7387\u7684\u3060\u304c\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u6a5f\u80fd\u306e\u5236\u9650\u306b\u6ce8\u610f"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba"}),"\u306f\u300cCPU\u30b3\u30a2\u6570 \xd7 2 + \u30c7\u30a3\u30b9\u30af\u6570\u300d\u3092\u76ee\u5b89\u306b\u3001\u5c0f\u3055\u304f\u59cb\u3081\u308b"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u9069\u5207\u306a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8"}),"\u8a2d\u5b9a\u3067\u63a5\u7d9a\u30ea\u30fc\u30af\u3084\u67af\u6e07\u3092\u9632\u3050"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u74b0\u5883"}),"\u3067\u306f\u5916\u90e8\u30d7\u30fc\u30e9\u30fc\uff08PgBouncer, RDS Proxy\uff09\u3092\u691c\u8a0e"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7",children:"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/idp-server/docs/content_11_learning/postgresql/dba-03-replication-ha",children:"dba-03-replication-ha.md"}),": \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u9ad8\u53ef\u7528\u6027"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"dba-04-backup-recovery.md",children:"dba-04-backup-recovery.md"}),": \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u30ea\u30ab\u30d0\u30ea"]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>o,x:()=>l});var r=i(96540);const s={},t=r.createContext(s);function o(n){const e=r.useContext(t);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),r.createElement(t.Provider,{value:e},n.children)}}}]);