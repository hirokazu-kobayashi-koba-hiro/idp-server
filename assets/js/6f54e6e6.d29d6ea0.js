"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[184],{21244:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>o,frontMatter:()=>i,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"content_06_developer-guide/reference/security-event-archive-guide","title":"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8 \u30a2\u30fc\u30ab\u30a4\u30d6\u30ac\u30a4\u30c9","description":"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u306e\u9577\u671f\u4fdd\u5b58\u3068\u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8\u3078\u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u6226\u7565\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002","source":"@site/docs/content_06_developer-guide/08-reference/security-event-archive-guide.md","sourceDirName":"content_06_developer-guide/08-reference","slug":"/content_06_developer-guide/reference/security-event-archive-guide","permalink":"/idp-server/docs/content_06_developer-guide/reference/security-event-archive-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_06_developer-guide/08-reference/security-event-archive-guide.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"pg_partman + pg_cron \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u904b\u7528\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_06_developer-guide/reference/pg-partman-operations-guide"},"next":{"title":"\u30c6\u30ca\u30f3\u30c8\u7d71\u8a08\u6a5f\u80fd \u5b9f\u88c5\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_06_developer-guide/reference/tenant-statistics-implementation"}}');var t=r(74848),d=r(28453);const i={},l="\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8 \u30a2\u30fc\u30ab\u30a4\u30d6\u30ac\u30a4\u30c9",c={},a=[{value:"\u6982\u8981",id:"\u6982\u8981",level:2},{value:"\u8ab2\u984c",id:"\u8ab2\u984c",level:3},{value:"\u89e3\u6c7a\u7b56",id:"\u89e3\u6c7a\u7b56",level:3},{value:"AWS\u69cb\u6210\u306e\u5168\u4f53\u50cf",id:"aws\u69cb\u6210\u306e\u5168\u4f53\u50cf",level:2},{value:"\u51e6\u7406\u30bf\u30a4\u30e0\u30e9\u30a4\u30f3",id:"\u51e6\u7406\u30bf\u30a4\u30e0\u30e9\u30a4\u30f3",level:3},{value:"\u30b3\u30b9\u30c8\u8a66\u7b97\uff08\u8a73\u7d30\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\uff09",id:"\u30b3\u30b9\u30c8\u8a66\u7b97\u8a73\u7d30\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3",level:3},{value:"\u524d\u63d0\u6761\u4ef6",id:"\u524d\u63d0\u6761\u4ef6",level:4},{value:"\u30b9\u30c8\u30ec\u30fc\u30b8\u5358\u4fa1\uff08\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u53c2\u8003\u5024\uff09",id:"\u30b9\u30c8\u30ec\u30fc\u30b8\u5358\u4fa1\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u53c2\u8003\u5024",level:4},{value:"\u30d1\u30bf\u30fc\u30f3A: DB\u306b\u305a\u3063\u3068\u4fdd\u6301\u3059\u308b\u5834\u5408",id:"\u30d1\u30bf\u30fc\u30f3a-db\u306b\u305a\u3063\u3068\u4fdd\u6301\u3059\u308b\u5834\u5408",level:4},{value:"\u30d1\u30bf\u30fc\u30f3B: 90\u65e5\u3067S3\u306b\u30a2\u30fc\u30ab\u30a4\u30d6\u3059\u308b\u5834\u5408",id:"\u30d1\u30bf\u30fc\u30f3b-90\u65e5\u3067s3\u306b\u30a2\u30fc\u30ab\u30a4\u30d6\u3059\u308b\u5834\u5408",level:4},{value:"\u30b3\u30b9\u30c8\u6bd4\u8f03\u30b5\u30de\u30ea\u30fc",id:"\u30b3\u30b9\u30c8\u6bd4\u8f03\u30b5\u30de\u30ea\u30fc",level:4},{value:"\u8ffd\u52a0\u30b3\u30b9\u30c8\uff08\u30d1\u30bf\u30fc\u30f3B\uff09",id:"\u8ffd\u52a0\u30b3\u30b9\u30c8\u30d1\u30bf\u30fc\u30f3b",level:4},{value:"\u7d50\u8ad6",id:"\u7d50\u8ad6",level:4},{value:"\u5fc5\u8981\u306aAWS\u30ea\u30bd\u30fc\u30b9",id:"\u5fc5\u8981\u306aaws\u30ea\u30bd\u30fc\u30b9",level:3},{value:"Step 1: \u30a2\u30fc\u30ab\u30a4\u30d6\u30b9\u30ad\u30fc\u30de\u306e\u4f5c\u6210",id:"step-1-\u30a2\u30fc\u30ab\u30a4\u30d6\u30b9\u30ad\u30fc\u30de\u306e\u4f5c\u6210",level:2},{value:"Step 2: pg_partman\u8a2d\u5b9a\u306e\u66f4\u65b0",id:"step-2-pg_partman\u8a2d\u5b9a\u306e\u66f4\u65b0",level:2},{value:"Step 3: \u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u95a2\u6570\u306e\u4f5c\u6210",id:"step-3-\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u95a2\u6570\u306e\u4f5c\u6210",level:2},{value:"3.1 \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u95a2\u6570\uff08\u30b9\u30bf\u30d6\uff09",id:"31-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u95a2\u6570\u30b9\u30bf\u30d6",level:3},{value:"3.2 \u30e1\u30a4\u30f3\u51e6\u7406\u95a2\u6570",id:"32-\u30e1\u30a4\u30f3\u51e6\u7406\u95a2\u6570",level:3},{value:"Step 4: pg_cron\u30b8\u30e7\u30d6\u306e\u8a2d\u5b9a",id:"step-4-pg_cron\u30b8\u30e7\u30d6\u306e\u8a2d\u5b9a",level:2},{value:"Step 5: \u30af\u30e9\u30a6\u30c9\u5225\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u5b9f\u88c5",id:"step-5-\u30af\u30e9\u30a6\u30c9\u5225\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u5b9f\u88c5",level:2},{value:"AWS S3 (Aurora PostgreSQL)",id:"aws-s3-aurora-postgresql",level:3},{value:"Google Cloud Storage (Cloud SQL)",id:"google-cloud-storage-cloud-sql",level:3},{value:"\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\uff08Docker\u74b0\u5883\uff09",id:"\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30ebdocker\u74b0\u5883",level:3},{value:"Step 6: Athena\u3067\u306e\u30af\u30a8\u30ea\u8a2d\u5b9a\uff08AWS\uff09",id:"step-6-athena\u3067\u306e\u30af\u30a8\u30ea\u8a2d\u5b9aaws",level:2},{value:"6.1 Glue Crawler\u306e\u8a2d\u5b9a",id:"61-glue-crawler\u306e\u8a2d\u5b9a",level:3},{value:"6.2 Athena\u30c6\u30fc\u30d6\u30eb\uff08\u624b\u52d5\u4f5c\u6210\u306e\u5834\u5408\uff09",id:"62-athena\u30c6\u30fc\u30d6\u30eb\u624b\u52d5\u4f5c\u6210\u306e\u5834\u5408",level:3},{value:"6.3 Athena\u30af\u30a8\u30ea\u4f8b",id:"63-athena\u30af\u30a8\u30ea\u4f8b",level:3},{value:"\u904b\u7528\u30ac\u30a4\u30c9",id:"\u904b\u7528\u30ac\u30a4\u30c9",level:2},{value:"\u30a2\u30fc\u30ab\u30a4\u30d6\u72b6\u6cc1\u306e\u78ba\u8a8d",id:"\u30a2\u30fc\u30ab\u30a4\u30d6\u72b6\u6cc1\u306e\u78ba\u8a8d",level:3},{value:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",id:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",level:3},{value:"archive\u30b9\u30ad\u30fc\u30de\u306b\u30c6\u30fc\u30d6\u30eb\u304c\u6e9c\u307e\u308b",id:"archive\u30b9\u30ad\u30fc\u30de\u306b\u30c6\u30fc\u30d6\u30eb\u304c\u6e9c\u307e\u308b",level:4},{value:"S3\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u304c\u5931\u6557\u3059\u308b",id:"s3\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u304c\u5931\u6557\u3059\u308b",level:4},{value:"Athena\u3067\u30c7\u30fc\u30bf\u304c\u898b\u3048\u306a\u3044",id:"athena\u3067\u30c7\u30fc\u30bf\u304c\u898b\u3048\u306a\u3044",level:4},{value:"\u30c7\u30fc\u30bf\u5f62\u5f0f\u306e\u63a8\u5968",id:"\u30c7\u30fc\u30bf\u5f62\u5f0f\u306e\u63a8\u5968",level:2},{value:"CSV vs Parquet",id:"csv-vs-parquet",level:3},{value:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8-\u30a2\u30fc\u30ab\u30a4\u30d6\u30ac\u30a4\u30c9",children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8 \u30a2\u30fc\u30ab\u30a4\u30d6\u30ac\u30a4\u30c9"})}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u306e\u9577\u671f\u4fdd\u5b58\u3068\u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8\u3078\u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u6226\u7565\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u6982\u8981",children:"\u6982\u8981"}),"\n",(0,t.jsx)(n.h3,{id:"\u8ab2\u984c",children:"\u8ab2\u984c"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"security_event"})," \u30c6\u30fc\u30d6\u30eb\u306f90\u65e5\u9593\u306e\u4fdd\u6301\u671f\u9593\u5f8c\u306b\u81ea\u52d5\u524a\u9664\u3055\u308c\u307e\u3059\u304c\u3001\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u3084\u76e3\u67fb\u8981\u4ef6\u306b\u3088\u308a\u3001\u3088\u308a\u9577\u671f\u9593\u306e\u30c7\u30fc\u30bf\u4fdd\u5b58\u304c\u5fc5\u8981\u306a\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"\u89e3\u6c7a\u7b56",children:"\u89e3\u6c7a\u7b56"}),"\n",(0,t.jsxs)(n.p,{children:["pg_partman\u306e ",(0,t.jsx)(n.code,{children:"retention_schema"})," \u6a5f\u80fd\u3092\u6d3b\u7528\u3057\u3001\u524a\u9664\u524d\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30a2\u30fc\u30ab\u30a4\u30d6\u30b9\u30ad\u30fc\u30de\u306b\u9000\u907f\u3002\u305d\u306e\u5f8c\u3001\u5916\u90e8\u30b9\u30c8\u30ec\u30fc\u30b8\uff08S3\u3001GCS\u3001Azure Blob\u7b49\uff09\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u30a2\u30fc\u30ab\u30a4\u30d6\u30d5\u30ed\u30fc                                                        \u2502\n\u2502                                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 security    \u2502   \u2502  archive    \u2502   \u2502   \u5916\u90e8      \u2502   \u2502  \u5206\u6790\u57fa\u76e4   \u2502 \u2502\n\u2502  \u2502  _event     \u2502\u2500\u2500\u25b6\u2502  schema     \u2502\u2500\u2500\u25b6\u2502 \u30b9\u30c8\u30ec\u30fc\u30b8  \u2502\u2500\u2500\u25b6\u2502 (Athena\u7b49)  \u2502 \u2502\n\u2502  \u2502  (90\u65e5)     \u2502   \u2502 (\u9000\u907f)      \u2502   \u2502 (S3\u7b49)      \u2502   \u2502             \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502        \u2502                 \u2502                 \u2502                 \u2502         \u2502\n\u2502    pg_partman        \u81ea\u52d5\u79fb\u52d5          \u30a8\u30af\u30b9\u30dd\u30fc\u30c8       \u30af\u30a8\u30ea\u691c\u7d22   \u2502\n\u2502    retention        (DETACH)          (Parquet)         (SQL)         \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"aws\u69cb\u6210\u306e\u5168\u4f53\u50cf",children:"AWS\u69cb\u6210\u306e\u5168\u4f53\u50cf"}),"\n",(0,t.jsx)(n.p,{children:"AWS\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306e\u63a8\u5968\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  AWS \u30a2\u30fc\u30ab\u30a4\u30d6\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3                                                        \u2502\n\u2502                                                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  VPC                                                                         \u2502   \u2502\n\u2502  \u2502                                                                              \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502   \u2502\n\u2502  \u2502  \u2502  Aurora PostgreSQL                                        \u2502               \u2502   \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502               \u2502   \u2502\n\u2502  \u2502  \u2502  \u2502 security_event \u2502    \u2502 archive schema \u2502                \u2502               \u2502   \u2502\n\u2502  \u2502  \u2502  \u2502   (90\u65e5\u4fdd\u6301)   \u2502\u2500\u2500\u2500\u25b6\u2502  (\u9000\u907f\u9818\u57df)    \u2502                \u2502               \u2502   \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502               \u2502   \u2502\n\u2502  \u2502  \u2502         \u2502                      \u2502                          \u2502               \u2502   \u2502\n\u2502  \u2502  \u2502    pg_partman              pg_cron                        \u2502               \u2502   \u2502\n\u2502  \u2502  \u2502    (02:00 UTC)            (03:00 UTC)                     \u2502               \u2502   \u2502\n\u2502  \u2502  \u2502                                \u2502                          \u2502               \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502  \u2502                                   \u2502                                          \u2502   \u2502\n\u2502  \u2502                                   \u2502 aws_s3 \u62e1\u5f35                              \u2502   \u2502\n\u2502  \u2502                                   \u2502 query_export_to_s3()                     \u2502   \u2502\n\u2502  \u2502                                   \u25bc                                          \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  S3 (\u30a2\u30fc\u30ab\u30a4\u30d6\u30b9\u30c8\u30ec\u30fc\u30b8)        \u2502                                           \u2502   \u2502\n\u2502  \u2502                                   \u25bc                                           \u2502   \u2502\n\u2502  \u2502  s3://idp-archive-bucket/                                                    \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500 security_event/                                                         \u2502   \u2502\n\u2502  \u2502      \u251c\u2500\u2500 year=2024/                                                          \u2502   \u2502\n\u2502  \u2502      \u2502   \u251c\u2500\u2500 month=01/                                                       \u2502   \u2502\n\u2502  \u2502      \u2502   \u2502   \u251c\u2500\u2500 day=01/data.csv                                             \u2502   \u2502\n\u2502  \u2502      \u2502   \u2502   \u251c\u2500\u2500 day=02/data.csv                                             \u2502   \u2502\n\u2502  \u2502      \u2502   \u2502   \u2514\u2500\u2500 ...                                                         \u2502   \u2502\n\u2502  \u2502      \u2502   \u2514\u2500\u2500 month=12/...                                                    \u2502   \u2502\n\u2502  \u2502      \u2514\u2500\u2500 year=2025/...                                                       \u2502   \u2502\n\u2502  \u2502                                                                              \u2502   \u2502\n\u2502  \u2502  \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u30dd\u30ea\u30b7\u30fc:                                                      \u2502   \u2502\n\u2502  \u2502  \u251c\u2500\u2500 0-90\u65e5:   S3 Standard                                                   \u2502   \u2502\n\u2502  \u2502  \u251c\u2500\u2500 90-365\u65e5: S3 Standard-IA                                                \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500 365\u65e5\u301c:  S3 Glacier Deep Archive                                       \u2502   \u2502\n\u2502  \u2502                                                                              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                              \u2502\n\u2502                                      \u2502                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  \u5206\u6790\u57fa\u76e4                         \u2502                                           \u2502   \u2502\n\u2502  \u2502                                   \u25bc                                           \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502   \u2502\n\u2502  \u2502  \u2502  Glue Crawler  \u2502\u2500\u2500\u2500\u25b6\u2502  Glue Catalog  \u2502\u25c0\u2500\u2500\u2500\u2502    Athena      \u2502             \u2502   \u2502\n\u2502  \u2502  \u2502  (04:00 UTC)   \u2502    \u2502  (\u30e1\u30bf\u30c7\u30fc\u30bf)  \u2502    \u2502  (SQL\u30af\u30a8\u30ea)   \u2502             \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502   \u2502\n\u2502  \u2502                                                      \u2502                       \u2502   \u2502\n\u2502  \u2502                                                      \u25bc                       \u2502   \u2502\n\u2502  \u2502                                             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502   \u2502\n\u2502  \u2502                                             \u2502   QuickSight   \u2502               \u2502   \u2502\n\u2502  \u2502                                             \u2502 (\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9)\u2502               \u2502   \u2502\n\u2502  \u2502                                             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502  \u2502                                                                              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fb\u6a29\u9650                                                           \u2502   \u2502\n\u2502  \u2502                                                                              \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502   \u2502\n\u2502  \u2502  \u2502  IAM Role      \u2502    \u2502  S3 Bucket     \u2502    \u2502    KMS         \u2502             \u2502   \u2502\n\u2502  \u2502  \u2502  (Aurora\u7528)    \u2502    \u2502    Policy      \u2502    \u2502  (\u6697\u53f7\u5316\u30ad\u30fc)  \u2502             \u2502   \u2502\n\u2502  \u2502  \u2502                \u2502    \u2502                \u2502    \u2502                \u2502             \u2502   \u2502\n\u2502  \u2502  \u2502 s3:PutObject   \u2502    \u2502 Aurora \u304b\u3089\u306e  \u2502    \u2502 S3 SSE-KMS     \u2502             \u2502   \u2502\n\u2502  \u2502  \u2502 s3:GetObject   \u2502    \u2502 \u30a2\u30af\u30bb\u30b9\u8a31\u53ef   \u2502    \u2502                \u2502             \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502   \u2502\n\u2502  \u2502                                                                              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u51e6\u7406\u30bf\u30a4\u30e0\u30e9\u30a4\u30f3",children:"\u51e6\u7406\u30bf\u30a4\u30e0\u30e9\u30a4\u30f3"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u65e5\u6b21\u51e6\u7406\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb (UTC)                                              \u2502\n\u2502                                                                         \u2502\n\u2502  02:00  pg_partman maintenance                                          \u2502\n\u2502         \u2514\u2500\u2500 90\u65e5\u7d4c\u904e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092 archive \u30b9\u30ad\u30fc\u30de\u306b DETACH           \u2502\n\u2502                                                                         \u2502\n\u2502  03:00  process_archived_partitions()                                   \u2502\n\u2502         \u2514\u2500\u2500 archive \u30b9\u30ad\u30fc\u30de\u306e\u30c6\u30fc\u30d6\u30eb\u3092 S3 \u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8 & DROP        \u2502\n\u2502                                                                         \u2502\n\u2502  04:00  Glue Crawler                                                    \u2502\n\u2502         \u2514\u2500\u2500 S3 \u306e\u65b0\u898f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u691c\u51fa\u3057 Glue Catalog \u3092\u66f4\u65b0         \u2502\n\u2502                                                                         \u2502\n\u2502  \u3044\u3064\u3067\u3082  Athena \u30af\u30a8\u30ea                                                 \u2502\n\u2502         \u2514\u2500\u2500 \u904e\u53bb\u30c7\u30fc\u30bf\u306e\u691c\u7d22\u30fb\u5206\u6790\u30fb\u30ec\u30dd\u30fc\u30c8\u751f\u6210                        \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u30b3\u30b9\u30c8\u8a66\u7b97\u8a73\u7d30\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3",children:"\u30b3\u30b9\u30c8\u8a66\u7b97\uff08\u8a73\u7d30\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\uff09"}),"\n",(0,t.jsx)(n.h4,{id:"\u524d\u63d0\u6761\u4ef6",children:"\u524d\u63d0\u6761\u4ef6"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u9805\u76ee"}),(0,t.jsx)(n.th,{children:"\u5024"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u30e6\u30fc\u30b6\u30fc\u6570"}),(0,t.jsx)(n.td,{children:"100\u4e07\u4eba"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1\u30e6\u30fc\u30b6\u30fc\u3042\u305f\u308a\u30a4\u30d9\u30f3\u30c8\u6570/\u65e5"}),(0,t.jsx)(n.td,{children:"100\u4ef6"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1\u65e5\u306e\u30a4\u30d9\u30f3\u30c8\u7dcf\u6570"}),(0,t.jsx)(n.td,{children:"1\u5104\u4ef6"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1\u30a4\u30d9\u30f3\u30c8\u3042\u305f\u308a\u306e\u30b5\u30a4\u30ba"}),(0,t.jsx)(n.td,{children:"500 bytes"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1\u65e5\u306e\u30c7\u30fc\u30bf\u91cf"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u7d0450GB"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u30ea\u30fc\u30b8\u30e7\u30f3"}),(0,t.jsx)(n.td,{children:"ap-northeast-1 (\u6771\u4eac)"})]})]})]}),"\n",(0,t.jsx)(n.h4,{id:"\u30b9\u30c8\u30ec\u30fc\u30b8\u5358\u4fa1\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u53c2\u8003\u5024",children:"\u30b9\u30c8\u30ec\u30fc\u30b8\u5358\u4fa1\uff08\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u53c2\u8003\u5024\uff09"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30b9\u30c8\u30ec\u30fc\u30b8\u7a2e\u5225"}),(0,t.jsx)(n.th,{children:"\u5358\u4fa1 (GB/\u6708)"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Aurora PostgreSQL"}),(0,t.jsx)(n.td,{children:"$0.12"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"S3 Standard"}),(0,t.jsx)(n.td,{children:"$0.025"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"S3 Glacier Deep Archive"}),(0,t.jsx)(n.td,{children:"$0.002"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["\u203b ",(0,t.jsx)(n.a,{href:"https://aws.amazon.com/s3/pricing/",children:"AWS\u516c\u5f0f\u6599\u91d1\u30da\u30fc\u30b8"}),"\u3067\u6700\u65b0\u4fa1\u683c\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"\u30d1\u30bf\u30fc\u30f3a-db\u306b\u305a\u3063\u3068\u4fdd\u6301\u3059\u308b\u5834\u5408",children:"\u30d1\u30bf\u30fc\u30f3A: DB\u306b\u305a\u3063\u3068\u4fdd\u6301\u3059\u308b\u5834\u5408"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Aurora PostgreSQL \u306b\u3059\u3079\u3066\u4fdd\u6301                                          \u2502\n\u2502                                                                         \u2502\n\u2502  \u30c7\u30fc\u30bf\u5897\u52a0: 50GB/\u65e5 \xd7 365\u65e5 = 18.25TB/\u5e74                               \u2502\n\u2502                                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                 \u2502   \u2502\n\u2502  \u2502  1\u5e74\u5f8c:  18.25TB  \u2502  2\u5e74\u5f8c:  36.5TB  \u2502  3\u5e74\u5f8c:  54.75TB        \u2502   \u2502\n\u2502  \u2502                                                                 \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u671f\u9593"}),(0,t.jsx)(n.th,{children:"\u7d2f\u7a4d\u30c7\u30fc\u30bf\u91cf"}),(0,t.jsx)(n.th,{children:"Aurora \u30b9\u30c8\u30ec\u30fc\u30b8\u6708\u984d"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"3\u30f6\u6708\u5f8c"}),(0,t.jsx)(n.td,{children:"4.5TB"}),(0,t.jsx)(n.td,{children:"$540"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"6\u30f6\u6708\u5f8c"}),(0,t.jsx)(n.td,{children:"9TB"}),(0,t.jsx)(n.td,{children:"$1,080"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1\u5e74\u5f8c"}),(0,t.jsx)(n.td,{children:"18.25TB"}),(0,t.jsx)(n.td,{children:"$2,190"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2\u5e74\u5f8c"}),(0,t.jsx)(n.td,{children:"36.5TB"}),(0,t.jsx)(n.td,{children:"$4,380"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"3\u5e74\u5f8c"}),(0,t.jsx)(n.td,{children:"54.75TB"}),(0,t.jsx)(n.td,{children:"$6,570"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"5\u5e74\u5f8c"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"91.25TB"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"$10,950/\u6708"})})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5e74\u9593\u30b3\u30b9\u30c8\uff085\u5e74\u904b\u7528\u6642\uff09"}),": \u7d04 ",(0,t.jsx)(n.strong,{children:"$131,400/\u5e74"}),"\uff08\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u307f\uff09"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"\u30d1\u30bf\u30fc\u30f3b-90\u65e5\u3067s3\u306b\u30a2\u30fc\u30ab\u30a4\u30d6\u3059\u308b\u5834\u5408",children:"\u30d1\u30bf\u30fc\u30f3B: 90\u65e5\u3067S3\u306b\u30a2\u30fc\u30ab\u30a4\u30d6\u3059\u308b\u5834\u5408"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  90\u65e5\u4fdd\u6301 + S3\u30a2\u30fc\u30ab\u30a4\u30d6                                                 \u2502\n\u2502                                                                         \u2502\n\u2502  Aurora: 50GB \xd7 90\u65e5 = 4.5TB (\u56fa\u5b9a)                                     \u2502\n\u2502  S3: \u6bce\u65e550GB\u304c\u8ffd\u52a0\u3055\u308c\u30011\u5e74\u5f8c\u306bGlacier\u3078                               \u2502\n\u2502                                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502\n\u2502  \u2502 Aurora        \u2502   \u2502 S3 Standard   \u2502   \u2502 S3 Glacier    \u2502             \u2502\n\u2502  \u2502 4.5TB (\u56fa\u5b9a)  \u2502   \u2502 (90\u65e5\u301c1\u5e74)   \u2502   \u2502 (1\u5e74\u8d85)       \u2502             \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30b9\u30c8\u30ec\u30fc\u30b8"}),(0,t.jsx)(n.th,{children:"\u30c7\u30fc\u30bf\u91cf"}),(0,t.jsx)(n.th,{children:"\u5358\u4fa1"}),(0,t.jsx)(n.th,{children:"\u6708\u984d\u30b3\u30b9\u30c8"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Aurora (90\u65e5\u5206)"}),(0,t.jsx)(n.td,{children:"4.5TB"}),(0,t.jsx)(n.td,{children:"$0.12/GB"}),(0,t.jsx)(n.td,{children:"$540"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"S3 Standard (90\u65e5\u301c1\u5e74\u5206)"}),(0,t.jsx)(n.td,{children:"13.75TB"}),(0,t.jsx)(n.td,{children:"$0.025/GB"}),(0,t.jsx)(n.td,{children:"$344"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"S3 Glacier (1\u5e74\u8d85\u30015\u5e74\u904b\u7528\u6642)"}),(0,t.jsx)(n.td,{children:"73TB"}),(0,t.jsx)(n.td,{children:"$0.002/GB"}),(0,t.jsx)(n.td,{children:"$146"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u5408\u8a08\uff085\u5e74\u904b\u7528\u6642\uff09"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"91.25TB"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"$1,030/\u6708"})})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5e74\u9593\u30b3\u30b9\u30c8\uff085\u5e74\u904b\u7528\u6642\uff09"}),": \u7d04 ",(0,t.jsx)(n.strong,{children:"$12,360/\u5e74"}),"\uff08\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u307f\uff09"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"\u30b3\u30b9\u30c8\u6bd4\u8f03\u30b5\u30de\u30ea\u30fc",children:"\u30b3\u30b9\u30c8\u6bd4\u8f03\u30b5\u30de\u30ea\u30fc"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  5\u5e74\u9593\u306e\u7d2f\u7a4d\u30b3\u30b9\u30c8\u6bd4\u8f03                                                   \u2502\n\u2502                                                                         \u2502\n\u2502  \u30d1\u30bf\u30fc\u30f3A (\u5168\u3066Aurora)                                                  \u2502\n\u2502  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  $657,000         \u2502\n\u2502                                                                         \u2502\n\u2502  \u30d1\u30bf\u30fc\u30f3B (90\u65e5+S3)                                                     \u2502\n\u2502  \u2588\u2588\u2588\u2588\u2588  $61,800                                                         \u2502\n\u2502                                                                         \u2502\n\u2502  \u524a\u6e1b\u52b9\u679c: \u7d0490%\u524a\u6e1b ($595,200\u306e\u7bc0\u7d04)                                   \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u6307\u6a19"}),(0,t.jsx)(n.th,{children:"\u30d1\u30bf\u30fc\u30f3A (\u5168\u3066Aurora)"}),(0,t.jsx)(n.th,{children:"\u30d1\u30bf\u30fc\u30f3B (90\u65e5+S3)"}),(0,t.jsx)(n.th,{children:"\u524a\u6e1b\u7387"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1\u5e74\u76ee \u6708\u984d"}),(0,t.jsx)(n.td,{children:"$1,095\u301c$2,190"}),(0,t.jsx)(n.td,{children:"$540\u301c$884"}),(0,t.jsx)(n.td,{children:"60%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5\u5e74\u76ee \u6708\u984d"}),(0,t.jsx)(n.td,{children:"$10,950"}),(0,t.jsx)(n.td,{children:"$1,030"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"91%"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5\u5e74\u9593\u7d2f\u7a4d"}),(0,t.jsx)(n.td,{children:"$657,000"}),(0,t.jsx)(n.td,{children:"$61,800"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"91%"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Aurora\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u9650"}),(0,t.jsx)(n.td,{children:"128TB\u3067\u9650\u754c"}),(0,t.jsx)(n.td,{children:"4.5TB\u56fa\u5b9a"}),(0,t.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"\u8ffd\u52a0\u30b3\u30b9\u30c8\u30d1\u30bf\u30fc\u30f3b",children:"\u8ffd\u52a0\u30b3\u30b9\u30c8\uff08\u30d1\u30bf\u30fc\u30f3B\uff09"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u9805\u76ee"}),(0,t.jsx)(n.th,{children:"\u6708\u984d\u30b3\u30b9\u30c8"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"S3\u3078\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\uff08PUT\uff09"}),(0,t.jsx)(n.td,{children:"~$50"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Athena\u30af\u30a8\u30ea\uff08100GB/\u6708\u30b9\u30ad\u30e3\u30f3\uff09"}),(0,t.jsx)(n.td,{children:"~$0.5"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Glue Crawler\uff081\u56de/\u65e5\uff09"}),(0,t.jsx)(n.td,{children:"~$15"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u30c7\u30fc\u30bf\u8ee2\u9001\uff08\u30ea\u30fc\u30b8\u30e7\u30f3\u5185\uff09"}),(0,t.jsx)(n.td,{children:"$0"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u8ffd\u52a0\u30b3\u30b9\u30c8\u5408\u8a08"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"~$66/\u6708"})})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"\u7d50\u8ad6",children:"\u7d50\u8ad6"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u89b3\u70b9"}),(0,t.jsx)(n.th,{children:"\u30d1\u30bf\u30fc\u30f3A"}),(0,t.jsx)(n.th,{children:"\u30d1\u30bf\u30fc\u30f3B"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u30b3\u30b9\u30c8"})}),(0,t.jsx)(n.td,{children:"\u9ad8\u3044\uff08\u5e74\u3005\u5897\u52a0\uff09"}),(0,t.jsx)(n.td,{children:"\u4f4e\u3044\uff08\u307b\u307c\u56fa\u5b9a\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3"})}),(0,t.jsx)(n.td,{children:"128TB\u4e0a\u9650"}),(0,t.jsx)(n.td,{children:"\u5b9f\u8cea\u7121\u5236\u9650"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u30af\u30a8\u30ea\u6027\u80fd\uff08\u76f4\u8fd190\u65e5\uff09"})}),(0,t.jsx)(n.td,{children:"\u9ad8\u901f"}),(0,t.jsx)(n.td,{children:"\u9ad8\u901f"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u30af\u30a8\u30ea\u6027\u80fd\uff08\u904e\u53bb\u30c7\u30fc\u30bf\uff09"})}),(0,t.jsx)(n.td,{children:"\u9ad8\u901f"}),(0,t.jsx)(n.td,{children:"\u4e2d\u901f\uff08Athena\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u904b\u7528\u8907\u96d1\u5ea6"})}),(0,t.jsx)(n.td,{children:"\u30b7\u30f3\u30d7\u30eb"}),(0,t.jsx)(n.td,{children:"\u3084\u3084\u8907\u96d1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u63a8\u5968\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9"})}),(0,t.jsx)(n.td,{children:"\u5c0f\u898f\u6a21\u30fb\u77ed\u671f"}),(0,t.jsx)(n.td,{children:"\u5927\u898f\u6a21\u30fb\u9577\u671f\u4fdd\u5b58"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u63a8\u5968"}),": 100\u4e07\u30e6\u30fc\u30b6\u30fc\u898f\u6a21\u3067\u306f**\u30d1\u30bf\u30fc\u30f3B\uff0890\u65e5+S3\u30a2\u30fc\u30ab\u30a4\u30d6\uff09**\u3092\u63a8\u5968"]}),"\n",(0,t.jsxs)(n.p,{children:["\u203b \u4e0a\u8a18\u306f\u6982\u7b97\u3067\u3059\u3002\u5b9f\u969b\u306e\u30b3\u30b9\u30c8\u306f",(0,t.jsx)(n.a,{href:"https://calculator.aws/",children:"AWS Pricing Calculator"}),"\u3067\u8a66\u7b97\u3057\u3066\u304f\u3060\u3055\u3044"]}),"\n",(0,t.jsx)(n.h3,{id:"\u5fc5\u8981\u306aaws\u30ea\u30bd\u30fc\u30b9",children:"\u5fc5\u8981\u306aAWS\u30ea\u30bd\u30fc\u30b9"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30ea\u30bd\u30fc\u30b9"}),(0,t.jsx)(n.th,{children:"\u7528\u9014"}),(0,t.jsx)(n.th,{children:"\u8a2d\u5b9a\u306e\u30dd\u30a4\u30f3\u30c8"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Aurora PostgreSQL"})}),(0,t.jsx)(n.td,{children:"\u30e1\u30a4\u30f3DB"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"aws_s3"})," \u62e1\u5f35\u6709\u52b9\u5316\u3001IAM\u30ed\u30fc\u30eb\u95a2\u9023\u4ed8\u3051"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"S3 Bucket"})}),(0,t.jsx)(n.td,{children:"\u30a2\u30fc\u30ab\u30a4\u30d6\u30b9\u30c8\u30ec\u30fc\u30b8"}),(0,t.jsx)(n.td,{children:"\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u30dd\u30ea\u30b7\u30fc\u3001\u6697\u53f7\u5316(SSE-KMS)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"IAM Role"})}),(0,t.jsx)(n.td,{children:"Aurora\u2192S3\u30a2\u30af\u30bb\u30b9"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"s3:PutObject"}),", ",(0,t.jsx)(n.code,{children:"s3:GetObject"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Glue Crawler"})}),(0,t.jsx)(n.td,{children:"\u30b9\u30ad\u30fc\u30de\u81ea\u52d5\u691c\u51fa"}),(0,t.jsx)(n.td,{children:"\u65e5\u6b21\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Glue Catalog"})}),(0,t.jsx)(n.td,{children:"\u30e1\u30bf\u30c7\u30fc\u30bf\u7ba1\u7406"}),(0,t.jsx)(n.td,{children:"Athena\u3068\u5171\u6709"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Athena"})}),(0,t.jsx)(n.td,{children:"SQL\u30af\u30a8\u30ea"}),(0,t.jsx)(n.td,{children:"Workgroup\u8a2d\u5b9a\u3001\u7d50\u679c\u51fa\u529b\u5148S3"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"KMS"})," (\u30aa\u30d7\u30b7\u30e7\u30f3)"]}),(0,t.jsx)(n.td,{children:"\u6697\u53f7\u5316"}),(0,t.jsx)(n.td,{children:"S3, Aurora\u4e21\u65b9\u3067\u4f7f\u7528"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-1-\u30a2\u30fc\u30ab\u30a4\u30d6\u30b9\u30ad\u30fc\u30de\u306e\u4f5c\u6210",children:"Step 1: \u30a2\u30fc\u30ab\u30a4\u30d6\u30b9\u30ad\u30fc\u30de\u306e\u4f5c\u6210"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- \u30a2\u30fc\u30ab\u30a4\u30d6\u7528\u30b9\u30ad\u30fc\u30de\u3092\u4f5c\u6210\nCREATE SCHEMA IF NOT EXISTS archive;\n\nCOMMENT ON SCHEMA archive IS 'Detached partitions awaiting export to external storage';\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-2-pg_partman\u8a2d\u5b9a\u306e\u66f4\u65b0",children:"Step 2: pg_partman\u8a2d\u5b9a\u306e\u66f4\u65b0"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- security_event \u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u8a2d\u5b9a\nUPDATE partman.part_config\nSET\n    retention = '90 days',\n    retention_keep_table = true,       -- \u524a\u9664\u305b\u305a\u306bDETACH\u306e\u307f\n    retention_schema = 'archive'       -- archive\u30b9\u30ad\u30fc\u30de\u306b\u79fb\u52d5\nWHERE parent_table = 'public.security_event';\n\n-- security_event_hook_results \u3082\u540c\u69d8\nUPDATE partman.part_config\nSET\n    retention = '90 days',\n    retention_keep_table = true,\n    retention_schema = 'archive'\nWHERE parent_table = 'public.security_event_hook_results';\n\n-- \u8a2d\u5b9a\u78ba\u8a8d\nSELECT parent_table, retention, retention_keep_table, retention_schema\nFROM partman.part_config\nWHERE parent_table LIKE 'public.security_event%';\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u52d5\u4f5c"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"90\u65e5\u7d4c\u904e\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306f\u89aa\u30c6\u30fc\u30d6\u30eb\u304b\u3089DETACH"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"archive"})," \u30b9\u30ad\u30fc\u30de\u306b\u79fb\u52d5\uff08\u4f8b: ",(0,t.jsx)(n.code,{children:"archive.security_event_p20250905"}),"\uff09"]}),"\n",(0,t.jsx)(n.li,{children:"\u30c6\u30fc\u30d6\u30eb\u306f\u524a\u9664\u3055\u308c\u305a\u306b\u4fdd\u6301"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-3-\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u95a2\u6570\u306e\u4f5c\u6210",children:"Step 3: \u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u95a2\u6570\u306e\u4f5c\u6210"}),"\n",(0,t.jsx)(n.h3,{id:"31-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u95a2\u6570\u30b9\u30bf\u30d6",children:"3.1 \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u95a2\u6570\uff08\u30b9\u30bf\u30d6\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- \u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u95a2\u6570\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5b9a\u7fa9\n-- \u5229\u7528\u8005\u304c\u81ea\u8eab\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5b9f\u88c5\u3059\u308b\nCREATE OR REPLACE FUNCTION archive.export_partition_to_external_storage(\n    p_schema_name TEXT,\n    p_table_name TEXT,\n    p_destination_path TEXT DEFAULT NULL\n)\nRETURNS BOOLEAN AS $$\nBEGIN\n    -- \u30c7\u30d5\u30a9\u30eb\u30c8\u5b9f\u88c5: \u4f55\u3082\u3057\u306a\u3044\uff08\u5229\u7528\u8005\u304c\u4e0a\u66f8\u304d\u5b9f\u88c5\uff09\n    RAISE NOTICE 'archive.export_partition_to_external_storage() not implemented. Override this function for your environment.';\n    RAISE NOTICE 'Table: %.%, Path: %', p_schema_name, p_table_name, COALESCE(p_destination_path, '(default)');\n    RETURN FALSE;\nEND;\n$$ LANGUAGE plpgsql;\n\nCOMMENT ON FUNCTION archive.export_partition_to_external_storage(TEXT, TEXT, TEXT) IS\n'Export archived partition to external storage. Override this function for your cloud environment (AWS S3, GCS, Azure Blob, etc.)';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"32-\u30e1\u30a4\u30f3\u51e6\u7406\u95a2\u6570",children:"3.2 \u30e1\u30a4\u30f3\u51e6\u7406\u95a2\u6570"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION archive.process_archived_partitions(\n    p_dry_run BOOLEAN DEFAULT FALSE\n)\nRETURNS TABLE(\n    table_name TEXT,\n    row_count BIGINT,\n    exported BOOLEAN,\n    dropped BOOLEAN,\n    message TEXT\n) AS $$\nDECLARE\n    tbl RECORD;\n    v_row_count BIGINT;\n    export_success BOOLEAN;\nBEGIN\n    RAISE NOTICE 'Starting archive processing (dry_run=%)', p_dry_run;\n\n    FOR tbl IN\n        SELECT t.tablename, t.schemaname\n        FROM pg_tables t\n        WHERE t.schemaname = 'archive'\n        ORDER BY t.tablename\n    LOOP\n        table_name := tbl.tablename;\n        exported := FALSE;\n        dropped := FALSE;\n\n        -- \u884c\u6570\u53d6\u5f97\n        EXECUTE format('SELECT COUNT(*) FROM %I.%I', tbl.schemaname, tbl.tablename)\n        INTO v_row_count;\n        row_count := v_row_count;\n\n        IF p_dry_run THEN\n            message := format('Would process: %s.%s (%s rows)', tbl.schemaname, tbl.tablename, v_row_count);\n            RAISE NOTICE '%', message;\n        ELSE\n            -- \u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u5b9f\u884c\n            BEGIN\n                export_success := archive.export_partition_to_external_storage(tbl.schemaname, tbl.tablename);\n                exported := export_success;\n\n                IF export_success THEN\n                    -- \u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u6210\u529f\u6642\u306e\u307f\u524a\u9664\n                    EXECUTE format('DROP TABLE %I.%I', tbl.schemaname, tbl.tablename);\n                    dropped := TRUE;\n                    message := format('Exported and dropped (%s rows)', v_row_count);\n                    RAISE NOTICE 'Dropped archived table %.%', tbl.schemaname, tbl.tablename;\n                ELSE\n                    message := format('Export not performed, table retained (%s rows)', v_row_count);\n                    RAISE NOTICE 'Keeping archived table %.%', tbl.schemaname, tbl.tablename;\n                END IF;\n            EXCEPTION WHEN OTHERS THEN\n                message := format('Error: %s', SQLERRM);\n                RAISE WARNING 'Error processing %.%: %', tbl.schemaname, tbl.tablename, SQLERRM;\n            END;\n        END IF;\n\n        RETURN NEXT;\n    END LOOP;\n\n    RAISE NOTICE 'Archive processing complete';\nEND;\n$$ LANGUAGE plpgsql;\n\nCOMMENT ON FUNCTION archive.process_archived_partitions(BOOLEAN) IS\n'Process archived partitions: export to external storage and drop if successful. Use p_dry_run=TRUE to preview without changes.';\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-4-pg_cron\u30b8\u30e7\u30d6\u306e\u8a2d\u5b9a",children:"Step 4: pg_cron\u30b8\u30e7\u30d6\u306e\u8a2d\u5b9a"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u91cd\u8981"}),": pg_cron \u306f ",(0,t.jsx)(n.code,{children:"postgres"})," \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\uff08\u30af\u30ed\u30b9\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30e2\u30fc\u30c9\uff09\u3002\n\u30b8\u30e7\u30d6\u767b\u9332\u306f ",(0,t.jsx)(n.code,{children:"postgres"})," \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u3057\u3066 ",(0,t.jsx)(n.code,{children:"cron.schedule_in_database()"})," \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- postgres \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\n-- psql -h localhost -U idp -d postgres\n\n-- \u30a2\u30fc\u30ab\u30a4\u30d6\u51e6\u7406\u30b8\u30e7\u30d6\uff08\u6bce\u65e503:00\u3001pg_partman\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u5f8c\uff09\nSELECT cron.schedule_in_database(\n    'archive-processing',\n    '0 3 * * *',\n    $$SELECT * FROM archive.process_archived_partitions(p_dry_run := FALSE)$$,\n    'idpserver'  -- \u5b9f\u884c\u5bfe\u8c61\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\n);\n\n-- \u30b8\u30e7\u30d6\u78ba\u8a8d\nSELECT jobid, jobname, schedule, database, command, active\nFROM cron.job\nWHERE jobname = 'archive-processing';\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-5-\u30af\u30e9\u30a6\u30c9\u5225\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u5b9f\u88c5",children:"Step 5: \u30af\u30e9\u30a6\u30c9\u5225\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u5b9f\u88c5"}),"\n",(0,t.jsx)(n.h3,{id:"aws-s3-aurora-postgresql",children:"AWS S3 (Aurora PostgreSQL)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- aws_s3 \u62e1\u5f35\u3092\u4f7f\u7528\nCREATE OR REPLACE FUNCTION archive.export_partition_to_external_storage(\n    p_schema_name TEXT,\n    p_table_name TEXT,\n    p_destination_path TEXT DEFAULT NULL\n)\nRETURNS BOOLEAN AS $$\nDECLARE\n    s3_bucket TEXT := 'your-archive-bucket';\n    s3_region TEXT := 'ap-northeast-1';\n    s3_path TEXT;\n    result_rows BIGINT;\nBEGIN\n    -- S3\u30d1\u30b9\u306e\u69cb\u7bc9\uff08Hive\u5f62\u5f0f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\uff09\n    -- \u4f8b: security_event_p20250905 \u2192 security_event/year=2025/month=09/day=05/\n    s3_path := COALESCE(p_destination_path, archive.build_s3_path(p_table_name));\n\n    -- S3\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\uff08Parquet\u5f62\u5f0f\u63a8\u5968\u3060\u304cCSV\u3082\u53ef\uff09\n    SELECT aws_s3.query_export_to_s3(\n        format('SELECT * FROM %I.%I', p_schema_name, p_table_name),\n        aws_commons.create_s3_uri(s3_bucket, s3_path, s3_region),\n        options := 'FORMAT CSV, HEADER TRUE'\n    ) INTO result_rows;\n\n    RAISE NOTICE 'Exported % rows to s3://%/%', result_rows, s3_bucket, s3_path;\n    RETURN TRUE;\n\nEXCEPTION WHEN OTHERS THEN\n    RAISE WARNING 'S3 export failed: %', SQLERRM;\n    RETURN FALSE;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- S3\u30d1\u30b9\u69cb\u7bc9\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\nCREATE OR REPLACE FUNCTION archive.build_s3_path(p_table_name TEXT)\nRETURNS TEXT AS $$\nDECLARE\n    -- security_event_p20250905 \u2192 2025, 09, 05 \u3092\u62bd\u51fa\n    date_part TEXT;\n    year_val TEXT;\n    month_val TEXT;\n    day_val TEXT;\n    base_name TEXT;\nBEGIN\n    -- \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u540d\u304b\u3089\u30d9\u30fc\u30b9\u540d\u3068\u65e5\u4ed8\u3092\u62bd\u51fa\n    -- \u4f8b: security_event_p20250905 \u307e\u305f\u306f security_event_hook_results_p20250905\n    IF p_table_name ~ '_p[0-9]{8}$' THEN\n        date_part := substring(p_table_name from '_p([0-9]{8})$');\n        base_name := regexp_replace(p_table_name, '_p[0-9]{8}$', '');\n        year_val := substring(date_part from 1 for 4);\n        month_val := substring(date_part from 5 for 2);\n        day_val := substring(date_part from 7 for 2);\n\n        RETURN format('%s/year=%s/month=%s/day=%s/data.csv',\n                      base_name, year_val, month_val, day_val);\n    ELSE\n        -- \u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\n        RETURN format('archive/%s/data.csv', p_table_name);\n    END IF;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"google-cloud-storage-cloud-sql",children:"Google Cloud Storage (Cloud SQL)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- pg_export_data \u95a2\u6570\u3092\u4f7f\u7528\uff08\u8981: cloudsql_import_export\u6a29\u9650\uff09\nCREATE OR REPLACE FUNCTION archive.export_partition_to_external_storage(\n    p_schema_name TEXT,\n    p_table_name TEXT,\n    p_destination_path TEXT DEFAULT NULL\n)\nRETURNS BOOLEAN AS $$\nDECLARE\n    gcs_bucket TEXT := 'gs://your-archive-bucket';\n    gcs_path TEXT;\nBEGIN\n    gcs_path := COALESCE(p_destination_path, archive.build_gcs_path(p_table_name));\n\n    -- Cloud SQL\u304b\u3089GCS\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\n    -- Note: Cloud SQL Admin API\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u5916\u90e8\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u5fc5\u8981\n    PERFORM pg_export_data(\n        format('SELECT * FROM %I.%I', p_schema_name, p_table_name),\n        gcs_bucket || '/' || gcs_path\n    );\n\n    RETURN TRUE;\nEXCEPTION WHEN OTHERS THEN\n    RAISE WARNING 'GCS export failed: %', SQLERRM;\n    RETURN FALSE;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30ebdocker\u74b0\u5883",children:"\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\uff08Docker\u74b0\u5883\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- COPY\u30b3\u30de\u30f3\u30c9\u3067\u30ed\u30fc\u30ab\u30eb\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\uff08pg_write_server_files\u6a29\u9650\u5fc5\u8981\uff09\n-- \u30c7\u30d5\u30a9\u30eb\u30c8\u30d1\u30b9: /var/lib/postgresql/data/archive (Docker\u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u5185)\nCREATE OR REPLACE FUNCTION archive.export_partition_to_external_storage(\n    p_schema_name TEXT,\n    p_table_name TEXT,\n    p_destination_path TEXT DEFAULT NULL\n)\nRETURNS BOOLEAN AS $$\nDECLARE\n    v_row_count BIGINT;\n    v_export_dir TEXT;\n    v_file_path TEXT;\nBEGIN\n    -- \u884c\u6570\u53d6\u5f97\n    EXECUTE format('SELECT COUNT(*) FROM %I.%I', p_schema_name, p_table_name)\n    INTO v_row_count;\n\n    IF v_row_count = 0 THEN\n        RAISE NOTICE 'Table %.% is empty, skipping export', p_schema_name, p_table_name;\n        RETURN TRUE;  -- \u7a7a\u30c6\u30fc\u30d6\u30eb\u306f\u6210\u529f\u6271\u3044\n    END IF;\n\n    -- \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u4ee5\u5916\u306f\u30b9\u30ad\u30c3\u30d7\n    IF p_table_name !~ '_p\\d{8}$' THEN\n        RAISE NOTICE 'Table %.% is not a partition table, skipping', p_schema_name, p_table_name;\n        RETURN FALSE;\n    END IF;\n\n    -- \u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u53d6\u5f97\n    v_export_dir := archive.get_config('export_directory', '/var/lib/postgresql/data/archive');\n\n    -- \u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u69cb\u7bc9\uff08\u30d5\u30e9\u30c3\u30c8\u69cb\u9020\uff09\n    v_file_path := v_export_dir || '/' || p_table_name || '.csv';\n\n    -- \u30ab\u30b9\u30bf\u30e0\u30d1\u30b9\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408\u306f\u305d\u3061\u3089\u3092\u4f7f\u7528\n    IF p_destination_path IS NOT NULL THEN\n        v_file_path := p_destination_path;\n    END IF;\n\n    RAISE NOTICE 'Exporting %.% (% rows) to %',\n        p_schema_name, p_table_name, v_row_count, v_file_path;\n\n    -- CSV\u30d5\u30a1\u30a4\u30eb\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\n    BEGIN\n        EXECUTE format(\n            'COPY (SELECT * FROM %I.%I) TO %L WITH (FORMAT CSV, HEADER)',\n            p_schema_name, p_table_name, v_file_path\n        );\n    EXCEPTION WHEN OTHERS THEN\n        RAISE WARNING 'Failed to export %.% to %: %',\n            p_schema_name, p_table_name, v_file_path, SQLERRM;\n        RETURN FALSE;\n    END;\n\n    RAISE NOTICE 'Successfully exported %.% to %', p_schema_name, p_table_name, v_file_path;\n    RETURN TRUE;\nEND;\n$$ LANGUAGE plpgsql;\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5fc5\u8981\u306a\u6a29\u9650"}),": ",(0,t.jsx)(n.code,{children:"GRANT pg_write_server_files TO <db_owner_user>;"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-6-athena\u3067\u306e\u30af\u30a8\u30ea\u8a2d\u5b9aaws",children:"Step 6: Athena\u3067\u306e\u30af\u30a8\u30ea\u8a2d\u5b9a\uff08AWS\uff09"}),"\n",(0,t.jsx)(n.h3,{id:"61-glue-crawler\u306e\u8a2d\u5b9a",children:"6.1 Glue Crawler\u306e\u8a2d\u5b9a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "Name": "security-event-archive-crawler",\n  "Role": "arn:aws:iam::ACCOUNT:role/GlueCrawlerRole",\n  "DatabaseName": "idp_archive",\n  "Targets": {\n    "S3Targets": [\n      {\n        "Path": "s3://your-archive-bucket/security_event/"\n      }\n    ]\n  },\n  "SchemaChangePolicy": {\n    "UpdateBehavior": "UPDATE_IN_DATABASE",\n    "DeleteBehavior": "LOG"\n  },\n  "Schedule": "cron(0 4 * * ? *)"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"62-athena\u30c6\u30fc\u30d6\u30eb\u624b\u52d5\u4f5c\u6210\u306e\u5834\u5408",children:"6.2 Athena\u30c6\u30fc\u30d6\u30eb\uff08\u624b\u52d5\u4f5c\u6210\u306e\u5834\u5408\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE EXTERNAL TABLE idp_archive.security_event (\n    id STRING,\n    type STRING,\n    description STRING,\n    tenant_id STRING,\n    tenant_name STRING,\n    client_id STRING,\n    client_name STRING,\n    user_id STRING,\n    user_name STRING,\n    external_user_id STRING,\n    ip_address STRING,\n    user_agent STRING,\n    detail STRING,\n    created_at TIMESTAMP\n)\nPARTITIONED BY (\n    year STRING,\n    month STRING,\n    day STRING\n)\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY ','\nSTORED AS TEXTFILE\nLOCATION 's3://your-archive-bucket/security_event/'\nTBLPROPERTIES ('skip.header.line.count'='1');\n\n-- \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u8ffd\u52a0\nMSCK REPAIR TABLE idp_archive.security_event;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"63-athena\u30af\u30a8\u30ea\u4f8b",children:"6.3 Athena\u30af\u30a8\u30ea\u4f8b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- \u904e\u53bb1\u5e74\u306e\u30ed\u30b0\u30a4\u30f3\u5931\u6557\u3092\u8abf\u67fb\nSELECT\n    tenant_id,\n    user_id,\n    created_at,\n    detail\nFROM idp_archive.security_event\nWHERE year = '2024'\n  AND type = 'login_failure'\n  AND tenant_id = 'your-tenant-id'\nORDER BY created_at DESC\nLIMIT 100;\n\n-- \u30c6\u30ca\u30f3\u30c8\u5225\u306e\u30a4\u30d9\u30f3\u30c8\u96c6\u8a08\nSELECT\n    tenant_id,\n    type,\n    COUNT(*) as event_count\nFROM idp_archive.security_event\nWHERE year = '2024' AND month = '06'\nGROUP BY tenant_id, type\nORDER BY event_count DESC;\n\n-- \u4e0d\u5be9\u306aIP\u30a2\u30c9\u30ec\u30b9\u306e\u691c\u51fa\nSELECT\n    ip_address,\n    COUNT(DISTINCT user_id) as affected_users,\n    COUNT(*) as attempt_count\nFROM idp_archive.security_event\nWHERE type = 'login_failure'\n  AND year >= '2024'\nGROUP BY ip_address\nHAVING COUNT(*) > 100\nORDER BY attempt_count DESC;\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u904b\u7528\u30ac\u30a4\u30c9",children:"\u904b\u7528\u30ac\u30a4\u30c9"}),"\n",(0,t.jsx)(n.h3,{id:"\u30a2\u30fc\u30ab\u30a4\u30d6\u72b6\u6cc1\u306e\u78ba\u8a8d",children:"\u30a2\u30fc\u30ab\u30a4\u30d6\u72b6\u6cc1\u306e\u78ba\u8a8d"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- archive\u30b9\u30ad\u30fc\u30de\u306e\u30c6\u30fc\u30d6\u30eb\u4e00\u89a7\uff08archive.get_archive_status\u95a2\u6570\u3092\u4f7f\u7528\uff09\nSELECT * FROM archive.get_archive_status();\n\n-- \u307e\u305f\u306f\u624b\u52d5\u30af\u30a8\u30ea\nSELECT\n    tablename,\n    pg_size_pretty(pg_total_relation_size('archive.' || tablename)) as size\nFROM pg_tables\nWHERE schemaname = 'archive'\nORDER BY tablename DESC;\n\n-- pg_cron\u30b8\u30e7\u30d6\u306e\u5b9f\u884c\u5c65\u6b74\n-- \u6ce8\u610f: pg_cron \u306f postgres \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\n-- psql -h localhost -U idp -d postgres \u3067\u63a5\u7d9a\u3057\u3066\u5b9f\u884c\nSELECT\n    jobid,\n    jobname,\n    start_time,\n    end_time,\n    status,\n    return_message\nFROM cron.job_run_details\nWHERE jobname IN ('partman-maintenance', 'archive-processing')\nORDER BY start_time DESC\nLIMIT 10;\n\n-- dry run\u3067\u30a2\u30fc\u30ab\u30a4\u30d6\u5bfe\u8c61\u3092\u78ba\u8a8d\nSELECT * FROM archive.process_archived_partitions(p_dry_run := TRUE);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",children:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"}),"\n",(0,t.jsx)(n.h4,{id:"archive\u30b9\u30ad\u30fc\u30de\u306b\u30c6\u30fc\u30d6\u30eb\u304c\u6e9c\u307e\u308b",children:"archive\u30b9\u30ad\u30fc\u30de\u306b\u30c6\u30fc\u30d6\u30eb\u304c\u6e9c\u307e\u308b"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u539f\u56e0"}),": \u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u95a2\u6570\u304c\u672a\u5b9f\u88c5\u307e\u305f\u306f\u5931\u6557\u3057\u3066\u3044\u308b"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5bfe\u51e6"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"archive.export_partition_to_external_storage()"})," \u95a2\u6570\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d"]}),"\n",(0,t.jsx)(n.li,{children:"pg_cron\u30b8\u30e7\u30d6\u306e\u30ed\u30b0\u3092\u78ba\u8a8d"}),"\n",(0,t.jsx)(n.li,{children:"\u624b\u52d5\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3092\u8a66\u884c"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- \u624b\u52d5\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30c6\u30b9\u30c8\nSELECT archive.export_partition_to_external_storage('archive', 'security_event_p20250905');\n\n-- \u307e\u305f\u306fprocess_archived_partitions\u3067\u4e00\u62ec\u51e6\u7406\nSELECT * FROM archive.process_archived_partitions(p_dry_run := FALSE);\n"})}),"\n",(0,t.jsx)(n.h4,{id:"s3\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u304c\u5931\u6557\u3059\u308b",children:"S3\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u304c\u5931\u6557\u3059\u308b"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u539f\u56e0"}),": IAM\u30ed\u30fc\u30eb\u6a29\u9650\u4e0d\u8db3\u3001S3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5bfe\u51e6"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Aurora/RDS\u306eIAM\u30ed\u30fc\u30eb\u306b ",(0,t.jsx)(n.code,{children:"s3:PutObject"})," \u6a29\u9650\u304c\u3042\u308b\u304b\u78ba\u8a8d"]}),"\n",(0,t.jsx)(n.li,{children:"S3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067RDS\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"athena\u3067\u30c7\u30fc\u30bf\u304c\u898b\u3048\u306a\u3044",children:"Athena\u3067\u30c7\u30fc\u30bf\u304c\u898b\u3048\u306a\u3044"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u539f\u56e0"}),": \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u304c\u8a8d\u8b58\u3055\u308c\u3066\u3044\u306a\u3044"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5bfe\u51e6"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u518d\u30b9\u30ad\u30e3\u30f3\nMSCK REPAIR TABLE idp_archive.security_event;\n\n-- \u307e\u305f\u306f\u624b\u52d5\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u8ffd\u52a0\nALTER TABLE idp_archive.security_event\nADD PARTITION (year='2025', month='09', day='05')\nLOCATION 's3://your-archive-bucket/security_event/year=2025/month=09/day=05/';\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u30c7\u30fc\u30bf\u5f62\u5f0f\u306e\u63a8\u5968",children:"\u30c7\u30fc\u30bf\u5f62\u5f0f\u306e\u63a8\u5968"}),"\n",(0,t.jsx)(n.h3,{id:"csv-vs-parquet",children:"CSV vs Parquet"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u5f62\u5f0f"}),(0,t.jsx)(n.th,{children:"\u5727\u7e2e\u7387"}),(0,t.jsx)(n.th,{children:"\u30af\u30a8\u30ea\u6027\u80fd"}),(0,t.jsx)(n.th,{children:"\u4e92\u63db\u6027"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CSV"}),(0,t.jsx)(n.td,{children:"\u4f4e"}),(0,t.jsx)(n.td,{children:"\u4f4e"}),(0,t.jsx)(n.td,{children:"\u9ad8\uff08\u3069\u3053\u3067\u3082\u8aad\u3081\u308b\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Parquet"}),(0,t.jsx)(n.td,{children:"\u9ad8"}),(0,t.jsx)(n.td,{children:"\u9ad8"}),(0,t.jsx)(n.td,{children:"\u4e2d\uff08\u5c02\u7528\u30c4\u30fc\u30eb\u5fc5\u8981\uff09"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u63a8\u5968"}),": \u9577\u671f\u4fdd\u5b58\u30fb\u5206\u6790\u7528\u9014\u306b\u306f ",(0,t.jsx)(n.strong,{children:"Parquet\u5f62\u5f0f"})," \u3092\u63a8\u5968"]}),"\n",(0,t.jsx)(n.p,{children:"Parquet\u5f62\u5f0f\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3059\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5916\u90e8\u30c4\u30fc\u30eb\u3092\u4f7f\u7528:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pg_dump"})," + ",(0,t.jsx)(n.code,{children:"parquet-tools"})]}),"\n",(0,t.jsx)(n.li,{children:"AWS Glue ETL Job"}),"\n",(0,t.jsx)(n.li,{children:"Python + pandas + pyarrow"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/reference/database-partitioning-guide",children:"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u30ac\u30a4\u30c9"})," - pg_partman\u8a2d\u5b9a\u8a73\u7d30"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/idp-server/docs/content_06_developer-guide/reference/tenant-statistics-implementation",children:"\u30c6\u30ca\u30f3\u30c8\u7d71\u8a08\u6a5f\u80fd \u5b9f\u88c5\u30ac\u30a4\u30c9"})," - \u7d71\u8a08\u30c7\u30fc\u30bf\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/idp-server/docs/content_03_concepts/concept-11-security-events",children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8"})," - \u30a4\u30d9\u30f3\u30c8\u7a2e\u5225\u4e00\u89a7"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var s=r(96540);const t={},d=s.createContext(t);function i(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);