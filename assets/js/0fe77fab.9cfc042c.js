"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[9331],{75339:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"content_10_ai_developer/ai-42-webauthn","title":"idp-server-webauthn4j-adapter","description":"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981","source":"@site/docs/content_10_ai_developer/ai-42-webauthn.md","sourceDirName":"content_10_ai_developer","slug":"/content_10_ai_developer/ai-42-webauthn","permalink":"/idp-server/docs/content_10_ai_developer/ai-42-webauthn","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_10_ai_developer/ai-42-webauthn.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"idp-server-authentication-interactors - \u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30bf\u30fc","permalink":"/idp-server/docs/content_10_ai_developer/ai-41-authentication"},"next":{"title":"idp-server-federation-oidc","permalink":"/idp-server/docs/content_10_ai_developer/ai-43-federation-oidc"}}');var r=t(74848),a=t(28453);const o={},s="idp-server-webauthn4j-adapter",c={},h=[{value:"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981",id:"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981",level:2},{value:"\u8cac\u52d9",id:"\u8cac\u52d9",level:3},{value:"\u4e3b\u8981\u6a5f\u80fd",id:"\u4e3b\u8981\u6a5f\u80fd",level:3},{value:"WebAuthnExecutor \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",id:"webauthnexecutor-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",level:2},{value:"WebAuthn4jExecutor - webauthn4j\u5b9f\u88c5",id:"webauthn4jexecutor---webauthn4j\u5b9f\u88c5",level:2},{value:"Plugin\u767b\u9332",id:"plugin\u767b\u9332",level:2},{value:"Attestation Format",id:"attestation-format",level:2},{value:"User Verification",id:"user-verification",level:2},{value:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"idp-server-webauthn4j-adapter",children:"idp-server-webauthn4j-adapter"})}),"\n",(0,r.jsx)(n.h2,{id:"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981",children:"\u30e2\u30b8\u30e5\u30fc\u30eb\u6982\u8981"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,r.jsx)(n.code,{children:"libs/idp-server-webauthn4j-adapter/"}),"\n",(0,r.jsx)(n.strong,{children:"\u78ba\u8a8d\u65e5"}),": 2025-10-12"]}),"\n",(0,r.jsx)(n.h3,{id:"\u8cac\u52d9",children:"\u8cac\u52d9"}),"\n",(0,r.jsx)(n.p,{children:"WebAuthn/FIDO2\u5b9f\u88c5\uff08webauthn4j\u30e9\u30a4\u30d6\u30e9\u30ea\u7d71\u5408\uff09\u3002"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4ed5\u69d8"}),": ",(0,r.jsx)(n.a,{href:"https://www.w3.org/TR/webauthn-2/",children:"Web Authentication Level 2"})]}),"\n",(0,r.jsx)(n.h3,{id:"\u4e3b\u8981\u6a5f\u80fd",children:"\u4e3b\u8981\u6a5f\u80fd"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Registration"}),": \u8a8d\u8a3c\u5668\u767b\u9332\uff08Passkey\u4f5c\u6210\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authentication"}),": \u8a8d\u8a3c\u5668\u691c\u8a3c"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Attestation"}),": \u8a8d\u8a3c\u5668\u8a3c\u660e\uff08\u30c7\u30d0\u30a4\u30b9\u4fe1\u983c\u6027\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User Verification"}),": \u30e6\u30fc\u30b6\u30fc\u691c\u8a3c\uff08PIN/\u751f\u4f53\u8a8d\u8a3c\uff09"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"webauthnexecutor-\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",children:"WebAuthnExecutor \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(607).A+"#L23",children:"WebAuthnExecutor.java:23"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u91cd\u8981"}),": ",(0,r.jsx)(n.code,{children:"authentication-interactors"})," \u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u5b9a\u7fa9\uff08Core\u5c64\u3067\u306f\u306a\u3044\uff09"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"/**\n * WebAuthn\u5b9f\u884c\u30a8\u30f3\u30b8\u30f3\uff08Plugin\uff09\n * \u78ba\u8a8d\u65b9\u6cd5: \u5b9f\u30d5\u30a1\u30a4\u30eb\u306e23-51\u884c\u76ee\n */\npublic interface WebAuthnExecutor {\n\n  // \u2705 Executor\u30bf\u30a4\u30d7\n  WebAuthnExecutorType type();\n\n  // \u2705 \u767b\u9332\u30c1\u30e3\u30ec\u30f3\u30b8\u751f\u6210\n  WebAuthnChallenge challengeRegistration(\n      Tenant tenant,\n      AuthenticationTransactionIdentifier authenticationTransactionIdentifier,\n      AuthenticationInteractionRequest request,\n      WebAuthnConfiguration configuration);\n\n  // \u2705 \u767b\u9332\u691c\u8a3c\n  WebAuthnVerificationResult verifyRegistration(\n      Tenant tenant,\n      AuthenticationTransactionIdentifier authenticationTransactionIdentifier,\n      String userId,\n      AuthenticationInteractionRequest request,\n      WebAuthnConfiguration configuration);\n\n  // \u2705 \u8a8d\u8a3c\u30c1\u30e3\u30ec\u30f3\u30b8\u751f\u6210\n  WebAuthnChallenge challengeAuthentication(\n      Tenant tenant,\n      AuthenticationTransactionIdentifier authenticationTransactionIdentifier,\n      AuthenticationInteractionRequest request,\n      WebAuthnConfiguration configuration);\n\n  // \u2705 \u8a8d\u8a3c\u691c\u8a3c\n  WebAuthnVerificationResult verifyAuthentication(\n      Tenant tenant,\n      AuthenticationTransactionIdentifier authenticationTransactionIdentifier,\n      String userId,\n      AuthenticationInteractionRequest request,\n      WebAuthnConfiguration configuration);\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"webauthn4jexecutor---webauthn4j\u5b9f\u88c5",children:"WebAuthn4jExecutor - webauthn4j\u5b9f\u88c5"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(3295).A+"#L28",children:"WebAuthn4jExecutor.java:28"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * webauthn4j\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u305fWebAuthn\u5b9f\u88c5\n * \u78ba\u8a8d\u65b9\u6cd5: \u5b9f\u30d5\u30a1\u30a4\u30eb\u306e28-80\u884c\u76ee\n */\npublic class WebAuthn4jExecutor implements WebAuthnExecutor {\n\n  AuthenticationInteractionCommandRepository transactionCommandRepository;\n  AuthenticationInteractionQueryRepository transactionQueryRepository;\n  WebAuthn4jCredentialRepository credentialRepository;\n  JsonConverter jsonConverter;\n\n  @Override\n  public WebAuthnExecutorType type() {\n    return new WebAuthnExecutorType("webauthn4j");\n  }\n\n  @Override\n  public WebAuthnChallenge challengeRegistration(\n      Tenant tenant,\n      AuthenticationTransactionIdentifier authenticationTransactionIdentifier,\n      AuthenticationInteractionRequest request,\n      WebAuthnConfiguration configuration) {\n\n    // 1. \u30c1\u30e3\u30ec\u30f3\u30b8\u751f\u6210\n    WebAuthn4jChallenge webAuthn4jChallenge = WebAuthn4jChallenge.generate();\n    WebAuthnChallenge webAuthnChallenge = webAuthn4jChallenge.toWebAuthnChallenge();\n\n    // 2. \u30c1\u30e3\u30ec\u30f3\u30b8\u3092\u4e00\u6642\u4fdd\u5b58\uff08Redis/DB\uff09\n    transactionCommandRepository.register(\n        tenant,\n        authenticationTransactionIdentifier,\n        type().value(),\n        webAuthnChallenge);\n\n    return webAuthnChallenge;\n  }\n\n  @Override\n  public WebAuthnVerificationResult verifyRegistration(\n      Tenant tenant,\n      AuthenticationTransactionIdentifier authenticationTransactionIdentifier,\n      String userId,\n      AuthenticationInteractionRequest request,\n      WebAuthnConfiguration configuration) {\n\n    // 1. \u4fdd\u5b58\u3055\u308c\u305f\u30c1\u30e3\u30ec\u30f3\u30b8\u53d6\u5f97\n    WebAuthnChallenge webAuthnChallenge =\n        transactionQueryRepository.get(\n            tenant,\n            authenticationTransactionIdentifier,\n            type().value(),\n            WebAuthnChallenge.class);\n\n    // 2. webauthn4j\u3067\u691c\u8a3c\n    WebAuthn4jRegistrationManager registrationManager =\n        new WebAuthn4jRegistrationManager(configuration);\n\n    return registrationManager.verify(userId, request, webAuthnChallenge);\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u91cd\u8981\u30dd\u30a4\u30f3\u30c8"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 \u30c1\u30e3\u30ec\u30f3\u30b8\u306f\u4e00\u6642\u4fdd\u5b58\uff08AuthenticationInteractionRepository\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Tenant\u7b2c\u4e00\u5f15\u6570\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 webauthn4j\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30e9\u30c3\u30d7"}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 \u767b\u9332\u3068\u8a8d\u8a3c\u3067\u5225\u3005\u306e\u30e1\u30bd\u30c3\u30c9\uff08",(0,r.jsx)(n.code,{children:"challengeRegistration"})," vs ",(0,r.jsx)(n.code,{children:"challengeAuthentication"}),"\uff09"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"plugin\u767b\u9332",children:"Plugin\u767b\u9332"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# META-INF/services/org.idp.server.authentication.interactors.webauthn.WebAuthnExecutorFactory\norg.idp.server.authenticators.webauthn4j.WebAuthn4jExecutorFactory\n"})}),"\n",(0,r.jsx)(n.h2,{id:"attestation-format",children:"Attestation Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"- packed     : FIDO2\u6a19\u6e96\u5f62\u5f0f\n- fido-u2f   : FIDO U2F\u4e92\u63db\n- android-key: Android KeyStore\n- android-safetynet: Android SafetyNet\n- apple      : Apple Anonymous Attestation\n- none       : Attestation\u306a\u3057\n"})}),"\n",(0,r.jsx)(n.h2,{id:"user-verification",children:"User Verification"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// User Verification Required\nUserVerificationRequirement.REQUIRED  // PIN/\u751f\u4f53\u8a8d\u8a3c\u5fc5\u9808\n\n// User Verification Preferred\nUserVerificationRequirement.PREFERRED // \u53ef\u80fd\u306a\u3089\u5b9f\u65bd\n\n// User Verification Discouraged\nUserVerificationRequirement.DISCOURAGED // \u4e0d\u8981\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/idp-server/docs/content_10_ai_developer/ai-40-authentication-federation",children:"\u8a8d\u8a3c\u30fb\u9023\u643a\u5c64\u7d71\u5408\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"})," - WebAuthn\u3092\u542b\u3080\u5168\u8a8d\u8a3c\u30e2\u30b8\u30e5\u30fc\u30eb"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./authentication-federation.md#idp-server-authentication-interactors",children:"idp-server-authentication-interactors"})," - \u8a8d\u8a3c\u30a4\u30f3\u30bf\u30e9\u30af\u30bf\u30fc"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/idp-server/docs/content_10_ai_developer/ai-11-core",children:"idp-server-core"})," - OAuth/OIDC\u30b3\u30a2\u30a8\u30f3\u30b8\u30f3"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u60c5\u5831\u6e90"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"libs/idp-server-webauthn4j-adapter/"}),"\u914d\u4e0b\u306e\u5b9f\u88c5\u30b3\u30fc\u30c9"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"libs/idp-server-authentication-interactors/src/main/java/org/idp/server/authentication/interactors/webauthn/"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.w3.org/TR/webauthn-2/",children:"Web Authentication Level 2"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6700\u7d42\u66f4\u65b0"}),": 2025-10-12"]})]})}function l(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},607:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/files/WebAuthnExecutor-053997a38e71c24bef83cbc2fca97602.java"},3295:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/files/WebAuthn4jExecutor-22c8cc4ce0be45c71d7b3e6da58167a6.java"},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var i=t(96540);const r={},a=i.createContext(r);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);