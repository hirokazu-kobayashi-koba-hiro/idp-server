"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[58726],{39213:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>x,frontMatter:()=>r,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"content_08_ops/performance/tuning-guide","title":"\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30ac\u30a4\u30c9","description":"\u672c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001idp-server \u306e\u6027\u80fd\u6700\u9069\u5316\u306e\u305f\u3081\u306e\u8a2d\u5b9a\u6307\u91dd\u3092\u63d0\u4f9b\u3059\u308b\u3002","source":"@site/docs/content_08_ops/performance/05-tuning-guide.md","sourceDirName":"content_08_ops/performance","slug":"/content_08_ops/performance/tuning-guide","permalink":"/idp-server/docs/content_08_ops/performance/tuning-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_08_ops/performance/05-tuning-guide.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"docs","previous":{"title":"\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u8a55\u4fa1","permalink":"/idp-server/docs/content_08_ops/performance/scalability-evaluation"},"next":{"title":"\u6027\u80fd\u30c6\u30b9\u30c8\u5b9f\u884c\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_08_ops/performance/test-execution-guide"}}');var d=s(74848),l=s(28453);const r={},c="\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30ac\u30a4\u30c9",t={},h=[{value:"JVM \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",id:"jvm-\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",level:2},{value:"\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba",id:"\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba",level:3},{value:"\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3",id:"\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3",level:3},{value:"G1GC\uff08\u63a8\u5968\uff09",id:"g1gc\u63a8\u5968",level:4},{value:"ZGC\uff08\u4f4e\u30ec\u30a4\u30c6\u30f3\u30b7\u91cd\u8996\uff09",id:"zgc\u4f4e\u30ec\u30a4\u30c6\u30f3\u30b7\u91cd\u8996",level:4},{value:"GC\u30ed\u30b0",id:"gc\u30ed\u30b0",level:3},{value:"Tomcat \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",id:"tomcat-\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",level:2},{value:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb",id:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb",level:3},{value:"\u8ca0\u8377\u30ec\u30d9\u30eb\u5225\u8a2d\u5b9a",id:"\u8ca0\u8377\u30ec\u30d9\u30eb\u5225\u8a2d\u5b9a",level:3},{value:"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",id:"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",level:2},{value:"PostgreSQL",id:"postgresql",level:3},{value:"\u63a5\u7d9a\u30d7\u30fc\u30eb\uff08HikariCP\uff09",id:"\u63a5\u7d9a\u30d7\u30fc\u30ebhikaricp",level:4},{value:"\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30",id:"\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30",level:4},{value:"PostgreSQL\u8a2d\u5b9a",id:"postgresql\u8a2d\u5b9a",level:4},{value:"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u6700\u9069\u5316",id:"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u6700\u9069\u5316",level:3},{value:"\u5fc5\u9808\u30a4\u30f3\u30c7\u30c3\u30af\u30b9",id:"\u5fc5\u9808\u30a4\u30f3\u30c7\u30c3\u30af\u30b9",level:4},{value:"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f7f\u7528\u72b6\u6cc1\u78ba\u8a8d",id:"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f7f\u7528\u72b6\u6cc1\u78ba\u8a8d",level:4},{value:"Redis \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",id:"redis-\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",level:2},{value:"\u57fa\u672c\u8a2d\u5b9a",id:"\u57fa\u672c\u8a2d\u5b9a",level:3},{value:"\u30ad\u30e3\u30c3\u30b7\u30e5TTL",id:"\u30ad\u30e3\u30c3\u30b7\u30e5ttl",level:3},{value:"Redis\u8a2d\u5b9a",id:"redis\u8a2d\u5b9a",level:3},{value:"\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",id:"\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",level:2},{value:"Nginx\u8a2d\u5b9a",id:"nginx\u8a2d\u5b9a",level:3},{value:"\u8ca0\u8377\u5206\u6563\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0",id:"\u8ca0\u8377\u5206\u6563\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0",level:3},{value:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a",id:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a",level:2},{value:"\u30ed\u30b0\u30ec\u30d9\u30eb",id:"\u30ed\u30b0\u30ec\u30d9\u30eb",level:3},{value:"\u975e\u540c\u671f\u51e6\u7406",id:"\u975e\u540c\u671f\u51e6\u7406",level:3},{value:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",id:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",level:2},{value:"\u30c7\u30d7\u30ed\u30a4\u524d",id:"\u30c7\u30d7\u30ed\u30a4\u524d",level:3},{value:"\u904b\u7528\u4e2d",id:"\u904b\u7528\u4e2d",level:3},{value:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",id:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",level:2},{value:"\u9ad8\u30ec\u30a4\u30c6\u30f3\u30b7",id:"\u9ad8\u30ec\u30a4\u30c6\u30f3\u30b7",level:3},{value:"\u30e1\u30e2\u30ea\u4e0d\u8db3",id:"\u30e1\u30e2\u30ea\u4e0d\u8db3",level:3},{value:"\u63a5\u7d9a\u30a8\u30e9\u30fc",id:"\u63a5\u7d9a\u30a8\u30e9\u30fc",level:3},{value:"\u63a8\u5968\u8a2d\u5b9a\u30b5\u30f3\u30d7\u30eb",id:"\u63a8\u5968\u8a2d\u5b9a\u30b5\u30f3\u30d7\u30eb",level:2},{value:"\u691c\u8a3c\u6e08\u307f\u69cb\u6210\uff082\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30012,400+ TPS\uff09",id:"\u691c\u8a3c\u6e08\u307f\u69cb\u62102\u30a4\u30f3\u30b9\u30bf\u30f3\u30b92400-tps",level:3},{value:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30ac\u30a4\u30c9",children:"\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30ac\u30a4\u30c9"})}),"\n",(0,d.jsx)(n.p,{children:"\u672c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001idp-server \u306e\u6027\u80fd\u6700\u9069\u5316\u306e\u305f\u3081\u306e\u8a2d\u5b9a\u6307\u91dd\u3092\u63d0\u4f9b\u3059\u308b\u3002"}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"jvm-\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",children:"JVM \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0"}),"\n",(0,d.jsx)(n.h3,{id:"\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba",children:"\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'JAVA_TOOL_OPTIONS="-Xms512m -Xmx2g"\n'})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u8ca0\u8377\u30ec\u30d9\u30eb"}),(0,d.jsx)(n.th,{children:"\u63a8\u5968Xms"}),(0,d.jsx)(n.th,{children:"\u63a8\u5968Xmx"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5c0f\u898f\u6a21"}),(0,d.jsx)(n.td,{children:"256m"}),(0,d.jsx)(n.td,{children:"1g"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4e2d\u898f\u6a21"}),(0,d.jsx)(n.td,{children:"512m"}),(0,d.jsx)(n.td,{children:"2g"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5927\u898f\u6a21"}),(0,d.jsx)(n.td,{children:"1g"}),(0,d.jsx)(n.td,{children:"4g"})]})]})]}),"\n",(0,d.jsx)(n.admonition,{type:"tip",children:(0,d.jsx)(n.p,{children:"Xms\u3068Xmx\u3092\u540c\u3058\u5024\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u30d2\u30fc\u30d7\u30ea\u30b5\u30a4\u30ba\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u56de\u907f\u3067\u304d\u308b\u3002"})}),"\n",(0,d.jsx)(n.h3,{id:"\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3",children:"\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3"}),"\n",(0,d.jsx)(n.h4,{id:"g1gc\u63a8\u5968",children:"G1GC\uff08\u63a8\u5968\uff09"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'JAVA_TOOL_OPTIONS="-XX:+UseG1GC -XX:MaxGCPauseMillis=100"\n'})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u30d1\u30e9\u30e1\u30fc\u30bf"}),(0,d.jsx)(n.th,{children:"\u5024"}),(0,d.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"UseG1GC"}),(0,d.jsx)(n.td,{children:"\u6709\u52b9"}),(0,d.jsx)(n.td,{children:"G1GC\u3092\u4f7f\u7528"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MaxGCPauseMillis"}),(0,d.jsx)(n.td,{children:"100"}),(0,d.jsx)(n.td,{children:"\u76ee\u6a19GC\u505c\u6b62\u6642\u9593(ms)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"G1HeapRegionSize"}),(0,d.jsx)(n.td,{children:"\u81ea\u52d5"}),(0,d.jsx)(n.td,{children:"\u30ea\u30fc\u30b8\u30e7\u30f3\u30b5\u30a4\u30ba"})]})]})]}),"\n",(0,d.jsx)(n.h4,{id:"zgc\u4f4e\u30ec\u30a4\u30c6\u30f3\u30b7\u91cd\u8996",children:"ZGC\uff08\u4f4e\u30ec\u30a4\u30c6\u30f3\u30b7\u91cd\u8996\uff09"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'JAVA_TOOL_OPTIONS="-XX:+UseZGC -XX:+ZGenerational"\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"JDK 21\u4ee5\u964d\u3067\u63a8\u5968"}),"\n",(0,d.jsx)(n.li,{children:"\u8d85\u4f4e\u30ec\u30a4\u30c6\u30f3\u30b7\u304c\u8981\u6c42\u3055\u308c\u308b\u5834\u5408\u306b\u4f7f\u7528"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"gc\u30ed\u30b0",children:"GC\u30ed\u30b0"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'JAVA_TOOL_OPTIONS="-Xlog:gc*:file=/var/log/gc.log:time,uptime:filecount=5,filesize=100m"\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"tomcat-\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",children:"Tomcat \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0"}),"\n",(0,d.jsx)(n.h3,{id:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb",children:"\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"server:\n  tomcat:\n    threads:\n      max: 300\n      min-spare: 50\n    accept-count: 100\n    connection-timeout: 20000\n"})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u30d1\u30e9\u30e1\u30fc\u30bf"}),(0,d.jsx)(n.th,{children:"\u63a8\u5968\u5024"}),(0,d.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"max"}),(0,d.jsx)(n.td,{children:"300"}),(0,d.jsx)(n.td,{children:"\u6700\u5927\u30ef\u30fc\u30ab\u30fc\u30b9\u30ec\u30c3\u30c9"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"min-spare"}),(0,d.jsx)(n.td,{children:"50"}),(0,d.jsx)(n.td,{children:"\u6700\u5c0f\u5f85\u6a5f\u30b9\u30ec\u30c3\u30c9"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"accept-count"}),(0,d.jsx)(n.td,{children:"100"}),(0,d.jsx)(n.td,{children:"\u63a5\u7d9a\u30ad\u30e5\u30fc\u30b5\u30a4\u30ba"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"connection-timeout"}),(0,d.jsx)(n.td,{children:"20000"}),(0,d.jsx)(n.td,{children:"\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8(ms)"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"\u8ca0\u8377\u30ec\u30d9\u30eb\u5225\u8a2d\u5b9a",children:"\u8ca0\u8377\u30ec\u30d9\u30eb\u5225\u8a2d\u5b9a"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u8ca0\u8377\u30ec\u30d9\u30eb"}),(0,d.jsx)(n.th,{children:"max"}),(0,d.jsx)(n.th,{children:"min-spare"}),(0,d.jsx)(n.th,{children:"accept-count"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5c0f\u898f\u6a21"}),(0,d.jsx)(n.td,{children:"100"}),(0,d.jsx)(n.td,{children:"20"}),(0,d.jsx)(n.td,{children:"50"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4e2d\u898f\u6a21"}),(0,d.jsx)(n.td,{children:"300"}),(0,d.jsx)(n.td,{children:"50"}),(0,d.jsx)(n.td,{children:"100"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5927\u898f\u6a21"}),(0,d.jsx)(n.td,{children:"500"}),(0,d.jsx)(n.td,{children:"100"}),(0,d.jsx)(n.td,{children:"200"})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",children:"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0"}),"\n",(0,d.jsx)(n.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,d.jsx)(n.h4,{id:"\u63a5\u7d9a\u30d7\u30fc\u30ebhikaricp",children:"\u63a5\u7d9a\u30d7\u30fc\u30eb\uff08HikariCP\uff09"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"spring:\n  datasource:\n    hikari:\n      connection-timeout: 30000      # \u63a5\u7d9a\u53d6\u5f97\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff08ms\uff09\n      maximum-pool-size: 30          # \u6700\u5927\u30d7\u30fc\u30eb\u6570\n      minimum-idle: 10               # \u6700\u5c0f\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570\n      idle-timeout: 600000           # \u30a2\u30a4\u30c9\u30eb\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff08ms\uff09\n      max-lifetime: 1800000          # \u63a5\u7d9a\u6700\u5927\u751f\u5b58\u6642\u9593\uff08ms\uff09\n      keepalive-time: 180000         # \u30ad\u30fc\u30d7\u30a2\u30e9\u30a4\u30d6\u9593\u9694\uff08ms\uff09\n      validation-timeout: 5000       # \u691c\u8a3c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\uff08ms\uff09\n"})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u30d1\u30e9\u30e1\u30fc\u30bf"}),(0,d.jsx)(n.th,{children:"\u30c7\u30d5\u30a9\u30eb\u30c8"}),(0,d.jsx)(n.th,{children:"\u63a8\u5968\u5024"}),(0,d.jsx)(n.th,{children:"\u8aac\u660e"}),(0,d.jsx)(n.th,{children:"\u5909\u66f4\u3092\u691c\u8a0e\u3059\u308b\u30b1\u30fc\u30b9"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"connection-timeout"}),(0,d.jsx)(n.td,{children:"30000"}),(0,d.jsx)(n.td,{children:"30000"}),(0,d.jsx)(n.td,{children:"\u30d7\u30fc\u30eb\u304b\u3089\u63a5\u7d9a\u3092\u53d6\u5f97\u3059\u308b\u969b\u306e\u6700\u5927\u5f85\u6a5f\u6642\u9593"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"SQLTransientConnectionException"})," \u304c\u983b\u767a\u3059\u308b\u5834\u5408\u306f\u5ef6\u9577\u3092\u691c\u8a0e"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"maximum-pool-size"}),(0,d.jsx)(n.td,{children:"10"}),(0,d.jsx)(n.td,{children:"30"}),(0,d.jsx)(n.td,{children:"\u6700\u5927\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u6570"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"hikaricp.connections.pending"})," \u304c\u5897\u52a0\u3059\u308b\u5834\u5408\u306f\u5897\u52a0\u3001DB CPU\u9ad8\u9a30\u6642\u306f\u524a\u6e1b"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"minimum-idle"}),(0,d.jsx)(n.td,{children:"10"}),(0,d.jsx)(n.td,{children:"10"}),(0,d.jsx)(n.td,{children:"\u6700\u5c0f\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u6570"}),(0,d.jsx)(n.td,{children:"\u8ca0\u8377\u5909\u52d5\u304c\u5927\u304d\u3044\u5834\u5408\u306f\u5897\u52a0\u3001\u30ea\u30bd\u30fc\u30b9\u7bc0\u7d04\u3057\u305f\u3044\u5834\u5408\u306f\u524a\u6e1b"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"idle-timeout"}),(0,d.jsx)(n.td,{children:"600000"}),(0,d.jsx)(n.td,{children:"600000"}),(0,d.jsx)(n.td,{children:"\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u304c\u9589\u3058\u3089\u308c\u308b\u307e\u3067\u306e\u6642\u9593\uff0810\u5206\uff09"}),(0,d.jsx)(n.td,{children:"DB\u63a5\u7d9a\u6570\u3092\u6291\u3048\u305f\u3044\u5834\u5408\u306f\u77ed\u7e2e"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"max-lifetime"}),(0,d.jsx)(n.td,{children:"1800000"}),(0,d.jsx)(n.td,{children:"1800000"}),(0,d.jsx)(n.td,{children:"\u63a5\u7d9a\u306e\u6700\u5927\u751f\u5b58\u6642\u9593\uff0830\u5206\uff09"}),(0,d.jsxs)(n.td,{children:["DB\u5074 ",(0,d.jsx)(n.code,{children:"wait_timeout"})," \u3088\u308a\u77ed\u304f\u8a2d\u5b9a\u3002\u63a5\u7d9a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u5834\u5408\u306f\u77ed\u7e2e"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"keepalive-time"}),(0,d.jsx)(n.td,{children:"0\uff08\u7121\u52b9\uff09"}),(0,d.jsx)(n.td,{children:"180000"}),(0,d.jsx)(n.td,{children:"\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u306e\u751f\u5b58\u78ba\u8a8d\u9593\u9694\uff083\u5206\uff09"}),(0,d.jsx)(n.td,{children:"LB/FW\u7d4c\u7531\u3067\u63a5\u7d9a\u5207\u65ad\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u5834\u5408\u306f\u6709\u52b9\u5316\u30fb\u77ed\u7e2e"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"validation-timeout"}),(0,d.jsx)(n.td,{children:"5000"}),(0,d.jsx)(n.td,{children:"5000"}),(0,d.jsx)(n.td,{children:"\u63a5\u7d9a\u306e\u6709\u52b9\u6027\u691c\u8a3c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8"}),(0,d.jsx)(n.td,{children:"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u9045\u5ef6\u304c\u5927\u304d\u3044\u74b0\u5883\u3067\u306f\u5ef6\u9577"})]})]})]}),"\n",(0,d.jsx)(n.h4,{id:"\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30",children:"\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"maximum-pool-size\uff08\u6700\u5927\u30d7\u30fc\u30eb\u6570\uff09"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u904e\u5270\u306a\u63a5\u7d9a\u30d7\u30fc\u30eb\u306f\u9006\u52b9\u679c                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  \u591a\u3059\u304e\u308b\u3068:                                                \u2502\n\u2502  \u30fbDB\u5074\u3067\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30b9\u30a4\u30c3\u30c1\u304c\u5897\u52a0                         \u2502\n\u2502  \u30fb\u30ed\u30c3\u30af\u7af6\u5408\u304c\u767a\u751f\u3057\u3084\u3059\u304f\u306a\u308b                             \u2502\n\u2502  \u30fb\u30e1\u30e2\u30ea\u6d88\u8cbb\u304c\u5897\u52a0                                         \u2502\n\u2502                                                             \u2502\n\u2502  \u76ee\u5b89:                                                      \u2502\n\u2502  \u30fbCPU\u30b3\u30a2\u6570 \xd7 2\u301c4                                         \u2502\n\u2502  \u30fb4\u30b3\u30a2\u306a\u3089 8\u301c16 \u7a0b\u5ea6\u304b\u3089\u59cb\u3081\u308b                           \u2502\n\u2502  \u30fb\u5b9f\u6e2c\u3067\u8abf\u6574\uff08\u30d7\u30fc\u30eb\u67af\u6e07 vs DB\u7af6\u5408\u306e\u30d0\u30e9\u30f3\u30b9\uff09             \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"keepalive-time\uff08\u30ad\u30fc\u30d7\u30a2\u30e9\u30a4\u30d6\uff09"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u306a\u305c\u5fc5\u8981\u304b                                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  \u30af\u30e9\u30a6\u30c9\u74b0\u5883\u3067\u306f:                                          \u2502\n\u2502  \u30fb\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc\u304c\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u3092\u5207\u65ad\u3059\u308b                 \u2502\n\u2502  \u30fbAWS ALB: 350\u79d2\u3001Azure: 240\u79d2 \u306a\u3069                        \u2502\n\u2502  \u30fb\u5207\u65ad\u3055\u308c\u305f\u63a5\u7d9a\u3092\u4f7f\u3046\u3068\u30a8\u30e9\u30fc\u767a\u751f                         \u2502\n\u2502                                                             \u2502\n\u2502  keepalive-time \u3092\u8a2d\u5b9a\u3059\u308b\u3068:                               \u2502\n\u2502  \u30fb\u30a2\u30a4\u30c9\u30eb\u63a5\u7d9a\u306b\u5bfe\u3057\u3066\u5b9a\u671f\u7684\u306b\u691c\u8a3c\u30af\u30a8\u30ea\u3092\u5b9f\u884c             \u2502\n\u2502  \u30fb\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb/LB\u306b\u3088\u308b\u5207\u65ad\u3092\u9632\u6b62                      \u2502\n\u2502  \u30fb\u63a8\u5968: 180000\uff083\u5206\uff09= LB\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3088\u308a\u77ed\u304f            \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"max-lifetime\uff08\u6700\u5927\u751f\u5b58\u6642\u9593\uff09"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  DB\u5074\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3088\u308a\u77ed\u304f\u8a2d\u5b9a                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  PostgreSQL wait_timeout \u306e\u30c7\u30d5\u30a9\u30eb\u30c8: \u306a\u3057\uff08\u7121\u5236\u9650\uff09       \u2502\n\u2502  MySQL wait_timeout \u306e\u30c7\u30d5\u30a9\u30eb\u30c8: 28800\u79d2\uff088\u6642\u9593\uff09          \u2502\n\u2502                                                             \u2502\n\u2502  \u63a8\u5968:                                                      \u2502\n\u2502  \u30fb1800000\uff0830\u5206\uff09\u7a0b\u5ea6                                      \u2502\n\u2502  \u30fbDB\u5074\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306e 80% \u4ee5\u4e0b\u306b\u8a2d\u5b9a                        \u2502\n\u2502  \u30fb\u53e4\u3044\u63a5\u7d9a\u3092\u5b9a\u671f\u7684\u306b\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5                           \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,d.jsx)(n.admonition,{title:"\u63a5\u7d9a\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u306e\u6307\u91dd",type:"tip",children:(0,d.jsxs)(n.p,{children:["\u904e\u5270\u306a\u63a5\u7d9a\u30d7\u30fc\u30eb\u306fDB\u5074\u306e\u7af6\u5408\u3092\u5f15\u304d\u8d77\u3053\u3059\u3002\u5b9f\u6e2c\u3067\u306f30\u219210\u306b\u524a\u6e1b\u3059\u308b\u3053\u3068\u3067p95\u304c20%\u6539\u5584\u3057\u305f\u30b1\u30fc\u30b9\u3082\u3042\u308b\u3002\n\u8ca0\u8377\u30c6\u30b9\u30c8\u3067 ",(0,d.jsx)(n.code,{children:"hikaricp.connections.pending"})," \u304c\u5897\u52a0\u3057\u306a\u3044\u30b5\u30a4\u30ba\u3092\u898b\u3064\u3051\u308b\u3053\u3068\u304c\u91cd\u8981\u3002"]})}),"\n",(0,d.jsx)(n.h4,{id:"postgresql\u8a2d\u5b9a",children:"PostgreSQL\u8a2d\u5b9a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-conf",children:"# postgresql.conf\n\n# \u63a5\u7d9a\nmax_connections = 200\n\n# \u30e1\u30e2\u30ea\nshared_buffers = 256MB\neffective_cache_size = 768MB\nwork_mem = 4MB\nmaintenance_work_mem = 64MB\n\n# WAL\nwal_buffers = 16MB\ncheckpoint_completion_target = 0.9\n\n# \u30af\u30a8\u30ea\u6700\u9069\u5316\nrandom_page_cost = 1.1\neffective_io_concurrency = 200\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u6700\u9069\u5316",children:"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u6700\u9069\u5316"}),"\n",(0,d.jsx)(n.h4,{id:"\u5fc5\u9808\u30a4\u30f3\u30c7\u30c3\u30af\u30b9",children:"\u5fc5\u9808\u30a4\u30f3\u30c7\u30c3\u30af\u30b9"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"-- \u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u30c7\u30d0\u30a4\u30b9\u691c\u7d22\nCREATE INDEX idx_user_auth_device_tenant_user\nON idp_user_authentication_devices (tenant_id, user_id);\n\nCREATE INDEX idx_user_auth_device_user_id\nON idp_user_authentication_devices (user_id);\n\n-- \u30c6\u30ca\u30f3\u30c8\u5225\u691c\u7d22\nCREATE INDEX idx_idp_user_tenant_id\nON idp_user (tenant_id);\n\n-- \u30e1\u30fc\u30eb\u691c\u7d22\nCREATE INDEX idx_idp_user_email\nON idp_user (tenant_id, email);\n"})}),"\n",(0,d.jsx)(n.h4,{id:"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f7f\u7528\u72b6\u6cc1\u78ba\u8a8d",children:"\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f7f\u7528\u72b6\u6cc1\u78ba\u8a8d"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"SELECT\n    schemaname,\n    tablename,\n    indexname,\n    idx_scan,\n    idx_tup_read,\n    idx_tup_fetch\nFROM pg_stat_user_indexes\nWHERE schemaname = 'public'\nORDER BY idx_scan DESC;\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"redis-\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",children:"Redis \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0"}),"\n",(0,d.jsx)(n.h3,{id:"\u57fa\u672c\u8a2d\u5b9a",children:"\u57fa\u672c\u8a2d\u5b9a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"spring:\n  redis:\n    host: redis\n    port: 6379\n    timeout: 2000\n    lettuce:\n      pool:\n        max-active: 50\n        max-idle: 20\n        min-idle: 5\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u30ad\u30e3\u30c3\u30b7\u30e5ttl",children:"\u30ad\u30e3\u30c3\u30b7\u30e5TTL"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"cache:\n  enable: true\n  ttl: 300  # \u79d2\n"})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u30c7\u30fc\u30bf\u7a2e\u5225"}),(0,d.jsx)(n.th,{children:"\u63a8\u5968TTL"}),(0,d.jsx)(n.th,{children:"\u7406\u7531"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"JWKS"}),(0,d.jsx)(n.td,{children:"3600"}),(0,d.jsx)(n.td,{children:"\u5909\u66f4\u983b\u5ea6\u4f4e"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a2d\u5b9a"}),(0,d.jsx)(n.td,{children:"300"}),(0,d.jsx)(n.td,{children:"\u4e2d\u7a0b\u5ea6\u306e\u5909\u66f4\u983b\u5ea6"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u30e6\u30fc\u30b6\u30fc\u30bb\u30c3\u30b7\u30e7\u30f3"}),(0,d.jsx)(n.td,{children:"1800"}),(0,d.jsx)(n.td,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8003\u616e"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"redis\u8a2d\u5b9a",children:"Redis\u8a2d\u5b9a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-conf",children:'# redis.conf\n\n# \u30e1\u30e2\u30ea\nmaxmemory 1gb\nmaxmemory-policy allkeys-lru\n\n# \u6c38\u7d9a\u5316\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09\nappendonly no\nsave ""\n\n# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\ntcp-keepalive 300\ntimeout 0\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0",children:"\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0"}),"\n",(0,d.jsx)(n.h3,{id:"nginx\u8a2d\u5b9a",children:"Nginx\u8a2d\u5b9a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-nginx",children:'upstream idp_backend {\n    server idp-server-1:8080;\n    server idp-server-2:8080;\n    keepalive 32;\n}\n\nserver {\n    listen 80;\n\n    location / {\n        proxy_pass http://idp_backend;\n        proxy_http_version 1.1;\n        proxy_set_header Connection "";\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        proxy_connect_timeout 30s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n}\n'})}),"\n",(0,d.jsx)(n.admonition,{title:"keepalive\u8a2d\u5b9a\u306e\u52b9\u679c",type:"tip",children:(0,d.jsxs)(n.p,{children:["\u5b9f\u6e2c\u3067\u306fkeepalive\u8ffd\u52a0\u306b\u3088\u308aTPS +12%\u3001p95 -20%\u306e\u6539\u5584\u3092\u78ba\u8a8d\u3002\n",(0,d.jsx)(n.code,{children:"proxy_http_version 1.1"})," \u3068 ",(0,d.jsx)(n.code,{children:'proxy_set_header Connection ""'})," \u304c\u5fc5\u9808\u3002"]})}),"\n",(0,d.jsx)(n.h3,{id:"\u8ca0\u8377\u5206\u6563\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0",children:"\u8ca0\u8377\u5206\u6563\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0"}),(0,d.jsx)(n.th,{children:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"round_robin"}),(0,d.jsx)(n.td,{children:"\u30c7\u30d5\u30a9\u30eb\u30c8\u3001\u5747\u7b49\u5206\u6563\uff08\u5b9f\u6e2c\u6e08\u307f\uff09"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"least_conn"}),(0,d.jsx)(n.td,{children:"\u63a5\u7d9a\u6570\u30d9\u30fc\u30b9"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ip_hash"}),(0,d.jsx)(n.td,{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u56fa\u5b9a\u304c\u5fc5\u8981\u306a\u5834\u5408"})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a",children:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a"}),"\n",(0,d.jsx)(n.h3,{id:"\u30ed\u30b0\u30ec\u30d9\u30eb",children:"\u30ed\u30b0\u30ec\u30d9\u30eb"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"logging:\n  level:\n    root: warn\n    org.idp.server: info\n    org.springframework.web: warn\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"warning",children:(0,d.jsx)(n.p,{children:"\u672c\u756a\u74b0\u5883\u3067\u306fDEBUG\u30ed\u30b0\u3092\u7121\u52b9\u5316\u3059\u308b\u3053\u3068\u3002I/O\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u5927\u304d\u3044\u3002"})}),"\n",(0,d.jsx)(n.h3,{id:"\u975e\u540c\u671f\u51e6\u7406",children:"\u975e\u540c\u671f\u51e6\u7406"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"spring:\n  task:\n    execution:\n      pool:\n        core-size: 8\n        max-size: 32\n        queue-capacity: 100\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",children:"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8"}),"\n",(0,d.jsx)(n.h3,{id:"\u30c7\u30d7\u30ed\u30a4\u524d",children:"\u30c7\u30d7\u30ed\u30a4\u524d"}),"\n",(0,d.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","JVM\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u8a2d\u5b9a\u78ba\u8a8d"]}),"\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","GC\u8a2d\u5b9a\u78ba\u8a8d"]}),"\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","DB\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u30b5\u30a4\u30ba\u78ba\u8a8d"]}),"\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Redis\u30ad\u30e3\u30c3\u30b7\u30e5\u6709\u52b9\u5316\u78ba\u8a8d"]}),"\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5fc5\u9808\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u78ba\u8a8d"]}),"\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u30ed\u30b0\u30ec\u30d9\u30eb\u304cINFO\u4ee5\u4e0a\u3067\u3042\u308b\u3053\u3068"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u904b\u7528\u4e2d",children:"\u904b\u7528\u4e2d"}),"\n",(0,d.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","GC\u30ed\u30b0\u306e\u5b9a\u671f\u78ba\u8a8d"]}),"\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","DB\u30af\u30a8\u30ea\u7d71\u8a08\u306e\u78ba\u8a8d"]}),"\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Redis\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u78ba\u8a8d"]}),"\n",(0,d.jsxs)(n.li,{className:"task-list-item",children:[(0,d.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d2\u30fc\u30d7\u4f7f\u7528\u91cf\u78ba\u8a8d"]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0",children:"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"}),"\n",(0,d.jsx)(n.h3,{id:"\u9ad8\u30ec\u30a4\u30c6\u30f3\u30b7",children:"\u9ad8\u30ec\u30a4\u30c6\u30f3\u30b7"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"GC\u30dd\u30fc\u30ba\u78ba\u8a8d"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'grep "pause" /var/log/gc.log\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"DB\u30af\u30a8\u30ea\u78ba\u8a8d"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"SELECT query, mean_exec_time\nFROM pg_stat_statements\nORDER BY mean_exec_time DESC\nLIMIT 10;\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"\u30b9\u30ec\u30c3\u30c9\u72b6\u614b\u78ba\u8a8d"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'jstack <pid> | grep -A 2 "java.lang.Thread.State"\n'})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u30e1\u30e2\u30ea\u4e0d\u8db3",children:"\u30e1\u30e2\u30ea\u4e0d\u8db3"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u53d6\u5f97"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"jmap -dump:format=b,file=heap.hprof <pid>\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"\u30d2\u30fc\u30d7\u4f7f\u7528\u91cf\u78ba\u8a8d"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"jstat -gc <pid> 1000\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u63a5\u7d9a\u30a8\u30e9\u30fc",children:"\u63a5\u7d9a\u30a8\u30e9\u30fc"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"DB\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u78ba\u8a8d"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"SELECT count(*) FROM pg_stat_activity;\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Redis\u63a5\u7d9a\u78ba\u8a8d"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"redis-cli ping\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u63a8\u5968\u8a2d\u5b9a\u30b5\u30f3\u30d7\u30eb",children:"\u63a8\u5968\u8a2d\u5b9a\u30b5\u30f3\u30d7\u30eb"}),"\n",(0,d.jsx)(n.h3,{id:"\u691c\u8a3c\u6e08\u307f\u69cb\u62102\u30a4\u30f3\u30b9\u30bf\u30f3\u30b92400-tps",children:"\u691c\u8a3c\u6e08\u307f\u69cb\u6210\uff082\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30012,400+ TPS\uff09"}),"\n",(0,d.jsx)(n.p,{children:"\u4ee5\u4e0b\u306f\u5b9f\u6e2c\u30672,400+ TPS\u3001p95 < 150ms\u3092\u9054\u6210\u3057\u305f\u69cb\u6210\u3002"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"# application.yaml\nserver:\n  tomcat:\n    threads:\n      max: 300\n      min-spare: 50\n    accept-count: 100\n\nspring:\n  datasource:\n    hikari:\n      maximum-pool-size: 10  # CPU\u30b3\u30a2 \xd7 2\n      minimum-idle: 5\n\n  redis:\n    lettuce:\n      pool:\n        max-active: 50\n\ncache:\n  enable: true\n  ttl: 300\n\nlogging:\n  level:\n    root: warn\n    org.idp.server: info\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'# JVM\u8a2d\u5b9a\nJAVA_TOOL_OPTIONS="-Xms512m -Xmx2g -XX:MaxGCPauseMillis=100"\n'})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-nginx",children:"# nginx\u8a2d\u5b9a\uff08keepalive\u5fc5\u9808\uff09\nupstream idp_backend {\n    server idp-server-1:8080;\n    server idp-server-2:8080;\n    keepalive 32;\n}\n"})}),"\n",(0,d.jsx)(n.admonition,{title:"\u5b9f\u6e2c\u7d50\u679c",type:"note",children:(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u69cb\u6210: 2,464 TPS\u3001p95: 145ms\uff08Authorization\uff09"}),"\n",(0,d.jsx)(n.li,{children:"190\u4e07\u30e6\u30fc\u30b6\u30fc\u74b0\u5883\u3067\u691c\u8a3c\u6e08\u307f"}),"\n"]})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"/idp-server/docs/content_08_ops/performance/test-environment",children:"\u30c6\u30b9\u30c8\u74b0\u5883"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"/idp-server/docs/content_08_ops/performance/stress-test-results",children:"\u30b9\u30c8\u30ec\u30b9\u30c6\u30b9\u30c8\u7d50\u679c"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"/idp-server/docs/content_08_ops/performance/scalability-evaluation",children:"\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u8a55\u4fa1"})}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var i=s(96540);const d={},l=i.createContext(d);function r(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);