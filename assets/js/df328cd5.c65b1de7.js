"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[34460],{67005:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>t,default:()=>E,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"content_11_learning/postgresql/dba-04-security","title":"PostgreSQL \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ac\u30a4\u30c9","description":"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001PostgreSQL\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3068\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002","source":"@site/docs/content_11_learning/11-postgresql/dba-04-security.md","sourceDirName":"content_11_learning/11-postgresql","slug":"/content_11_learning/postgresql/dba-04-security","permalink":"/idp-server/docs/content_11_learning/postgresql/dba-04-security","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_11_learning/11-postgresql/dba-04-security.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"PostgreSQL \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068HA\u69cb\u6210\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_11_learning/postgresql/dba-03-replication-ha"},"next":{"title":"PostgreSQL \u76e3\u8996\u30ac\u30a4\u30c9","permalink":"/idp-server/docs/content_11_learning/postgresql/dba-05-monitoring"}}');var l=s(74848),a=s(28453);const i={},t="PostgreSQL \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ac\u30a4\u30c9",d={},c=[{value:"\u76ee\u6b21",id:"\u76ee\u6b21",level:2},{value:"1. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u5168\u4f53\u50cf",id:"1-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u5168\u4f53\u50cf",level:2},{value:"1.1 \u591a\u5c64\u9632\u5fa1",id:"11-\u591a\u5c64\u9632\u5fa1",level:3},{value:"1.2 \u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247",id:"12-\u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247",level:3},{value:"2. \u8a8d\u8a3c (Authentication)",id:"2-\u8a8d\u8a3c-authentication",level:2},{value:"2.1 pg_hba.conf \u306e\u69cb\u9020",id:"21-pg_hbaconf-\u306e\u69cb\u9020",level:3},{value:"2.2 \u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03",id:"22-\u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03",level:3},{value:"2.3 \u672c\u756a\u74b0\u5883\u5411\u3051 pg_hba.conf \u4f8b",id:"23-\u672c\u756a\u74b0\u5883\u5411\u3051-pg_hbaconf-\u4f8b",level:3},{value:"2.4 \u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406",id:"24-\u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406",level:3},{value:"2.5 LDAP\u8a8d\u8a3c\u306e\u8a2d\u5b9a",id:"25-ldap\u8a8d\u8a3c\u306e\u8a2d\u5b9a",level:3},{value:"3. \u30ed\u30fc\u30eb\u3068\u6a29\u9650",id:"3-\u30ed\u30fc\u30eb\u3068\u6a29\u9650",level:2},{value:"3.1 \u30ed\u30fc\u30eb\u306e\u57fa\u672c",id:"31-\u30ed\u30fc\u30eb\u306e\u57fa\u672c",level:3},{value:"3.2 \u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3068\u7ba1\u7406",id:"32-\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3068\u7ba1\u7406",level:3},{value:"3.3 \u6a29\u9650\u306e\u7a2e\u985e",id:"33-\u6a29\u9650\u306e\u7a2e\u985e",level:3},{value:"3.4 \u6a29\u9650\u306e\u4ed8\u4e0e\u3068\u53d6\u308a\u6d88\u3057",id:"34-\u6a29\u9650\u306e\u4ed8\u4e0e\u3068\u53d6\u308a\u6d88\u3057",level:3},{value:"3.5 public \u30b9\u30ad\u30fc\u30de\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",id:"35-public-\u30b9\u30ad\u30fc\u30de\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",level:3},{value:"3.6 \u63a8\u5968\u3055\u308c\u308b\u30ed\u30fc\u30eb\u8a2d\u8a08",id:"36-\u63a8\u5968\u3055\u308c\u308b\u30ed\u30fc\u30eb\u8a2d\u8a08",level:3},{value:"4. Row Level Security (RLS)",id:"4-row-level-security-rls",level:2},{value:"4.1 RLS\u306e\u6982\u5ff5",id:"41-rls\u306e\u6982\u5ff5",level:3},{value:"4.2 RLS\u306e\u57fa\u672c\u8a2d\u5b9a",id:"42-rls\u306e\u57fa\u672c\u8a2d\u5b9a",level:3},{value:"4.3 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u306e\u4f7f\u7528",id:"43-\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u306e\u4f7f\u7528",level:3},{value:"4.4 \u30e6\u30fc\u30b6\u30fc\u30d9\u30fc\u30b9\u306eRLS",id:"44-\u30e6\u30fc\u30b6\u30fc\u30d9\u30fc\u30b9\u306erls",level:3},{value:"4.5 \u8907\u5408\u30dd\u30ea\u30b7\u30fc",id:"45-\u8907\u5408\u30dd\u30ea\u30b7\u30fc",level:3},{value:"4.6 RLS\u306e\u30d0\u30a4\u30d1\u30b9",id:"46-rls\u306e\u30d0\u30a4\u30d1\u30b9",level:3},{value:"4.7 RLS\u306e\u30c7\u30d0\u30c3\u30b0",id:"47-rls\u306e\u30c7\u30d0\u30c3\u30b0",level:3},{value:"5. SSL/TLS\u6697\u53f7\u5316",id:"5-ssltls\u6697\u53f7\u5316",level:2},{value:"5.1 SSL\u8a2d\u5b9a\u306e\u6982\u8981",id:"51-ssl\u8a2d\u5b9a\u306e\u6982\u8981",level:3},{value:"5.2 \u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u4f5c\u6210",id:"52-\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u4f5c\u6210",level:3},{value:"5.3 \u30b5\u30fc\u30d0\u30fc\u306eSSL\u8a2d\u5b9a",id:"53-\u30b5\u30fc\u30d0\u30fc\u306essl\u8a2d\u5b9a",level:3},{value:"5.4 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306eSSL\u8a2d\u5b9a",id:"54-\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306essl\u8a2d\u5b9a",level:3},{value:"5.5 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u8a8d\u8a3c",id:"55-\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u8a8d\u8a3c",level:3},{value:"6. \u76e3\u67fb\u30ed\u30b0",id:"6-\u76e3\u67fb\u30ed\u30b0",level:2},{value:"6.1 \u6a19\u6e96\u30ed\u30b0\u8a2d\u5b9a",id:"61-\u6a19\u6e96\u30ed\u30b0\u8a2d\u5b9a",level:3},{value:"6.2 pgAudit\u306b\u3088\u308b\u8a73\u7d30\u76e3\u67fb",id:"62-pgaudit\u306b\u3088\u308b\u8a73\u7d30\u76e3\u67fb",level:3},{value:"6.3 \u76e3\u67fb\u30ed\u30b0\u306e\u4f8b",id:"63-\u76e3\u67fb\u30ed\u30b0\u306e\u4f8b",level:3},{value:"7. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"7-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:2},{value:"7.1 \u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",id:"71-\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",level:3},{value:"7.2 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u306e\u78ba\u8a8d\u30af\u30a8\u30ea",id:"72-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u306e\u78ba\u8a8d\u30af\u30a8\u30ea",level:3},{value:"7.3 \u5b9a\u671f\u7684\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30bf\u30b9\u30af",id:"73-\u5b9a\u671f\u7684\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30bf\u30b9\u30af",level:3},{value:"\u53c2\u8003\u30ea\u30f3\u30af",id:"\u53c2\u8003\u30ea\u30f3\u30af",level:2}];function p(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"postgresql-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ac\u30a4\u30c9",children:"PostgreSQL \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ac\u30a4\u30c9"})}),"\n",(0,l.jsx)(e.p,{children:"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001PostgreSQL\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3068\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002"}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"\u76ee\u6b21",children:"\u76ee\u6b21"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#1-%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E5%85%A8%E4%BD%93%E5%83%8F",children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u5168\u4f53\u50cf"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#2-%E8%AA%8D%E8%A8%BC-authentication",children:"\u8a8d\u8a3c (Authentication)"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#3-%E3%83%AD%E3%83%BC%E3%83%AB%E3%81%A8%E6%A8%A9%E9%99%90",children:"\u30ed\u30fc\u30eb\u3068\u6a29\u9650"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#4-row-level-security-rls",children:"Row Level Security (RLS)"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#5-ssltls%E6%9A%97%E5%8F%B7%E5%8C%96",children:"SSL/TLS\u6697\u53f7\u5316"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#6-%E7%9B%A3%E6%9F%BB%E3%83%AD%E3%82%B0",children:"\u76e3\u67fb\u30ed\u30b0"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#7-%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9",children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"})}),"\n"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"1-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u5168\u4f53\u50cf",children:"1. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u5168\u4f53\u50cf"}),"\n",(0,l.jsx)(e.h3,{id:"11-\u591a\u5c64\u9632\u5fa1",children:"1.1 \u591a\u5c64\u9632\u5fa1"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    PostgreSQL \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5c64                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Layer 1: \u30cd\u30c3\u30c8\u30ef\u30fc\u30af                                  \u2502 \u2502\n\u2502  \u2502  - \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb                                     \u2502 \u2502\n\u2502  \u2502  - listen_addresses                                    \u2502 \u2502\n\u2502  \u2502  - SSL/TLS\u6697\u53f7\u5316                                       \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                          \u2193                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Layer 2: \u8a8d\u8a3c (Authentication)                        \u2502 \u2502\n\u2502  \u2502  - pg_hba.conf                                         \u2502 \u2502\n\u2502  \u2502  - \u30d1\u30b9\u30ef\u30fc\u30c9 (scram-sha-256)                          \u2502 \u2502\n\u2502  \u2502  - \u8a3c\u660e\u66f8\u3001LDAP\u3001GSSAPI\u7b49                              \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                          \u2193                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Layer 3: \u8a8d\u53ef (Authorization)                         \u2502 \u2502\n\u2502  \u2502  - \u30ed\u30fc\u30eb\u3068\u6a29\u9650 (GRANT/REVOKE)                         \u2502 \u2502\n\u2502  \u2502  - \u30b9\u30ad\u30fc\u30de\u5206\u96e2                                        \u2502 \u2502\n\u2502  \u2502  - Row Level Security (RLS)                            \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                          \u2193                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Layer 4: \u76e3\u67fb\u3068\u76e3\u8996                                    \u2502 \u2502\n\u2502  \u2502  - \u30ed\u30b0\u8a2d\u5b9a                                            \u2502 \u2502\n\u2502  \u2502  - \u76e3\u67fb\u62e1\u5f35 (pgAudit)                                  \u2502 \u2502\n\u2502  \u2502  - \u7570\u5e38\u691c\u77e5                                            \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h3,{id:"12-\u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247",children:"1.2 \u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    \u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010\u539f\u5247\u3011                                                    \u2502\n\u2502  \u5404\u30e6\u30fc\u30b6\u30fc/\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u306f\u3001                           \u2502\n\u2502  \u5fc5\u8981\u6700\u5c0f\u9650\u306e\u6a29\u9650\u306e\u307f\u3092\u4ed8\u4e0e\u3059\u308b                              \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u60aa\u3044\u4f8b\u3011                                                  \u2502\n\u2502  - \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc\u3067\u63a5\u7d9a                  \u2502\n\u2502  - \u5168\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u30d5\u30eb\u30a2\u30af\u30bb\u30b9\u6a29\u9650                            \u2502\n\u2502  - public\u30b9\u30ad\u30fc\u30de\u306b\u5168\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u914d\u7f6e                      \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u826f\u3044\u4f8b\u3011                                                  \u2502\n\u2502  - \u7528\u9014\u5225\u306b\u30ed\u30fc\u30eb\u3092\u5206\u96e2                                      \u2502\n\u2502    - app_read: SELECT \u306e\u307f                                  \u2502\n\u2502    - app_write: SELECT, INSERT, UPDATE, DELETE              \u2502\n\u2502    - app_admin: \u4e0a\u8a18 + DDL                                  \u2502\n\u2502  - \u30b9\u30ad\u30fc\u30de\u3067\u8ad6\u7406\u7684\u306b\u5206\u96e2                                    \u2502\n\u2502  - Row Level Security \u3067\u884c\u5358\u4f4d\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1                 \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"2-\u8a8d\u8a3c-authentication",children:"2. \u8a8d\u8a3c (Authentication)"}),"\n",(0,l.jsx)(e.h3,{id:"21-pg_hbaconf-\u306e\u69cb\u9020",children:"2.1 pg_hba.conf \u306e\u69cb\u9020"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    pg_hba.conf \u306e\u5f62\u5f0f                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  TYPE   DATABASE   USER   ADDRESS        METHOD   [OPTIONS]  \u2502\n\u2502  \u2500\u2500\u2500\u2500   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2500\u2500\u2500\u2500   \u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2500\u2500\u2500\u2500\u2500\u2500   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                              \u2502\n\u2502  TYPE:                                                       \u2502\n\u2502  - local    : Unix \u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8                          \u2502\n\u2502  - host     : TCP/IP (SSL/\u975eSSL \u4e21\u65b9)                        \u2502\n\u2502  - hostssl  : SSL \u63a5\u7d9a\u306e\u307f                                   \u2502\n\u2502  - hostnossl: \u975eSSL \u63a5\u7d9a\u306e\u307f                                 \u2502\n\u2502  - hostgssenc: GSSAPI \u6697\u53f7\u5316\u63a5\u7d9a\u306e\u307f                         \u2502\n\u2502                                                              \u2502\n\u2502  DATABASE:                                                   \u2502\n\u2502  - all         : \u5168\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9                              \u2502\n\u2502  - sameuser    : \u30e6\u30fc\u30b6\u30fc\u540d\u3068\u540c\u3058\u540d\u524d\u306eDB                    \u2502\n\u2502  - samerole    : \u30e6\u30fc\u30b6\u30fc\u304c\u5c5e\u3059\u308b\u30ed\u30fc\u30eb\u540d\u3068\u540c\u3058DB            \u2502\n\u2502  - replication : \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u63a5\u7d9a                        \u2502\n\u2502  - dbname      : \u7279\u5b9a\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d                        \u2502\n\u2502                                                              \u2502\n\u2502  USER:                                                       \u2502\n\u2502  - all       : \u5168\u30e6\u30fc\u30b6\u30fc                                    \u2502\n\u2502  - +rolename : \u30ed\u30fc\u30eb\u306e\u30e1\u30f3\u30d0\u30fc                              \u2502\n\u2502  - username  : \u7279\u5b9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d                              \u2502\n\u2502                                                              \u2502\n\u2502  ADDRESS:                                                    \u2502\n\u2502  - CIDR\u8868\u8a18  : 192.168.1.0/24                                \u2502\n\u2502  - \u30db\u30b9\u30c8\u540d  : client.example.com                            \u2502\n\u2502  - all       : \u5168\u30a2\u30c9\u30ec\u30b9                                    \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h3,{id:"22-\u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03",children:"2.2 \u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      \u8a8d\u8a3c\u65b9\u5f0f\u306e\u6bd4\u8f03                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 \u65b9\u5f0f              \u2502 \u8aac\u660e                              \u2502  \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502\n\u2502  \u2502 trust             \u2502 \u7121\u6761\u4ef6\u3067\u8a31\u53ef (\u5371\u967a\uff01)             \u2502  \u2502\n\u2502  \u2502 reject            \u2502 \u7121\u6761\u4ef6\u3067\u62d2\u5426                      \u2502  \u2502\n\u2502  \u2502 scram-sha-256     \u2502 \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c (\u63a8\u5968)             \u2502  \u2502\n\u2502  \u2502 md5               \u2502 MD5\u30d1\u30b9\u30ef\u30fc\u30c9 (\u975e\u63a8\u5968)            \u2502  \u2502\n\u2502  \u2502 password          \u2502 \u5e73\u6587\u30d1\u30b9\u30ef\u30fc\u30c9 (\u5371\u967a\uff01)           \u2502  \u2502\n\u2502  \u2502 peer              \u2502 OS\u30e6\u30fc\u30b6\u30fc\u540d\u3067\u8a8d\u8a3c (local\u306e\u307f)    \u2502  \u2502\n\u2502  \u2502 ident             \u2502 Ident\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u8a8d\u8a3c             \u2502  \u2502\n\u2502  \u2502 cert              \u2502 SSL\u8a3c\u660e\u66f8\u3067\u8a8d\u8a3c                   \u2502  \u2502\n\u2502  \u2502 ldap              \u2502 LDAP\u30b5\u30fc\u30d0\u30fc\u3067\u8a8d\u8a3c                \u2502  \u2502\n\u2502  \u2502 radius            \u2502 RADIUS\u30b5\u30fc\u30d0\u30fc\u3067\u8a8d\u8a3c              \u2502  \u2502\n\u2502  \u2502 gss               \u2502 GSSAPI/Kerberos\u8a8d\u8a3c               \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u63a8\u5968\u3011                                                    \u2502\n\u2502  - \u30ed\u30fc\u30ab\u30eb\u63a5\u7d9a: peer (postgres OS\u30e6\u30fc\u30b6\u30fc)                 \u2502\n\u2502  - \u30ea\u30e2\u30fc\u30c8\u63a5\u7d9a: scram-sha-256 + SSL                        \u2502\n\u2502  - \u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba: LDAP \u307e\u305f\u306f cert                       \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h3,{id:"23-\u672c\u756a\u74b0\u5883\u5411\u3051-pg_hbaconf-\u4f8b",children:"2.3 \u672c\u756a\u74b0\u5883\u5411\u3051 pg_hba.conf \u4f8b"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# /var/lib/pgsql/16/data/pg_hba.conf\n\n# TYPE  DATABASE        USER            ADDRESS                 METHOD\n\n# \u30ed\u30fc\u30ab\u30eb\u63a5\u7d9a (postgres \u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc)\nlocal   all             postgres                                peer\n\n# \u30ed\u30fc\u30ab\u30eb\u63a5\u7d9a (\u4e00\u822c\u30e6\u30fc\u30b6\u30fc)\nlocal   all             all                                     scram-sha-256\n\n# \u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u304b\u3089\u306eTCP\u63a5\u7d9a\nhost    all             all             127.0.0.1/32            scram-sha-256\nhost    all             all             ::1/128                 scram-sha-256\n\n# \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u306e\u63a5\u7d9a (SSL\u5fc5\u9808)\nhostssl myapp           app_user        10.0.1.0/24             scram-sha-256\nhostssl myapp           app_readonly    10.0.1.0/24             scram-sha-256\n\n# \u7ba1\u7406\u8005\u304b\u3089\u306e\u63a5\u7d9a (\u7279\u5b9aIP\u306e\u307f\u3001SSL\u5fc5\u9808)\nhostssl all             admin_user      10.0.100.10/32          scram-sha-256\n\n# \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 (SSL\u5fc5\u9808)\nhostssl replication     repl_user       10.0.2.0/24             scram-sha-256\n\n# \u305d\u306e\u4ed6\u306f\u5168\u3066\u62d2\u5426\nhost    all             all             0.0.0.0/0               reject\nhost    all             all             ::/0                    reject\n"})}),"\n",(0,l.jsx)(e.h3,{id:"24-\u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406",children:"2.4 \u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a (scram-sha-256)\nALTER USER myuser WITH PASSWORD 'secure_password_here';\n\n-- \u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9650\u306e\u8a2d\u5b9a\nALTER USER myuser VALID UNTIL '2025-12-31';\n\n-- \u63a5\u7d9a\u5236\u9650\nALTER USER myuser CONNECTION LIMIT 10;\n\n-- \u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6697\u53f7\u5316\u65b9\u5f0f\u3092\u78ba\u8a8d\nSHOW password_encryption;  -- scram-sha-256\n\n-- \u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u60c5\u5831\u78ba\u8a8d\nSELECT usename, passwd IS NOT NULL AS has_password, valuntil\nFROM pg_shadow;\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\npassword_encryption = 'scram-sha-256'  # \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6697\u53f7\u5316\u65b9\u5f0f\n"})}),"\n",(0,l.jsx)(e.h3,{id:"25-ldap\u8a8d\u8a3c\u306e\u8a2d\u5b9a",children:"2.5 LDAP\u8a8d\u8a3c\u306e\u8a2d\u5b9a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# pg_hba.conf (LDAP\u8a8d\u8a3c)\nhost    all    all    10.0.0.0/8    ldap ldapserver=ldap.example.com ldapbasedn="dc=example,dc=com" ldapsearchattribute=uid\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# Simple Bind\u65b9\u5f0f\nhost    all    all    10.0.0.0/8    ldap ldapserver=ldap.example.com ldapprefix="uid=" ldapsuffix=",ou=users,dc=example,dc=com"\n\n# Search+Bind\u65b9\u5f0f (\u3088\u308a\u67d4\u8edf)\nhost    all    all    10.0.0.0/8    ldap ldapserver=ldap.example.com ldapbasedn="ou=users,dc=example,dc=com" ldapsearchattribute=uid ldapbinddn="cn=pgbind,dc=example,dc=com" ldapbindpasswd="bindpass"\n'})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"3-\u30ed\u30fc\u30eb\u3068\u6a29\u9650",children:"3. \u30ed\u30fc\u30eb\u3068\u6a29\u9650"}),"\n",(0,l.jsx)(e.h3,{id:"31-\u30ed\u30fc\u30eb\u306e\u57fa\u672c",children:"3.1 \u30ed\u30fc\u30eb\u306e\u57fa\u672c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      \u30ed\u30fc\u30eb\u306e\u6982\u5ff5                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  PostgreSQL\u3067\u306f\u300c\u30e6\u30fc\u30b6\u30fc\u300d\u3068\u300c\u30b0\u30eb\u30fc\u30d7\u300d\u306e\u533a\u5225\u304c\u306a\u3044        \u2502\n\u2502  \u5168\u3066\u300c\u30ed\u30fc\u30eb\u300d\u3068\u3057\u3066\u7d71\u4e00\u7684\u306b\u7ba1\u7406                            \u2502\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502                      admin_role                      \u2502    \u2502\n\u2502  \u2502                    (\u30ed\u30b0\u30a4\u30f3\u4e0d\u53ef)                     \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                           \u2502 GRANT admin_role TO ...         \u2502\n\u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502            \u25bc              \u25bc              \u25bc                  \u2502\n\u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502     \u2502  alice    \u2502  \u2502   bob     \u2502  \u2502  charlie  \u2502            \u2502\n\u2502     \u2502(\u30ed\u30b0\u30a4\u30f3\u53ef)\u2502  \u2502(\u30ed\u30b0\u30a4\u30f3\u53ef)\u2502  \u2502(\u30ed\u30b0\u30a4\u30f3\u53ef)\u2502            \u2502\n\u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u30ed\u30fc\u30eb\u306e\u5c5e\u6027\u3011                                            \u2502\n\u2502  - LOGIN: \u30ed\u30b0\u30a4\u30f3\u53ef\u80fd                                       \u2502\n\u2502  - SUPERUSER: \u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc                               \u2502\n\u2502  - CREATEDB: \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4f5c\u6210\u53ef\u80fd                            \u2502\n\u2502  - CREATEROLE: \u30ed\u30fc\u30eb\u4f5c\u6210\u53ef\u80fd                                \u2502\n\u2502  - REPLICATION: \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u53ef\u80fd                         \u2502\n\u2502  - INHERIT: \u30e1\u30f3\u30d0\u30fc\u30b7\u30c3\u30d7\u306e\u6a29\u9650\u3092\u7d99\u627f                       \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h3,{id:"32-\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3068\u7ba1\u7406",children:"3.2 \u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3068\u7ba1\u7406"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30ed\u30b0\u30a4\u30f3\u53ef\u80fd\u306a\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\nCREATE ROLE app_user WITH\n    LOGIN\n    PASSWORD 'secure_password'\n    CONNECTION LIMIT 50\n    VALID UNTIL '2025-12-31';\n\n-- \u30b0\u30eb\u30fc\u30d7\u30ed\u30fc\u30eb\u4f5c\u6210 (\u30ed\u30b0\u30a4\u30f3\u4e0d\u53ef)\nCREATE ROLE app_readers;\nCREATE ROLE app_writers;\nCREATE ROLE app_admins;\n\n-- \u30e1\u30f3\u30d0\u30fc\u30b7\u30c3\u30d7\u306e\u4ed8\u4e0e\nGRANT app_readers TO app_user;\nGRANT app_writers TO app_user;\n\n-- \u7ba1\u7406\u8005\u30ed\u30fc\u30eb\nCREATE ROLE db_admin WITH\n    LOGIN\n    CREATEDB\n    CREATEROLE\n    PASSWORD 'admin_password';\n\n-- \u30ed\u30fc\u30eb\u306e\u78ba\u8a8d\n\\du\nSELECT * FROM pg_roles;\n\n-- \u30ed\u30fc\u30eb\u306e\u524a\u9664 (\u6240\u6709\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u79fb\u7ba1\u304c\u5fc5\u8981)\nREASSIGN OWNED BY old_user TO new_user;\nDROP OWNED BY old_user;\nDROP ROLE old_user;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"33-\u6a29\u9650\u306e\u7a2e\u985e",children:"3.3 \u6a29\u9650\u306e\u7a2e\u985e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       \u6a29\u9650\u306e\u7a2e\u985e                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30ec\u30d9\u30eb\u6a29\u9650\u3011                                  \u2502\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 \u6a29\u9650            \u2502 \u5bfe\u8c61\u30aa\u30d6\u30b8\u30a7\u30af\u30c8                  \u2502    \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u2502\n\u2502  \u2502 SELECT          \u2502 \u30c6\u30fc\u30d6\u30eb, \u30d3\u30e5\u30fc, \u30b7\u30fc\u30b1\u30f3\u30b9      \u2502    \u2502\n\u2502  \u2502 INSERT          \u2502 \u30c6\u30fc\u30d6\u30eb                          \u2502    \u2502\n\u2502  \u2502 UPDATE          \u2502 \u30c6\u30fc\u30d6\u30eb, \u30b7\u30fc\u30b1\u30f3\u30b9              \u2502    \u2502\n\u2502  \u2502 DELETE          \u2502 \u30c6\u30fc\u30d6\u30eb                          \u2502    \u2502\n\u2502  \u2502 TRUNCATE        \u2502 \u30c6\u30fc\u30d6\u30eb                          \u2502    \u2502\n\u2502  \u2502 REFERENCES      \u2502 \u30c6\u30fc\u30d6\u30eb                          \u2502    \u2502\n\u2502  \u2502 TRIGGER         \u2502 \u30c6\u30fc\u30d6\u30eb                          \u2502    \u2502\n\u2502  \u2502 CREATE          \u2502 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9, \u30b9\u30ad\u30fc\u30de            \u2502    \u2502\n\u2502  \u2502 CONNECT         \u2502 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9                      \u2502    \u2502\n\u2502  \u2502 TEMPORARY       \u2502 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9                      \u2502    \u2502\n\u2502  \u2502 EXECUTE         \u2502 \u95a2\u6570, \u30d7\u30ed\u30b7\u30fc\u30b8\u30e3                \u2502    \u2502\n\u2502  \u2502 USAGE           \u2502 \u30b9\u30ad\u30fc\u30de, \u30b7\u30fc\u30b1\u30f3\u30b9, \u578b          \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u7279\u6b8a\u6a29\u9650\u3011                                                \u2502\n\u2502  - ALL PRIVILEGES: \u5168\u3066\u306e\u6a29\u9650                               \u2502\n\u2502  - WITH GRANT OPTION: \u6a29\u9650\u3092\u4ed6\u8005\u306b\u4ed8\u4e0e\u53ef\u80fd                  \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h3,{id:"34-\u6a29\u9650\u306e\u4ed8\u4e0e\u3068\u53d6\u308a\u6d88\u3057",children:"3.4 \u6a29\u9650\u306e\u4ed8\u4e0e\u3068\u53d6\u308a\u6d88\u3057"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u63a5\u7d9a\u6a29\u9650\nGRANT CONNECT ON DATABASE myapp TO app_user;\n\n-- \u30b9\u30ad\u30fc\u30de\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\nGRANT USAGE ON SCHEMA app TO app_readers;\nGRANT CREATE ON SCHEMA app TO app_admins;\n\n-- \u30c6\u30fc\u30d6\u30eb\u3078\u306e\u6a29\u9650\nGRANT SELECT ON TABLE app.users TO app_readers;\nGRANT SELECT, INSERT, UPDATE, DELETE ON TABLE app.users TO app_writers;\nGRANT ALL PRIVILEGES ON TABLE app.users TO app_admins;\n\n-- \u30b9\u30ad\u30fc\u30de\u5185\u306e\u5168\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u6a29\u9650\nGRANT SELECT ON ALL TABLES IN SCHEMA app TO app_readers;\nGRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA app TO app_writers;\n\n-- \u4eca\u5f8c\u4f5c\u6210\u3055\u308c\u308b\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u6a29\u9650\nALTER DEFAULT PRIVILEGES IN SCHEMA app\n    GRANT SELECT ON TABLES TO app_readers;\n\nALTER DEFAULT PRIVILEGES IN SCHEMA app\n    GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO app_writers;\n\n-- \u30b7\u30fc\u30b1\u30f3\u30b9\u3078\u306e\u6a29\u9650\nGRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA app TO app_writers;\nALTER DEFAULT PRIVILEGES IN SCHEMA app\n    GRANT USAGE, SELECT ON SEQUENCES TO app_writers;\n\n-- \u95a2\u6570\u3078\u306e\u6a29\u9650\nGRANT EXECUTE ON FUNCTION app.my_function() TO app_users;\n\n-- \u6a29\u9650\u306e\u53d6\u308a\u6d88\u3057\nREVOKE INSERT, UPDATE, DELETE ON TABLE app.users FROM app_readers;\n\n-- \u6a29\u9650\u306e\u78ba\u8a8d\n\\dp app.users\nSELECT * FROM information_schema.table_privileges\nWHERE table_schema = 'app' AND table_name = 'users';\n"})}),"\n",(0,l.jsx)(e.h3,{id:"35-public-\u30b9\u30ad\u30fc\u30de\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3",children:"3.5 public \u30b9\u30ad\u30fc\u30de\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fpublic\u30b9\u30ad\u30fc\u30de\u306b\u8ab0\u3067\u3082\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3067\u304d\u308b\n-- \u3053\u308c\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ea\u30b9\u30af\n\n-- public \u30b9\u30ad\u30fc\u30de\u304b\u3089\u306e CREATE \u6a29\u9650\u3092\u524a\u9664\nREVOKE CREATE ON SCHEMA public FROM PUBLIC;\n\n-- public \u30b9\u30ad\u30fc\u30de\u306e USAGE \u6a29\u9650\u3092\u524a\u9664 (\u3088\u308a\u53b3\u683c)\nREVOKE ALL ON SCHEMA public FROM PUBLIC;\n\n-- \u7279\u5b9a\u306e\u30ed\u30fc\u30eb\u306b\u306e\u307f\u8a31\u53ef\nGRANT USAGE ON SCHEMA public TO app_users;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"36-\u63a8\u5968\u3055\u308c\u308b\u30ed\u30fc\u30eb\u8a2d\u8a08",children:"3.6 \u63a8\u5968\u3055\u308c\u308b\u30ed\u30fc\u30eb\u8a2d\u8a08"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- 1. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u30ed\u30fc\u30eb\u968e\u5c64\n\n-- \u8aad\u307f\u53d6\u308a\u5c02\u7528\u30ed\u30fc\u30eb\nCREATE ROLE app_readonly;\nGRANT CONNECT ON DATABASE myapp TO app_readonly;\nGRANT USAGE ON SCHEMA app TO app_readonly;\nGRANT SELECT ON ALL TABLES IN SCHEMA app TO app_readonly;\nALTER DEFAULT PRIVILEGES IN SCHEMA app GRANT SELECT ON TABLES TO app_readonly;\n\n-- \u8aad\u307f\u66f8\u304d\u30ed\u30fc\u30eb\nCREATE ROLE app_readwrite;\nGRANT app_readonly TO app_readwrite;  -- \u8aad\u307f\u53d6\u308a\u6a29\u9650\u3092\u7d99\u627f\nGRANT INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA app TO app_readwrite;\nGRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA app TO app_readwrite;\nALTER DEFAULT PRIVILEGES IN SCHEMA app\n    GRANT INSERT, UPDATE, DELETE ON TABLES TO app_readwrite;\nALTER DEFAULT PRIVILEGES IN SCHEMA app\n    GRANT USAGE, SELECT ON SEQUENCES TO app_readwrite;\n\n-- \u7ba1\u7406\u8005\u30ed\u30fc\u30eb\nCREATE ROLE app_admin;\nGRANT app_readwrite TO app_admin;\nGRANT CREATE ON SCHEMA app TO app_admin;\nGRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA app TO app_admin;\n\n-- 2. \u5b9f\u969b\u306e\u30e6\u30fc\u30b6\u30fc\u306b\u30ed\u30fc\u30eb\u3092\u4ed8\u4e0e\nCREATE ROLE web_app WITH LOGIN PASSWORD 'xxx';\nGRANT app_readwrite TO web_app;\n\nCREATE ROLE batch_app WITH LOGIN PASSWORD 'xxx';\nGRANT app_readwrite TO batch_app;\n\nCREATE ROLE report_app WITH LOGIN PASSWORD 'xxx';\nGRANT app_readonly TO report_app;\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"4-row-level-security-rls",children:"4. Row Level Security (RLS)"}),"\n",(0,l.jsx)(e.h3,{id:"41-rls\u306e\u6982\u5ff5",children:"4.1 RLS\u306e\u6982\u5ff5"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  Row Level Security (RLS)                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u901a\u5e38\u306e\u6a29\u9650: \u30c6\u30fc\u30d6\u30eb\u5168\u4f53\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1                    \u2502\n\u2502  RLS: \u884c\u5358\u4f4d\u3067\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1                                 \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u4f7f\u7528\u4f8b\u3011                                                  \u2502\n\u2502  - \u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3                            \u2502\n\u2502  - \u90e8\u7f72\u3054\u3068\u306e\u30c7\u30fc\u30bf\u5206\u96e2                                      \u2502\n\u2502  - \u30e6\u30fc\u30b6\u30fc\u3054\u3068\u306b\u81ea\u5206\u306e\u30c7\u30fc\u30bf\u306e\u307f\u8868\u793a                        \u2502\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  orders \u30c6\u30fc\u30d6\u30eb                                      \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502   \u2502\n\u2502  \u2502  \u2502 id     \u2502 tenant_id\u2502 user_id \u2502 amount  \u2502          \u2502   \u2502\n\u2502  \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524          \u2502   \u2502\n\u2502  \u2502  \u2502 1      \u2502 A        \u2502 alice   \u2502 1000    \u2502 \u2190 tenant A\u2502   \u2502\n\u2502  \u2502  \u2502 2      \u2502 A        \u2502 bob     \u2502 2000    \u2502 \u2190 tenant A\u2502   \u2502\n\u2502  \u2502  \u2502 3      \u2502 B        \u2502 charlie \u2502 3000    \u2502 \u2190 tenant B\u2502   \u2502\n\u2502  \u2502  \u2502 4      \u2502 B        \u2502 dave    \u2502 4000    \u2502 \u2190 tenant B\u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                              \u2502\n\u2502  tenant A \u306e\u30e6\u30fc\u30b6\u30fc\u304c SELECT * FROM orders \u3092\u5b9f\u884c          \u2502\n\u2502  \u2192 id 1, 2 \u306e\u307f\u8868\u793a (tenant_id = 'A' \u306e\u884c\u306e\u307f)              \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h3,{id:"42-rls\u306e\u57fa\u672c\u8a2d\u5b9a",children:"4.2 RLS\u306e\u57fa\u672c\u8a2d\u5b9a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- 1. \u30c6\u30fc\u30d6\u30eb\u3067RLS\u3092\u6709\u52b9\u5316\nALTER TABLE orders ENABLE ROW LEVEL SECURITY;\n\n-- 2. \u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n-- SELECT\u7528\u30dd\u30ea\u30b7\u30fc\nCREATE POLICY orders_tenant_isolation ON orders\n    FOR SELECT\n    USING (tenant_id = current_setting('app.current_tenant'));\n\n-- INSERT\u7528\u30dd\u30ea\u30b7\u30fc\nCREATE POLICY orders_tenant_insert ON orders\n    FOR INSERT\n    WITH CHECK (tenant_id = current_setting('app.current_tenant'));\n\n-- UPDATE\u7528\u30dd\u30ea\u30b7\u30fc\nCREATE POLICY orders_tenant_update ON orders\n    FOR UPDATE\n    USING (tenant_id = current_setting('app.current_tenant'))\n    WITH CHECK (tenant_id = current_setting('app.current_tenant'));\n\n-- DELETE\u7528\u30dd\u30ea\u30b7\u30fc\nCREATE POLICY orders_tenant_delete ON orders\n    FOR DELETE\n    USING (tenant_id = current_setting('app.current_tenant'));\n\n-- \u5168\u64cd\u4f5c\u306b\u5bfe\u3059\u308b\u30dd\u30ea\u30b7\u30fc (ALL)\nCREATE POLICY orders_tenant_all ON orders\n    FOR ALL\n    USING (tenant_id = current_setting('app.current_tenant'))\n    WITH CHECK (tenant_id = current_setting('app.current_tenant'));\n"})}),"\n",(0,l.jsx)(e.h3,{id:"43-\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u306e\u4f7f\u7528",children:"4.3 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u306e\u4f7f\u7528"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30bb\u30c3\u30b7\u30e7\u30f3\u958b\u59cb\u6642\u306b\u30c6\u30ca\u30f3\u30c8\u3092\u8a2d\u5b9a\nSET app.current_tenant = 'tenant_a';\n\n-- \u4ee5\u964d\u306e\u30af\u30a8\u30ea\u306f\u81ea\u52d5\u7684\u306b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\nSELECT * FROM orders;  -- tenant_a \u306e\u884c\u306e\u307f\u8fd4\u308b\n\n-- \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5185\u3067\u8a2d\u5b9a\nBEGIN;\nSET LOCAL app.current_tenant = 'tenant_a';\nSELECT * FROM orders;\nCOMMIT;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"44-\u30e6\u30fc\u30b6\u30fc\u30d9\u30fc\u30b9\u306erls",children:"4.4 \u30e6\u30fc\u30b6\u30fc\u30d9\u30fc\u30b9\u306eRLS"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30e6\u30fc\u30b6\u30fc\u304c\u81ea\u5206\u306e\u30c7\u30fc\u30bf\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\nCREATE POLICY user_isolation ON user_data\n    FOR ALL\n    USING (user_id = current_user)\n    WITH CHECK (user_id = current_user);\n\n-- \u307e\u305f\u306f SESSION_USER \u3092\u4f7f\u7528\nCREATE POLICY user_isolation ON user_data\n    FOR ALL\n    USING (user_id = SESSION_USER);\n"})}),"\n",(0,l.jsx)(e.h3,{id:"45-\u8907\u5408\u30dd\u30ea\u30b7\u30fc",children:"4.5 \u8907\u5408\u30dd\u30ea\u30b7\u30fc"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u8907\u6570\u306e\u30dd\u30ea\u30b7\u30fc\u304c\u3042\u308b\u5834\u5408\u3001OR \u3067\u7d50\u5408\u3055\u308c\u308b\n\n-- \u81ea\u5206\u306e\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\nCREATE POLICY own_data ON documents\n    FOR SELECT\n    USING (owner_id = current_user);\n\n-- \u516c\u958b\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\nCREATE POLICY public_data ON documents\n    FOR SELECT\n    USING (is_public = true);\n\n-- \u7ba1\u7406\u8005\u306f\u5168\u30c7\u30fc\u30bf\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\nCREATE POLICY admin_access ON documents\n    FOR ALL\n    TO admin_role\n    USING (true);\n"})}),"\n",(0,l.jsx)(e.h3,{id:"46-rls\u306e\u30d0\u30a4\u30d1\u30b9",children:"4.6 RLS\u306e\u30d0\u30a4\u30d1\u30b9"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30c6\u30fc\u30d6\u30eb\u6240\u6709\u8005\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067RLS\u3092\u30d0\u30a4\u30d1\u30b9\n-- \u3053\u308c\u3092\u9632\u3050\u5834\u5408:\nALTER TABLE orders FORCE ROW LEVEL SECURITY;\n\n-- \u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc\u306f\u5e38\u306b\u30d0\u30a4\u30d1\u30b9\n-- BYPASSRLS\u5c5e\u6027\u3092\u6301\u3064\u30ed\u30fc\u30eb\u3082\u30d0\u30a4\u30d1\u30b9\nALTER ROLE admin_user BYPASSRLS;\n\n-- RLS\u3092\u30d0\u30a4\u30d1\u30b9\u3057\u306a\u3044\u30ed\u30fc\u30eb (\u30c7\u30d5\u30a9\u30eb\u30c8)\nALTER ROLE app_user NOBYPASSRLS;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"47-rls\u306e\u30c7\u30d0\u30c3\u30b0",children:"4.7 RLS\u306e\u30c7\u30d0\u30c3\u30b0"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\n\\d orders\n\nSELECT * FROM pg_policies WHERE tablename = 'orders';\n\n-- \u73fe\u5728\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u5909\u6570\u306e\u78ba\u8a8d\nSELECT current_setting('app.current_tenant', true);\n\n-- RLS\u3092\u4e00\u6642\u7684\u306b\u7121\u52b9\u5316 (\u30c7\u30d0\u30c3\u30b0\u7528\u3001\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc\u306e\u307f)\nSET row_security = off;\nSELECT * FROM orders;  -- \u5168\u884c\u304c\u898b\u3048\u308b\nSET row_security = on;\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"5-ssltls\u6697\u53f7\u5316",children:"5. SSL/TLS\u6697\u53f7\u5316"}),"\n",(0,l.jsx)(e.h3,{id:"51-ssl\u8a2d\u5b9a\u306e\u6982\u8981",children:"5.1 SSL\u8a2d\u5b9a\u306e\u6982\u8981"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      SSL/TLS\u6697\u53f7\u5316                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502   Client    \u2502 \u25c4\u2500\u2500\u2500\u2500 SSL/TLS \u2500\u2500\u2500\u2500\u25ba \u2502   Server    \u2502       \u2502\n\u2502  \u2502             \u2502      \u6697\u53f7\u5316\u901a\u4fe1       \u2502             \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u4fdd\u8b77\u3055\u308c\u308b\u5185\u5bb9\u3011                                          \u2502\n\u2502  - \u8a8d\u8a3c\u60c5\u5831 (\u30d1\u30b9\u30ef\u30fc\u30c9)                                     \u2502\n\u2502  - \u30af\u30a8\u30ea\u5185\u5bb9                                                \u2502\n\u2502  - \u7d50\u679c\u30c7\u30fc\u30bf                                                \u2502\n\u2502                                                              \u2502\n\u2502  \u3010SSL\u8a2d\u5b9a\u30ec\u30d9\u30eb\u3011                                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 sslmode      \u2502 \u8aac\u660e                                   \u2502  \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502\n\u2502  \u2502 disable      \u2502 SSL\u3092\u4f7f\u7528\u3057\u306a\u3044                        \u2502  \u2502\n\u2502  \u2502 allow        \u2502 \u975eSSL\u3092\u8a66\u3057\u3001\u5931\u6557\u3057\u305f\u3089SSL            \u2502  \u2502\n\u2502  \u2502 prefer       \u2502 SSL\u3092\u8a66\u3057\u3001\u5931\u6557\u3057\u305f\u3089\u975eSSL (\u30c7\u30d5\u30a9\u30eb\u30c8)\u2502  \u2502\n\u2502  \u2502 require      \u2502 SSL\u5fc5\u9808\u3001\u8a3c\u660e\u66f8\u691c\u8a3c\u306a\u3057               \u2502  \u2502\n\u2502  \u2502 verify-ca    \u2502 SSL\u5fc5\u9808\u3001CA\u8a3c\u660e\u66f8\u3092\u691c\u8a3c               \u2502  \u2502\n\u2502  \u2502 verify-full  \u2502 SSL\u5fc5\u9808\u3001CA+\u30db\u30b9\u30c8\u540d\u3092\u691c\u8a3c (\u63a8\u5968)     \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h3,{id:"52-\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u4f5c\u6210",children:"5.2 \u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u4f5c\u6210"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# \u81ea\u5df1\u7f72\u540d\u8a3c\u660e\u66f8\u306e\u4f5c\u6210 (\u958b\u767a/\u30c6\u30b9\u30c8\u7528)\n\n# \u79d8\u5bc6\u9375\u306e\u751f\u6210\nopenssl genrsa -out server.key 2048\nchmod 600 server.key\nchown postgres:postgres server.key\n\n# \u8a3c\u660e\u66f8\u306e\u4f5c\u6210\nopenssl req -new -key server.key -out server.csr \\\n    -subj "/CN=postgres.example.com"\n\nopenssl x509 -req -in server.csr -signkey server.key \\\n    -out server.crt -days 365\n\n# \u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\ncp server.key server.crt /var/lib/pgsql/16/data/\n'})}),"\n",(0,l.jsx)(e.h3,{id:"53-\u30b5\u30fc\u30d0\u30fc\u306essl\u8a2d\u5b9a",children:"5.3 \u30b5\u30fc\u30d0\u30fc\u306eSSL\u8a2d\u5b9a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\n\n# SSL\u3092\u6709\u52b9\u5316\nssl = on\n\n# \u8a3c\u660e\u66f8\u30d5\u30a1\u30a4\u30eb\nssl_cert_file = 'server.crt'\nssl_key_file = 'server.key'\n\n# CA\u8a3c\u660e\u66f8 (\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u8a8d\u8a3c\u7528)\nssl_ca_file = 'root.crt'\n\n# \u8a3c\u660e\u66f8\u5931\u52b9\u30ea\u30b9\u30c8\nssl_crl_file = ''\n\n# \u6697\u53f7\u30b9\u30a4\u30fc\u30c8 (TLS 1.2\u4ee5\u4e0a\u3092\u63a8\u5968)\nssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL'\nssl_prefer_server_ciphers = on\n\n# \u6700\u5c0fTLS\u30d0\u30fc\u30b8\u30e7\u30f3\nssl_min_protocol_version = 'TLSv1.2'\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# pg_hba.conf \u3067SSL\u63a5\u7d9a\u3092\u5f37\u5236\nhostssl all all 0.0.0.0/0 scram-sha-256\n"})}),"\n",(0,l.jsx)(e.h3,{id:"54-\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306essl\u8a2d\u5b9a",children:"5.4 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306eSSL\u8a2d\u5b9a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# \u63a5\u7d9a\u6587\u5b57\u5217\u3067SSL\u30e2\u30fc\u30c9\u6307\u5b9a\npsql "host=db.example.com dbname=mydb user=myuser sslmode=verify-full sslrootcert=/path/to/root.crt"\n\n# \u74b0\u5883\u5909\u6570\nexport PGSSLMODE=verify-full\nexport PGSSLROOTCERT=/path/to/root.crt\n\n# libpq\u63a5\u7d9a\u6587\u5b57\u5217\npostgresql://myuser@db.example.com/mydb?sslmode=verify-full&sslrootcert=/path/to/root.crt\n'})}),"\n",(0,l.jsx)(e.h3,{id:"55-\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u8a8d\u8a3c",children:"5.5 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u8a8d\u8a3c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u4f5c\u6210\nopenssl genrsa -out client.key 2048\nopenssl req -new -key client.key -out client.csr \\\n    -subj "/CN=myuser"\nopenssl x509 -req -in client.csr -CA root.crt -CAkey root.key \\\n    -CAcreateserial -out client.crt -days 365\n\n# pg_hba.conf\nhostssl all all 0.0.0.0/0 cert\n\n# \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\npsql "host=db.example.com dbname=mydb user=myuser \\\n    sslmode=verify-full \\\n    sslcert=client.crt \\\n    sslkey=client.key \\\n    sslrootcert=root.crt"\n'})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"6-\u76e3\u67fb\u30ed\u30b0",children:"6. \u76e3\u67fb\u30ed\u30b0"}),"\n",(0,l.jsx)(e.h3,{id:"61-\u6a19\u6e96\u30ed\u30b0\u8a2d\u5b9a",children:"6.1 \u6a19\u6e96\u30ed\u30b0\u8a2d\u5b9a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\n\n# \u30ed\u30b0\u53ce\u96c6\u3092\u6709\u52b9\u5316\nlogging_collector = on\nlog_directory = 'log'\nlog_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'\nlog_rotation_age = 1d\nlog_rotation_size = 100MB\n\n# \u63a5\u7d9a\u30ed\u30b0\nlog_connections = on\nlog_disconnections = on\n\n# \u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u30ed\u30b0\nlog_statement = 'ddl'  # none, ddl, mod, all\n\n# \u30b9\u30ed\u30fc\u30af\u30a8\u30ea\u30ed\u30b0\nlog_min_duration_statement = 1000  # 1\u79d2\u4ee5\u4e0a\n\n# \u30ed\u30b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nlog_line_prefix = '%t [%p]: user=%u,db=%d,app=%a,client=%h '\n\n# \u30a8\u30e9\u30fc\u30ec\u30d9\u30eb\nlog_min_messages = warning\nlog_min_error_statement = error\n\n# \u305d\u306e\u4ed6\nlog_checkpoints = on\nlog_lock_waits = on\nlog_temp_files = 0\n"})}),"\n",(0,l.jsx)(e.h3,{id:"62-pgaudit\u306b\u3088\u308b\u8a73\u7d30\u76e3\u67fb",children:"6.2 pgAudit\u306b\u3088\u308b\u8a73\u7d30\u76e3\u67fb"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# pgAudit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb (RHEL\u7cfb)\nsudo dnf install pgaudit16\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\nshared_preload_libraries = 'pgaudit'\n\n# \u76e3\u67fb\u8a2d\u5b9a\npgaudit.log = 'read, write, ddl'\npgaudit.log_catalog = off\npgaudit.log_parameter = on\npgaudit.log_statement_once = on\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u62e1\u5f35\u3092\u6709\u52b9\u5316\nCREATE EXTENSION pgaudit;\n\n-- \u7279\u5b9a\u306e\u30ed\u30fc\u30eb\u306b\u5bfe\u3059\u308b\u76e3\u67fb\nALTER ROLE auditor SET pgaudit.log = 'all';\n\n-- \u7279\u5b9a\u30c6\u30fc\u30d6\u30eb\u306e\u76e3\u67fb\nALTER TABLE sensitive_data SET (pgaudit.log = 'all');\n"})}),"\n",(0,l.jsx)(e.h3,{id:"63-\u76e3\u67fb\u30ed\u30b0\u306e\u4f8b",children:"6.3 \u76e3\u67fb\u30ed\u30b0\u306e\u4f8b"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:'# \u6a19\u6e96\u30ed\u30b0\n2024-01-15 10:30:45.123 JST [12345]: user=app_user,db=myapp,app=webapp,client=192.168.1.100\nLOG:  statement: SELECT * FROM users WHERE id = 1;\n\n# pgAudit\u30ed\u30b0\n2024-01-15 10:30:45.123 JST [12345]: user=app_user,db=myapp,app=webapp,client=192.168.1.100\nLOG:  AUDIT: SESSION,1,1,READ,SELECT,TABLE,public.users,"SELECT * FROM users WHERE id = 1",<none>\n'})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"7-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"7. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,l.jsx)(e.h3,{id:"71-\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8",children:"7.1 \u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u3010\u8a8d\u8a3c\u3011                                                    \u2502\n\u2502  \u25a1 trust \u8a8d\u8a3c\u3092\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044                                \u2502\n\u2502  \u25a1 scram-sha-256 \u3092\u4f7f\u7528\u3057\u3066\u3044\u308b                              \u2502\n\u2502  \u25a1 \u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u5341\u5206\u306b\u8907\u96d1                                    \u2502\n\u2502  \u25a1 \u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9650\u3092\u8a2d\u5b9a                                  \u2502\n\u2502  \u25a1 \u63a5\u7d9a\u6570\u5236\u9650\u3092\u8a2d\u5b9a                                          \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3011                                            \u2502\n\u2502  \u25a1 listen_addresses \u3092\u5fc5\u8981\u6700\u5c0f\u9650\u306b\u5236\u9650                       \u2502\n\u2502  \u25a1 pg_hba.conf \u3067\u63a5\u7d9a\u5143\u3092\u5236\u9650                                \u2502\n\u2502  \u25a1 SSL/TLS \u3092\u6709\u52b9\u5316                                          \u2502\n\u2502  \u25a1 \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3067\u30dd\u30fc\u30c8\u3092\u5236\u9650                            \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u6a29\u9650\u3011                                                    \u2502\n\u2502  \u25a1 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc\u3067\u63a5\u7d9a\u3057\u3066\u3044\u306a\u3044        \u2502\n\u2502  \u25a1 \u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247\u3092\u9069\u7528                                      \u2502\n\u2502  \u25a1 public \u30b9\u30ad\u30fc\u30de\u306e\u6a29\u9650\u3092\u5236\u9650                               \u2502\n\u2502  \u25a1 \u30c7\u30d5\u30a9\u30eb\u30c8\u6a29\u9650\u3092\u9069\u5207\u306b\u8a2d\u5b9a                                \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u76e3\u67fb\u3011                                                    \u2502\n\u2502  \u25a1 \u63a5\u7d9a/\u5207\u65ad\u3092\u30ed\u30b0\u306b\u8a18\u9332                                     \u2502\n\u2502  \u25a1 DDL\u64cd\u4f5c\u3092\u30ed\u30b0\u306b\u8a18\u9332                                       \u2502\n\u2502  \u25a1 \u30bb\u30f3\u30b7\u30c6\u30a3\u30d6\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u76e3\u67fb                      \u2502\n\u2502  \u25a1 \u30ed\u30b0\u3092\u5b89\u5168\u306b\u4fdd\u7ba1                                          \u2502\n\u2502                                                              \u2502\n\u2502  \u3010\u305d\u306e\u4ed6\u3011                                                  \u2502\n\u2502  \u25a1 PostgreSQL\u3092\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u66f4\u65b0                          \u2502\n\u2502  \u25a1 \u4e0d\u8981\u306a\u62e1\u5f35\u6a5f\u80fd\u3092\u524a\u9664                                      \u2502\n\u2502  \u25a1 \u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d (700)               \u2502\n\u2502  \u25a1 \u5b9a\u671f\u7684\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ec\u30d3\u30e5\u30fc                              \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h3,{id:"72-\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u306e\u78ba\u8a8d\u30af\u30a8\u30ea",children:"7.2 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u306e\u78ba\u8a8d\u30af\u30a8\u30ea"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc\u306e\u78ba\u8a8d\nSELECT usename, usesuper FROM pg_user WHERE usesuper;\n\n-- trust\u8a8d\u8a3c\u306e\u78ba\u8a8d\nSELECT * FROM pg_hba_file_rules WHERE auth_method = 'trust';\n\n-- \u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u30e6\u30fc\u30b6\u30fc\u306e\u78ba\u8a8d\nSELECT usename FROM pg_shadow WHERE passwd IS NULL;\n\n-- public \u30b9\u30ad\u30fc\u30de\u306e\u6a29\u9650\u78ba\u8a8d\nSELECT nspname, nspacl FROM pg_namespace WHERE nspname = 'public';\n\n-- \u5168\u30c6\u30fc\u30d6\u30eb\u306e\u6a29\u9650\u78ba\u8a8d\nSELECT schemaname, tablename, tableowner,\n       has_table_privilege('public', schemaname || '.' || tablename, 'SELECT') as public_select\nFROM pg_tables\nWHERE schemaname NOT IN ('pg_catalog', 'information_schema');\n\n-- SSL\u63a5\u7d9a\u306e\u78ba\u8a8d\nSELECT datname, usename, ssl, client_addr\nFROM pg_stat_ssl\nJOIN pg_stat_activity USING (pid);\n\n-- \u63a5\u7d9a\u5236\u9650\u306e\u78ba\u8a8d\nSELECT rolname, rolconnlimit FROM pg_roles WHERE rolconnlimit > 0;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"73-\u5b9a\u671f\u7684\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30bf\u30b9\u30af",children:"7.3 \u5b9a\u671f\u7684\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30bf\u30b9\u30af"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u5b9a\u671f\u5909\u66f4\nALTER USER app_user WITH PASSWORD 'new_secure_password';\n\n# \u4e0d\u8981\u306a\u63a5\u7d9a\u306e\u78ba\u8a8d\u3068\u7d42\u4e86\nSELECT pg_terminate_backend(pid)\nFROM pg_stat_activity\nWHERE usename = 'suspicious_user';\n\n# \u6a29\u9650\u306e\u68da\u5378\u3057\nSELECT grantee, privilege_type, table_schema, table_name\nFROM information_schema.table_privileges\nWHERE grantee NOT IN ('postgres')\nORDER BY grantee, table_schema, table_name;\n\n# \u30ed\u30b0\u306e\u30ec\u30d3\u30e5\u30fc\ngrep -E \"(FATAL|ERROR|authentication failed)\" /var/lib/pgsql/16/data/log/*.log\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"\u53c2\u8003\u30ea\u30f3\u30af",children:"\u53c2\u8003\u30ea\u30f3\u30af"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/client-authentication.html",children:"PostgreSQL\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/user-manag.html",children:"PostgreSQL\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - \u30ed\u30fc\u30eb"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/ddl-rowsecurity.html",children:"PostgreSQL\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - Row Security Policies"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/ssl-tcp.html",children:"PostgreSQL\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - SSL"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.pgaudit.org/",children:"pgAudit"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://cheatsheetseries.owasp.org/cheatsheets/Database_Security_Cheat_Sheet.html",children:"OWASP Database Security Cheat Sheet"})}),"\n"]})]})}function E(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(p,{...n})}):p(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>t});var r=s(96540);const l={},a=r.createContext(l);function i(n){const e=r.useContext(a);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:i(n.components),r.createElement(a.Provider,{value:e},n.children)}}}]);