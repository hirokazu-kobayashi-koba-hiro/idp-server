"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[7316],{9297:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>a,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"content_06_developer-guide/configuration/authn/external-token","title":"External Token\u8a8d\u8a3c","description":"\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3001external-token \u65b9\u5f0f\u306b\u3088\u308b\u5916\u90e8\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u305f\u8a8d\u8a3c\u51e6\u7406\u306e \u6982\u8981\u30fb\u8a2d\u5b9a\u30fb\u5229\u7528\u65b9\u6cd5 \u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002","source":"@site/docs/content_06_developer-guide/05-configuration/authn/external-token.md","sourceDirName":"content_06_developer-guide/05-configuration/authn","slug":"/content_06_developer-guide/configuration/authn/external-token","permalink":"/idp-server/docs/content_06_developer-guide/configuration/authn/external-token","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/content_06_developer-guide/05-configuration/authn/external-token.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Email\u8a8d\u8a3c","permalink":"/idp-server/docs/content_06_developer-guide/configuration/authn/email"},"next":{"title":"FIDO-UAF\u8a8d\u8a3c","permalink":"/idp-server/docs/content_06_developer-guide/configuration/authn/fido-uaf"}}');var t=s(74848),i=s(28453);const d={},l="External Token\u8a8d\u8a3c",c={},o=[{value:"\u6982\u8981",id:"\u6982\u8981",level:2},{value:"\u4e3b\u306a\u7528\u9014",id:"\u4e3b\u306a\u7528\u9014",level:3},{value:"\u51e6\u7406\u30d5\u30ed\u30fc",id:"\u51e6\u7406\u30d5\u30ed\u30fc",level:3},{value:"\u8a2d\u5b9a",id:"\u8a2d\u5b9a",level:2},{value:"\u57fa\u672c\u69cb\u9020",id:"\u57fa\u672c\u69cb\u9020",level:3},{value:"Request Schema",id:"request-schema",level:2},{value:"Execution: \u8907\u6570HTTP\u30ea\u30af\u30a8\u30b9\u30c8",id:"execution-\u8907\u6570http\u30ea\u30af\u30a8\u30b9\u30c8",level:2},{value:"HTTP Requests \u8a2d\u5b9a",id:"http-requests-\u8a2d\u5b9a",level:3},{value:"\u4e3b\u8981\u9805\u76ee",id:"\u4e3b\u8981\u9805\u76ee",level:3},{value:"Mapping Functions",id:"mapping-functions",level:3},{value:"\u30d8\u30c3\u30c0\u30fc\u30de\u30c3\u30d4\u30f3\u30b0\u4f8b",id:"\u30d8\u30c3\u30c0\u30fc\u30de\u30c3\u30d4\u30f3\u30b0\u4f8b",level:4},{value:"\u524d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u7d50\u679c\u306e\u53c2\u7167",id:"\u524d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u7d50\u679c\u306e\u53c2\u7167",level:4},{value:"User Resolve: \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u30de\u30c3\u30d4\u30f3\u30b0",id:"user-resolve-\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u30de\u30c3\u30d4\u30f3\u30b0",level:2},{value:"User Mapping Rules",id:"user-mapping-rules",level:3},{value:"\u30de\u30c3\u30d4\u30f3\u30b0\u5148\u30d5\u30a3\u30fc\u30eb\u30c9",id:"\u30de\u30c3\u30d4\u30f3\u30b0\u5148\u30d5\u30a3\u30fc\u30eb\u30c9",level:3},{value:"\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8b",id:"\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8b",level:2},{value:"\u5229\u7528\u65b9\u6cd5",id:"\u5229\u7528\u65b9\u6cd5",level:2},{value:"\u4e8b\u524d\u6e96\u5099",id:"\u4e8b\u524d\u6e96\u5099",level:3},{value:"\u8a8d\u8a3c\u30d5\u30ed\u30fc",id:"\u8a8d\u8a3c\u30d5\u30ed\u30fc",level:3},{value:"\u5185\u90e8\u30ed\u30b8\u30c3\u30af",id:"\u5185\u90e8\u30ed\u30b8\u30c3\u30af",level:2},{value:"Mapping Functions\u6d3b\u7528\u4f8b",id:"mapping-functions\u6d3b\u7528\u4f8b",level:2},{value:"\u52d5\u7684\u30d8\u30c3\u30c0\u30fc\u751f\u6210",id:"\u52d5\u7684\u30d8\u30c3\u30c0\u30fc\u751f\u6210",level:3},{value:"\u30ea\u30af\u30a8\u30b9\u30c8ID\u751f\u6210",id:"\u30ea\u30af\u30a8\u30b9\u30c8id\u751f\u6210",level:3},{value:"\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u751f\u6210",id:"\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u751f\u6210",level:3},{value:"\u524d\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u53c2\u7167",id:"\u524d\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u53c2\u7167",level:3},{value:"\u5099\u8003",id:"\u5099\u8003",level:2},{value:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"external-token\u8a8d\u8a3c",children:"External Token\u8a8d\u8a3c"})}),"\n",(0,t.jsxs)(n.p,{children:["\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3001",(0,t.jsx)(n.code,{children:"external-token"})," \u65b9\u5f0f\u306b\u3088\u308b\u5916\u90e8\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u305f\u8a8d\u8a3c\u51e6\u7406\u306e ",(0,t.jsx)(n.code,{children:"\u6982\u8981"}),"\u30fb",(0,t.jsx)(n.code,{children:"\u8a2d\u5b9a"}),"\u30fb",(0,t.jsx)(n.code,{children:"\u5229\u7528\u65b9\u6cd5"})," \u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u6982\u8981",children:"\u6982\u8981"}),"\n",(0,t.jsxs)(n.p,{children:["External Token\u8a8d\u8a3c\u306f\u3001",(0,t.jsx)(n.strong,{children:"\u5916\u90e8\u306e\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30c6\u30a3\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\uff08IdP\uff09\u304c\u767a\u884c\u3057\u305f\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3"}),"\u3092\u4f7f\u3063\u3066\u3001\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u3068\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u53d6\u5f97\u3092\u884c\u3046\u65b9\u5f0f\u3067\u3059\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"\u4e3b\u306a\u7528\u9014",children:"\u4e3b\u306a\u7528\u9014"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4ed6\u306eIdP\uff08Google\u3001Azure AD\u3001\u72ec\u81eaIdP\u7b49\uff09\u3067\u8a8d\u8a3c\u6e08\u307f\u306e\u30e6\u30fc\u30b6\u30fc\u3092\u9023\u643a"}),"\n",(0,t.jsx)(n.li,{children:"\u65e2\u5b58\u30b7\u30b9\u30c6\u30e0\u306e\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u305f\u8a8d\u8a3c"}),"\n",(0,t.jsx)(n.li,{children:"API-to-API\u8a8d\u8a3c\u3067\u306e\u5229\u7528"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u51e6\u7406\u30d5\u30ed\u30fc",children:"\u51e6\u7406\u30d5\u30ed\u30fc"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u5916\u90e8IdP\u304b\u3089\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97"}),"\n",(0,t.jsx)(n.li,{children:"\u305d\u306e\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092idp-server\u306b\u9001\u4fe1"}),"\n",(0,t.jsx)(n.li,{children:"idp-server\u304c\u5916\u90e8API\u306b\u30c8\u30fc\u30af\u30f3\u3092\u9001\u4fe1\u3057\u3066\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u53d6\u5f97"}),"\n",(0,t.jsx)(n.li,{children:"\u53d6\u5f97\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3067idp-server\u5185\u306e\u30e6\u30fc\u30b6\u30fc\u3068\u7d10\u4ed8\u3051"}),"\n",(0,t.jsx)(n.li,{children:"\u8a8d\u8a3c\u6210\u529f"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u8a2d\u5b9a",children:"\u8a2d\u5b9a"}),"\n",(0,t.jsxs)(n.p,{children:["External Token\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u306b\u306f\u3001\u30c6\u30ca\u30f3\u30c8\u306b ",(0,t.jsx)(n.code,{children:'type = "external-token"'})," \u306e\u8a8d\u8a3c\u8a2d\u5b9a\u3092\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"\u57fa\u672c\u69cb\u9020",children:"\u57fa\u672c\u69cb\u9020"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "id": "UUID",\n  "type": "external-token",\n  "attributes": {\n    "service_name": "external-service-name"\n  },\n  "metadata": {},\n  "interactions": {\n    "external-token": {\n      "request": {\n        "schema": {\n          "type": "object",\n          "properties": {\n            "access_token": { "type": "string" }\n          }\n        }\n      },\n      "execution": {\n        "function": "http_requests",\n        "http_requests": [\n          { /* \u30e6\u30fc\u30b6\u30fc\u6982\u8981\u53d6\u5f97API */ },\n          { /* \u30e6\u30fc\u30b6\u30fc\u8a73\u7d30\u53d6\u5f97API */ }\n        ]\n      },\n      "user_resolve": {\n        "user_mapping_rules": [ /* \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u30de\u30c3\u30d4\u30f3\u30b0 */ ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"request-schema",children:"Request Schema"}),"\n",(0,t.jsx)(n.p,{children:"External Token\u8a8d\u8a3c\u3067\u53d7\u3051\u4ed8\u3051\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u69cb\u9020\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "request": {\n    "schema": {\n      "type": "object",\n      "properties": {\n        "access_token": {\n          "type": "string",\n          "description": "\u5916\u90e8IdP\u304c\u767a\u884c\u3057\u305f\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3"\n        }\n      },\n      "required": ["access_token"]\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"execution-\u8907\u6570http\u30ea\u30af\u30a8\u30b9\u30c8",children:"Execution: \u8907\u6570HTTP\u30ea\u30af\u30a8\u30b9\u30c8"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"function"}),": ",(0,t.jsx)(n.code,{children:"http_requests"})]}),"\n",(0,t.jsx)(n.p,{children:"\u8907\u6570\u306e\u5916\u90e8API\u3092\u9023\u7d9a\u3057\u3066\u547c\u3073\u51fa\u3057\u3001\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"http-requests-\u8a2d\u5b9a",children:"HTTP Requests \u8a2d\u5b9a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "execution": {\n    "function": "http_requests",\n    "http_requests": [\n      {\n        "url": "https://external-service.com/user/overview",\n        "method": "POST",\n        "header_mapping_rules": [\n          {\n            "from": "$.request_body.access_token",\n            "to": "x-token",\n            "functions": [\n              { "name": "format", "args": { "template": "Bearer {{value}}" } }\n            ]\n          },\n          {\n            "from": "$.unused",\n            "to": "x-request-id",\n            "functions": [\n              { "name": "random_string", "args": { "length": 6 } },\n              { "name": "format", "args": { "template": "trace-id-{{value}}" } }\n            ]\n          }\n        ],\n        "body_mapping_rules": [\n          { "from": "$.request_body", "to": "*" }\n        ]\n      },\n      {\n        "url": "https://external-service.com/user/details",\n        "method": "POST",\n        "header_mapping_rules": [\n          { "static_value": "your-client-id", "to": "x-client-id" }\n        ],\n        "body_mapping_rules": [\n          {\n            "from": "$.execution_http_requests[0].response_body.id",\n            "to": "user_id"\n          }\n        ]\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u4e3b\u8981\u9805\u76ee",children:"\u4e3b\u8981\u9805\u76ee"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u9805\u76ee"}),(0,t.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"url"})}),(0,t.jsx)(n.td,{children:"\u5916\u90e8API\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"method"})}),(0,t.jsx)(n.td,{children:"HTTP\u30e1\u30bd\u30c3\u30c9\uff08POST/GET\u7b49\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"header_mapping_rules"})}),(0,t.jsx)(n.td,{children:"HTTP\u30d8\u30c3\u30c0\u30fc\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u30eb\u30fc\u30eb"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"body_mapping_rules"})}),(0,t.jsx)(n.td,{children:"\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u30eb\u30fc\u30eb"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"mapping-functions",children:"Mapping Functions"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"header_mapping_rules"}),"\u3068",(0,t.jsx)(n.strong,{children:"body_mapping_rules"}),"\u3067\u30c7\u30fc\u30bf\u5909\u63db\u3092\u884c\u3044\u307e\u3059\uff1a"]}),"\n",(0,t.jsx)(n.h4,{id:"\u30d8\u30c3\u30c0\u30fc\u30de\u30c3\u30d4\u30f3\u30b0\u4f8b",children:"\u30d8\u30c3\u30c0\u30fc\u30de\u30c3\u30d4\u30f3\u30b0\u4f8b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "from": "$.request_body.access_token",\n  "to": "x-token",\n  "functions": [\n    { "name": "format", "args": { "template": "Bearer {{value}}" } }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"from"}),": \u53c2\u7167\u5143\uff08JSONPath\uff09"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"to"}),": \u8a2d\u5b9a\u5148\u30d8\u30c3\u30c0\u30fc\u540d"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"functions"}),": \u9069\u7528\u3059\u308b\u95a2\u6570\u30ea\u30b9\u30c8"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"\u524d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u7d50\u679c\u306e\u53c2\u7167",children:"\u524d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u7d50\u679c\u306e\u53c2\u7167"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "from": "$.execution_http_requests[0].response_body.id",\n  "to": "user_id"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"2\u756a\u76ee\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u30011\u756a\u76ee\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53c2\u7167\u3067\u304d\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"user-resolve-\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u30de\u30c3\u30d4\u30f3\u30b0",children:"User Resolve: \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u30de\u30c3\u30d4\u30f3\u30b0"}),"\n",(0,t.jsx)(n.p,{children:"\u5916\u90e8API\u304b\u3089\u53d6\u5f97\u3057\u305f\u60c5\u5831\u3092\u3001idp-server\u306eUser\u30e2\u30c7\u30eb\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "user_resolve": {\n    "user_mapping_rules": [\n      { "static_value": "external-provider", "to": "provider_id" },\n      { "from": "$.execution_http_requests[0].response_body.id", "to": "external_user_id" },\n      { "from": "$.execution_http_requests[0].response_body.email", "to": "email" },\n      { "from": "$.execution_http_requests[1].response_body.birthdate", "to": "birthdate" },\n      { "from": "$.execution_http_requests[1].response_body.phone_number", "to": "phone_number" },\n      {\n        "from": "$.execution_http_requests[1].response_body.role",\n        "to": "custom_properties.role",\n        "functions": [{ "name": "exists", "args": {} }]\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"user-mapping-rules",children:"User Mapping Rules"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u9805\u76ee"}),(0,t.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"from"})}),(0,t.jsxs)(n.td,{children:["\u53c2\u7167\u5143\uff08JSONPath\uff09\u3002",(0,t.jsx)(n.code,{children:"$.execution_http_requests[N].response_body.*"}),"\u3067\u524d\u306eHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53c2\u7167"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"to"})}),(0,t.jsx)(n.td,{children:"\u30de\u30c3\u30d4\u30f3\u30b0\u5148\uff08User model \u306e\u30d5\u30a3\u30fc\u30eb\u30c9\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"static_value"})}),(0,t.jsx)(n.td,{children:"\u56fa\u5b9a\u5024\u306e\u8a2d\u5b9a"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"functions"})}),(0,t.jsx)(n.td,{children:"\u9069\u7528\u3059\u308b\u95a2\u6570\u30ea\u30b9\u30c8\uff08exists, format\u7b49\uff09"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"\u30de\u30c3\u30d4\u30f3\u30b0\u5148\u30d5\u30a3\u30fc\u30eb\u30c9",children:"\u30de\u30c3\u30d4\u30f3\u30b0\u5148\u30d5\u30a3\u30fc\u30eb\u30c9"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u30d5\u30a3\u30fc\u30eb\u30c9"}),(0,t.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"provider_id"})}),(0,t.jsx)(n.td,{children:"\u30d7\u30ed\u30d0\u30a4\u30c0\u30fcID\uff08\u5916\u90e8IdP\u8b58\u5225\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_user_id"})}),(0,t.jsx)(n.td,{children:"\u5916\u90e8\u30b7\u30b9\u30c6\u30e0\u306e\u30e6\u30fc\u30b6\u30fcID"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"email"})}),(0,t.jsx)(n.td,{children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"name"})}),(0,t.jsx)(n.td,{children:"\u8868\u793a\u540d"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"birthdate"})}),(0,t.jsx)(n.td,{children:"\u751f\u5e74\u6708\u65e5"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"phone_number"})}),(0,t.jsx)(n.td,{children:"\u96fb\u8a71\u756a\u53f7"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"custom_properties.*"})}),(0,t.jsx)(n.td,{children:"\u30ab\u30b9\u30bf\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8b",children:"\u5b8c\u5168\u306a\u8a2d\u5b9a\u4f8b"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u60c5\u5831\u6e90"}),": ",(0,t.jsx)(n.code,{children:"config/examples/e2e/test-tenant/authentication-config/external-token/mocky.json"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "id": "5ee62e7d-e1f0-4f38-b714-0c5d6a28d8f1",\n  "type": "external-token",\n  "attributes": {\n    "service_name": "mock"\n  },\n  "metadata": {},\n  "interactions": {\n    "external-token": {\n      "request": {\n        "schema": {\n          "type": "object",\n          "properties": {\n            "access_token": { "type": "string" }\n          }\n        }\n      },\n      "execution": {\n        "function": "http_requests",\n        "http_requests": [\n          {\n            "url": "http://host.docker.internal:4000/user/overview",\n            "method": "POST",\n            "header_mapping_rules": [\n              {\n                "from": "$.request_body.access_token",\n                "to": "x-token",\n                "convertType": "string",\n                "functions": [\n                  { "name": "format", "args": { "template": "Bearer {{value}}" } }\n                ]\n              },\n              {\n                "from": "$.unused",\n                "to": "x-request-id",\n                "functions": [\n                  { "name": "random_string", "args": { "length": 6 } },\n                  { "name": "format", "args": { "template": "trace-id-{{value}}" } }\n                ]\n              },\n              {\n                "from": "$.unused",\n                "to": "issued_at",\n                "functions": [\n                  { "name": "now", "args": { "zone": "Asia/Tokyo", "pattern": "yyyy-MM-dd HH:mm:ss" } }\n                ]\n              }\n            ],\n            "body_mapping_rules": [\n              { "from": "$.request_body", "to": "*" }\n            ]\n          },\n          {\n            "url": "http://host.docker.internal:4000/user/details",\n            "method": "POST",\n            "header_mapping_rules": [\n              { "static_value": "test-client-id", "to": "x-client-id" },\n              {\n                "from": "$.unused",\n                "to": "x-request-id",\n                "functions": [\n                  { "name": "randomString", "args": { "length": 6 } },\n                  { "name": "format", "args": { "template": "trace-id-{{value}}" } }\n                ]\n              }\n            ],\n            "body_mapping_rules": [\n              { "from": "$.execution_http_requests[0].response_body.id", "to": "user_id" }\n            ]\n          }\n        ]\n      },\n      "user_resolve": {\n        "user_mapping_rules": [\n          { "static_value": "mock-provider", "to": "provider_id" },\n          { "from": "$.execution_http_requests[0].response_body.id", "to": "external_user_id" },\n          { "from": "$.execution_http_requests[0].response_body.email", "to": "email" },\n          { "from": "$.execution_http_requests[1].response_body.birthdate", "to": "birthdate" },\n          { "from": "$.execution_http_requests[1].response_body.zoneinfo", "to": "zoneinfo" },\n          { "from": "$.execution_http_requests[1].response_body.locale", "to": "locale" },\n          { "from": "$.execution_http_requests[1].response_body.phone_number", "to": "phone_number" },\n          {\n            "from": "$.execution_http_requests[1].response_body.role",\n            "to": "custom_properties.role",\n            "functions": [{ "name": "exists", "args": {} }]\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u5229\u7528\u65b9\u6cd5",children:"\u5229\u7528\u65b9\u6cd5"}),"\n",(0,t.jsx)(n.h3,{id:"\u4e8b\u524d\u6e96\u5099",children:"\u4e8b\u524d\u6e96\u5099"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\u30c6\u30ca\u30f3\u30c8\u306b ",(0,t.jsx)(n.code,{children:'type = "external-token"'})," \u306e\u8a8d\u8a3c\u8a2d\u5b9a\u3092\u767b\u9332\u3059\u308b\uff08\u4e0a\u8a18\u8a2d\u5b9a\u4f8b\u3092\u53c2\u7167\uff09"]}),"\n",(0,t.jsx)(n.li,{children:"\u5916\u90e8IdP\u306eAPI\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u69cb\u9020\u3092\u78ba\u8a8d"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u8a8d\u8a3c\u30d5\u30ed\u30fc",children:"\u8a8d\u8a3c\u30d5\u30ed\u30fc"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u5916\u90e8IdP\u3067\u8a8d\u8a3c\u3057\u3001\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97"}),"\n",(0,t.jsx)(n.li,{children:"\u8a8d\u53ef\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5bfe\u5fdc\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306bPOST\u3059\u308b\uff1a"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"POST /v1/authorizations/{id}/external-token\nContent-Type: application/json\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u4f8b"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."\n}\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"idp-server\u304c\u8a2d\u5b9a\u306b\u5f93\u3063\u3066\u5916\u90e8API\u3092\u547c\u3073\u51fa\u3057\u3001\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u53d6\u5f97"}),"\n",(0,t.jsx)(n.li,{children:"\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u3001idp-server\u5185\u306e\u30e6\u30fc\u30b6\u30fc\u3068\u7d10\u4ed8\u3051"}),"\n",(0,t.jsx)(n.li,{children:"\u8a8d\u8a3c\u6210\u529f"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u5185\u90e8\u30ed\u30b8\u30c3\u30af",children:"\u5185\u90e8\u30ed\u30b8\u30c3\u30af"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5b9f\u88c5"}),": ",(0,t.jsx)(n.code,{children:"ExternalTokenAuthenticationInteractor.java"})]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u8a2d\u5b9a\u53d6\u5f97"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:'AuthenticationConfigurationQueryRepository.get(tenant, "external-token")'})}),"\n",(0,t.jsx)(n.li,{children:"\u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306eexternal-token\u8a2d\u5b9a\u3092\u53d6\u5f97"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"HTTP Requests\u5b9f\u884c"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u8a2d\u5b9a\u3055\u308c\u305f\u8907\u6570\u306eHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9806\u6b21\u5b9f\u884c"}),"\n",(0,t.jsx)(n.li,{children:"\u524d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u6b21\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u53c2\u7167\u53ef\u80fd"}),"\n",(0,t.jsx)(n.li,{children:"Mapping Functions\u3067\u30d8\u30c3\u30c0\u30fc\u30fb\u30dc\u30c7\u30a3\u3092\u52d5\u7684\u751f\u6210"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"User Resolve"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user_mapping_rules"}),"\u306b\u5f93\u3063\u3066\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u30de\u30c3\u30d4\u30f3\u30b0"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"provider_id"}),"\u3068",(0,t.jsx)(n.code,{children:"external_user_id"}),"\u3067\u30e6\u30fc\u30b6\u30fc\u3092\u8b58\u5225"]}),"\n",(0,t.jsx)(n.li,{children:"\u5b58\u5728\u3057\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u306f\u65b0\u898f\u4f5c\u6210\uff08\u8a2d\u5b9a\u306b\u3088\u308a\u5236\u5fa1\u53ef\u80fd\uff09"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u8a8d\u8a3c\u6210\u529f\u51e6\u7406"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"User"}),"\u3068",(0,t.jsx)(n.code,{children:"Authentication"}),"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8fd4\u5374"]}),"\n",(0,t.jsx)(n.li,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\u767a\u884c"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"mapping-functions\u6d3b\u7528\u4f8b",children:"Mapping Functions\u6d3b\u7528\u4f8b"}),"\n",(0,t.jsx)(n.h3,{id:"\u52d5\u7684\u30d8\u30c3\u30c0\u30fc\u751f\u6210",children:"\u52d5\u7684\u30d8\u30c3\u30c0\u30fc\u751f\u6210"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "from": "$.request_body.access_token",\n  "to": "x-token",\n  "functions": [\n    { "name": "format", "args": { "template": "Bearer {{value}}" } }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092",(0,t.jsx)(n.code,{children:"Bearer {token}"}),"\u5f62\u5f0f\u306b\u5909\u63db\u3057\u3066\u30d8\u30c3\u30c0\u30fc\u306b\u8a2d\u5b9a"]}),"\n",(0,t.jsx)(n.h3,{id:"\u30ea\u30af\u30a8\u30b9\u30c8id\u751f\u6210",children:"\u30ea\u30af\u30a8\u30b9\u30c8ID\u751f\u6210"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "from": "$.unused",\n  "to": "x-request-id",\n  "functions": [\n    { "name": "random_string", "args": { "length": 6 } },\n    { "name": "format", "args": { "template": "trace-id-{{value}}" } }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u30e9\u30f3\u30c0\u30e0\u306a6\u6587\u5b57\u3092\u751f\u6210\u3057\u3001",(0,t.jsx)(n.code,{children:"trace-id-ABC123"}),"\u5f62\u5f0f\u306e\u30ea\u30af\u30a8\u30b9\u30c8ID\u3092\u4f5c\u6210"]}),"\n",(0,t.jsx)(n.h3,{id:"\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u751f\u6210",children:"\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u751f\u6210"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "from": "$.unused",\n  "to": "issued_at",\n  "functions": [\n    { "name": "now", "args": { "zone": "Asia/Tokyo", "pattern": "yyyy-MM-dd HH:mm:ss" } }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u73fe\u5728\u6642\u523b\u3092\u6307\u5b9a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u751f\u6210"}),"\n",(0,t.jsx)(n.h3,{id:"\u524d\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u53c2\u7167",children:"\u524d\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u53c2\u7167"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "from": "$.execution_http_requests[0].response_body.id",\n  "to": "user_id"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["1\u756a\u76ee\u306eHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304b\u3089",(0,t.jsx)(n.code,{children:"id"}),"\u3092\u62bd\u51fa"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u5099\u8003",children:"\u5099\u8003"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"provider_id"}),": \u5916\u90e8IdP\u3054\u3068\u306b\u7570\u306a\u308b\u5024\u3092\u8a2d\u5b9a\uff08\u30e6\u30fc\u30b6\u30fc\u306e\u4e00\u610f\u8b58\u5225\u306b\u4f7f\u7528\uff09"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u8907\u6570API\u547c\u3073\u51fa\u3057"}),": ",(0,t.jsx)(n.code,{children:"http_requests"}),"\u914d\u5217\u3067\u9806\u6b21\u5b9f\u884c"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mapping Functions"}),": 19\u500b\u306e\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u67d4\u8edf\u306a\u30c7\u30fc\u30bf\u5909\u63db\u304c\u53ef\u80fd"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"}),": \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u306e\u691c\u8a3c\u306f\u5916\u90e8API\u306b\u59d4\u8b72"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"../04-implementation-guides/impl-20-mapping-functions.md",children:"Mapping Functions \u958b\u767a\u30ac\u30a4\u30c9"})," - 19\u500b\u306e\u5909\u63db\u95a2\u6570\u306e\u8a73\u7d30"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"../04-implementation-guides/impl-16-http-request-executor.md",children:"HTTP Request Executor"})," - HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\u306e\u8a73\u7d30"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"../04-implementation-guides/impl-17-external-integration.md",children:"External Integration"})," - \u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u9023\u643a\u30d1\u30bf\u30fc\u30f3"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u60c5\u5831\u6e90"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"config/examples/e2e/test-tenant/authentication-config/external-token/mocky.json"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"libs/idp-server-authentication-interactors/src/main/java/org/idp/server/authentication/interactors/external_token/ExternalTokenAuthenticationInteractor.java"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6700\u7d42\u66f4\u65b0"}),": 2025-12-08\n",(0,t.jsx)(n.strong,{children:"\u4f5c\u6210\u8005"}),": Claude Code\uff08AI\u958b\u767a\u652f\u63f4\uff09"]})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var r=s(96540);const t={},i=r.createContext(t);function d(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);