openapi: 3.0.3
info:
  title: リソースオーナー用API
  version: 1.0.0
tags:
  - name: ユーザー
    description: |
      リソースオーナー（ユーザー）本人による操作に関するAPI群。

      主に以下のような操作を提供します：
       - 自身のアカウント削除
       - 多要素認証（MFA）の登録要求（FIDO-UAF など）

      アクセストークンを用いて、ユーザー本人による安全な自己操作を実現します。
  - name: 身元確認申込み
    description: >
      `idp-server` は身元確認済みID（verified
      ID）を提供するために、外部のサービスと連携した申込み・審査・完了登録の一連のフローを管理できます。


      このAPIを利用することで、ユーザーから収集した情報を外部の身元確認サービスに送信し、確認済みクレーム（`verified_claims`）として
      `idp-server` に反映できます。


      - Control Plane APIでテンプレートを登録

      - ユーザーが申込みを行うと、テンプレートに従い外部APIと連携

      - コールバック等で審査結果・verified_claims登録用データを受信

      - 認証時、verified_claimsを含んだIDトークンやUserInfoを返却


      テンプレートでは各種マッピングルール、JSON Schemaによるバリデーション、外部APIとの連携方式（OAuth2, HMAC,
      なし）を柔軟に定義可能です。


      アクセストークンを用いて、ユーザー本人による安全な自己操作を実現します。
  - name: 身元確認結果
    description: |
      身元確認結果を確認するためのAPI
      アクセストークンを用いて、ユーザー本人による安全な自己操作を実現します。
paths:
  /{tenant-id}/v1/me:
    delete:
      tags:
        - ユーザー
      summary: ユーザー削除
      description: |
        ユーザー（リソースオーナー）自身の削除を行う。
      parameters:
        - $ref: '#/components/parameters/TenantId'
      responses:
        '204':
          description: User deleted
          content:
            application/json:
              schema:
                type: object
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /{tenant-id}/v1/me/mfa/{mfa-operation-type}:
    post:
      tags:
        - ユーザー
      summary: MFAの登録要求
      description: |
        FIDO-UAFなどの登録要求の依頼を行う。
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/MfaOperationType'
      requestBody:
        required: false
        description: MFAの仕様に応じたパラメータをBodyに設定する。
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/FidoUafRegistrationRequest'
                - $ref: '#/components/schemas/FidoUafDeRegistrationRequest'
      responses:
        '200':
          description: Operation requested
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                properties:
                  id:
                    type: string
                    description: 認証トランザクションID
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /{tenant-id}/v1/me/authentication-devices/{device-id}:
    patch:
      tags:
        - ユーザー
      summary: 認証デバイス部分更新API
      description: |
        認証デバイスの属性情報の部分更新の依頼を行う。
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/DeviceId'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthenticationDeviceRequest'
      responses:
        '200':
          description: 200 OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /{tenant-id}/v1/me/identity-verification/applications/{verification-type}/{verification-process}:
    post:
      tags:
        - 身元確認申込み
      security:
        - OAuth2:
            - identity_verification_application
      summary: 身元確認申込み
      description: >
        指定された verification-type（テンプレート種別）および verification-process（申込み処理タイプ）に従い、

        身元確認申込みの初期リクエストを実行します。


        レスポンスに後続で利用するidが返却されます。


        このAPIは、あらかじめ Control Plane API により定義されたテンプレートに基づいて外部サービスに対して申請データを送信し、

        審査プロセスの開始またはeKYCプロセスの起動を行います。


        - `verification-type` はテンプレートの `type` に対応

        - `verification-process` はテンプレート内の `processes` のキーに対応（例: apply,
        request-ekyc など）


        リクエストボディはテンプレートで定義された `request.schema` に基づいてバリデーションされ、

        必須項目の漏れや形式の不正がある場合はエラーになります。


        正常に処理された場合は、`response.body_mapping_rules` に従いレスポンスを返却します。
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/VerificationType'
        - $ref: '#/components/parameters/VerificationProcess'
      requestBody:
        required: false
        description: |
          テンプレートで定義されたスキーマに従うリクエストボディ。
          内容は `verification-type` および `verification-process` ごとに異なる。
        content:
          application/json:
            schema:
              type: object
              additionalProperties: null
            example:
              last_name: 伊藤
              first_name: 一朗
              birthdate: '1990-01-01'
              email_address: ichiro@example.com
      responses:
        '200':
          description: 申込み成功時のレスポンス
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                properties:
                  id:
                    type: string
                    description: |
                      後続で利用する身元確認申込の識別子。
                additionalProperties:
                  description: 設定ファイルの `response` に設定した項目が返却される
              example:
                id: 565b030e-04b5-45eb-989e-136e3623dc7d
                application_number: abcdefg012345
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '408':
          $ref: '#/components/responses/RequestTimeout'
        '409':
          $ref: '#/components/responses/Conflict'
        '413':
          $ref: '#/components/responses/PayloadTooLarge'
        '415':
          $ref: '#/components/responses/UnsupportedMediaType'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '502':
          $ref: '#/components/responses/BadGateway'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
        '504':
          $ref: '#/components/responses/GatewayTimeout'
  /{tenant-id}/v1/me/identity-verification/applications:
    get:
      tags:
        - 身元確認申込み
      security:
        - OAuth2:
            - identity_verification_application
      summary: 身元確認申込み一覧取得
      description: |
        身元確認の申込みの一覧を取得する。
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - name: id
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: 身元確認申請のID（UUID形式）での絞り込み
        - name: type
          in: query
          required: false
          schema:
            type: string
          description: 申込み種別（verification-type）での絞り込み
        - name: client_id
          in: query
          required: false
          schema:
            type: string
          description: 申請時に使用されたクライアントID
        - name: status
          in: query
          required: false
          schema:
            type: string
          description: |
            申請のステータス
        - in: query
          name: application_details.<key>
          schema:
            type: string
          description: 申込み詳細情報のオブジェクトのkeyに対する検索（keyは具体的な値の設定が必要）
        - in: query
          name: external_application_details.<key>
          schema:
            type: string
          description: 外部申込み結果の詳細情報のオブジェクトのkeyに対する検索（keyは具体的な値の設定が必要）
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: 絞り込み開始日時（ISO 8601形式）
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: 絞り込み終了日時（ISO 8601形式）
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: 取得件数の上限（デフォルトは20件）
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: ページネーション用のオフセット（デフォルトは0）
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  list:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          description: 申込みID
                        tenant_id:
                          type: string
                          format: uuid
                          description: テナントID
                        user_id:
                          type: string
                          format: uuid
                          description: ユーザーID
                        type:
                          type: string
                          description: 申込み種別（verification-type）
                        client_id:
                          type: string
                          description: クライアントID
                        application_details:
                          type: object
                          description: |
                            申込みの詳細情報。storeの設定に応じて保存したデータ。
                        processes:
                          type: object
                          additionalProperties:
                            type: object
                            properties:
                              call_count:
                                type: integer
                              success_count:
                                type: integer
                              failure_count:
                                type: integer
                        attributes:
                          type: object
                          description: |
                            申込みの属性情報。attributesに設定したデータ。
                        status:
                          type: string
                          description: >
                            現在のステータス


                            | ステータス名                   |
                            説明                                                            
                            |

                            |--------------------------|----------------------------------------------------------------|

                            | `requested`              |
                            申請リクエストが正常に受理された直後の状態です。                                      
                            |

                            | `applying`               |
                            ユーザーまたは外部システムが必要な情報を入力・収集中の状態です。フォーム入力中や追加書類のアップロード待ちなどが該当します。
                            |

                            | `applied`                |
                            申請情報の送信が完了し、審査待ちの状態です。全ての申込み処理が終了した後に遷移します。                 
                            |

                            | `examination_processing` |
                            申請内容に対する審査が実施されている状態です。外部eKYCサービスとの連携や人手による審査が行われている場合も含まれます。 
                            |

                            | `approved`               |
                            審査の結果、申請が承認された状態です。ユーザーの身元確認が完了し、検証済みクレームの登録などが行われます。         
                            |

                            | `rejected`               |
                            審査の結果、申請が却下された状態です。必要に応じて理由の提示や再申請の導線提示が推奨されます。               
                            |

                            | `expired`                |
                            有効期限切れなどにより、申請が無効となった状態です。一定期間操作が行われなかった場合などに自動的に遷移することがあります。 
                            |

                            | `cancelled`              |
                            ユーザーまたは管理者によって申請が任意に中断された状態です。取り下げやキャンセル操作などが該当します。           
                            |

                            | `unknown`                |
                            状態が特定できない不明な状態です。移行中やデータ不整合、バージョン差異等により例外的に発生する可能性があります。      
                            |
                          enum:
                            - requested
                            - applying
                            - applied
                            - examination_processing
                            - approved
                            - rejected
                            - expired
                            - cancelled
                            - unknown
                        requested_at:
                          type: string
                          format: date-time
                          description: 申請が行われた日時
                  total_count:
                    type: integer
                    description: 申込の総数
                  limit:
                    type: integer
                    description: 取得件数の上限
                  offset:
                    type: integer
                    description: ページネーション用のオフセット
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /{tenant-id}/v1/me/identity-verification/applications/{verification-type}/{id}/{verification-process}:
    post:
      tags:
        - 身元確認申込み
      security:
        - OAuth2:
            - identity_verification_application
      summary: 身元確認申込み後続処理
      description: >
        既存の身元確認申込み（application）に対して、定義済みテンプレートおよびプロセスに従った後続の処理を実行します。


        このAPIは、初回申込み（apply等）によって発行された申込みID（`id`）を指定し、

        対象となる申込みに対して、eKYC完了通知・審査要求・外部サービスとの再連携などのアクションを柔軟に実行可能です。


        - `verification-type` はテンプレートの `type` に対応

        - `id` は既存の申込みIDを指定

        - `verification-process` はテンプレートの `processes` 内で定義された処理（例:
        `complete-ekyc`, `callback-result`）


        リクエストボディは、該当プロセスで必要とされる `request.schema` に基づいてバリデーションされ、

        外部サービスとの連携や verified_claims 登録等が自動的に実行されます。


        正常に処理された場合は、`response.body_mapping_rules` に従いレスポンスを返却します。
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/VerificationType'
        - $ref: '#/components/parameters/ApplicationId'
        - $ref: '#/components/parameters/VerificationProcess'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Processed
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  description: |
                    設定ファイルの `response` に設定した項目が返却される
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '408':
          $ref: '#/components/responses/RequestTimeout'
        '413':
          $ref: '#/components/responses/PayloadTooLarge'
        '415':
          $ref: '#/components/responses/UnsupportedMediaType'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '502':
          $ref: '#/components/responses/BadGateway'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
        '504':
          $ref: '#/components/responses/GatewayTimeout'
  /{tenant-id}/v1/me/identity-verification/applications/{verification-type}/{id}:
    delete:
      tags:
        - 身元確認申込み
      security:
        - OAuth2:
            - identity_verification_application_delete
      summary: 身元確認申込み削除
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/VerificationType'
        - $ref: '#/components/parameters/ApplicationId'
      responses:
        '204':
          description: No Content
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /{tenant-id}/v1/me/identity-verification/results:
    get:
      tags:
        - 身元確認結果
      security:
        - OAuth2:
            - identity-verification-result
      summary: 身元確認結果の一覧取得
      description: |
        身元確認結果の一覧を取得します。
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - name: id
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: 身元確認結果のID（UUID形式）での絞り込み
        - name: application_id
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: 身元確認申込みのID（UUID形式）での絞り込み
        - name: type
          in: query
          required: false
          schema:
            type: string
          description: 申込み種別（verification-type）での絞り込み
        - name: external_application_id
          in: query
          required: false
          schema:
            type: string
          description: 外部連携先の申請ID
        - name: external_service
          in: query
          required: false
          schema:
            type: string
          description: 連携先の外部サービス名
        - in: query
          name: verified_claims.<key>
          schema:
            type: string
          description: verified_claimsのオブジェクトのkeyに対する検索（keyは具体的な値の設定が必要）
        - name: verified_at_from
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: verified_atに対する絞り込み 開始日時（ISO 8601形式）
        - name: verified_at_to
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: verified_atに対する絞り込み 終了日時（ISO 8601形式）
        - name: verified_until_from
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: verified_untilに対する絞り込み 開始日時（ISO 8601形式）
        - name: verified_until_to
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: verified_untilに対する絞り込み 終了日時（ISO 8601形式）
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: 取得件数の上限（デフォルトは20件）
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: ページネーション用のオフセット（デフォルトは0）
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  list:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          description: 身元確認結果のID
                        tenant_id:
                          type: string
                          format: uuid
                          description: テナントID
                        user_id:
                          type: string
                          format: uuid
                          description: ユーザーID
                        application_id:
                          type: string
                          format: uuid
                          description: 元となる申請のID
                        type:
                          type: string
                          description: 申込み種別（verification-type）
                        verified_at:
                          type: string
                          format: date-time
                          description: 身元確認が完了した日時
                        verified_until:
                          type: string
                          format: date-time
                          nullable: true
                          description: 身元確認が有効な期限（省略可能）
                        source:
                          type: string
                          description: |
                            結果の生成元（例: application）
                        source_details:
                          type: object
                          description: |
                            設定の `result.source_details` に定義したデータ。
                        attributes:
                          type: object
                          description: |
                            身元確認の属性情報。設定のattributesが登録される。
                        verified_claims:
                          type: object
                          description: |
                            設定の `result.verified_claims` に定義したデータ。IDA準拠を想定。
                          properties:
                            claims:
                              type: object
                            verification:
                              type: object
                  total_count:
                    type: integer
                    description: 身元確認結果の総数
                  limit:
                    type: integer
                    description: 取得件数の上限
                  offset:
                    type: integer
                    description: ページネーション用のオフセット
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  responses:
    BadRequest:
      description: |
        リクエストパラメータが不正、検証エラー、プロセスシーケンスエラー
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: invalid_request
              error_description:
                type: string
                example: Request validation failed
              error_messages:
                type: array
                items:
                  type: string
                description: |
                  検証エラーの詳細メッセージ配列（JSON Schema検証エラー、プロセスシーケンスエラー等）。オプショナル。
              error_details:
                type: object
                description: |
                  外部サービス実行時のエラー詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    description: 実行タイプ
                    example: http_request
                  status_category:
                    type: string
                    description: HTTPステータスカテゴリ
                    enum:
                      - client_error
                      - server_error
                  status_code:
                    type: integer
                    description: 外部サービスから返されたHTTPステータスコード
                    example: 400
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            schema_validation_error:
              value:
                error: invalid_request
                error_description: >-
                  The identity verification request is invalid. Please review
                  your input for missing or incorrect fields.
                error_messages:
                  - last_name is missing
                  - first_name is missing
                  - birthdate is missing
            type_mismatch_error:
              value:
                error: invalid_request
                error_description: >-
                  The identity verification request is invalid. Please review
                  your input for missing or incorrect fields.
                error_messages:
                  - age is not a integer
                  - address is not a object
            process_sequence_error:
              value:
                error: invalid_request
                error_description: Process sequence violation
                error_messages:
                  - >-
                    process 'complete-verification' is not available at current
                    state
            external_service_400:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 400: invalid_request'
                error_details:
                  execution_type: http_request
                  status_category: client_error
                  status_code: 400
                  response_body:
                    error: invalid_request
                    error_description: >-
                      The request is missing required parameters or contains
                      invalid values
    Unauthorized:
      description: |
        認証エラー。アクセストークンが無効または期限切れ、または外部サービスから401エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: invalid_token
                description: >
                  エラーコード。`invalid_token`（アクセストークンが無効または期限切れ）または
                  `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: The access token is invalid or expired
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: client_error
                  status_code:
                    type: integer
                    example: 401
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            invalid_token:
              value:
                error: invalid_token
                error_description: The access token is invalid or expired
            external_service_401:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 401: invalid_token'
                error_details:
                  execution_type: http_request
                  status_category: client_error
                  status_code: 401
                  response_body:
                    error: invalid_token
                    error_description: The access token provided is invalid or expired
    Forbidden:
      description: |
        権限エラー。スコープ不足、または外部サービスから403エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: insufficient_scope
                description: >
                  エラーコード。`insufficient_scope`（スコープ不足）または
                  `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: >-
                  The request requires higher privileges than provided by the
                  access token
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: client_error
                  status_code:
                    type: integer
                    example: 403
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            insufficient_scope:
              value:
                error: insufficient_scope
                error_description: >-
                  The request requires higher privileges than provided by the
                  access token
            external_service_403:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 403: insufficient_scope'
                error_details:
                  execution_type: http_request
                  status_category: client_error
                  status_code: 403
                  response_body:
                    error: insufficient_scope
                    error_description: The request requires specific permissions
                    scope: identity_verification_application_delete
    NotFound:
      description: |
        リソースが存在しない
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: invalid_request
                description: |
                  エラーコード（実装では `invalid_request` を使用）
              error_description:
                type: string
                example: The requested resource was not found
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
          examples:
            application_not_found:
              value:
                error: invalid_request
                error_description: identity verification application not found
                error_messages:
                  - identity verification application not found
    RequestTimeout:
      description: |
        リクエストタイムアウト、または外部サービスから408エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: request_timeout
                description: >
                  エラーコード。`request_timeout`（内部エラー）または
                  `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: The request timed out
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: client_error
                  status_code:
                    type: integer
                    example: 408
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            request_timeout:
              value:
                error: request_timeout
                error_description: The request timed out
            external_service_408:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 408: request_timeout'
                error_details:
                  execution_type: http_request
                  status_category: client_error
                  status_code: 408
                  response_body:
                    error: request_timeout
                    error_description: The server timed out waiting for the request
                    timeout_seconds: 30
    Conflict:
      description: |
        リソースの状態が競合している
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: conflict
              error_description:
                type: string
                example: A verification application is already in progress
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
    PayloadTooLarge:
      description: |
        ペイロードが大きすぎる、または外部サービスから413エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: payload_too_large
                description: >
                  エラーコード。`payload_too_large`（内部エラー）または
                  `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: The request payload is too large
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: client_error
                  status_code:
                    type: integer
                    example: 413
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            payload_too_large:
              value:
                error: payload_too_large
                error_description: The request payload is too large
            external_service_413:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 413: payload_too_large'
                error_details:
                  execution_type: http_request
                  status_category: client_error
                  status_code: 413
                  response_body:
                    error: payload_too_large
                    error_description: The request payload exceeds the maximum allowed size
                    max_size_bytes: 5242880
                    received_size_bytes: 10485760
    UnsupportedMediaType:
      description: |
        サポートされていないメディアタイプ、または外部サービスから415エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: unsupported_media_type
                description: >
                  エラーコード。`unsupported_media_type`（内部エラー）または
                  `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: The media type is not supported
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: client_error
                  status_code:
                    type: integer
                    example: 415
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            unsupported_media_type:
              value:
                error: unsupported_media_type
                error_description: The media type is not supported
            external_service_415:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 415: unsupported_media_type'
                error_details:
                  execution_type: http_request
                  status_category: client_error
                  status_code: 415
                  response_body:
                    error: unsupported_media_type
                    error_description: The media type is not supported
                    supported_types:
                      - image/png
                      - image/jpeg
                    received_type: image/gif
    UnprocessableEntity:
      description: |
        バリデーションエラー、または外部サービスから422エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: validation_error
                description: >
                  エラーコード。`validation_error`（内部エラー）または
                  `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: The request data failed validation
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: client_error
                  status_code:
                    type: integer
                    example: 422
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            validation_error:
              value:
                error: validation_error
                error_description: The request data failed validation
            external_service_422:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 422: validation_error'
                error_details:
                  execution_type: http_request
                  status_category: client_error
                  status_code: 422
                  response_body:
                    error: validation_error
                    error_description: The request data failed validation
                    validation_errors:
                      - field: birthdate
                        message: Invalid date format. Expected YYYY-MM-DD
                      - field: document_number
                        message: Document number contains invalid characters
    TooManyRequests:
      description: |
        レート制限超過
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: too_many_requests
              error_description:
                type: string
                example: Too many requests. Please try again later.
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              retry_after:
                type: integer
                example: 60
                description: リトライ推奨待機秒数
    InternalServerError:
      description: |
        サーバー内部エラー、または外部サービスから500エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: server_error
                description: |
                  エラーコード。`server_error`（内部エラー）または `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: An internal server error occurred
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: server_error
                  status_code:
                    type: integer
                    example: 500
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            internal_error:
              value:
                error: server_error
                error_description: An internal server error occurred
            external_service_500:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 500: server_error'
                error_details:
                  execution_type: http_request
                  status_category: server_error
                  status_code: 500
                  response_body:
                    error: server_error
                    error_description: An unexpected error occurred on the external service
                    error_id: err_abc123xyz
    BadGateway:
      description: |
        ゲートウェイエラー、または外部サービスから502エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: bad_gateway
                description: |
                  エラーコード。`bad_gateway`（内部エラー）または `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: The upstream server returned an invalid response
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: server_error
                  status_code:
                    type: integer
                    example: 502
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            bad_gateway:
              value:
                error: bad_gateway
                error_description: The upstream server returned an invalid response
            external_service_502:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 502: bad_gateway'
                error_details:
                  execution_type: http_request
                  status_category: server_error
                  status_code: 502
                  response_body:
                    error: bad_gateway
                    error_description: The upstream server returned an invalid response
                    upstream_error: Connection refused
    ServiceUnavailable:
      description: |
        サービス一時利用不可、または外部サービスから503エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: service_unavailable
                description: >
                  エラーコード。`service_unavailable`（内部エラー）または
                  `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: >-
                  The service is temporarily unavailable. Please try again
                  later.
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: server_error
                  status_code:
                    type: integer
                    example: 503
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            service_unavailable:
              value:
                error: service_unavailable
                error_description: >-
                  The service is temporarily unavailable. Please try again
                  later.
            external_service_503:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 503: service_unavailable'
                error_details:
                  execution_type: http_request
                  status_category: server_error
                  status_code: 503
                  response_body:
                    error: service_unavailable
                    error_description: >-
                      The external service is temporarily unavailable. Please
                      retry after some time.
                    retryable: true
                    retry_after: 60
    GatewayTimeout:
      description: |
        外部サービスタイムアウト、または外部サービスから504エラーが返された場合
      content:
        application/json:
          schema:
            type: object
            required:
              - error
              - error_description
            properties:
              error:
                type: string
                example: gateway_timeout
                description: >
                  エラーコード。`gateway_timeout`（内部エラー）または
                  `execution_failed`（外部サービスエラー）
              error_description:
                type: string
                example: The external service request timed out
              error_messages:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列。オプショナル。
              error_details:
                type: object
                description: 外部サービスエラー時の詳細情報（execution_failed の場合のみ）。オプショナル。
                required:
                  - execution_type
                  - status_category
                  - status_code
                properties:
                  execution_type:
                    type: string
                    example: http_request
                  status_category:
                    type: string
                    example: server_error
                  status_code:
                    type: integer
                    example: 504
                  response_body:
                    type: object
                    description: 外部サービスのレスポンスボディ（オプショナル）
          examples:
            gateway_timeout:
              value:
                error: gateway_timeout
                error_description: The external service request timed out
            external_service_504:
              value:
                error: execution_failed
                error_description: execution failed
                error_messages:
                  - 'External service returned 504: gateway_timeout'
                error_details:
                  execution_type: http_request
                  status_category: server_error
                  status_code: 504
                  response_body:
                    error: gateway_timeout
                    error_description: >-
                      The gateway did not receive a timely response from the
                      upstream server
                    timeout_seconds: 30
  securitySchemes:
    OAuth2:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://xxx/{tenant-id}/v1/authorizations
          tokenUrl: https://xxx/{tenant-id}/v1//tokens
          scopes:
            identity_verification_application: 身元確認の申込みのAPIに必要なスコープ
            identity_verification_application_delete: 身元確認の申込みの削除スコープ
            identity_verification_result: 身元確認結果のAPIに必要なスコープ
  parameters:
    TenantId:
      name: tenant-id
      in: path
      required: true
      schema:
        type: string
    MfaOperationType:
      name: mfa-operation-type
      in: path
      required: true
      schema:
        type: string
        example: fido-uaf-registration
    DeviceId:
      name: device-id
      in: path
      required: true
      schema:
        type: string
        example: 0048607e-9b89-4ad9-a203-976b7f72f5f2
    VerificationType:
      name: verification-type
      in: path
      required: true
      schema:
        type: string
        example: my_number
    VerificationProcess:
      name: verification-process
      in: path
      required: true
      schema:
        type: string
        example: capture
    ApplicationId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
  schemas:
    FidoUafRegistrationRequest:
      description: FIDO-UAF登録用のリクエスト
      allOf:
        - $ref: '#/components/schemas/AuthenticationDeviceRequest'
    FidoUafDeRegistrationRequest:
      description: FIDO-UAF解除用のリクエスト
      type: object
      properties:
        device_id:
          type: string
          example: cab44004-c288-4ae4-be88-9b1cbbe79b71
    AuthenticationDeviceRequest:
      type: object
      properties:
        app_name:
          type: string
          description: アプリ名（例：◯◯アプリ）。
        platform:
          type: string
          description: デバイスのプラットフォーム名（例："Android", "iOS" など）。
        os:
          type: string
          description: オペレーティングシステムのバージョン情報（例："Android15"）。
        model:
          type: string
          description: デバイスモデル名（例："galaxy z fold 6"）。
        locale:
          type: string
          description: 言語設定。（例：ja, en）
        notification_channel:
          type: string
          enum:
            - fcm
            - apns
          description: >-
            通知チャネル（"fcm", "apns"）。Firebase Cloud Messaging（Android）またはApple Push
            Notification Service（iOS）を指定。
        notification_token:
          type: string
          description: 通知を送信するためのトークン（例：FCMトークン）。
        priority:
          type: integer
          minimum: 1
          description: >
            このデバイスの通知の優先順位（例: 1, 2, 100）。 数値が小さいほど優先度が高く、1が最も高い。
            省略された場合は、認証デバイスの登録数の連番となる。
